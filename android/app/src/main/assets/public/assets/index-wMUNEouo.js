function oX(u,h){for(var f=0;f<h.length;f++){const g=h[f];if(typeof g!="string"&&!Array.isArray(g)){for(const S in g)if(S!=="default"&&!(S in u)){const C=Object.getOwnPropertyDescriptor(g,S);C&&Object.defineProperty(u,S,C.get?C:{enumerable:!0,get:()=>g[S]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))g(S);new MutationObserver(S=>{for(const C of S)if(C.type==="childList")for(const w of C.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&g(w)}).observe(document,{childList:!0,subtree:!0});function f(S){const C={};return S.integrity&&(C.integrity=S.integrity),S.referrerPolicy&&(C.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?C.credentials="include":S.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function g(S){if(S.ep)return;S.ep=!0;const C=f(S);fetch(S.href,C)}})();function g0(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var BI={exports:{}},gE={},WI={exports:{}},En={},$6;function aX(){if($6)return En;$6=1;/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u=Symbol.for("react.element"),h=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),w=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),M=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),B=Symbol.iterator;function Y(_e){return _e===null||typeof _e!="object"?null:(_e=B&&_e[B]||_e["@@iterator"],typeof _e=="function"?_e:null)}var H={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,X={};function te(_e,ke,ct){this.props=_e,this.context=ke,this.refs=X,this.updater=ct||H}te.prototype.isReactComponent={},te.prototype.setState=function(_e,ke){if(typeof _e!="object"&&typeof _e!="function"&&_e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_e,ke,"setState")},te.prototype.forceUpdate=function(_e){this.updater.enqueueForceUpdate(this,_e,"forceUpdate")};function ce(){}ce.prototype=te.prototype;function Z(_e,ke,ct){this.props=_e,this.context=ke,this.refs=X,this.updater=ct||H}var le=Z.prototype=new ce;le.constructor=Z,ie(le,te.prototype),le.isPureReactComponent=!0;var ne=Array.isArray,de=Object.prototype.hasOwnProperty,Pe={current:null},ue={key:!0,ref:!0,__self:!0,__source:!0};function he(_e,ke,ct){var at,Ot={},Gt=null,yt=null;if(ke!=null)for(at in ke.ref!==void 0&&(yt=ke.ref),ke.key!==void 0&&(Gt=""+ke.key),ke)de.call(ke,at)&&!ue.hasOwnProperty(at)&&(Ot[at]=ke[at]);var pn=arguments.length-2;if(pn===1)Ot.children=ct;else if(1<pn){for(var vn=Array(pn),or=0;or<pn;or++)vn[or]=arguments[or+2];Ot.children=vn}if(_e&&_e.defaultProps)for(at in pn=_e.defaultProps,pn)Ot[at]===void 0&&(Ot[at]=pn[at]);return{$$typeof:u,type:_e,key:Gt,ref:yt,props:Ot,_owner:Pe.current}}function ye(_e,ke){return{$$typeof:u,type:_e.type,key:ke,ref:_e.ref,props:_e.props,_owner:_e._owner}}function Ve(_e){return typeof _e=="object"&&_e!==null&&_e.$$typeof===u}function Je(_e){var ke={"=":"=0",":":"=2"};return"$"+_e.replace(/[=:]/g,function(ct){return ke[ct]})}var Ue=/\/+/g;function xe(_e,ke){return typeof _e=="object"&&_e!==null&&_e.key!=null?Je(""+_e.key):ke.toString(36)}function Ge(_e,ke,ct,at,Ot){var Gt=typeof _e;(Gt==="undefined"||Gt==="boolean")&&(_e=null);var yt=!1;if(_e===null)yt=!0;else switch(Gt){case"string":case"number":yt=!0;break;case"object":switch(_e.$$typeof){case u:case h:yt=!0}}if(yt)return yt=_e,Ot=Ot(yt),_e=at===""?"."+xe(yt,0):at,ne(Ot)?(ct="",_e!=null&&(ct=_e.replace(Ue,"$&/")+"/"),Ge(Ot,ke,ct,"",function(or){return or})):Ot!=null&&(Ve(Ot)&&(Ot=ye(Ot,ct+(!Ot.key||yt&&yt.key===Ot.key?"":(""+Ot.key).replace(Ue,"$&/")+"/")+_e)),ke.push(Ot)),1;if(yt=0,at=at===""?".":at+":",ne(_e))for(var pn=0;pn<_e.length;pn++){Gt=_e[pn];var vn=at+xe(Gt,pn);yt+=Ge(Gt,ke,ct,vn,Ot)}else if(vn=Y(_e),typeof vn=="function")for(_e=vn.call(_e),pn=0;!(Gt=_e.next()).done;)Gt=Gt.value,vn=at+xe(Gt,pn++),yt+=Ge(Gt,ke,ct,vn,Ot);else if(Gt==="object")throw ke=String(_e),Error("Objects are not valid as a React child (found: "+(ke==="[object Object]"?"object with keys {"+Object.keys(_e).join(", ")+"}":ke)+"). If you meant to render a collection of children, use an array instead.");return yt}function dt(_e,ke,ct){if(_e==null)return _e;var at=[],Ot=0;return Ge(_e,at,"","",function(Gt){return ke.call(ct,Gt,Ot++)}),at}function Xe(_e){if(_e._status===-1){var ke=_e._result;ke=ke(),ke.then(function(ct){(_e._status===0||_e._status===-1)&&(_e._status=1,_e._result=ct)},function(ct){(_e._status===0||_e._status===-1)&&(_e._status=2,_e._result=ct)}),_e._status===-1&&(_e._status=0,_e._result=ke)}if(_e._status===1)return _e._result.default;throw _e._result}var We={current:null},Ie={transition:null},De={ReactCurrentDispatcher:We,ReactCurrentBatchConfig:Ie,ReactCurrentOwner:Pe};function ze(){throw Error("act(...) is not supported in production builds of React.")}return En.Children={map:dt,forEach:function(_e,ke,ct){dt(_e,function(){ke.apply(this,arguments)},ct)},count:function(_e){var ke=0;return dt(_e,function(){ke++}),ke},toArray:function(_e){return dt(_e,function(ke){return ke})||[]},only:function(_e){if(!Ve(_e))throw Error("React.Children.only expected to receive a single React element child.");return _e}},En.Component=te,En.Fragment=f,En.Profiler=S,En.PureComponent=Z,En.StrictMode=g,En.Suspense=k,En.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=De,En.act=ze,En.cloneElement=function(_e,ke,ct){if(_e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+_e+".");var at=ie({},_e.props),Ot=_e.key,Gt=_e.ref,yt=_e._owner;if(ke!=null){if(ke.ref!==void 0&&(Gt=ke.ref,yt=Pe.current),ke.key!==void 0&&(Ot=""+ke.key),_e.type&&_e.type.defaultProps)var pn=_e.type.defaultProps;for(vn in ke)de.call(ke,vn)&&!ue.hasOwnProperty(vn)&&(at[vn]=ke[vn]===void 0&&pn!==void 0?pn[vn]:ke[vn])}var vn=arguments.length-2;if(vn===1)at.children=ct;else if(1<vn){pn=Array(vn);for(var or=0;or<vn;or++)pn[or]=arguments[or+2];at.children=pn}return{$$typeof:u,type:_e.type,key:Ot,ref:Gt,props:at,_owner:yt}},En.createContext=function(_e){return _e={$$typeof:w,_currentValue:_e,_currentValue2:_e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},_e.Provider={$$typeof:C,_context:_e},_e.Consumer=_e},En.createElement=he,En.createFactory=function(_e){var ke=he.bind(null,_e);return ke.type=_e,ke},En.createRef=function(){return{current:null}},En.forwardRef=function(_e){return{$$typeof:P,render:_e}},En.isValidElement=Ve,En.lazy=function(_e){return{$$typeof:U,_payload:{_status:-1,_result:_e},_init:Xe}},En.memo=function(_e,ke){return{$$typeof:M,type:_e,compare:ke===void 0?null:ke}},En.startTransition=function(_e){var ke=Ie.transition;Ie.transition={};try{_e()}finally{Ie.transition=ke}},En.unstable_act=ze,En.useCallback=function(_e,ke){return We.current.useCallback(_e,ke)},En.useContext=function(_e){return We.current.useContext(_e)},En.useDebugValue=function(){},En.useDeferredValue=function(_e){return We.current.useDeferredValue(_e)},En.useEffect=function(_e,ke){return We.current.useEffect(_e,ke)},En.useId=function(){return We.current.useId()},En.useImperativeHandle=function(_e,ke,ct){return We.current.useImperativeHandle(_e,ke,ct)},En.useInsertionEffect=function(_e,ke){return We.current.useInsertionEffect(_e,ke)},En.useLayoutEffect=function(_e,ke){return We.current.useLayoutEffect(_e,ke)},En.useMemo=function(_e,ke){return We.current.useMemo(_e,ke)},En.useReducer=function(_e,ke,ct){return We.current.useReducer(_e,ke,ct)},En.useRef=function(_e){return We.current.useRef(_e)},En.useState=function(_e){return We.current.useState(_e)},En.useSyncExternalStore=function(_e,ke,ct){return We.current.useSyncExternalStore(_e,ke,ct)},En.useTransition=function(){return We.current.useTransition()},En.version="18.3.1",En}var e4;function CA(){return e4||(e4=1,WI.exports=aX()),WI.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t4;function cX(){if(t4)return gE;t4=1;var u=CA(),h=Symbol.for("react.element"),f=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,S=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C={key:!0,ref:!0,__self:!0,__source:!0};function w(P,k,M){var U,B={},Y=null,H=null;M!==void 0&&(Y=""+M),k.key!==void 0&&(Y=""+k.key),k.ref!==void 0&&(H=k.ref);for(U in k)g.call(k,U)&&!C.hasOwnProperty(U)&&(B[U]=k[U]);if(P&&P.defaultProps)for(U in k=P.defaultProps,k)B[U]===void 0&&(B[U]=k[U]);return{$$typeof:h,type:P,key:Y,ref:H,props:B,_owner:S.current}}return gE.Fragment=f,gE.jsx=w,gE.jsxs=w,gE}var n4;function lX(){return n4||(n4=1,BI.exports=cX()),BI.exports}var O=lX(),ee=CA();const st=g0(ee),lj=oX({__proto__:null,default:st},[ee]),dX=1,uX=1e6;let GI=0;function hX(){return GI=(GI+1)%Number.MAX_SAFE_INTEGER,GI.toString()}const HI=new Map,r4=u=>{if(HI.has(u))return;const h=setTimeout(()=>{HI.delete(u),RE({type:"REMOVE_TOAST",toastId:u})},uX);HI.set(u,h)},pX=(u,h)=>{switch(h.type){case"ADD_TOAST":return{...u,toasts:[h.toast,...u.toasts].slice(0,dX)};case"UPDATE_TOAST":return{...u,toasts:u.toasts.map(f=>f.id===h.toast.id?{...f,...h.toast}:f)};case"DISMISS_TOAST":{const{toastId:f}=h;return f?r4(f):u.toasts.forEach(g=>{r4(g.id)}),{...u,toasts:u.toasts.map(g=>g.id===f||f===void 0?{...g,open:!1}:g)}}case"REMOVE_TOAST":return h.toastId===void 0?{...u,toasts:[]}:{...u,toasts:u.toasts.filter(f=>f.id!==h.toastId)}}},o0=[];let a0={toasts:[]};function RE(u){a0=pX(a0,u),o0.forEach(h=>{h(a0)})}function fX({...u}){const h=hX(),f=S=>RE({type:"UPDATE_TOAST",toast:{...S,id:h}}),g=()=>RE({type:"DISMISS_TOAST",toastId:h});return RE({type:"ADD_TOAST",toast:{...u,id:h,open:!0,onOpenChange:S=>{S||g()}}}),{id:h,dismiss:g,update:f}}function mX(){const[u,h]=ee.useState(a0);return ee.useEffect(()=>(o0.push(h),()=>{const f=o0.indexOf(h);f>-1&&o0.splice(f,1)}),[u]),{...u,toast:fX,dismiss:f=>RE({type:"DISMISS_TOAST",toastId:f})}}var KI={exports:{}},ks={},zI={exports:{}},YI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i4;function _X(){return i4||(i4=1,function(u){function h(Ie,De){var ze=Ie.length;Ie.push(De);e:for(;0<ze;){var _e=ze-1>>>1,ke=Ie[_e];if(0<S(ke,De))Ie[_e]=De,Ie[ze]=ke,ze=_e;else break e}}function f(Ie){return Ie.length===0?null:Ie[0]}function g(Ie){if(Ie.length===0)return null;var De=Ie[0],ze=Ie.pop();if(ze!==De){Ie[0]=ze;e:for(var _e=0,ke=Ie.length,ct=ke>>>1;_e<ct;){var at=2*(_e+1)-1,Ot=Ie[at],Gt=at+1,yt=Ie[Gt];if(0>S(Ot,ze))Gt<ke&&0>S(yt,Ot)?(Ie[_e]=yt,Ie[Gt]=ze,_e=Gt):(Ie[_e]=Ot,Ie[at]=ze,_e=at);else if(Gt<ke&&0>S(yt,ze))Ie[_e]=yt,Ie[Gt]=ze,_e=Gt;else break e}}return De}function S(Ie,De){var ze=Ie.sortIndex-De.sortIndex;return ze!==0?ze:Ie.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var C=performance;u.unstable_now=function(){return C.now()}}else{var w=Date,P=w.now();u.unstable_now=function(){return w.now()-P}}var k=[],M=[],U=1,B=null,Y=3,H=!1,ie=!1,X=!1,te=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(Ie){for(var De=f(M);De!==null;){if(De.callback===null)g(M);else if(De.startTime<=Ie)g(M),De.sortIndex=De.expirationTime,h(k,De);else break;De=f(M)}}function ne(Ie){if(X=!1,le(Ie),!ie)if(f(k)!==null)ie=!0,Xe(de);else{var De=f(M);De!==null&&We(ne,De.startTime-Ie)}}function de(Ie,De){ie=!1,X&&(X=!1,ce(he),he=-1),H=!0;var ze=Y;try{for(le(De),B=f(k);B!==null&&(!(B.expirationTime>De)||Ie&&!Je());){var _e=B.callback;if(typeof _e=="function"){B.callback=null,Y=B.priorityLevel;var ke=_e(B.expirationTime<=De);De=u.unstable_now(),typeof ke=="function"?B.callback=ke:B===f(k)&&g(k),le(De)}else g(k);B=f(k)}if(B!==null)var ct=!0;else{var at=f(M);at!==null&&We(ne,at.startTime-De),ct=!1}return ct}finally{B=null,Y=ze,H=!1}}var Pe=!1,ue=null,he=-1,ye=5,Ve=-1;function Je(){return!(u.unstable_now()-Ve<ye)}function Ue(){if(ue!==null){var Ie=u.unstable_now();Ve=Ie;var De=!0;try{De=ue(!0,Ie)}finally{De?xe():(Pe=!1,ue=null)}}else Pe=!1}var xe;if(typeof Z=="function")xe=function(){Z(Ue)};else if(typeof MessageChannel<"u"){var Ge=new MessageChannel,dt=Ge.port2;Ge.port1.onmessage=Ue,xe=function(){dt.postMessage(null)}}else xe=function(){te(Ue,0)};function Xe(Ie){ue=Ie,Pe||(Pe=!0,xe())}function We(Ie,De){he=te(function(){Ie(u.unstable_now())},De)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Ie){Ie.callback=null},u.unstable_continueExecution=function(){ie||H||(ie=!0,Xe(de))},u.unstable_forceFrameRate=function(Ie){0>Ie||125<Ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ye=0<Ie?Math.floor(1e3/Ie):5},u.unstable_getCurrentPriorityLevel=function(){return Y},u.unstable_getFirstCallbackNode=function(){return f(k)},u.unstable_next=function(Ie){switch(Y){case 1:case 2:case 3:var De=3;break;default:De=Y}var ze=Y;Y=De;try{return Ie()}finally{Y=ze}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(Ie,De){switch(Ie){case 1:case 2:case 3:case 4:case 5:break;default:Ie=3}var ze=Y;Y=Ie;try{return De()}finally{Y=ze}},u.unstable_scheduleCallback=function(Ie,De,ze){var _e=u.unstable_now();switch(typeof ze=="object"&&ze!==null?(ze=ze.delay,ze=typeof ze=="number"&&0<ze?_e+ze:_e):ze=_e,Ie){case 1:var ke=-1;break;case 2:ke=250;break;case 5:ke=1073741823;break;case 4:ke=1e4;break;default:ke=5e3}return ke=ze+ke,Ie={id:U++,callback:De,priorityLevel:Ie,startTime:ze,expirationTime:ke,sortIndex:-1},ze>_e?(Ie.sortIndex=ze,h(M,Ie),f(k)===null&&Ie===f(M)&&(X?(ce(he),he=-1):X=!0,We(ne,ze-_e))):(Ie.sortIndex=ke,h(k,Ie),ie||H||(ie=!0,Xe(de))),Ie},u.unstable_shouldYield=Je,u.unstable_wrapCallback=function(Ie){var De=Y;return function(){var ze=Y;Y=De;try{return Ie.apply(this,arguments)}finally{Y=ze}}}}(YI)),YI}var s4;function gX(){return s4||(s4=1,zI.exports=_X()),zI.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o4;function EX(){if(o4)return ks;o4=1;var u=CA(),h=gX();function f(a){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+a,_=1;_<arguments.length;_++)d+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+a+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g=new Set,S={};function C(a,d){w(a,d),w(a+"Capture",d)}function w(a,d){for(S[a]=d,a=0;a<d.length;a++)g.add(d[a])}var P=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),k=Object.prototype.hasOwnProperty,M=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,U={},B={};function Y(a){return k.call(B,a)?!0:k.call(U,a)?!1:M.test(a)?B[a]=!0:(U[a]=!0,!1)}function H(a,d,_,T){if(_!==null&&_.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return T?!1:_!==null?!_.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function ie(a,d,_,T){if(d===null||typeof d>"u"||H(a,d,_,T))return!0;if(T)return!1;if(_!==null)switch(_.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function X(a,d,_,T,I,L,q){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=T,this.attributeNamespace=I,this.mustUseProperty=_,this.propertyName=a,this.type=d,this.sanitizeURL=L,this.removeEmptyString=q}var te={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){te[a]=new X(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var d=a[0];te[d]=new X(d,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){te[a]=new X(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){te[a]=new X(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){te[a]=new X(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){te[a]=new X(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){te[a]=new X(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){te[a]=new X(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){te[a]=new X(a,5,!1,a.toLowerCase(),null,!1,!1)});var ce=/[\-:]([a-z])/g;function Z(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var d=a.replace(ce,Z);te[d]=new X(d,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var d=a.replace(ce,Z);te[d]=new X(d,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var d=a.replace(ce,Z);te[d]=new X(d,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){te[a]=new X(a,1,!1,a.toLowerCase(),null,!1,!1)}),te.xlinkHref=new X("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){te[a]=new X(a,1,!1,a.toLowerCase(),null,!0,!0)});function le(a,d,_,T){var I=te.hasOwnProperty(d)?te[d]:null;(I!==null?I.type!==0:T||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(ie(d,_,I,T)&&(_=null),T||I===null?Y(d)&&(_===null?a.removeAttribute(d):a.setAttribute(d,""+_)):I.mustUseProperty?a[I.propertyName]=_===null?I.type===3?!1:"":_:(d=I.attributeName,T=I.attributeNamespace,_===null?a.removeAttribute(d):(I=I.type,_=I===3||I===4&&_===!0?"":""+_,T?a.setAttributeNS(T,d,_):a.setAttribute(d,_))))}var ne=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,de=Symbol.for("react.element"),Pe=Symbol.for("react.portal"),ue=Symbol.for("react.fragment"),he=Symbol.for("react.strict_mode"),ye=Symbol.for("react.profiler"),Ve=Symbol.for("react.provider"),Je=Symbol.for("react.context"),Ue=Symbol.for("react.forward_ref"),xe=Symbol.for("react.suspense"),Ge=Symbol.for("react.suspense_list"),dt=Symbol.for("react.memo"),Xe=Symbol.for("react.lazy"),We=Symbol.for("react.offscreen"),Ie=Symbol.iterator;function De(a){return a===null||typeof a!="object"?null:(a=Ie&&a[Ie]||a["@@iterator"],typeof a=="function"?a:null)}var ze=Object.assign,_e;function ke(a){if(_e===void 0)try{throw Error()}catch(_){var d=_.stack.trim().match(/\n( *(at )?)/);_e=d&&d[1]||""}return`
`+_e+a}var ct=!1;function at(a,d){if(!a||ct)return"";ct=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(Le){var T=Le}Reflect.construct(a,[],d)}else{try{d.call()}catch(Le){T=Le}a.call(d.prototype)}else{try{throw Error()}catch(Le){T=Le}a()}}catch(Le){if(Le&&T&&typeof Le.stack=="string"){for(var I=Le.stack.split(`
`),L=T.stack.split(`
`),q=I.length-1,oe=L.length-1;1<=q&&0<=oe&&I[q]!==L[oe];)oe--;for(;1<=q&&0<=oe;q--,oe--)if(I[q]!==L[oe]){if(q!==1||oe!==1)do if(q--,oe--,0>oe||I[q]!==L[oe]){var me=`
`+I[q].replace(" at new "," at ");return a.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",a.displayName)),me}while(1<=q&&0<=oe);break}}}finally{ct=!1,Error.prepareStackTrace=_}return(a=a?a.displayName||a.name:"")?ke(a):""}function Ot(a){switch(a.tag){case 5:return ke(a.type);case 16:return ke("Lazy");case 13:return ke("Suspense");case 19:return ke("SuspenseList");case 0:case 2:case 15:return a=at(a.type,!1),a;case 11:return a=at(a.type.render,!1),a;case 1:return a=at(a.type,!0),a;default:return""}}function Gt(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case ue:return"Fragment";case Pe:return"Portal";case ye:return"Profiler";case he:return"StrictMode";case xe:return"Suspense";case Ge:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case Je:return(a.displayName||"Context")+".Consumer";case Ve:return(a._context.displayName||"Context")+".Provider";case Ue:var d=a.render;return a=a.displayName,a||(a=d.displayName||d.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case dt:return d=a.displayName||null,d!==null?d:Gt(a.type)||"Memo";case Xe:d=a._payload,a=a._init;try{return Gt(a(d))}catch{}}return null}function yt(a){var d=a.type;switch(a.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=d.render,a=a.displayName||a.name||"",d.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gt(d);case 8:return d===he?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function pn(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function vn(a){var d=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function or(a){var d=vn(a)?"checked":"value",_=Object.getOwnPropertyDescriptor(a.constructor.prototype,d),T=""+a[d];if(!a.hasOwnProperty(d)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var I=_.get,L=_.set;return Object.defineProperty(a,d,{configurable:!0,get:function(){return I.call(this)},set:function(q){T=""+q,L.call(this,q)}}),Object.defineProperty(a,d,{enumerable:_.enumerable}),{getValue:function(){return T},setValue:function(q){T=""+q},stopTracking:function(){a._valueTracker=null,delete a[d]}}}}function hs(a){a._valueTracker||(a._valueTracker=or(a))}function Ua(a){if(!a)return!1;var d=a._valueTracker;if(!d)return!0;var _=d.getValue(),T="";return a&&(T=vn(a)?a.checked?"true":"false":a.value),a=T,a!==_?(d.setValue(a),!0):!1}function Kr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function $d(a,d){var _=d.checked;return ze({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??a._wrapperState.initialChecked})}function Fh(a,d){var _=d.defaultValue==null?"":d.defaultValue,T=d.checked!=null?d.checked:d.defaultChecked;_=pn(d.value!=null?d.value:_),a._wrapperState={initialChecked:T,initialValue:_,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function ps(a,d){d=d.checked,d!=null&&le(a,"checked",d,!1)}function eu(a,d){ps(a,d);var _=pn(d.value),T=d.type;if(_!=null)T==="number"?(_===0&&a.value===""||a.value!=_)&&(a.value=""+_):a.value!==""+_&&(a.value=""+_);else if(T==="submit"||T==="reset"){a.removeAttribute("value");return}d.hasOwnProperty("value")?Qr(a,d.type,_):d.hasOwnProperty("defaultValue")&&Qr(a,d.type,pn(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(a.defaultChecked=!!d.defaultChecked)}function pr(a,d,_){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var T=d.type;if(!(T!=="submit"&&T!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+a._wrapperState.initialValue,_||d===a.value||(a.value=d),a.defaultValue=d}_=a.name,_!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,_!==""&&(a.name=_)}function Qr(a,d,_){(d!=="number"||Kr(a.ownerDocument)!==a)&&(_==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+_&&(a.defaultValue=""+_))}var po=Array.isArray;function ki(a,d,_,T){if(a=a.options,d){d={};for(var I=0;I<_.length;I++)d["$"+_[I]]=!0;for(_=0;_<a.length;_++)I=d.hasOwnProperty("$"+a[_].value),a[_].selected!==I&&(a[_].selected=I),I&&T&&(a[_].defaultSelected=!0)}else{for(_=""+pn(_),d=null,I=0;I<a.length;I++){if(a[I].value===_){a[I].selected=!0,T&&(a[I].defaultSelected=!0);return}d!==null||a[I].disabled||(d=a[I])}d!==null&&(d.selected=!0)}}function bl(a,d){if(d.dangerouslySetInnerHTML!=null)throw Error(f(91));return ze({},d,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Ms(a,d){var _=d.value;if(_==null){if(_=d.children,d=d.defaultValue,_!=null){if(d!=null)throw Error(f(92));if(po(_)){if(1<_.length)throw Error(f(93));_=_[0]}d=_}d==null&&(d=""),_=d}a._wrapperState={initialValue:pn(_)}}function Ar(a,d){var _=pn(d.value),T=pn(d.defaultValue);_!=null&&(_=""+_,_!==a.value&&(a.value=_),d.defaultValue==null&&a.defaultValue!==_&&(a.defaultValue=_)),T!=null&&(a.defaultValue=""+T)}function tu(a){var d=a.textContent;d===a._wrapperState.initialValue&&d!==""&&d!==null&&(a.value=d)}function li(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zr(a,d){return a==null||a==="http://www.w3.org/1999/xhtml"?li(d):a==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Uc,Il=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,_,T,I){MSApp.execUnsafeLocalFunction(function(){return a(d,_,T,I)})}:a}(function(a,d){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=d;else{for(Uc=Uc||document.createElement("div"),Uc.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Uc.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}});function Us(a,d){if(d){var _=a.firstChild;if(_&&_===a.lastChild&&_.nodeType===3){_.nodeValue=d;return}}a.textContent=d}var Va={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nu=["Webkit","ms","Moz","O"];Object.keys(Va).forEach(function(a){nu.forEach(function(d){d=d+a.charAt(0).toUpperCase()+a.substring(1),Va[d]=Va[a]})});function Vc(a,d,_){return d==null||typeof d=="boolean"||d===""?"":_||typeof d!="number"||d===0||Va.hasOwnProperty(a)&&Va[a]?(""+d).trim():d+"px"}function Ti(a,d){a=a.style;for(var _ in d)if(d.hasOwnProperty(_)){var T=_.indexOf("--")===0,I=Vc(_,d[_],T);_==="float"&&(_="cssFloat"),T?a.setProperty(_,I):a[_]=I}}var ru=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fo(a,d){if(d){if(ru[a]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(f(137,a));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(f(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(f(61))}if(d.style!=null&&typeof d.style!="object")throw Error(f(62))}}function iu(a,d){if(a.indexOf("-")===-1)return typeof d.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mo=null;function jc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Al=null,ja=null,_o=null;function Vs(a){if(a=bu(a)){if(typeof Al!="function")throw Error(f(280));var d=a.stateNode;d&&(d=ap(d),Al(a.stateNode,a.type,d))}}function Fa(a){ja?_o?_o.push(a):_o=[a]:ja=a}function Kt(){if(ja){var a=ja,d=_o;if(_o=ja=null,Vs(a),d)for(a=0;a<d.length;a++)Vs(d[a])}}function fn(a,d){return a(d)}function Fn(){}var Ci=!1;function Li(a,d,_){if(Ci)return a(d,_);Ci=!0;try{return fn(a,d,_)}finally{Ci=!1,(ja!==null||_o!==null)&&(Fn(),Kt())}}function Bn(a,d){var _=a.stateNode;if(_===null)return null;var T=ap(_);if(T===null)return null;_=T[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(T=!T.disabled)||(a=a.type,T=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!T;break e;default:a=!1}if(a)return null;if(_&&typeof _!="function")throw Error(f(231,d,typeof _));return _}var js=!1;if(P)try{var Zr={};Object.defineProperty(Zr,"passive",{get:function(){js=!0}}),window.addEventListener("test",Zr,Zr),window.removeEventListener("test",Zr,Zr)}catch{js=!1}function Xi(a,d,_,T,I,L,q,oe,me){var Le=Array.prototype.slice.call(arguments,3);try{d.apply(_,Le)}catch(Ze){this.onError(Ze)}}var Ol=!1,su=null,ou=!1,mm=null,BE={onError:function(a){Ol=!0,su=a}};function WE(a,d,_,T,I,L,q,oe,me){Ol=!1,su=null,Xi.apply(BE,arguments)}function U0(a,d,_,T,I,L,q,oe,me){if(WE.apply(this,arguments),Ol){if(Ol){var Le=su;Ol=!1,su=null}else throw Error(f(198));ou||(ou=!0,mm=Le)}}function Fc(a){var d=a,_=a;if(a.alternate)for(;d.return;)d=d.return;else{a=d;do d=a,(d.flags&4098)!==0&&(_=d.return),a=d.return;while(a)}return d.tag===3?_:null}function GE(a){if(a.tag===13){var d=a.memoizedState;if(d===null&&(a=a.alternate,a!==null&&(d=a.memoizedState)),d!==null)return d.dehydrated}return null}function _m(a){if(Fc(a)!==a)throw Error(f(188))}function HE(a){var d=a.alternate;if(!d){if(d=Fc(a),d===null)throw Error(f(188));return d!==a?null:a}for(var _=a,T=d;;){var I=_.return;if(I===null)break;var L=I.alternate;if(L===null){if(T=I.return,T!==null){_=T;continue}break}if(I.child===L.child){for(L=I.child;L;){if(L===_)return _m(I),a;if(L===T)return _m(I),d;L=L.sibling}throw Error(f(188))}if(_.return!==T.return)_=I,T=L;else{for(var q=!1,oe=I.child;oe;){if(oe===_){q=!0,_=I,T=L;break}if(oe===T){q=!0,T=I,_=L;break}oe=oe.sibling}if(!q){for(oe=L.child;oe;){if(oe===_){q=!0,_=L,T=I;break}if(oe===T){q=!0,T=L,_=I;break}oe=oe.sibling}if(!q)throw Error(f(189))}}if(_.alternate!==T)throw Error(f(190))}if(_.tag!==3)throw Error(f(188));return _.stateNode.current===_?a:d}function Bh(a){return a=HE(a),a!==null?gm(a):null}function gm(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var d=gm(a);if(d!==null)return d;a=a.sibling}return null}var Bc=h.unstable_scheduleCallback,KE=h.unstable_cancelCallback,V0=h.unstable_shouldYield,go=h.unstable_requestPaint,vr=h.unstable_now,j0=h.unstable_getCurrentPriorityLevel,fr=h.unstable_ImmediatePriority,zE=h.unstable_UserBlockingPriority,Wh=h.unstable_NormalPriority,F0=h.unstable_LowPriority,YE=h.unstable_IdlePriority,Nl=null,Eo=null;function qE(a){if(Eo&&typeof Eo.onCommitFiberRoot=="function")try{Eo.onCommitFiberRoot(Nl,a,void 0,(a.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:Pl,B0=Math.log,W0=Math.LN2;function Pl(a){return a>>>=0,a===0?32:31-(B0(a)/W0|0)|0}var Dl=64,Gh=4194304;function An(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Hh(a,d){var _=a.pendingLanes;if(_===0)return 0;var T=0,I=a.suspendedLanes,L=a.pingedLanes,q=_&268435455;if(q!==0){var oe=q&~I;oe!==0?T=An(oe):(L&=q,L!==0&&(T=An(L)))}else q=_&~I,q!==0?T=An(q):L!==0&&(T=An(L));if(T===0)return 0;if(d!==0&&d!==T&&(d&I)===0&&(I=T&-T,L=d&-d,I>=L||I===16&&(L&4194240)!==0))return d;if((T&4)!==0&&(T|=_&16),d=a.entangledLanes,d!==0)for(a=a.entanglements,d&=T;0<d;)_=31-Fs(d),I=1<<_,T|=a[_],d&=~I;return T}function XE(a,d){switch(a){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JE(a,d){for(var _=a.suspendedLanes,T=a.pingedLanes,I=a.expirationTimes,L=a.pendingLanes;0<L;){var q=31-Fs(L),oe=1<<q,me=I[q];me===-1?((oe&_)===0||(oe&T)!==0)&&(I[q]=XE(oe,d)):me<=d&&(a.expiredLanes|=oe),L&=~oe}}function Em(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function QE(){var a=Dl;return Dl<<=1,(Dl&4194240)===0&&(Dl=64),a}function vm(a){for(var d=[],_=0;31>_;_++)d.push(a);return d}function au(a,d,_){a.pendingLanes|=d,d!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,d=31-Fs(d),a[d]=_}function G0(a,d){var _=a.pendingLanes&~d;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=d,a.mutableReadLanes&=d,a.entangledLanes&=d,d=a.entanglements;var T=a.eventTimes;for(a=a.expirationTimes;0<_;){var I=31-Fs(_),L=1<<I;d[I]=0,T[I]=-1,a[I]=-1,_&=~L}}function Sm(a,d){var _=a.entangledLanes|=d;for(a=a.entanglements;_;){var T=31-Fs(_),I=1<<T;I&d|a[T]&d&&(a[T]|=d),_&=~I}}var On=0;function ym(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var Kh,Tm,zh,ZE,Cm,Rm=!1,Yh=[],Ba=null,Wa=null,Ga=null,cu=new Map,lu=new Map,Ha=[],$E="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ev(a,d){switch(a){case"focusin":case"focusout":Ba=null;break;case"dragenter":case"dragleave":Wa=null;break;case"mouseover":case"mouseout":Ga=null;break;case"pointerover":case"pointerout":cu.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":lu.delete(d.pointerId)}}function du(a,d,_,T,I,L){return a===null||a.nativeEvent!==L?(a={blockedOn:d,domEventName:_,eventSystemFlags:T,nativeEvent:L,targetContainers:[I]},d!==null&&(d=bu(d),d!==null&&Tm(d)),a):(a.eventSystemFlags|=T,d=a.targetContainers,I!==null&&d.indexOf(I)===-1&&d.push(I),a)}function H0(a,d,_,T,I){switch(d){case"focusin":return Ba=du(Ba,a,d,_,T,I),!0;case"dragenter":return Wa=du(Wa,a,d,_,T,I),!0;case"mouseover":return Ga=du(Ga,a,d,_,T,I),!0;case"pointerover":var L=I.pointerId;return cu.set(L,du(cu.get(L)||null,a,d,_,T,I)),!0;case"gotpointercapture":return L=I.pointerId,lu.set(L,du(lu.get(L)||null,a,d,_,T,I)),!0}return!1}function kl(a){var d=Hc(a.target);if(d!==null){var _=Fc(d);if(_!==null){if(d=_.tag,d===13){if(d=GE(_),d!==null){a.blockedOn=d,Cm(a.priority,function(){zh(_)});return}}else if(d===3&&_.stateNode.current.memoizedState.isDehydrated){a.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}a.blockedOn=null}function qh(a){if(a.blockedOn!==null)return!1;for(var d=a.targetContainers;0<d.length;){var _=wm(a.domEventName,a.eventSystemFlags,d[0],a.nativeEvent);if(_===null){_=a.nativeEvent;var T=new _.constructor(_.type,_);mo=T,_.target.dispatchEvent(T),mo=null}else return d=bu(_),d!==null&&Tm(d),a.blockedOn=_,!1;d.shift()}return!0}function tv(a,d,_){qh(a)&&_.delete(d)}function K0(){Rm=!1,Ba!==null&&qh(Ba)&&(Ba=null),Wa!==null&&qh(Wa)&&(Wa=null),Ga!==null&&qh(Ga)&&(Ga=null),cu.forEach(tv),lu.forEach(tv)}function uu(a,d){a.blockedOn===d&&(a.blockedOn=null,Rm||(Rm=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,K0)))}function Ll(a){function d(I){return uu(I,a)}if(0<Yh.length){uu(Yh[0],a);for(var _=1;_<Yh.length;_++){var T=Yh[_];T.blockedOn===a&&(T.blockedOn=null)}}for(Ba!==null&&uu(Ba,a),Wa!==null&&uu(Wa,a),Ga!==null&&uu(Ga,a),cu.forEach(d),lu.forEach(d),_=0;_<Ha.length;_++)T=Ha[_],T.blockedOn===a&&(T.blockedOn=null);for(;0<Ha.length&&(_=Ha[0],_.blockedOn===null);)kl(_),_.blockedOn===null&&Ha.shift()}var xl=ne.ReactCurrentBatchConfig,Xh=!0;function z0(a,d,_,T){var I=On,L=xl.transition;xl.transition=null;try{On=1,xi(a,d,_,T)}finally{On=I,xl.transition=L}}function Ka(a,d,_,T){var I=On,L=xl.transition;xl.transition=null;try{On=4,xi(a,d,_,T)}finally{On=I,xl.transition=L}}function xi(a,d,_,T){if(Xh){var I=wm(a,d,_,T);if(I===null)Km(a,d,T,hu,_),ev(a,T);else if(H0(I,a,d,_,T))T.stopPropagation();else if(ev(a,T),d&4&&-1<$E.indexOf(a)){for(;I!==null;){var L=bu(I);if(L!==null&&Kh(L),L=wm(a,d,_,T),L===null&&Km(a,d,T,hu,_),L===I)break;I=L}I!==null&&T.stopPropagation()}else Km(a,d,T,null,_)}}var hu=null;function wm(a,d,_,T){if(hu=null,a=jc(T),a=Hc(a),a!==null)if(d=Fc(a),d===null)a=null;else if(_=d.tag,_===13){if(a=GE(d),a!==null)return a;a=null}else if(_===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;a=null}else d!==a&&(a=null);return hu=a,null}function nv(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(j0()){case fr:return 1;case zE:return 4;case Wh:case F0:return 16;case YE:return 536870912;default:return 16}default:return 16}}var za=null,$r=null,Jh=null;function rv(){if(Jh)return Jh;var a,d=$r,_=d.length,T,I="value"in za?za.value:za.textContent,L=I.length;for(a=0;a<_&&d[a]===I[a];a++);var q=_-a;for(T=1;T<=q&&d[_-T]===I[L-T];T++);return Jh=I.slice(a,1<T?1-T:void 0)}function Qh(a){var d=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&d===13&&(a=13)):a=d,a===10&&(a=13),32<=a||a===13?a:0}function Wc(){return!0}function bm(){return!1}function Ji(a){function d(_,T,I,L,q){this._reactName=_,this._targetInst=I,this.type=T,this.nativeEvent=L,this.target=q,this.currentTarget=null;for(var oe in a)a.hasOwnProperty(oe)&&(_=a[oe],this[oe]=_?_(L):L[oe]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Wc:bm,this.isPropagationStopped=bm,this}return ze(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=Wc)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=Wc)},persist:function(){},isPersistent:Wc}),d}var Ya={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Im=Ji(Ya),Gc=ze({},Ya,{view:0,detail:0}),Am=Ji(Gc),pu,Om,fu,vo=ze({},Gc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pm,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==fu&&(fu&&a.type==="mousemove"?(pu=a.screenX-fu.screenX,Om=a.screenY-fu.screenY):Om=pu=0,fu=a),pu)},movementY:function(a){return"movementY"in a?a.movementY:Om}}),Ml=Ji(vo),Y0=ze({},vo,{dataTransfer:0}),q0=Ji(Y0),X0=ze({},Gc,{relatedTarget:0}),Nm=Ji(X0),J0=ze({},Ya,{animationName:0,elapsedTime:0,pseudoElement:0}),Ul=Ji(J0),Q0=ze({},Ya,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Vl=Ji(Q0),iv=ze({},Ya,{data:0}),sv=Ji(iv),qt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Z0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eC(a){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(a):(a=$0[a])?!!d[a]:!1}function Pm(){return eC}var Dm=ze({},Gc,{key:function(a){if(a.key){var d=qt[a.key]||a.key;if(d!=="Unidentified")return d}return a.type==="keypress"?(a=Qh(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Z0[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pm,charCode:function(a){return a.type==="keypress"?Qh(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Qh(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),tC=Ji(Dm),nC=ze({},vo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ov=Ji(nC),km=ze({},Gc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pm}),rC=Ji(km),iC=ze({},Ya,{propertyName:0,elapsedTime:0,pseudoElement:0}),av=Ji(iC),sC=ze({},vo,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),qa=Ji(sC),oC=[9,13,27,32],Lm=P&&"CompositionEvent"in window,mu=null;P&&"documentMode"in document&&(mu=document.documentMode);var cv=P&&"TextEvent"in window&&!mu,Zh=P&&(!Lm||mu&&8<mu&&11>=mu),lv=" ",dv=!1;function uv(a,d){switch(a){case"keyup":return oC.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qi(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var jl=!1;function aC(a,d){switch(a){case"compositionend":return Qi(d);case"keypress":return d.which!==32?null:(dv=!0,lv);case"textInput":return a=d.data,a===lv&&dv?null:a;default:return null}}function cC(a,d){if(jl)return a==="compositionend"||!Lm&&uv(a,d)?(a=rv(),Jh=$r=za=null,jl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Zh&&d.locale!=="ko"?null:d.data;default:return null}}var lC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xm(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d==="input"?!!lC[a.type]:d==="textarea"}function hv(a,d,_,T){Fa(T),d=Tu(d,"onChange"),0<d.length&&(_=new Im("onChange","change",null,_,T),a.push({event:_,listeners:d}))}var _u=null,Fl=null;function Mm(a){Cv(a,0)}function $h(a){var d=Yl(a);if(Ua(d))return a}function dC(a,d){if(a==="change")return d}var gu=!1;if(P){var Um;if(P){var Vm="oninput"in document;if(!Vm){var pv=document.createElement("div");pv.setAttribute("oninput","return;"),Vm=typeof pv.oninput=="function"}Um=Vm}else Um=!1;gu=Um&&(!document.documentMode||9<document.documentMode)}function Xo(){_u&&(_u.detachEvent("onpropertychange",fv),Fl=_u=null)}function fv(a){if(a.propertyName==="value"&&$h(Fl)){var d=[];hv(d,Fl,a,jc(a)),Li(Mm,d)}}function uC(a,d,_){a==="focusin"?(Xo(),_u=d,Fl=_,_u.attachEvent("onpropertychange",fv)):a==="focusout"&&Xo()}function Mi(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return $h(Fl)}function hC(a,d){if(a==="click")return $h(d)}function pC(a,d){if(a==="input"||a==="change")return $h(d)}function fC(a,d){return a===d&&(a!==0||1/a===1/d)||a!==a&&d!==d}var Bs=typeof Object.is=="function"?Object.is:fC;function Bl(a,d){if(Bs(a,d))return!0;if(typeof a!="object"||a===null||typeof d!="object"||d===null)return!1;var _=Object.keys(a),T=Object.keys(d);if(_.length!==T.length)return!1;for(T=0;T<_.length;T++){var I=_[T];if(!k.call(d,I)||!Bs(a[I],d[I]))return!1}return!0}function mv(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function _v(a,d){var _=mv(a);a=0;for(var T;_;){if(_.nodeType===3){if(T=a+_.textContent.length,a<=d&&T>=d)return{node:_,offset:d-a};a=T}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=mv(_)}}function gv(a,d){return a&&d?a===d?!0:a&&a.nodeType===3?!1:d&&d.nodeType===3?gv(a,d.parentNode):"contains"in a?a.contains(d):a.compareDocumentPosition?!!(a.compareDocumentPosition(d)&16):!1:!1}function jm(){for(var a=window,d=Kr();d instanceof a.HTMLIFrameElement;){try{var _=typeof d.contentWindow.location.href=="string"}catch{_=!1}if(_)a=d.contentWindow;else break;d=Kr(a.document)}return d}function Fm(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d&&(d==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||d==="textarea"||a.contentEditable==="true")}function mC(a){var d=jm(),_=a.focusedElem,T=a.selectionRange;if(d!==_&&_&&_.ownerDocument&&gv(_.ownerDocument.documentElement,_)){if(T!==null&&Fm(_)){if(d=T.start,a=T.end,a===void 0&&(a=d),"selectionStart"in _)_.selectionStart=d,_.selectionEnd=Math.min(a,_.value.length);else if(a=(d=_.ownerDocument||document)&&d.defaultView||window,a.getSelection){a=a.getSelection();var I=_.textContent.length,L=Math.min(T.start,I);T=T.end===void 0?L:Math.min(T.end,I),!a.extend&&L>T&&(I=T,T=L,L=I),I=_v(_,L);var q=_v(_,T);I&&q&&(a.rangeCount!==1||a.anchorNode!==I.node||a.anchorOffset!==I.offset||a.focusNode!==q.node||a.focusOffset!==q.offset)&&(d=d.createRange(),d.setStart(I.node,I.offset),a.removeAllRanges(),L>T?(a.addRange(d),a.extend(q.node,q.offset)):(d.setEnd(q.node,q.offset),a.addRange(d)))}}for(d=[],a=_;a=a.parentNode;)a.nodeType===1&&d.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<d.length;_++)a=d[_],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Bm=P&&"documentMode"in document&&11>=document.documentMode,Xa=null,Wm=null,Ae=null,Gm=!1;function Ev(a,d,_){var T=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Gm||Xa==null||Xa!==Kr(T)||(T=Xa,"selectionStart"in T&&Fm(T)?T={start:T.selectionStart,end:T.selectionEnd}:(T=(T.ownerDocument&&T.ownerDocument.defaultView||window).getSelection(),T={anchorNode:T.anchorNode,anchorOffset:T.anchorOffset,focusNode:T.focusNode,focusOffset:T.focusOffset}),Ae&&Bl(Ae,T)||(Ae=T,T=Tu(Wm,"onSelect"),0<T.length&&(d=new Im("onSelect","select",null,d,_),a.push({event:d,listeners:T}),d.target=Xa)))}function ep(a,d){var _={};return _[a.toLowerCase()]=d.toLowerCase(),_["Webkit"+a]="webkit"+d,_["Moz"+a]="moz"+d,_}var Wl={animationend:ep("Animation","AnimationEnd"),animationiteration:ep("Animation","AnimationIteration"),animationstart:ep("Animation","AnimationStart"),transitionend:ep("Transition","TransitionEnd")},tp={},Hm={};P&&(Hm=document.createElement("div").style,"AnimationEvent"in window||(delete Wl.animationend.animation,delete Wl.animationiteration.animation,delete Wl.animationstart.animation),"TransitionEvent"in window||delete Wl.transitionend.transition);function np(a){if(tp[a])return tp[a];if(!Wl[a])return a;var d=Wl[a],_;for(_ in d)if(d.hasOwnProperty(_)&&_ in Hm)return tp[a]=d[_];return a}var vv=np("animationend"),Sv=np("animationiteration"),Eu=np("animationstart"),Gl=np("transitionend"),yv=new Map,Tv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ws(a,d){yv.set(a,d),C(d,[a])}for(var vu=0;vu<Tv.length;vu++){var Hl=Tv[vu],_C=Hl.toLowerCase(),gC=Hl[0].toUpperCase()+Hl.slice(1);Ws(_C,"on"+gC)}Ws(vv,"onAnimationEnd"),Ws(Sv,"onAnimationIteration"),Ws(Eu,"onAnimationStart"),Ws("dblclick","onDoubleClick"),Ws("focusin","onFocus"),Ws("focusout","onBlur"),Ws(Gl,"onTransitionEnd"),w("onMouseEnter",["mouseout","mouseover"]),w("onMouseLeave",["mouseout","mouseover"]),w("onPointerEnter",["pointerout","pointerover"]),w("onPointerLeave",["pointerout","pointerover"]),C("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),C("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),C("onBeforeInput",["compositionend","keypress","textInput","paste"]),C("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),C("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),C("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Su="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),EC=new Set("cancel close invalid load scroll toggle".split(" ").concat(Su));function rp(a,d,_){var T=a.type||"unknown-event";a.currentTarget=_,U0(T,d,void 0,a),a.currentTarget=null}function Cv(a,d){d=(d&4)!==0;for(var _=0;_<a.length;_++){var T=a[_],I=T.event;T=T.listeners;e:{var L=void 0;if(d)for(var q=T.length-1;0<=q;q--){var oe=T[q],me=oe.instance,Le=oe.currentTarget;if(oe=oe.listener,me!==L&&I.isPropagationStopped())break e;rp(I,oe,Le),L=me}else for(q=0;q<T.length;q++){if(oe=T[q],me=oe.instance,Le=oe.currentTarget,oe=oe.listener,me!==L&&I.isPropagationStopped())break e;rp(I,oe,Le),L=me}}}if(ou)throw a=mm,ou=!1,mm=null,a}function zn(a,d){var _=d[Xm];_===void 0&&(_=d[Xm]=new Set);var T=a+"__bubble";_.has(T)||(Rv(d,a,2,!1),_.add(T))}function Ui(a,d,_){var T=0;d&&(T|=4),Rv(_,a,T,d)}var ip="_reactListening"+Math.random().toString(36).slice(2);function Jo(a){if(!a[ip]){a[ip]=!0,g.forEach(function(_){_!=="selectionchange"&&(EC.has(_)||Ui(_,!1,a),Ui(_,!0,a))});var d=a.nodeType===9?a:a.ownerDocument;d===null||d[ip]||(d[ip]=!0,Ui("selectionchange",!1,d))}}function Rv(a,d,_,T){switch(nv(d)){case 1:var I=z0;break;case 4:I=Ka;break;default:I=xi}_=I.bind(null,d,_,a),I=void 0,!js||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(I=!0),T?I!==void 0?a.addEventListener(d,_,{capture:!0,passive:I}):a.addEventListener(d,_,!0):I!==void 0?a.addEventListener(d,_,{passive:I}):a.addEventListener(d,_,!1)}function Km(a,d,_,T,I){var L=T;if((d&1)===0&&(d&2)===0&&T!==null)e:for(;;){if(T===null)return;var q=T.tag;if(q===3||q===4){var oe=T.stateNode.containerInfo;if(oe===I||oe.nodeType===8&&oe.parentNode===I)break;if(q===4)for(q=T.return;q!==null;){var me=q.tag;if((me===3||me===4)&&(me=q.stateNode.containerInfo,me===I||me.nodeType===8&&me.parentNode===I))return;q=q.return}for(;oe!==null;){if(q=Hc(oe),q===null)return;if(me=q.tag,me===5||me===6){T=L=q;continue e}oe=oe.parentNode}}T=T.return}Li(function(){var Le=L,Ze=jc(_),$e=[];e:{var Qe=yv.get(a);if(Qe!==void 0){var _t=Im,Tt=a;switch(a){case"keypress":if(Qh(_)===0)break e;case"keydown":case"keyup":_t=tC;break;case"focusin":Tt="focus",_t=Nm;break;case"focusout":Tt="blur",_t=Nm;break;case"beforeblur":case"afterblur":_t=Nm;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_t=Ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_t=q0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_t=rC;break;case vv:case Sv:case Eu:_t=Ul;break;case Gl:_t=av;break;case"scroll":_t=Am;break;case"wheel":_t=qa;break;case"copy":case"cut":case"paste":_t=Vl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_t=ov}var Rt=(d&4)!==0,lr=!Rt&&a==="scroll",Ce=Rt?Qe!==null?Qe+"Capture":null:Qe;Rt=[];for(var ge=Le,Oe;ge!==null;){Oe=ge;var nt=Oe.stateNode;if(Oe.tag===5&&nt!==null&&(Oe=nt,Ce!==null&&(nt=Bn(ge,Ce),nt!=null&&Rt.push(yu(ge,nt,Oe)))),lr)break;ge=ge.return}0<Rt.length&&(Qe=new _t(Qe,Tt,null,_,Ze),$e.push({event:Qe,listeners:Rt}))}}if((d&7)===0){e:{if(Qe=a==="mouseover"||a==="pointerover",_t=a==="mouseout"||a==="pointerout",Qe&&_!==mo&&(Tt=_.relatedTarget||_.fromElement)&&(Hc(Tt)||Tt[Qo]))break e;if((_t||Qe)&&(Qe=Ze.window===Ze?Ze:(Qe=Ze.ownerDocument)?Qe.defaultView||Qe.parentWindow:window,_t?(Tt=_.relatedTarget||_.toElement,_t=Le,Tt=Tt?Hc(Tt):null,Tt!==null&&(lr=Fc(Tt),Tt!==lr||Tt.tag!==5&&Tt.tag!==6)&&(Tt=null)):(_t=null,Tt=Le),_t!==Tt)){if(Rt=Ml,nt="onMouseLeave",Ce="onMouseEnter",ge="mouse",(a==="pointerout"||a==="pointerover")&&(Rt=ov,nt="onPointerLeave",Ce="onPointerEnter",ge="pointer"),lr=_t==null?Qe:Yl(_t),Oe=Tt==null?Qe:Yl(Tt),Qe=new Rt(nt,ge+"leave",_t,_,Ze),Qe.target=lr,Qe.relatedTarget=Oe,nt=null,Hc(Ze)===Le&&(Rt=new Rt(Ce,ge+"enter",Tt,_,Ze),Rt.target=Oe,Rt.relatedTarget=lr,nt=Rt),lr=nt,_t&&Tt)t:{for(Rt=_t,Ce=Tt,ge=0,Oe=Rt;Oe;Oe=Kl(Oe))ge++;for(Oe=0,nt=Ce;nt;nt=Kl(nt))Oe++;for(;0<ge-Oe;)Rt=Kl(Rt),ge--;for(;0<Oe-ge;)Ce=Kl(Ce),Oe--;for(;ge--;){if(Rt===Ce||Ce!==null&&Rt===Ce.alternate)break t;Rt=Kl(Rt),Ce=Kl(Ce)}Rt=null}else Rt=null;_t!==null&&wv($e,Qe,_t,Rt,!1),Tt!==null&&lr!==null&&wv($e,lr,Tt,Rt,!0)}}e:{if(Qe=Le?Yl(Le):window,_t=Qe.nodeName&&Qe.nodeName.toLowerCase(),_t==="select"||_t==="input"&&Qe.type==="file")var wt=dC;else if(xm(Qe))if(gu)wt=pC;else{wt=Mi;var Dt=uC}else(_t=Qe.nodeName)&&_t.toLowerCase()==="input"&&(Qe.type==="checkbox"||Qe.type==="radio")&&(wt=hC);if(wt&&(wt=wt(a,Le))){hv($e,wt,_,Ze);break e}Dt&&Dt(a,Qe,Le),a==="focusout"&&(Dt=Qe._wrapperState)&&Dt.controlled&&Qe.type==="number"&&Qr(Qe,"number",Qe.value)}switch(Dt=Le?Yl(Le):window,a){case"focusin":(xm(Dt)||Dt.contentEditable==="true")&&(Xa=Dt,Wm=Le,Ae=null);break;case"focusout":Ae=Wm=Xa=null;break;case"mousedown":Gm=!0;break;case"contextmenu":case"mouseup":case"dragend":Gm=!1,Ev($e,_,Ze);break;case"selectionchange":if(Bm)break;case"keydown":case"keyup":Ev($e,_,Ze)}var kt;if(Lm)e:{switch(a){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else jl?uv(a,_)&&(Vt="onCompositionEnd"):a==="keydown"&&_.keyCode===229&&(Vt="onCompositionStart");Vt&&(Zh&&_.locale!=="ko"&&(jl||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&jl&&(kt=rv()):(za=Ze,$r="value"in za?za.value:za.textContent,jl=!0)),Dt=Tu(Le,Vt),0<Dt.length&&(Vt=new sv(Vt,a,null,_,Ze),$e.push({event:Vt,listeners:Dt}),kt?Vt.data=kt:(kt=Qi(_),kt!==null&&(Vt.data=kt)))),(kt=cv?aC(a,_):cC(a,_))&&(Le=Tu(Le,"onBeforeInput"),0<Le.length&&(Ze=new sv("onBeforeInput","beforeinput",null,_,Ze),$e.push({event:Ze,listeners:Le}),Ze.data=kt))}Cv($e,d)})}function yu(a,d,_){return{instance:a,listener:d,currentTarget:_}}function Tu(a,d){for(var _=d+"Capture",T=[];a!==null;){var I=a,L=I.stateNode;I.tag===5&&L!==null&&(I=L,L=Bn(a,_),L!=null&&T.unshift(yu(a,L,I)),L=Bn(a,d),L!=null&&T.push(yu(a,L,I))),a=a.return}return T}function Kl(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function wv(a,d,_,T,I){for(var L=d._reactName,q=[];_!==null&&_!==T;){var oe=_,me=oe.alternate,Le=oe.stateNode;if(me!==null&&me===T)break;oe.tag===5&&Le!==null&&(oe=Le,I?(me=Bn(_,L),me!=null&&q.unshift(yu(_,me,oe))):I||(me=Bn(_,L),me!=null&&q.push(yu(_,me,oe)))),_=_.return}q.length!==0&&a.push({event:d,listeners:q})}var vC=/\r\n?/g,zm=/\u0000|\uFFFD/g;function bv(a){return(typeof a=="string"?a:""+a).replace(vC,`
`).replace(zm,"")}function Cu(a,d,_){if(d=bv(d),bv(a)!==d&&_)throw Error(f(425))}function Ru(){}var Ym=null,sp=null;function zl(a,d){return a==="textarea"||a==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var qm=typeof setTimeout=="function"?setTimeout:void 0,SC=typeof clearTimeout=="function"?clearTimeout:void 0,Iv=typeof Promise=="function"?Promise:void 0,yC=typeof queueMicrotask=="function"?queueMicrotask:typeof Iv<"u"?function(a){return Iv.resolve(null).then(a).catch(TC)}:qm;function TC(a){setTimeout(function(){throw a})}function op(a,d){var _=d,T=0;do{var I=_.nextSibling;if(a.removeChild(_),I&&I.nodeType===8)if(_=I.data,_==="/$"){if(T===0){a.removeChild(I),Ll(d);return}T--}else _!=="$"&&_!=="$?"&&_!=="$!"||T++;_=I}while(_);Ll(d)}function So(a){for(;a!=null;a=a.nextSibling){var d=a.nodeType;if(d===1||d===3)break;if(d===8){if(d=a.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return a}function Av(a){a=a.previousSibling;for(var d=0;a;){if(a.nodeType===8){var _=a.data;if(_==="$"||_==="$!"||_==="$?"){if(d===0)return a;d--}else _==="/$"&&d++}a=a.previousSibling}return null}var Ja=Math.random().toString(36).slice(2),yo="__reactFiber$"+Ja,wu="__reactProps$"+Ja,Qo="__reactContainer$"+Ja,Xm="__reactEvents$"+Ja,CC="__reactListeners$"+Ja,RC="__reactHandles$"+Ja;function Hc(a){var d=a[yo];if(d)return d;for(var _=a.parentNode;_;){if(d=_[Qo]||_[yo]){if(_=d.alternate,d.child!==null||_!==null&&_.child!==null)for(a=Av(a);a!==null;){if(_=a[yo])return _;a=Av(a)}return d}a=_,_=a.parentNode}return null}function bu(a){return a=a[yo]||a[Qo],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Yl(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(f(33))}function ap(a){return a[wu]||null}var Jm=[],Zo=-1;function Gs(a){return{current:a}}function Wn(a){0>Zo||(a.current=Jm[Zo],Jm[Zo]=null,Zo--)}function Yn(a,d){Zo++,Jm[Zo]=a.current,a.current=d}var Qa={},di=Gs(Qa),Ri=Gs(!1),Za=Qa;function $a(a,d){var _=a.type.contextTypes;if(!_)return Qa;var T=a.stateNode;if(T&&T.__reactInternalMemoizedUnmaskedChildContext===d)return T.__reactInternalMemoizedMaskedChildContext;var I={},L;for(L in _)I[L]=d[L];return T&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=d,a.__reactInternalMemoizedMaskedChildContext=I),I}function Vi(a){return a=a.childContextTypes,a!=null}function cp(){Wn(Ri),Wn(di)}function ql(a,d,_){if(di.current!==Qa)throw Error(f(168));Yn(di,d),Yn(Ri,_)}function Ov(a,d,_){var T=a.stateNode;if(d=d.childContextTypes,typeof T.getChildContext!="function")return _;T=T.getChildContext();for(var I in T)if(!(I in d))throw Error(f(108,yt(a)||"Unknown",I));return ze({},_,T)}function lp(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Qa,Za=di.current,Yn(di,a),Yn(Ri,Ri.current),!0}function Nv(a,d,_){var T=a.stateNode;if(!T)throw Error(f(169));_?(a=Ov(a,d,Za),T.__reactInternalMemoizedMergedChildContext=a,Wn(Ri),Wn(di),Yn(di,a)):Wn(Ri),Yn(Ri,_)}var $o=null,dp=!1,Qm=!1;function Zm(a){$o===null?$o=[a]:$o.push(a)}function wC(a){dp=!0,Zm(a)}function ec(){if(!Qm&&$o!==null){Qm=!0;var a=0,d=On;try{var _=$o;for(On=1;a<_.length;a++){var T=_[a];do T=T(!0);while(T!==null)}$o=null,dp=!1}catch(I){throw $o!==null&&($o=$o.slice(a+1)),Bc(fr,ec),I}finally{On=d,Qm=!1}}return null}var Xl=[],tc=0,up=null,hp=0,wi=[],fs=0,Kc=null,ea=1,ta="";function zc(a,d){Xl[tc++]=hp,Xl[tc++]=up,up=a,hp=d}function Pv(a,d,_){wi[fs++]=ea,wi[fs++]=ta,wi[fs++]=Kc,Kc=a;var T=ea;a=ta;var I=32-Fs(T)-1;T&=~(1<<I),_+=1;var L=32-Fs(d)+I;if(30<L){var q=I-I%5;L=(T&(1<<q)-1).toString(32),T>>=q,I-=q,ea=1<<32-Fs(d)+I|_<<I|T,ta=L+a}else ea=1<<L|_<<I|T,ta=a}function Jl(a){a.return!==null&&(zc(a,1),Pv(a,1,0))}function pp(a){for(;a===up;)up=Xl[--tc],Xl[tc]=null,hp=Xl[--tc],Xl[tc]=null;for(;a===Kc;)Kc=wi[--fs],wi[fs]=null,ta=wi[--fs],wi[fs]=null,ea=wi[--fs],wi[fs]=null}var Zi=null,$i=null,Zn=!1,Hs=null;function Dv(a,d){var _=vs(5,null,null,0);_.elementType="DELETED",_.stateNode=d,_.return=a,d=a.deletions,d===null?(a.deletions=[_],a.flags|=16):d.push(_)}function kv(a,d){switch(a.tag){case 5:var _=a.type;return d=d.nodeType!==1||_.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(a.stateNode=d,Zi=a,$i=So(d.firstChild),!0):!1;case 6:return d=a.pendingProps===""||d.nodeType!==3?null:d,d!==null?(a.stateNode=d,Zi=a,$i=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(_=Kc!==null?{id:ea,overflow:ta}:null,a.memoizedState={dehydrated:d,treeContext:_,retryLane:1073741824},_=vs(18,null,null,0),_.stateNode=d,_.return=a,a.child=_,Zi=a,$i=null,!0):!1;default:return!1}}function Iu(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Au(a){if(Zn){var d=$i;if(d){var _=d;if(!kv(a,d)){if(Iu(a))throw Error(f(418));d=So(_.nextSibling);var T=Zi;d&&kv(a,d)?Dv(T,_):(a.flags=a.flags&-4097|2,Zn=!1,Zi=a)}}else{if(Iu(a))throw Error(f(418));a.flags=a.flags&-4097|2,Zn=!1,Zi=a}}}function $m(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Zi=a}function Ql(a){if(a!==Zi)return!1;if(!Zn)return $m(a),Zn=!0,!1;var d;if((d=a.tag!==3)&&!(d=a.tag!==5)&&(d=a.type,d=d!=="head"&&d!=="body"&&!zl(a.type,a.memoizedProps)),d&&(d=$i)){if(Iu(a))throw e_(),Error(f(418));for(;d;)Dv(a,d),d=So(d.nextSibling)}if($m(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(f(317));e:{for(a=a.nextSibling,d=0;a;){if(a.nodeType===8){var _=a.data;if(_==="/$"){if(d===0){$i=So(a.nextSibling);break e}d--}else _!=="$"&&_!=="$!"&&_!=="$?"||d++}a=a.nextSibling}$i=null}}else $i=Zi?So(a.stateNode.nextSibling):null;return!0}function e_(){for(var a=$i;a;)a=So(a.nextSibling)}function Yc(){$i=Zi=null,Zn=!1}function Zl(a){Hs===null?Hs=[a]:Hs.push(a)}var Ou=ne.ReactCurrentBatchConfig;function Nu(a,d,_){if(a=_.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(f(309));var T=_.stateNode}if(!T)throw Error(f(147,a));var I=T,L=""+a;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===L?d.ref:(d=function(q){var oe=I.refs;q===null?delete oe[L]:oe[L]=q},d._stringRef=L,d)}if(typeof a!="string")throw Error(f(284));if(!_._owner)throw Error(f(290,a))}return a}function fp(a,d){throw a=Object.prototype.toString.call(d),Error(f(31,a==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":a))}function t_(a){var d=a._init;return d(a._payload)}function Lv(a){function d(Ce,ge){if(a){var Oe=Ce.deletions;Oe===null?(Ce.deletions=[ge],Ce.flags|=16):Oe.push(ge)}}function _(Ce,ge){if(!a)return null;for(;ge!==null;)d(Ce,ge),ge=ge.sibling;return null}function T(Ce,ge){for(Ce=new Map;ge!==null;)ge.key!==null?Ce.set(ge.key,ge):Ce.set(ge.index,ge),ge=ge.sibling;return Ce}function I(Ce,ge){return Ce=pc(Ce,ge),Ce.index=0,Ce.sibling=null,Ce}function L(Ce,ge,Oe){return Ce.index=Oe,a?(Oe=Ce.alternate,Oe!==null?(Oe=Oe.index,Oe<ge?(Ce.flags|=2,ge):Oe):(Ce.flags|=2,ge)):(Ce.flags|=1048576,ge)}function q(Ce){return a&&Ce.alternate===null&&(Ce.flags|=2),Ce}function oe(Ce,ge,Oe,nt){return ge===null||ge.tag!==6?(ge=Hp(Oe,Ce.mode,nt),ge.return=Ce,ge):(ge=I(ge,Oe),ge.return=Ce,ge)}function me(Ce,ge,Oe,nt){var wt=Oe.type;return wt===ue?Ze(Ce,ge,Oe.props.children,nt,Oe.key):ge!==null&&(ge.elementType===wt||typeof wt=="object"&&wt!==null&&wt.$$typeof===Xe&&t_(wt)===ge.type)?(nt=I(ge,Oe.props),nt.ref=Nu(Ce,ge,Oe),nt.return=Ce,nt):(nt=dd(Oe.type,Oe.key,Oe.props,null,Ce.mode,nt),nt.ref=Nu(Ce,ge,Oe),nt.return=Ce,nt)}function Le(Ce,ge,Oe,nt){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Oe.containerInfo||ge.stateNode.implementation!==Oe.implementation?(ge=ud(Oe,Ce.mode,nt),ge.return=Ce,ge):(ge=I(ge,Oe.children||[]),ge.return=Ce,ge)}function Ze(Ce,ge,Oe,nt,wt){return ge===null||ge.tag!==7?(ge=fc(Oe,Ce.mode,nt,wt),ge.return=Ce,ge):(ge=I(ge,Oe),ge.return=Ce,ge)}function $e(Ce,ge,Oe){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=Hp(""+ge,Ce.mode,Oe),ge.return=Ce,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case de:return Oe=dd(ge.type,ge.key,ge.props,null,Ce.mode,Oe),Oe.ref=Nu(Ce,null,ge),Oe.return=Ce,Oe;case Pe:return ge=ud(ge,Ce.mode,Oe),ge.return=Ce,ge;case Xe:var nt=ge._init;return $e(Ce,nt(ge._payload),Oe)}if(po(ge)||De(ge))return ge=fc(ge,Ce.mode,Oe,null),ge.return=Ce,ge;fp(Ce,ge)}return null}function Qe(Ce,ge,Oe,nt){var wt=ge!==null?ge.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return wt!==null?null:oe(Ce,ge,""+Oe,nt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case de:return Oe.key===wt?me(Ce,ge,Oe,nt):null;case Pe:return Oe.key===wt?Le(Ce,ge,Oe,nt):null;case Xe:return wt=Oe._init,Qe(Ce,ge,wt(Oe._payload),nt)}if(po(Oe)||De(Oe))return wt!==null?null:Ze(Ce,ge,Oe,nt,null);fp(Ce,Oe)}return null}function _t(Ce,ge,Oe,nt,wt){if(typeof nt=="string"&&nt!==""||typeof nt=="number")return Ce=Ce.get(Oe)||null,oe(ge,Ce,""+nt,wt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case de:return Ce=Ce.get(nt.key===null?Oe:nt.key)||null,me(ge,Ce,nt,wt);case Pe:return Ce=Ce.get(nt.key===null?Oe:nt.key)||null,Le(ge,Ce,nt,wt);case Xe:var Dt=nt._init;return _t(Ce,ge,Oe,Dt(nt._payload),wt)}if(po(nt)||De(nt))return Ce=Ce.get(Oe)||null,Ze(ge,Ce,nt,wt,null);fp(ge,nt)}return null}function Tt(Ce,ge,Oe,nt){for(var wt=null,Dt=null,kt=ge,Vt=ge=0,Vr=null;kt!==null&&Vt<Oe.length;Vt++){kt.index>Vt?(Vr=kt,kt=null):Vr=kt.sibling;var wn=Qe(Ce,kt,Oe[Vt],nt);if(wn===null){kt===null&&(kt=Vr);break}a&&kt&&wn.alternate===null&&d(Ce,kt),ge=L(wn,ge,Vt),Dt===null?wt=wn:Dt.sibling=wn,Dt=wn,kt=Vr}if(Vt===Oe.length)return _(Ce,kt),Zn&&zc(Ce,Vt),wt;if(kt===null){for(;Vt<Oe.length;Vt++)kt=$e(Ce,Oe[Vt],nt),kt!==null&&(ge=L(kt,ge,Vt),Dt===null?wt=kt:Dt.sibling=kt,Dt=kt);return Zn&&zc(Ce,Vt),wt}for(kt=T(Ce,kt);Vt<Oe.length;Vt++)Vr=_t(kt,Ce,Vt,Oe[Vt],nt),Vr!==null&&(a&&Vr.alternate!==null&&kt.delete(Vr.key===null?Vt:Vr.key),ge=L(Vr,ge,Vt),Dt===null?wt=Vr:Dt.sibling=Vr,Dt=Vr);return a&&kt.forEach(function(Io){return d(Ce,Io)}),Zn&&zc(Ce,Vt),wt}function Rt(Ce,ge,Oe,nt){var wt=De(Oe);if(typeof wt!="function")throw Error(f(150));if(Oe=wt.call(Oe),Oe==null)throw Error(f(151));for(var Dt=wt=null,kt=ge,Vt=ge=0,Vr=null,wn=Oe.next();kt!==null&&!wn.done;Vt++,wn=Oe.next()){kt.index>Vt?(Vr=kt,kt=null):Vr=kt.sibling;var Io=Qe(Ce,kt,wn.value,nt);if(Io===null){kt===null&&(kt=Vr);break}a&&kt&&Io.alternate===null&&d(Ce,kt),ge=L(Io,ge,Vt),Dt===null?wt=Io:Dt.sibling=Io,Dt=Io,kt=Vr}if(wn.done)return _(Ce,kt),Zn&&zc(Ce,Vt),wt;if(kt===null){for(;!wn.done;Vt++,wn=Oe.next())wn=$e(Ce,wn.value,nt),wn!==null&&(ge=L(wn,ge,Vt),Dt===null?wt=wn:Dt.sibling=wn,Dt=wn);return Zn&&zc(Ce,Vt),wt}for(kt=T(Ce,kt);!wn.done;Vt++,wn=Oe.next())wn=_t(kt,Ce,Vt,wn.value,nt),wn!==null&&(a&&wn.alternate!==null&&kt.delete(wn.key===null?Vt:wn.key),ge=L(wn,ge,Vt),Dt===null?wt=wn:Dt.sibling=wn,Dt=wn);return a&&kt.forEach(function(WC){return d(Ce,WC)}),Zn&&zc(Ce,Vt),wt}function lr(Ce,ge,Oe,nt){if(typeof Oe=="object"&&Oe!==null&&Oe.type===ue&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case de:e:{for(var wt=Oe.key,Dt=ge;Dt!==null;){if(Dt.key===wt){if(wt=Oe.type,wt===ue){if(Dt.tag===7){_(Ce,Dt.sibling),ge=I(Dt,Oe.props.children),ge.return=Ce,Ce=ge;break e}}else if(Dt.elementType===wt||typeof wt=="object"&&wt!==null&&wt.$$typeof===Xe&&t_(wt)===Dt.type){_(Ce,Dt.sibling),ge=I(Dt,Oe.props),ge.ref=Nu(Ce,Dt,Oe),ge.return=Ce,Ce=ge;break e}_(Ce,Dt);break}else d(Ce,Dt);Dt=Dt.sibling}Oe.type===ue?(ge=fc(Oe.props.children,Ce.mode,nt,Oe.key),ge.return=Ce,Ce=ge):(nt=dd(Oe.type,Oe.key,Oe.props,null,Ce.mode,nt),nt.ref=Nu(Ce,ge,Oe),nt.return=Ce,Ce=nt)}return q(Ce);case Pe:e:{for(Dt=Oe.key;ge!==null;){if(ge.key===Dt)if(ge.tag===4&&ge.stateNode.containerInfo===Oe.containerInfo&&ge.stateNode.implementation===Oe.implementation){_(Ce,ge.sibling),ge=I(ge,Oe.children||[]),ge.return=Ce,Ce=ge;break e}else{_(Ce,ge);break}else d(Ce,ge);ge=ge.sibling}ge=ud(Oe,Ce.mode,nt),ge.return=Ce,Ce=ge}return q(Ce);case Xe:return Dt=Oe._init,lr(Ce,ge,Dt(Oe._payload),nt)}if(po(Oe))return Tt(Ce,ge,Oe,nt);if(De(Oe))return Rt(Ce,ge,Oe,nt);fp(Ce,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"?(Oe=""+Oe,ge!==null&&ge.tag===6?(_(Ce,ge.sibling),ge=I(ge,Oe),ge.return=Ce,Ce=ge):(_(Ce,ge),ge=Hp(Oe,Ce.mode,nt),ge.return=Ce,Ce=ge),q(Ce)):_(Ce,ge)}return lr}var $l=Lv(!0),n_=Lv(!1),mp=Gs(null),_p=null,ed=null,r_=null;function i_(){r_=ed=_p=null}function s_(a){var d=mp.current;Wn(mp),a._currentValue=d}function gp(a,d,_){for(;a!==null;){var T=a.alternate;if((a.childLanes&d)!==d?(a.childLanes|=d,T!==null&&(T.childLanes|=d)):T!==null&&(T.childLanes&d)!==d&&(T.childLanes|=d),a===_)break;a=a.return}}function Ks(a,d){_p=a,r_=ed=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&d)!==0&&(Fi=!0),a.firstContext=null)}function ms(a){var d=a._currentValue;if(r_!==a)if(a={context:a,memoizedValue:d,next:null},ed===null){if(_p===null)throw Error(f(308));ed=a,_p.dependencies={lanes:0,firstContext:a}}else ed=ed.next=a;return d}var qc=null;function o_(a){qc===null?qc=[a]:qc.push(a)}function a_(a,d,_,T){var I=d.interleaved;return I===null?(_.next=_,o_(d)):(_.next=I.next,I.next=_),d.interleaved=_,na(a,T)}function na(a,d){a.lanes|=d;var _=a.alternate;for(_!==null&&(_.lanes|=d),_=a,a=a.return;a!==null;)a.childLanes|=d,_=a.alternate,_!==null&&(_.childLanes|=d),_=a,a=a.return;return _.tag===3?_.stateNode:null}var ra=!1;function c_(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xv(a,d){a=a.updateQueue,d.updateQueue===a&&(d.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function ia(a,d){return{eventTime:a,lane:d,tag:0,payload:null,callback:null,next:null}}function zs(a,d,_){var T=a.updateQueue;if(T===null)return null;if(T=T.shared,(ln&2)!==0){var I=T.pending;return I===null?d.next=d:(d.next=I.next,I.next=d),T.pending=d,na(a,_)}return I=T.interleaved,I===null?(d.next=d,o_(T)):(d.next=I.next,I.next=d),T.interleaved=d,na(a,_)}function Ep(a,d,_){if(d=d.updateQueue,d!==null&&(d=d.shared,(_&4194240)!==0)){var T=d.lanes;T&=a.pendingLanes,_|=T,d.lanes=_,Sm(a,_)}}function Mv(a,d){var _=a.updateQueue,T=a.alternate;if(T!==null&&(T=T.updateQueue,_===T)){var I=null,L=null;if(_=_.firstBaseUpdate,_!==null){do{var q={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};L===null?I=L=q:L=L.next=q,_=_.next}while(_!==null);L===null?I=L=d:L=L.next=d}else I=L=d;_={baseState:T.baseState,firstBaseUpdate:I,lastBaseUpdate:L,shared:T.shared,effects:T.effects},a.updateQueue=_;return}a=_.lastBaseUpdate,a===null?_.firstBaseUpdate=d:a.next=d,_.lastBaseUpdate=d}function vp(a,d,_,T){var I=a.updateQueue;ra=!1;var L=I.firstBaseUpdate,q=I.lastBaseUpdate,oe=I.shared.pending;if(oe!==null){I.shared.pending=null;var me=oe,Le=me.next;me.next=null,q===null?L=Le:q.next=Le,q=me;var Ze=a.alternate;Ze!==null&&(Ze=Ze.updateQueue,oe=Ze.lastBaseUpdate,oe!==q&&(oe===null?Ze.firstBaseUpdate=Le:oe.next=Le,Ze.lastBaseUpdate=me))}if(L!==null){var $e=I.baseState;q=0,Ze=Le=me=null,oe=L;do{var Qe=oe.lane,_t=oe.eventTime;if((T&Qe)===Qe){Ze!==null&&(Ze=Ze.next={eventTime:_t,lane:0,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null});e:{var Tt=a,Rt=oe;switch(Qe=d,_t=_,Rt.tag){case 1:if(Tt=Rt.payload,typeof Tt=="function"){$e=Tt.call(_t,$e,Qe);break e}$e=Tt;break e;case 3:Tt.flags=Tt.flags&-65537|128;case 0:if(Tt=Rt.payload,Qe=typeof Tt=="function"?Tt.call(_t,$e,Qe):Tt,Qe==null)break e;$e=ze({},$e,Qe);break e;case 2:ra=!0}}oe.callback!==null&&oe.lane!==0&&(a.flags|=64,Qe=I.effects,Qe===null?I.effects=[oe]:Qe.push(oe))}else _t={eventTime:_t,lane:Qe,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},Ze===null?(Le=Ze=_t,me=$e):Ze=Ze.next=_t,q|=Qe;if(oe=oe.next,oe===null){if(oe=I.shared.pending,oe===null)break;Qe=oe,oe=Qe.next,Qe.next=null,I.lastBaseUpdate=Qe,I.shared.pending=null}}while(!0);if(Ze===null&&(me=$e),I.baseState=me,I.firstBaseUpdate=Le,I.lastBaseUpdate=Ze,d=I.shared.interleaved,d!==null){I=d;do q|=I.lane,I=I.next;while(I!==d)}else L===null&&(I.shared.lanes=0);nl|=q,a.lanes=q,a.memoizedState=$e}}function Uv(a,d,_){if(a=d.effects,d.effects=null,a!==null)for(d=0;d<a.length;d++){var T=a[d],I=T.callback;if(I!==null){if(T.callback=null,T=_,typeof I!="function")throw Error(f(191,I));I.call(T)}}}var Pu={},To=Gs(Pu),Xc=Gs(Pu),Du=Gs(Pu);function nc(a){if(a===Pu)throw Error(f(174));return a}function l_(a,d){switch(Yn(Du,d),Yn(Xc,a),Yn(To,Pu),a=d.nodeType,a){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:zr(null,"");break;default:a=a===8?d.parentNode:d,d=a.namespaceURI||null,a=a.tagName,d=zr(d,a)}Wn(To),Yn(To,d)}function Jc(){Wn(To),Wn(Xc),Wn(Du)}function Vv(a){nc(Du.current);var d=nc(To.current),_=zr(d,a.type);d!==_&&(Yn(Xc,a),Yn(To,_))}function d_(a){Xc.current===a&&(Wn(To),Wn(Xc))}var ar=Gs(0);function Sp(a){for(var d=a;d!==null;){if(d.tag===13){var _=d.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var u_=[];function h_(){for(var a=0;a<u_.length;a++)u_[a]._workInProgressVersionPrimary=null;u_.length=0}var ku=ne.ReactCurrentDispatcher,p_=ne.ReactCurrentBatchConfig,Qc=0,rr=null,xr=null,Sr=null,Lu=!1,sa=!1,xu=0,bC=0;function ui(){throw Error(f(321))}function f_(a,d){if(d===null)return!1;for(var _=0;_<d.length&&_<a.length;_++)if(!Bs(a[_],d[_]))return!1;return!0}function td(a,d,_,T,I,L){if(Qc=L,rr=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,ku.current=a===null||a.memoizedState===null?AC:Yv,a=_(T,I),sa){L=0;do{if(sa=!1,xu=0,25<=L)throw Error(f(301));L+=1,Sr=xr=null,d.updateQueue=null,ku.current=OC,a=_(T,I)}while(sa)}if(ku.current=rd,d=xr!==null&&xr.next!==null,Qc=0,Sr=xr=rr=null,Lu=!1,d)throw Error(f(300));return a}function m_(){var a=xu!==0;return xu=0,a}function Ys(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Sr===null?rr.memoizedState=Sr=a:Sr=Sr.next=a,Sr}function ji(){if(xr===null){var a=rr.alternate;a=a!==null?a.memoizedState:null}else a=xr.next;var d=Sr===null?rr.memoizedState:Sr.next;if(d!==null)Sr=d,xr=a;else{if(a===null)throw Error(f(310));xr=a,a={memoizedState:xr.memoizedState,baseState:xr.baseState,baseQueue:xr.baseQueue,queue:xr.queue,next:null},Sr===null?rr.memoizedState=Sr=a:Sr=Sr.next=a}return Sr}function Zc(a,d){return typeof d=="function"?d(a):d}function __(a){var d=ji(),_=d.queue;if(_===null)throw Error(f(311));_.lastRenderedReducer=a;var T=xr,I=T.baseQueue,L=_.pending;if(L!==null){if(I!==null){var q=I.next;I.next=L.next,L.next=q}T.baseQueue=I=L,_.pending=null}if(I!==null){L=I.next,T=T.baseState;var oe=q=null,me=null,Le=L;do{var Ze=Le.lane;if((Qc&Ze)===Ze)me!==null&&(me=me.next={lane:0,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null}),T=Le.hasEagerState?Le.eagerState:a(T,Le.action);else{var $e={lane:Ze,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null};me===null?(oe=me=$e,q=T):me=me.next=$e,rr.lanes|=Ze,nl|=Ze}Le=Le.next}while(Le!==null&&Le!==L);me===null?q=T:me.next=oe,Bs(T,d.memoizedState)||(Fi=!0),d.memoizedState=T,d.baseState=q,d.baseQueue=me,_.lastRenderedState=T}if(a=_.interleaved,a!==null){I=a;do L=I.lane,rr.lanes|=L,nl|=L,I=I.next;while(I!==a)}else I===null&&(_.lanes=0);return[d.memoizedState,_.dispatch]}function g_(a){var d=ji(),_=d.queue;if(_===null)throw Error(f(311));_.lastRenderedReducer=a;var T=_.dispatch,I=_.pending,L=d.memoizedState;if(I!==null){_.pending=null;var q=I=I.next;do L=a(L,q.action),q=q.next;while(q!==I);Bs(L,d.memoizedState)||(Fi=!0),d.memoizedState=L,d.baseQueue===null&&(d.baseState=L),_.lastRenderedState=L}return[L,T]}function jv(){}function Fv(a,d){var _=rr,T=ji(),I=d(),L=!Bs(T.memoizedState,I);if(L&&(T.memoizedState=I,Fi=!0),T=T.queue,Cp(Wv.bind(null,_,T,a),[a]),T.getSnapshot!==d||L||Sr!==null&&Sr.memoizedState.tag&1){if(_.flags|=2048,oa(9,Mu.bind(null,_,T,I,d),void 0,null),Mr===null)throw Error(f(349));(Qc&30)!==0||Bv(_,d,I)}return I}function Bv(a,d,_){a.flags|=16384,a={getSnapshot:d,value:_},d=rr.updateQueue,d===null?(d={lastEffect:null,stores:null},rr.updateQueue=d,d.stores=[a]):(_=d.stores,_===null?d.stores=[a]:_.push(a))}function Mu(a,d,_,T){d.value=_,d.getSnapshot=T,$c(d)&&yp(a)}function Wv(a,d,_){return _(function(){$c(d)&&yp(a)})}function $c(a){var d=a.getSnapshot;a=a.value;try{var _=d();return!Bs(a,_)}catch{return!0}}function yp(a){var d=na(a,1);d!==null&&ns(d,a,1,-1)}function Uu(a){var d=Ys();return typeof a=="function"&&(a=a()),d.memoizedState=d.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zc,lastRenderedState:a},d.queue=a,a=a.dispatch=el.bind(null,rr,a),[d.memoizedState,a]}function oa(a,d,_,T){return a={tag:a,create:d,destroy:_,deps:T,next:null},d=rr.updateQueue,d===null?(d={lastEffect:null,stores:null},rr.updateQueue=d,d.lastEffect=a.next=a):(_=d.lastEffect,_===null?d.lastEffect=a.next=a:(T=_.next,_.next=a,a.next=T,d.lastEffect=a)),a}function Vu(){return ji().memoizedState}function Tp(a,d,_,T){var I=Ys();rr.flags|=a,I.memoizedState=oa(1|d,_,void 0,T===void 0?null:T)}function ju(a,d,_,T){var I=ji();T=T===void 0?null:T;var L=void 0;if(xr!==null){var q=xr.memoizedState;if(L=q.destroy,T!==null&&f_(T,q.deps)){I.memoizedState=oa(d,_,L,T);return}}rr.flags|=a,I.memoizedState=oa(1|d,_,L,T)}function Gv(a,d){return Tp(8390656,8,a,d)}function Cp(a,d){return ju(2048,8,a,d)}function Hv(a,d){return ju(4,2,a,d)}function Kv(a,d){return ju(4,4,a,d)}function Rp(a,d){if(typeof d=="function")return a=a(),d(a),function(){d(null)};if(d!=null)return a=a(),d.current=a,function(){d.current=null}}function wp(a,d,_){return _=_!=null?_.concat([a]):null,ju(4,4,Rp.bind(null,d,a),_)}function E_(){}function zv(a,d){var _=ji();d=d===void 0?null:d;var T=_.memoizedState;return T!==null&&d!==null&&f_(d,T[1])?T[0]:(_.memoizedState=[a,d],a)}function v_(a,d){var _=ji();d=d===void 0?null:d;var T=_.memoizedState;return T!==null&&d!==null&&f_(d,T[1])?T[0]:(a=a(),_.memoizedState=[a,d],a)}function bp(a,d,_){return(Qc&21)===0?(a.baseState&&(a.baseState=!1,Fi=!0),a.memoizedState=_):(Bs(_,d)||(_=QE(),rr.lanes|=_,nl|=_,a.baseState=!0),d)}function IC(a,d){var _=On;On=_!==0&&4>_?_:4,a(!0);var T=p_.transition;p_.transition={};try{a(!1),d()}finally{On=_,p_.transition=T}}function qs(){return ji().memoizedState}function nd(a,d,_){var T=lc(a);if(_={lane:T,action:_,hasEagerState:!1,eagerState:null,next:null},S_(a))y_(d,_);else if(_=a_(a,d,_,T),_!==null){var I=Ii();ns(_,a,T,I),rc(_,d,T)}}function el(a,d,_){var T=lc(a),I={lane:T,action:_,hasEagerState:!1,eagerState:null,next:null};if(S_(a))y_(d,I);else{var L=a.alternate;if(a.lanes===0&&(L===null||L.lanes===0)&&(L=d.lastRenderedReducer,L!==null))try{var q=d.lastRenderedState,oe=L(q,_);if(I.hasEagerState=!0,I.eagerState=oe,Bs(oe,q)){var me=d.interleaved;me===null?(I.next=I,o_(d)):(I.next=me.next,me.next=I),d.interleaved=I;return}}catch{}finally{}_=a_(a,d,I,T),_!==null&&(I=Ii(),ns(_,a,T,I),rc(_,d,T))}}function S_(a){var d=a.alternate;return a===rr||d!==null&&d===rr}function y_(a,d){sa=Lu=!0;var _=a.pending;_===null?d.next=d:(d.next=_.next,_.next=d),a.pending=d}function rc(a,d,_){if((_&4194240)!==0){var T=d.lanes;T&=a.pendingLanes,_|=T,d.lanes=_,Sm(a,_)}}var rd={readContext:ms,useCallback:ui,useContext:ui,useEffect:ui,useImperativeHandle:ui,useInsertionEffect:ui,useLayoutEffect:ui,useMemo:ui,useReducer:ui,useRef:ui,useState:ui,useDebugValue:ui,useDeferredValue:ui,useTransition:ui,useMutableSource:ui,useSyncExternalStore:ui,useId:ui,unstable_isNewReconciler:!1},AC={readContext:ms,useCallback:function(a,d){return Ys().memoizedState=[a,d===void 0?null:d],a},useContext:ms,useEffect:Gv,useImperativeHandle:function(a,d,_){return _=_!=null?_.concat([a]):null,Tp(4194308,4,Rp.bind(null,d,a),_)},useLayoutEffect:function(a,d){return Tp(4194308,4,a,d)},useInsertionEffect:function(a,d){return Tp(4,2,a,d)},useMemo:function(a,d){var _=Ys();return d=d===void 0?null:d,a=a(),_.memoizedState=[a,d],a},useReducer:function(a,d,_){var T=Ys();return d=_!==void 0?_(d):d,T.memoizedState=T.baseState=d,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:d},T.queue=a,a=a.dispatch=nd.bind(null,rr,a),[T.memoizedState,a]},useRef:function(a){var d=Ys();return a={current:a},d.memoizedState=a},useState:Uu,useDebugValue:E_,useDeferredValue:function(a){return Ys().memoizedState=a},useTransition:function(){var a=Uu(!1),d=a[0];return a=IC.bind(null,a[1]),Ys().memoizedState=a,[d,a]},useMutableSource:function(){},useSyncExternalStore:function(a,d,_){var T=rr,I=Ys();if(Zn){if(_===void 0)throw Error(f(407));_=_()}else{if(_=d(),Mr===null)throw Error(f(349));(Qc&30)!==0||Bv(T,d,_)}I.memoizedState=_;var L={value:_,getSnapshot:d};return I.queue=L,Gv(Wv.bind(null,T,L,a),[a]),T.flags|=2048,oa(9,Mu.bind(null,T,L,_,d),void 0,null),_},useId:function(){var a=Ys(),d=Mr.identifierPrefix;if(Zn){var _=ta,T=ea;_=(T&~(1<<32-Fs(T)-1)).toString(32)+_,d=":"+d+"R"+_,_=xu++,0<_&&(d+="H"+_.toString(32)),d+=":"}else _=bC++,d=":"+d+"r"+_.toString(32)+":";return a.memoizedState=d},unstable_isNewReconciler:!1},Yv={readContext:ms,useCallback:zv,useContext:ms,useEffect:Cp,useImperativeHandle:wp,useInsertionEffect:Hv,useLayoutEffect:Kv,useMemo:v_,useReducer:__,useRef:Vu,useState:function(){return __(Zc)},useDebugValue:E_,useDeferredValue:function(a){var d=ji();return bp(d,xr.memoizedState,a)},useTransition:function(){var a=__(Zc)[0],d=ji().memoizedState;return[a,d]},useMutableSource:jv,useSyncExternalStore:Fv,useId:qs,unstable_isNewReconciler:!1},OC={readContext:ms,useCallback:zv,useContext:ms,useEffect:Cp,useImperativeHandle:wp,useInsertionEffect:Hv,useLayoutEffect:Kv,useMemo:v_,useReducer:g_,useRef:Vu,useState:function(){return g_(Zc)},useDebugValue:E_,useDeferredValue:function(a){var d=ji();return xr===null?d.memoizedState=a:bp(d,xr.memoizedState,a)},useTransition:function(){var a=g_(Zc)[0],d=ji().memoizedState;return[a,d]},useMutableSource:jv,useSyncExternalStore:Fv,useId:qs,unstable_isNewReconciler:!1};function _s(a,d){if(a&&a.defaultProps){d=ze({},d),a=a.defaultProps;for(var _ in a)d[_]===void 0&&(d[_]=a[_]);return d}return d}function Ip(a,d,_,T){d=a.memoizedState,_=_(T,d),_=_==null?d:ze({},d,_),a.memoizedState=_,a.lanes===0&&(a.updateQueue.baseState=_)}var Ap={isMounted:function(a){return(a=a._reactInternals)?Fc(a)===a:!1},enqueueSetState:function(a,d,_){a=a._reactInternals;var T=Ii(),I=lc(a),L=ia(T,I);L.payload=d,_!=null&&(L.callback=_),d=zs(a,L,I),d!==null&&(ns(d,a,I,T),Ep(d,a,I))},enqueueReplaceState:function(a,d,_){a=a._reactInternals;var T=Ii(),I=lc(a),L=ia(T,I);L.tag=1,L.payload=d,_!=null&&(L.callback=_),d=zs(a,L,I),d!==null&&(ns(d,a,I,T),Ep(d,a,I))},enqueueForceUpdate:function(a,d){a=a._reactInternals;var _=Ii(),T=lc(a),I=ia(_,T);I.tag=2,d!=null&&(I.callback=d),d=zs(a,I,T),d!==null&&(ns(d,a,T,_),Ep(d,a,T))}};function aa(a,d,_,T,I,L,q){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(T,L,q):d.prototype&&d.prototype.isPureReactComponent?!Bl(_,T)||!Bl(I,L):!0}function qv(a,d,_){var T=!1,I=Qa,L=d.contextType;return typeof L=="object"&&L!==null?L=ms(L):(I=Vi(d)?Za:di.current,T=d.contextTypes,L=(T=T!=null)?$a(a,I):Qa),d=new d(_,L),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ap,a.stateNode=d,d._reactInternals=a,T&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=I,a.__reactInternalMemoizedMaskedChildContext=L),d}function Xv(a,d,_,T){a=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(_,T),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(_,T),d.state!==a&&Ap.enqueueReplaceState(d,d.state,null)}function T_(a,d,_,T){var I=a.stateNode;I.props=_,I.state=a.memoizedState,I.refs={},c_(a);var L=d.contextType;typeof L=="object"&&L!==null?I.context=ms(L):(L=Vi(d)?Za:di.current,I.context=$a(a,L)),I.state=a.memoizedState,L=d.getDerivedStateFromProps,typeof L=="function"&&(Ip(a,d,L,_),I.state=a.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(d=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),d!==I.state&&Ap.enqueueReplaceState(I,I.state,null),vp(a,_,I,T),I.state=a.memoizedState),typeof I.componentDidMount=="function"&&(a.flags|=4194308)}function id(a,d){try{var _="",T=d;do _+=Ot(T),T=T.return;while(T);var I=_}catch(L){I=`
Error generating stack: `+L.message+`
`+L.stack}return{value:a,source:d,stack:I,digest:null}}function Op(a,d,_){return{value:a,source:null,stack:_??null,digest:d??null}}function C_(a,d){try{console.error(d.value)}catch(_){setTimeout(function(){throw _})}}var R_=typeof WeakMap=="function"?WeakMap:Map;function w_(a,d,_){_=ia(-1,_),_.tag=3,_.payload={element:null};var T=d.value;return _.callback=function(){pi||(pi=!0,H_=T),C_(a,d)},_}function Jv(a,d,_){_=ia(-1,_),_.tag=3;var T=a.type.getDerivedStateFromError;if(typeof T=="function"){var I=d.value;_.payload=function(){return T(I)},_.callback=function(){C_(a,d)}}var L=a.stateNode;return L!==null&&typeof L.componentDidCatch=="function"&&(_.callback=function(){C_(a,d),typeof T!="function"&&(ac===null?ac=new Set([this]):ac.add(this));var q=d.stack;this.componentDidCatch(d.value,{componentStack:q!==null?q:""})}),_}function b_(a,d,_){var T=a.pingCache;if(T===null){T=a.pingCache=new R_;var I=new Set;T.set(d,I)}else I=T.get(d),I===void 0&&(I=new Set,T.set(d,I));I.has(_)||(I.add(_),a=fS.bind(null,a,d,_),d.then(a,a))}function Qv(a){do{var d;if((d=a.tag===13)&&(d=a.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return a;a=a.return}while(a!==null);return null}function Zv(a,d,_,T,I){return(a.mode&1)===0?(a===d?a.flags|=65536:(a.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:(d=ia(-1,1),d.tag=2,zs(_,d,1))),_.lanes|=1),a):(a.flags|=65536,a.lanes=I,a)}var NC=ne.ReactCurrentOwner,Fi=!1;function bi(a,d,_,T){d.child=a===null?n_(d,null,_,T):$l(d,a.child,_,T)}function $v(a,d,_,T,I){_=_.render;var L=d.ref;return Ks(d,I),T=td(a,d,_,T,L,I),_=m_(),a!==null&&!Fi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~I,ca(a,d,I)):(Zn&&_&&Jl(d),d.flags|=1,bi(a,d,T,I),d.child)}function eS(a,d,_,T,I){if(a===null){var L=_.type;return typeof L=="function"&&!eg(L)&&L.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?(d.tag=15,d.type=L,I_(a,d,L,T,I)):(a=dd(_.type,null,T,d,d.mode,I),a.ref=d.ref,a.return=d,d.child=a)}if(L=a.child,(a.lanes&I)===0){var q=L.memoizedProps;if(_=_.compare,_=_!==null?_:Bl,_(q,T)&&a.ref===d.ref)return ca(a,d,I)}return d.flags|=1,a=pc(L,T),a.ref=d.ref,a.return=d,d.child=a}function I_(a,d,_,T,I){if(a!==null){var L=a.memoizedProps;if(Bl(L,T)&&a.ref===d.ref)if(Fi=!1,d.pendingProps=T=L,(a.lanes&I)!==0)(a.flags&131072)!==0&&(Fi=!0);else return d.lanes=a.lanes,ca(a,d,I)}return A_(a,d,_,T,I)}function Co(a,d,_){var T=d.pendingProps,I=T.children,L=a!==null?a.memoizedState:null;if(T.mode==="hidden")if((d.mode&1)===0)d.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yn(sd,ts),ts|=_;else{if((_&1073741824)===0)return a=L!==null?L.baseLanes|_:_,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:a,cachePool:null,transitions:null},d.updateQueue=null,Yn(sd,ts),ts|=a,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},T=L!==null?L.baseLanes:_,Yn(sd,ts),ts|=T}else L!==null?(T=L.baseLanes|_,d.memoizedState=null):T=_,Yn(sd,ts),ts|=T;return bi(a,d,I,_),d.child}function tS(a,d){var _=d.ref;(a===null&&_!==null||a!==null&&a.ref!==_)&&(d.flags|=512,d.flags|=2097152)}function A_(a,d,_,T,I){var L=Vi(_)?Za:di.current;return L=$a(d,L),Ks(d,I),_=td(a,d,_,T,L,I),T=m_(),a!==null&&!Fi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~I,ca(a,d,I)):(Zn&&T&&Jl(d),d.flags|=1,bi(a,d,_,I),d.child)}function nS(a,d,_,T,I){if(Vi(_)){var L=!0;lp(d)}else L=!1;if(Ks(d,I),d.stateNode===null)Dp(a,d),qv(d,_,T),T_(d,_,T,I),T=!0;else if(a===null){var q=d.stateNode,oe=d.memoizedProps;q.props=oe;var me=q.context,Le=_.contextType;typeof Le=="object"&&Le!==null?Le=ms(Le):(Le=Vi(_)?Za:di.current,Le=$a(d,Le));var Ze=_.getDerivedStateFromProps,$e=typeof Ze=="function"||typeof q.getSnapshotBeforeUpdate=="function";$e||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(oe!==T||me!==Le)&&Xv(d,q,T,Le),ra=!1;var Qe=d.memoizedState;q.state=Qe,vp(d,T,q,I),me=d.memoizedState,oe!==T||Qe!==me||Ri.current||ra?(typeof Ze=="function"&&(Ip(d,_,Ze,T),me=d.memoizedState),(oe=ra||aa(d,_,oe,T,Qe,me,Le))?($e||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(d.flags|=4194308)):(typeof q.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=T,d.memoizedState=me),q.props=T,q.state=me,q.context=Le,T=oe):(typeof q.componentDidMount=="function"&&(d.flags|=4194308),T=!1)}else{q=d.stateNode,xv(a,d),oe=d.memoizedProps,Le=d.type===d.elementType?oe:_s(d.type,oe),q.props=Le,$e=d.pendingProps,Qe=q.context,me=_.contextType,typeof me=="object"&&me!==null?me=ms(me):(me=Vi(_)?Za:di.current,me=$a(d,me));var _t=_.getDerivedStateFromProps;(Ze=typeof _t=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(oe!==$e||Qe!==me)&&Xv(d,q,T,me),ra=!1,Qe=d.memoizedState,q.state=Qe,vp(d,T,q,I);var Tt=d.memoizedState;oe!==$e||Qe!==Tt||Ri.current||ra?(typeof _t=="function"&&(Ip(d,_,_t,T),Tt=d.memoizedState),(Le=ra||aa(d,_,Le,T,Qe,Tt,me)||!1)?(Ze||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(T,Tt,me),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(T,Tt,me)),typeof q.componentDidUpdate=="function"&&(d.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof q.componentDidUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=1024),d.memoizedProps=T,d.memoizedState=Tt),q.props=T,q.state=Tt,q.context=me,T=Le):(typeof q.componentDidUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=1024),T=!1)}return O_(a,d,_,T,L,I)}function O_(a,d,_,T,I,L){tS(a,d);var q=(d.flags&128)!==0;if(!T&&!q)return I&&Nv(d,_,!1),ca(a,d,L);T=d.stateNode,NC.current=d;var oe=q&&typeof _.getDerivedStateFromError!="function"?null:T.render();return d.flags|=1,a!==null&&q?(d.child=$l(d,a.child,null,L),d.child=$l(d,null,oe,L)):bi(a,d,oe,L),d.memoizedState=T.state,I&&Nv(d,_,!0),d.child}function rS(a){var d=a.stateNode;d.pendingContext?ql(a,d.pendingContext,d.pendingContext!==d.context):d.context&&ql(a,d.context,!1),l_(a,d.containerInfo)}function iS(a,d,_,T,I){return Yc(),Zl(I),d.flags|=256,bi(a,d,_,T),d.child}var Fu={dehydrated:null,treeContext:null,retryLane:0};function N_(a){return{baseLanes:a,cachePool:null,transitions:null}}function sS(a,d,_){var T=d.pendingProps,I=ar.current,L=!1,q=(d.flags&128)!==0,oe;if((oe=q)||(oe=a!==null&&a.memoizedState===null?!1:(I&2)!==0),oe?(L=!0,d.flags&=-129):(a===null||a.memoizedState!==null)&&(I|=1),Yn(ar,I&1),a===null)return Au(d),a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((d.mode&1)===0?d.lanes=1:a.data==="$!"?d.lanes=8:d.lanes=1073741824,null):(q=T.children,a=T.fallback,L?(T=d.mode,L=d.child,q={mode:"hidden",children:q},(T&1)===0&&L!==null?(L.childLanes=0,L.pendingProps=q):L=Qu(q,T,0,null),a=fc(a,T,_,null),L.return=d,a.return=d,L.sibling=a,d.child=L,d.child.memoizedState=N_(_),d.memoizedState=Fu,a):P_(d,q));if(I=a.memoizedState,I!==null&&(oe=I.dehydrated,oe!==null))return PC(a,d,q,T,oe,I,_);if(L){L=T.fallback,q=d.mode,I=a.child,oe=I.sibling;var me={mode:"hidden",children:T.children};return(q&1)===0&&d.child!==I?(T=d.child,T.childLanes=0,T.pendingProps=me,d.deletions=null):(T=pc(I,me),T.subtreeFlags=I.subtreeFlags&14680064),oe!==null?L=pc(oe,L):(L=fc(L,q,_,null),L.flags|=2),L.return=d,T.return=d,T.sibling=L,d.child=T,T=L,L=d.child,q=a.child.memoizedState,q=q===null?N_(_):{baseLanes:q.baseLanes|_,cachePool:null,transitions:q.transitions},L.memoizedState=q,L.childLanes=a.childLanes&~_,d.memoizedState=Fu,T}return L=a.child,a=L.sibling,T=pc(L,{mode:"visible",children:T.children}),(d.mode&1)===0&&(T.lanes=_),T.return=d,T.sibling=null,a!==null&&(_=d.deletions,_===null?(d.deletions=[a],d.flags|=16):_.push(a)),d.child=T,d.memoizedState=null,T}function P_(a,d){return d=Qu({mode:"visible",children:d},a.mode,0,null),d.return=a,a.child=d}function Np(a,d,_,T){return T!==null&&Zl(T),$l(d,a.child,null,_),a=P_(d,d.pendingProps.children),a.flags|=2,d.memoizedState=null,a}function PC(a,d,_,T,I,L,q){if(_)return d.flags&256?(d.flags&=-257,T=Op(Error(f(422))),Np(a,d,q,T)):d.memoizedState!==null?(d.child=a.child,d.flags|=128,null):(L=T.fallback,I=d.mode,T=Qu({mode:"visible",children:T.children},I,0,null),L=fc(L,I,q,null),L.flags|=2,T.return=d,L.return=d,T.sibling=L,d.child=T,(d.mode&1)!==0&&$l(d,a.child,null,q),d.child.memoizedState=N_(q),d.memoizedState=Fu,L);if((d.mode&1)===0)return Np(a,d,q,null);if(I.data==="$!"){if(T=I.nextSibling&&I.nextSibling.dataset,T)var oe=T.dgst;return T=oe,L=Error(f(419)),T=Op(L,T,void 0),Np(a,d,q,T)}if(oe=(q&a.childLanes)!==0,Fi||oe){if(T=Mr,T!==null){switch(q&-q){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=(I&(T.suspendedLanes|q))!==0?0:I,I!==0&&I!==L.retryLane&&(L.retryLane=I,na(a,I),ns(T,a,I,-1))}return cd(),T=Op(Error(f(421))),Np(a,d,q,T)}return I.data==="$?"?(d.flags|=128,d.child=a.child,d=jC.bind(null,a),I._reactRetry=d,null):(a=L.treeContext,$i=So(I.nextSibling),Zi=d,Zn=!0,Hs=null,a!==null&&(wi[fs++]=ea,wi[fs++]=ta,wi[fs++]=Kc,ea=a.id,ta=a.overflow,Kc=d),d=P_(d,T.children),d.flags|=4096,d)}function oS(a,d,_){a.lanes|=d;var T=a.alternate;T!==null&&(T.lanes|=d),gp(a.return,d,_)}function Pp(a,d,_,T,I){var L=a.memoizedState;L===null?a.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:T,tail:_,tailMode:I}:(L.isBackwards=d,L.rendering=null,L.renderingStartTime=0,L.last=T,L.tail=_,L.tailMode=I)}function D_(a,d,_){var T=d.pendingProps,I=T.revealOrder,L=T.tail;if(bi(a,d,T.children,_),T=ar.current,(T&2)!==0)T=T&1|2,d.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=d.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&oS(a,_,d);else if(a.tag===19)oS(a,_,d);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===d)break e;for(;a.sibling===null;){if(a.return===null||a.return===d)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}T&=1}if(Yn(ar,T),(d.mode&1)===0)d.memoizedState=null;else switch(I){case"forwards":for(_=d.child,I=null;_!==null;)a=_.alternate,a!==null&&Sp(a)===null&&(I=_),_=_.sibling;_=I,_===null?(I=d.child,d.child=null):(I=_.sibling,_.sibling=null),Pp(d,!1,I,_,L);break;case"backwards":for(_=null,I=d.child,d.child=null;I!==null;){if(a=I.alternate,a!==null&&Sp(a)===null){d.child=I;break}a=I.sibling,I.sibling=_,_=I,I=a}Pp(d,!0,_,null,L);break;case"together":Pp(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Dp(a,d){(d.mode&1)===0&&a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2)}function ca(a,d,_){if(a!==null&&(d.dependencies=a.dependencies),nl|=d.lanes,(_&d.childLanes)===0)return null;if(a!==null&&d.child!==a.child)throw Error(f(153));if(d.child!==null){for(a=d.child,_=pc(a,a.pendingProps),d.child=_,_.return=d;a.sibling!==null;)a=a.sibling,_=_.sibling=pc(a,a.pendingProps),_.return=d;_.sibling=null}return d.child}function kp(a,d,_){switch(d.tag){case 3:rS(d),Yc();break;case 5:Vv(d);break;case 1:Vi(d.type)&&lp(d);break;case 4:l_(d,d.stateNode.containerInfo);break;case 10:var T=d.type._context,I=d.memoizedProps.value;Yn(mp,T._currentValue),T._currentValue=I;break;case 13:if(T=d.memoizedState,T!==null)return T.dehydrated!==null?(Yn(ar,ar.current&1),d.flags|=128,null):(_&d.child.childLanes)!==0?sS(a,d,_):(Yn(ar,ar.current&1),a=ca(a,d,_),a!==null?a.sibling:null);Yn(ar,ar.current&1);break;case 19:if(T=(_&d.childLanes)!==0,(a.flags&128)!==0){if(T)return D_(a,d,_);d.flags|=128}if(I=d.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),Yn(ar,ar.current),T)break;return null;case 22:case 23:return d.lanes=0,Co(a,d,_)}return ca(a,d,_)}var Lp,xp,Bu,k_;Lp=function(a,d){for(var _=d.child;_!==null;){if(_.tag===5||_.tag===6)a.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===d)break;for(;_.sibling===null;){if(_.return===null||_.return===d)return;_=_.return}_.sibling.return=_.return,_=_.sibling}},xp=function(){},Bu=function(a,d,_,T){var I=a.memoizedProps;if(I!==T){a=d.stateNode,nc(To.current);var L=null;switch(_){case"input":I=$d(a,I),T=$d(a,T),L=[];break;case"select":I=ze({},I,{value:void 0}),T=ze({},T,{value:void 0}),L=[];break;case"textarea":I=bl(a,I),T=bl(a,T),L=[];break;default:typeof I.onClick!="function"&&typeof T.onClick=="function"&&(a.onclick=Ru)}fo(_,T);var q;_=null;for(Le in I)if(!T.hasOwnProperty(Le)&&I.hasOwnProperty(Le)&&I[Le]!=null)if(Le==="style"){var oe=I[Le];for(q in oe)oe.hasOwnProperty(q)&&(_||(_={}),_[q]="")}else Le!=="dangerouslySetInnerHTML"&&Le!=="children"&&Le!=="suppressContentEditableWarning"&&Le!=="suppressHydrationWarning"&&Le!=="autoFocus"&&(S.hasOwnProperty(Le)?L||(L=[]):(L=L||[]).push(Le,null));for(Le in T){var me=T[Le];if(oe=I?.[Le],T.hasOwnProperty(Le)&&me!==oe&&(me!=null||oe!=null))if(Le==="style")if(oe){for(q in oe)!oe.hasOwnProperty(q)||me&&me.hasOwnProperty(q)||(_||(_={}),_[q]="");for(q in me)me.hasOwnProperty(q)&&oe[q]!==me[q]&&(_||(_={}),_[q]=me[q])}else _||(L||(L=[]),L.push(Le,_)),_=me;else Le==="dangerouslySetInnerHTML"?(me=me?me.__html:void 0,oe=oe?oe.__html:void 0,me!=null&&oe!==me&&(L=L||[]).push(Le,me)):Le==="children"?typeof me!="string"&&typeof me!="number"||(L=L||[]).push(Le,""+me):Le!=="suppressContentEditableWarning"&&Le!=="suppressHydrationWarning"&&(S.hasOwnProperty(Le)?(me!=null&&Le==="onScroll"&&zn("scroll",a),L||oe===me||(L=[])):(L=L||[]).push(Le,me))}_&&(L=L||[]).push("style",_);var Le=L;(d.updateQueue=Le)&&(d.flags|=4)}},k_=function(a,d,_,T){_!==T&&(d.flags|=4)};function Wu(a,d){if(!Zn)switch(a.tailMode){case"hidden":d=a.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?a.tail=null:_.sibling=null;break;case"collapsed":_=a.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?d||a.tail===null?a.tail=null:a.tail.sibling=null:T.sibling=null}}function ei(a){var d=a.alternate!==null&&a.alternate.child===a.child,_=0,T=0;if(d)for(var I=a.child;I!==null;)_|=I.lanes|I.childLanes,T|=I.subtreeFlags&14680064,T|=I.flags&14680064,I.return=a,I=I.sibling;else for(I=a.child;I!==null;)_|=I.lanes|I.childLanes,T|=I.subtreeFlags,T|=I.flags,I.return=a,I=I.sibling;return a.subtreeFlags|=T,a.childLanes=_,d}function Mp(a,d,_){var T=d.pendingProps;switch(pp(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ei(d),null;case 1:return Vi(d.type)&&cp(),ei(d),null;case 3:return T=d.stateNode,Jc(),Wn(Ri),Wn(di),h_(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(a===null||a.child===null)&&(Ql(d)?d.flags|=4:a===null||a.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Hs!==null&&(z_(Hs),Hs=null))),xp(a,d),ei(d),null;case 5:d_(d);var I=nc(Du.current);if(_=d.type,a!==null&&d.stateNode!=null)Bu(a,d,_,T,I),a.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!T){if(d.stateNode===null)throw Error(f(166));return ei(d),null}if(a=nc(To.current),Ql(d)){T=d.stateNode,_=d.type;var L=d.memoizedProps;switch(T[yo]=d,T[wu]=L,a=(d.mode&1)!==0,_){case"dialog":zn("cancel",T),zn("close",T);break;case"iframe":case"object":case"embed":zn("load",T);break;case"video":case"audio":for(I=0;I<Su.length;I++)zn(Su[I],T);break;case"source":zn("error",T);break;case"img":case"image":case"link":zn("error",T),zn("load",T);break;case"details":zn("toggle",T);break;case"input":Fh(T,L),zn("invalid",T);break;case"select":T._wrapperState={wasMultiple:!!L.multiple},zn("invalid",T);break;case"textarea":Ms(T,L),zn("invalid",T)}fo(_,L),I=null;for(var q in L)if(L.hasOwnProperty(q)){var oe=L[q];q==="children"?typeof oe=="string"?T.textContent!==oe&&(L.suppressHydrationWarning!==!0&&Cu(T.textContent,oe,a),I=["children",oe]):typeof oe=="number"&&T.textContent!==""+oe&&(L.suppressHydrationWarning!==!0&&Cu(T.textContent,oe,a),I=["children",""+oe]):S.hasOwnProperty(q)&&oe!=null&&q==="onScroll"&&zn("scroll",T)}switch(_){case"input":hs(T),pr(T,L,!0);break;case"textarea":hs(T),tu(T);break;case"select":case"option":break;default:typeof L.onClick=="function"&&(T.onclick=Ru)}T=I,d.updateQueue=T,T!==null&&(d.flags|=4)}else{q=I.nodeType===9?I:I.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=li(_)),a==="http://www.w3.org/1999/xhtml"?_==="script"?(a=q.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof T.is=="string"?a=q.createElement(_,{is:T.is}):(a=q.createElement(_),_==="select"&&(q=a,T.multiple?q.multiple=!0:T.size&&(q.size=T.size))):a=q.createElementNS(a,_),a[yo]=d,a[wu]=T,Lp(a,d,!1,!1),d.stateNode=a;e:{switch(q=iu(_,T),_){case"dialog":zn("cancel",a),zn("close",a),I=T;break;case"iframe":case"object":case"embed":zn("load",a),I=T;break;case"video":case"audio":for(I=0;I<Su.length;I++)zn(Su[I],a);I=T;break;case"source":zn("error",a),I=T;break;case"img":case"image":case"link":zn("error",a),zn("load",a),I=T;break;case"details":zn("toggle",a),I=T;break;case"input":Fh(a,T),I=$d(a,T),zn("invalid",a);break;case"option":I=T;break;case"select":a._wrapperState={wasMultiple:!!T.multiple},I=ze({},T,{value:void 0}),zn("invalid",a);break;case"textarea":Ms(a,T),I=bl(a,T),zn("invalid",a);break;default:I=T}fo(_,I),oe=I;for(L in oe)if(oe.hasOwnProperty(L)){var me=oe[L];L==="style"?Ti(a,me):L==="dangerouslySetInnerHTML"?(me=me?me.__html:void 0,me!=null&&Il(a,me)):L==="children"?typeof me=="string"?(_!=="textarea"||me!=="")&&Us(a,me):typeof me=="number"&&Us(a,""+me):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(S.hasOwnProperty(L)?me!=null&&L==="onScroll"&&zn("scroll",a):me!=null&&le(a,L,me,q))}switch(_){case"input":hs(a),pr(a,T,!1);break;case"textarea":hs(a),tu(a);break;case"option":T.value!=null&&a.setAttribute("value",""+pn(T.value));break;case"select":a.multiple=!!T.multiple,L=T.value,L!=null?ki(a,!!T.multiple,L,!1):T.defaultValue!=null&&ki(a,!!T.multiple,T.defaultValue,!0);break;default:typeof I.onClick=="function"&&(a.onclick=Ru)}switch(_){case"button":case"input":case"select":case"textarea":T=!!T.autoFocus;break e;case"img":T=!0;break e;default:T=!1}}T&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return ei(d),null;case 6:if(a&&d.stateNode!=null)k_(a,d,a.memoizedProps,T);else{if(typeof T!="string"&&d.stateNode===null)throw Error(f(166));if(_=nc(Du.current),nc(To.current),Ql(d)){if(T=d.stateNode,_=d.memoizedProps,T[yo]=d,(L=T.nodeValue!==_)&&(a=Zi,a!==null))switch(a.tag){case 3:Cu(T.nodeValue,_,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Cu(T.nodeValue,_,(a.mode&1)!==0)}L&&(d.flags|=4)}else T=(_.nodeType===9?_:_.ownerDocument).createTextNode(T),T[yo]=d,d.stateNode=T}return ei(d),null;case 13:if(Wn(ar),T=d.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(Zn&&$i!==null&&(d.mode&1)!==0&&(d.flags&128)===0)e_(),Yc(),d.flags|=98560,L=!1;else if(L=Ql(d),T!==null&&T.dehydrated!==null){if(a===null){if(!L)throw Error(f(318));if(L=d.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(f(317));L[yo]=d}else Yc(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;ei(d),L=!1}else Hs!==null&&(z_(Hs),Hs=null),L=!0;if(!L)return d.flags&65536?d:null}return(d.flags&128)!==0?(d.lanes=_,d):(T=T!==null,T!==(a!==null&&a.memoizedState!==null)&&T&&(d.child.flags|=8192,(d.mode&1)!==0&&(a===null||(ar.current&1)!==0?Ur===0&&(Ur=3):cd())),d.updateQueue!==null&&(d.flags|=4),ei(d),null);case 4:return Jc(),xp(a,d),a===null&&Jo(d.stateNode.containerInfo),ei(d),null;case 10:return s_(d.type._context),ei(d),null;case 17:return Vi(d.type)&&cp(),ei(d),null;case 19:if(Wn(ar),L=d.memoizedState,L===null)return ei(d),null;if(T=(d.flags&128)!==0,q=L.rendering,q===null)if(T)Wu(L,!1);else{if(Ur!==0||a!==null&&(a.flags&128)!==0)for(a=d.child;a!==null;){if(q=Sp(a),q!==null){for(d.flags|=128,Wu(L,!1),T=q.updateQueue,T!==null&&(d.updateQueue=T,d.flags|=4),d.subtreeFlags=0,T=_,_=d.child;_!==null;)L=_,a=T,L.flags&=14680066,q=L.alternate,q===null?(L.childLanes=0,L.lanes=a,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=q.childLanes,L.lanes=q.lanes,L.child=q.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=q.memoizedProps,L.memoizedState=q.memoizedState,L.updateQueue=q.updateQueue,L.type=q.type,a=q.dependencies,L.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),_=_.sibling;return Yn(ar,ar.current&1|2),d.child}a=a.sibling}L.tail!==null&&vr()>gs&&(d.flags|=128,T=!0,Wu(L,!1),d.lanes=4194304)}else{if(!T)if(a=Sp(q),a!==null){if(d.flags|=128,T=!0,_=a.updateQueue,_!==null&&(d.updateQueue=_,d.flags|=4),Wu(L,!0),L.tail===null&&L.tailMode==="hidden"&&!q.alternate&&!Zn)return ei(d),null}else 2*vr()-L.renderingStartTime>gs&&_!==1073741824&&(d.flags|=128,T=!0,Wu(L,!1),d.lanes=4194304);L.isBackwards?(q.sibling=d.child,d.child=q):(_=L.last,_!==null?_.sibling=q:d.child=q,L.last=q)}return L.tail!==null?(d=L.tail,L.rendering=d,L.tail=d.sibling,L.renderingStartTime=vr(),d.sibling=null,_=ar.current,Yn(ar,T?_&1|2:_&1),d):(ei(d),null);case 22:case 23:return Xu(),T=d.memoizedState!==null,a!==null&&a.memoizedState!==null!==T&&(d.flags|=8192),T&&(d.mode&1)!==0?(ts&1073741824)!==0&&(ei(d),d.subtreeFlags&6&&(d.flags|=8192)):ei(d),null;case 24:return null;case 25:return null}throw Error(f(156,d.tag))}function DC(a,d){switch(pp(d),d.tag){case 1:return Vi(d.type)&&cp(),a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 3:return Jc(),Wn(Ri),Wn(di),h_(),a=d.flags,(a&65536)!==0&&(a&128)===0?(d.flags=a&-65537|128,d):null;case 5:return d_(d),null;case 13:if(Wn(ar),a=d.memoizedState,a!==null&&a.dehydrated!==null){if(d.alternate===null)throw Error(f(340));Yc()}return a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 19:return Wn(ar),null;case 4:return Jc(),null;case 10:return s_(d.type._context),null;case 22:case 23:return Xu(),null;case 24:return null;default:return null}}var Gu=!1,ti=!1,kC=typeof WeakSet=="function"?WeakSet:Set,Et=null;function tl(a,d){var _=a.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(T){cr(a,d,T)}else _.current=null}function L_(a,d,_){try{_()}catch(T){cr(a,d,T)}}var aS=!1;function LC(a,d){if(Ym=Xh,a=jm(),Fm(a)){if("selectionStart"in a)var _={start:a.selectionStart,end:a.selectionEnd};else e:{_=(_=a.ownerDocument)&&_.defaultView||window;var T=_.getSelection&&_.getSelection();if(T&&T.rangeCount!==0){_=T.anchorNode;var I=T.anchorOffset,L=T.focusNode;T=T.focusOffset;try{_.nodeType,L.nodeType}catch{_=null;break e}var q=0,oe=-1,me=-1,Le=0,Ze=0,$e=a,Qe=null;t:for(;;){for(var _t;$e!==_||I!==0&&$e.nodeType!==3||(oe=q+I),$e!==L||T!==0&&$e.nodeType!==3||(me=q+T),$e.nodeType===3&&(q+=$e.nodeValue.length),(_t=$e.firstChild)!==null;)Qe=$e,$e=_t;for(;;){if($e===a)break t;if(Qe===_&&++Le===I&&(oe=q),Qe===L&&++Ze===T&&(me=q),(_t=$e.nextSibling)!==null)break;$e=Qe,Qe=$e.parentNode}$e=_t}_=oe===-1||me===-1?null:{start:oe,end:me}}else _=null}_=_||{start:0,end:0}}else _=null;for(sp={focusedElem:a,selectionRange:_},Xh=!1,Et=d;Et!==null;)if(d=Et,a=d.child,(d.subtreeFlags&1028)!==0&&a!==null)a.return=d,Et=a;else for(;Et!==null;){d=Et;try{var Tt=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if(Tt!==null){var Rt=Tt.memoizedProps,lr=Tt.memoizedState,Ce=d.stateNode,ge=Ce.getSnapshotBeforeUpdate(d.elementType===d.type?Rt:_s(d.type,Rt),lr);Ce.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Oe=d.stateNode.containerInfo;Oe.nodeType===1?Oe.textContent="":Oe.nodeType===9&&Oe.documentElement&&Oe.removeChild(Oe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(f(163))}}catch(nt){cr(d,d.return,nt)}if(a=d.sibling,a!==null){a.return=d.return,Et=a;break}Et=d.return}return Tt=aS,aS=!1,Tt}function ic(a,d,_){var T=d.updateQueue;if(T=T!==null?T.lastEffect:null,T!==null){var I=T=T.next;do{if((I.tag&a)===a){var L=I.destroy;I.destroy=void 0,L!==void 0&&L_(d,_,L)}I=I.next}while(I!==T)}}function Up(a,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var _=d=d.next;do{if((_.tag&a)===a){var T=_.create;_.destroy=T()}_=_.next}while(_!==d)}}function x_(a){var d=a.ref;if(d!==null){var _=a.stateNode;switch(a.tag){case 5:a=_;break;default:a=_}typeof d=="function"?d(a):d.current=a}}function cS(a){var d=a.alternate;d!==null&&(a.alternate=null,cS(d)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(d=a.stateNode,d!==null&&(delete d[yo],delete d[wu],delete d[Xm],delete d[CC],delete d[RC])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function M_(a){return a.tag===5||a.tag===3||a.tag===4}function lS(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||M_(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function U_(a,d,_){var T=a.tag;if(T===5||T===6)a=a.stateNode,d?_.nodeType===8?_.parentNode.insertBefore(a,d):_.insertBefore(a,d):(_.nodeType===8?(d=_.parentNode,d.insertBefore(a,_)):(d=_,d.appendChild(a)),_=_._reactRootContainer,_!=null||d.onclick!==null||(d.onclick=Ru));else if(T!==4&&(a=a.child,a!==null))for(U_(a,d,_),a=a.sibling;a!==null;)U_(a,d,_),a=a.sibling}function Hu(a,d,_){var T=a.tag;if(T===5||T===6)a=a.stateNode,d?_.insertBefore(a,d):_.appendChild(a);else if(T!==4&&(a=a.child,a!==null))for(Hu(a,d,_),a=a.sibling;a!==null;)Hu(a,d,_),a=a.sibling}var ni=null,es=!1;function sc(a,d,_){for(_=_.child;_!==null;)V_(a,d,_),_=_.sibling}function V_(a,d,_){if(Eo&&typeof Eo.onCommitFiberUnmount=="function")try{Eo.onCommitFiberUnmount(Nl,_)}catch{}switch(_.tag){case 5:ti||tl(_,d);case 6:var T=ni,I=es;ni=null,sc(a,d,_),ni=T,es=I,ni!==null&&(es?(a=ni,_=_.stateNode,a.nodeType===8?a.parentNode.removeChild(_):a.removeChild(_)):ni.removeChild(_.stateNode));break;case 18:ni!==null&&(es?(a=ni,_=_.stateNode,a.nodeType===8?op(a.parentNode,_):a.nodeType===1&&op(a,_),Ll(a)):op(ni,_.stateNode));break;case 4:T=ni,I=es,ni=_.stateNode.containerInfo,es=!0,sc(a,d,_),ni=T,es=I;break;case 0:case 11:case 14:case 15:if(!ti&&(T=_.updateQueue,T!==null&&(T=T.lastEffect,T!==null))){I=T=T.next;do{var L=I,q=L.destroy;L=L.tag,q!==void 0&&((L&2)!==0||(L&4)!==0)&&L_(_,d,q),I=I.next}while(I!==T)}sc(a,d,_);break;case 1:if(!ti&&(tl(_,d),T=_.stateNode,typeof T.componentWillUnmount=="function"))try{T.props=_.memoizedProps,T.state=_.memoizedState,T.componentWillUnmount()}catch(oe){cr(_,d,oe)}sc(a,d,_);break;case 21:sc(a,d,_);break;case 22:_.mode&1?(ti=(T=ti)||_.memoizedState!==null,sc(a,d,_),ti=T):sc(a,d,_);break;default:sc(a,d,_)}}function dS(a){var d=a.updateQueue;if(d!==null){a.updateQueue=null;var _=a.stateNode;_===null&&(_=a.stateNode=new kC),d.forEach(function(T){var I=ld.bind(null,a,T);_.has(T)||(_.add(T),T.then(I,I))})}}function Xs(a,d){var _=d.deletions;if(_!==null)for(var T=0;T<_.length;T++){var I=_[T];try{var L=a,q=d,oe=q;e:for(;oe!==null;){switch(oe.tag){case 5:ni=oe.stateNode,es=!1;break e;case 3:ni=oe.stateNode.containerInfo,es=!0;break e;case 4:ni=oe.stateNode.containerInfo,es=!0;break e}oe=oe.return}if(ni===null)throw Error(f(160));V_(L,q,I),ni=null,es=!1;var me=I.alternate;me!==null&&(me.return=null),I.return=null}catch(Le){cr(I,d,Le)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)j_(d,a),d=d.sibling}function j_(a,d){var _=a.alternate,T=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Xs(d,a),Ro(a),T&4){try{ic(3,a,a.return),Up(3,a)}catch(Rt){cr(a,a.return,Rt)}try{ic(5,a,a.return)}catch(Rt){cr(a,a.return,Rt)}}break;case 1:Xs(d,a),Ro(a),T&512&&_!==null&&tl(_,_.return);break;case 5:if(Xs(d,a),Ro(a),T&512&&_!==null&&tl(_,_.return),a.flags&32){var I=a.stateNode;try{Us(I,"")}catch(Rt){cr(a,a.return,Rt)}}if(T&4&&(I=a.stateNode,I!=null)){var L=a.memoizedProps,q=_!==null?_.memoizedProps:L,oe=a.type,me=a.updateQueue;if(a.updateQueue=null,me!==null)try{oe==="input"&&L.type==="radio"&&L.name!=null&&ps(I,L),iu(oe,q);var Le=iu(oe,L);for(q=0;q<me.length;q+=2){var Ze=me[q],$e=me[q+1];Ze==="style"?Ti(I,$e):Ze==="dangerouslySetInnerHTML"?Il(I,$e):Ze==="children"?Us(I,$e):le(I,Ze,$e,Le)}switch(oe){case"input":eu(I,L);break;case"textarea":Ar(I,L);break;case"select":var Qe=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!L.multiple;var _t=L.value;_t!=null?ki(I,!!L.multiple,_t,!1):Qe!==!!L.multiple&&(L.defaultValue!=null?ki(I,!!L.multiple,L.defaultValue,!0):ki(I,!!L.multiple,L.multiple?[]:"",!1))}I[wu]=L}catch(Rt){cr(a,a.return,Rt)}}break;case 6:if(Xs(d,a),Ro(a),T&4){if(a.stateNode===null)throw Error(f(162));I=a.stateNode,L=a.memoizedProps;try{I.nodeValue=L}catch(Rt){cr(a,a.return,Rt)}}break;case 3:if(Xs(d,a),Ro(a),T&4&&_!==null&&_.memoizedState.isDehydrated)try{Ll(d.containerInfo)}catch(Rt){cr(a,a.return,Rt)}break;case 4:Xs(d,a),Ro(a);break;case 13:Xs(d,a),Ro(a),I=a.child,I.flags&8192&&(L=I.memoizedState!==null,I.stateNode.isHidden=L,!L||I.alternate!==null&&I.alternate.memoizedState!==null||(G_=vr())),T&4&&dS(a);break;case 22:if(Ze=_!==null&&_.memoizedState!==null,a.mode&1?(ti=(Le=ti)||Ze,Xs(d,a),ti=Le):Xs(d,a),Ro(a),T&8192){if(Le=a.memoizedState!==null,(a.stateNode.isHidden=Le)&&!Ze&&(a.mode&1)!==0)for(Et=a,Ze=a.child;Ze!==null;){for($e=Et=Ze;Et!==null;){switch(Qe=Et,_t=Qe.child,Qe.tag){case 0:case 11:case 14:case 15:ic(4,Qe,Qe.return);break;case 1:tl(Qe,Qe.return);var Tt=Qe.stateNode;if(typeof Tt.componentWillUnmount=="function"){T=Qe,_=Qe.return;try{d=T,Tt.props=d.memoizedProps,Tt.state=d.memoizedState,Tt.componentWillUnmount()}catch(Rt){cr(T,_,Rt)}}break;case 5:tl(Qe,Qe.return);break;case 22:if(Qe.memoizedState!==null){Vp($e);continue}}_t!==null?(_t.return=Qe,Et=_t):Vp($e)}Ze=Ze.sibling}e:for(Ze=null,$e=a;;){if($e.tag===5){if(Ze===null){Ze=$e;try{I=$e.stateNode,Le?(L=I.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none"):(oe=$e.stateNode,me=$e.memoizedProps.style,q=me!=null&&me.hasOwnProperty("display")?me.display:null,oe.style.display=Vc("display",q))}catch(Rt){cr(a,a.return,Rt)}}}else if($e.tag===6){if(Ze===null)try{$e.stateNode.nodeValue=Le?"":$e.memoizedProps}catch(Rt){cr(a,a.return,Rt)}}else if(($e.tag!==22&&$e.tag!==23||$e.memoizedState===null||$e===a)&&$e.child!==null){$e.child.return=$e,$e=$e.child;continue}if($e===a)break e;for(;$e.sibling===null;){if($e.return===null||$e.return===a)break e;Ze===$e&&(Ze=null),$e=$e.return}Ze===$e&&(Ze=null),$e.sibling.return=$e.return,$e=$e.sibling}}break;case 19:Xs(d,a),Ro(a),T&4&&dS(a);break;case 21:break;default:Xs(d,a),Ro(a)}}function Ro(a){var d=a.flags;if(d&2){try{e:{for(var _=a.return;_!==null;){if(M_(_)){var T=_;break e}_=_.return}throw Error(f(160))}switch(T.tag){case 5:var I=T.stateNode;T.flags&32&&(Us(I,""),T.flags&=-33);var L=lS(a);Hu(a,L,I);break;case 3:case 4:var q=T.stateNode.containerInfo,oe=lS(a);U_(a,oe,q);break;default:throw Error(f(161))}}catch(me){cr(a,a.return,me)}a.flags&=-3}d&4096&&(a.flags&=-4097)}function xC(a,d,_){Et=a,F_(a)}function F_(a,d,_){for(var T=(a.mode&1)!==0;Et!==null;){var I=Et,L=I.child;if(I.tag===22&&T){var q=I.memoizedState!==null||Gu;if(!q){var oe=I.alternate,me=oe!==null&&oe.memoizedState!==null||ti;oe=Gu;var Le=ti;if(Gu=q,(ti=me)&&!Le)for(Et=I;Et!==null;)q=Et,me=q.child,q.tag===22&&q.memoizedState!==null?uS(I):me!==null?(me.return=q,Et=me):uS(I);for(;L!==null;)Et=L,F_(L),L=L.sibling;Et=I,Gu=oe,ti=Le}B_(a)}else(I.subtreeFlags&8772)!==0&&L!==null?(L.return=I,Et=L):B_(a)}}function B_(a){for(;Et!==null;){var d=Et;if((d.flags&8772)!==0){var _=d.alternate;try{if((d.flags&8772)!==0)switch(d.tag){case 0:case 11:case 15:ti||Up(5,d);break;case 1:var T=d.stateNode;if(d.flags&4&&!ti)if(_===null)T.componentDidMount();else{var I=d.elementType===d.type?_.memoizedProps:_s(d.type,_.memoizedProps);T.componentDidUpdate(I,_.memoizedState,T.__reactInternalSnapshotBeforeUpdate)}var L=d.updateQueue;L!==null&&Uv(d,L,T);break;case 3:var q=d.updateQueue;if(q!==null){if(_=null,d.child!==null)switch(d.child.tag){case 5:_=d.child.stateNode;break;case 1:_=d.child.stateNode}Uv(d,q,_)}break;case 5:var oe=d.stateNode;if(_===null&&d.flags&4){_=oe;var me=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":me.autoFocus&&_.focus();break;case"img":me.src&&(_.src=me.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var Le=d.alternate;if(Le!==null){var Ze=Le.memoizedState;if(Ze!==null){var $e=Ze.dehydrated;$e!==null&&Ll($e)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(f(163))}ti||d.flags&512&&x_(d)}catch(Qe){cr(d,d.return,Qe)}}if(d===a){Et=null;break}if(_=d.sibling,_!==null){_.return=d.return,Et=_;break}Et=d.return}}function Vp(a){for(;Et!==null;){var d=Et;if(d===a){Et=null;break}var _=d.sibling;if(_!==null){_.return=d.return,Et=_;break}Et=d.return}}function uS(a){for(;Et!==null;){var d=Et;try{switch(d.tag){case 0:case 11:case 15:var _=d.return;try{Up(4,d)}catch(me){cr(d,_,me)}break;case 1:var T=d.stateNode;if(typeof T.componentDidMount=="function"){var I=d.return;try{T.componentDidMount()}catch(me){cr(d,I,me)}}var L=d.return;try{x_(d)}catch(me){cr(d,L,me)}break;case 5:var q=d.return;try{x_(d)}catch(me){cr(d,q,me)}}}catch(me){cr(d,d.return,me)}if(d===a){Et=null;break}var oe=d.sibling;if(oe!==null){oe.return=d.return,Et=oe;break}Et=d.return}}var MC=Math.ceil,oc=ne.ReactCurrentDispatcher,jp=ne.ReactCurrentOwner,hi=ne.ReactCurrentBatchConfig,ln=0,Mr=null,mr=null,Or=0,ts=0,sd=Gs(0),Ur=0,od=null,nl=0,Fp=0,W_=0,rl=null,yr=null,G_=0,gs=1/0,wo=null,pi=!1,H_=null,ac=null,Ku=!1,cc=null,zu=0,ad=0,K_=null,Yu=-1,Bp=0;function Ii(){return(ln&6)!==0?vr():Yu!==-1?Yu:Yu=vr()}function lc(a){return(a.mode&1)===0?1:(ln&2)!==0&&Or!==0?Or&-Or:Ou.transition!==null?(Bp===0&&(Bp=QE()),Bp):(a=On,a!==0||(a=window.event,a=a===void 0?16:nv(a.type)),a)}function ns(a,d,_,T){if(50<ad)throw ad=0,K_=null,Error(f(185));au(a,_,T),((ln&2)===0||a!==Mr)&&(a===Mr&&((ln&2)===0&&(Fp|=_),Ur===4&&dc(a,Or)),fi(a,T),_===1&&ln===0&&(d.mode&1)===0&&(gs=vr()+500,dp&&ec()))}function fi(a,d){var _=a.callbackNode;JE(a,d);var T=Hh(a,a===Mr?Or:0);if(T===0)_!==null&&KE(_),a.callbackNode=null,a.callbackPriority=0;else if(d=T&-T,a.callbackPriority!==d){if(_!=null&&KE(_),d===1)a.tag===0?wC(Wp.bind(null,a)):Zm(Wp.bind(null,a)),yC(function(){(ln&6)===0&&ec()}),_=null;else{switch(ym(T)){case 1:_=fr;break;case 4:_=zE;break;case 16:_=Wh;break;case 536870912:_=YE;break;default:_=Wh}_=Z_(_,hS.bind(null,a))}a.callbackPriority=d,a.callbackNode=_}}function hS(a,d){if(Yu=-1,Bp=0,(ln&6)!==0)throw Error(f(327));var _=a.callbackNode;if(hc()&&a.callbackNode!==_)return null;var T=Hh(a,a===Mr?Or:0);if(T===0)return null;if((T&30)!==0||(T&a.expiredLanes)!==0||d)d=Ju(a,T);else{d=T;var I=ln;ln|=2;var L=q_();(Mr!==a||Or!==d)&&(wo=null,gs=vr()+500,la(a,d));do try{VC();break}catch(oe){Y_(a,oe)}while(!0);i_(),oc.current=L,ln=I,mr!==null?d=0:(Mr=null,Or=0,d=Ur)}if(d!==0){if(d===2&&(I=Em(a),I!==0&&(T=I,d=qu(a,I))),d===1)throw _=od,la(a,0),dc(a,T),fi(a,vr()),_;if(d===6)dc(a,T);else{if(I=a.current.alternate,(T&30)===0&&!pS(I)&&(d=Ju(a,T),d===2&&(L=Em(a),L!==0&&(T=L,d=qu(a,L))),d===1))throw _=od,la(a,0),dc(a,T),fi(a,vr()),_;switch(a.finishedWork=I,a.finishedLanes=T,d){case 0:case 1:throw Error(f(345));case 2:Es(a,yr,wo);break;case 3:if(dc(a,T),(T&130023424)===T&&(d=G_+500-vr(),10<d)){if(Hh(a,0)!==0)break;if(I=a.suspendedLanes,(I&T)!==T){Ii(),a.pingedLanes|=a.suspendedLanes&I;break}a.timeoutHandle=qm(Es.bind(null,a,yr,wo),d);break}Es(a,yr,wo);break;case 4:if(dc(a,T),(T&4194240)===T)break;for(d=a.eventTimes,I=-1;0<T;){var q=31-Fs(T);L=1<<q,q=d[q],q>I&&(I=q),T&=~L}if(T=I,T=vr()-T,T=(120>T?120:480>T?480:1080>T?1080:1920>T?1920:3e3>T?3e3:4320>T?4320:1960*MC(T/1960))-T,10<T){a.timeoutHandle=qm(Es.bind(null,a,yr,wo),T);break}Es(a,yr,wo);break;case 5:Es(a,yr,wo);break;default:throw Error(f(329))}}}return fi(a,vr()),a.callbackNode===_?hS.bind(null,a):null}function qu(a,d){var _=rl;return a.current.memoizedState.isDehydrated&&(la(a,d).flags|=256),a=Ju(a,d),a!==2&&(d=yr,yr=_,d!==null&&z_(d)),a}function z_(a){yr===null?yr=a:yr.push.apply(yr,a)}function pS(a){for(var d=a;;){if(d.flags&16384){var _=d.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var T=0;T<_.length;T++){var I=_[T],L=I.getSnapshot;I=I.value;try{if(!Bs(L(),I))return!1}catch{return!1}}}if(_=d.child,d.subtreeFlags&16384&&_!==null)_.return=d,d=_;else{if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function dc(a,d){for(d&=~W_,d&=~Fp,a.suspendedLanes|=d,a.pingedLanes&=~d,a=a.expirationTimes;0<d;){var _=31-Fs(d),T=1<<_;a[_]=-1,d&=~T}}function Wp(a){if((ln&6)!==0)throw Error(f(327));hc();var d=Hh(a,0);if((d&1)===0)return fi(a,vr()),null;var _=Ju(a,d);if(a.tag!==0&&_===2){var T=Em(a);T!==0&&(d=T,_=qu(a,T))}if(_===1)throw _=od,la(a,0),dc(a,d),fi(a,vr()),_;if(_===6)throw Error(f(345));return a.finishedWork=a.current.alternate,a.finishedLanes=d,Es(a,yr,wo),fi(a,vr()),null}function il(a,d){var _=ln;ln|=1;try{return a(d)}finally{ln=_,ln===0&&(gs=vr()+500,dp&&ec())}}function uc(a){cc!==null&&cc.tag===0&&(ln&6)===0&&hc();var d=ln;ln|=1;var _=hi.transition,T=On;try{if(hi.transition=null,On=1,a)return a()}finally{On=T,hi.transition=_,ln=d,(ln&6)===0&&ec()}}function Xu(){ts=sd.current,Wn(sd)}function la(a,d){a.finishedWork=null,a.finishedLanes=0;var _=a.timeoutHandle;if(_!==-1&&(a.timeoutHandle=-1,SC(_)),mr!==null)for(_=mr.return;_!==null;){var T=_;switch(pp(T),T.tag){case 1:T=T.type.childContextTypes,T!=null&&cp();break;case 3:Jc(),Wn(Ri),Wn(di),h_();break;case 5:d_(T);break;case 4:Jc();break;case 13:Wn(ar);break;case 19:Wn(ar);break;case 10:s_(T.type._context);break;case 22:case 23:Xu()}_=_.return}if(Mr=a,mr=a=pc(a.current,null),Or=ts=d,Ur=0,od=null,W_=Fp=nl=0,yr=rl=null,qc!==null){for(d=0;d<qc.length;d++)if(_=qc[d],T=_.interleaved,T!==null){_.interleaved=null;var I=T.next,L=_.pending;if(L!==null){var q=L.next;L.next=I,T.next=q}_.pending=T}qc=null}return a}function Y_(a,d){do{var _=mr;try{if(i_(),ku.current=rd,Lu){for(var T=rr.memoizedState;T!==null;){var I=T.queue;I!==null&&(I.pending=null),T=T.next}Lu=!1}if(Qc=0,Sr=xr=rr=null,sa=!1,xu=0,jp.current=null,_===null||_.return===null){Ur=1,od=d,mr=null;break}e:{var L=a,q=_.return,oe=_,me=d;if(d=Or,oe.flags|=32768,me!==null&&typeof me=="object"&&typeof me.then=="function"){var Le=me,Ze=oe,$e=Ze.tag;if((Ze.mode&1)===0&&($e===0||$e===11||$e===15)){var Qe=Ze.alternate;Qe?(Ze.updateQueue=Qe.updateQueue,Ze.memoizedState=Qe.memoizedState,Ze.lanes=Qe.lanes):(Ze.updateQueue=null,Ze.memoizedState=null)}var _t=Qv(q);if(_t!==null){_t.flags&=-257,Zv(_t,q,oe,L,d),_t.mode&1&&b_(L,Le,d),d=_t,me=Le;var Tt=d.updateQueue;if(Tt===null){var Rt=new Set;Rt.add(me),d.updateQueue=Rt}else Tt.add(me);break e}else{if((d&1)===0){b_(L,Le,d),cd();break e}me=Error(f(426))}}else if(Zn&&oe.mode&1){var lr=Qv(q);if(lr!==null){(lr.flags&65536)===0&&(lr.flags|=256),Zv(lr,q,oe,L,d),Zl(id(me,oe));break e}}L=me=id(me,oe),Ur!==4&&(Ur=2),rl===null?rl=[L]:rl.push(L),L=q;do{switch(L.tag){case 3:L.flags|=65536,d&=-d,L.lanes|=d;var Ce=w_(L,me,d);Mv(L,Ce);break e;case 1:oe=me;var ge=L.type,Oe=L.stateNode;if((L.flags&128)===0&&(typeof ge.getDerivedStateFromError=="function"||Oe!==null&&typeof Oe.componentDidCatch=="function"&&(ac===null||!ac.has(Oe)))){L.flags|=65536,d&=-d,L.lanes|=d;var nt=Jv(L,oe,d);Mv(L,nt);break e}}L=L.return}while(L!==null)}J_(_)}catch(wt){d=wt,mr===_&&_!==null&&(mr=_=_.return);continue}break}while(!0)}function q_(){var a=oc.current;return oc.current=rd,a===null?rd:a}function cd(){(Ur===0||Ur===3||Ur===2)&&(Ur=4),Mr===null||(nl&268435455)===0&&(Fp&268435455)===0||dc(Mr,Or)}function Ju(a,d){var _=ln;ln|=2;var T=q_();(Mr!==a||Or!==d)&&(wo=null,la(a,d));do try{UC();break}catch(I){Y_(a,I)}while(!0);if(i_(),ln=_,oc.current=T,mr!==null)throw Error(f(261));return Mr=null,Or=0,Ur}function UC(){for(;mr!==null;)X_(mr)}function VC(){for(;mr!==null&&!V0();)X_(mr)}function X_(a){var d=_S(a.alternate,a,ts);a.memoizedProps=a.pendingProps,d===null?J_(a):mr=d,jp.current=null}function J_(a){var d=a;do{var _=d.alternate;if(a=d.return,(d.flags&32768)===0){if(_=Mp(_,d,ts),_!==null){mr=_;return}}else{if(_=DC(_,d),_!==null){_.flags&=32767,mr=_;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Ur=6,mr=null;return}}if(d=d.sibling,d!==null){mr=d;return}mr=d=a}while(d!==null);Ur===0&&(Ur=5)}function Es(a,d,_){var T=On,I=hi.transition;try{hi.transition=null,On=1,Q_(a,d,_,T)}finally{hi.transition=I,On=T}return null}function Q_(a,d,_,T){do hc();while(cc!==null);if((ln&6)!==0)throw Error(f(327));_=a.finishedWork;var I=a.finishedLanes;if(_===null)return null;if(a.finishedWork=null,a.finishedLanes=0,_===a.current)throw Error(f(177));a.callbackNode=null,a.callbackPriority=0;var L=_.lanes|_.childLanes;if(G0(a,L),a===Mr&&(mr=Mr=null,Or=0),(_.subtreeFlags&2064)===0&&(_.flags&2064)===0||Ku||(Ku=!0,Z_(Wh,function(){return hc(),null})),L=(_.flags&15990)!==0,(_.subtreeFlags&15990)!==0||L){L=hi.transition,hi.transition=null;var q=On;On=1;var oe=ln;ln|=4,jp.current=null,LC(a,_),j_(_,a),mC(sp),Xh=!!Ym,sp=Ym=null,a.current=_,xC(_),go(),ln=oe,On=q,hi.transition=L}else a.current=_;if(Ku&&(Ku=!1,cc=a,zu=I),L=a.pendingLanes,L===0&&(ac=null),qE(_.stateNode),fi(a,vr()),d!==null)for(T=a.onRecoverableError,_=0;_<d.length;_++)I=d[_],T(I.value,{componentStack:I.stack,digest:I.digest});if(pi)throw pi=!1,a=H_,H_=null,a;return(zu&1)!==0&&a.tag!==0&&hc(),L=a.pendingLanes,(L&1)!==0?a===K_?ad++:(ad=0,K_=a):ad=0,ec(),null}function hc(){if(cc!==null){var a=ym(zu),d=hi.transition,_=On;try{if(hi.transition=null,On=16>a?16:a,cc===null)var T=!1;else{if(a=cc,cc=null,zu=0,(ln&6)!==0)throw Error(f(331));var I=ln;for(ln|=4,Et=a.current;Et!==null;){var L=Et,q=L.child;if((Et.flags&16)!==0){var oe=L.deletions;if(oe!==null){for(var me=0;me<oe.length;me++){var Le=oe[me];for(Et=Le;Et!==null;){var Ze=Et;switch(Ze.tag){case 0:case 11:case 15:ic(8,Ze,L)}var $e=Ze.child;if($e!==null)$e.return=Ze,Et=$e;else for(;Et!==null;){Ze=Et;var Qe=Ze.sibling,_t=Ze.return;if(cS(Ze),Ze===Le){Et=null;break}if(Qe!==null){Qe.return=_t,Et=Qe;break}Et=_t}}}var Tt=L.alternate;if(Tt!==null){var Rt=Tt.child;if(Rt!==null){Tt.child=null;do{var lr=Rt.sibling;Rt.sibling=null,Rt=lr}while(Rt!==null)}}Et=L}}if((L.subtreeFlags&2064)!==0&&q!==null)q.return=L,Et=q;else e:for(;Et!==null;){if(L=Et,(L.flags&2048)!==0)switch(L.tag){case 0:case 11:case 15:ic(9,L,L.return)}var Ce=L.sibling;if(Ce!==null){Ce.return=L.return,Et=Ce;break e}Et=L.return}}var ge=a.current;for(Et=ge;Et!==null;){q=Et;var Oe=q.child;if((q.subtreeFlags&2064)!==0&&Oe!==null)Oe.return=q,Et=Oe;else e:for(q=ge;Et!==null;){if(oe=Et,(oe.flags&2048)!==0)try{switch(oe.tag){case 0:case 11:case 15:Up(9,oe)}}catch(wt){cr(oe,oe.return,wt)}if(oe===q){Et=null;break e}var nt=oe.sibling;if(nt!==null){nt.return=oe.return,Et=nt;break e}Et=oe.return}}if(ln=I,ec(),Eo&&typeof Eo.onPostCommitFiberRoot=="function")try{Eo.onPostCommitFiberRoot(Nl,a)}catch{}T=!0}return T}finally{On=_,hi.transition=d}}return!1}function Gp(a,d,_){d=id(_,d),d=w_(a,d,1),a=zs(a,d,1),d=Ii(),a!==null&&(au(a,1,d),fi(a,d))}function cr(a,d,_){if(a.tag===3)Gp(a,a,_);else for(;d!==null;){if(d.tag===3){Gp(d,a,_);break}else if(d.tag===1){var T=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(ac===null||!ac.has(T))){a=id(_,a),a=Jv(d,a,1),d=zs(d,a,1),a=Ii(),d!==null&&(au(d,1,a),fi(d,a));break}}d=d.return}}function fS(a,d,_){var T=a.pingCache;T!==null&&T.delete(d),d=Ii(),a.pingedLanes|=a.suspendedLanes&_,Mr===a&&(Or&_)===_&&(Ur===4||Ur===3&&(Or&130023424)===Or&&500>vr()-G_?la(a,0):W_|=_),fi(a,d)}function mS(a,d){d===0&&((a.mode&1)===0?d=1:(d=Gh,Gh<<=1,(Gh&130023424)===0&&(Gh=4194304)));var _=Ii();a=na(a,d),a!==null&&(au(a,d,_),fi(a,_))}function jC(a){var d=a.memoizedState,_=0;d!==null&&(_=d.retryLane),mS(a,_)}function ld(a,d){var _=0;switch(a.tag){case 13:var T=a.stateNode,I=a.memoizedState;I!==null&&(_=I.retryLane);break;case 19:T=a.stateNode;break;default:throw Error(f(314))}T!==null&&T.delete(d),mS(a,_)}var _S;_S=function(a,d,_){if(a!==null)if(a.memoizedProps!==d.pendingProps||Ri.current)Fi=!0;else{if((a.lanes&_)===0&&(d.flags&128)===0)return Fi=!1,kp(a,d,_);Fi=(a.flags&131072)!==0}else Fi=!1,Zn&&(d.flags&1048576)!==0&&Pv(d,hp,d.index);switch(d.lanes=0,d.tag){case 2:var T=d.type;Dp(a,d),a=d.pendingProps;var I=$a(d,di.current);Ks(d,_),I=td(null,d,T,a,I,_);var L=m_();return d.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,Vi(T)?(L=!0,lp(d)):L=!1,d.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,c_(d),I.updater=Ap,d.stateNode=I,I._reactInternals=d,T_(d,T,a,_),d=O_(null,d,T,!0,L,_)):(d.tag=0,Zn&&L&&Jl(d),bi(null,d,I,_),d=d.child),d;case 16:T=d.elementType;e:{switch(Dp(a,d),a=d.pendingProps,I=T._init,T=I(T._payload),d.type=T,I=d.tag=FC(T),a=_s(T,a),I){case 0:d=A_(null,d,T,a,_);break e;case 1:d=nS(null,d,T,a,_);break e;case 11:d=$v(null,d,T,a,_);break e;case 14:d=eS(null,d,T,_s(T.type,a),_);break e}throw Error(f(306,T,""))}return d;case 0:return T=d.type,I=d.pendingProps,I=d.elementType===T?I:_s(T,I),A_(a,d,T,I,_);case 1:return T=d.type,I=d.pendingProps,I=d.elementType===T?I:_s(T,I),nS(a,d,T,I,_);case 3:e:{if(rS(d),a===null)throw Error(f(387));T=d.pendingProps,L=d.memoizedState,I=L.element,xv(a,d),vp(d,T,null,_);var q=d.memoizedState;if(T=q.element,L.isDehydrated)if(L={element:T,isDehydrated:!1,cache:q.cache,pendingSuspenseBoundaries:q.pendingSuspenseBoundaries,transitions:q.transitions},d.updateQueue.baseState=L,d.memoizedState=L,d.flags&256){I=id(Error(f(423)),d),d=iS(a,d,T,_,I);break e}else if(T!==I){I=id(Error(f(424)),d),d=iS(a,d,T,_,I);break e}else for($i=So(d.stateNode.containerInfo.firstChild),Zi=d,Zn=!0,Hs=null,_=n_(d,null,T,_),d.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(Yc(),T===I){d=ca(a,d,_);break e}bi(a,d,T,_)}d=d.child}return d;case 5:return Vv(d),a===null&&Au(d),T=d.type,I=d.pendingProps,L=a!==null?a.memoizedProps:null,q=I.children,zl(T,I)?q=null:L!==null&&zl(T,L)&&(d.flags|=32),tS(a,d),bi(a,d,q,_),d.child;case 6:return a===null&&Au(d),null;case 13:return sS(a,d,_);case 4:return l_(d,d.stateNode.containerInfo),T=d.pendingProps,a===null?d.child=$l(d,null,T,_):bi(a,d,T,_),d.child;case 11:return T=d.type,I=d.pendingProps,I=d.elementType===T?I:_s(T,I),$v(a,d,T,I,_);case 7:return bi(a,d,d.pendingProps,_),d.child;case 8:return bi(a,d,d.pendingProps.children,_),d.child;case 12:return bi(a,d,d.pendingProps.children,_),d.child;case 10:e:{if(T=d.type._context,I=d.pendingProps,L=d.memoizedProps,q=I.value,Yn(mp,T._currentValue),T._currentValue=q,L!==null)if(Bs(L.value,q)){if(L.children===I.children&&!Ri.current){d=ca(a,d,_);break e}}else for(L=d.child,L!==null&&(L.return=d);L!==null;){var oe=L.dependencies;if(oe!==null){q=L.child;for(var me=oe.firstContext;me!==null;){if(me.context===T){if(L.tag===1){me=ia(-1,_&-_),me.tag=2;var Le=L.updateQueue;if(Le!==null){Le=Le.shared;var Ze=Le.pending;Ze===null?me.next=me:(me.next=Ze.next,Ze.next=me),Le.pending=me}}L.lanes|=_,me=L.alternate,me!==null&&(me.lanes|=_),gp(L.return,_,d),oe.lanes|=_;break}me=me.next}}else if(L.tag===10)q=L.type===d.type?null:L.child;else if(L.tag===18){if(q=L.return,q===null)throw Error(f(341));q.lanes|=_,oe=q.alternate,oe!==null&&(oe.lanes|=_),gp(q,_,d),q=L.sibling}else q=L.child;if(q!==null)q.return=L;else for(q=L;q!==null;){if(q===d){q=null;break}if(L=q.sibling,L!==null){L.return=q.return,q=L;break}q=q.return}L=q}bi(a,d,I.children,_),d=d.child}return d;case 9:return I=d.type,T=d.pendingProps.children,Ks(d,_),I=ms(I),T=T(I),d.flags|=1,bi(a,d,T,_),d.child;case 14:return T=d.type,I=_s(T,d.pendingProps),I=_s(T.type,I),eS(a,d,T,I,_);case 15:return I_(a,d,d.type,d.pendingProps,_);case 17:return T=d.type,I=d.pendingProps,I=d.elementType===T?I:_s(T,I),Dp(a,d),d.tag=1,Vi(T)?(a=!0,lp(d)):a=!1,Ks(d,_),qv(d,T,I),T_(d,T,I,_),O_(null,d,T,!0,a,_);case 19:return D_(a,d,_);case 22:return Co(a,d,_)}throw Error(f(156,d.tag))};function Z_(a,d){return Bc(a,d)}function $_(a,d,_,T){this.tag=a,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(a,d,_,T){return new $_(a,d,_,T)}function eg(a){return a=a.prototype,!(!a||!a.isReactComponent)}function FC(a){if(typeof a=="function")return eg(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Ue)return 11;if(a===dt)return 14}return 2}function pc(a,d){var _=a.alternate;return _===null?(_=vs(a.tag,d,a.key,a.mode),_.elementType=a.elementType,_.type=a.type,_.stateNode=a.stateNode,_.alternate=a,a.alternate=_):(_.pendingProps=d,_.type=a.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=a.flags&14680064,_.childLanes=a.childLanes,_.lanes=a.lanes,_.child=a.child,_.memoizedProps=a.memoizedProps,_.memoizedState=a.memoizedState,_.updateQueue=a.updateQueue,d=a.dependencies,_.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},_.sibling=a.sibling,_.index=a.index,_.ref=a.ref,_}function dd(a,d,_,T,I,L){var q=2;if(T=a,typeof a=="function")eg(a)&&(q=1);else if(typeof a=="string")q=5;else e:switch(a){case ue:return fc(_.children,I,L,d);case he:q=8,I|=8;break;case ye:return a=vs(12,_,d,I|2),a.elementType=ye,a.lanes=L,a;case xe:return a=vs(13,_,d,I),a.elementType=xe,a.lanes=L,a;case Ge:return a=vs(19,_,d,I),a.elementType=Ge,a.lanes=L,a;case We:return Qu(_,I,L,d);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Ve:q=10;break e;case Je:q=9;break e;case Ue:q=11;break e;case dt:q=14;break e;case Xe:q=16,T=null;break e}throw Error(f(130,a==null?a:typeof a,""))}return d=vs(q,_,d,I),d.elementType=a,d.type=T,d.lanes=L,d}function fc(a,d,_,T){return a=vs(7,a,T,d),a.lanes=_,a}function Qu(a,d,_,T){return a=vs(22,a,T,d),a.elementType=We,a.lanes=_,a.stateNode={isHidden:!1},a}function Hp(a,d,_){return a=vs(6,a,null,d),a.lanes=_,a}function ud(a,d,_){return d=vs(4,a.children!==null?a.children:[],a.key,d),d.lanes=_,d.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},d}function tg(a,d,_,T,I){this.tag=d,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vm(0),this.expirationTimes=vm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vm(0),this.identifierPrefix=T,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function hd(a,d,_,T,I,L,q,oe,me){return a=new tg(a,d,_,oe,me),d===1?(d=1,L===!0&&(d|=8)):d=0,L=vs(3,null,null,d),a.current=L,L.stateNode=a,L.memoizedState={element:T,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},c_(L),a}function Kp(a,d,_){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pe,key:T==null?null:""+T,children:a,containerInfo:d,implementation:_}}function ng(a){if(!a)return Qa;a=a._reactInternals;e:{if(Fc(a)!==a||a.tag!==1)throw Error(f(170));var d=a;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(Vi(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(f(171))}if(a.tag===1){var _=a.type;if(Vi(_))return Ov(a,_,d)}return d}function sl(a,d,_,T,I,L,q,oe,me){return a=hd(_,T,!0,a,I,L,q,oe,me),a.context=ng(null),_=a.current,T=Ii(),I=lc(_),L=ia(T,I),L.callback=d??null,zs(_,L,I),a.current.lanes=I,au(a,I,T),fi(a,T),a}function bo(a,d,_,T){var I=d.current,L=Ii(),q=lc(I);return _=ng(_),d.context===null?d.context=_:d.pendingContext=_,d=ia(L,q),d.payload={element:a},T=T===void 0?null:T,T!==null&&(d.callback=T),a=zs(I,d,q),a!==null&&(ns(a,I,q,L),Ep(a,I,q)),q}function zp(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function pd(a,d){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var _=a.retryLane;a.retryLane=_!==0&&_<d?_:d}}function rg(a,d){pd(a,d),(a=a.alternate)&&pd(a,d)}function BC(){return null}var gS=typeof reportError=="function"?reportError:function(a){console.error(a)};function ig(a){this._internalRoot=a}Zu.prototype.render=ig.prototype.render=function(a){var d=this._internalRoot;if(d===null)throw Error(f(409));bo(a,d,null,null)},Zu.prototype.unmount=ig.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var d=a.containerInfo;uc(function(){bo(null,a,null,null)}),d[Qo]=null}};function Zu(a){this._internalRoot=a}Zu.prototype.unstable_scheduleHydration=function(a){if(a){var d=ZE();a={blockedOn:null,target:a,priority:d};for(var _=0;_<Ha.length&&d!==0&&d<Ha[_].priority;_++);Ha.splice(_,0,a),_===0&&kl(a)}};function $u(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function eh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function ES(){}function vS(a,d,_,T,I){if(I){if(typeof T=="function"){var L=T;T=function(){var Le=zp(q);L.call(Le)}}var q=sl(d,T,a,0,null,!1,!1,"",ES);return a._reactRootContainer=q,a[Qo]=q.current,Jo(a.nodeType===8?a.parentNode:a),uc(),q}for(;I=a.lastChild;)a.removeChild(I);if(typeof T=="function"){var oe=T;T=function(){var Le=zp(me);oe.call(Le)}}var me=hd(a,0,!1,null,null,!1,!1,"",ES);return a._reactRootContainer=me,a[Qo]=me.current,Jo(a.nodeType===8?a.parentNode:a),uc(function(){bo(d,me,_,T)}),me}function Yp(a,d,_,T,I){var L=_._reactRootContainer;if(L){var q=L;if(typeof I=="function"){var oe=I;I=function(){var me=zp(q);oe.call(me)}}bo(d,q,a,I)}else q=vS(_,d,a,I,T);return zp(q)}Kh=function(a){switch(a.tag){case 3:var d=a.stateNode;if(d.current.memoizedState.isDehydrated){var _=An(d.pendingLanes);_!==0&&(Sm(d,_|1),fi(d,vr()),(ln&6)===0&&(gs=vr()+500,ec()))}break;case 13:uc(function(){var T=na(a,1);if(T!==null){var I=Ii();ns(T,a,1,I)}}),rg(a,1)}},Tm=function(a){if(a.tag===13){var d=na(a,134217728);if(d!==null){var _=Ii();ns(d,a,134217728,_)}rg(a,134217728)}},zh=function(a){if(a.tag===13){var d=lc(a),_=na(a,d);if(_!==null){var T=Ii();ns(_,a,d,T)}rg(a,d)}},ZE=function(){return On},Cm=function(a,d){var _=On;try{return On=a,d()}finally{On=_}},Al=function(a,d,_){switch(d){case"input":if(eu(a,_),d=_.name,_.type==="radio"&&d!=null){for(_=a;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<_.length;d++){var T=_[d];if(T!==a&&T.form===a.form){var I=ap(T);if(!I)throw Error(f(90));Ua(T),eu(T,I)}}}break;case"textarea":Ar(a,_);break;case"select":d=_.value,d!=null&&ki(a,!!_.multiple,d,!1)}},fn=il,Fn=uc;var th={usingClientEntryPoint:!1,Events:[bu,Yl,ap,Fa,Kt,il]},Bi={findFiberByHostInstance:Hc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},SS={bundleType:Bi.bundleType,version:Bi.version,rendererPackageName:Bi.rendererPackageName,rendererConfig:Bi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ne.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Bh(a),a===null?null:a.stateNode},findFiberByHostInstance:Bi.findFiberByHostInstance||BC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qp.isDisabled&&qp.supportsFiber)try{Nl=qp.inject(SS),Eo=qp}catch{}}return ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=th,ks.createPortal=function(a,d){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$u(d))throw Error(f(200));return Kp(a,d,null,_)},ks.createRoot=function(a,d){if(!$u(a))throw Error(f(299));var _=!1,T="",I=gS;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(T=d.identifierPrefix),d.onRecoverableError!==void 0&&(I=d.onRecoverableError)),d=hd(a,1,!1,null,null,_,!1,T,I),a[Qo]=d.current,Jo(a.nodeType===8?a.parentNode:a),new ig(d)},ks.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var d=a._reactInternals;if(d===void 0)throw typeof a.render=="function"?Error(f(188)):(a=Object.keys(a).join(","),Error(f(268,a)));return a=Bh(d),a=a===null?null:a.stateNode,a},ks.flushSync=function(a){return uc(a)},ks.hydrate=function(a,d,_){if(!eh(d))throw Error(f(200));return Yp(null,a,d,!0,_)},ks.hydrateRoot=function(a,d,_){if(!$u(a))throw Error(f(405));var T=_!=null&&_.hydratedSources||null,I=!1,L="",q=gS;if(_!=null&&(_.unstable_strictMode===!0&&(I=!0),_.identifierPrefix!==void 0&&(L=_.identifierPrefix),_.onRecoverableError!==void 0&&(q=_.onRecoverableError)),d=sl(d,null,a,1,_??null,I,!1,L,q),a[Qo]=d.current,Jo(a),T)for(a=0;a<T.length;a++)_=T[a],I=_._getVersion,I=I(_._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[_,I]:d.mutableSourceEagerHydrationData.push(_,I);return new Zu(d)},ks.render=function(a,d,_){if(!eh(d))throw Error(f(200));return Yp(null,a,d,!1,_)},ks.unmountComponentAtNode=function(a){if(!eh(a))throw Error(f(40));return a._reactRootContainer?(uc(function(){Yp(null,null,a,!1,function(){a._reactRootContainer=null,a[Qo]=null})}),!0):!1},ks.unstable_batchedUpdates=il,ks.unstable_renderSubtreeIntoContainer=function(a,d,_,T){if(!eh(_))throw Error(f(200));if(a==null||a._reactInternals===void 0)throw Error(f(38));return Yp(a,d,_,!1,T)},ks.version="18.3.1-next-f1338f8080-20240426",ks}var a4;function dj(){if(a4)return KI.exports;a4=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(h){console.error(h)}}return u(),KI.exports=EX(),KI.exports}var E0=dj();const uj=g0(E0);function ai(u,h,{checkForDefaultPrevented:f=!0}={}){return function(S){if(u?.(S),f===!1||!S.defaultPrevented)return h?.(S)}}function c4(u,h){if(typeof u=="function")return u(h);u!=null&&(u.current=h)}function hj(...u){return h=>{let f=!1;const g=u.map(S=>{const C=c4(S,h);return!f&&typeof C=="function"&&(f=!0),C});if(f)return()=>{for(let S=0;S<g.length;S++){const C=g[S];typeof C=="function"?C():c4(u[S],null)}}}}function ka(...u){return ee.useCallback(hj(...u),u)}function v0(u,h=[]){let f=[];function g(C,w){const P=ee.createContext(w),k=f.length;f=[...f,w];const M=B=>{const{scope:Y,children:H,...ie}=B,X=Y?.[u]?.[k]||P,te=ee.useMemo(()=>ie,Object.values(ie));return O.jsx(X.Provider,{value:te,children:H})};M.displayName=C+"Provider";function U(B,Y){const H=Y?.[u]?.[k]||P,ie=ee.useContext(H);if(ie)return ie;if(w!==void 0)return w;throw new Error(`\`${B}\` must be used within \`${C}\``)}return[M,U]}const S=()=>{const C=f.map(w=>ee.createContext(w));return function(P){const k=P?.[u]||C;return ee.useMemo(()=>({[`__scope${u}`]:{...P,[u]:k}}),[P,k])}};return S.scopeName=u,[g,vX(S,...h)]}function vX(...u){const h=u[0];if(u.length===1)return h;const f=()=>{const g=u.map(S=>({useScope:S(),scopeName:S.scopeName}));return function(C){const w=g.reduce((P,{useScope:k,scopeName:M})=>{const B=k(C)[`__scope${M}`];return{...P,...B}},{});return ee.useMemo(()=>({[`__scope${h.scopeName}`]:w}),[w])}};return f.scopeName=h.scopeName,f}function sA(u){const h=SX(u),f=ee.forwardRef((g,S)=>{const{children:C,...w}=g,P=ee.Children.toArray(C),k=P.find(TX);if(k){const M=k.props.children,U=P.map(B=>B===k?ee.Children.count(M)>1?ee.Children.only(null):ee.isValidElement(M)?M.props.children:null:B);return O.jsx(h,{...w,ref:S,children:ee.isValidElement(M)?ee.cloneElement(M,void 0,U):null})}return O.jsx(h,{...w,ref:S,children:C})});return f.displayName=`${u}.Slot`,f}function SX(u){const h=ee.forwardRef((f,g)=>{const{children:S,...C}=f;if(ee.isValidElement(S)){const w=RX(S),P=CX(C,S.props);return S.type!==ee.Fragment&&(P.ref=g?hj(g,w):w),ee.cloneElement(S,P)}return ee.Children.count(S)>1?ee.Children.only(null):null});return h.displayName=`${u}.SlotClone`,h}var pj=Symbol("radix.slottable");function yX(u){const h=({children:f})=>O.jsx(O.Fragment,{children:f});return h.displayName=`${u}.Slottable`,h.__radixId=pj,h}function TX(u){return ee.isValidElement(u)&&typeof u.type=="function"&&"__radixId"in u.type&&u.type.__radixId===pj}function CX(u,h){const f={...h};for(const g in h){const S=u[g],C=h[g];/^on[A-Z]/.test(g)?S&&C?f[g]=(...P)=>{const k=C(...P);return S(...P),k}:S&&(f[g]=S):g==="style"?f[g]={...S,...C}:g==="className"&&(f[g]=[S,C].filter(Boolean).join(" "))}return{...u,...f}}function RX(u){let h=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning;return f?u.ref:(h=Object.getOwnPropertyDescriptor(u,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning,f?u.props.ref:u.props.ref||u.ref)}function wX(u){const h=u+"CollectionProvider",[f,g]=v0(h),[S,C]=f(h,{collectionRef:{current:null},itemMap:new Map}),w=X=>{const{scope:te,children:ce}=X,Z=st.useRef(null),le=st.useRef(new Map).current;return O.jsx(S,{scope:te,itemMap:le,collectionRef:Z,children:ce})};w.displayName=h;const P=u+"CollectionSlot",k=sA(P),M=st.forwardRef((X,te)=>{const{scope:ce,children:Z}=X,le=C(P,ce),ne=ka(te,le.collectionRef);return O.jsx(k,{ref:ne,children:Z})});M.displayName=P;const U=u+"CollectionItemSlot",B="data-radix-collection-item",Y=sA(U),H=st.forwardRef((X,te)=>{const{scope:ce,children:Z,...le}=X,ne=st.useRef(null),de=ka(te,ne),Pe=C(U,ce);return st.useEffect(()=>(Pe.itemMap.set(ne,{ref:ne,...le}),()=>void Pe.itemMap.delete(ne))),O.jsx(Y,{[B]:"",ref:de,children:Z})});H.displayName=U;function ie(X){const te=C(u+"CollectionConsumer",X);return st.useCallback(()=>{const Z=te.collectionRef.current;if(!Z)return[];const le=Array.from(Z.querySelectorAll(`[${B}]`));return Array.from(te.itemMap.values()).sort((Pe,ue)=>le.indexOf(Pe.ref.current)-le.indexOf(ue.ref.current))},[te.collectionRef,te.itemMap])}return[{Provider:w,Slot:M,ItemSlot:H},ie,g]}var bX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xs=bX.reduce((u,h)=>{const f=sA(`Primitive.${h}`),g=ee.forwardRef((S,C)=>{const{asChild:w,...P}=S,k=w?f:h;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),O.jsx(k,{...P,ref:C})});return g.displayName=`Primitive.${h}`,{...u,[h]:g}},{});function fj(u,h){u&&E0.flushSync(()=>u.dispatchEvent(h))}function Yd(u){const h=ee.useRef(u);return ee.useEffect(()=>{h.current=u}),ee.useMemo(()=>(...f)=>h.current?.(...f),[])}function IX(u,h=globalThis?.document){const f=Yd(u);ee.useEffect(()=>{const g=S=>{S.key==="Escape"&&f(S)};return h.addEventListener("keydown",g,{capture:!0}),()=>h.removeEventListener("keydown",g,{capture:!0})},[f,h])}var AX="DismissableLayer",oA="dismissableLayer.update",OX="dismissableLayer.pointerDownOutside",NX="dismissableLayer.focusOutside",l4,mj=ee.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),RA=ee.forwardRef((u,h)=>{const{disableOutsidePointerEvents:f=!1,onEscapeKeyDown:g,onPointerDownOutside:S,onFocusOutside:C,onInteractOutside:w,onDismiss:P,...k}=u,M=ee.useContext(mj),[U,B]=ee.useState(null),Y=U?.ownerDocument??globalThis?.document,[,H]=ee.useState({}),ie=ka(h,ue=>B(ue)),X=Array.from(M.layers),[te]=[...M.layersWithOutsidePointerEventsDisabled].slice(-1),ce=X.indexOf(te),Z=U?X.indexOf(U):-1,le=M.layersWithOutsidePointerEventsDisabled.size>0,ne=Z>=ce,de=DX(ue=>{const he=ue.target,ye=[...M.branches].some(Ve=>Ve.contains(he));!ne||ye||(S?.(ue),w?.(ue),ue.defaultPrevented||P?.())},Y),Pe=kX(ue=>{const he=ue.target;[...M.branches].some(Ve=>Ve.contains(he))||(C?.(ue),w?.(ue),ue.defaultPrevented||P?.())},Y);return IX(ue=>{Z===M.layers.size-1&&(g?.(ue),!ue.defaultPrevented&&P&&(ue.preventDefault(),P()))},Y),ee.useEffect(()=>{if(U)return f&&(M.layersWithOutsidePointerEventsDisabled.size===0&&(l4=Y.body.style.pointerEvents,Y.body.style.pointerEvents="none"),M.layersWithOutsidePointerEventsDisabled.add(U)),M.layers.add(U),d4(),()=>{f&&M.layersWithOutsidePointerEventsDisabled.size===1&&(Y.body.style.pointerEvents=l4)}},[U,Y,f,M]),ee.useEffect(()=>()=>{U&&(M.layers.delete(U),M.layersWithOutsidePointerEventsDisabled.delete(U),d4())},[U,M]),ee.useEffect(()=>{const ue=()=>H({});return document.addEventListener(oA,ue),()=>document.removeEventListener(oA,ue)},[]),O.jsx(xs.div,{...k,ref:ie,style:{pointerEvents:le?ne?"auto":"none":void 0,...u.style},onFocusCapture:ai(u.onFocusCapture,Pe.onFocusCapture),onBlurCapture:ai(u.onBlurCapture,Pe.onBlurCapture),onPointerDownCapture:ai(u.onPointerDownCapture,de.onPointerDownCapture)})});RA.displayName=AX;var PX="DismissableLayerBranch",_j=ee.forwardRef((u,h)=>{const f=ee.useContext(mj),g=ee.useRef(null),S=ka(h,g);return ee.useEffect(()=>{const C=g.current;if(C)return f.branches.add(C),()=>{f.branches.delete(C)}},[f.branches]),O.jsx(xs.div,{...u,ref:S})});_j.displayName=PX;function DX(u,h=globalThis?.document){const f=Yd(u),g=ee.useRef(!1),S=ee.useRef(()=>{});return ee.useEffect(()=>{const C=P=>{if(P.target&&!g.current){let k=function(){gj(OX,f,M,{discrete:!0})};const M={originalEvent:P};P.pointerType==="touch"?(h.removeEventListener("click",S.current),S.current=k,h.addEventListener("click",S.current,{once:!0})):k()}else h.removeEventListener("click",S.current);g.current=!1},w=window.setTimeout(()=>{h.addEventListener("pointerdown",C)},0);return()=>{window.clearTimeout(w),h.removeEventListener("pointerdown",C),h.removeEventListener("click",S.current)}},[h,f]),{onPointerDownCapture:()=>g.current=!0}}function kX(u,h=globalThis?.document){const f=Yd(u),g=ee.useRef(!1);return ee.useEffect(()=>{const S=C=>{C.target&&!g.current&&gj(NX,f,{originalEvent:C},{discrete:!1})};return h.addEventListener("focusin",S),()=>h.removeEventListener("focusin",S)},[h,f]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function d4(){const u=new CustomEvent(oA);document.dispatchEvent(u)}function gj(u,h,f,{discrete:g}){const S=f.originalEvent.target,C=new CustomEvent(u,{bubbles:!1,cancelable:!0,detail:f});h&&S.addEventListener(u,h,{once:!0}),g?fj(S,C):S.dispatchEvent(C)}var LX=RA,xX=_j,qd=globalThis?.document?ee.useLayoutEffect:()=>{},MX="Portal",Ej=ee.forwardRef((u,h)=>{const{container:f,...g}=u,[S,C]=ee.useState(!1);qd(()=>C(!0),[]);const w=f||S&&globalThis?.document?.body;return w?uj.createPortal(O.jsx(xs.div,{...g,ref:h}),w):null});Ej.displayName=MX;function UX(u,h){return ee.useReducer((f,g)=>h[f][g]??f,u)}var wA=u=>{const{present:h,children:f}=u,g=VX(h),S=typeof f=="function"?f({present:g.isPresent}):ee.Children.only(f),C=ka(g.ref,jX(S));return typeof f=="function"||g.isPresent?ee.cloneElement(S,{ref:C}):null};wA.displayName="Presence";function VX(u){const[h,f]=ee.useState(),g=ee.useRef(null),S=ee.useRef(u),C=ee.useRef("none"),w=u?"mounted":"unmounted",[P,k]=UX(w,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ee.useEffect(()=>{const M=KT(g.current);C.current=P==="mounted"?M:"none"},[P]),qd(()=>{const M=g.current,U=S.current;if(U!==u){const Y=C.current,H=KT(M);u?k("MOUNT"):H==="none"||M?.display==="none"?k("UNMOUNT"):k(U&&Y!==H?"ANIMATION_OUT":"UNMOUNT"),S.current=u}},[u,k]),qd(()=>{if(h){let M;const U=h.ownerDocument.defaultView??window,B=H=>{const X=KT(g.current).includes(H.animationName);if(H.target===h&&X&&(k("ANIMATION_END"),!S.current)){const te=h.style.animationFillMode;h.style.animationFillMode="forwards",M=U.setTimeout(()=>{h.style.animationFillMode==="forwards"&&(h.style.animationFillMode=te)})}},Y=H=>{H.target===h&&(C.current=KT(g.current))};return h.addEventListener("animationstart",Y),h.addEventListener("animationcancel",B),h.addEventListener("animationend",B),()=>{U.clearTimeout(M),h.removeEventListener("animationstart",Y),h.removeEventListener("animationcancel",B),h.removeEventListener("animationend",B)}}else k("ANIMATION_END")},[h,k]),{isPresent:["mounted","unmountSuspended"].includes(P),ref:ee.useCallback(M=>{g.current=M?getComputedStyle(M):null,f(M)},[])}}function KT(u){return u?.animationName||"none"}function jX(u){let h=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning;return f?u.ref:(h=Object.getOwnPropertyDescriptor(u,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning,f?u.props.ref:u.props.ref||u.ref)}var FX=lj[" useInsertionEffect ".trim().toString()]||qd;function BX({prop:u,defaultProp:h,onChange:f=()=>{},caller:g}){const[S,C,w]=WX({defaultProp:h,onChange:f}),P=u!==void 0,k=P?u:S;{const U=ee.useRef(u!==void 0);ee.useEffect(()=>{const B=U.current;B!==P&&console.warn(`${g} is changing from ${B?"controlled":"uncontrolled"} to ${P?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),U.current=P},[P,g])}const M=ee.useCallback(U=>{if(P){const B=GX(U)?U(u):U;B!==u&&w.current?.(B)}else C(U)},[P,u,C,w]);return[k,M]}function WX({defaultProp:u,onChange:h}){const[f,g]=ee.useState(u),S=ee.useRef(f),C=ee.useRef(h);return FX(()=>{C.current=h},[h]),ee.useEffect(()=>{S.current!==f&&(C.current?.(f),S.current=f)},[f,S]),[f,g,C]}function GX(u){return typeof u=="function"}var HX=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),KX="VisuallyHidden",S0=ee.forwardRef((u,h)=>O.jsx(xs.span,{...u,ref:h,style:{...HX,...u.style}}));S0.displayName=KX;var zX=S0,bA="ToastProvider",[IA,YX,qX]=wX("Toast"),[vj,yne]=v0("Toast",[qX]),[XX,y0]=vj(bA),Sj=u=>{const{__scopeToast:h,label:f="Notification",duration:g=5e3,swipeDirection:S="right",swipeThreshold:C=50,children:w}=u,[P,k]=ee.useState(null),[M,U]=ee.useState(0),B=ee.useRef(!1),Y=ee.useRef(!1);return f.trim()||console.error(`Invalid prop \`label\` supplied to \`${bA}\`. Expected non-empty \`string\`.`),O.jsx(IA.Provider,{scope:h,children:O.jsx(XX,{scope:h,label:f,duration:g,swipeDirection:S,swipeThreshold:C,toastCount:M,viewport:P,onViewportChange:k,onToastAdd:ee.useCallback(()=>U(H=>H+1),[]),onToastRemove:ee.useCallback(()=>U(H=>H-1),[]),isFocusedToastEscapeKeyDownRef:B,isClosePausedRef:Y,children:w})})};Sj.displayName=bA;var yj="ToastViewport",JX=["F8"],aA="toast.viewportPause",cA="toast.viewportResume",Tj=ee.forwardRef((u,h)=>{const{__scopeToast:f,hotkey:g=JX,label:S="Notifications ({hotkey})",...C}=u,w=y0(yj,f),P=YX(f),k=ee.useRef(null),M=ee.useRef(null),U=ee.useRef(null),B=ee.useRef(null),Y=ka(h,B,w.onViewportChange),H=g.join("+").replace(/Key/g,"").replace(/Digit/g,""),ie=w.toastCount>0;ee.useEffect(()=>{const te=ce=>{g.length!==0&&g.every(le=>ce[le]||ce.code===le)&&B.current?.focus()};return document.addEventListener("keydown",te),()=>document.removeEventListener("keydown",te)},[g]),ee.useEffect(()=>{const te=k.current,ce=B.current;if(ie&&te&&ce){const Z=()=>{if(!w.isClosePausedRef.current){const Pe=new CustomEvent(aA);ce.dispatchEvent(Pe),w.isClosePausedRef.current=!0}},le=()=>{if(w.isClosePausedRef.current){const Pe=new CustomEvent(cA);ce.dispatchEvent(Pe),w.isClosePausedRef.current=!1}},ne=Pe=>{!te.contains(Pe.relatedTarget)&&le()},de=()=>{te.contains(document.activeElement)||le()};return te.addEventListener("focusin",Z),te.addEventListener("focusout",ne),te.addEventListener("pointermove",Z),te.addEventListener("pointerleave",de),window.addEventListener("blur",Z),window.addEventListener("focus",le),()=>{te.removeEventListener("focusin",Z),te.removeEventListener("focusout",ne),te.removeEventListener("pointermove",Z),te.removeEventListener("pointerleave",de),window.removeEventListener("blur",Z),window.removeEventListener("focus",le)}}},[ie,w.isClosePausedRef]);const X=ee.useCallback(({tabbingDirection:te})=>{const Z=P().map(le=>{const ne=le.ref.current,de=[ne,...lJ(ne)];return te==="forwards"?de:de.reverse()});return(te==="forwards"?Z.reverse():Z).flat()},[P]);return ee.useEffect(()=>{const te=B.current;if(te){const ce=Z=>{const le=Z.altKey||Z.ctrlKey||Z.metaKey;if(Z.key==="Tab"&&!le){const de=document.activeElement,Pe=Z.shiftKey;if(Z.target===te&&Pe){M.current?.focus();return}const ye=X({tabbingDirection:Pe?"backwards":"forwards"}),Ve=ye.findIndex(Je=>Je===de);qI(ye.slice(Ve+1))?Z.preventDefault():Pe?M.current?.focus():U.current?.focus()}};return te.addEventListener("keydown",ce),()=>te.removeEventListener("keydown",ce)}},[P,X]),O.jsxs(xX,{ref:k,role:"region","aria-label":S.replace("{hotkey}",H),tabIndex:-1,style:{pointerEvents:ie?void 0:"none"},children:[ie&&O.jsx(lA,{ref:M,onFocusFromOutsideViewport:()=>{const te=X({tabbingDirection:"forwards"});qI(te)}}),O.jsx(IA.Slot,{scope:f,children:O.jsx(xs.ol,{tabIndex:-1,...C,ref:Y})}),ie&&O.jsx(lA,{ref:U,onFocusFromOutsideViewport:()=>{const te=X({tabbingDirection:"backwards"});qI(te)}})]})});Tj.displayName=yj;var Cj="ToastFocusProxy",lA=ee.forwardRef((u,h)=>{const{__scopeToast:f,onFocusFromOutsideViewport:g,...S}=u,C=y0(Cj,f);return O.jsx(S0,{"aria-hidden":!0,tabIndex:0,...S,ref:h,style:{position:"fixed"},onFocus:w=>{const P=w.relatedTarget;!C.viewport?.contains(P)&&g()}})});lA.displayName=Cj;var xE="Toast",QX="toast.swipeStart",ZX="toast.swipeMove",$X="toast.swipeCancel",eJ="toast.swipeEnd",Rj=ee.forwardRef((u,h)=>{const{forceMount:f,open:g,defaultOpen:S,onOpenChange:C,...w}=u,[P,k]=BX({prop:g,defaultProp:S??!0,onChange:C,caller:xE});return O.jsx(wA,{present:f||P,children:O.jsx(rJ,{open:P,...w,ref:h,onClose:()=>k(!1),onPause:Yd(u.onPause),onResume:Yd(u.onResume),onSwipeStart:ai(u.onSwipeStart,M=>{M.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ai(u.onSwipeMove,M=>{const{x:U,y:B}=M.detail.delta;M.currentTarget.setAttribute("data-swipe","move"),M.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${U}px`),M.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${B}px`)}),onSwipeCancel:ai(u.onSwipeCancel,M=>{M.currentTarget.setAttribute("data-swipe","cancel"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),M.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),M.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ai(u.onSwipeEnd,M=>{const{x:U,y:B}=M.detail.delta;M.currentTarget.setAttribute("data-swipe","end"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),M.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${U}px`),M.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${B}px`),k(!1)})})})});Rj.displayName=xE;var[tJ,nJ]=vj(xE,{onClose(){}}),rJ=ee.forwardRef((u,h)=>{const{__scopeToast:f,type:g="foreground",duration:S,open:C,onClose:w,onEscapeKeyDown:P,onPause:k,onResume:M,onSwipeStart:U,onSwipeMove:B,onSwipeCancel:Y,onSwipeEnd:H,...ie}=u,X=y0(xE,f),[te,ce]=ee.useState(null),Z=ka(h,Ge=>ce(Ge)),le=ee.useRef(null),ne=ee.useRef(null),de=S||X.duration,Pe=ee.useRef(0),ue=ee.useRef(de),he=ee.useRef(0),{onToastAdd:ye,onToastRemove:Ve}=X,Je=Yd(()=>{te?.contains(document.activeElement)&&X.viewport?.focus(),w()}),Ue=ee.useCallback(Ge=>{!Ge||Ge===1/0||(window.clearTimeout(he.current),Pe.current=new Date().getTime(),he.current=window.setTimeout(Je,Ge))},[Je]);ee.useEffect(()=>{const Ge=X.viewport;if(Ge){const dt=()=>{Ue(ue.current),M?.()},Xe=()=>{const We=new Date().getTime()-Pe.current;ue.current=ue.current-We,window.clearTimeout(he.current),k?.()};return Ge.addEventListener(aA,Xe),Ge.addEventListener(cA,dt),()=>{Ge.removeEventListener(aA,Xe),Ge.removeEventListener(cA,dt)}}},[X.viewport,de,k,M,Ue]),ee.useEffect(()=>{C&&!X.isClosePausedRef.current&&Ue(de)},[C,de,X.isClosePausedRef,Ue]),ee.useEffect(()=>(ye(),()=>Ve()),[ye,Ve]);const xe=ee.useMemo(()=>te?Pj(te):null,[te]);return X.viewport?O.jsxs(O.Fragment,{children:[xe&&O.jsx(iJ,{__scopeToast:f,role:"status","aria-live":g==="foreground"?"assertive":"polite","aria-atomic":!0,children:xe}),O.jsx(tJ,{scope:f,onClose:Je,children:E0.createPortal(O.jsx(IA.ItemSlot,{scope:f,children:O.jsx(LX,{asChild:!0,onEscapeKeyDown:ai(P,()=>{X.isFocusedToastEscapeKeyDownRef.current||Je(),X.isFocusedToastEscapeKeyDownRef.current=!1}),children:O.jsx(xs.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":C?"open":"closed","data-swipe-direction":X.swipeDirection,...ie,ref:Z,style:{userSelect:"none",touchAction:"none",...u.style},onKeyDown:ai(u.onKeyDown,Ge=>{Ge.key==="Escape"&&(P?.(Ge.nativeEvent),Ge.nativeEvent.defaultPrevented||(X.isFocusedToastEscapeKeyDownRef.current=!0,Je()))}),onPointerDown:ai(u.onPointerDown,Ge=>{Ge.button===0&&(le.current={x:Ge.clientX,y:Ge.clientY})}),onPointerMove:ai(u.onPointerMove,Ge=>{if(!le.current)return;const dt=Ge.clientX-le.current.x,Xe=Ge.clientY-le.current.y,We=!!ne.current,Ie=["left","right"].includes(X.swipeDirection),De=["left","up"].includes(X.swipeDirection)?Math.min:Math.max,ze=Ie?De(0,dt):0,_e=Ie?0:De(0,Xe),ke=Ge.pointerType==="touch"?10:2,ct={x:ze,y:_e},at={originalEvent:Ge,delta:ct};We?(ne.current=ct,zT(ZX,B,at,{discrete:!1})):u4(ct,X.swipeDirection,ke)?(ne.current=ct,zT(QX,U,at,{discrete:!1}),Ge.target.setPointerCapture(Ge.pointerId)):(Math.abs(dt)>ke||Math.abs(Xe)>ke)&&(le.current=null)}),onPointerUp:ai(u.onPointerUp,Ge=>{const dt=ne.current,Xe=Ge.target;if(Xe.hasPointerCapture(Ge.pointerId)&&Xe.releasePointerCapture(Ge.pointerId),ne.current=null,le.current=null,dt){const We=Ge.currentTarget,Ie={originalEvent:Ge,delta:dt};u4(dt,X.swipeDirection,X.swipeThreshold)?zT(eJ,H,Ie,{discrete:!0}):zT($X,Y,Ie,{discrete:!0}),We.addEventListener("click",De=>De.preventDefault(),{once:!0})}})})})}),X.viewport)})]}):null}),iJ=u=>{const{__scopeToast:h,children:f,...g}=u,S=y0(xE,h),[C,w]=ee.useState(!1),[P,k]=ee.useState(!1);return aJ(()=>w(!0)),ee.useEffect(()=>{const M=window.setTimeout(()=>k(!0),1e3);return()=>window.clearTimeout(M)},[]),P?null:O.jsx(Ej,{asChild:!0,children:O.jsx(S0,{...g,children:C&&O.jsxs(O.Fragment,{children:[S.label," ",f]})})})},sJ="ToastTitle",wj=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u;return O.jsx(xs.div,{...g,ref:h})});wj.displayName=sJ;var oJ="ToastDescription",bj=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u;return O.jsx(xs.div,{...g,ref:h})});bj.displayName=oJ;var Ij="ToastAction",Aj=ee.forwardRef((u,h)=>{const{altText:f,...g}=u;return f.trim()?O.jsx(Nj,{altText:f,asChild:!0,children:O.jsx(AA,{...g,ref:h})}):(console.error(`Invalid prop \`altText\` supplied to \`${Ij}\`. Expected non-empty \`string\`.`),null)});Aj.displayName=Ij;var Oj="ToastClose",AA=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u,S=nJ(Oj,f);return O.jsx(Nj,{asChild:!0,children:O.jsx(xs.button,{type:"button",...g,ref:h,onClick:ai(u.onClick,S.onClose)})})});AA.displayName=Oj;var Nj=ee.forwardRef((u,h)=>{const{__scopeToast:f,altText:g,...S}=u;return O.jsx(xs.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":g||void 0,...S,ref:h})});function Pj(u){const h=[];return Array.from(u.childNodes).forEach(g=>{if(g.nodeType===g.TEXT_NODE&&g.textContent&&h.push(g.textContent),cJ(g)){const S=g.ariaHidden||g.hidden||g.style.display==="none",C=g.dataset.radixToastAnnounceExclude==="";if(!S)if(C){const w=g.dataset.radixToastAnnounceAlt;w&&h.push(w)}else h.push(...Pj(g))}}),h}function zT(u,h,f,{discrete:g}){const S=f.originalEvent.currentTarget,C=new CustomEvent(u,{bubbles:!0,cancelable:!0,detail:f});h&&S.addEventListener(u,h,{once:!0}),g?fj(S,C):S.dispatchEvent(C)}var u4=(u,h,f=0)=>{const g=Math.abs(u.x),S=Math.abs(u.y),C=g>S;return h==="left"||h==="right"?C&&g>f:!C&&S>f};function aJ(u=()=>{}){const h=Yd(u);qd(()=>{let f=0,g=0;return f=window.requestAnimationFrame(()=>g=window.requestAnimationFrame(h)),()=>{window.cancelAnimationFrame(f),window.cancelAnimationFrame(g)}},[h])}function cJ(u){return u.nodeType===u.ELEMENT_NODE}function lJ(u){const h=[],f=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const S=g.tagName==="INPUT"&&g.type==="hidden";return g.disabled||g.hidden||S?NodeFilter.FILTER_SKIP:g.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;f.nextNode();)h.push(f.currentNode);return h}function qI(u){const h=document.activeElement;return u.some(f=>f===h?!0:(f.focus(),document.activeElement!==h))}var dJ=Sj,Dj=Tj,kj=Rj,Lj=wj,xj=bj,Mj=Aj,Uj=AA;function Vj(u){var h,f,g="";if(typeof u=="string"||typeof u=="number")g+=u;else if(typeof u=="object")if(Array.isArray(u)){var S=u.length;for(h=0;h<S;h++)u[h]&&(f=Vj(u[h]))&&(g&&(g+=" "),g+=f)}else for(f in u)u[f]&&(g&&(g+=" "),g+=f);return g}function jj(){for(var u,h,f=0,g="",S=arguments.length;f<S;f++)(u=arguments[f])&&(h=Vj(u))&&(g&&(g+=" "),g+=h);return g}const h4=u=>typeof u=="boolean"?`${u}`:u===0?"0":u,p4=jj,uJ=(u,h)=>f=>{var g;if(h?.variants==null)return p4(u,f?.class,f?.className);const{variants:S,defaultVariants:C}=h,w=Object.keys(S).map(M=>{const U=f?.[M],B=C?.[M];if(U===null)return null;const Y=h4(U)||h4(B);return S[M][Y]}),P=f&&Object.entries(f).reduce((M,U)=>{let[B,Y]=U;return Y===void 0||(M[B]=Y),M},{}),k=h==null||(g=h.compoundVariants)===null||g===void 0?void 0:g.reduce((M,U)=>{let{class:B,className:Y,...H}=U;return Object.entries(H).every(ie=>{let[X,te]=ie;return Array.isArray(te)?te.includes({...C,...P}[X]):{...C,...P}[X]===te})?[...M,B,Y]:M},[]);return p4(u,w,k,f?.class,f?.className)};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hJ=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pJ=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(h,f,g)=>g?g.toUpperCase():f.toLowerCase()),f4=u=>{const h=pJ(u);return h.charAt(0).toUpperCase()+h.slice(1)},Fj=(...u)=>u.filter((h,f,g)=>!!h&&h.trim()!==""&&g.indexOf(h)===f).join(" ").trim(),fJ=u=>{for(const h in u)if(h.startsWith("aria-")||h==="role"||h==="title")return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var mJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _J=ee.forwardRef(({color:u="currentColor",size:h=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:S="",children:C,iconNode:w,...P},k)=>ee.createElement("svg",{ref:k,...mJ,width:h,height:h,stroke:u,strokeWidth:g?Number(f)*24/Number(h):f,className:Fj("lucide",S),...!C&&!fJ(P)&&{"aria-hidden":"true"},...P},[...w.map(([M,U])=>ee.createElement(M,U)),...Array.isArray(C)?C:[C]]));/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OA=(u,h)=>{const f=ee.forwardRef(({className:g,...S},C)=>ee.createElement(_J,{ref:C,iconNode:h,className:Fj(`lucide-${hJ(f4(u))}`,`lucide-${u}`,g),...S}));return f.displayName=f4(u),f};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gJ=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Bj=OA("eye-off",gJ);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EJ=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Wj=OA("eye",EJ);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vJ=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],SJ=OA("x",vJ),NA="-",yJ=u=>{const h=CJ(u),{conflictingClassGroups:f,conflictingClassGroupModifiers:g}=u;return{getClassGroupId:w=>{const P=w.split(NA);return P[0]===""&&P.length!==1&&P.shift(),Gj(P,h)||TJ(w)},getConflictingClassGroupIds:(w,P)=>{const k=f[w]||[];return P&&g[w]?[...k,...g[w]]:k}}},Gj=(u,h)=>{if(u.length===0)return h.classGroupId;const f=u[0],g=h.nextPart.get(f),S=g?Gj(u.slice(1),g):void 0;if(S)return S;if(h.validators.length===0)return;const C=u.join(NA);return h.validators.find(({validator:w})=>w(C))?.classGroupId},m4=/^\[(.+)\]$/,TJ=u=>{if(m4.test(u)){const h=m4.exec(u)[1],f=h?.substring(0,h.indexOf(":"));if(f)return"arbitrary.."+f}},CJ=u=>{const{theme:h,prefix:f}=u,g={nextPart:new Map,validators:[]};return wJ(Object.entries(u.classGroups),f).forEach(([C,w])=>{dA(w,g,C,h)}),g},dA=(u,h,f,g)=>{u.forEach(S=>{if(typeof S=="string"){const C=S===""?h:_4(h,S);C.classGroupId=f;return}if(typeof S=="function"){if(RJ(S)){dA(S(g),h,f,g);return}h.validators.push({validator:S,classGroupId:f});return}Object.entries(S).forEach(([C,w])=>{dA(w,_4(h,C),f,g)})})},_4=(u,h)=>{let f=u;return h.split(NA).forEach(g=>{f.nextPart.has(g)||f.nextPart.set(g,{nextPart:new Map,validators:[]}),f=f.nextPart.get(g)}),f},RJ=u=>u.isThemeGetter,wJ=(u,h)=>h?u.map(([f,g])=>{const S=g.map(C=>typeof C=="string"?h+C:typeof C=="object"?Object.fromEntries(Object.entries(C).map(([w,P])=>[h+w,P])):C);return[f,S]}):u,bJ=u=>{if(u<1)return{get:()=>{},set:()=>{}};let h=0,f=new Map,g=new Map;const S=(C,w)=>{f.set(C,w),h++,h>u&&(h=0,g=f,f=new Map)};return{get(C){let w=f.get(C);if(w!==void 0)return w;if((w=g.get(C))!==void 0)return S(C,w),w},set(C,w){f.has(C)?f.set(C,w):S(C,w)}}},Hj="!",IJ=u=>{const{separator:h,experimentalParseClassName:f}=u,g=h.length===1,S=h[0],C=h.length,w=P=>{const k=[];let M=0,U=0,B;for(let te=0;te<P.length;te++){let ce=P[te];if(M===0){if(ce===S&&(g||P.slice(te,te+C)===h)){k.push(P.slice(U,te)),U=te+C;continue}if(ce==="/"){B=te;continue}}ce==="["?M++:ce==="]"&&M--}const Y=k.length===0?P:P.substring(U),H=Y.startsWith(Hj),ie=H?Y.substring(1):Y,X=B&&B>U?B-U:void 0;return{modifiers:k,hasImportantModifier:H,baseClassName:ie,maybePostfixModifierPosition:X}};return f?P=>f({className:P,parseClassName:w}):w},AJ=u=>{if(u.length<=1)return u;const h=[];let f=[];return u.forEach(g=>{g[0]==="["?(h.push(...f.sort(),g),f=[]):f.push(g)}),h.push(...f.sort()),h},OJ=u=>({cache:bJ(u.cacheSize),parseClassName:IJ(u),...yJ(u)}),NJ=/\s+/,PJ=(u,h)=>{const{parseClassName:f,getClassGroupId:g,getConflictingClassGroupIds:S}=h,C=[],w=u.trim().split(NJ);let P="";for(let k=w.length-1;k>=0;k-=1){const M=w[k],{modifiers:U,hasImportantModifier:B,baseClassName:Y,maybePostfixModifierPosition:H}=f(M);let ie=!!H,X=g(ie?Y.substring(0,H):Y);if(!X){if(!ie){P=M+(P.length>0?" "+P:P);continue}if(X=g(Y),!X){P=M+(P.length>0?" "+P:P);continue}ie=!1}const te=AJ(U).join(":"),ce=B?te+Hj:te,Z=ce+X;if(C.includes(Z))continue;C.push(Z);const le=S(X,ie);for(let ne=0;ne<le.length;++ne){const de=le[ne];C.push(ce+de)}P=M+(P.length>0?" "+P:P)}return P};function DJ(){let u=0,h,f,g="";for(;u<arguments.length;)(h=arguments[u++])&&(f=Kj(h))&&(g&&(g+=" "),g+=f);return g}const Kj=u=>{if(typeof u=="string")return u;let h,f="";for(let g=0;g<u.length;g++)u[g]&&(h=Kj(u[g]))&&(f&&(f+=" "),f+=h);return f};function kJ(u,...h){let f,g,S,C=w;function w(k){const M=h.reduce((U,B)=>B(U),u());return f=OJ(M),g=f.cache.get,S=f.cache.set,C=P,P(k)}function P(k){const M=g(k);if(M)return M;const U=PJ(k,f);return S(k,U),U}return function(){return C(DJ.apply(null,arguments))}}const hr=u=>{const h=f=>f[u]||[];return h.isThemeGetter=!0,h},zj=/^\[(?:([a-z-]+):)?(.+)\]$/i,LJ=/^\d+\/\d+$/,xJ=new Set(["px","full","screen"]),MJ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,UJ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,VJ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,jJ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,FJ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Tl=u=>rm(u)||xJ.has(u)||LJ.test(u),Bd=u=>cm(u,"length",qJ),rm=u=>!!u&&!Number.isNaN(Number(u)),XI=u=>cm(u,"number",rm),EE=u=>!!u&&Number.isInteger(Number(u)),BJ=u=>u.endsWith("%")&&rm(u.slice(0,-1)),cn=u=>zj.test(u),Wd=u=>MJ.test(u),WJ=new Set(["length","size","percentage"]),GJ=u=>cm(u,WJ,Yj),HJ=u=>cm(u,"position",Yj),KJ=new Set(["image","url"]),zJ=u=>cm(u,KJ,JJ),YJ=u=>cm(u,"",XJ),vE=()=>!0,cm=(u,h,f)=>{const g=zj.exec(u);return g?g[1]?typeof h=="string"?g[1]===h:h.has(g[1]):f(g[2]):!1},qJ=u=>UJ.test(u)&&!VJ.test(u),Yj=()=>!1,XJ=u=>jJ.test(u),JJ=u=>FJ.test(u),QJ=()=>{const u=hr("colors"),h=hr("spacing"),f=hr("blur"),g=hr("brightness"),S=hr("borderColor"),C=hr("borderRadius"),w=hr("borderSpacing"),P=hr("borderWidth"),k=hr("contrast"),M=hr("grayscale"),U=hr("hueRotate"),B=hr("invert"),Y=hr("gap"),H=hr("gradientColorStops"),ie=hr("gradientColorStopPositions"),X=hr("inset"),te=hr("margin"),ce=hr("opacity"),Z=hr("padding"),le=hr("saturate"),ne=hr("scale"),de=hr("sepia"),Pe=hr("skew"),ue=hr("space"),he=hr("translate"),ye=()=>["auto","contain","none"],Ve=()=>["auto","hidden","clip","visible","scroll"],Je=()=>["auto",cn,h],Ue=()=>[cn,h],xe=()=>["",Tl,Bd],Ge=()=>["auto",rm,cn],dt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Xe=()=>["solid","dashed","dotted","double","none"],We=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ie=()=>["start","end","center","between","around","evenly","stretch"],De=()=>["","0",cn],ze=()=>["auto","avoid","all","avoid-page","page","left","right","column"],_e=()=>[rm,cn];return{cacheSize:500,separator:":",theme:{colors:[vE],spacing:[Tl,Bd],blur:["none","",Wd,cn],brightness:_e(),borderColor:[u],borderRadius:["none","","full",Wd,cn],borderSpacing:Ue(),borderWidth:xe(),contrast:_e(),grayscale:De(),hueRotate:_e(),invert:De(),gap:Ue(),gradientColorStops:[u],gradientColorStopPositions:[BJ,Bd],inset:Je(),margin:Je(),opacity:_e(),padding:Ue(),saturate:_e(),scale:_e(),sepia:De(),skew:_e(),space:Ue(),translate:Ue()},classGroups:{aspect:[{aspect:["auto","square","video",cn]}],container:["container"],columns:[{columns:[Wd]}],"break-after":[{"break-after":ze()}],"break-before":[{"break-before":ze()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...dt(),cn]}],overflow:[{overflow:Ve()}],"overflow-x":[{"overflow-x":Ve()}],"overflow-y":[{"overflow-y":Ve()}],overscroll:[{overscroll:ye()}],"overscroll-x":[{"overscroll-x":ye()}],"overscroll-y":[{"overscroll-y":ye()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[X]}],"inset-x":[{"inset-x":[X]}],"inset-y":[{"inset-y":[X]}],start:[{start:[X]}],end:[{end:[X]}],top:[{top:[X]}],right:[{right:[X]}],bottom:[{bottom:[X]}],left:[{left:[X]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",EE,cn]}],basis:[{basis:Je()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",cn]}],grow:[{grow:De()}],shrink:[{shrink:De()}],order:[{order:["first","last","none",EE,cn]}],"grid-cols":[{"grid-cols":[vE]}],"col-start-end":[{col:["auto",{span:["full",EE,cn]},cn]}],"col-start":[{"col-start":Ge()}],"col-end":[{"col-end":Ge()}],"grid-rows":[{"grid-rows":[vE]}],"row-start-end":[{row:["auto",{span:[EE,cn]},cn]}],"row-start":[{"row-start":Ge()}],"row-end":[{"row-end":Ge()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",cn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",cn]}],gap:[{gap:[Y]}],"gap-x":[{"gap-x":[Y]}],"gap-y":[{"gap-y":[Y]}],"justify-content":[{justify:["normal",...Ie()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ie(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ie(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Z]}],px:[{px:[Z]}],py:[{py:[Z]}],ps:[{ps:[Z]}],pe:[{pe:[Z]}],pt:[{pt:[Z]}],pr:[{pr:[Z]}],pb:[{pb:[Z]}],pl:[{pl:[Z]}],m:[{m:[te]}],mx:[{mx:[te]}],my:[{my:[te]}],ms:[{ms:[te]}],me:[{me:[te]}],mt:[{mt:[te]}],mr:[{mr:[te]}],mb:[{mb:[te]}],ml:[{ml:[te]}],"space-x":[{"space-x":[ue]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ue]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",cn,h]}],"min-w":[{"min-w":[cn,h,"min","max","fit"]}],"max-w":[{"max-w":[cn,h,"none","full","min","max","fit","prose",{screen:[Wd]},Wd]}],h:[{h:[cn,h,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[cn,h,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[cn,h,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[cn,h,"auto","min","max","fit"]}],"font-size":[{text:["base",Wd,Bd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",XI]}],"font-family":[{font:[vE]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",cn]}],"line-clamp":[{"line-clamp":["none",rm,XI]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Tl,cn]}],"list-image":[{"list-image":["none",cn]}],"list-style-type":[{list:["none","disc","decimal",cn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[u]}],"placeholder-opacity":[{"placeholder-opacity":[ce]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[u]}],"text-opacity":[{"text-opacity":[ce]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Tl,Bd]}],"underline-offset":[{"underline-offset":["auto",Tl,cn]}],"text-decoration-color":[{decoration:[u]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ue()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",cn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",cn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ce]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...dt(),HJ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",GJ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},zJ]}],"bg-color":[{bg:[u]}],"gradient-from-pos":[{from:[ie]}],"gradient-via-pos":[{via:[ie]}],"gradient-to-pos":[{to:[ie]}],"gradient-from":[{from:[H]}],"gradient-via":[{via:[H]}],"gradient-to":[{to:[H]}],rounded:[{rounded:[C]}],"rounded-s":[{"rounded-s":[C]}],"rounded-e":[{"rounded-e":[C]}],"rounded-t":[{"rounded-t":[C]}],"rounded-r":[{"rounded-r":[C]}],"rounded-b":[{"rounded-b":[C]}],"rounded-l":[{"rounded-l":[C]}],"rounded-ss":[{"rounded-ss":[C]}],"rounded-se":[{"rounded-se":[C]}],"rounded-ee":[{"rounded-ee":[C]}],"rounded-es":[{"rounded-es":[C]}],"rounded-tl":[{"rounded-tl":[C]}],"rounded-tr":[{"rounded-tr":[C]}],"rounded-br":[{"rounded-br":[C]}],"rounded-bl":[{"rounded-bl":[C]}],"border-w":[{border:[P]}],"border-w-x":[{"border-x":[P]}],"border-w-y":[{"border-y":[P]}],"border-w-s":[{"border-s":[P]}],"border-w-e":[{"border-e":[P]}],"border-w-t":[{"border-t":[P]}],"border-w-r":[{"border-r":[P]}],"border-w-b":[{"border-b":[P]}],"border-w-l":[{"border-l":[P]}],"border-opacity":[{"border-opacity":[ce]}],"border-style":[{border:[...Xe(),"hidden"]}],"divide-x":[{"divide-x":[P]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[P]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ce]}],"divide-style":[{divide:Xe()}],"border-color":[{border:[S]}],"border-color-x":[{"border-x":[S]}],"border-color-y":[{"border-y":[S]}],"border-color-s":[{"border-s":[S]}],"border-color-e":[{"border-e":[S]}],"border-color-t":[{"border-t":[S]}],"border-color-r":[{"border-r":[S]}],"border-color-b":[{"border-b":[S]}],"border-color-l":[{"border-l":[S]}],"divide-color":[{divide:[S]}],"outline-style":[{outline:["",...Xe()]}],"outline-offset":[{"outline-offset":[Tl,cn]}],"outline-w":[{outline:[Tl,Bd]}],"outline-color":[{outline:[u]}],"ring-w":[{ring:xe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[u]}],"ring-opacity":[{"ring-opacity":[ce]}],"ring-offset-w":[{"ring-offset":[Tl,Bd]}],"ring-offset-color":[{"ring-offset":[u]}],shadow:[{shadow:["","inner","none",Wd,YJ]}],"shadow-color":[{shadow:[vE]}],opacity:[{opacity:[ce]}],"mix-blend":[{"mix-blend":[...We(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":We()}],filter:[{filter:["","none"]}],blur:[{blur:[f]}],brightness:[{brightness:[g]}],contrast:[{contrast:[k]}],"drop-shadow":[{"drop-shadow":["","none",Wd,cn]}],grayscale:[{grayscale:[M]}],"hue-rotate":[{"hue-rotate":[U]}],invert:[{invert:[B]}],saturate:[{saturate:[le]}],sepia:[{sepia:[de]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[f]}],"backdrop-brightness":[{"backdrop-brightness":[g]}],"backdrop-contrast":[{"backdrop-contrast":[k]}],"backdrop-grayscale":[{"backdrop-grayscale":[M]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[U]}],"backdrop-invert":[{"backdrop-invert":[B]}],"backdrop-opacity":[{"backdrop-opacity":[ce]}],"backdrop-saturate":[{"backdrop-saturate":[le]}],"backdrop-sepia":[{"backdrop-sepia":[de]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[w]}],"border-spacing-x":[{"border-spacing-x":[w]}],"border-spacing-y":[{"border-spacing-y":[w]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",cn]}],duration:[{duration:_e()}],ease:[{ease:["linear","in","out","in-out",cn]}],delay:[{delay:_e()}],animate:[{animate:["none","spin","ping","pulse","bounce",cn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ne]}],"scale-x":[{"scale-x":[ne]}],"scale-y":[{"scale-y":[ne]}],rotate:[{rotate:[EE,cn]}],"translate-x":[{"translate-x":[he]}],"translate-y":[{"translate-y":[he]}],"skew-x":[{"skew-x":[Pe]}],"skew-y":[{"skew-y":[Pe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",cn]}],accent:[{accent:["auto",u]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",cn]}],"caret-color":[{caret:[u]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ue()}],"scroll-mx":[{"scroll-mx":Ue()}],"scroll-my":[{"scroll-my":Ue()}],"scroll-ms":[{"scroll-ms":Ue()}],"scroll-me":[{"scroll-me":Ue()}],"scroll-mt":[{"scroll-mt":Ue()}],"scroll-mr":[{"scroll-mr":Ue()}],"scroll-mb":[{"scroll-mb":Ue()}],"scroll-ml":[{"scroll-ml":Ue()}],"scroll-p":[{"scroll-p":Ue()}],"scroll-px":[{"scroll-px":Ue()}],"scroll-py":[{"scroll-py":Ue()}],"scroll-ps":[{"scroll-ps":Ue()}],"scroll-pe":[{"scroll-pe":Ue()}],"scroll-pt":[{"scroll-pt":Ue()}],"scroll-pr":[{"scroll-pr":Ue()}],"scroll-pb":[{"scroll-pb":Ue()}],"scroll-pl":[{"scroll-pl":Ue()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",cn]}],fill:[{fill:[u,"none"]}],"stroke-w":[{stroke:[Tl,Bd,XI]}],stroke:[{stroke:[u,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},ZJ=kJ(QJ);function jh(...u){return ZJ(jj(u))}const $J=dJ,qj=ee.forwardRef(({className:u,...h},f)=>O.jsx(Dj,{ref:f,className:jh("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",u),...h}));qj.displayName=Dj.displayName;const eQ=uJ("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Xj=ee.forwardRef(({className:u,variant:h,...f},g)=>O.jsx(kj,{ref:g,className:jh(eQ({variant:h}),u),...f}));Xj.displayName=kj.displayName;const tQ=ee.forwardRef(({className:u,...h},f)=>O.jsx(Mj,{ref:f,className:jh("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",u),...h}));tQ.displayName=Mj.displayName;const Jj=ee.forwardRef(({className:u,...h},f)=>O.jsx(Uj,{ref:f,className:jh("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",u),"toast-close":"",...h,children:O.jsx(SJ,{className:"h-4 w-4"})}));Jj.displayName=Uj.displayName;const Qj=ee.forwardRef(({className:u,...h},f)=>O.jsx(Lj,{ref:f,className:jh("text-sm font-semibold",u),...h}));Qj.displayName=Lj.displayName;const Zj=ee.forwardRef(({className:u,...h},f)=>O.jsx(xj,{ref:f,className:jh("text-sm opacity-90",u),...h}));Zj.displayName=xj.displayName;function nQ(){const{toasts:u}=mX();return O.jsxs($J,{children:[u.map(function({id:h,title:f,description:g,action:S,...C}){return O.jsxs(Xj,{...C,children:[O.jsxs("div",{className:"grid gap-1",children:[f&&O.jsx(Qj,{children:f}),g&&O.jsx(Zj,{children:g})]}),S,O.jsx(Jj,{})]},h)}),O.jsx(qj,{})]})}var YT={},g4;function rQ(){if(g4)return YT;g4=1;var u=dj();return YT.createRoot=u.createRoot,YT.hydrateRoot=u.hydrateRoot,YT}var iQ=rQ(),sQ=(u,h,f,g,S,C,w,P)=>{let k=document.documentElement,M=["light","dark"];function U(H){(Array.isArray(u)?u:[u]).forEach(ie=>{let X=ie==="class",te=X&&C?S.map(ce=>C[ce]||ce):S;X?(k.classList.remove(...te),k.classList.add(C&&C[H]?C[H]:H)):k.setAttribute(ie,H)}),B(H)}function B(H){P&&M.includes(H)&&(k.style.colorScheme=H)}function Y(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(g)U(g);else try{let H=localStorage.getItem(h)||f,ie=w&&H==="system"?Y():H;U(ie)}catch{}},oQ=ee.createContext(void 0),aQ={setTheme:u=>{},themes:[]},cQ=()=>{var u;return(u=ee.useContext(oQ))!=null?u:aQ};ee.memo(({forcedTheme:u,storageKey:h,attribute:f,enableSystem:g,enableColorScheme:S,defaultTheme:C,value:w,themes:P,nonce:k,scriptProps:M})=>{let U=JSON.stringify([f,h,C,u,P,w,g,S]).slice(1,-1);return ee.createElement("script",{...M,suppressHydrationWarning:!0,nonce:typeof window>"u"?k:"",dangerouslySetInnerHTML:{__html:`(${sQ.toString()})(${U})`}})});var lQ=u=>{switch(u){case"success":return hQ;case"info":return fQ;case"warning":return pQ;case"error":return mQ;default:return null}},dQ=Array(12).fill(0),uQ=({visible:u,className:h})=>st.createElement("div",{className:["sonner-loading-wrapper",h].filter(Boolean).join(" "),"data-visible":u},st.createElement("div",{className:"sonner-spinner"},dQ.map((f,g)=>st.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${g}`})))),hQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),pQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),fQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),mQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),_Q=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},st.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),st.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),gQ=()=>{let[u,h]=st.useState(document.hidden);return st.useEffect(()=>{let f=()=>{h(document.hidden)};return document.addEventListener("visibilitychange",f),()=>window.removeEventListener("visibilitychange",f)},[]),u},uA=1,EQ=class{constructor(){this.subscribe=u=>(this.subscribers.push(u),()=>{let h=this.subscribers.indexOf(u);this.subscribers.splice(h,1)}),this.publish=u=>{this.subscribers.forEach(h=>h(u))},this.addToast=u=>{this.publish(u),this.toasts=[...this.toasts,u]},this.create=u=>{var h;let{message:f,...g}=u,S=typeof u?.id=="number"||((h=u.id)==null?void 0:h.length)>0?u.id:uA++,C=this.toasts.find(P=>P.id===S),w=u.dismissible===void 0?!0:u.dismissible;return this.dismissedToasts.has(S)&&this.dismissedToasts.delete(S),C?this.toasts=this.toasts.map(P=>P.id===S?(this.publish({...P,...u,id:S,title:f}),{...P,...u,id:S,dismissible:w,title:f}):P):this.addToast({title:f,...g,dismissible:w,id:S}),S},this.dismiss=u=>(this.dismissedToasts.add(u),u||this.toasts.forEach(h=>{this.subscribers.forEach(f=>f({id:h.id,dismiss:!0}))}),this.subscribers.forEach(h=>h({id:u,dismiss:!0})),u),this.message=(u,h)=>this.create({...h,message:u}),this.error=(u,h)=>this.create({...h,message:u,type:"error"}),this.success=(u,h)=>this.create({...h,type:"success",message:u}),this.info=(u,h)=>this.create({...h,type:"info",message:u}),this.warning=(u,h)=>this.create({...h,type:"warning",message:u}),this.loading=(u,h)=>this.create({...h,type:"loading",message:u}),this.promise=(u,h)=>{if(!h)return;let f;h.loading!==void 0&&(f=this.create({...h,promise:u,type:"loading",message:h.loading,description:typeof h.description!="function"?h.description:void 0}));let g=u instanceof Promise?u:u(),S=f!==void 0,C,w=g.then(async k=>{if(C=["resolve",k],st.isValidElement(k))S=!1,this.create({id:f,type:"default",message:k});else if(SQ(k)&&!k.ok){S=!1;let M=typeof h.error=="function"?await h.error(`HTTP error! status: ${k.status}`):h.error,U=typeof h.description=="function"?await h.description(`HTTP error! status: ${k.status}`):h.description;this.create({id:f,type:"error",message:M,description:U})}else if(h.success!==void 0){S=!1;let M=typeof h.success=="function"?await h.success(k):h.success,U=typeof h.description=="function"?await h.description(k):h.description;this.create({id:f,type:"success",message:M,description:U})}}).catch(async k=>{if(C=["reject",k],h.error!==void 0){S=!1;let M=typeof h.error=="function"?await h.error(k):h.error,U=typeof h.description=="function"?await h.description(k):h.description;this.create({id:f,type:"error",message:M,description:U})}}).finally(()=>{var k;S&&(this.dismiss(f),f=void 0),(k=h.finally)==null||k.call(h)}),P=()=>new Promise((k,M)=>w.then(()=>C[0]==="reject"?M(C[1]):k(C[1])).catch(M));return typeof f!="string"&&typeof f!="number"?{unwrap:P}:Object.assign(f,{unwrap:P})},this.custom=(u,h)=>{let f=h?.id||uA++;return this.create({jsx:u(f),id:f,...h}),f},this.getActiveToasts=()=>this.toasts.filter(u=>!this.dismissedToasts.has(u.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Ls=new EQ,vQ=(u,h)=>{let f=h?.id||uA++;return Ls.addToast({title:u,...h,id:f}),f},SQ=u=>u&&typeof u=="object"&&"ok"in u&&typeof u.ok=="boolean"&&"status"in u&&typeof u.status=="number",yQ=vQ,TQ=()=>Ls.toasts,CQ=()=>Ls.getActiveToasts();Object.assign(yQ,{success:Ls.success,info:Ls.info,warning:Ls.warning,error:Ls.error,custom:Ls.custom,message:Ls.message,promise:Ls.promise,dismiss:Ls.dismiss,loading:Ls.loading},{getHistory:TQ,getToasts:CQ});function RQ(u,{insertAt:h}={}){if(typeof document>"u")return;let f=document.head||document.getElementsByTagName("head")[0],g=document.createElement("style");g.type="text/css",h==="top"&&f.firstChild?f.insertBefore(g,f.firstChild):f.appendChild(g),g.styleSheet?g.styleSheet.cssText=u:g.appendChild(document.createTextNode(u))}RQ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function qT(u){return u.label!==void 0}var wQ=3,bQ="32px",IQ="16px",E4=4e3,AQ=356,OQ=14,NQ=20,PQ=200;function Na(...u){return u.filter(Boolean).join(" ")}function DQ(u){let[h,f]=u.split("-"),g=[];return h&&g.push(h),f&&g.push(f),g}var kQ=u=>{var h,f,g,S,C,w,P,k,M,U,B;let{invert:Y,toast:H,unstyled:ie,interacting:X,setHeights:te,visibleToasts:ce,heights:Z,index:le,toasts:ne,expanded:de,removeToast:Pe,defaultRichColors:ue,closeButton:he,style:ye,cancelButtonStyle:Ve,actionButtonStyle:Je,className:Ue="",descriptionClassName:xe="",duration:Ge,position:dt,gap:Xe,loadingIcon:We,expandByDefault:Ie,classNames:De,icons:ze,closeButtonAriaLabel:_e="Close toast",pauseWhenPageIsHidden:ke}=u,[ct,at]=st.useState(null),[Ot,Gt]=st.useState(null),[yt,pn]=st.useState(!1),[vn,or]=st.useState(!1),[hs,Ua]=st.useState(!1),[Kr,$d]=st.useState(!1),[Fh,ps]=st.useState(!1),[eu,pr]=st.useState(0),[Qr,po]=st.useState(0),ki=st.useRef(H.duration||Ge||E4),bl=st.useRef(null),Ms=st.useRef(null),Ar=le===0,tu=le+1<=ce,li=H.type,zr=H.dismissible!==!1,Uc=H.className||"",Il=H.descriptionClassName||"",Us=st.useMemo(()=>Z.findIndex(Kt=>Kt.toastId===H.id)||0,[Z,H.id]),Va=st.useMemo(()=>{var Kt;return(Kt=H.closeButton)!=null?Kt:he},[H.closeButton,he]),nu=st.useMemo(()=>H.duration||Ge||E4,[H.duration,Ge]),Vc=st.useRef(0),Ti=st.useRef(0),ru=st.useRef(0),fo=st.useRef(null),[iu,mo]=dt.split("-"),jc=st.useMemo(()=>Z.reduce((Kt,fn,Fn)=>Fn>=Us?Kt:Kt+fn.height,0),[Z,Us]),Al=gQ(),ja=H.invert||Y,_o=li==="loading";Ti.current=st.useMemo(()=>Us*Xe+jc,[Us,jc]),st.useEffect(()=>{ki.current=nu},[nu]),st.useEffect(()=>{pn(!0)},[]),st.useEffect(()=>{let Kt=Ms.current;if(Kt){let fn=Kt.getBoundingClientRect().height;return po(fn),te(Fn=>[{toastId:H.id,height:fn,position:H.position},...Fn]),()=>te(Fn=>Fn.filter(Ci=>Ci.toastId!==H.id))}},[te,H.id]),st.useLayoutEffect(()=>{if(!yt)return;let Kt=Ms.current,fn=Kt.style.height;Kt.style.height="auto";let Fn=Kt.getBoundingClientRect().height;Kt.style.height=fn,po(Fn),te(Ci=>Ci.find(Li=>Li.toastId===H.id)?Ci.map(Li=>Li.toastId===H.id?{...Li,height:Fn}:Li):[{toastId:H.id,height:Fn,position:H.position},...Ci])},[yt,H.title,H.description,te,H.id]);let Vs=st.useCallback(()=>{or(!0),pr(Ti.current),te(Kt=>Kt.filter(fn=>fn.toastId!==H.id)),setTimeout(()=>{Pe(H)},PQ)},[H,Pe,te,Ti]);st.useEffect(()=>{if(H.promise&&li==="loading"||H.duration===1/0||H.type==="loading")return;let Kt;return de||X||ke&&Al?(()=>{if(ru.current<Vc.current){let fn=new Date().getTime()-Vc.current;ki.current=ki.current-fn}ru.current=new Date().getTime()})():ki.current!==1/0&&(Vc.current=new Date().getTime(),Kt=setTimeout(()=>{var fn;(fn=H.onAutoClose)==null||fn.call(H,H),Vs()},ki.current)),()=>clearTimeout(Kt)},[de,X,H,li,ke,Al,Vs]),st.useEffect(()=>{H.delete&&Vs()},[Vs,H.delete]);function Fa(){var Kt,fn,Fn;return ze!=null&&ze.loading?st.createElement("div",{className:Na(De?.loader,(Kt=H?.classNames)==null?void 0:Kt.loader,"sonner-loader"),"data-visible":li==="loading"},ze.loading):We?st.createElement("div",{className:Na(De?.loader,(fn=H?.classNames)==null?void 0:fn.loader,"sonner-loader"),"data-visible":li==="loading"},We):st.createElement(uQ,{className:Na(De?.loader,(Fn=H?.classNames)==null?void 0:Fn.loader),visible:li==="loading"})}return st.createElement("li",{tabIndex:0,ref:Ms,className:Na(Ue,Uc,De?.toast,(h=H?.classNames)==null?void 0:h.toast,De?.default,De?.[li],(f=H?.classNames)==null?void 0:f[li]),"data-sonner-toast":"","data-rich-colors":(g=H.richColors)!=null?g:ue,"data-styled":!(H.jsx||H.unstyled||ie),"data-mounted":yt,"data-promise":!!H.promise,"data-swiped":Fh,"data-removed":vn,"data-visible":tu,"data-y-position":iu,"data-x-position":mo,"data-index":le,"data-front":Ar,"data-swiping":hs,"data-dismissible":zr,"data-type":li,"data-invert":ja,"data-swipe-out":Kr,"data-swipe-direction":Ot,"data-expanded":!!(de||Ie&&yt),style:{"--index":le,"--toasts-before":le,"--z-index":ne.length-le,"--offset":`${vn?eu:Ti.current}px`,"--initial-height":Ie?"auto":`${Qr}px`,...ye,...H.style},onDragEnd:()=>{Ua(!1),at(null),fo.current=null},onPointerDown:Kt=>{_o||!zr||(bl.current=new Date,pr(Ti.current),Kt.target.setPointerCapture(Kt.pointerId),Kt.target.tagName!=="BUTTON"&&(Ua(!0),fo.current={x:Kt.clientX,y:Kt.clientY}))},onPointerUp:()=>{var Kt,fn,Fn,Ci;if(Kr||!zr)return;fo.current=null;let Li=Number(((Kt=Ms.current)==null?void 0:Kt.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Bn=Number(((fn=Ms.current)==null?void 0:fn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),js=new Date().getTime()-((Fn=bl.current)==null?void 0:Fn.getTime()),Zr=ct==="x"?Li:Bn,Xi=Math.abs(Zr)/js;if(Math.abs(Zr)>=NQ||Xi>.11){pr(Ti.current),(Ci=H.onDismiss)==null||Ci.call(H,H),Gt(ct==="x"?Li>0?"right":"left":Bn>0?"down":"up"),Vs(),$d(!0),ps(!1);return}Ua(!1),at(null)},onPointerMove:Kt=>{var fn,Fn,Ci,Li;if(!fo.current||!zr||((fn=window.getSelection())==null?void 0:fn.toString().length)>0)return;let Bn=Kt.clientY-fo.current.y,js=Kt.clientX-fo.current.x,Zr=(Fn=u.swipeDirections)!=null?Fn:DQ(dt);!ct&&(Math.abs(js)>1||Math.abs(Bn)>1)&&at(Math.abs(js)>Math.abs(Bn)?"x":"y");let Xi={x:0,y:0};ct==="y"?(Zr.includes("top")||Zr.includes("bottom"))&&(Zr.includes("top")&&Bn<0||Zr.includes("bottom")&&Bn>0)&&(Xi.y=Bn):ct==="x"&&(Zr.includes("left")||Zr.includes("right"))&&(Zr.includes("left")&&js<0||Zr.includes("right")&&js>0)&&(Xi.x=js),(Math.abs(Xi.x)>0||Math.abs(Xi.y)>0)&&ps(!0),(Ci=Ms.current)==null||Ci.style.setProperty("--swipe-amount-x",`${Xi.x}px`),(Li=Ms.current)==null||Li.style.setProperty("--swipe-amount-y",`${Xi.y}px`)}},Va&&!H.jsx?st.createElement("button",{"aria-label":_e,"data-disabled":_o,"data-close-button":!0,onClick:_o||!zr?()=>{}:()=>{var Kt;Vs(),(Kt=H.onDismiss)==null||Kt.call(H,H)},className:Na(De?.closeButton,(S=H?.classNames)==null?void 0:S.closeButton)},(C=ze?.close)!=null?C:_Q):null,H.jsx||ee.isValidElement(H.title)?H.jsx?H.jsx:typeof H.title=="function"?H.title():H.title:st.createElement(st.Fragment,null,li||H.icon||H.promise?st.createElement("div",{"data-icon":"",className:Na(De?.icon,(w=H?.classNames)==null?void 0:w.icon)},H.promise||H.type==="loading"&&!H.icon?H.icon||Fa():null,H.type!=="loading"?H.icon||ze?.[li]||lQ(li):null):null,st.createElement("div",{"data-content":"",className:Na(De?.content,(P=H?.classNames)==null?void 0:P.content)},st.createElement("div",{"data-title":"",className:Na(De?.title,(k=H?.classNames)==null?void 0:k.title)},typeof H.title=="function"?H.title():H.title),H.description?st.createElement("div",{"data-description":"",className:Na(xe,Il,De?.description,(M=H?.classNames)==null?void 0:M.description)},typeof H.description=="function"?H.description():H.description):null),ee.isValidElement(H.cancel)?H.cancel:H.cancel&&qT(H.cancel)?st.createElement("button",{"data-button":!0,"data-cancel":!0,style:H.cancelButtonStyle||Ve,onClick:Kt=>{var fn,Fn;qT(H.cancel)&&zr&&((Fn=(fn=H.cancel).onClick)==null||Fn.call(fn,Kt),Vs())},className:Na(De?.cancelButton,(U=H?.classNames)==null?void 0:U.cancelButton)},H.cancel.label):null,ee.isValidElement(H.action)?H.action:H.action&&qT(H.action)?st.createElement("button",{"data-button":!0,"data-action":!0,style:H.actionButtonStyle||Je,onClick:Kt=>{var fn,Fn;qT(H.action)&&((Fn=(fn=H.action).onClick)==null||Fn.call(fn,Kt),!Kt.defaultPrevented&&Vs())},className:Na(De?.actionButton,(B=H?.classNames)==null?void 0:B.actionButton)},H.action.label):null))};function v4(){if(typeof window>"u"||typeof document>"u")return"ltr";let u=document.documentElement.getAttribute("dir");return u==="auto"||!u?window.getComputedStyle(document.documentElement).direction:u}function LQ(u,h){let f={};return[u,h].forEach((g,S)=>{let C=S===1,w=C?"--mobile-offset":"--offset",P=C?IQ:bQ;function k(M){["top","right","bottom","left"].forEach(U=>{f[`${w}-${U}`]=typeof M=="number"?`${M}px`:M})}typeof g=="number"||typeof g=="string"?k(g):typeof g=="object"?["top","right","bottom","left"].forEach(M=>{g[M]===void 0?f[`${w}-${M}`]=P:f[`${w}-${M}`]=typeof g[M]=="number"?`${g[M]}px`:g[M]}):k(P)}),f}var xQ=ee.forwardRef(function(u,h){let{invert:f,position:g="bottom-right",hotkey:S=["altKey","KeyT"],expand:C,closeButton:w,className:P,offset:k,mobileOffset:M,theme:U="light",richColors:B,duration:Y,style:H,visibleToasts:ie=wQ,toastOptions:X,dir:te=v4(),gap:ce=OQ,loadingIcon:Z,icons:le,containerAriaLabel:ne="Notifications",pauseWhenPageIsHidden:de}=u,[Pe,ue]=st.useState([]),he=st.useMemo(()=>Array.from(new Set([g].concat(Pe.filter(ke=>ke.position).map(ke=>ke.position)))),[Pe,g]),[ye,Ve]=st.useState([]),[Je,Ue]=st.useState(!1),[xe,Ge]=st.useState(!1),[dt,Xe]=st.useState(U!=="system"?U:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),We=st.useRef(null),Ie=S.join("+").replace(/Key/g,"").replace(/Digit/g,""),De=st.useRef(null),ze=st.useRef(!1),_e=st.useCallback(ke=>{ue(ct=>{var at;return(at=ct.find(Ot=>Ot.id===ke.id))!=null&&at.delete||Ls.dismiss(ke.id),ct.filter(({id:Ot})=>Ot!==ke.id)})},[]);return st.useEffect(()=>Ls.subscribe(ke=>{if(ke.dismiss){ue(ct=>ct.map(at=>at.id===ke.id?{...at,delete:!0}:at));return}setTimeout(()=>{uj.flushSync(()=>{ue(ct=>{let at=ct.findIndex(Ot=>Ot.id===ke.id);return at!==-1?[...ct.slice(0,at),{...ct[at],...ke},...ct.slice(at+1)]:[ke,...ct]})})})}),[]),st.useEffect(()=>{if(U!=="system"){Xe(U);return}if(U==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Xe("dark"):Xe("light")),typeof window>"u")return;let ke=window.matchMedia("(prefers-color-scheme: dark)");try{ke.addEventListener("change",({matches:ct})=>{Xe(ct?"dark":"light")})}catch{ke.addListener(({matches:at})=>{try{Xe(at?"dark":"light")}catch(Ot){console.error(Ot)}})}},[U]),st.useEffect(()=>{Pe.length<=1&&Ue(!1)},[Pe]),st.useEffect(()=>{let ke=ct=>{var at,Ot;S.every(Gt=>ct[Gt]||ct.code===Gt)&&(Ue(!0),(at=We.current)==null||at.focus()),ct.code==="Escape"&&(document.activeElement===We.current||(Ot=We.current)!=null&&Ot.contains(document.activeElement))&&Ue(!1)};return document.addEventListener("keydown",ke),()=>document.removeEventListener("keydown",ke)},[S]),st.useEffect(()=>{if(We.current)return()=>{De.current&&(De.current.focus({preventScroll:!0}),De.current=null,ze.current=!1)}},[We.current]),st.createElement("section",{ref:h,"aria-label":`${ne} ${Ie}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},he.map((ke,ct)=>{var at;let[Ot,Gt]=ke.split("-");return Pe.length?st.createElement("ol",{key:ke,dir:te==="auto"?v4():te,tabIndex:-1,ref:We,className:P,"data-sonner-toaster":!0,"data-theme":dt,"data-y-position":Ot,"data-lifted":Je&&Pe.length>1&&!C,"data-x-position":Gt,style:{"--front-toast-height":`${((at=ye[0])==null?void 0:at.height)||0}px`,"--width":`${AQ}px`,"--gap":`${ce}px`,...H,...LQ(k,M)},onBlur:yt=>{ze.current&&!yt.currentTarget.contains(yt.relatedTarget)&&(ze.current=!1,De.current&&(De.current.focus({preventScroll:!0}),De.current=null))},onFocus:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||ze.current||(ze.current=!0,De.current=yt.relatedTarget)},onMouseEnter:()=>Ue(!0),onMouseMove:()=>Ue(!0),onMouseLeave:()=>{xe||Ue(!1)},onDragEnd:()=>Ue(!1),onPointerDown:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||Ge(!0)},onPointerUp:()=>Ge(!1)},Pe.filter(yt=>!yt.position&&ct===0||yt.position===ke).map((yt,pn)=>{var vn,or;return st.createElement(kQ,{key:yt.id,icons:le,index:pn,toast:yt,defaultRichColors:B,duration:(vn=X?.duration)!=null?vn:Y,className:X?.className,descriptionClassName:X?.descriptionClassName,invert:f,visibleToasts:ie,closeButton:(or=X?.closeButton)!=null?or:w,interacting:xe,position:ke,style:X?.style,unstyled:X?.unstyled,classNames:X?.classNames,cancelButtonStyle:X?.cancelButtonStyle,actionButtonStyle:X?.actionButtonStyle,removeToast:_e,toasts:Pe.filter(hs=>hs.position==yt.position),heights:ye.filter(hs=>hs.position==yt.position),setHeights:Ve,expandByDefault:C,gap:ce,loadingIcon:Z,expanded:Je,pauseWhenPageIsHidden:de,swipeDirections:u.swipeDirections})})):null}))});const MQ=({...u})=>{const{theme:h="system"}=cQ();return O.jsx(xQ,{theme:h,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...u})},UQ=["top","right","bottom","left"],Xd=Math.min,lo=Math.max,d0=Math.round,XT=Math.floor,Lc=u=>({x:u,y:u}),VQ={left:"right",right:"left",bottom:"top",top:"bottom"},jQ={start:"end",end:"start"};function hA(u,h,f){return lo(u,Xd(h,f))}function Rl(u,h){return typeof u=="function"?u(h):u}function wl(u){return u.split("-")[0]}function lm(u){return u.split("-")[1]}function PA(u){return u==="x"?"y":"x"}function DA(u){return u==="y"?"height":"width"}const FQ=new Set(["top","bottom"]);function kc(u){return FQ.has(wl(u))?"y":"x"}function kA(u){return PA(kc(u))}function BQ(u,h,f){f===void 0&&(f=!1);const g=lm(u),S=kA(u),C=DA(S);let w=S==="x"?g===(f?"end":"start")?"right":"left":g==="start"?"bottom":"top";return h.reference[C]>h.floating[C]&&(w=u0(w)),[w,u0(w)]}function WQ(u){const h=u0(u);return[pA(u),h,pA(h)]}function pA(u){return u.replace(/start|end/g,h=>jQ[h])}const S4=["left","right"],y4=["right","left"],GQ=["top","bottom"],HQ=["bottom","top"];function KQ(u,h,f){switch(u){case"top":case"bottom":return f?h?y4:S4:h?S4:y4;case"left":case"right":return h?GQ:HQ;default:return[]}}function zQ(u,h,f,g){const S=lm(u);let C=KQ(wl(u),f==="start",g);return S&&(C=C.map(w=>w+"-"+S),h&&(C=C.concat(C.map(pA)))),C}function u0(u){return u.replace(/left|right|bottom|top/g,h=>VQ[h])}function YQ(u){return{top:0,right:0,bottom:0,left:0,...u}}function $j(u){return typeof u!="number"?YQ(u):{top:u,right:u,bottom:u,left:u}}function h0(u){const{x:h,y:f,width:g,height:S}=u;return{width:g,height:S,top:f,left:h,right:h+g,bottom:f+S,x:h,y:f}}function T4(u,h,f){let{reference:g,floating:S}=u;const C=kc(h),w=kA(h),P=DA(w),k=wl(h),M=C==="y",U=g.x+g.width/2-S.width/2,B=g.y+g.height/2-S.height/2,Y=g[P]/2-S[P]/2;let H;switch(k){case"top":H={x:U,y:g.y-S.height};break;case"bottom":H={x:U,y:g.y+g.height};break;case"right":H={x:g.x+g.width,y:B};break;case"left":H={x:g.x-S.width,y:B};break;default:H={x:g.x,y:g.y}}switch(lm(h)){case"start":H[w]-=Y*(f&&M?-1:1);break;case"end":H[w]+=Y*(f&&M?-1:1);break}return H}const qQ=async(u,h,f)=>{const{placement:g="bottom",strategy:S="absolute",middleware:C=[],platform:w}=f,P=C.filter(Boolean),k=await(w.isRTL==null?void 0:w.isRTL(h));let M=await w.getElementRects({reference:u,floating:h,strategy:S}),{x:U,y:B}=T4(M,g,k),Y=g,H={},ie=0;for(let X=0;X<P.length;X++){const{name:te,fn:ce}=P[X],{x:Z,y:le,data:ne,reset:de}=await ce({x:U,y:B,initialPlacement:g,placement:Y,strategy:S,middlewareData:H,rects:M,platform:w,elements:{reference:u,floating:h}});U=Z??U,B=le??B,H={...H,[te]:{...H[te],...ne}},de&&ie<=50&&(ie++,typeof de=="object"&&(de.placement&&(Y=de.placement),de.rects&&(M=de.rects===!0?await w.getElementRects({reference:u,floating:h,strategy:S}):de.rects),{x:U,y:B}=T4(M,Y,k)),X=-1)}return{x:U,y:B,placement:Y,strategy:S,middlewareData:H}};async function wE(u,h){var f;h===void 0&&(h={});const{x:g,y:S,platform:C,rects:w,elements:P,strategy:k}=u,{boundary:M="clippingAncestors",rootBoundary:U="viewport",elementContext:B="floating",altBoundary:Y=!1,padding:H=0}=Rl(h,u),ie=$j(H),te=P[Y?B==="floating"?"reference":"floating":B],ce=h0(await C.getClippingRect({element:(f=await(C.isElement==null?void 0:C.isElement(te)))==null||f?te:te.contextElement||await(C.getDocumentElement==null?void 0:C.getDocumentElement(P.floating)),boundary:M,rootBoundary:U,strategy:k})),Z=B==="floating"?{x:g,y:S,width:w.floating.width,height:w.floating.height}:w.reference,le=await(C.getOffsetParent==null?void 0:C.getOffsetParent(P.floating)),ne=await(C.isElement==null?void 0:C.isElement(le))?await(C.getScale==null?void 0:C.getScale(le))||{x:1,y:1}:{x:1,y:1},de=h0(C.convertOffsetParentRelativeRectToViewportRelativeRect?await C.convertOffsetParentRelativeRectToViewportRelativeRect({elements:P,rect:Z,offsetParent:le,strategy:k}):Z);return{top:(ce.top-de.top+ie.top)/ne.y,bottom:(de.bottom-ce.bottom+ie.bottom)/ne.y,left:(ce.left-de.left+ie.left)/ne.x,right:(de.right-ce.right+ie.right)/ne.x}}const XQ=u=>({name:"arrow",options:u,async fn(h){const{x:f,y:g,placement:S,rects:C,platform:w,elements:P,middlewareData:k}=h,{element:M,padding:U=0}=Rl(u,h)||{};if(M==null)return{};const B=$j(U),Y={x:f,y:g},H=kA(S),ie=DA(H),X=await w.getDimensions(M),te=H==="y",ce=te?"top":"left",Z=te?"bottom":"right",le=te?"clientHeight":"clientWidth",ne=C.reference[ie]+C.reference[H]-Y[H]-C.floating[ie],de=Y[H]-C.reference[H],Pe=await(w.getOffsetParent==null?void 0:w.getOffsetParent(M));let ue=Pe?Pe[le]:0;(!ue||!await(w.isElement==null?void 0:w.isElement(Pe)))&&(ue=P.floating[le]||C.floating[ie]);const he=ne/2-de/2,ye=ue/2-X[ie]/2-1,Ve=Xd(B[ce],ye),Je=Xd(B[Z],ye),Ue=Ve,xe=ue-X[ie]-Je,Ge=ue/2-X[ie]/2+he,dt=hA(Ue,Ge,xe),Xe=!k.arrow&&lm(S)!=null&&Ge!==dt&&C.reference[ie]/2-(Ge<Ue?Ve:Je)-X[ie]/2<0,We=Xe?Ge<Ue?Ge-Ue:Ge-xe:0;return{[H]:Y[H]+We,data:{[H]:dt,centerOffset:Ge-dt-We,...Xe&&{alignmentOffset:We}},reset:Xe}}}),JQ=function(u){return u===void 0&&(u={}),{name:"flip",options:u,async fn(h){var f,g;const{placement:S,middlewareData:C,rects:w,initialPlacement:P,platform:k,elements:M}=h,{mainAxis:U=!0,crossAxis:B=!0,fallbackPlacements:Y,fallbackStrategy:H="bestFit",fallbackAxisSideDirection:ie="none",flipAlignment:X=!0,...te}=Rl(u,h);if((f=C.arrow)!=null&&f.alignmentOffset)return{};const ce=wl(S),Z=kc(P),le=wl(P)===P,ne=await(k.isRTL==null?void 0:k.isRTL(M.floating)),de=Y||(le||!X?[u0(P)]:WQ(P)),Pe=ie!=="none";!Y&&Pe&&de.push(...zQ(P,X,ie,ne));const ue=[P,...de],he=await wE(h,te),ye=[];let Ve=((g=C.flip)==null?void 0:g.overflows)||[];if(U&&ye.push(he[ce]),B){const Ge=BQ(S,w,ne);ye.push(he[Ge[0]],he[Ge[1]])}if(Ve=[...Ve,{placement:S,overflows:ye}],!ye.every(Ge=>Ge<=0)){var Je,Ue;const Ge=(((Je=C.flip)==null?void 0:Je.index)||0)+1,dt=ue[Ge];if(dt&&(!(B==="alignment"?Z!==kc(dt):!1)||Ve.every(Ie=>kc(Ie.placement)===Z?Ie.overflows[0]>0:!0)))return{data:{index:Ge,overflows:Ve},reset:{placement:dt}};let Xe=(Ue=Ve.filter(We=>We.overflows[0]<=0).sort((We,Ie)=>We.overflows[1]-Ie.overflows[1])[0])==null?void 0:Ue.placement;if(!Xe)switch(H){case"bestFit":{var xe;const We=(xe=Ve.filter(Ie=>{if(Pe){const De=kc(Ie.placement);return De===Z||De==="y"}return!0}).map(Ie=>[Ie.placement,Ie.overflows.filter(De=>De>0).reduce((De,ze)=>De+ze,0)]).sort((Ie,De)=>Ie[1]-De[1])[0])==null?void 0:xe[0];We&&(Xe=We);break}case"initialPlacement":Xe=P;break}if(S!==Xe)return{reset:{placement:Xe}}}return{}}}};function C4(u,h){return{top:u.top-h.height,right:u.right-h.width,bottom:u.bottom-h.height,left:u.left-h.width}}function R4(u){return UQ.some(h=>u[h]>=0)}const QQ=function(u){return u===void 0&&(u={}),{name:"hide",options:u,async fn(h){const{rects:f}=h,{strategy:g="referenceHidden",...S}=Rl(u,h);switch(g){case"referenceHidden":{const C=await wE(h,{...S,elementContext:"reference"}),w=C4(C,f.reference);return{data:{referenceHiddenOffsets:w,referenceHidden:R4(w)}}}case"escaped":{const C=await wE(h,{...S,altBoundary:!0}),w=C4(C,f.floating);return{data:{escapedOffsets:w,escaped:R4(w)}}}default:return{}}}}},e8=new Set(["left","top"]);async function ZQ(u,h){const{placement:f,platform:g,elements:S}=u,C=await(g.isRTL==null?void 0:g.isRTL(S.floating)),w=wl(f),P=lm(f),k=kc(f)==="y",M=e8.has(w)?-1:1,U=C&&k?-1:1,B=Rl(h,u);let{mainAxis:Y,crossAxis:H,alignmentAxis:ie}=typeof B=="number"?{mainAxis:B,crossAxis:0,alignmentAxis:null}:{mainAxis:B.mainAxis||0,crossAxis:B.crossAxis||0,alignmentAxis:B.alignmentAxis};return P&&typeof ie=="number"&&(H=P==="end"?ie*-1:ie),k?{x:H*U,y:Y*M}:{x:Y*M,y:H*U}}const $Q=function(u){return u===void 0&&(u=0),{name:"offset",options:u,async fn(h){var f,g;const{x:S,y:C,placement:w,middlewareData:P}=h,k=await ZQ(h,u);return w===((f=P.offset)==null?void 0:f.placement)&&(g=P.arrow)!=null&&g.alignmentOffset?{}:{x:S+k.x,y:C+k.y,data:{...k,placement:w}}}}},eZ=function(u){return u===void 0&&(u={}),{name:"shift",options:u,async fn(h){const{x:f,y:g,placement:S}=h,{mainAxis:C=!0,crossAxis:w=!1,limiter:P={fn:te=>{let{x:ce,y:Z}=te;return{x:ce,y:Z}}},...k}=Rl(u,h),M={x:f,y:g},U=await wE(h,k),B=kc(wl(S)),Y=PA(B);let H=M[Y],ie=M[B];if(C){const te=Y==="y"?"top":"left",ce=Y==="y"?"bottom":"right",Z=H+U[te],le=H-U[ce];H=hA(Z,H,le)}if(w){const te=B==="y"?"top":"left",ce=B==="y"?"bottom":"right",Z=ie+U[te],le=ie-U[ce];ie=hA(Z,ie,le)}const X=P.fn({...h,[Y]:H,[B]:ie});return{...X,data:{x:X.x-f,y:X.y-g,enabled:{[Y]:C,[B]:w}}}}}},tZ=function(u){return u===void 0&&(u={}),{options:u,fn(h){const{x:f,y:g,placement:S,rects:C,middlewareData:w}=h,{offset:P=0,mainAxis:k=!0,crossAxis:M=!0}=Rl(u,h),U={x:f,y:g},B=kc(S),Y=PA(B);let H=U[Y],ie=U[B];const X=Rl(P,h),te=typeof X=="number"?{mainAxis:X,crossAxis:0}:{mainAxis:0,crossAxis:0,...X};if(k){const le=Y==="y"?"height":"width",ne=C.reference[Y]-C.floating[le]+te.mainAxis,de=C.reference[Y]+C.reference[le]-te.mainAxis;H<ne?H=ne:H>de&&(H=de)}if(M){var ce,Z;const le=Y==="y"?"width":"height",ne=e8.has(wl(S)),de=C.reference[B]-C.floating[le]+(ne&&((ce=w.offset)==null?void 0:ce[B])||0)+(ne?0:te.crossAxis),Pe=C.reference[B]+C.reference[le]+(ne?0:((Z=w.offset)==null?void 0:Z[B])||0)-(ne?te.crossAxis:0);ie<de?ie=de:ie>Pe&&(ie=Pe)}return{[Y]:H,[B]:ie}}}},nZ=function(u){return u===void 0&&(u={}),{name:"size",options:u,async fn(h){var f,g;const{placement:S,rects:C,platform:w,elements:P}=h,{apply:k=()=>{},...M}=Rl(u,h),U=await wE(h,M),B=wl(S),Y=lm(S),H=kc(S)==="y",{width:ie,height:X}=C.floating;let te,ce;B==="top"||B==="bottom"?(te=B,ce=Y===(await(w.isRTL==null?void 0:w.isRTL(P.floating))?"start":"end")?"left":"right"):(ce=B,te=Y==="end"?"top":"bottom");const Z=X-U.top-U.bottom,le=ie-U.left-U.right,ne=Xd(X-U[te],Z),de=Xd(ie-U[ce],le),Pe=!h.middlewareData.shift;let ue=ne,he=de;if((f=h.middlewareData.shift)!=null&&f.enabled.x&&(he=le),(g=h.middlewareData.shift)!=null&&g.enabled.y&&(ue=Z),Pe&&!Y){const Ve=lo(U.left,0),Je=lo(U.right,0),Ue=lo(U.top,0),xe=lo(U.bottom,0);H?he=ie-2*(Ve!==0||Je!==0?Ve+Je:lo(U.left,U.right)):ue=X-2*(Ue!==0||xe!==0?Ue+xe:lo(U.top,U.bottom))}await k({...h,availableWidth:he,availableHeight:ue});const ye=await w.getDimensions(P.floating);return ie!==ye.width||X!==ye.height?{reset:{rects:!0}}:{}}}};function T0(){return typeof window<"u"}function dm(u){return t8(u)?(u.nodeName||"").toLowerCase():"#document"}function ho(u){var h;return(u==null||(h=u.ownerDocument)==null?void 0:h.defaultView)||window}function Mc(u){var h;return(h=(t8(u)?u.ownerDocument:u.document)||window.document)==null?void 0:h.documentElement}function t8(u){return T0()?u instanceof Node||u instanceof ho(u).Node:!1}function La(u){return T0()?u instanceof Element||u instanceof ho(u).Element:!1}function xc(u){return T0()?u instanceof HTMLElement||u instanceof ho(u).HTMLElement:!1}function w4(u){return!T0()||typeof ShadowRoot>"u"?!1:u instanceof ShadowRoot||u instanceof ho(u).ShadowRoot}const rZ=new Set(["inline","contents"]);function ME(u){const{overflow:h,overflowX:f,overflowY:g,display:S}=xa(u);return/auto|scroll|overlay|hidden|clip/.test(h+g+f)&&!rZ.has(S)}const iZ=new Set(["table","td","th"]);function sZ(u){return iZ.has(dm(u))}const oZ=[":popover-open",":modal"];function C0(u){return oZ.some(h=>{try{return u.matches(h)}catch{return!1}})}const aZ=["transform","translate","scale","rotate","perspective"],cZ=["transform","translate","scale","rotate","perspective","filter"],lZ=["paint","layout","strict","content"];function LA(u){const h=xA(),f=La(u)?xa(u):u;return aZ.some(g=>f[g]?f[g]!=="none":!1)||(f.containerType?f.containerType!=="normal":!1)||!h&&(f.backdropFilter?f.backdropFilter!=="none":!1)||!h&&(f.filter?f.filter!=="none":!1)||cZ.some(g=>(f.willChange||"").includes(g))||lZ.some(g=>(f.contain||"").includes(g))}function dZ(u){let h=Jd(u);for(;xc(h)&&!sm(h);){if(LA(h))return h;if(C0(h))return null;h=Jd(h)}return null}function xA(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const uZ=new Set(["html","body","#document"]);function sm(u){return uZ.has(dm(u))}function xa(u){return ho(u).getComputedStyle(u)}function R0(u){return La(u)?{scrollLeft:u.scrollLeft,scrollTop:u.scrollTop}:{scrollLeft:u.scrollX,scrollTop:u.scrollY}}function Jd(u){if(dm(u)==="html")return u;const h=u.assignedSlot||u.parentNode||w4(u)&&u.host||Mc(u);return w4(h)?h.host:h}function n8(u){const h=Jd(u);return sm(h)?u.ownerDocument?u.ownerDocument.body:u.body:xc(h)&&ME(h)?h:n8(h)}function bE(u,h,f){var g;h===void 0&&(h=[]),f===void 0&&(f=!0);const S=n8(u),C=S===((g=u.ownerDocument)==null?void 0:g.body),w=ho(S);if(C){const P=fA(w);return h.concat(w,w.visualViewport||[],ME(S)?S:[],P&&f?bE(P):[])}return h.concat(S,bE(S,[],f))}function fA(u){return u.parent&&Object.getPrototypeOf(u.parent)?u.frameElement:null}function r8(u){const h=xa(u);let f=parseFloat(h.width)||0,g=parseFloat(h.height)||0;const S=xc(u),C=S?u.offsetWidth:f,w=S?u.offsetHeight:g,P=d0(f)!==C||d0(g)!==w;return P&&(f=C,g=w),{width:f,height:g,$:P}}function MA(u){return La(u)?u:u.contextElement}function im(u){const h=MA(u);if(!xc(h))return Lc(1);const f=h.getBoundingClientRect(),{width:g,height:S,$:C}=r8(h);let w=(C?d0(f.width):f.width)/g,P=(C?d0(f.height):f.height)/S;return(!w||!Number.isFinite(w))&&(w=1),(!P||!Number.isFinite(P))&&(P=1),{x:w,y:P}}const hZ=Lc(0);function i8(u){const h=ho(u);return!xA()||!h.visualViewport?hZ:{x:h.visualViewport.offsetLeft,y:h.visualViewport.offsetTop}}function pZ(u,h,f){return h===void 0&&(h=!1),!f||h&&f!==ho(u)?!1:h}function Vh(u,h,f,g){h===void 0&&(h=!1),f===void 0&&(f=!1);const S=u.getBoundingClientRect(),C=MA(u);let w=Lc(1);h&&(g?La(g)&&(w=im(g)):w=im(u));const P=pZ(C,f,g)?i8(C):Lc(0);let k=(S.left+P.x)/w.x,M=(S.top+P.y)/w.y,U=S.width/w.x,B=S.height/w.y;if(C){const Y=ho(C),H=g&&La(g)?ho(g):g;let ie=Y,X=fA(ie);for(;X&&g&&H!==ie;){const te=im(X),ce=X.getBoundingClientRect(),Z=xa(X),le=ce.left+(X.clientLeft+parseFloat(Z.paddingLeft))*te.x,ne=ce.top+(X.clientTop+parseFloat(Z.paddingTop))*te.y;k*=te.x,M*=te.y,U*=te.x,B*=te.y,k+=le,M+=ne,ie=ho(X),X=fA(ie)}}return h0({width:U,height:B,x:k,y:M})}function UA(u,h){const f=R0(u).scrollLeft;return h?h.left+f:Vh(Mc(u)).left+f}function s8(u,h,f){f===void 0&&(f=!1);const g=u.getBoundingClientRect(),S=g.left+h.scrollLeft-(f?0:UA(u,g)),C=g.top+h.scrollTop;return{x:S,y:C}}function fZ(u){let{elements:h,rect:f,offsetParent:g,strategy:S}=u;const C=S==="fixed",w=Mc(g),P=h?C0(h.floating):!1;if(g===w||P&&C)return f;let k={scrollLeft:0,scrollTop:0},M=Lc(1);const U=Lc(0),B=xc(g);if((B||!B&&!C)&&((dm(g)!=="body"||ME(w))&&(k=R0(g)),xc(g))){const H=Vh(g);M=im(g),U.x=H.x+g.clientLeft,U.y=H.y+g.clientTop}const Y=w&&!B&&!C?s8(w,k,!0):Lc(0);return{width:f.width*M.x,height:f.height*M.y,x:f.x*M.x-k.scrollLeft*M.x+U.x+Y.x,y:f.y*M.y-k.scrollTop*M.y+U.y+Y.y}}function mZ(u){return Array.from(u.getClientRects())}function _Z(u){const h=Mc(u),f=R0(u),g=u.ownerDocument.body,S=lo(h.scrollWidth,h.clientWidth,g.scrollWidth,g.clientWidth),C=lo(h.scrollHeight,h.clientHeight,g.scrollHeight,g.clientHeight);let w=-f.scrollLeft+UA(u);const P=-f.scrollTop;return xa(g).direction==="rtl"&&(w+=lo(h.clientWidth,g.clientWidth)-S),{width:S,height:C,x:w,y:P}}function gZ(u,h){const f=ho(u),g=Mc(u),S=f.visualViewport;let C=g.clientWidth,w=g.clientHeight,P=0,k=0;if(S){C=S.width,w=S.height;const M=xA();(!M||M&&h==="fixed")&&(P=S.offsetLeft,k=S.offsetTop)}return{width:C,height:w,x:P,y:k}}const EZ=new Set(["absolute","fixed"]);function vZ(u,h){const f=Vh(u,!0,h==="fixed"),g=f.top+u.clientTop,S=f.left+u.clientLeft,C=xc(u)?im(u):Lc(1),w=u.clientWidth*C.x,P=u.clientHeight*C.y,k=S*C.x,M=g*C.y;return{width:w,height:P,x:k,y:M}}function b4(u,h,f){let g;if(h==="viewport")g=gZ(u,f);else if(h==="document")g=_Z(Mc(u));else if(La(h))g=vZ(h,f);else{const S=i8(u);g={x:h.x-S.x,y:h.y-S.y,width:h.width,height:h.height}}return h0(g)}function o8(u,h){const f=Jd(u);return f===h||!La(f)||sm(f)?!1:xa(f).position==="fixed"||o8(f,h)}function SZ(u,h){const f=h.get(u);if(f)return f;let g=bE(u,[],!1).filter(P=>La(P)&&dm(P)!=="body"),S=null;const C=xa(u).position==="fixed";let w=C?Jd(u):u;for(;La(w)&&!sm(w);){const P=xa(w),k=LA(w);!k&&P.position==="fixed"&&(S=null),(C?!k&&!S:!k&&P.position==="static"&&!!S&&EZ.has(S.position)||ME(w)&&!k&&o8(u,w))?g=g.filter(U=>U!==w):S=P,w=Jd(w)}return h.set(u,g),g}function yZ(u){let{element:h,boundary:f,rootBoundary:g,strategy:S}=u;const w=[...f==="clippingAncestors"?C0(h)?[]:SZ(h,this._c):[].concat(f),g],P=w[0],k=w.reduce((M,U)=>{const B=b4(h,U,S);return M.top=lo(B.top,M.top),M.right=Xd(B.right,M.right),M.bottom=Xd(B.bottom,M.bottom),M.left=lo(B.left,M.left),M},b4(h,P,S));return{width:k.right-k.left,height:k.bottom-k.top,x:k.left,y:k.top}}function TZ(u){const{width:h,height:f}=r8(u);return{width:h,height:f}}function CZ(u,h,f){const g=xc(h),S=Mc(h),C=f==="fixed",w=Vh(u,!0,C,h);let P={scrollLeft:0,scrollTop:0};const k=Lc(0);function M(){k.x=UA(S)}if(g||!g&&!C)if((dm(h)!=="body"||ME(S))&&(P=R0(h)),g){const H=Vh(h,!0,C,h);k.x=H.x+h.clientLeft,k.y=H.y+h.clientTop}else S&&M();C&&!g&&S&&M();const U=S&&!g&&!C?s8(S,P):Lc(0),B=w.left+P.scrollLeft-k.x-U.x,Y=w.top+P.scrollTop-k.y-U.y;return{x:B,y:Y,width:w.width,height:w.height}}function JI(u){return xa(u).position==="static"}function I4(u,h){if(!xc(u)||xa(u).position==="fixed")return null;if(h)return h(u);let f=u.offsetParent;return Mc(u)===f&&(f=f.ownerDocument.body),f}function a8(u,h){const f=ho(u);if(C0(u))return f;if(!xc(u)){let S=Jd(u);for(;S&&!sm(S);){if(La(S)&&!JI(S))return S;S=Jd(S)}return f}let g=I4(u,h);for(;g&&sZ(g)&&JI(g);)g=I4(g,h);return g&&sm(g)&&JI(g)&&!LA(g)?f:g||dZ(u)||f}const RZ=async function(u){const h=this.getOffsetParent||a8,f=this.getDimensions,g=await f(u.floating);return{reference:CZ(u.reference,await h(u.floating),u.strategy),floating:{x:0,y:0,width:g.width,height:g.height}}};function wZ(u){return xa(u).direction==="rtl"}const bZ={convertOffsetParentRelativeRectToViewportRelativeRect:fZ,getDocumentElement:Mc,getClippingRect:yZ,getOffsetParent:a8,getElementRects:RZ,getClientRects:mZ,getDimensions:TZ,getScale:im,isElement:La,isRTL:wZ};function c8(u,h){return u.x===h.x&&u.y===h.y&&u.width===h.width&&u.height===h.height}function IZ(u,h){let f=null,g;const S=Mc(u);function C(){var P;clearTimeout(g),(P=f)==null||P.disconnect(),f=null}function w(P,k){P===void 0&&(P=!1),k===void 0&&(k=1),C();const M=u.getBoundingClientRect(),{left:U,top:B,width:Y,height:H}=M;if(P||h(),!Y||!H)return;const ie=XT(B),X=XT(S.clientWidth-(U+Y)),te=XT(S.clientHeight-(B+H)),ce=XT(U),le={rootMargin:-ie+"px "+-X+"px "+-te+"px "+-ce+"px",threshold:lo(0,Xd(1,k))||1};let ne=!0;function de(Pe){const ue=Pe[0].intersectionRatio;if(ue!==k){if(!ne)return w();ue?w(!1,ue):g=setTimeout(()=>{w(!1,1e-7)},1e3)}ue===1&&!c8(M,u.getBoundingClientRect())&&w(),ne=!1}try{f=new IntersectionObserver(de,{...le,root:S.ownerDocument})}catch{f=new IntersectionObserver(de,le)}f.observe(u)}return w(!0),C}function AZ(u,h,f,g){g===void 0&&(g={});const{ancestorScroll:S=!0,ancestorResize:C=!0,elementResize:w=typeof ResizeObserver=="function",layoutShift:P=typeof IntersectionObserver=="function",animationFrame:k=!1}=g,M=MA(u),U=S||C?[...M?bE(M):[],...bE(h)]:[];U.forEach(ce=>{S&&ce.addEventListener("scroll",f,{passive:!0}),C&&ce.addEventListener("resize",f)});const B=M&&P?IZ(M,f):null;let Y=-1,H=null;w&&(H=new ResizeObserver(ce=>{let[Z]=ce;Z&&Z.target===M&&H&&(H.unobserve(h),cancelAnimationFrame(Y),Y=requestAnimationFrame(()=>{var le;(le=H)==null||le.observe(h)})),f()}),M&&!k&&H.observe(M),H.observe(h));let ie,X=k?Vh(u):null;k&&te();function te(){const ce=Vh(u);X&&!c8(X,ce)&&f(),X=ce,ie=requestAnimationFrame(te)}return f(),()=>{var ce;U.forEach(Z=>{S&&Z.removeEventListener("scroll",f),C&&Z.removeEventListener("resize",f)}),B?.(),(ce=H)==null||ce.disconnect(),H=null,k&&cancelAnimationFrame(ie)}}const OZ=$Q,NZ=eZ,PZ=JQ,DZ=nZ,kZ=QQ,A4=XQ,LZ=tZ,xZ=(u,h,f)=>{const g=new Map,S={platform:bZ,...f},C={...S.platform,_c:g};return qQ(u,h,{...S,platform:C})};var MZ=typeof document<"u",UZ=function(){},c0=MZ?ee.useLayoutEffect:UZ;function p0(u,h){if(u===h)return!0;if(typeof u!=typeof h)return!1;if(typeof u=="function"&&u.toString()===h.toString())return!0;let f,g,S;if(u&&h&&typeof u=="object"){if(Array.isArray(u)){if(f=u.length,f!==h.length)return!1;for(g=f;g--!==0;)if(!p0(u[g],h[g]))return!1;return!0}if(S=Object.keys(u),f=S.length,f!==Object.keys(h).length)return!1;for(g=f;g--!==0;)if(!{}.hasOwnProperty.call(h,S[g]))return!1;for(g=f;g--!==0;){const C=S[g];if(!(C==="_owner"&&u.$$typeof)&&!p0(u[C],h[C]))return!1}return!0}return u!==u&&h!==h}function l8(u){return typeof window>"u"?1:(u.ownerDocument.defaultView||window).devicePixelRatio||1}function O4(u,h){const f=l8(u);return Math.round(h*f)/f}function QI(u){const h=ee.useRef(u);return c0(()=>{h.current=u}),h}function VZ(u){u===void 0&&(u={});const{placement:h="bottom",strategy:f="absolute",middleware:g=[],platform:S,elements:{reference:C,floating:w}={},transform:P=!0,whileElementsMounted:k,open:M}=u,[U,B]=ee.useState({x:0,y:0,strategy:f,placement:h,middlewareData:{},isPositioned:!1}),[Y,H]=ee.useState(g);p0(Y,g)||H(g);const[ie,X]=ee.useState(null),[te,ce]=ee.useState(null),Z=ee.useCallback(Ie=>{Ie!==Pe.current&&(Pe.current=Ie,X(Ie))},[]),le=ee.useCallback(Ie=>{Ie!==ue.current&&(ue.current=Ie,ce(Ie))},[]),ne=C||ie,de=w||te,Pe=ee.useRef(null),ue=ee.useRef(null),he=ee.useRef(U),ye=k!=null,Ve=QI(k),Je=QI(S),Ue=QI(M),xe=ee.useCallback(()=>{if(!Pe.current||!ue.current)return;const Ie={placement:h,strategy:f,middleware:Y};Je.current&&(Ie.platform=Je.current),xZ(Pe.current,ue.current,Ie).then(De=>{const ze={...De,isPositioned:Ue.current!==!1};Ge.current&&!p0(he.current,ze)&&(he.current=ze,E0.flushSync(()=>{B(ze)}))})},[Y,h,f,Je,Ue]);c0(()=>{M===!1&&he.current.isPositioned&&(he.current.isPositioned=!1,B(Ie=>({...Ie,isPositioned:!1})))},[M]);const Ge=ee.useRef(!1);c0(()=>(Ge.current=!0,()=>{Ge.current=!1}),[]),c0(()=>{if(ne&&(Pe.current=ne),de&&(ue.current=de),ne&&de){if(Ve.current)return Ve.current(ne,de,xe);xe()}},[ne,de,xe,Ve,ye]);const dt=ee.useMemo(()=>({reference:Pe,floating:ue,setReference:Z,setFloating:le}),[Z,le]),Xe=ee.useMemo(()=>({reference:ne,floating:de}),[ne,de]),We=ee.useMemo(()=>{const Ie={position:f,left:0,top:0};if(!Xe.floating)return Ie;const De=O4(Xe.floating,U.x),ze=O4(Xe.floating,U.y);return P?{...Ie,transform:"translate("+De+"px, "+ze+"px)",...l8(Xe.floating)>=1.5&&{willChange:"transform"}}:{position:f,left:De,top:ze}},[f,P,Xe.floating,U.x,U.y]);return ee.useMemo(()=>({...U,update:xe,refs:dt,elements:Xe,floatingStyles:We}),[U,xe,dt,Xe,We])}const jZ=u=>{function h(f){return{}.hasOwnProperty.call(f,"current")}return{name:"arrow",options:u,fn(f){const{element:g,padding:S}=typeof u=="function"?u(f):u;return g&&h(g)?g.current!=null?A4({element:g.current,padding:S}).fn(f):{}:g?A4({element:g,padding:S}).fn(f):{}}}},FZ=(u,h)=>({...OZ(u),options:[u,h]}),BZ=(u,h)=>({...NZ(u),options:[u,h]}),WZ=(u,h)=>({...LZ(u),options:[u,h]}),GZ=(u,h)=>({...PZ(u),options:[u,h]}),HZ=(u,h)=>({...DZ(u),options:[u,h]}),KZ=(u,h)=>({...kZ(u),options:[u,h]}),zZ=(u,h)=>({...jZ(u),options:[u,h]});var YZ="Arrow",d8=ee.forwardRef((u,h)=>{const{children:f,width:g=10,height:S=5,...C}=u;return O.jsx(xs.svg,{...C,ref:h,width:g,height:S,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:u.asChild?f:O.jsx("polygon",{points:"0,0 30,0 15,10"})})});d8.displayName=YZ;var qZ=d8;function XZ(u){const[h,f]=ee.useState(void 0);return qd(()=>{if(u){f({width:u.offsetWidth,height:u.offsetHeight});const g=new ResizeObserver(S=>{if(!Array.isArray(S)||!S.length)return;const C=S[0];let w,P;if("borderBoxSize"in C){const k=C.borderBoxSize,M=Array.isArray(k)?k[0]:k;w=M.inlineSize,P=M.blockSize}else w=u.offsetWidth,P=u.offsetHeight;f({width:w,height:P})});return g.observe(u,{box:"border-box"}),()=>g.unobserve(u)}else f(void 0)},[u]),h}var u8="Popper",[h8,p8]=v0(u8),[Tne,f8]=h8(u8),m8="PopperAnchor",_8=ee.forwardRef((u,h)=>{const{__scopePopper:f,virtualRef:g,...S}=u,C=f8(m8,f),w=ee.useRef(null),P=ka(h,w);return ee.useEffect(()=>{C.onAnchorChange(g?.current||w.current)}),g?null:O.jsx(xs.div,{...S,ref:P})});_8.displayName=m8;var VA="PopperContent",[JZ,QZ]=h8(VA),g8=ee.forwardRef((u,h)=>{const{__scopePopper:f,side:g="bottom",sideOffset:S=0,align:C="center",alignOffset:w=0,arrowPadding:P=0,avoidCollisions:k=!0,collisionBoundary:M=[],collisionPadding:U=0,sticky:B="partial",hideWhenDetached:Y=!1,updatePositionStrategy:H="optimized",onPlaced:ie,...X}=u,te=f8(VA,f),[ce,Z]=ee.useState(null),le=ka(h,yt=>Z(yt)),[ne,de]=ee.useState(null),Pe=XZ(ne),ue=Pe?.width??0,he=Pe?.height??0,ye=g+(C!=="center"?"-"+C:""),Ve=typeof U=="number"?U:{top:0,right:0,bottom:0,left:0,...U},Je=Array.isArray(M)?M:[M],Ue=Je.length>0,xe={padding:Ve,boundary:Je.filter($Z),altBoundary:Ue},{refs:Ge,floatingStyles:dt,placement:Xe,isPositioned:We,middlewareData:Ie}=VZ({strategy:"fixed",placement:ye,whileElementsMounted:(...yt)=>AZ(...yt,{animationFrame:H==="always"}),elements:{reference:te.anchor},middleware:[FZ({mainAxis:S+he,alignmentAxis:w}),k&&BZ({mainAxis:!0,crossAxis:!1,limiter:B==="partial"?WZ():void 0,...xe}),k&&GZ({...xe}),HZ({...xe,apply:({elements:yt,rects:pn,availableWidth:vn,availableHeight:or})=>{const{width:hs,height:Ua}=pn.reference,Kr=yt.floating.style;Kr.setProperty("--radix-popper-available-width",`${vn}px`),Kr.setProperty("--radix-popper-available-height",`${or}px`),Kr.setProperty("--radix-popper-anchor-width",`${hs}px`),Kr.setProperty("--radix-popper-anchor-height",`${Ua}px`)}}),ne&&zZ({element:ne,padding:P}),e$({arrowWidth:ue,arrowHeight:he}),Y&&KZ({strategy:"referenceHidden",...xe})]}),[De,ze]=S8(Xe),_e=Yd(ie);qd(()=>{We&&_e?.()},[We,_e]);const ke=Ie.arrow?.x,ct=Ie.arrow?.y,at=Ie.arrow?.centerOffset!==0,[Ot,Gt]=ee.useState();return qd(()=>{ce&&Gt(window.getComputedStyle(ce).zIndex)},[ce]),O.jsx("div",{ref:Ge.setFloating,"data-radix-popper-content-wrapper":"",style:{...dt,transform:We?dt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ot,"--radix-popper-transform-origin":[Ie.transformOrigin?.x,Ie.transformOrigin?.y].join(" "),...Ie.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:u.dir,children:O.jsx(JZ,{scope:f,placedSide:De,onArrowChange:de,arrowX:ke,arrowY:ct,shouldHideArrow:at,children:O.jsx(xs.div,{"data-side":De,"data-align":ze,...X,ref:le,style:{...X.style,animation:We?void 0:"none"}})})})});g8.displayName=VA;var E8="PopperArrow",ZZ={top:"bottom",right:"left",bottom:"top",left:"right"},v8=ee.forwardRef(function(h,f){const{__scopePopper:g,...S}=h,C=QZ(E8,g),w=ZZ[C.placedSide];return O.jsx("span",{ref:C.onArrowChange,style:{position:"absolute",left:C.arrowX,top:C.arrowY,[w]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[C.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[C.placedSide],visibility:C.shouldHideArrow?"hidden":void 0},children:O.jsx(qZ,{...S,ref:f,style:{...S.style,display:"block"}})})});v8.displayName=E8;function $Z(u){return u!==null}var e$=u=>({name:"transformOrigin",options:u,fn(h){const{placement:f,rects:g,middlewareData:S}=h,w=S.arrow?.centerOffset!==0,P=w?0:u.arrowWidth,k=w?0:u.arrowHeight,[M,U]=S8(f),B={start:"0%",center:"50%",end:"100%"}[U],Y=(S.arrow?.x??0)+P/2,H=(S.arrow?.y??0)+k/2;let ie="",X="";return M==="bottom"?(ie=w?B:`${Y}px`,X=`${-k}px`):M==="top"?(ie=w?B:`${Y}px`,X=`${g.floating.height+k}px`):M==="right"?(ie=`${-k}px`,X=w?B:`${H}px`):M==="left"&&(ie=`${g.floating.width+k}px`,X=w?B:`${H}px`),{data:{x:ie,y:X}}}});function S8(u){const[h,f="center"]=u.split("-");return[h,f]}var t$=_8,n$=g8,r$=v8,[w0,Cne]=v0("Tooltip",[p8]),jA=p8(),y8="TooltipProvider",i$=700,N4="tooltip.open",[s$,T8]=w0(y8),C8=u=>{const{__scopeTooltip:h,delayDuration:f=i$,skipDelayDuration:g=300,disableHoverableContent:S=!1,children:C}=u,w=ee.useRef(!0),P=ee.useRef(!1),k=ee.useRef(0);return ee.useEffect(()=>{const M=k.current;return()=>window.clearTimeout(M)},[]),O.jsx(s$,{scope:h,isOpenDelayedRef:w,delayDuration:f,onOpen:ee.useCallback(()=>{window.clearTimeout(k.current),w.current=!1},[]),onClose:ee.useCallback(()=>{window.clearTimeout(k.current),k.current=window.setTimeout(()=>w.current=!0,g)},[g]),isPointerInTransitRef:P,onPointerInTransitChange:ee.useCallback(M=>{P.current=M},[]),disableHoverableContent:S,children:C})};C8.displayName=y8;var R8="Tooltip",[Rne,b0]=w0(R8),mA="TooltipTrigger",o$=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,...g}=u,S=b0(mA,f),C=T8(mA,f),w=jA(f),P=ee.useRef(null),k=ka(h,P,S.onTriggerChange),M=ee.useRef(!1),U=ee.useRef(!1),B=ee.useCallback(()=>M.current=!1,[]);return ee.useEffect(()=>()=>document.removeEventListener("pointerup",B),[B]),O.jsx(t$,{asChild:!0,...w,children:O.jsx(xs.button,{"aria-describedby":S.open?S.contentId:void 0,"data-state":S.stateAttribute,...g,ref:k,onPointerMove:ai(u.onPointerMove,Y=>{Y.pointerType!=="touch"&&!U.current&&!C.isPointerInTransitRef.current&&(S.onTriggerEnter(),U.current=!0)}),onPointerLeave:ai(u.onPointerLeave,()=>{S.onTriggerLeave(),U.current=!1}),onPointerDown:ai(u.onPointerDown,()=>{S.open&&S.onClose(),M.current=!0,document.addEventListener("pointerup",B,{once:!0})}),onFocus:ai(u.onFocus,()=>{M.current||S.onOpen()}),onBlur:ai(u.onBlur,S.onClose),onClick:ai(u.onClick,S.onClose)})})});o$.displayName=mA;var a$="TooltipPortal",[wne,c$]=w0(a$,{forceMount:void 0}),om="TooltipContent",w8=ee.forwardRef((u,h)=>{const f=c$(om,u.__scopeTooltip),{forceMount:g=f.forceMount,side:S="top",...C}=u,w=b0(om,u.__scopeTooltip);return O.jsx(wA,{present:g||w.open,children:w.disableHoverableContent?O.jsx(b8,{side:S,...C,ref:h}):O.jsx(l$,{side:S,...C,ref:h})})}),l$=ee.forwardRef((u,h)=>{const f=b0(om,u.__scopeTooltip),g=T8(om,u.__scopeTooltip),S=ee.useRef(null),C=ka(h,S),[w,P]=ee.useState(null),{trigger:k,onClose:M}=f,U=S.current,{onPointerInTransitChange:B}=g,Y=ee.useCallback(()=>{P(null),B(!1)},[B]),H=ee.useCallback((ie,X)=>{const te=ie.currentTarget,ce={x:ie.clientX,y:ie.clientY},Z=f$(ce,te.getBoundingClientRect()),le=m$(ce,Z),ne=_$(X.getBoundingClientRect()),de=E$([...le,...ne]);P(de),B(!0)},[B]);return ee.useEffect(()=>()=>Y(),[Y]),ee.useEffect(()=>{if(k&&U){const ie=te=>H(te,U),X=te=>H(te,k);return k.addEventListener("pointerleave",ie),U.addEventListener("pointerleave",X),()=>{k.removeEventListener("pointerleave",ie),U.removeEventListener("pointerleave",X)}}},[k,U,H,Y]),ee.useEffect(()=>{if(w){const ie=X=>{const te=X.target,ce={x:X.clientX,y:X.clientY},Z=k?.contains(te)||U?.contains(te),le=!g$(ce,w);Z?Y():le&&(Y(),M())};return document.addEventListener("pointermove",ie),()=>document.removeEventListener("pointermove",ie)}},[k,U,w,M,Y]),O.jsx(b8,{...u,ref:C})}),[d$,u$]=w0(R8,{isInside:!1}),h$=yX("TooltipContent"),b8=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,children:g,"aria-label":S,onEscapeKeyDown:C,onPointerDownOutside:w,...P}=u,k=b0(om,f),M=jA(f),{onClose:U}=k;return ee.useEffect(()=>(document.addEventListener(N4,U),()=>document.removeEventListener(N4,U)),[U]),ee.useEffect(()=>{if(k.trigger){const B=Y=>{Y.target?.contains(k.trigger)&&U()};return window.addEventListener("scroll",B,{capture:!0}),()=>window.removeEventListener("scroll",B,{capture:!0})}},[k.trigger,U]),O.jsx(RA,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:C,onPointerDownOutside:w,onFocusOutside:B=>B.preventDefault(),onDismiss:U,children:O.jsxs(n$,{"data-state":k.stateAttribute,...M,...P,ref:h,style:{...P.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[O.jsx(h$,{children:g}),O.jsx(d$,{scope:f,isInside:!0,children:O.jsx(zX,{id:k.contentId,role:"tooltip",children:S||g})})]})})});w8.displayName=om;var I8="TooltipArrow",p$=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,...g}=u,S=jA(f);return u$(I8,f).isInside?null:O.jsx(r$,{...S,...g,ref:h})});p$.displayName=I8;function f$(u,h){const f=Math.abs(h.top-u.y),g=Math.abs(h.bottom-u.y),S=Math.abs(h.right-u.x),C=Math.abs(h.left-u.x);switch(Math.min(f,g,S,C)){case C:return"left";case S:return"right";case f:return"top";case g:return"bottom";default:throw new Error("unreachable")}}function m$(u,h,f=5){const g=[];switch(h){case"top":g.push({x:u.x-f,y:u.y+f},{x:u.x+f,y:u.y+f});break;case"bottom":g.push({x:u.x-f,y:u.y-f},{x:u.x+f,y:u.y-f});break;case"left":g.push({x:u.x+f,y:u.y-f},{x:u.x+f,y:u.y+f});break;case"right":g.push({x:u.x-f,y:u.y-f},{x:u.x-f,y:u.y+f});break}return g}function _$(u){const{top:h,right:f,bottom:g,left:S}=u;return[{x:S,y:h},{x:f,y:h},{x:f,y:g},{x:S,y:g}]}function g$(u,h){const{x:f,y:g}=u;let S=!1;for(let C=0,w=h.length-1;C<h.length;w=C++){const P=h[C],k=h[w],M=P.x,U=P.y,B=k.x,Y=k.y;U>g!=Y>g&&f<(B-M)*(g-U)/(Y-U)+M&&(S=!S)}return S}function E$(u){const h=u.slice();return h.sort((f,g)=>f.x<g.x?-1:f.x>g.x?1:f.y<g.y?-1:f.y>g.y?1:0),v$(h)}function v$(u){if(u.length<=1)return u.slice();const h=[];for(let g=0;g<u.length;g++){const S=u[g];for(;h.length>=2;){const C=h[h.length-1],w=h[h.length-2];if((C.x-w.x)*(S.y-w.y)>=(C.y-w.y)*(S.x-w.x))h.pop();else break}h.push(S)}h.pop();const f=[];for(let g=u.length-1;g>=0;g--){const S=u[g];for(;f.length>=2;){const C=f[f.length-1],w=f[f.length-2];if((C.x-w.x)*(S.y-w.y)>=(C.y-w.y)*(S.x-w.x))f.pop();else break}f.push(S)}return f.pop(),h.length===1&&f.length===1&&h[0].x===f[0].x&&h[0].y===f[0].y?h:h.concat(f)}var S$=C8,A8=w8;const y$=S$,T$=ee.forwardRef(({className:u,sideOffset:h=4,...f},g)=>O.jsx(A8,{ref:g,sideOffset:h,className:jh("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",u),...f}));T$.displayName=A8.displayName;var I0=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(u){return this.listeners.add(u),this.onSubscribe(),()=>{this.listeners.delete(u),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},A0=typeof window>"u"||"Deno"in globalThis;function Da(){}function C$(u,h){return typeof u=="function"?u(h):u}function R$(u){return typeof u=="number"&&u>=0&&u!==1/0}function w$(u,h){return Math.max(u+(h||0)-Date.now(),0)}function _A(u,h){return typeof u=="function"?u(h):u}function b$(u,h){return typeof u=="function"?u(h):u}function P4(u,h){const{type:f="all",exact:g,fetchStatus:S,predicate:C,queryKey:w,stale:P}=u;if(w){if(g){if(h.queryHash!==FA(w,h.options))return!1}else if(!AE(h.queryKey,w))return!1}if(f!=="all"){const k=h.isActive();if(f==="active"&&!k||f==="inactive"&&k)return!1}return!(typeof P=="boolean"&&h.isStale()!==P||S&&S!==h.state.fetchStatus||C&&!C(h))}function D4(u,h){const{exact:f,status:g,predicate:S,mutationKey:C}=u;if(C){if(!h.options.mutationKey)return!1;if(f){if(IE(h.options.mutationKey)!==IE(C))return!1}else if(!AE(h.options.mutationKey,C))return!1}return!(g&&h.state.status!==g||S&&!S(h))}function FA(u,h){return(h?.queryKeyHashFn||IE)(u)}function IE(u){return JSON.stringify(u,(h,f)=>gA(f)?Object.keys(f).sort().reduce((g,S)=>(g[S]=f[S],g),{}):f)}function AE(u,h){return u===h?!0:typeof u!=typeof h?!1:u&&h&&typeof u=="object"&&typeof h=="object"?Object.keys(h).every(f=>AE(u[f],h[f])):!1}function O8(u,h){if(u===h)return u;const f=k4(u)&&k4(h);if(f||gA(u)&&gA(h)){const g=f?u:Object.keys(u),S=g.length,C=f?h:Object.keys(h),w=C.length,P=f?[]:{},k=new Set(g);let M=0;for(let U=0;U<w;U++){const B=f?U:C[U];(!f&&k.has(B)||f)&&u[B]===void 0&&h[B]===void 0?(P[B]=void 0,M++):(P[B]=O8(u[B],h[B]),P[B]===u[B]&&u[B]!==void 0&&M++)}return S===w&&M===S?u:P}return h}function k4(u){return Array.isArray(u)&&u.length===Object.keys(u).length}function gA(u){if(!L4(u))return!1;const h=u.constructor;if(h===void 0)return!0;const f=h.prototype;return!(!L4(f)||!f.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(u)!==Object.prototype)}function L4(u){return Object.prototype.toString.call(u)==="[object Object]"}function I$(u){return new Promise(h=>{setTimeout(h,u)})}function A$(u,h,f){return typeof f.structuralSharing=="function"?f.structuralSharing(u,h):f.structuralSharing!==!1?O8(u,h):h}function O$(u,h,f=0){const g=[...u,h];return f&&g.length>f?g.slice(1):g}function N$(u,h,f=0){const g=[h,...u];return f&&g.length>f?g.slice(0,-1):g}var BA=Symbol();function N8(u,h){return!u.queryFn&&h?.initialPromise?()=>h.initialPromise:!u.queryFn||u.queryFn===BA?()=>Promise.reject(new Error(`Missing queryFn: '${u.queryHash}'`)):u.queryFn}var P$=class extends I0{#e;#t;#n;constructor(){super(),this.#n=u=>{if(!A0&&window.addEventListener){const h=()=>u();return window.addEventListener("visibilitychange",h,!1),()=>{window.removeEventListener("visibilitychange",h)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(h=>{typeof h=="boolean"?this.setFocused(h):this.onFocus()})}setFocused(u){this.#e!==u&&(this.#e=u,this.onFocus())}onFocus(){const u=this.isFocused();this.listeners.forEach(h=>{h(u)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},P8=new P$,D$=class extends I0{#e=!0;#t;#n;constructor(){super(),this.#n=u=>{if(!A0&&window.addEventListener){const h=()=>u(!0),f=()=>u(!1);return window.addEventListener("online",h,!1),window.addEventListener("offline",f,!1),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",f)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(this.setOnline.bind(this))}setOnline(u){this.#e!==u&&(this.#e=u,this.listeners.forEach(f=>{f(u)}))}isOnline(){return this.#e}},f0=new D$;function k$(){let u,h;const f=new Promise((S,C)=>{u=S,h=C});f.status="pending",f.catch(()=>{});function g(S){Object.assign(f,S),delete f.resolve,delete f.reject}return f.resolve=S=>{g({status:"fulfilled",value:S}),u(S)},f.reject=S=>{g({status:"rejected",reason:S}),h(S)},f}function L$(u){return Math.min(1e3*2**u,3e4)}function D8(u){return(u??"online")==="online"?f0.isOnline():!0}var k8=class extends Error{constructor(u){super("CancelledError"),this.revert=u?.revert,this.silent=u?.silent}};function ZI(u){return u instanceof k8}function L8(u){let h=!1,f=0,g=!1,S;const C=k$(),w=X=>{g||(Y(new k8(X)),u.abort?.())},P=()=>{h=!0},k=()=>{h=!1},M=()=>P8.isFocused()&&(u.networkMode==="always"||f0.isOnline())&&u.canRun(),U=()=>D8(u.networkMode)&&u.canRun(),B=X=>{g||(g=!0,u.onSuccess?.(X),S?.(),C.resolve(X))},Y=X=>{g||(g=!0,u.onError?.(X),S?.(),C.reject(X))},H=()=>new Promise(X=>{S=te=>{(g||M())&&X(te)},u.onPause?.()}).then(()=>{S=void 0,g||u.onContinue?.()}),ie=()=>{if(g)return;let X;const te=f===0?u.initialPromise:void 0;try{X=te??u.fn()}catch(ce){X=Promise.reject(ce)}Promise.resolve(X).then(B).catch(ce=>{if(g)return;const Z=u.retry??(A0?0:3),le=u.retryDelay??L$,ne=typeof le=="function"?le(f,ce):le,de=Z===!0||typeof Z=="number"&&f<Z||typeof Z=="function"&&Z(f,ce);if(h||!de){Y(ce);return}f++,u.onFail?.(f,ce),I$(ne).then(()=>M()?void 0:H()).then(()=>{h?Y(ce):ie()})})};return{promise:C,cancel:w,continue:()=>(S?.(),C),cancelRetry:P,continueRetry:k,canStart:U,start:()=>(U()?ie():H().then(ie),C)}}var x$=u=>setTimeout(u,0);function M$(){let u=[],h=0,f=P=>{P()},g=P=>{P()},S=x$;const C=P=>{h?u.push(P):S(()=>{f(P)})},w=()=>{const P=u;u=[],P.length&&S(()=>{g(()=>{P.forEach(k=>{f(k)})})})};return{batch:P=>{let k;h++;try{k=P()}finally{h--,h||w()}return k},batchCalls:P=>(...k)=>{C(()=>{P(...k)})},schedule:C,setNotifyFunction:P=>{f=P},setBatchNotifyFunction:P=>{g=P},setScheduler:P=>{S=P}}}var ls=M$(),x8=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),R$(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(u){this.gcTime=Math.max(this.gcTime||0,u??(A0?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},U$=class extends x8{#e;#t;#n;#i;#r;#o;#a;constructor(u){super(),this.#a=!1,this.#o=u.defaultOptions,this.setOptions(u.options),this.observers=[],this.#i=u.client,this.#n=this.#i.getQueryCache(),this.queryKey=u.queryKey,this.queryHash=u.queryHash,this.#e=j$(this.options),this.state=u.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(u){this.options={...this.#o,...u},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(u,h){const f=A$(this.state.data,u,this.options);return this.#s({data:f,type:"success",dataUpdatedAt:h?.updatedAt,manual:h?.manual}),f}setState(u,h){this.#s({type:"setState",state:u,setStateOptions:h})}cancel(u){const h=this.#r?.promise;return this.#r?.cancel(u),h?h.then(Da).catch(Da):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(u=>b$(u.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===BA||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(u=>_A(u.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(u=>u.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(u=0){return this.state.data===void 0?!0:u==="static"?!1:this.state.isInvalidated?!0:!w$(this.state.dataUpdatedAt,u)}onFocus(){this.observers.find(h=>h.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(h=>h.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(u){this.observers.includes(u)||(this.observers.push(u),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:u}))}removeObserver(u){this.observers.includes(u)&&(this.observers=this.observers.filter(h=>h!==u),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:u}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}fetch(u,h){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&h?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(u&&this.setOptions(u),!this.options.queryFn){const k=this.observers.find(M=>M.options.queryFn);k&&this.setOptions(k.options)}const f=new AbortController,g=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(this.#a=!0,f.signal)})},S=()=>{const k=N8(this.options,h),U=(()=>{const B={client:this.#i,queryKey:this.queryKey,meta:this.meta};return g(B),B})();return this.#a=!1,this.options.persister?this.options.persister(k,U,this):k(U)},w=(()=>{const k={fetchOptions:h,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:S};return g(k),k})();this.options.behavior?.onFetch(w,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==w.fetchOptions?.meta)&&this.#s({type:"fetch",meta:w.fetchOptions?.meta});const P=k=>{ZI(k)&&k.silent||this.#s({type:"error",error:k}),ZI(k)||(this.#n.config.onError?.(k,this),this.#n.config.onSettled?.(this.state.data,k,this)),this.scheduleGc()};return this.#r=L8({initialPromise:h?.initialPromise,fn:w.fetchFn,abort:f.abort.bind(f),onSuccess:k=>{if(k===void 0){P(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(k)}catch(M){P(M);return}this.#n.config.onSuccess?.(k,this),this.#n.config.onSettled?.(k,this.state.error,this),this.scheduleGc()},onError:P,onFail:(k,M)=>{this.#s({type:"failed",failureCount:k,error:M})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:w.options.retry,retryDelay:w.options.retryDelay,networkMode:w.options.networkMode,canRun:()=>!0}),this.#r.start()}#s(u){const h=f=>{switch(u.type){case"failed":return{...f,fetchFailureCount:u.failureCount,fetchFailureReason:u.error};case"pause":return{...f,fetchStatus:"paused"};case"continue":return{...f,fetchStatus:"fetching"};case"fetch":return{...f,...V$(f.data,this.options),fetchMeta:u.meta??null};case"success":return this.#t=void 0,{...f,data:u.data,dataUpdateCount:f.dataUpdateCount+1,dataUpdatedAt:u.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!u.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const g=u.error;return ZI(g)&&g.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...f,error:g,errorUpdateCount:f.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:f.fetchFailureCount+1,fetchFailureReason:g,fetchStatus:"idle",status:"error"};case"invalidate":return{...f,isInvalidated:!0};case"setState":return{...f,...u.state}}};this.state=h(this.state),ls.batch(()=>{this.observers.forEach(f=>{f.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:u})})}};function V$(u,h){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:D8(h.networkMode)?"fetching":"paused",...u===void 0&&{error:null,status:"pending"}}}function j$(u){const h=typeof u.initialData=="function"?u.initialData():u.initialData,f=h!==void 0,g=f?typeof u.initialDataUpdatedAt=="function"?u.initialDataUpdatedAt():u.initialDataUpdatedAt:0;return{data:h,dataUpdateCount:0,dataUpdatedAt:f?g??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:f?"success":"pending",fetchStatus:"idle"}}var F$=class extends I0{constructor(u={}){super(),this.config=u,this.#e=new Map}#e;build(u,h,f){const g=h.queryKey,S=h.queryHash??FA(g,h);let C=this.get(S);return C||(C=new U$({client:u,queryKey:g,queryHash:S,options:u.defaultQueryOptions(h),state:f,defaultOptions:u.getQueryDefaults(g)}),this.add(C)),C}add(u){this.#e.has(u.queryHash)||(this.#e.set(u.queryHash,u),this.notify({type:"added",query:u}))}remove(u){const h=this.#e.get(u.queryHash);h&&(u.destroy(),h===u&&this.#e.delete(u.queryHash),this.notify({type:"removed",query:u}))}clear(){ls.batch(()=>{this.getAll().forEach(u=>{this.remove(u)})})}get(u){return this.#e.get(u)}getAll(){return[...this.#e.values()]}find(u){const h={exact:!0,...u};return this.getAll().find(f=>P4(h,f))}findAll(u={}){const h=this.getAll();return Object.keys(u).length>0?h.filter(f=>P4(u,f)):h}notify(u){ls.batch(()=>{this.listeners.forEach(h=>{h(u)})})}onFocus(){ls.batch(()=>{this.getAll().forEach(u=>{u.onFocus()})})}onOnline(){ls.batch(()=>{this.getAll().forEach(u=>{u.onOnline()})})}},B$=class extends x8{#e;#t;#n;constructor(u){super(),this.mutationId=u.mutationId,this.#t=u.mutationCache,this.#e=[],this.state=u.state||W$(),this.setOptions(u.options),this.scheduleGc()}setOptions(u){this.options=u,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(u){this.#e.includes(u)||(this.#e.push(u),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:u}))}removeObserver(u){this.#e=this.#e.filter(h=>h!==u),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:u})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(u){const h=()=>{this.#i({type:"continue"})};this.#n=L8({fn:()=>this.options.mutationFn?this.options.mutationFn(u):Promise.reject(new Error("No mutationFn found")),onFail:(S,C)=>{this.#i({type:"failed",failureCount:S,error:C})},onPause:()=>{this.#i({type:"pause"})},onContinue:h,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const f=this.state.status==="pending",g=!this.#n.canStart();try{if(f)h();else{this.#i({type:"pending",variables:u,isPaused:g}),await this.#t.config.onMutate?.(u,this);const C=await this.options.onMutate?.(u);C!==this.state.context&&this.#i({type:"pending",context:C,variables:u,isPaused:g})}const S=await this.#n.start();return await this.#t.config.onSuccess?.(S,u,this.state.context,this),await this.options.onSuccess?.(S,u,this.state.context),await this.#t.config.onSettled?.(S,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(S,null,u,this.state.context),this.#i({type:"success",data:S}),S}catch(S){try{throw await this.#t.config.onError?.(S,u,this.state.context,this),await this.options.onError?.(S,u,this.state.context),await this.#t.config.onSettled?.(void 0,S,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,S,u,this.state.context),S}finally{this.#i({type:"error",error:S})}}finally{this.#t.runNext(this)}}#i(u){const h=f=>{switch(u.type){case"failed":return{...f,failureCount:u.failureCount,failureReason:u.error};case"pause":return{...f,isPaused:!0};case"continue":return{...f,isPaused:!1};case"pending":return{...f,context:u.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:u.isPaused,status:"pending",variables:u.variables,submittedAt:Date.now()};case"success":return{...f,data:u.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...f,data:void 0,error:u.error,failureCount:f.failureCount+1,failureReason:u.error,isPaused:!1,status:"error"}}};this.state=h(this.state),ls.batch(()=>{this.#e.forEach(f=>{f.onMutationUpdate(u)}),this.#t.notify({mutation:this,type:"updated",action:u})})}};function W$(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var G$=class extends I0{constructor(u={}){super(),this.config=u,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(u,h,f){const g=new B$({mutationCache:this,mutationId:++this.#n,options:u.defaultMutationOptions(h),state:f});return this.add(g),g}add(u){this.#e.add(u);const h=JT(u);if(typeof h=="string"){const f=this.#t.get(h);f?f.push(u):this.#t.set(h,[u])}this.notify({type:"added",mutation:u})}remove(u){if(this.#e.delete(u)){const h=JT(u);if(typeof h=="string"){const f=this.#t.get(h);if(f)if(f.length>1){const g=f.indexOf(u);g!==-1&&f.splice(g,1)}else f[0]===u&&this.#t.delete(h)}}this.notify({type:"removed",mutation:u})}canRun(u){const h=JT(u);if(typeof h=="string"){const g=this.#t.get(h)?.find(S=>S.state.status==="pending");return!g||g===u}else return!0}runNext(u){const h=JT(u);return typeof h=="string"?this.#t.get(h)?.find(g=>g!==u&&g.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ls.batch(()=>{this.#e.forEach(u=>{this.notify({type:"removed",mutation:u})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(u){const h={exact:!0,...u};return this.getAll().find(f=>D4(h,f))}findAll(u={}){return this.getAll().filter(h=>D4(u,h))}notify(u){ls.batch(()=>{this.listeners.forEach(h=>{h(u)})})}resumePausedMutations(){const u=this.getAll().filter(h=>h.state.isPaused);return ls.batch(()=>Promise.all(u.map(h=>h.continue().catch(Da))))}};function JT(u){return u.options.scope?.id}function x4(u){return{onFetch:(h,f)=>{const g=h.options,S=h.fetchOptions?.meta?.fetchMore?.direction,C=h.state.data?.pages||[],w=h.state.data?.pageParams||[];let P={pages:[],pageParams:[]},k=0;const M=async()=>{let U=!1;const B=ie=>{Object.defineProperty(ie,"signal",{enumerable:!0,get:()=>(h.signal.aborted?U=!0:h.signal.addEventListener("abort",()=>{U=!0}),h.signal)})},Y=N8(h.options,h.fetchOptions),H=async(ie,X,te)=>{if(U)return Promise.reject();if(X==null&&ie.pages.length)return Promise.resolve(ie);const Z=(()=>{const Pe={client:h.client,queryKey:h.queryKey,pageParam:X,direction:te?"backward":"forward",meta:h.options.meta};return B(Pe),Pe})(),le=await Y(Z),{maxPages:ne}=h.options,de=te?N$:O$;return{pages:de(ie.pages,le,ne),pageParams:de(ie.pageParams,X,ne)}};if(S&&C.length){const ie=S==="backward",X=ie?H$:M4,te={pages:C,pageParams:w},ce=X(g,te);P=await H(te,ce,ie)}else{const ie=u??C.length;do{const X=k===0?w[0]??g.initialPageParam:M4(g,P);if(k>0&&X==null)break;P=await H(P,X),k++}while(k<ie)}return P};h.options.persister?h.fetchFn=()=>h.options.persister?.(M,{client:h.client,queryKey:h.queryKey,meta:h.options.meta,signal:h.signal},f):h.fetchFn=M}}}function M4(u,{pages:h,pageParams:f}){const g=h.length-1;return h.length>0?u.getNextPageParam(h[g],h,f[g],f):void 0}function H$(u,{pages:h,pageParams:f}){return h.length>0?u.getPreviousPageParam?.(h[0],h,f[0],f):void 0}var K$=class{#e;#t;#n;#i;#r;#o;#a;#s;constructor(u={}){this.#e=u.queryCache||new F$,this.#t=u.mutationCache||new G$,this.#n=u.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=P8.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=f0.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(u){return this.#e.findAll({...u,fetchStatus:"fetching"}).length}isMutating(u){return this.#t.findAll({...u,status:"pending"}).length}getQueryData(u){const h=this.defaultQueryOptions({queryKey:u});return this.#e.get(h.queryHash)?.state.data}ensureQueryData(u){const h=this.defaultQueryOptions(u),f=this.#e.build(this,h),g=f.state.data;return g===void 0?this.fetchQuery(u):(u.revalidateIfStale&&f.isStaleByTime(_A(h.staleTime,f))&&this.prefetchQuery(h),Promise.resolve(g))}getQueriesData(u){return this.#e.findAll(u).map(({queryKey:h,state:f})=>{const g=f.data;return[h,g]})}setQueryData(u,h,f){const g=this.defaultQueryOptions({queryKey:u}),C=this.#e.get(g.queryHash)?.state.data,w=C$(h,C);if(w!==void 0)return this.#e.build(this,g).setData(w,{...f,manual:!0})}setQueriesData(u,h,f){return ls.batch(()=>this.#e.findAll(u).map(({queryKey:g})=>[g,this.setQueryData(g,h,f)]))}getQueryState(u){const h=this.defaultQueryOptions({queryKey:u});return this.#e.get(h.queryHash)?.state}removeQueries(u){const h=this.#e;ls.batch(()=>{h.findAll(u).forEach(f=>{h.remove(f)})})}resetQueries(u,h){const f=this.#e;return ls.batch(()=>(f.findAll(u).forEach(g=>{g.reset()}),this.refetchQueries({type:"active",...u},h)))}cancelQueries(u,h={}){const f={revert:!0,...h},g=ls.batch(()=>this.#e.findAll(u).map(S=>S.cancel(f)));return Promise.all(g).then(Da).catch(Da)}invalidateQueries(u,h={}){return ls.batch(()=>(this.#e.findAll(u).forEach(f=>{f.invalidate()}),u?.refetchType==="none"?Promise.resolve():this.refetchQueries({...u,type:u?.refetchType??u?.type??"active"},h)))}refetchQueries(u,h={}){const f={...h,cancelRefetch:h.cancelRefetch??!0},g=ls.batch(()=>this.#e.findAll(u).filter(S=>!S.isDisabled()&&!S.isStatic()).map(S=>{let C=S.fetch(void 0,f);return f.throwOnError||(C=C.catch(Da)),S.state.fetchStatus==="paused"?Promise.resolve():C}));return Promise.all(g).then(Da)}fetchQuery(u){const h=this.defaultQueryOptions(u);h.retry===void 0&&(h.retry=!1);const f=this.#e.build(this,h);return f.isStaleByTime(_A(h.staleTime,f))?f.fetch(h):Promise.resolve(f.state.data)}prefetchQuery(u){return this.fetchQuery(u).then(Da).catch(Da)}fetchInfiniteQuery(u){return u.behavior=x4(u.pages),this.fetchQuery(u)}prefetchInfiniteQuery(u){return this.fetchInfiniteQuery(u).then(Da).catch(Da)}ensureInfiniteQueryData(u){return u.behavior=x4(u.pages),this.ensureQueryData(u)}resumePausedMutations(){return f0.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(u){this.#n=u}setQueryDefaults(u,h){this.#i.set(IE(u),{queryKey:u,defaultOptions:h})}getQueryDefaults(u){const h=[...this.#i.values()],f={};return h.forEach(g=>{AE(u,g.queryKey)&&Object.assign(f,g.defaultOptions)}),f}setMutationDefaults(u,h){this.#r.set(IE(u),{mutationKey:u,defaultOptions:h})}getMutationDefaults(u){const h=[...this.#r.values()],f={};return h.forEach(g=>{AE(u,g.mutationKey)&&Object.assign(f,g.defaultOptions)}),f}defaultQueryOptions(u){if(u._defaulted)return u;const h={...this.#n.queries,...this.getQueryDefaults(u.queryKey),...u,_defaulted:!0};return h.queryHash||(h.queryHash=FA(h.queryKey,h)),h.refetchOnReconnect===void 0&&(h.refetchOnReconnect=h.networkMode!=="always"),h.throwOnError===void 0&&(h.throwOnError=!!h.suspense),!h.networkMode&&h.persister&&(h.networkMode="offlineFirst"),h.queryFn===BA&&(h.enabled=!1),h}defaultMutationOptions(u){return u?._defaulted?u:{...this.#n.mutations,...u?.mutationKey&&this.getMutationDefaults(u.mutationKey),...u,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},z$=ee.createContext(void 0),Y$=({client:u,children:h})=>(ee.useEffect(()=>(u.mount(),()=>{u.unmount()}),[u]),O.jsx(z$.Provider,{value:u,children:h}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function OE(){return OE=Object.assign?Object.assign.bind():function(u){for(var h=1;h<arguments.length;h++){var f=arguments[h];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])}return u},OE.apply(this,arguments)}var zd;(function(u){u.Pop="POP",u.Push="PUSH",u.Replace="REPLACE"})(zd||(zd={}));const U4="popstate";function q$(u){u===void 0&&(u={});function h(g,S){let{pathname:C,search:w,hash:P}=g.location;return EA("",{pathname:C,search:w,hash:P},S.state&&S.state.usr||null,S.state&&S.state.key||"default")}function f(g,S){return typeof S=="string"?S:U8(S)}return J$(h,f,null,u)}function ci(u,h){if(u===!1||u===null||typeof u>"u")throw new Error(h)}function M8(u,h){if(!u){typeof console<"u"&&console.warn(h);try{throw new Error(h)}catch{}}}function X$(){return Math.random().toString(36).substr(2,8)}function V4(u,h){return{usr:u.state,key:u.key,idx:h}}function EA(u,h,f,g){return f===void 0&&(f=null),OE({pathname:typeof u=="string"?u:u.pathname,search:"",hash:""},typeof h=="string"?um(h):h,{state:f,key:h&&h.key||g||X$()})}function U8(u){let{pathname:h="/",search:f="",hash:g=""}=u;return f&&f!=="?"&&(h+=f.charAt(0)==="?"?f:"?"+f),g&&g!=="#"&&(h+=g.charAt(0)==="#"?g:"#"+g),h}function um(u){let h={};if(u){let f=u.indexOf("#");f>=0&&(h.hash=u.substr(f),u=u.substr(0,f));let g=u.indexOf("?");g>=0&&(h.search=u.substr(g),u=u.substr(0,g)),u&&(h.pathname=u)}return h}function J$(u,h,f,g){g===void 0&&(g={});let{window:S=document.defaultView,v5Compat:C=!1}=g,w=S.history,P=zd.Pop,k=null,M=U();M==null&&(M=0,w.replaceState(OE({},w.state,{idx:M}),""));function U(){return(w.state||{idx:null}).idx}function B(){P=zd.Pop;let te=U(),ce=te==null?null:te-M;M=te,k&&k({action:P,location:X.location,delta:ce})}function Y(te,ce){P=zd.Push;let Z=EA(X.location,te,ce);M=U()+1;let le=V4(Z,M),ne=X.createHref(Z);try{w.pushState(le,"",ne)}catch(de){if(de instanceof DOMException&&de.name==="DataCloneError")throw de;S.location.assign(ne)}C&&k&&k({action:P,location:X.location,delta:1})}function H(te,ce){P=zd.Replace;let Z=EA(X.location,te,ce);M=U();let le=V4(Z,M),ne=X.createHref(Z);w.replaceState(le,"",ne),C&&k&&k({action:P,location:X.location,delta:0})}function ie(te){let ce=S.location.origin!=="null"?S.location.origin:S.location.href,Z=typeof te=="string"?te:U8(te);return Z=Z.replace(/ $/,"%20"),ci(ce,"No window.location.(origin|href) available to create URL for href: "+Z),new URL(Z,ce)}let X={get action(){return P},get location(){return u(S,w)},listen(te){if(k)throw new Error("A history only accepts one active listener");return S.addEventListener(U4,B),k=te,()=>{S.removeEventListener(U4,B),k=null}},createHref(te){return h(S,te)},createURL:ie,encodeLocation(te){let ce=ie(te);return{pathname:ce.pathname,search:ce.search,hash:ce.hash}},push:Y,replace:H,go(te){return w.go(te)}};return X}var j4;(function(u){u.data="data",u.deferred="deferred",u.redirect="redirect",u.error="error"})(j4||(j4={}));function Q$(u,h,f){return f===void 0&&(f="/"),Z$(u,h,f)}function Z$(u,h,f,g){let S=typeof h=="string"?um(h):h,C=F8(S.pathname||"/",f);if(C==null)return null;let w=V8(u);$$(w);let P=null;for(let k=0;P==null&&k<w.length;++k){let M=uee(C);P=cee(w[k],M)}return P}function V8(u,h,f,g){h===void 0&&(h=[]),f===void 0&&(f=[]),g===void 0&&(g="");let S=(C,w,P)=>{let k={relativePath:P===void 0?C.path||"":P,caseSensitive:C.caseSensitive===!0,childrenIndex:w,route:C};k.relativePath.startsWith("/")&&(ci(k.relativePath.startsWith(g),'Absolute route path "'+k.relativePath+'" nested under path '+('"'+g+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),k.relativePath=k.relativePath.slice(g.length));let M=Uh([g,k.relativePath]),U=f.concat(k);C.children&&C.children.length>0&&(ci(C.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+M+'".')),V8(C.children,h,U,M)),!(C.path==null&&!C.index)&&h.push({path:M,score:oee(M,C.index),routesMeta:U})};return u.forEach((C,w)=>{var P;if(C.path===""||!((P=C.path)!=null&&P.includes("?")))S(C,w);else for(let k of j8(C.path))S(C,w,k)}),h}function j8(u){let h=u.split("/");if(h.length===0)return[];let[f,...g]=h,S=f.endsWith("?"),C=f.replace(/\?$/,"");if(g.length===0)return S?[C,""]:[C];let w=j8(g.join("/")),P=[];return P.push(...w.map(k=>k===""?C:[C,k].join("/"))),S&&P.push(...w),P.map(k=>u.startsWith("/")&&k===""?"/":k)}function $$(u){u.sort((h,f)=>h.score!==f.score?f.score-h.score:aee(h.routesMeta.map(g=>g.childrenIndex),f.routesMeta.map(g=>g.childrenIndex)))}const eee=/^:[\w-]+$/,tee=3,nee=2,ree=1,iee=10,see=-2,F4=u=>u==="*";function oee(u,h){let f=u.split("/"),g=f.length;return f.some(F4)&&(g+=see),h&&(g+=nee),f.filter(S=>!F4(S)).reduce((S,C)=>S+(eee.test(C)?tee:C===""?ree:iee),g)}function aee(u,h){return u.length===h.length&&u.slice(0,-1).every((g,S)=>g===h[S])?u[u.length-1]-h[h.length-1]:0}function cee(u,h,f){let{routesMeta:g}=u,S={},C="/",w=[];for(let P=0;P<g.length;++P){let k=g[P],M=P===g.length-1,U=C==="/"?h:h.slice(C.length)||"/",B=lee({path:k.relativePath,caseSensitive:k.caseSensitive,end:M},U),Y=k.route;if(!B)return null;Object.assign(S,B.params),w.push({params:S,pathname:Uh([C,B.pathname]),pathnameBase:gee(Uh([C,B.pathnameBase])),route:Y}),B.pathnameBase!=="/"&&(C=Uh([C,B.pathnameBase]))}return w}function lee(u,h){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[f,g]=dee(u.path,u.caseSensitive,u.end),S=h.match(f);if(!S)return null;let C=S[0],w=C.replace(/(.)\/+$/,"$1"),P=S.slice(1);return{params:g.reduce((M,U,B)=>{let{paramName:Y,isOptional:H}=U;if(Y==="*"){let X=P[B]||"";w=C.slice(0,C.length-X.length).replace(/(.)\/+$/,"$1")}const ie=P[B];return H&&!ie?M[Y]=void 0:M[Y]=(ie||"").replace(/%2F/g,"/"),M},{}),pathname:C,pathnameBase:w,pattern:u}}function dee(u,h,f){h===void 0&&(h=!1),f===void 0&&(f=!0),M8(u==="*"||!u.endsWith("*")||u.endsWith("/*"),'Route path "'+u+'" will be treated as if it were '+('"'+u.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+u.replace(/\*$/,"/*")+'".'));let g=[],S="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(w,P,k)=>(g.push({paramName:P,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return u.endsWith("*")?(g.push({paramName:"*"}),S+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):f?S+="\\/*$":u!==""&&u!=="/"&&(S+="(?:(?=\\/|$))"),[new RegExp(S,h?void 0:"i"),g]}function uee(u){try{return u.split("/").map(h=>decodeURIComponent(h).replace(/\//g,"%2F")).join("/")}catch(h){return M8(!1,'The URL path "'+u+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+h+").")),u}}function F8(u,h){if(h==="/")return u;if(!u.toLowerCase().startsWith(h.toLowerCase()))return null;let f=h.endsWith("/")?h.length-1:h.length,g=u.charAt(f);return g&&g!=="/"?null:u.slice(f)||"/"}function hee(u,h){h===void 0&&(h="/");let{pathname:f,search:g="",hash:S=""}=typeof u=="string"?um(u):u;return{pathname:f?f.startsWith("/")?f:pee(f,h):h,search:Eee(g),hash:vee(S)}}function pee(u,h){let f=h.replace(/\/+$/,"").split("/");return u.split("/").forEach(S=>{S===".."?f.length>1&&f.pop():S!=="."&&f.push(S)}),f.length>1?f.join("/"):"/"}function $I(u,h,f,g){return"Cannot include a '"+u+"' character in a manually specified "+("`to."+h+"` field ["+JSON.stringify(g)+"].  Please separate it out to the ")+("`to."+f+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function fee(u){return u.filter((h,f)=>f===0||h.route.path&&h.route.path.length>0)}function mee(u,h){let f=fee(u);return h?f.map((g,S)=>S===f.length-1?g.pathname:g.pathnameBase):f.map(g=>g.pathnameBase)}function _ee(u,h,f,g){g===void 0&&(g=!1);let S;typeof u=="string"?S=um(u):(S=OE({},u),ci(!S.pathname||!S.pathname.includes("?"),$I("?","pathname","search",S)),ci(!S.pathname||!S.pathname.includes("#"),$I("#","pathname","hash",S)),ci(!S.search||!S.search.includes("#"),$I("#","search","hash",S)));let C=u===""||S.pathname==="",w=C?"/":S.pathname,P;if(w==null)P=f;else{let B=h.length-1;if(!g&&w.startsWith("..")){let Y=w.split("/");for(;Y[0]==="..";)Y.shift(),B-=1;S.pathname=Y.join("/")}P=B>=0?h[B]:"/"}let k=hee(S,P),M=w&&w!=="/"&&w.endsWith("/"),U=(C||w===".")&&f.endsWith("/");return!k.pathname.endsWith("/")&&(M||U)&&(k.pathname+="/"),k}const Uh=u=>u.join("/").replace(/\/\/+/g,"/"),gee=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),Eee=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,vee=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function See(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}const B8=["post","put","patch","delete"];new Set(B8);const yee=["get",...B8];new Set(yee);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function NE(){return NE=Object.assign?Object.assign.bind():function(u){for(var h=1;h<arguments.length;h++){var f=arguments[h];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])}return u},NE.apply(this,arguments)}const WA=ee.createContext(null),Tee=ee.createContext(null),O0=ee.createContext(null),N0=ee.createContext(null),hm=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),W8=ee.createContext(null);function P0(){return ee.useContext(N0)!=null}function D0(){return P0()||ci(!1),ee.useContext(N0).location}function G8(u){ee.useContext(O0).static||ee.useLayoutEffect(u)}function Qd(){let{isDataRoute:u}=ee.useContext(hm);return u?xee():Cee()}function Cee(){P0()||ci(!1);let u=ee.useContext(WA),{basename:h,future:f,navigator:g}=ee.useContext(O0),{matches:S}=ee.useContext(hm),{pathname:C}=D0(),w=JSON.stringify(mee(S,f.v7_relativeSplatPath)),P=ee.useRef(!1);return G8(()=>{P.current=!0}),ee.useCallback(function(M,U){if(U===void 0&&(U={}),!P.current)return;if(typeof M=="number"){g.go(M);return}let B=_ee(M,JSON.parse(w),C,U.relative==="path");u==null&&h!=="/"&&(B.pathname=B.pathname==="/"?h:Uh([h,B.pathname])),(U.replace?g.replace:g.push)(B,U.state,U)},[h,g,w,C,u])}function Ree(u,h){return wee(u,h)}function wee(u,h,f,g){P0()||ci(!1);let{navigator:S}=ee.useContext(O0),{matches:C}=ee.useContext(hm),w=C[C.length-1],P=w?w.params:{};w&&w.pathname;let k=w?w.pathnameBase:"/";w&&w.route;let M=D0(),U;if(h){var B;let te=typeof h=="string"?um(h):h;k==="/"||(B=te.pathname)!=null&&B.startsWith(k)||ci(!1),U=te}else U=M;let Y=U.pathname||"/",H=Y;if(k!=="/"){let te=k.replace(/^\//,"").split("/");H="/"+Y.replace(/^\//,"").split("/").slice(te.length).join("/")}let ie=Q$(u,{pathname:H}),X=Nee(ie&&ie.map(te=>Object.assign({},te,{params:Object.assign({},P,te.params),pathname:Uh([k,S.encodeLocation?S.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?k:Uh([k,S.encodeLocation?S.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),C,f,g);return h&&X?ee.createElement(N0.Provider,{value:{location:NE({pathname:"/",search:"",hash:"",state:null,key:"default"},U),navigationType:zd.Pop}},X):X}function bee(){let u=Lee(),h=See(u)?u.status+" "+u.statusText:u instanceof Error?u.message:JSON.stringify(u),f=u instanceof Error?u.stack:null,S={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},h),f?ee.createElement("pre",{style:S},f):null,null)}const Iee=ee.createElement(bee,null);class Aee extends ee.Component{constructor(h){super(h),this.state={location:h.location,revalidation:h.revalidation,error:h.error}}static getDerivedStateFromError(h){return{error:h}}static getDerivedStateFromProps(h,f){return f.location!==h.location||f.revalidation!=="idle"&&h.revalidation==="idle"?{error:h.error,location:h.location,revalidation:h.revalidation}:{error:h.error!==void 0?h.error:f.error,location:f.location,revalidation:h.revalidation||f.revalidation}}componentDidCatch(h,f){console.error("React Router caught the following error during render",h,f)}render(){return this.state.error!==void 0?ee.createElement(hm.Provider,{value:this.props.routeContext},ee.createElement(W8.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Oee(u){let{routeContext:h,match:f,children:g}=u,S=ee.useContext(WA);return S&&S.static&&S.staticContext&&(f.route.errorElement||f.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=f.route.id),ee.createElement(hm.Provider,{value:h},g)}function Nee(u,h,f,g){var S;if(h===void 0&&(h=[]),f===void 0&&(f=null),g===void 0&&(g=null),u==null){var C;if(!f)return null;if(f.errors)u=f.matches;else if((C=g)!=null&&C.v7_partialHydration&&h.length===0&&!f.initialized&&f.matches.length>0)u=f.matches;else return null}let w=u,P=(S=f)==null?void 0:S.errors;if(P!=null){let U=w.findIndex(B=>B.route.id&&P?.[B.route.id]!==void 0);U>=0||ci(!1),w=w.slice(0,Math.min(w.length,U+1))}let k=!1,M=-1;if(f&&g&&g.v7_partialHydration)for(let U=0;U<w.length;U++){let B=w[U];if((B.route.HydrateFallback||B.route.hydrateFallbackElement)&&(M=U),B.route.id){let{loaderData:Y,errors:H}=f,ie=B.route.loader&&Y[B.route.id]===void 0&&(!H||H[B.route.id]===void 0);if(B.route.lazy||ie){k=!0,M>=0?w=w.slice(0,M+1):w=[w[0]];break}}}return w.reduceRight((U,B,Y)=>{let H,ie=!1,X=null,te=null;f&&(H=P&&B.route.id?P[B.route.id]:void 0,X=B.route.errorElement||Iee,k&&(M<0&&Y===0?(Mee("route-fallback"),ie=!0,te=null):M===Y&&(ie=!0,te=B.route.hydrateFallbackElement||null)));let ce=h.concat(w.slice(0,Y+1)),Z=()=>{let le;return H?le=X:ie?le=te:B.route.Component?le=ee.createElement(B.route.Component,null):B.route.element?le=B.route.element:le=U,ee.createElement(Oee,{match:B,routeContext:{outlet:U,matches:ce,isDataRoute:f!=null},children:le})};return f&&(B.route.ErrorBoundary||B.route.errorElement||Y===0)?ee.createElement(Aee,{location:f.location,revalidation:f.revalidation,component:X,error:H,children:Z(),routeContext:{outlet:null,matches:ce,isDataRoute:!0}}):Z()},null)}var H8=function(u){return u.UseBlocker="useBlocker",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u}(H8||{}),K8=function(u){return u.UseBlocker="useBlocker",u.UseLoaderData="useLoaderData",u.UseActionData="useActionData",u.UseRouteError="useRouteError",u.UseNavigation="useNavigation",u.UseRouteLoaderData="useRouteLoaderData",u.UseMatches="useMatches",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u.UseRouteId="useRouteId",u}(K8||{});function Pee(u){let h=ee.useContext(WA);return h||ci(!1),h}function Dee(u){let h=ee.useContext(Tee);return h||ci(!1),h}function kee(u){let h=ee.useContext(hm);return h||ci(!1),h}function z8(u){let h=kee(),f=h.matches[h.matches.length-1];return f.route.id||ci(!1),f.route.id}function Lee(){var u;let h=ee.useContext(W8),f=Dee(),g=z8();return h!==void 0?h:(u=f.errors)==null?void 0:u[g]}function xee(){let{router:u}=Pee(H8.UseNavigateStable),h=z8(K8.UseNavigateStable),f=ee.useRef(!1);return G8(()=>{f.current=!0}),ee.useCallback(function(S,C){C===void 0&&(C={}),f.current&&(typeof S=="number"?u.navigate(S):u.navigate(S,NE({fromRouteId:h},C)))},[u,h])}const B4={};function Mee(u,h,f){B4[u]||(B4[u]=!0)}function Uee(u,h){u?.v7_startTransition,u?.v7_relativeSplatPath}function cs(u){ci(!1)}function Vee(u){let{basename:h="/",children:f=null,location:g,navigationType:S=zd.Pop,navigator:C,static:w=!1,future:P}=u;P0()&&ci(!1);let k=h.replace(/^\/*/,"/"),M=ee.useMemo(()=>({basename:k,navigator:C,static:w,future:NE({v7_relativeSplatPath:!1},P)}),[k,P,C,w]);typeof g=="string"&&(g=um(g));let{pathname:U="/",search:B="",hash:Y="",state:H=null,key:ie="default"}=g,X=ee.useMemo(()=>{let te=F8(U,k);return te==null?null:{location:{pathname:te,search:B,hash:Y,state:H,key:ie},navigationType:S}},[k,U,B,Y,H,ie,S]);return X==null?null:ee.createElement(O0.Provider,{value:M},ee.createElement(N0.Provider,{children:f,value:X}))}function jee(u){let{children:h,location:f}=u;return Ree(vA(h),f)}new Promise(()=>{});function vA(u,h){h===void 0&&(h=[]);let f=[];return ee.Children.forEach(u,(g,S)=>{if(!ee.isValidElement(g))return;let C=[...h,S];if(g.type===ee.Fragment){f.push.apply(f,vA(g.props.children,C));return}g.type!==cs&&ci(!1),!g.props.index||!g.props.children||ci(!1);let w={id:g.props.id||C.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:g.props.ErrorBoundary!=null||g.props.errorElement!=null,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(w.children=vA(g.props.children,C)),f.push(w)}),f}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Fee="6";try{window.__reactRouterVersion=Fee}catch{}const Bee="startTransition",W4=lj[Bee];function Wee(u){let{basename:h,children:f,future:g,window:S}=u,C=ee.useRef();C.current==null&&(C.current=q$({window:S,v5Compat:!0}));let w=C.current,[P,k]=ee.useState({action:w.action,location:w.location}),{v7_startTransition:M}=g||{},U=ee.useCallback(B=>{M&&W4?W4(()=>k(B)):k(B)},[k,M]);return ee.useLayoutEffect(()=>w.listen(U),[w,U]),ee.useEffect(()=>Uee(g),[g]),ee.createElement(Vee,{basename:h,children:f,location:P.location,navigationType:P.action,navigator:w,future:g})}var G4;(function(u){u.UseScrollRestoration="useScrollRestoration",u.UseSubmit="useSubmit",u.UseSubmitFetcher="useSubmitFetcher",u.UseFetcher="useFetcher",u.useViewTransitionState="useViewTransitionState"})(G4||(G4={}));var H4;(function(u){u.UseFetcher="useFetcher",u.UseFetchers="useFetchers",u.UseScrollRestoration="useScrollRestoration"})(H4||(H4={}));/*! Capacitor: https://capacitorjs.com/ - MIT License */var am;(function(u){u.Unimplemented="UNIMPLEMENTED",u.Unavailable="UNAVAILABLE"})(am||(am={}));class e1 extends Error{constructor(h,f,g){super(h),this.message=h,this.code=f,this.data=g}}const Gee=u=>{var h,f;return u?.androidBridge?"android":!((f=(h=u?.webkit)===null||h===void 0?void 0:h.messageHandlers)===null||f===void 0)&&f.bridge?"ios":"web"},Hee=u=>{const h=u.CapacitorCustomPlatform||null,f=u.Capacitor||{},g=f.Plugins=f.Plugins||{},S=()=>h!==null?h.name:Gee(u),C=()=>S()!=="web",w=B=>{const Y=M.get(B);return!!(Y?.platforms.has(S())||P(B))},P=B=>{var Y;return(Y=f.PluginHeaders)===null||Y===void 0?void 0:Y.find(H=>H.name===B)},k=B=>u.console.error(B),M=new Map,U=(B,Y={})=>{const H=M.get(B);if(H)return console.warn(`Capacitor plugin "${B}" already registered. Cannot register plugins twice.`),H.proxy;const ie=S(),X=P(B);let te;const ce=async()=>(!te&&ie in Y?te=typeof Y[ie]=="function"?te=await Y[ie]():te=Y[ie]:h!==null&&!te&&"web"in Y&&(te=typeof Y.web=="function"?te=await Y.web():te=Y.web),te),Z=(he,ye)=>{var Ve,Je;if(X){const Ue=X?.methods.find(xe=>ye===xe.name);if(Ue)return Ue.rtype==="promise"?xe=>f.nativePromise(B,ye.toString(),xe):(xe,Ge)=>f.nativeCallback(B,ye.toString(),xe,Ge);if(he)return(Ve=he[ye])===null||Ve===void 0?void 0:Ve.bind(he)}else{if(he)return(Je=he[ye])===null||Je===void 0?void 0:Je.bind(he);throw new e1(`"${B}" plugin is not implemented on ${ie}`,am.Unimplemented)}},le=he=>{let ye;const Ve=(...Je)=>{const Ue=ce().then(xe=>{const Ge=Z(xe,he);if(Ge){const dt=Ge(...Je);return ye=dt?.remove,dt}else throw new e1(`"${B}.${he}()" is not implemented on ${ie}`,am.Unimplemented)});return he==="addListener"&&(Ue.remove=async()=>ye()),Ue};return Ve.toString=()=>`${he.toString()}() { [capacitor code] }`,Object.defineProperty(Ve,"name",{value:he,writable:!1,configurable:!1}),Ve},ne=le("addListener"),de=le("removeListener"),Pe=(he,ye)=>{const Ve=ne({eventName:he},ye),Je=async()=>{const xe=await Ve;de({eventName:he,callbackId:xe},ye)},Ue=new Promise(xe=>Ve.then(()=>xe({remove:Je})));return Ue.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Je()},Ue},ue=new Proxy({},{get(he,ye){switch(ye){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return X?Pe:ne;case"removeListener":return de;default:return le(ye)}}});return g[B]=ue,M.set(B,{name:B,proxy:ue,platforms:new Set([...Object.keys(Y),...X?[ie]:[]])}),ue};return f.convertFileSrc||(f.convertFileSrc=B=>B),f.getPlatform=S,f.handleError=k,f.isNativePlatform=C,f.isPluginAvailable=w,f.registerPlugin=U,f.Exception=e1,f.DEBUG=!!f.DEBUG,f.isLoggingEnabled=!!f.isLoggingEnabled,f},Kee=u=>u.Capacitor=Hee(u),PE=Kee(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}),Y8=PE.registerPlugin;class q8{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(h,f){let g=!1;this.listeners[h]||(this.listeners[h]=[],g=!0),this.listeners[h].push(f);const C=this.windowListeners[h];C&&!C.registered&&this.addWindowListener(C),g&&this.sendRetainedArgumentsForEvent(h);const w=async()=>this.removeListener(h,f);return Promise.resolve({remove:w})}async removeAllListeners(){this.listeners={};for(const h in this.windowListeners)this.removeWindowListener(this.windowListeners[h]);this.windowListeners={}}notifyListeners(h,f,g){const S=this.listeners[h];if(!S){if(g){let C=this.retainedEventArguments[h];C||(C=[]),C.push(f),this.retainedEventArguments[h]=C}return}S.forEach(C=>C(f))}hasListeners(h){var f;return!!(!((f=this.listeners[h])===null||f===void 0)&&f.length)}registerWindowListener(h,f){this.windowListeners[f]={registered:!1,windowEventName:h,pluginEventName:f,handler:g=>{this.notifyListeners(f,g)}}}unimplemented(h="not implemented"){return new PE.Exception(h,am.Unimplemented)}unavailable(h="not available"){return new PE.Exception(h,am.Unavailable)}async removeListener(h,f){const g=this.listeners[h];if(!g)return;const S=g.indexOf(f);this.listeners[h].splice(S,1),this.listeners[h].length||this.removeWindowListener(this.windowListeners[h])}addWindowListener(h){window.addEventListener(h.windowEventName,h.handler),h.registered=!0}removeWindowListener(h){h&&(window.removeEventListener(h.windowEventName,h.handler),h.registered=!1)}sendRetainedArgumentsForEvent(h){const f=this.retainedEventArguments[h];f&&(delete this.retainedEventArguments[h],f.forEach(g=>{this.notifyListeners(h,g)}))}}const K4=u=>encodeURIComponent(u).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),z4=u=>u.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class zee extends q8{async getCookies(){const h=document.cookie,f={};return h.split(";").forEach(g=>{if(g.length<=0)return;let[S,C]=g.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");S=z4(S).trim(),C=z4(C).trim(),f[S]=C}),f}async setCookie(h){try{const f=K4(h.key),g=K4(h.value),S=`; expires=${(h.expires||"").replace("expires=","")}`,C=(h.path||"/").replace("path=",""),w=h.url!=null&&h.url.length>0?`domain=${h.url}`:"";document.cookie=`${f}=${g||""}${S}; path=${C}; ${w};`}catch(f){return Promise.reject(f)}}async deleteCookie(h){try{document.cookie=`${h.key}=; Max-Age=0`}catch(f){return Promise.reject(f)}}async clearCookies(){try{const h=document.cookie.split(";")||[];for(const f of h)document.cookie=f.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(h){return Promise.reject(h)}}async clearAllCookies(){try{await this.clearCookies()}catch(h){return Promise.reject(h)}}}Y8("CapacitorCookies",{web:()=>new zee});const Yee=async u=>new Promise((h,f)=>{const g=new FileReader;g.onload=()=>{const S=g.result;h(S.indexOf(",")>=0?S.split(",")[1]:S)},g.onerror=S=>f(S),g.readAsDataURL(u)}),qee=(u={})=>{const h=Object.keys(u);return Object.keys(u).map(S=>S.toLocaleLowerCase()).reduce((S,C,w)=>(S[C]=u[h[w]],S),{})},Xee=(u,h=!0)=>u?Object.entries(u).reduce((g,S)=>{const[C,w]=S;let P,k;return Array.isArray(w)?(k="",w.forEach(M=>{P=h?encodeURIComponent(M):M,k+=`${C}=${P}&`}),k.slice(0,-1)):(P=h?encodeURIComponent(w):w,k=`${C}=${P}`),`${g}&${k}`},"").substr(1):null,Jee=(u,h={})=>{const f=Object.assign({method:u.method||"GET",headers:u.headers},h),S=qee(u.headers)["content-type"]||"";if(typeof u.data=="string")f.body=u.data;else if(S.includes("application/x-www-form-urlencoded")){const C=new URLSearchParams;for(const[w,P]of Object.entries(u.data||{}))C.set(w,P);f.body=C.toString()}else if(S.includes("multipart/form-data")||u.data instanceof FormData){const C=new FormData;if(u.data instanceof FormData)u.data.forEach((P,k)=>{C.append(k,P)});else for(const P of Object.keys(u.data))C.append(P,u.data[P]);f.body=C;const w=new Headers(f.headers);w.delete("content-type"),f.headers=w}else(S.includes("application/json")||typeof u.data=="object")&&(f.body=JSON.stringify(u.data));return f};class Qee extends q8{async request(h){const f=Jee(h,h.webFetchExtra),g=Xee(h.params,h.shouldEncodeUrlParams),S=g?`${h.url}?${g}`:h.url,C=await fetch(S,f),w=C.headers.get("content-type")||"";let{responseType:P="text"}=C.ok?h:{};w.includes("application/json")&&(P="json");let k,M;switch(P){case"arraybuffer":case"blob":M=await C.blob(),k=await Yee(M);break;case"json":k=await C.json();break;case"document":case"text":default:k=await C.text()}const U={};return C.headers.forEach((B,Y)=>{U[Y]=B}),{data:k,headers:U,status:C.status,url:C.url}}async get(h){return this.request(Object.assign(Object.assign({},h),{method:"GET"}))}async post(h){return this.request(Object.assign(Object.assign({},h),{method:"POST"}))}async put(h){return this.request(Object.assign(Object.assign({},h),{method:"PUT"}))}async patch(h){return this.request(Object.assign(Object.assign({},h),{method:"PATCH"}))}async delete(h){return this.request(Object.assign(Object.assign({},h),{method:"DELETE"}))}}Y8("CapacitorHttp",{web:()=>new Qee});const Zee=u=>"<URL>",$ee=u=>u?"<TOKEN>":"<EMPTY>",X8=u=>{if(!u)return"Unknown error";let h=u instanceof Error?u.message:String(u);return h=h.replace(/https?:\/\/[^\s'"]+/g,"<URL>"),h},GA=u=>{if(!u||typeof u!="object")return u;const h={...u},f=["url","authorization_url","token","access_token","refresh_token","code","state","code_verifier","code_challenge"];for(const g of f)g in h&&(g.includes("url")?h[g]="<URL>":h[g]="<REDACTED>");return h},ete=(...u)=>{const h=u.map(f=>typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?GA(f):f);console.log(...h)},tte=(...u)=>{const h=u.map(f=>f instanceof Error?X8(f):typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?GA(f):f);console.error(...h)},nte=(...u)=>{const h=u.map(f=>typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?GA(f):f);console.warn(...h)},rte=(u,h,f)=>{},ite=(u,h,f,g)=>{},ste=(u,h)=>{},tt={log:ete,error:tte,warn:nte,apiRequest:rte,apiResponse:ite,debugGroup:ste,maskUrl:Zee,maskToken:$ee,maskErrorMessage:X8},Ma=()=>{if(console.log("  URL:",window.location.href),console.log("  Origin:",window.location.origin),console.log(" Capacitor Native:",PE.isNativePlatform()),PE.isNativePlatform())return console.log("   -   "),"https://silverld.site/api";const u="http://localhost:8080/api";return console.log("  -  :",u),String(u).replace(/\/$/,"")};let HA=null,SE=!1,SA=[];const Jr={STATE:"oauth_state",CODE_VERIFIER:"oauth_code_verifier",PROVIDER:"oauth_provider",USER_INFO:"user_info"},k0=(u,h)=>{HA=u,tt.log(" Access token   ")},KA=()=>HA,yA=()=>{HA=null,tt.log("  access token  ")},ote=u=>{SA.push(u)},t1=u=>{SA.forEach(h=>h(u)),SA=[]},J8=async u=>{try{const h={email:u.email.trim(),password:u.password,real_name:u.real_name.trim()},f=`${Ma()}/v1/auth/signup`;tt.apiRequest("POST","/v1/auth/signup"),tt.log(`   URL: ${f}`);const g=new AbortController,S=setTimeout(()=>g.abort(),3e4);let C;try{C=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include",signal:g.signal})}finally{clearTimeout(S)}const w=await C.text();if(!C.ok){tt.error("  :",{status:C.status,statusText:C.statusText});let M=" .";try{const U=JSON.parse(w);tt.error("   :",U),M=U.message||M,U.errors&&U.errors.length>0&&(M=U.errors.map(Y=>Y.message).join(", ")||M)}catch(U){tt.error("   :",U),tt.error(" :",w),w?M=w:M=` . ( : ${C.status})`}throw new Error(M)}let P;try{P=JSON.parse(w)}catch(M){throw tt.error("  :",M),new Error("     .")}k0(P.data.access_token,P.data.expires_in);const k={id:P.data.user_info.id,is_new_user:P.data.user_info.is_new_user,is_profile_complete:P.data.user_info.is_profile_complete};return localStorage.setItem(Jr.USER_INFO,JSON.stringify(k)),tt.log("  "),P}catch(h){throw tt.error(" :",h),h}},Q8=async u=>{try{const h={email:u.email.trim(),password:u.password},f=`${Ma()}/v1/auth/login`;tt.apiRequest("POST","/v1/auth/login"),tt.log(`   URL: ${f}`);const g=new AbortController,S=setTimeout(()=>g.abort(),3e4);let C;try{C=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include",signal:g.signal})}finally{clearTimeout(S)}const w=await C.text();if(!C.ok){tt.error("  :",{status:C.status,statusText:C.statusText});let M=" .";try{const U=JSON.parse(w);tt.error("   :",U),M=U.message||M,U.errors&&U.errors.length>0&&(M=U.errors.map(Y=>Y.message).join(", ")||M)}catch(U){tt.error("   :",U),tt.error(" :",w),w?M=w:M=` . ( : ${C.status})`}throw new Error(M)}let P;try{P=JSON.parse(w)}catch(M){throw tt.error("  :",M),new Error("     .")}k0(P.data.access_token,P.data.expires_in);const k={id:P.data.user_info.id,is_new_user:P.data.user_info.is_new_user,is_profile_complete:P.data.user_info.is_profile_complete};return localStorage.setItem(Jr.USER_INFO,JSON.stringify(k)),tt.log("  "),P}catch(h){throw tt.error(" :",h),h}},Z8=async u=>{try{const h=`${Ma()}/v1/auth/oauth/${u}/config`;tt.apiRequest("GET",`/v1/auth/oauth/${u}/config`);const f=new AbortController,g=setTimeout(()=>f.abort(),3e4);let S;try{S=await fetch(h,{signal:f.signal})}finally{clearTimeout(g)}if(!S.ok){const C=S.headers.get("content-type");if(C&&C.includes("application/json")){const w=await S.json();throw new Error(w.message||"OAuth   .")}else{const w=await S.text();throw tt.error("  :",w),new Error(`    . (${S.status})`)}}return await S.json()}catch(h){throw tt.error("OAuth   :",h),h}},$8=async u=>{try{const h=await Z8(u);sessionStorage.setItem(Jr.STATE,h.data.state),sessionStorage.setItem(Jr.CODE_VERIFIER,h.data.code_verifier),sessionStorage.setItem(Jr.PROVIDER,u),tt.log("   :",u),window.location.href=h.data.authorization_url}catch(h){throw tt.error("   :",h),h}},eF=async()=>{const u=new URLSearchParams(window.location.search),h=u.get("code"),f=u.get("state"),g=u.get("error");if(tt.log("OAuth  :",{code_length:h?.length??0,state_length:f?.length??0,has_error:!!g}),g)throw tt.error("OAuth :",g),new Error(`OAuth    : ${g}`);if(!h||!f)return null;const S=sessionStorage.getItem(Jr.STATE),C=sessionStorage.getItem(Jr.CODE_VERIFIER),w=sessionStorage.getItem(Jr.PROVIDER),P=["google","kakao","naver"].find(k=>k===w);if(!P)throw sessionStorage.removeItem(Jr.STATE),sessionStorage.removeItem(Jr.CODE_VERIFIER),sessionStorage.removeItem(Jr.PROVIDER),new Error("  OAuth .  .");if(!S||!C||!P)throw new Error("OAuth   .  .");if(f!==S)throw new Error("OAuth state  .   .");return await tF(P,h,f,C)},tF=async(u,h,f,g)=>{try{const S={code:h,state:f,code_verifier:g,device_info:`${navigator.platform} - ${navigator.userAgent.split(" ")[0]}`};tt.log("  :",{provider:u,code_length:h?.length||0,state_length:f?.length||0,code_verifier_length:g?.length||0,device_info_length:S.device_info?.length||0});const C=new AbortController,w=setTimeout(()=>{tt.error(" OAuth   (60 )"),C.abort()},6e4),P=Date.now();tt.apiRequest("POST",`/v1/auth/oauth/${u}`);let k;try{k=await fetch(`${Ma()}/v1/auth/oauth/${u}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S),credentials:"include",signal:C.signal});const B=Date.now()-P;tt.log(` OAuth   : ${B}ms`)}catch(B){const Y=Date.now()-P;throw tt.error(` OAuth   : ${Y}ms`,B),B}finally{clearTimeout(w)}if(!k.ok){tt.error("OAuth   :",{status:k.status,statusText:k.statusText});const B=k.headers.get("content-type");if(B&&B.includes("application/json")){const Y=await k.json();throw tt.error("   :",Y),tt.debugGroup("  ",{provider:u,error_code:Y.code,error_message:Y.message,timestamp:Y.timestamp,status:k.status,errors:Y.errors||[]}),new Error(Y.message||" .")}else{const Y=await k.text();throw tt.error("   :",Y),new Error(` : ${k.status} ${k.statusText}`)}}const M=await k.json();k0(M.data.access_token,M.data.expires_in);const U={id:M.data.user_info.id,is_new_user:M.data.user_info.is_new_user,is_profile_complete:M.data.user_info.is_profile_complete};return localStorage.setItem(Jr.USER_INFO,JSON.stringify(U)),sessionStorage.removeItem(Jr.STATE),sessionStorage.removeItem(Jr.CODE_VERIFIER),sessionStorage.removeItem(Jr.PROVIDER),M}catch(S){throw tt.error("   :",S),S}},uo=(u="access_token")=>u==="access_token"?KA():null,DE=()=>{const u=localStorage.getItem(Jr.USER_INFO);if(!u)return null;try{return JSON.parse(u)}catch(h){return tt.error("   :",h),null}},nF=async()=>{try{const u=uo("access_token"),h={"Content-Type":"application/json"};u&&(h.Authorization=`Bearer ${u}`);const f={logout_all:!0};tt.apiRequest("POST","/v1/auth/logout",f);const g=new AbortController,S=setTimeout(()=>g.abort(),1e4);let C;try{C=await fetch(`${Ma()}/v1/auth/logout`,{method:"POST",headers:h,body:JSON.stringify(f),credentials:"include",signal:g.signal})}finally{clearTimeout(S)}if(!C.ok)if((C.headers.get("content-type")||"").includes("application/json")){const k=await C.json();throw tt.error(" API :",k),new Error(` : ${k.message||C.statusText}`)}else{const k=await C.text();throw tt.error(" API ():",k),new Error(` : ${C.status} ${C.statusText}`)}const w=await C.json();tt.apiResponse("POST","/v1/auth/logout",C.status,w)}catch(u){throw tt.error("    :",u),u}},rF=async()=>{try{await nF()}catch(u){tt.error("  ,   :",u)}finally{try{yA(),localStorage.removeItem(Jr.USER_INFO),sessionStorage.removeItem(Jr.STATE),sessionStorage.removeItem(Jr.CODE_VERIFIER),sessionStorage.removeItem(Jr.PROVIDER),tt.log("  ")}catch(u){tt.error("    :",u)}}},zA=()=>KA()?(tt.log(" :  "),!0):(tt.log(" :  "),!1),YA=async()=>{try{const u=uo("access_token");if(!u)throw new Error("  .");tt.apiRequest("GET","/v1/auth/me");const h=new AbortController,f=setTimeout(()=>h.abort(),1e4);let g=await fetch(`${Ma()}/v1/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},credentials:"include",signal:h.signal});if(clearTimeout(f),g.status===401){tt.log("   401  ,    ...");const C=await yi();if(C){tt.log("   ,    ...");const w=new AbortController,P=setTimeout(()=>w.abort(),1e4);g=await fetch(`${Ma()}/v1/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"},credentials:"include",signal:w.signal}),clearTimeout(P),tt.log(`     : ${g.status}`)}else throw tt.error("   "),new Error(" .  .")}if(!g.ok)if((g.headers.get("content-type")||"").includes("application/json")){const w=await g.json();throw tt.error("  API :",w),new Error(`  : ${w.message||g.statusText}`)}else{const w=await g.text();throw tt.error("  API ():",w),new Error(`  : ${g.status} ${g.statusText}`)}const S=await g.json();return tt.apiResponse("GET","/v1/auth/me",g.status,S),S}catch(u){throw tt.error("     :",u),u}},iF=async u=>{try{const h=uo("access_token");if(!h)throw new Error("  .");const f=u;tt.apiRequest("PUT","/v1/users/profile",f);const g=new AbortController,S=setTimeout(()=>g.abort(),1e4);let C=await fetch(`${Ma()}/v1/users/profile`,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(f),credentials:"include",signal:g.signal});if(clearTimeout(S),C.status===401){tt.log("   401  ,    ...");const P=await yi();if(P){tt.log("   ,    ...");const k=new AbortController,M=setTimeout(()=>k.abort(),1e4);C=await fetch(`${Ma()}/v1/users/profile`,{method:"PUT",headers:{Authorization:`Bearer ${P}`,"Content-Type":"application/json"},body:JSON.stringify(f),credentials:"include",signal:k.signal}),clearTimeout(M),tt.log(`     : ${C.status}`)}else throw tt.error("   "),new Error(" .  .")}if(!C.ok)if((C.headers.get("content-type")||"").includes("application/json")){const k=await C.json();throw tt.error("  API :",k),new Error(`  : ${k.message||C.statusText}`)}else{const k=await C.text();throw tt.error("  API ():",k),new Error(`  : ${C.status} ${C.statusText}`)}const w=await C.json();return tt.apiResponse("PUT","/v1/users/profile",C.status,w),w}catch(h){throw tt.error("    :",h),h}},sF=async()=>{try{return tt.log("  :   ..."),KA()?(tt.log("     -  "),!0):await yi()?(tt.log("   :   "),!0):(tt.log("  :  refresh token  ( )"),!1)}catch(u){return tt.error("   :",u),!1}},yi=async()=>{if(SE)return tt.log("     - ..."),new Promise(u=>{ote(h=>{u(h)})});try{SE=!0,tt.log("   ...");const u=new AbortController,h=setTimeout(()=>u.abort(),1e4);let f;try{tt.apiRequest("POST","/v1/auth/refresh"),f=await fetch(`${Ma()}/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:""}),credentials:"include",signal:u.signal}),tt.log(`   API  : ${f.status}`)}finally{clearTimeout(h)}if(!f.ok){if(f.status===401)return tt.warn("   ."),yA(),SE=!1,t1(""),null;throw tt.error(`   : ${f.status} ${f.statusText}`),new Error(`  : ${f.status}`)}const g=await f.json();return tt.log("    :",g),k0(g.data.access_token,g.data.expires_in),tt.log("  access_token   "),tt.log("   "),SE=!1,t1(g.data.access_token),g.data.access_token}catch(u){return SE=!1,t1(""),u instanceof Error&&u.name==="AbortError"?tt.error("   :",u):tt.error("   :",u),yA(),null}},QT=Object.freeze(Object.defineProperty({__proto__:null,getApiUrl:Ma,getOAuthConfig:Z8,getStoredToken:uo,getStoredUserInfo:DE,getUserProfile:YA,initializeAuth:sF,isAuthenticated:zA,login:Q8,logout:rF,logoutFromServer:nF,processOAuthCallback:eF,processSocialLogin:tF,refreshToken:yi,signup:J8,startSocialLogin:$8,updateUserProfile:iF},Symbol.toStringTag,{value:"Module"})),Y4=u=>{let h;const f=new Set,g=(M,U)=>{const B=typeof M=="function"?M(h):M;if(!Object.is(B,h)){const Y=h;h=U??(typeof B!="object"||B===null)?B:Object.assign({},h,B),f.forEach(H=>H(h,Y))}},S=()=>h,P={setState:g,getState:S,getInitialState:()=>k,subscribe:M=>(f.add(M),()=>f.delete(M))},k=h=u(g,S,P);return P},ate=u=>u?Y4(u):Y4,cte=u=>u;function lte(u,h=cte){const f=st.useSyncExternalStore(u.subscribe,st.useCallback(()=>h(u.getState()),[u,h]),st.useCallback(()=>h(u.getInitialState()),[u,h]));return st.useDebugValue(f),f}const q4=u=>{const h=ate(u),f=g=>lte(h,g);return Object.assign(f,h),f},oF=u=>u?q4(u):q4,X4={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"27a8d306ea82463f81a2fbc033c7570c",VITE_API_BASE_URL:"http://localhost:8080/api",VITE_API_BASE_URL_MOBILE:"https://silverld.site/api",VITE_API_BASE_URL_WEB:"http://localhost:8080/api",VITE_CAPACITOR_NAVIGATION_DOMAINS:"https://silverld.site/*,https://kauth.kakao.com/*,https://accounts.google.com/*,https://nid.naver.com/*,http://localhost:8080/*,http://127.0.0.1:8080/*",VITE_DOMAIN_MOBILE:"https://silverld.site",VITE_DOMAIN_WEB:"http://localhost:8080",VITE_KAKAO_NATIVE_APP_KEY:"aa1e70c80567cbfe9b5dfa111ca97ab5",VITE_OAUTH_CALLBACK_MOBILE:"https://silverld.site/oauth/callback?mobile=true",VITE_OAUTH_CALLBACK_WEB:"http://localhost:8080/oauth/callback",VITE_PUBLIC_BUILDER_KEY:"__BUILDER_PUBLIC_KEY__",VITE_WS_BASE_URL:"http://localhost:8080/ws",VITE_WS_BASE_URL_MOBILE:"https://silverld.site/ws",VITE_WS_BASE_URL_WEB:"http://localhost:8080/ws"},kE=new Map,ZT=u=>{const h=kE.get(u);return h?Object.fromEntries(Object.entries(h.stores).map(([f,g])=>[f,g.getState()])):{}},dte=(u,h,f)=>{if(u===void 0)return{type:"untracked",connection:h.connect(f)};const g=kE.get(f.name);if(g)return{type:"tracked",store:u,...g};const S={connection:h.connect(f),stores:{}};return kE.set(f.name,S),{type:"tracked",store:u,...S}},ute=(u,h)=>{if(h===void 0)return;const f=kE.get(u);f&&(delete f.stores[h],Object.keys(f.stores).length===0&&kE.delete(u))},hte=u=>{var h,f;if(!u)return;const g=u.split(`
`),S=g.findIndex(w=>w.includes("api.setState"));if(S<0)return;const C=((h=g[S+1])==null?void 0:h.trim())||"";return(f=/.+ (.+) .+/.exec(C))==null?void 0:f[1]},pte=(u,h={})=>(f,g,S)=>{const{enabled:C,anonymousActionType:w,store:P,...k}=h;let M;try{M=(C??(X4?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!M)return u(f,g,S);const{connection:U,...B}=dte(P,M,k);let Y=!0;S.setState=(X,te,ce)=>{const Z=f(X,te);if(!Y)return Z;const le=ce===void 0?{type:w||hte(new Error().stack)||"anonymous"}:typeof ce=="string"?{type:ce}:ce;return P===void 0?(U?.send(le,g()),Z):(U?.send({...le,type:`${P}/${le.type}`},{...ZT(k.name),[P]:S.getState()}),Z)},S.devtools={cleanup:()=>{U&&typeof U.unsubscribe=="function"&&U.unsubscribe(),ute(k.name,P)}};const H=(...X)=>{const te=Y;Y=!1,f(...X),Y=te},ie=u(S.setState,g,S);if(B.type==="untracked"?U?.init(ie):(B.stores[B.store]=S,U?.init(Object.fromEntries(Object.entries(B.stores).map(([X,te])=>[X,X===B.store?ie:te.getState()])))),S.dispatchFromDevtools&&typeof S.dispatch=="function"){let X=!1;const te=S.dispatch;S.dispatch=(...ce)=>{(X4?"production":void 0)!=="production"&&ce[0].type==="__setState"&&!X&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),X=!0),te(...ce)}}return U.subscribe(X=>{var te;switch(X.type){case"ACTION":if(typeof X.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return n1(X.payload,ce=>{if(ce.type==="__setState"){if(P===void 0){H(ce.state);return}Object.keys(ce.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const Z=ce.state[P];if(Z==null)return;JSON.stringify(S.getState())!==JSON.stringify(Z)&&H(Z);return}S.dispatchFromDevtools&&typeof S.dispatch=="function"&&S.dispatch(ce)});case"DISPATCH":switch(X.payload.type){case"RESET":return H(ie),P===void 0?U?.init(S.getState()):U?.init(ZT(k.name));case"COMMIT":if(P===void 0){U?.init(S.getState());return}return U?.init(ZT(k.name));case"ROLLBACK":return n1(X.state,ce=>{if(P===void 0){H(ce),U?.init(S.getState());return}H(ce[P]),U?.init(ZT(k.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return n1(X.state,ce=>{if(P===void 0){H(ce);return}JSON.stringify(S.getState())!==JSON.stringify(ce[P])&&H(ce[P])});case"IMPORT_STATE":{const{nextLiftedState:ce}=X.payload,Z=(te=ce.computedStates.slice(-1)[0])==null?void 0:te.state;if(!Z)return;H(P===void 0?Z:Z[P]),U?.send(null,ce);return}case"PAUSE_RECORDING":return Y=!Y}return}}),ie},fte=pte,n1=(u,h)=>{let f;try{f=JSON.parse(u)}catch(g){console.error("[zustand devtools middleware] Could not parse the received json",g)}f!==void 0&&h(f)};function mte(u,h){let f;try{f=u()}catch{return}return{getItem:S=>{var C;const w=k=>k===null?null:JSON.parse(k,void 0),P=(C=f.getItem(S))!=null?C:null;return P instanceof Promise?P.then(w):w(P)},setItem:(S,C)=>f.setItem(S,JSON.stringify(C,void 0)),removeItem:S=>f.removeItem(S)}}const TA=u=>h=>{try{const f=u(h);return f instanceof Promise?f:{then(g){return TA(g)(f)},catch(g){return this}}}catch(f){return{then(g){return this},catch(g){return TA(g)(f)}}}},_te=(u,h)=>(f,g,S)=>{let C={storage:mte(()=>localStorage),partialize:X=>X,version:0,merge:(X,te)=>({...te,...X}),...h},w=!1;const P=new Set,k=new Set;let M=C.storage;if(!M)return u((...X)=>{console.warn(`[zustand persist middleware] Unable to update item '${C.name}', the given storage is currently unavailable.`),f(...X)},g,S);const U=()=>{const X=C.partialize({...g()});return M.setItem(C.name,{state:X,version:C.version})},B=S.setState;S.setState=(X,te)=>(B(X,te),U());const Y=u((...X)=>(f(...X),U()),g,S);S.getInitialState=()=>Y;let H;const ie=()=>{var X,te;if(!M)return;w=!1,P.forEach(Z=>{var le;return Z((le=g())!=null?le:Y)});const ce=((te=C.onRehydrateStorage)==null?void 0:te.call(C,(X=g())!=null?X:Y))||void 0;return TA(M.getItem.bind(M))(C.name).then(Z=>{if(Z)if(typeof Z.version=="number"&&Z.version!==C.version){if(C.migrate){const le=C.migrate(Z.state,Z.version);return le instanceof Promise?le.then(ne=>[!0,ne]):[!0,le]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,Z.state];return[!1,void 0]}).then(Z=>{var le;const[ne,de]=Z;if(H=C.merge(de,(le=g())!=null?le:Y),f(H,!0),ne)return U()}).then(()=>{ce?.(H,void 0),H=g(),w=!0,k.forEach(Z=>Z(H))}).catch(Z=>{ce?.(void 0,Z)})};return S.persist={setOptions:X=>{C={...C,...X},X.storage&&(M=X.storage)},clearStorage:()=>{M?.removeItem(C.name)},getOptions:()=>C,rehydrate:()=>ie(),hasHydrated:()=>w,onHydrate:X=>(P.add(X),()=>{P.delete(X)}),onFinishHydration:X=>(k.add(X),()=>{k.delete(X)})},C.skipHydration||ie(),H||Y},gte=_te,Ete="http://localhost:8080/api".replace(/\/$/,""),Qn=u=>{const h={"Content-Type":"application/json"};return u&&(h.Authorization=`Bearer ${u}`),h},co=async u=>{if(!u.ok){tt.error(` API  : ${u.status} ${u.statusText}`);const h=await u.json().catch(f=>(tt.error(" JSON  :",f),{message:"    ."}));throw tt.error("   :",h),new Error(h.message||`HTTP ${u.status}: ${u.statusText}`)}return u.json()};class vte{baseUrl;token;constructor(h=Ete){this.baseUrl=h}setToken(h){this.token=h}clearToken(){this.token=void 0}async joinMatching(h){if(!this.token)throw new Error("  .");const f=`${this.baseUrl}/v1/calls/match`;try{let g=await fetch(f,{method:"POST",headers:Qn(this.token),body:JSON.stringify(h)});if(g.status===401){const C=await yi();if(C)this.token=C,g=await fetch(f,{method:"POST",headers:Qn(C),body:JSON.stringify(h)});else throw new Error(" .  .")}const S=await co(g);if(!S.data)throw new Error(S.message||"  .");return S.data}catch(g){throw console.error("  :",g),g instanceof Error?g:new Error("    .")}}async getMatchingStatus(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/status`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/status`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async cancelMatching(h){if(!this.token)throw new Error("  .");try{let f=await fetch(`${this.baseUrl}/v1/calls/match`,{method:"DELETE",headers:Qn(this.token),body:JSON.stringify({queue_id:h})});if(f.status===401){const g=await yi();if(g)this.token=g,f=await fetch(`${this.baseUrl}/v1/calls/match`,{method:"DELETE",headers:Qn(g),body:JSON.stringify({queue_id:h})});else throw new Error(" .  .")}}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async getActiveCategories(){try{let h=await fetch(`${this.baseUrl}/v1/categories/active`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/categories/active`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data.categories}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async getCategory(h){try{let f=await fetch(`${this.baseUrl}/v1/categories/${h}`,{method:"GET",headers:Qn(this.token)});if(f.status===401){const S=await yi();if(S)this.token=S,f=await fetch(`${this.baseUrl}/v1/categories/${h}`,{method:"GET",headers:Qn(S)});else throw new Error(" .  .")}const g=await co(f);if(!g.success||!g.data)throw new Error(g.message||"   .");return g.data}catch(f){throw console.error("   :",f),f instanceof Error?f:new Error("     .")}}async getQueuePosition(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/queue/position`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/queue/position`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async sendCallStatistics(h,f){if(!this.token)throw new Error("  .");try{const g=`${this.baseUrl}/v1/calls/${h}/statistics`;tt.apiRequest("POST",`/v1/calls/${h}/statistics`,f);let S=await fetch(g,{method:"POST",headers:Qn(this.token),credentials:"include",body:JSON.stringify(f)});if(S.status===401){const w=await yi();if(w)this.token=w,S=await fetch(g,{method:"POST",headers:Qn(w),credentials:"include",body:JSON.stringify(f)});else throw new Error(" .  .")}if(S.status===204||S.ok)return;const C=await co(S)}catch(g){tt.error("     ():",g)}}async renewRtcToken(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/renew-token`;tt.apiRequest("POST",`/v1/calls/${h}/renew-token`,{});let g=await fetch(f,{method:"POST",headers:Qn(this.token),credentials:"include"});if(g.status===401){const C=await yi();if(C)this.token=C,g=await fetch(f,{method:"POST",headers:Qn(C),credentials:"include"});else throw new Error(" .  .")}const S=await co(g);if(!S.data||!S.data.rtcToken)throw new Error(S.message||"RTC   .");return S.data}catch(f){throw tt.error("RTC   :",f),f instanceof Error?f:new Error("RTC   .")}}async getActivityStats(h){if(!this.token)throw new Error("  .");try{const f=h?`?period=${h}`:"",g=`${this.baseUrl}/v1/users/me/activity-stats${f}`;tt.apiRequest("GET",`/v1/users/me/activity-stats${f}`,{});let S=await fetch(g,{method:"GET",headers:Qn(this.token),credentials:"include"});if(S.status===401){const P=await yi();if(P)this.token=P,S=await fetch(g,{method:"GET",headers:Qn(P),credentials:"include"});else throw new Error(" .  .")}const C=await co(S);return{weeklyStats:{callCount:C.data.weekly_stats.call_count,totalDurationMinutes:C.data.weekly_stats.total_duration_minutes,startDate:C.data.weekly_stats.start_date,endDate:C.data.weekly_stats.end_date},quarterlyStats:{callCount:C.data.quarterly_stats.call_count,totalDurationMinutes:C.data.quarterly_stats.total_duration_minutes,startDate:C.data.quarterly_stats.start_date,endDate:C.data.quarterly_stats.end_date,quarter:C.data.quarterly_stats.quarter},additionalStats:{averageCallDurationMinutes:C.data.additional_stats.average_call_duration_minutes,mostUsedCategory:C.data.additional_stats.most_used_category,totalDataUsageMb:C.data.additional_stats.total_data_usage_mb,averageNetworkQuality:C.data.additional_stats.average_network_quality}}}catch(f){throw tt.error("   :",f),f instanceof Error?f:new Error("   .")}}async getCallHistory(h){if(!this.token)throw new Error("  .");try{const f=new URLSearchParams;h?.page&&f.append("page",String(h.page)),h?.limit&&f.append("limit",String(h.limit)),h?.period&&f.append("period",h.period);const g=f.toString(),S=`${this.baseUrl}/v1/users/me/call-history${g?`?${g}`:""}`;tt.apiRequest("GET",`/v1/users/me/call-history?${g}`,{});let C=await fetch(S,{method:"GET",headers:Qn(this.token),credentials:"include"});if(C.status===401){const k=await yi();if(k)this.token=k,C=await fetch(S,{method:"GET",headers:Qn(k),credentials:"include"});else throw new Error(" .  .")}const w=await co(C);return{calls:w.data.calls.map(k=>({callId:k.call_id,partnerId:k.partner_id,partnerNickname:k.partner_nickname,categoryId:k.category_id,categoryName:k.category_name,startedAt:k.started_at,endedAt:k.ended_at,durationMinutes:k.duration_minutes,averageNetworkQuality:k.average_network_quality,totalDataUsageMB:k.total_data_usage_mb})),pagination:{currentPage:w.data.pagination.current_page,totalPages:w.data.pagination.total_pages,totalCount:w.data.pagination.total_count,hasNext:w.data.pagination.has_next}}}catch(f){throw tt.error("   :",f),f instanceof Error?f:new Error("   .")}}async getMatchingStats(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/stats`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/stats`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async leaveChannel(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/channel/leave`;tt.apiRequest("POST",`/v1/calls/${h}/channel/leave`);let g=await fetch(f,{method:"POST",headers:Qn(this.token)});if(g.status===401){const S=await yi();if(S)this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S)});else throw new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async endCall(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/end`;tt.apiRequest("POST",`/v1/calls/${h}/end`);let g=await fetch(f,{method:"POST",headers:Qn(this.token)});if(g.status===401){const S=await yi();if(S)this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S)});else throw new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async submitEvaluation(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/evaluations`;tt.apiRequest("POST","/v1/evaluations",h);let g=await fetch(f,{method:"POST",headers:Qn(this.token),body:JSON.stringify(h)});if(console.log(`   API    : ${g.status}`),g.status===401){console.log("   401  ,    ...");const S=await yi();if(S)console.log("   ,    ..."),this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S),body:JSON.stringify(h)}),console.log(`     : ${g.status}`);else throw console.error("   "),new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}}let r1=null;const UE=()=>(r1||(r1=new vte),r1),Gd=UE();var i1={exports:{}},$T={},J4;function Ste(){return J4||(J4=1,globalThis.crypto&&globalThis.crypto.getRandomValues?$T.randomBytes=function(u){var h=new Uint8Array(u);return globalThis.crypto.getRandomValues(h),h}:$T.randomBytes=function(u){for(var h=new Array(u),f=0;f<u;f++)h[f]=Math.floor(Math.random()*256);return h}),$T}var s1,Q4;function pm(){if(Q4)return s1;Q4=1;var u=Ste(),h="abcdefghijklmnopqrstuvwxyz012345";return s1={string:function(f){for(var g=h.length,S=u.randomBytes(f),C=[],w=0;w<f;w++)C.push(h.substr(S[w]%g,1));return C.join("")},number:function(f){return Math.floor(Math.random()*f)},numberString:function(f){var g=(""+(f-1)).length,S=new Array(g+1).join("0");return(S+this.number(f)).slice(-g)}},s1}var Z4;function Zd(){return Z4||(Z4=1,function(u){var h=pm(),f={},g=!1,S=globalThis.chrome&&globalThis.chrome.app&&globalThis.chrome.app.runtime;u.exports={attachEvent:function(w,P){typeof globalThis.addEventListener<"u"?globalThis.addEventListener(w,P,!1):globalThis.document&&globalThis.attachEvent&&(globalThis.document.attachEvent("on"+w,P),globalThis.attachEvent("on"+w,P))},detachEvent:function(w,P){typeof globalThis.addEventListener<"u"?globalThis.removeEventListener(w,P,!1):globalThis.document&&globalThis.detachEvent&&(globalThis.document.detachEvent("on"+w,P),globalThis.detachEvent("on"+w,P))},unloadAdd:function(w){if(S)return null;var P=h.string(8);return f[P]=w,g&&setTimeout(this.triggerUnloadCallbacks,0),P},unloadDel:function(w){w in f&&delete f[w]},triggerUnloadCallbacks:function(){for(var w in f)f[w](),delete f[w]}};var C=function(){g||(g=!0,u.exports.triggerUnloadCallbacks())};S||u.exports.attachEvent("unload",C)}(i1)),i1.exports}var o1,$4;function yte(){return $4||($4=1,o1=function(h,f){if(f=f.split(":")[0],h=+h,!h)return!1;switch(f){case"http":case"ws":return h!==80;case"https":case"wss":return h!==443;case"ftp":return h!==21;case"gopher":return h!==70;case"file":return!1}return h!==0}),o1}var e0={},e3;function Tte(){if(e3)return e0;e3=1;var u=Object.prototype.hasOwnProperty,h;function f(w){try{return decodeURIComponent(w.replace(/\+/g," "))}catch{return null}}function g(w){try{return encodeURIComponent(w)}catch{return null}}function S(w){for(var P=/([^=?#&]+)=?([^&]*)/g,k={},M;M=P.exec(w);){var U=f(M[1]),B=f(M[2]);U===null||B===null||U in k||(k[U]=B)}return k}function C(w,P){P=P||"";var k=[],M,U;typeof P!="string"&&(P="?");for(U in w)if(u.call(w,U)){if(M=w[U],!M&&(M===null||M===h||isNaN(M))&&(M=""),U=g(U),M=g(M),U===null||M===null)continue;k.push(U+"="+M)}return k.length?P+k.join("&"):""}return e0.stringify=C,e0.parse=S,e0}var a1,t3;function aF(){if(t3)return a1;t3=1;var u=yte(),h=Tte(),f=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,g=/[\n\r\t]/g,S=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,C=/:\d+$/,w=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,P=/^[a-zA-Z]:/;function k(Z){return(Z||"").toString().replace(f,"")}var M=[["#","hash"],["?","query"],function(le,ne){return Y(ne.protocol)?le.replace(/\\/g,"/"):le},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],U={hash:1,query:1};function B(Z){var le;typeof window<"u"?le=window:typeof globalThis<"u"?le=globalThis:typeof self<"u"?le=self:le={};var ne=le.location||{};Z=Z||ne;var de={},Pe=typeof Z,ue;if(Z.protocol==="blob:")de=new X(unescape(Z.pathname),{});else if(Pe==="string"){de=new X(Z,{});for(ue in U)delete de[ue]}else if(Pe==="object"){for(ue in Z)ue in U||(de[ue]=Z[ue]);de.slashes===void 0&&(de.slashes=S.test(Z.href))}return de}function Y(Z){return Z==="file:"||Z==="ftp:"||Z==="http:"||Z==="https:"||Z==="ws:"||Z==="wss:"}function H(Z,le){Z=k(Z),Z=Z.replace(g,""),le=le||{};var ne=w.exec(Z),de=ne[1]?ne[1].toLowerCase():"",Pe=!!ne[2],ue=!!ne[3],he=0,ye;return Pe?ue?(ye=ne[2]+ne[3]+ne[4],he=ne[2].length+ne[3].length):(ye=ne[2]+ne[4],he=ne[2].length):ue?(ye=ne[3]+ne[4],he=ne[3].length):ye=ne[4],de==="file:"?he>=2&&(ye=ye.slice(2)):Y(de)?ye=ne[4]:de?Pe&&(ye=ye.slice(2)):he>=2&&Y(le.protocol)&&(ye=ne[4]),{protocol:de,slashes:Pe||Y(de),slashesCount:he,rest:ye}}function ie(Z,le){if(Z==="")return le;for(var ne=(le||"/").split("/").slice(0,-1).concat(Z.split("/")),de=ne.length,Pe=ne[de-1],ue=!1,he=0;de--;)ne[de]==="."?ne.splice(de,1):ne[de]===".."?(ne.splice(de,1),he++):he&&(de===0&&(ue=!0),ne.splice(de,1),he--);return ue&&ne.unshift(""),(Pe==="."||Pe==="..")&&ne.push(""),ne.join("/")}function X(Z,le,ne){if(Z=k(Z),Z=Z.replace(g,""),!(this instanceof X))return new X(Z,le,ne);var de,Pe,ue,he,ye,Ve,Je=M.slice(),Ue=typeof le,xe=this,Ge=0;for(Ue!=="object"&&Ue!=="string"&&(ne=le,le=null),ne&&typeof ne!="function"&&(ne=h.parse),le=B(le),Pe=H(Z||"",le),de=!Pe.protocol&&!Pe.slashes,xe.slashes=Pe.slashes||de&&le.slashes,xe.protocol=Pe.protocol||le.protocol||"",Z=Pe.rest,(Pe.protocol==="file:"&&(Pe.slashesCount!==2||P.test(Z))||!Pe.slashes&&(Pe.protocol||Pe.slashesCount<2||!Y(xe.protocol)))&&(Je[3]=[/(.*)/,"pathname"]);Ge<Je.length;Ge++){if(he=Je[Ge],typeof he=="function"){Z=he(Z,xe);continue}ue=he[0],Ve=he[1],ue!==ue?xe[Ve]=Z:typeof ue=="string"?(ye=ue==="@"?Z.lastIndexOf(ue):Z.indexOf(ue),~ye&&(typeof he[2]=="number"?(xe[Ve]=Z.slice(0,ye),Z=Z.slice(ye+he[2])):(xe[Ve]=Z.slice(ye),Z=Z.slice(0,ye)))):(ye=ue.exec(Z))&&(xe[Ve]=ye[1],Z=Z.slice(0,ye.index)),xe[Ve]=xe[Ve]||de&&he[3]&&le[Ve]||"",he[4]&&(xe[Ve]=xe[Ve].toLowerCase())}ne&&(xe.query=ne(xe.query)),de&&le.slashes&&xe.pathname.charAt(0)!=="/"&&(xe.pathname!==""||le.pathname!=="")&&(xe.pathname=ie(xe.pathname,le.pathname)),xe.pathname.charAt(0)!=="/"&&Y(xe.protocol)&&(xe.pathname="/"+xe.pathname),u(xe.port,xe.protocol)||(xe.host=xe.hostname,xe.port=""),xe.username=xe.password="",xe.auth&&(ye=xe.auth.indexOf(":"),~ye?(xe.username=xe.auth.slice(0,ye),xe.username=encodeURIComponent(decodeURIComponent(xe.username)),xe.password=xe.auth.slice(ye+1),xe.password=encodeURIComponent(decodeURIComponent(xe.password))):xe.username=encodeURIComponent(decodeURIComponent(xe.auth)),xe.auth=xe.password?xe.username+":"+xe.password:xe.username),xe.origin=xe.protocol!=="file:"&&Y(xe.protocol)&&xe.host?xe.protocol+"//"+xe.host:"null",xe.href=xe.toString()}function te(Z,le,ne){var de=this;switch(Z){case"query":typeof le=="string"&&le.length&&(le=(ne||h.parse)(le)),de[Z]=le;break;case"port":de[Z]=le,u(le,de.protocol)?le&&(de.host=de.hostname+":"+le):(de.host=de.hostname,de[Z]="");break;case"hostname":de[Z]=le,de.port&&(le+=":"+de.port),de.host=le;break;case"host":de[Z]=le,C.test(le)?(le=le.split(":"),de.port=le.pop(),de.hostname=le.join(":")):(de.hostname=le,de.port="");break;case"protocol":de.protocol=le.toLowerCase(),de.slashes=!ne;break;case"pathname":case"hash":if(le){var Pe=Z==="pathname"?"/":"#";de[Z]=le.charAt(0)!==Pe?Pe+le:le}else de[Z]=le;break;case"username":case"password":de[Z]=encodeURIComponent(le);break;case"auth":var ue=le.indexOf(":");~ue?(de.username=le.slice(0,ue),de.username=encodeURIComponent(decodeURIComponent(de.username)),de.password=le.slice(ue+1),de.password=encodeURIComponent(decodeURIComponent(de.password))):de.username=encodeURIComponent(decodeURIComponent(le))}for(var he=0;he<M.length;he++){var ye=M[he];ye[4]&&(de[ye[1]]=de[ye[1]].toLowerCase())}return de.auth=de.password?de.username+":"+de.password:de.username,de.origin=de.protocol!=="file:"&&Y(de.protocol)&&de.host?de.protocol+"//"+de.host:"null",de.href=de.toString(),de}function ce(Z){(!Z||typeof Z!="function")&&(Z=h.stringify);var le,ne=this,de=ne.host,Pe=ne.protocol;Pe&&Pe.charAt(Pe.length-1)!==":"&&(Pe+=":");var ue=Pe+(ne.protocol&&ne.slashes||Y(ne.protocol)?"//":"");return ne.username?(ue+=ne.username,ne.password&&(ue+=":"+ne.password),ue+="@"):ne.password?(ue+=":"+ne.password,ue+="@"):ne.protocol!=="file:"&&Y(ne.protocol)&&!de&&ne.pathname!=="/"&&(ue+="@"),(de[de.length-1]===":"||C.test(ne.hostname)&&!ne.port)&&(de+=":"),ue+=de+ne.pathname,le=typeof ne.query=="object"?Z(ne.query):ne.query,le&&(ue+=le.charAt(0)!=="?"?"?"+le:le),ne.hash&&(ue+=ne.hash),ue}return X.prototype={set:te,toString:ce},X.extractProtocol=H,X.location=B,X.trimLeft=k,X.qs=h,a1=X,a1}var c1,n3;function qo(){if(n3)return c1;n3=1;var u=aF();return c1={getOrigin:function(h){if(!h)return null;var f=new u(h);if(f.protocol==="file:")return null;var g=f.port;return g||(g=f.protocol==="https:"?"443":"80"),f.protocol+"//"+f.hostname+":"+g},isOriginEqual:function(h,f){var g=this.getOrigin(h)===this.getOrigin(f);return g},isSchemeEqual:function(h,f){return h.split(":")[0]===f.split(":")[0]},addPath:function(h,f){var g=h.split("?");return g[0]+f+(g[1]?"?"+g[1]:"")},addQuery:function(h,f){return h+(h.indexOf("?")===-1?"?"+f:"&"+f)},isLoopbackAddr:function(h){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(h)||/^\[::1\]$/.test(h)}},c1}var t0={exports:{}},r3;function Un(){return r3||(r3=1,typeof Object.create=="function"?t0.exports=function(h,f){f&&(h.super_=f,h.prototype=Object.create(f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}))}:t0.exports=function(h,f){if(f){h.super_=f;var g=function(){};g.prototype=f.prototype,h.prototype=new g,h.prototype.constructor=h}}),t0.exports}var l1={},d1,i3;function cF(){if(i3)return d1;i3=1;function u(){this._listeners={}}return u.prototype.addEventListener=function(h,f){h in this._listeners||(this._listeners[h]=[]);var g=this._listeners[h];g.indexOf(f)===-1&&(g=g.concat([f])),this._listeners[h]=g},u.prototype.removeEventListener=function(h,f){var g=this._listeners[h];if(g){var S=g.indexOf(f);if(S!==-1){g.length>1?this._listeners[h]=g.slice(0,S).concat(g.slice(S+1)):delete this._listeners[h];return}}},u.prototype.dispatchEvent=function(){var h=arguments[0],f=h.type,g=arguments.length===1?[h]:Array.apply(null,arguments);if(this["on"+f]&&this["on"+f].apply(this,g),f in this._listeners)for(var S=this._listeners[f],C=0;C<S.length;C++)S[C].apply(this,g)},d1=u,d1}var s3;function us(){if(s3)return l1;s3=1;var u=Un(),h=cF();function f(){h.call(this)}return u(f,h),f.prototype.removeAllListeners=function(g){g?delete this._listeners[g]:this._listeners={}},f.prototype.once=function(g,S){var C=this,w=!1;function P(){C.removeListener(g,P),w||(w=!0,S.apply(this,arguments))}this.on(g,P)},f.prototype.emit=function(){var g=arguments[0],S=this._listeners[g];if(S){for(var C=arguments.length,w=new Array(C-1),P=1;P<C;P++)w[P-1]=arguments[P];for(var k=0;k<S.length;k++)S[k].apply(this,w)}},f.prototype.on=f.prototype.addListener=h.prototype.addEventListener,f.prototype.removeListener=h.prototype.removeEventListener,l1.EventEmitter=f,l1}var n0={exports:{}},o3;function Cte(){if(o3)return n0.exports;o3=1;var u=globalThis.WebSocket||globalThis.MozWebSocket;return u?n0.exports=function(f){return new u(f)}:n0.exports=void 0,n0.exports}var u1,a3;function Rte(){if(a3)return u1;a3=1;var u=Zd(),h=qo(),f=Un(),g=us().EventEmitter,S=Cte(),C=function(){};function w(P,k,M){if(!w.enabled())throw new Error("Transport created when disabled");g.call(this);var U=this,B=h.addPath(P,"/websocket");B.slice(0,5)==="https"?B="wss"+B.slice(5):B="ws"+B.slice(4),this.url=B,this.ws=new S(this.url,[],M),this.ws.onmessage=function(Y){C("message event",Y.data),U.emit("message",Y.data)},this.unloadRef=u.unloadAdd(function(){U.ws.close()}),this.ws.onclose=function(Y){C("close event",Y.code,Y.reason),U.emit("close",Y.code,Y.reason),U._cleanup()},this.ws.onerror=function(Y){U.emit("close",1006,"WebSocket connection broken"),U._cleanup()}}return f(w,g),w.prototype.send=function(P){var k="["+P+"]";this.ws.send(k)},w.prototype.close=function(){var P=this.ws;this._cleanup(),P&&P.close()},w.prototype._cleanup=function(){var P=this.ws;P&&(P.onmessage=P.onclose=P.onerror=null),u.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},w.enabled=function(){return!!S},w.transportName="websocket",w.roundTrips=2,u1=w,u1}var h1,c3;function wte(){if(c3)return h1;c3=1;var u=Un(),h=us().EventEmitter,f=function(){};function g(S,C){h.call(this),this.sendBuffer=[],this.sender=C,this.url=S}return u(g,h),g.prototype.send=function(S){this.sendBuffer.push(S),this.sendStop||this.sendSchedule()},g.prototype.sendScheduleWait=function(){var S=this,C;this.sendStop=function(){S.sendStop=null,clearTimeout(C)},C=setTimeout(function(){S.sendStop=null,S.sendSchedule()},25)},g.prototype.sendSchedule=function(){f("sendSchedule",this.sendBuffer.length);var S=this;if(this.sendBuffer.length>0){var C="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,C,function(w){S.sendStop=null,w?(S.emit("close",w.code||1006,"Sending error: "+w),S.close()):S.sendScheduleWait()}),this.sendBuffer=[]}},g.prototype._cleanup=function(){this.removeAllListeners()},g.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},h1=g,h1}var p1,l3;function bte(){if(l3)return p1;l3=1;var u=Un(),h=us().EventEmitter,f=function(){};function g(S,C,w){h.call(this),this.Receiver=S,this.receiveUrl=C,this.AjaxObject=w,this._scheduleReceiver()}return u(g,h),g.prototype._scheduleReceiver=function(){var S=this,C=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);C.on("message",function(w){S.emit("message",w)}),C.once("close",function(w,P){f("close",w,P,S.pollIsClosing),S.poll=C=null,S.pollIsClosing||(P==="network"?S._scheduleReceiver():(S.emit("close",w||1006,P),S.removeAllListeners()))})},g.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},p1=g,p1}var f1,d3;function lF(){if(d3)return f1;d3=1;var u=Un(),h=qo(),f=wte(),g=bte();function S(C,w,P,k,M){var U=h.addPath(C,w),B=this;f.call(this,C,P),this.poll=new g(k,U,M),this.poll.on("message",function(Y){B.emit("message",Y)}),this.poll.once("close",function(Y,H){B.poll=null,B.emit("close",Y,H),B.close()})}return u(S,f),S.prototype.close=function(){f.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},f1=S,f1}var m1,u3;function fm(){if(u3)return m1;u3=1;var u=Un(),h=qo(),f=lF();function g(C){return function(w,P,k){var M={};typeof P=="string"&&(M.headers={"Content-type":"text/plain"});var U=h.addPath(w,"/xhr_send"),B=new C("POST",U,P,M);return B.once("finish",function(Y){if(B=null,Y!==200&&Y!==204)return k(new Error("http status "+Y));k()}),function(){B.close(),B=null;var Y=new Error("Aborted");Y.code=1e3,k(Y)}}}function S(C,w,P,k){f.call(this,C,w,g(k),P,k)}return u(S,f),m1=S,m1}var _1,h3;function L0(){if(h3)return _1;h3=1;var u=Un(),h=us().EventEmitter;function f(g,S){h.call(this);var C=this;this.bufferPosition=0,this.xo=new S("POST",g,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(w,P){C._chunkHandler(w,P),C.xo=null;var k=w===200?"network":"permanent";C.emit("close",null,k),C._cleanup()})}return u(f,h),f.prototype._chunkHandler=function(g,S){if(!(g!==200||!S))for(var C=-1;;this.bufferPosition+=C+1){var w=S.slice(this.bufferPosition);if(C=w.indexOf(`
`),C===-1)break;var P=w.slice(0,C);P&&this.emit("message",P)}},f.prototype._cleanup=function(){this.removeAllListeners()},f.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},_1=f,_1}var g1,p3;function dF(){if(p3)return g1;p3=1;var u=us().EventEmitter,h=Un(),f=Zd(),g=qo(),S=globalThis.XMLHttpRequest,C=function(){};function w(M,U,B,Y){var H=this;u.call(this),setTimeout(function(){H._start(M,U,B,Y)},0)}h(w,u),w.prototype._start=function(M,U,B,Y){var H=this;try{this.xhr=new S}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}U=g.addQuery(U,"t="+ +new Date),this.unloadRef=f.unloadAdd(function(){H._cleanup(!0)});try{this.xhr.open(M,U,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){C("xhr timeout"),H.emit("finish",0,""),H._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!Y||!Y.noCredentials)&&w.supportsCORS&&(this.xhr.withCredentials=!0),Y&&Y.headers)for(var ie in Y.headers)this.xhr.setRequestHeader(ie,Y.headers[ie]);this.xhr.onreadystatechange=function(){if(H.xhr){var X=H.xhr,te,ce;switch(C("readyState",X.readyState),X.readyState){case 3:try{ce=X.status,te=X.responseText}catch{}ce===1223&&(ce=204),ce===200&&te&&te.length>0&&H.emit("chunk",ce,te);break;case 4:ce=X.status,ce===1223&&(ce=204),(ce===12005||ce===12029)&&(ce=0),C("finish",ce,X.responseText),H.emit("finish",ce,X.responseText),H._cleanup(!1);break}}};try{H.xhr.send(B)}catch{H.emit("finish",0,""),H._cleanup(!1)}},w.prototype._cleanup=function(M){if(this.xhr){if(this.removeAllListeners(),f.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),M)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},w.prototype.close=function(){this._cleanup(!0)},w.enabled=!!S;var P=["Active"].concat("Object").join("X");!w.enabled&&P in globalThis&&(S=function(){try{return new globalThis[P]("Microsoft.XMLHTTP")}catch{return null}},w.enabled=!!new S);var k=!1;try{k="withCredentials"in new S}catch{}return w.supportsCORS=k,g1=w,g1}var E1,f3;function x0(){if(f3)return E1;f3=1;var u=Un(),h=dF();function f(g,S,C,w){h.call(this,g,S,C,w)}return u(f,h),f.enabled=h.enabled&&h.supportsCORS,E1=f,E1}var v1,m3;function VE(){if(m3)return v1;m3=1;var u=Un(),h=dF();function f(g,S,C){h.call(this,g,S,C,{noCredentials:!0})}return u(f,h),f.enabled=h.enabled,v1=f,v1}var S1,_3;function jE(){return _3||(_3=1,S1={isOpera:function(){return globalThis.navigator&&/opera/i.test(globalThis.navigator.userAgent)},isKonqueror:function(){return globalThis.navigator&&/konqueror/i.test(globalThis.navigator.userAgent)},hasDomain:function(){if(!globalThis.document)return!0;try{return!!globalThis.document.domain}catch{return!1}}}),S1}var y1,g3;function Ite(){if(g3)return y1;g3=1;var u=Un(),h=fm(),f=L0(),g=x0(),S=VE(),C=jE();function w(P){if(!S.enabled&&!g.enabled)throw new Error("Transport created when disabled");h.call(this,P,"/xhr_streaming",f,g)}return u(w,h),w.enabled=function(P){return P.nullOrigin||C.isOpera()?!1:g.enabled},w.transportName="xhr-streaming",w.roundTrips=2,w.needBody=!!globalThis.document,y1=w,y1}var T1,E3;function qA(){if(E3)return T1;E3=1;var u=us().EventEmitter,h=Un(),f=Zd(),g=jE(),S=qo(),C=function(){};function w(P,k,M){var U=this;u.call(this),setTimeout(function(){U._start(P,k,M)},0)}return h(w,u),w.prototype._start=function(P,k,M){var U=this,B=new globalThis.XDomainRequest;k=S.addQuery(k,"t="+ +new Date),B.onerror=function(){U._error()},B.ontimeout=function(){U._error()},B.onprogress=function(){C("progress",B.responseText),U.emit("chunk",200,B.responseText)},B.onload=function(){U.emit("finish",200,B.responseText),U._cleanup(!1)},this.xdr=B,this.unloadRef=f.unloadAdd(function(){U._cleanup(!0)});try{this.xdr.open(P,k),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(M)}catch{this._error()}},w.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},w.prototype._cleanup=function(P){if(this.xdr){if(this.removeAllListeners(),f.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,P)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},w.prototype.close=function(){this._cleanup(!0)},w.enabled=!!(globalThis.XDomainRequest&&g.hasDomain()),T1=w,T1}var C1,v3;function uF(){if(v3)return C1;v3=1;var u=Un(),h=fm(),f=L0(),g=qA();function S(C){if(!g.enabled)throw new Error("Transport created when disabled");h.call(this,C,"/xhr_streaming",f,g)}return u(S,h),S.enabled=function(C){return C.cookie_needed||C.nullOrigin?!1:g.enabled&&C.sameScheme},S.transportName="xdr-streaming",S.roundTrips=2,C1=S,C1}var R1,S3;function hF(){return S3||(S3=1,R1=globalThis.EventSource),R1}var w1,y3;function Ate(){if(y3)return w1;y3=1;var u=Un(),h=us().EventEmitter,f=hF(),g=function(){};function S(C){h.call(this);var w=this,P=this.es=new f(C);P.onmessage=function(k){g("message",k.data),w.emit("message",decodeURI(k.data))},P.onerror=function(k){g("error",P.readyState);var M=P.readyState!==2?"network":"permanent";w._cleanup(),w._close(M)}}return u(S,h),S.prototype.abort=function(){this._cleanup(),this._close("user")},S.prototype._cleanup=function(){var C=this.es;C&&(C.onmessage=C.onerror=null,C.close(),this.es=null)},S.prototype._close=function(C){var w=this;setTimeout(function(){w.emit("close",null,C),w.removeAllListeners()},200)},w1=S,w1}var b1,T3;function C3(){if(T3)return b1;T3=1;var u=Un(),h=fm(),f=Ate(),g=x0(),S=hF();function C(w){if(!C.enabled())throw new Error("Transport created when disabled");h.call(this,w,"/eventsource",f,g)}return u(C,h),C.enabled=function(){return!!S},C.transportName="eventsource",C.roundTrips=2,b1=C,b1}var I1,R3;function pF(){return R3||(R3=1,I1="1.6.1"),I1}var A1={exports:{}},w3;function FE(){return w3||(w3=1,function(u){var h=Zd(),f=jE();u.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){u.exports.WPrefix in globalThis||(globalThis[u.exports.WPrefix]={})},postMessage:function(g,S){globalThis.parent!==globalThis&&globalThis.parent.postMessage(JSON.stringify({windowId:u.exports.currentWindowId,type:g,data:S||""}),"*")},createIframe:function(g,S){var C=globalThis.document.createElement("iframe"),w,P,k=function(){clearTimeout(w);try{C.onload=null}catch{}C.onerror=null},M=function(){C&&(k(),setTimeout(function(){C&&C.parentNode.removeChild(C),C=null},0),h.unloadDel(P))},U=function(Y){C&&(M(),S(Y))},B=function(Y,H){setTimeout(function(){try{C&&C.contentWindow&&C.contentWindow.postMessage(Y,H)}catch{}},0)};return C.src=g,C.style.display="none",C.style.position="absolute",C.onerror=function(){U("onerror")},C.onload=function(){clearTimeout(w),w=setTimeout(function(){U("onload timeout")},2e3)},globalThis.document.body.appendChild(C),w=setTimeout(function(){U("timeout")},15e3),P=h.unloadAdd(M),{post:B,cleanup:M,loaded:k}},createHtmlfile:function(g,S){var C=["Active"].concat("Object").join("X"),w=new globalThis[C]("htmlfile"),P,k,M,U=function(){clearTimeout(P),M.onerror=null},B=function(){w&&(U(),h.unloadDel(k),M.parentNode.removeChild(M),M=w=null,CollectGarbage())},Y=function(X){w&&(B(),S(X))},H=function(X,te){try{setTimeout(function(){M&&M.contentWindow&&M.contentWindow.postMessage(X,te)},0)}catch{}};w.open(),w.write('<html><script>document.domain="'+globalThis.document.domain+'";<\/script></html>'),w.close(),w.parentWindow[u.exports.WPrefix]=globalThis[u.exports.WPrefix];var ie=w.createElement("div");return w.body.appendChild(ie),M=w.createElement("iframe"),ie.appendChild(M),M.src=g,M.onerror=function(){Y("onerror")},P=setTimeout(function(){Y("timeout")},15e3),k=h.unloadAdd(B),{post:H,cleanup:B,loaded:U}}},u.exports.iframeEnabled=!1,globalThis.document&&(u.exports.iframeEnabled=(typeof globalThis.postMessage=="function"||typeof globalThis.postMessage=="object")&&!f.isKonqueror())}(A1)),A1.exports}var O1,b3;function fF(){if(b3)return O1;b3=1;var u=Un(),h=us().EventEmitter,f=pF(),g=qo(),S=FE(),C=Zd(),w=pm(),P=function(){};function k(M,U,B){if(!k.enabled())throw new Error("Transport created when disabled");h.call(this);var Y=this;this.origin=g.getOrigin(B),this.baseUrl=B,this.transUrl=U,this.transport=M,this.windowId=w.string(8);var H=g.addPath(B,"/iframe.html")+"#"+this.windowId;this.iframeObj=S.createIframe(H,function(ie){Y.emit("close",1006,"Unable to load an iframe ("+ie+")"),Y.close()}),this.onmessageCallback=this._message.bind(this),C.attachEvent("message",this.onmessageCallback)}return u(k,h),k.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){C.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},k.prototype._message=function(M){if(P("message",M.data),!g.isOriginEqual(M.origin,this.origin)){P("not same origin",M.origin,this.origin);return}var U;try{U=JSON.parse(M.data)}catch{P("bad json",M.data);return}if(U.windowId!==this.windowId){P("mismatched window id",U.windowId,this.windowId);return}switch(U.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([f,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",U.data);break;case"c":var B;try{B=JSON.parse(U.data)}catch{P("bad json",U.data);return}this.emit("close",B[0],B[1]),this.close();break}},k.prototype.postMessage=function(M,U){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:M,data:U||""}),this.origin)},k.prototype.send=function(M){this.postMessage("m",M)},k.enabled=function(){return S.iframeEnabled},k.transportName="iframe",k.roundTrips=2,O1=k,O1}var N1,I3;function XA(){return I3||(I3=1,N1={isObject:function(u){var h=typeof u;return h==="function"||h==="object"&&!!u},extend:function(u){if(!this.isObject(u))return u;for(var h,f,g=1,S=arguments.length;g<S;g++){h=arguments[g];for(f in h)Object.prototype.hasOwnProperty.call(h,f)&&(u[f]=h[f])}return u}}),N1}var P1,A3;function D1(){if(A3)return P1;A3=1;var u=Un(),h=fF(),f=XA();return P1=function(g){function S(C,w){h.call(this,g.transportName,C,w)}return u(S,h),S.enabled=function(C,w){if(!globalThis.document)return!1;var P=f.extend({},w);return P.sameOrigin=!0,g.enabled(P)&&h.enabled()},S.transportName="iframe-"+g.transportName,S.needBody=!0,S.roundTrips=h.roundTrips+g.roundTrips-1,S.facadeTransport=g,S},P1}var k1,O3;function Ote(){if(O3)return k1;O3=1;var u=Un(),h=FE(),f=qo(),g=us().EventEmitter,S=pm(),C=function(){};function w(k){g.call(this);var M=this;h.polluteGlobalNamespace(),this.id="a"+S.string(6),k=f.addQuery(k,"c="+decodeURIComponent(h.WPrefix+"."+this.id)),C("using htmlfile",w.htmlfileEnabled);var U=w.htmlfileEnabled?h.createHtmlfile:h.createIframe;globalThis[h.WPrefix][this.id]={start:function(){M.iframeObj.loaded()},message:function(B){M.emit("message",B)},stop:function(){M._cleanup(),M._close("network")}},this.iframeObj=U(k,function(){M._cleanup(),M._close("permanent")})}u(w,g),w.prototype.abort=function(){this._cleanup(),this._close("user")},w.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete globalThis[h.WPrefix][this.id]},w.prototype._close=function(k){this.emit("close",null,k),this.removeAllListeners()},w.htmlfileEnabled=!1;var P=["Active"].concat("Object").join("X");if(P in globalThis)try{w.htmlfileEnabled=!!new globalThis[P]("htmlfile")}catch{}return w.enabled=w.htmlfileEnabled||h.iframeEnabled,k1=w,k1}var L1,N3;function P3(){if(N3)return L1;N3=1;var u=Un(),h=Ote(),f=VE(),g=fm();function S(C){if(!h.enabled)throw new Error("Transport created when disabled");g.call(this,C,"/htmlfile",h,f)}return u(S,g),S.enabled=function(C){return h.enabled&&C.sameOrigin},S.transportName="htmlfile",S.roundTrips=2,L1=S,L1}var x1,D3;function k3(){if(D3)return x1;D3=1;var u=Un(),h=fm(),f=L0(),g=x0(),S=VE();function C(w){if(!S.enabled&&!g.enabled)throw new Error("Transport created when disabled");h.call(this,w,"/xhr",f,g)}return u(C,h),C.enabled=function(w){return w.nullOrigin?!1:S.enabled&&w.sameOrigin?!0:g.enabled},C.transportName="xhr-polling",C.roundTrips=2,x1=C,x1}var M1,L3;function Nte(){if(L3)return M1;L3=1;var u=Un(),h=fm(),f=uF(),g=L0(),S=qA();function C(w){if(!S.enabled)throw new Error("Transport created when disabled");h.call(this,w,"/xhr",g,S)}return u(C,h),C.enabled=f.enabled,C.transportName="xdr-polling",C.roundTrips=2,M1=C,M1}var U1,x3;function Pte(){if(x3)return U1;x3=1;var u=FE(),h=pm(),f=jE(),g=qo(),S=Un(),C=us().EventEmitter,w=function(){};function P(k){var M=this;C.call(this),u.polluteGlobalNamespace(),this.id="a"+h.string(6);var U=g.addQuery(k,"c="+encodeURIComponent(u.WPrefix+"."+this.id));globalThis[u.WPrefix][this.id]=this._callback.bind(this),this._createScript(U),this.timeoutId=setTimeout(function(){M._abort(new Error("JSONP script loaded abnormally (timeout)"))},P.timeout)}return S(P,C),P.prototype.abort=function(){if(globalThis[u.WPrefix][this.id]){var k=new Error("JSONP user aborted read");k.code=1e3,this._abort(k)}},P.timeout=35e3,P.scriptErrorTimeout=1e3,P.prototype._callback=function(k){this._cleanup(),!this.aborting&&(k&&this.emit("message",k),this.emit("close",null,"network"),this.removeAllListeners())},P.prototype._abort=function(k){this._cleanup(),this.aborting=!0,this.emit("close",k.code,k.message),this.removeAllListeners()},P.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var k=this.script;k.parentNode.removeChild(k),k.onreadystatechange=k.onerror=k.onload=k.onclick=null,this.script=null}delete globalThis[u.WPrefix][this.id]},P.prototype._scriptError=function(){var k=this;this.errorTimer||(this.errorTimer=setTimeout(function(){k.loadedOkay||k._abort(new Error("JSONP script loaded abnormally (onerror)"))},P.scriptErrorTimeout))},P.prototype._createScript=function(k){var M=this,U=this.script=globalThis.document.createElement("script"),B;if(U.id="a"+h.string(8),U.src=k,U.type="text/javascript",U.charset="UTF-8",U.onerror=this._scriptError.bind(this),U.onload=function(){M._abort(new Error("JSONP script loaded abnormally (onload)"))},U.onreadystatechange=function(){if(w("onreadystatechange",U.readyState),/loaded|closed/.test(U.readyState)){if(U&&U.htmlFor&&U.onclick){M.loadedOkay=!0;try{U.onclick()}catch{}}U&&M._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof U.async>"u"&&globalThis.document.attachEvent)if(f.isOpera())B=this.script2=globalThis.document.createElement("script"),B.text="try{var a = document.getElementById('"+U.id+"'); if(a)a.onerror();}catch(x){};",U.async=B.async=!1;else{try{U.htmlFor=U.id,U.event="onclick"}catch{}U.async=!0}typeof U.async<"u"&&(U.async=!0);var Y=globalThis.document.getElementsByTagName("head")[0];Y.insertBefore(U,Y.firstChild),B&&Y.insertBefore(B,Y.firstChild)},U1=P,U1}var V1,M3;function Dte(){if(M3)return V1;M3=1;var u=pm(),h=qo(),f=function(){},g,S;function C(P){try{return globalThis.document.createElement('<iframe name="'+P+'">')}catch{var k=globalThis.document.createElement("iframe");return k.name=P,k}}function w(){g=globalThis.document.createElement("form"),g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",S=globalThis.document.createElement("textarea"),S.name="d",g.appendChild(S),globalThis.document.body.appendChild(g)}return V1=function(P,k,M){g||w();var U="a"+u.string(8);g.target=U,g.action=h.addQuery(h.addPath(P,"/jsonp_send"),"i="+U);var B=C(U);B.id=U,B.style.display="none",g.appendChild(B);try{S.value=k}catch{}g.submit();var Y=function(H){B.onerror&&(B.onreadystatechange=B.onerror=B.onload=null,setTimeout(function(){B.parentNode.removeChild(B),B=null},500),S.value="",M(H))};return B.onerror=function(){Y()},B.onload=function(){Y()},B.onreadystatechange=function(H){f("onreadystatechange",U,B.readyState),B.readyState==="complete"&&Y()},function(){Y(new Error("Aborted"))}},V1}var j1,U3;function kte(){if(U3)return j1;U3=1;var u=Un(),h=lF(),f=Pte(),g=Dte();function S(C){if(!S.enabled())throw new Error("Transport created when disabled");h.call(this,C,"/jsonp",g,f)}return u(S,h),S.enabled=function(){return!!globalThis.document},S.transportName="jsonp-polling",S.roundTrips=1,S.needBody=!0,j1=S,j1}var F1,V3;function Lte(){return V3||(V3=1,F1=[Rte(),Ite(),uF(),C3(),D1()(C3()),P3(),D1()(P3()),k3(),Nte(),D1()(k3()),kte()]),F1}var j3={},F3;function xte(){if(F3)return j3;F3=1;var u=Array.prototype,h=Object.prototype,f=Function.prototype,g=String.prototype,S=u.slice,C=h.toString,w=function(ue){return h.toString.call(ue)==="[object Function]"},P=function(he){return C.call(he)==="[object Array]"},k=function(he){return C.call(he)==="[object String]"},M=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),U;M?U=function(ue,he,ye,Ve){!Ve&&he in ue||Object.defineProperty(ue,he,{configurable:!0,enumerable:!1,writable:!0,value:ye})}:U=function(ue,he,ye,Ve){!Ve&&he in ue||(ue[he]=ye)};var B=function(ue,he,ye){for(var Ve in he)h.hasOwnProperty.call(he,Ve)&&U(ue,Ve,he[Ve],ye)},Y=function(ue){if(ue==null)throw new TypeError("can't convert "+ue+" to object");return Object(ue)};function H(ue){var he=+ue;return he!==he?he=0:he!==0&&he!==1/0&&he!==-1/0&&(he=(he>0||-1)*Math.floor(Math.abs(he))),he}function ie(ue){return ue>>>0}function X(){}B(f,{bind:function(he){var ye=this;if(!w(ye))throw new TypeError("Function.prototype.bind called on incompatible "+ye);for(var Ve=S.call(arguments,1),Je=function(){if(this instanceof dt){var Xe=ye.apply(this,Ve.concat(S.call(arguments)));return Object(Xe)===Xe?Xe:this}else return ye.apply(he,Ve.concat(S.call(arguments)))},Ue=Math.max(0,ye.length-Ve.length),xe=[],Ge=0;Ge<Ue;Ge++)xe.push("$"+Ge);var dt=Function("binder","return function ("+xe.join(",")+"){ return binder.apply(this, arguments); }")(Je);return ye.prototype&&(X.prototype=ye.prototype,dt.prototype=new X,X.prototype=null),dt}}),B(Array,{isArray:P});var te=Object("a"),ce=te[0]!=="a"||!(0 in te),Z=function(he){var ye=!0,Ve=!0;return he&&(he.call("foo",function(Je,Ue,xe){typeof xe!="object"&&(ye=!1)}),he.call([1],function(){Ve=typeof this=="string"},"x")),!!he&&ye&&Ve};B(u,{forEach:function(he){var ye=Y(this),Ve=ce&&k(this)?this.split(""):ye,Je=arguments[1],Ue=-1,xe=Ve.length>>>0;if(!w(he))throw new TypeError;for(;++Ue<xe;)Ue in Ve&&he.call(Je,Ve[Ue],Ue,ye)}},!Z(u.forEach));var le=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;B(u,{indexOf:function(he){var ye=ce&&k(this)?this.split(""):Y(this),Ve=ye.length>>>0;if(!Ve)return-1;var Je=0;for(arguments.length>1&&(Je=H(arguments[1])),Je=Je>=0?Je:Math.max(0,Ve+Je);Je<Ve;Je++)if(Je in ye&&ye[Je]===he)return Je;return-1}},le);var ne=g.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var ue=/()??/.exec("")[1]===void 0;g.split=function(he,ye){var Ve=this;if(he===void 0&&ye===0)return[];if(C.call(he)!=="[object RegExp]")return ne.call(this,he,ye);var Je=[],Ue=(he.ignoreCase?"i":"")+(he.multiline?"m":"")+(he.extended?"x":"")+(he.sticky?"y":""),xe=0,Ge,dt,Xe,We;for(he=new RegExp(he.source,Ue+"g"),Ve+="",ue||(Ge=new RegExp("^"+he.source+"$(?!\\s)",Ue)),ye=ye===void 0?-1>>>0:ie(ye);(dt=he.exec(Ve))&&(Xe=dt.index+dt[0].length,!(Xe>xe&&(Je.push(Ve.slice(xe,dt.index)),!ue&&dt.length>1&&dt[0].replace(Ge,function(){for(var Ie=1;Ie<arguments.length-2;Ie++)arguments[Ie]===void 0&&(dt[Ie]=void 0)}),dt.length>1&&dt.index<Ve.length&&u.push.apply(Je,dt.slice(1)),We=dt[0].length,xe=Xe,Je.length>=ye)));)he.lastIndex===dt.index&&he.lastIndex++;return xe===Ve.length?(We||!he.test(""))&&Je.push(""):Je.push(Ve.slice(xe)),Je.length>ye?Je.slice(0,ye):Je}}():"0".split(void 0,0).length&&(g.split=function(he,ye){return he===void 0&&ye===0?[]:ne.call(this,he,ye)});var de=g.substr,Pe="".substr&&"0b".substr(-1)!=="b";return B(g,{substr:function(he,ye){return de.call(this,he<0&&(he=this.length+he)<0?0:he,ye)}},Pe),j3}var B1,B3;function Mte(){if(B3)return B1;B3=1;var u=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h,f=function(g){var S,C={},w=[];for(S=0;S<65536;S++)w.push(String.fromCharCode(S));return g.lastIndex=0,w.join("").replace(g,function(P){return C[P]="\\u"+("0000"+P.charCodeAt(0).toString(16)).slice(-4),""}),g.lastIndex=0,C};return B1={quote:function(g){var S=JSON.stringify(g);return u.lastIndex=0,u.test(S)?(h||(h=f(u)),S.replace(u,function(C){return h[C]})):S}},B1}var W1,W3;function Ute(){if(W3)return W1;W3=1;var u=function(){};return W1=function(h){return{filterToEnabled:function(f,g){var S={main:[],facade:[]};return f?typeof f=="string"&&(f=[f]):f=[],h.forEach(function(C){if(C&&!(C.transportName==="websocket"&&g.websocket===!1)){if(f.length&&f.indexOf(C.transportName)===-1){u("not in whitelist",C.transportName);return}C.enabled(g)?(u("enabled",C.transportName),S.main.push(C),C.facadeTransport&&S.facade.push(C.facadeTransport)):u("disabled",C.transportName)}}),S}}},W1}var G1,G3;function Vte(){if(G3)return G1;G3=1;var u={};return["log","debug","warn"].forEach(function(h){var f;try{f=globalThis.console&&globalThis.console[h]&&globalThis.console[h].apply}catch{}u[h]=f?function(){return globalThis.console[h].apply(globalThis.console,arguments)}:h==="log"?function(){}:u.log}),G1=u,G1}var H1,H3;function JA(){if(H3)return H1;H3=1;function u(h){this.type=h}return u.prototype.initEvent=function(h,f,g){return this.type=h,this.bubbles=f,this.cancelable=g,this.timeStamp=+new Date,this},u.prototype.stopPropagation=function(){},u.prototype.preventDefault=function(){},u.CAPTURING_PHASE=1,u.AT_TARGET=2,u.BUBBLING_PHASE=3,H1=u,H1}var K1,K3;function mF(){return K3||(K3=1,K1=globalThis.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}),K1}var z1,z3;function jte(){if(z3)return z1;z3=1;var u=Un(),h=JA();function f(){h.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return u(f,h),z1=f,z1}var Y1,Y3;function Fte(){if(Y3)return Y1;Y3=1;var u=Un(),h=JA();function f(g){h.call(this),this.initEvent("message",!1,!1),this.data=g}return u(f,h),Y1=f,Y1}var q1,q3;function Bte(){if(q3)return q1;q3=1;var u=us().EventEmitter,h=Un();function f(){var g=this;u.call(this),this.to=setTimeout(function(){g.emit("finish",200,"{}")},f.timeout)}return h(f,u),f.prototype.close=function(){clearTimeout(this.to)},f.timeout=2e3,q1=f,q1}var X1,X3;function _F(){if(X3)return X1;X3=1;var u=us().EventEmitter,h=Un(),f=XA();function g(S,C){u.call(this);var w=this,P=+new Date;this.xo=new C("GET",S),this.xo.once("finish",function(k,M){var U,B;if(k===200){if(B=+new Date-P,M)try{U=JSON.parse(M)}catch{}f.isObject(U)||(U={})}w.emit("finish",U,B),w.removeAllListeners()})}return h(g,u),g.prototype.close=function(){this.removeAllListeners(),this.xo.close()},X1=g,X1}var J1,J3;function gF(){if(J3)return J1;J3=1;var u=Un(),h=us().EventEmitter,f=VE(),g=_F();function S(C){var w=this;h.call(this),this.ir=new g(C,f),this.ir.once("finish",function(P,k){w.ir=null,w.emit("message",JSON.stringify([P,k]))})}return u(S,h),S.transportName="iframe-info-receiver",S.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},J1=S,J1}var Q1,Q3;function Wte(){if(Q3)return Q1;Q3=1;var u=us().EventEmitter,h=Un(),f=Zd(),g=fF(),S=gF();function C(w,P){var k=this;u.call(this);var M=function(){var U=k.ifr=new g(S.transportName,P,w);U.once("message",function(B){if(B){var Y;try{Y=JSON.parse(B)}catch{k.emit("finish"),k.close();return}var H=Y[0],ie=Y[1];k.emit("finish",H,ie)}k.close()}),U.once("close",function(){k.emit("finish"),k.close()})};globalThis.document.body?M():f.attachEvent("load",M)}return h(C,u),C.enabled=function(){return g.enabled()},C.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},Q1=C,Q1}var Z1,Z3;function Gte(){if(Z3)return Z1;Z3=1;var u=us().EventEmitter,h=Un(),f=qo(),g=qA(),S=x0(),C=VE(),w=Bte(),P=Wte(),k=_F();function M(U,B){var Y=this;u.call(this),setTimeout(function(){Y.doXhr(U,B)},0)}return h(M,u),M._getReceiver=function(U,B,Y){return Y.sameOrigin?new k(B,C):S.enabled?new k(B,S):g.enabled&&Y.sameScheme?new k(B,g):P.enabled()?new P(U,B):new k(B,w)},M.prototype.doXhr=function(U,B){var Y=this,H=f.addPath(U,"/info");this.xo=M._getReceiver(U,H,B),this.timeoutRef=setTimeout(function(){Y._cleanup(!1),Y.emit("finish")},M.timeout),this.xo.once("finish",function(ie,X){Y._cleanup(!0),Y.emit("finish",ie,X)})},M.prototype._cleanup=function(U){clearTimeout(this.timeoutRef),this.timeoutRef=null,!U&&this.xo&&this.xo.close(),this.xo=null},M.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},M.timeout=8e3,Z1=M,Z1}var $1,$3;function Hte(){if($3)return $1;$3=1;var u=FE();function h(f){this._transport=f,f.on("message",this._transportMessage.bind(this)),f.on("close",this._transportClose.bind(this))}return h.prototype._transportClose=function(f,g){u.postMessage("c",JSON.stringify([f,g]))},h.prototype._transportMessage=function(f){u.postMessage("t",f)},h.prototype._send=function(f){this._transport.send(f)},h.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},$1=h,$1}var eA,ej;function Kte(){if(ej)return eA;ej=1;var u=qo(),h=Zd(),f=Hte(),g=gF(),S=FE(),C=mF(),w=function(){};return eA=function(P,k){var M={};k.forEach(function(B){B.facadeTransport&&(M[B.facadeTransport.transportName]=B.facadeTransport)}),M[g.transportName]=g;var U;P.bootstrap_iframe=function(){var B;S.currentWindowId=C.hash.slice(1);var Y=function(H){if(H.source===parent&&(typeof U>"u"&&(U=H.origin),H.origin===U)){var ie;try{ie=JSON.parse(H.data)}catch{w("bad json",H.data);return}if(ie.windowId===S.currentWindowId)switch(ie.type){case"s":var X;try{X=JSON.parse(ie.data)}catch{w("bad json",ie.data);break}var te=X[0],ce=X[1],Z=X[2],le=X[3];if(te!==P.version)throw new Error('Incompatible SockJS! Main site uses: "'+te+'", the iframe: "'+P.version+'".');if(!u.isOriginEqual(Z,C.href)||!u.isOriginEqual(le,C.href))throw new Error("Can't connect to different domain from within an iframe. ("+C.href+", "+Z+", "+le+")");B=new f(new M[ce](Z,le));break;case"m":B._send(ie.data);break;case"c":B&&B._close(),B=null;break}}};h.attachEvent("message",Y),S.postMessage("s")}},eA}var tA,tj;function zte(){if(tj)return tA;tj=1,xte();var u=aF(),h=Un(),f=pm(),g=Mte(),S=qo(),C=Zd(),w=Ute(),P=XA(),k=jE(),M=Vte(),U=JA(),B=cF(),Y=mF(),H=jte(),ie=Fte(),X=Gte(),te=function(){},ce;function Z(ne,de,Pe){if(!(this instanceof Z))return new Z(ne,de,Pe);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");B.call(this),this.readyState=Z.CONNECTING,this.extensions="",this.protocol="",Pe=Pe||{},Pe.protocols_whitelist&&M.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=Pe.transports,this._transportOptions=Pe.transportOptions||{},this._timeout=Pe.timeout||0;var ue=Pe.sessionId||8;if(typeof ue=="function")this._generateSessionId=ue;else if(typeof ue=="number")this._generateSessionId=function(){return f.string(ue)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=Pe.server||f.numberString(1e3);var he=new u(ne);if(!he.host||!he.protocol)throw new SyntaxError("The URL '"+ne+"' is invalid");if(he.hash)throw new SyntaxError("The URL must not contain a fragment");if(he.protocol!=="http:"&&he.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+he.protocol+"' is not allowed.");var ye=he.protocol==="https:";if(Y.protocol==="https:"&&!ye&&!S.isLoopbackAddr(he.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");de?Array.isArray(de)||(de=[de]):de=[];var Ve=de.sort();Ve.forEach(function(Ue,xe){if(!Ue)throw new SyntaxError("The protocols entry '"+Ue+"' is invalid.");if(xe<Ve.length-1&&Ue===Ve[xe+1])throw new SyntaxError("The protocols entry '"+Ue+"' is duplicated.")});var Je=S.getOrigin(Y.href);this._origin=Je?Je.toLowerCase():null,he.set("pathname",he.pathname.replace(/\/+$/,"")),this.url=he.href,te("using url",this.url),this._urlInfo={nullOrigin:!k.hasDomain(),sameOrigin:S.isOriginEqual(this.url,Y.href),sameScheme:S.isSchemeEqual(this.url,Y.href)},this._ir=new X(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}h(Z,B);function le(ne){return ne===1e3||ne>=3e3&&ne<=4999}return Z.prototype.close=function(ne,de){if(ne&&!le(ne))throw new Error("InvalidAccessError: Invalid code");if(de&&de.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===Z.CLOSING||this.readyState===Z.CLOSED)){var Pe=!0;this._close(ne||1e3,de||"Normal closure",Pe)}},Z.prototype.send=function(ne){if(typeof ne!="string"&&(ne=""+ne),this.readyState===Z.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===Z.OPEN&&this._transport.send(g.quote(ne))},Z.version=pF(),Z.CONNECTING=0,Z.OPEN=1,Z.CLOSING=2,Z.CLOSED=3,Z.prototype._receiveInfo=function(ne,de){if(this._ir=null,!ne){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(de),this._transUrl=ne.base_url?ne.base_url:this.url,ne=P.extend(ne,this._urlInfo);var Pe=ce.filterToEnabled(this._transportsWhitelist,ne);this._transports=Pe.main,te(this._transports.length+" enabled transports"),this._connect()},Z.prototype._connect=function(){for(var ne=this._transports.shift();ne;ne=this._transports.shift()){if(te("attempt",ne.transportName),ne.needBody&&(!globalThis.document.body||typeof globalThis.document.readyState<"u"&&globalThis.document.readyState!=="complete"&&globalThis.document.readyState!=="interactive")){this._transports.unshift(ne),C.attachEvent("load",this._connect.bind(this));return}var de=Math.max(this._timeout,this._rto*ne.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),de);var Pe=S.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),ue=this._transportOptions[ne.transportName],he=new ne(Pe,this._transUrl,ue);he.on("message",this._transportMessage.bind(this)),he.once("close",this._transportClose.bind(this)),he.transportName=ne.transportName,this._transport=he;return}this._close(2e3,"All transports failed",!1)},Z.prototype._transportTimeout=function(){this.readyState===Z.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},Z.prototype._transportMessage=function(ne){var de=this,Pe=ne.slice(0,1),ue=ne.slice(1),he;switch(Pe){case"o":this._open();return;case"h":this.dispatchEvent(new U("heartbeat")),te("heartbeat",this.transport);return}if(ue)try{he=JSON.parse(ue)}catch{}if(!(typeof he>"u"))switch(Pe){case"a":Array.isArray(he)&&he.forEach(function(ye){te("message",de.transport),de.dispatchEvent(new ie(ye))});break;case"m":te("message",this.transport),this.dispatchEvent(new ie(he));break;case"c":Array.isArray(he)&&he.length===2&&this._close(he[0],he[1],!0);break}},Z.prototype._transportClose=function(ne,de){if(te("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!le(ne)&&ne!==2e3&&this.readyState===Z.CONNECTING){this._connect();return}this._close(ne,de)},Z.prototype._open=function(){te("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===Z.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=Z.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new U("open")),te("connected",this.transport)):this._close(1006,"Server lost session")},Z.prototype._close=function(ne,de,Pe){te("_close",this.transport,ne,de,Pe,this.readyState);var ue=!1;if(this._ir&&(ue=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===Z.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=Z.CLOSING,setTimeout((function(){this.readyState=Z.CLOSED,ue&&this.dispatchEvent(new U("error"));var he=new H("close");he.wasClean=Pe||!1,he.code=ne||1e3,he.reason=de,this.dispatchEvent(he),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},Z.prototype.countRTO=function(ne){return ne>100?4*ne:300+ne},tA=function(ne){return ce=w(ne),Kte()(Z,ne),Z},tA}var nA,nj;function Yte(){if(nj)return nA;nj=1;var u=Lte();return nA=zte()(u),"_sockjs_onload"in globalThis&&setTimeout(globalThis._sockjs_onload,1),nA}var qte=Yte();const Xte=g0(qte);function Jte(u,h){u.terminate=function(){const f=()=>{};this.onerror=f,this.onmessage=f,this.onopen=f;const g=new Date,S=Math.random().toString().substring(2,8),C=this.onclose;this.onclose=w=>{const P=new Date().getTime()-g.getTime();h(`Discarded socket (#${S})  closed after ${P}ms, with code/reason: ${w.code}/${w.reason}`)},this.close(),C?.call(u,{code:4001,reason:`Quick discarding socket (#${S}) without waiting for the shutdown sequence.`,wasClean:!1})}}const TE={LF:`
`,NULL:"\0"};class Hd{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(h){const{command:f,headers:g,body:S,binaryBody:C,escapeHeaderValues:w,skipContentLengthHeader:P}=h;this.command=f,this.headers=Object.assign({},g||{}),C?(this._binaryBody=C,this.isBinaryBody=!0):(this._body=S||"",this.isBinaryBody=!1),this.escapeHeaderValues=w||!1,this.skipContentLengthHeader=P||!1}static fromRawFrame(h,f){const g={},S=C=>C.replace(/^\s+|\s+$/g,"");for(const C of h.headers.reverse()){C.indexOf(":");const w=S(C[0]);let P=S(C[1]);f&&h.command!=="CONNECT"&&h.command!=="CONNECTED"&&(P=Hd.hdrValueUnEscape(P)),g[w]=P}return new Hd({command:h.command,headers:g,binaryBody:h.binaryBody,escapeHeaderValues:f})}toString(){return this.serializeCmdAndHeaders()}serialize(){const h=this.serializeCmdAndHeaders();return this.isBinaryBody?Hd.toUnit8Array(h,this._binaryBody).buffer:h+this._body+TE.NULL}serializeCmdAndHeaders(){const h=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const f of Object.keys(this.headers||{})){const g=this.headers[f];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?h.push(`${f}:${Hd.hdrValueEscape(`${g}`)}`):h.push(`${f}:${g}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&h.push(`content-length:${this.bodyLength()}`),h.join(TE.LF)+TE.LF+TE.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const h=this.binaryBody;return h?h.length:0}static sizeOfUTF8(h){return h?new TextEncoder().encode(h).length:0}static toUnit8Array(h,f){const g=new TextEncoder().encode(h),S=new Uint8Array([0]),C=new Uint8Array(g.length+f.length+S.length);return C.set(g),C.set(f,g.length),C.set(S,g.length+f.length),C}static marshall(h){return new Hd(h).serialize()}static hdrValueEscape(h){return h.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(h){return h.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const rj=0,r0=10,i0=13,Qte=58;class Zte{constructor(h,f){this.onFrame=h,this.onIncomingPing=f,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(h,f=!1){let g;if(typeof h=="string"?g=this._encoder.encode(h):g=new Uint8Array(h),f&&g[g.length-1]!==0){const S=new Uint8Array(g.length+1);S.set(g,0),S[g.length]=0,g=S}for(let S=0;S<g.length;S++){const C=g[S];this._onByte(C)}}_collectFrame(h){if(h!==rj&&h!==i0){if(h===r0){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(h)}}_collectCommand(h){if(h!==i0){if(h===r0){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(h)}}_collectHeaders(h){if(h!==i0){if(h===r0){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(h)}}_reinjectByte(h){this._onByte(h)}_collectHeaderKey(h){if(h===Qte){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(h)}_collectHeaderValue(h){if(h!==i0){if(h===r0){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(h)}}_setupCollectBody(){const h=this._results.headers.filter(f=>f[0]==="content-length")[0];h?(this._bodyBytesRemaining=parseInt(h[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(h){if(h===rj){this._retrievedBody();return}this._consumeByte(h)}_collectBodyFixedSize(h){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(h)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(h){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",h)}this._initState()}_consumeByte(h){this._token.push(h)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const h=new Uint8Array(this._token);return this._token=[],h}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var Kd;(function(u){u[u.CONNECTING=0]="CONNECTING",u[u.OPEN=1]="OPEN",u[u.CLOSING=2]="CLOSING",u[u.CLOSED=3]="CLOSED"})(Kd||(Kd={}));var Pa;(function(u){u[u.ACTIVE=0]="ACTIVE",u[u.DEACTIVATING=1]="DEACTIVATING",u[u.INACTIVE=2]="INACTIVE"})(Pa||(Pa={}));var m0;(function(u){u[u.LINEAR=0]="LINEAR",u[u.EXPONENTIAL=1]="EXPONENTIAL"})(m0||(m0={}));var LE;(function(u){u.Interval="interval",u.Worker="worker"})(LE||(LE={}));class $te{constructor(h,f=LE.Interval,g){this._interval=h,this._strategy=f,this._debug=g,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(h){this.stop(),this.shouldUseWorker()?this.runWorker(h):this.runInterval(h)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===LE.Worker}runWorker(h){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=f=>h(f.data))}runInterval(h){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const f=Date.now();this._timer=setInterval(()=>{h(Date.now()-f)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class ds{constructor(h){this.versions=h}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(h=>`v${h.replace(".","")}.stomp`)}}ds.V1_0="1.0";ds.V1_1="1.1";ds.V1_2="1.2";ds.default=new ds([ds.V1_2,ds.V1_1,ds.V1_0]);class ene{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(h,f,g){this._client=h,this._webSocket=f,this._connected=!1,this._serverFrameHandlers={CONNECTED:S=>{this.debug(`connected to server ${S.headers.server}`),this._connected=!0,this._connectedVersion=S.headers.version,this._connectedVersion===ds.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(S.headers),this.onConnect(S)},MESSAGE:S=>{const C=S.headers.subscription,w=this._subscriptions[C]||this.onUnhandledMessage,P=S,k=this,M=this._connectedVersion===ds.V1_2?P.headers.ack:P.headers["message-id"];P.ack=(U={})=>k.ack(M,C,U),P.nack=(U={})=>k.nack(M,C,U),w(P)},RECEIPT:S=>{const C=this._receiptWatchers[S.headers["receipt-id"]];C?(C(S),delete this._receiptWatchers[S.headers["receipt-id"]]):this.onUnhandledReceipt(S)},ERROR:S=>{this.onStompError(S)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=g.debug,this.stompVersions=g.stompVersions,this.connectHeaders=g.connectHeaders,this.disconnectHeaders=g.disconnectHeaders,this.heartbeatIncoming=g.heartbeatIncoming,this.heartbeatToleranceMultiplier=g.heartbeatGracePeriods,this.heartbeatOutgoing=g.heartbeatOutgoing,this.splitLargeFrames=g.splitLargeFrames,this.maxWebSocketChunkSize=g.maxWebSocketChunkSize,this.forceBinaryWSFrames=g.forceBinaryWSFrames,this.logRawCommunication=g.logRawCommunication,this.appendMissingNULLonIncoming=g.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=g.discardWebsocketOnCommFailure,this.onConnect=g.onConnect,this.onDisconnect=g.onDisconnect,this.onStompError=g.onStompError,this.onWebSocketClose=g.onWebSocketClose,this.onWebSocketError=g.onWebSocketError,this.onUnhandledMessage=g.onUnhandledMessage,this.onUnhandledReceipt=g.onUnhandledReceipt,this.onUnhandledFrame=g.onUnhandledFrame,this.onHeartbeatReceived=g.onHeartbeatReceived,this.onHeartbeatLost=g.onHeartbeatLost}start(){const h=new Zte(f=>{const g=Hd.fromRawFrame(f,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${g}`),(this._serverFrameHandlers[g.command]||this.onUnhandledFrame)(g)},()=>{this.debug("<<< PONG"),this.onHeartbeatReceived()});this._webSocket.onmessage=f=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const g=f.data instanceof ArrayBuffer?new TextDecoder().decode(f.data):f.data;this.debug(`<<< ${g}`)}h.parseChunk(f.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=f=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(f)},this._webSocket.onerror=f=>{this.onWebSocketError(f)},this._webSocket.onopen=()=>{const f=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),f["accept-version"]=this.stompVersions.supportedVersions(),f["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:f})}}_setupHeartbeat(h){if(h.version!==ds.V1_1&&h.version!==ds.V1_2||!h["heart-beat"])return;const[f,g]=h["heart-beat"].split(",").map(S=>parseInt(S,10));if(this.heartbeatOutgoing!==0&&g!==0){const S=Math.max(this.heartbeatOutgoing,g);this.debug(`send PING every ${S}ms`),this._pinger=new $te(S,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===Kd.OPEN&&(this._webSocket.send(TE.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&f!==0){const S=Math.max(this.heartbeatIncoming,f);this.debug(`check PONG every ${S}ms`),this._ponger=setInterval(()=>{const C=Date.now()-this._lastServerActivityTS;C>S*this.heartbeatToleranceMultiplier&&(this.debug(`did not receive server activity for the last ${C}ms`),this.onHeartbeatLost(),this._closeOrDiscardWebsocket())},S)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===Kd.CONNECTING||this._webSocket.readyState===Kd.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&Jte(this._webSocket,h=>this.debug(h)),this._webSocket.terminate()}_transmit(h){const{command:f,headers:g,body:S,binaryBody:C,skipContentLengthHeader:w}=h,P=new Hd({command:f,headers:g,body:S,binaryBody:C,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:w});let k=P.serialize();if(this.logRawCommunication?this.debug(`>>> ${k}`):this.debug(`>>> ${P}`),this.forceBinaryWSFrames&&typeof k=="string"&&(k=new TextEncoder().encode(k)),typeof k!="string"||!this.splitLargeFrames)this._webSocket.send(k);else{let M=k;for(;M.length>0;){const U=M.substring(0,this.maxWebSocketChunkSize);M=M.substring(this.maxWebSocketChunkSize),this._webSocket.send(U),this.debug(`chunk sent = ${U.length}, remaining = ${M.length}`)}}}dispose(){if(this.connected)try{const h=Object.assign({},this.disconnectHeaders);h.receipt||(h.receipt=`close-${this._counter++}`),this.watchForReceipt(h.receipt,f=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(f)}),this._transmit({command:"DISCONNECT",headers:h})}catch(h){this.debug(`Ignoring error during disconnect ${h}`)}else(this._webSocket.readyState===Kd.CONNECTING||this._webSocket.readyState===Kd.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(h){const{destination:f,headers:g,body:S,binaryBody:C,skipContentLengthHeader:w}=h,P=Object.assign({destination:f},g);this._transmit({command:"SEND",headers:P,body:S,binaryBody:C,skipContentLengthHeader:w})}watchForReceipt(h,f){this._receiptWatchers[h]=f}subscribe(h,f,g={}){g=Object.assign({},g),g.id||(g.id=`sub-${this._counter++}`),g.destination=h,this._subscriptions[g.id]=f,this._transmit({command:"SUBSCRIBE",headers:g});const S=this;return{id:g.id,unsubscribe(C){return S.unsubscribe(g.id,C)}}}unsubscribe(h,f={}){f=Object.assign({},f),delete this._subscriptions[h],f.id=h,this._transmit({command:"UNSUBSCRIBE",headers:f})}begin(h){const f=h||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:f}});const g=this;return{id:f,commit(){g.commit(f)},abort(){g.abort(f)}}}commit(h){this._transmit({command:"COMMIT",headers:{transaction:h}})}abort(h){this._transmit({command:"ABORT",headers:{transaction:h}})}ack(h,f,g={}){g=Object.assign({},g),this._connectedVersion===ds.V1_2?g.id=h:g["message-id"]=h,g.subscription=f,this._transmit({command:"ACK",headers:g})}nack(h,f,g={}){return g=Object.assign({},g),this._connectedVersion===ds.V1_2?g.id=h:g["message-id"]=h,g.subscription=f,this._transmit({command:"NACK",headers:g})}}class tne{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(h){this._disconnectHeaders=h,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===Pa.ACTIVE}_changeState(h){this.state=h,this.onChangeState(h)}constructor(h={}){this.stompVersions=ds.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=900*1e3,this.reconnectTimeMode=m0.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatToleranceMultiplier=2,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=LE.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=Pa.INACTIVE;const f=()=>{};this.debug=f,this.beforeConnect=f,this.onConnect=f,this.onDisconnect=f,this.onUnhandledMessage=f,this.onUnhandledReceipt=f,this.onUnhandledFrame=f,this.onHeartbeatReceived=f,this.onHeartbeatLost=f,this.onStompError=f,this.onWebSocketClose=f,this.onWebSocketError=f,this.logRawCommunication=!1,this.onChangeState=f,this.connectHeaders={},this._disconnectHeaders={},this.configure(h)}configure(h){Object.assign(this,h),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const h=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(Pa.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===Pa.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{h()})):h()}async _connect(){if(await this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const h=this._createWebSocket();this._stompHandler=new ene(this,h,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatGracePeriods:this.heartbeatToleranceMultiplier,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:f=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(f)},onDisconnect:f=>{this.onDisconnect(f)},onStompError:f=>{this.onStompError(f)},onWebSocketClose:f=>{this._stompHandler=void 0,this.state===Pa.DEACTIVATING&&this._changeState(Pa.INACTIVE),this.onWebSocketClose(f),this.active&&this._schedule_reconnect()},onWebSocketError:f=>{this.onWebSocketError(f)},onUnhandledMessage:f=>{this.onUnhandledMessage(f)},onUnhandledReceipt:f=>{this.onUnhandledReceipt(f)},onUnhandledFrame:f=>{this.onUnhandledFrame(f)},onHeartbeatReceived:()=>{this.onHeartbeatReceived()},onHeartbeatLost:()=>{this.onHeartbeatLost()}}),this._stompHandler.start()}_createWebSocket(){let h;if(this.webSocketFactory)h=this.webSocketFactory();else if(this.brokerURL)h=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return h.binaryType="arraybuffer",h}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===m0.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}async deactivate(h={}){const f=h.force||!1,g=this.active;let S;if(this.state===Pa.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(Pa.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==Kd.CLOSED){const C=this._stompHandler.onWebSocketClose;S=new Promise((w,P)=>{this._stompHandler.onWebSocketClose=k=>{C(k),w()}})}else return this._changeState(Pa.INACTIVE),Promise.resolve();return f?this._stompHandler?.discardWebsocket():g&&this._disposeStompHandler(),S}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(h){this._checkConnection(),this._stompHandler.publish(h)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(h,f){this._checkConnection(),this._stompHandler.watchForReceipt(h,f)}subscribe(h,f,g={}){return this._checkConnection(),this._stompHandler.subscribe(h,f,g)}unsubscribe(h,f={}){this._checkConnection(),this._stompHandler.unsubscribe(h,f)}begin(h){return this._checkConnection(),this._stompHandler.begin(h)}commit(h){this._checkConnection(),this._stompHandler.commit(h)}abort(h){this._checkConnection(),this._stompHandler.abort(h)}ack(h,f,g={}){this._checkConnection(),this._stompHandler.ack(h,f,g)}nack(h,f,g={}){this._checkConnection(),this._stompHandler.nack(h,f,g)}}class nne{client=null;subscriptions=new Map;connectionState={isConnected:!1,isConnecting:!1,reconnectAttempts:0,maxReconnectAttempts:5};onConnectionStateChangeCallbacks=[];onMatchingNotificationCallbacks=[];onCallStartNotificationCallbacks=[];onCallEndNotificationCallbacks=[];onErrorCallbacks=[];constructor(){}setupClient(h){const f="http://localhost:8080/ws";console.log(" WebSocket URL:",f),tt.log(" WebSocket  ");const g=new Xte(f);this.client=new tne({webSocketFactory:()=>g,debug:S=>{console.log("STOMP Debug:",S)},reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),this.client.onConnect=S=>{console.log(" WebSocket  :",S),console.log("  :",S.headers),console.log("  :",S.body),this.connectionState={...this.connectionState,isConnected:!0,isConnecting:!1,reconnectAttempts:0,lastConnected:new Date().toISOString()},this.onConnectionStateChangeCallbacks.forEach(C=>C(this.connectionState)),console.log("   "),this.subscribeToQueues(),setTimeout(()=>{this.logSubscriptionStatus()},100)},this.client.onStompError=S=>{console.error(" STOMP :",S),console.error("  :",S.headers),console.error("  :",S.body),this.connectionState={...this.connectionState,isConnected:!1,isConnecting:!1},this.onConnectionStateChangeCallbacks.forEach(w=>w(this.connectionState));const C=`WebSocket  : ${S.headers.message||"   "}`;this.onErrorCallbacks.forEach(w=>w(C))},this.client.onDisconnect=()=>{console.log("WebSocket  "),this.connectionState={...this.connectionState,isConnected:!1,isConnecting:!1},this.onConnectionStateChangeCallbacks.forEach(S=>S(this.connectionState))}}async connect(h){if(this.connectionState.isConnected||this.connectionState.isConnecting){console.log("    .");return}try{console.log(" WebSocket   "),this.connectionState={...this.connectionState,isConnecting:!0},this.onConnectionStateChangeCallbacks.forEach(f=>f(this.connectionState)),this.client||(console.log(" WebSocket  "),this.setupClient(h)),this.client.connectHeaders={Authorization:`Bearer ${h}`},console.log(" JWT    (URL + )"),console.log(" STOMP   "),await this.client.activate(),console.log(" STOMP   ")}catch(f){console.error(" WebSocket  :",f),this.connectionState={...this.connectionState,isConnecting:!1,reconnectAttempts:this.connectionState.reconnectAttempts+1},this.onConnectionStateChangeCallbacks.forEach(S=>S(this.connectionState));const g=` : ${f instanceof Error?f.message:"   "}`;throw this.onErrorCallbacks.forEach(S=>S(g)),f}}disconnect(){this.client&&this.connectionState.isConnected&&(this.unsubscribeFromQueues(),this.client.deactivate())}subscribeToQueues(){if(!this.client||!this.connectionState.isConnected){console.warn(" WebSocket    ");return}console.log("    -  :",{isConnected:this.connectionState.isConnected,clientExists:!!this.client}),console.log(" /user/queue/matching  ");const h=this.client.subscribe("/user/queue/matching",S=>{try{console.log(" [] WebSocket   (/user/queue/matching):",S.body);const C=JSON.parse(S.body);console.log(" []   :",C),console.log(" []  :",{type:C.type,matchingId:C.matchingId,matchedUser:C.matchedUser,message:C.message,timestamp:C.timestamp}),console.log(` [] ${this.onMatchingNotificationCallbacks.length}  `),this.onMatchingNotificationCallbacks.forEach(w=>w(C))}catch(C){console.error(" []   :",C),console.error(" []  :",S.body);const w="     .";this.onErrorCallbacks.forEach(P=>P(w))}});console.log(" /user/queue/call-start  ");const f=this.client.subscribe("/user/queue/call-start",S=>{try{console.log(" [] WebSocket   (/user/queue/call-start):",S.body);const C=JSON.parse(S.body);console.log(" []   :",C),console.log(" []  :",{type:C.type,callId:C.callId,matchingId:C.matchingId,partnerId:C.partnerId,partnerNickname:C.partnerNickname,channelName:C.channelName,agoraUid:C.agoraUid,timestamp:C.timestamp}),console.log(` [] ${this.onCallStartNotificationCallbacks.length}  `),this.onCallStartNotificationCallbacks.forEach(w=>w(C))}catch(C){console.error(" []   :",C),console.error(" []  :",S.body);const w="      .";this.onErrorCallbacks.forEach(P=>P(w))}});console.log(" /user/queue/call-end  ");const g=this.client.subscribe("/user/queue/call-end",S=>{try{console.log(" [] WebSocket   (/user/queue/call-end):",S.body);const C=JSON.parse(S.body);console.log(" []   :",C),console.log(" []  :",{type:C.type,callId:C.callId,partnerId:C.partnerId,timestamp:C.timestamp}),console.log(` [] ${this.onCallEndNotificationCallbacks.length}  `),this.onCallEndNotificationCallbacks.forEach(w=>w(C))}catch(C){console.error(" []   :",C),console.error(" []  :",S.body);const w="      .";this.onErrorCallbacks.forEach(P=>P(w))}});this.subscriptions.set("matching",h),this.subscriptions.set("call-start",f),this.subscriptions.set("call-end",g),console.log("   :",{matchingSubscribed:this.subscriptions.has("matching"),callStartSubscribed:this.subscriptions.has("call-start"),callEndSubscribed:this.subscriptions.has("call-end"),totalSubscriptions:this.subscriptions.size})}unsubscribeFromQueues(){this.subscriptions.forEach((h,f)=>{h.unsubscribe(),console.log(` : ${f}`)}),this.subscriptions.clear()}onConnectionStateChangeCallback(h){this.onConnectionStateChangeCallbacks.includes(h)||(this.onConnectionStateChangeCallbacks.push(h),console.log(`      ( ${this.onConnectionStateChangeCallbacks.length})`))}onMatchingNotificationCallback(h){this.onMatchingNotificationCallbacks.includes(h)||(this.onMatchingNotificationCallbacks.push(h),console.log(`     ( ${this.onMatchingNotificationCallbacks.length})`))}onCallStartNotificationCallback(h){this.onCallStartNotificationCallbacks.includes(h)||(this.onCallStartNotificationCallbacks.push(h),console.log(`      ( ${this.onCallStartNotificationCallbacks.length})`))}onCallEndNotificationCallback(h){this.onCallEndNotificationCallbacks.includes(h)||(this.onCallEndNotificationCallbacks.push(h),console.log(`      ( ${this.onCallEndNotificationCallbacks.length})`))}onErrorCallback(h){this.onErrorCallbacks.includes(h)||(this.onErrorCallbacks.push(h),console.log(`    ( ${this.onErrorCallbacks.length})`))}sendMessage(h,f){if(!this.client||!this.connectionState.isConnected)throw console.error(" WebSocket   -   "),new Error("WebSocket  .");try{this.client.publish({destination:h,body:JSON.stringify(f)}),console.log(" WebSocket   ")}catch(g){throw console.error(" WebSocket   :",g),g}}sendCallEndNotification(h,f){const g={type:"call_end",callId:h,partnerId:f,timestamp:new Date().toISOString()},S=`/app/call-end/${f}`;this.sendMessage(S,g)}getConnectionState(){return{...this.connectionState}}isConnected(){return this.connectionState.isConnected}getSubscriptionStatus(){const h={};return this.subscriptions.forEach((f,g)=>{h[g]=!0}),h}logSubscriptionStatus(){console.log(" WebSocket  :",{isConnected:this.connectionState.isConnected,subscriptions:this.getSubscriptionStatus(),totalSubscriptions:this.subscriptions.size,lastConnected:this.connectionState.lastConnected})}async reconnect(h){if(this.connectionState.reconnectAttempts>=this.connectionState.maxReconnectAttempts)throw new Error("    .");console.log(`  ${this.connectionState.reconnectAttempts+1}/${this.connectionState.maxReconnectAttempts}`),this.disconnect(),this.client=null,await new Promise(f=>setTimeout(f,2e3)),await this.connect(h)}destroy(){this.disconnect(),this.subscriptions.clear(),this.client=null,this.onConnectionStateChangeCallbacks=[],this.onMatchingNotificationCallbacks=[],this.onCallStartNotificationCallbacks=[],this.onCallEndNotificationCallbacks=[],this.onErrorCallbacks=[],console.log(" WebSocket   ")}}let rA=null;const M0=()=>(rA||(rA=new nne),rA),tm=M0(),ij={status:"idle",matchingId:void 0,categoryId:void 0,location:void 0,queuePosition:void 0,estimatedWaitTime:void 0,matchedUser:void 0,connectionState:{isConnected:!1,isConnecting:!1,reconnectAttempts:0,maxReconnectAttempts:5},categories:[],error:void 0,createdAt:void 0,updatedAt:void 0},QA=oF()(fte(gte((u,h)=>({...ij,startMatching:async f=>{try{u({error:null,status:"waiting"});const g=uo();if(!g)throw new Error("  .");Gd.setToken(g);const S=await Gd.joinMatching(f);u({matchingId:S.queue_id,status:S.queue_status.toLowerCase(),categoryId:S.category_id,queuePosition:S.queue_position,estimatedWaitTime:Math.ceil(S.estimated_wait_time_seconds/60),createdAt:S.created_at,updatedAt:new Date().toISOString()});const C=M0(),w=C.getConnectionState();if(!h().connectionState.isConnected||!w.isConnected)try{await h().connectWebSocket()}catch{}else{const P=C.getSubscriptionStatus();if(Object.keys(P).length===0)try{await h().connectWebSocket()}catch{}}}catch(g){const S=g instanceof Error?g.message:"    .";throw u({error:S,status:"idle"}),g}},cancelMatching:async()=>{try{u({error:null});const f=uo();if(!f)throw new Error("  .");const{matchingId:g}=h();if(!g)throw new Error("  .");Gd.setToken(f),await Gd.cancelMatching(g),u({status:"cancelled",updatedAt:new Date().toISOString()})}catch(f){const g=f instanceof Error?f.message:"    .";throw u({error:g}),f}},refreshMatchingStatus:async()=>{try{u({error:null});const f=uo();if(!f)throw new Error("  .");Gd.setToken(f);const g=await Gd.getMatchingStatus();h().setMatchingStatus(g)}catch(f){const g=f instanceof Error?f.message:"     .";throw u({error:g}),f}},loadCategories:async()=>{try{u({error:null});const f=uo();Gd.setToken(f||void 0);const g=await Gd.getActiveCategories();u({categories:g})}catch(f){const g=f instanceof Error?f.message:"     .";throw u({error:g}),f}},connectWebSocket:async()=>{try{const f=uo();if(!f)throw new Error("  .");u({error:null,connectionState:{...h().connectionState,isConnecting:!0}}),tm.onConnectionStateChangeCallback(g=>{h().setConnectionState(g)}),tm.onMatchingNotificationCallback(g=>{h().handleMatchingNotification(g)}),tm.onCallStartNotificationCallback(g=>{h().handleCallStartNotification(g)}),tm.onErrorCallback(g=>{h().setError(g)}),await tm.connect(f)}catch(f){console.error(" connectWebSocket :",f);const g=f instanceof Error?f.message:"WebSocket    .";throw u({error:g,connectionState:{...h().connectionState,isConnecting:!1}}),f}},disconnectWebSocket:()=>{tm.disconnect(),u({connectionState:{...h().connectionState,isConnected:!1,isConnecting:!1}})},setMatchingStatus:f=>{u({status:f.status,queuePosition:f.queuePosition,estimatedWaitTime:f.estimatedWaitTime,categoryId:f.categoryId,location:f.location,matchedUser:f.matchedUser,updatedAt:new Date().toISOString()})},setConnectionState:f=>{u({connectionState:{...h().connectionState,...f}})},setError:f=>{u({error:f})},setCategories:f=>{u({categories:f})},handleMatchingNotification:f=>{switch(h(),f.type){case"position_update":u({queuePosition:f.queuePosition,estimatedWaitTime:f.estimatedWaitTime,updatedAt:new Date().toISOString()});break;case"matched":u({status:"matched",matchedUser:f.matchedUser,updatedAt:new Date().toISOString()});break;case"cancelled":u({status:"cancelled",updatedAt:new Date().toISOString()});break;case"timeout":u({status:"timeout",updatedAt:new Date().toISOString()});break}},handleCallStartNotification:f=>{u({updatedAt:new Date().toISOString()})},resetMatching:()=>{u({...ij,categories:h().categories,connectionState:h().connectionState})}}),{name:"matching-store",partialize:u=>({categories:u.categories,connectionState:u.connectionState})}),{name:"matching-store"})),_0={HOBBY:{id:1,name:"",icon:"hobby.png"},CHILDREN:{id:2,name:"",icon:"children.png"},SPOUSE:{id:3,name:"",icon:"marriage.png"},MEMORIES:{id:4,name:"",icon:"memories.png"},STRESS:{id:5,name:"",icon:"stress.png"},REQUEST:{id:0,name:"",icon:"plus.png"}};function EF(u){if(u==null)return"  ";const h=typeof u=="string"?parseInt(u):u;if(!isNaN(h))return Object.values(_0).find(C=>C.id===h)?.name||"  ";const f=String(u).toUpperCase();return _0[f]?.name||String(u)}function rne({isOpen:u,onClose:h,onSubmit:f}){const[g,S]=ee.useState(""),[C,w]=ee.useState(!1),P=async()=>{if(!g.trim()){alert("  .");return}if(g.trim().length<2){alert("   2  .");return}w(!0);try{await f(g.trim()),S(""),h()}catch(U){console.error("  :",U)}finally{w(!1)}},k=()=>{C||(S(""),h())},M=U=>{U.key==="Enter"&&!C&&P()};return u?O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4",onClick:k,children:O.jsxs("div",{className:"bg-white rounded-2xl p-6 md:p-8 max-w-md w-full",onClick:U=>U.stopPropagation(),children:[O.jsx("h2",{className:"text-xl md:text-2xl font-crimson font-bold text-gray-900 mb-3",children:" "}),O.jsxs("p",{className:"text-gray-600 font-pretendard text-sm md:text-base mb-6",children:["   .",O.jsx("br",{}),"     ."]}),O.jsx("input",{type:"text",value:g,onChange:U=>S(U.target.value),onKeyPress:M,placeholder:": , , ,  ",maxLength:20,disabled:C,className:"w-full px-4 py-3 border border-gray-300 rounded-lg font-pretendard text-base focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed mb-6"}),O.jsxs("div",{className:"flex gap-3",children:[O.jsx("button",{onClick:k,disabled:C,className:"flex-1 py-3 border-2 border-gray-300 text-gray-700 font-crimson text-lg font-semibold rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:""}),O.jsx("button",{onClick:P,disabled:C||!g.trim(),className:"flex-1 py-3 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-lg font-semibold rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:C?" ...":""})]})]})}):null}function ine({onStartCall:u,onOpenSettings:h,onOpenCallHistory:f}){const g=Qd(),{startMatching:S,status:C,error:w}=QA(),[P,k]=ee.useState(null),[M,U]=ee.useState(!1),[B,Y]=ee.useState(" "),[H,ie]=ee.useState(!0),[X,te]=ee.useState(!1),[ce,Z]=ee.useState(!1),[le,ne]=ee.useState(!1);ee.useEffect(()=>{let ye=!0;return(async()=>{try{ie(!0);const Je=await YA();ye&&Y(Je.data.nickname)}catch(Je){console.error("   :",Je),Je instanceof Error&&Je.message.includes(" ")&&console.warn("    ")}finally{ye&&ie(!1)}})(),()=>{ye=!1}},[]);const de=Object.values(_0).map(ye=>({id:ye.id.toString(),name:ye.name,icon:ye.id===0?O.jsx("div",{className:"w-full h-full flex items-center justify-center",children:O.jsxs("svg",{className:"w-16 h-16 xs:w-14 xs:h-14",viewBox:"0 0 64 64",fill:"none",preserveAspectRatio:"xMidYMid meet",children:[O.jsx("circle",{cx:"32",cy:"32",r:"30",fill:"#FFDAB9"}),O.jsx("path",{d:"M32 16V48M16 32H48",stroke:"#EF4444",strokeWidth:"6",strokeLinecap:"round"})]})}):O.jsx("div",{className:"w-full h-full flex items-center justify-center",children:O.jsx("img",{src:`/icons/${ye.icon}`,alt:ye.name,className:"w-16 h-16 xs:w-12 xs:h-12 object-contain"})})})),Pe=async()=>{if(!(!P||X))try{te(!0),await S({category_id:parseInt(P)}),g("/connecting-call")}catch(ye){console.error("   :",ye)}finally{te(!1)}},ue=ye=>{if(ye==="0"){Z(!0);return}k(ye)},he=async ye=>{try{const Ve=uo();if(!Ve){alert(" .");return}const Je="http://localhost:8080/api".replace(/\/$/,""),Ue={category_name:ye},xe=await fetch(`${Je}/v1/categories/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ve}`},credentials:"include",body:JSON.stringify(Ue)});if(!xe.ok){const dt=await xe.json().catch(()=>({}));throw new Error(dt.message||"  .")}const Ge=await xe.json();ne(!0),setTimeout(()=>{ne(!1)},2e3)}catch(Ve){throw console.error("  :",Ve),alert(Ve instanceof Error?Ve.message:"  .  ."),Ve}};return O.jsxs("div",{className:"min-h-screen bg-grey-50 flex flex-col safe-area-page",children:[O.jsx(rne,{isOpen:ce,onClose:()=>Z(!1),onSubmit:he}),le&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"category-request-success-title","aria-describedby":"category-request-success-desc",children:O.jsxs("div",{className:"bg-white rounded-lg p-6 mx-4 text-center",children:[O.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),O.jsx("h3",{id:"category-request-success-title",className:"text-lg font-semibold text-gray-900 mb-2",children:"  !"}),O.jsx("p",{id:"category-request-success-desc",className:"text-gray-600",children:"  ."})]})}),O.jsxs("div",{className:"flex items-center justify-between px-8 py-4",children:[O.jsx("div",{className:"flex items-center",children:O.jsxs("svg",{width:"90",height:"28",viewBox:"0 0 90 28",fill:"none",children:[O.jsx("path",{d:"M67.8945 7.44597V4.56752H79.6163V7.44597H75.5525V9.61661C75.5525 10.6076 75.4585 11.4805 75.2706 12.2827C76.3276 13.722 78.7472 15.9634 80.4855 16.8835L79.123 19.8328C77.5726 19.0306 75.4115 17.1431 74.0726 15.2792C73.7907 15.751 73.4853 16.1993 73.1564 16.6712C72.2638 17.9453 70.2671 19.8328 68.9281 20.517L67.0019 17.8037C67.7771 17.4026 69.116 16.3409 70.0557 15.2792C71.5591 13.604 72.1228 12.0232 72.1228 9.73458V7.44597H67.8945ZM81.8244 3.55298H85.2306V10.7963H88.3548V14.0287H85.2306V23.8201H81.8244V3.55298Z",fill:"black"}),O.jsx("path",{d:"M51.7229 10.5604C55.0586 10.5604 57.4781 12.6838 57.4781 15.869C57.4781 19.0542 55.0586 21.154 51.7229 21.154C48.3638 21.154 45.9912 19.0778 45.9912 15.869C45.9912 12.6838 48.3638 10.5604 51.7229 10.5604ZM59.7332 23.8201V3.55296H63.1393V10.985H66.2636V14.2174H63.1393V23.8201H59.7332ZM45.0751 6.4786H50.1255L49.7732 3.48218H53.8371L53.4847 6.4786H58.3472V9.33347H45.0751V6.4786ZM51.7229 13.2029C50.1725 13.2029 49.1155 14.1938 49.1155 15.869C49.1155 17.5677 50.1725 18.5115 51.7229 18.5115C53.2733 18.5115 54.3304 17.5441 54.3304 15.869C54.3304 14.1938 53.2733 13.2029 51.7229 13.2029Z",fill:"black"}),O.jsx("path",{d:"M23.1718 14.4297H35.9507C36.2091 13.368 36.4675 11.6928 36.6319 10.0176C36.7259 9.05028 36.7729 7.87058 36.7963 6.78526H25.5679V3.85962H40.3434C40.3669 6.10104 40.2964 7.89418 40.1085 9.7581C39.8971 11.504 39.4743 13.3444 39.1219 14.4297H43.0683V17.3553H34.8936V24.693H31.2526V17.3553H23.1718V14.4297Z",fill:"black"}),O.jsx("path",{d:"M6.13102 2.93945H10.1009L9.84253 5.36963H13.8594V8.22449H9.81904V8.76715C9.81904 9.3334 9.72508 9.87606 9.56065 10.3951C10.9936 11.4569 13.1077 12.4714 14.3292 12.8253L13.5071 15.7745C11.9802 15.4206 9.70159 14.123 8.19819 12.7781C7.91631 13.132 7.58744 13.4623 7.25857 13.7927C6.01357 14.9959 4.18131 16.0813 2.67791 16.5059L1.57385 13.5331C2.46649 13.2028 3.82895 12.5658 4.74508 11.8108C5.91961 10.8434 6.41291 9.94684 6.41291 8.76715V8.22449H2.16112V5.36963H6.36593L6.13102 2.93945ZM8.40961 17.1194V21.4843H19.92V24.4807H4.95649V17.1194H8.40961ZM16.232 3.5529H19.6381V18.2519H16.232V3.5529Z",fill:"black"})]})}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("button",{type:"button",onClick:f,className:"px-3 py-1 border-2 border-orange-accent text-orange-accent font-crimson text-sm font-bold rounded hover:bg-orange-50 transition-colors",children:" "}),O.jsx("button",{type:"button",onClick:h,className:"p-3",title:"",children:O.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:[O.jsx("path",{d:"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z",stroke:"#EA8C4B",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),O.jsx("path",{d:"M19.4 15C19.2669 15.3016 19.2272 15.6362 19.286 15.9606C19.3448 16.285 19.4995 16.5843 19.73 16.82L19.79 16.88C19.976 17.0657 20.1235 17.2863 20.2241 17.5291C20.3248 17.7719 20.3766 18.0322 20.3766 18.295C20.3766 18.5578 20.3248 18.8181 20.2241 19.0609C20.1235 19.3037 19.976 19.5243 19.79 19.71C19.6043 19.896 19.3837 20.0435 19.1409 20.1441C18.8981 20.2448 18.6378 20.2966 18.375 20.2966C18.1122 20.2966 17.8519 20.2448 17.6091 20.1441C17.3663 20.0435 17.1457 19.896 16.96 19.71L16.9 19.65C16.6643 19.4195 16.365 19.2648 16.0406 19.206C15.7162 19.1472 15.3816 19.1869 15.08 19.32C14.7842 19.4468 14.532 19.6572 14.3543 19.9255C14.1766 20.1938 14.0813 20.5082 14.08 20.83V21C14.08 21.5304 13.8693 22.0391 13.4942 22.4142C13.1191 22.7893 12.6104 23 12.08 23C11.5496 23 11.0409 22.7893 10.6658 22.4142C10.2907 22.0391 10.08 21.5304 10.08 21V20.91C10.0723 20.579 9.96512 20.258 9.77251 19.9887C9.5799 19.7194 9.31074 19.5143 9 19.4C8.69838 19.2669 8.36381 19.2272 8.03941 19.286C7.71502 19.3448 7.41568 19.4995 7.18 19.73L7.12 19.79C6.93425 19.976 6.71368 20.1235 6.47088 20.2241C6.22808 20.3248 5.96783 20.3766 5.705 20.3766C5.44217 20.3766 5.18192 20.3248 4.93912 20.2241C4.69632 20.1235 4.47575 19.976 4.29 19.79C4.10405 19.6043 3.95653 19.3837 3.85588 19.1409C3.75523 18.8981 3.70343 18.6378 3.70343 18.375C3.70343 18.1122 3.75523 17.8519 3.85588 17.6091C3.95653 17.3663 4.10405 17.1457 4.29 16.96L4.35 16.9C4.58054 16.6643 4.73519 16.365 4.794 16.0406C4.85282 15.7162 4.81312 15.3816 4.68 15.08C4.55324 14.7842 4.34276 14.532 4.07447 14.3543C3.80618 14.1766 3.49179 14.0813 3.17 14.08H3C2.46957 14.08 1.96086 13.8693 1.58579 13.4942C1.21071 13.1191 1 12.6104 1 12.08C1 11.5496 1.21071 11.0409 1.58579 10.6658C1.96086 10.2907 2.46957 10.08 3 10.08H3.09C3.42099 10.0723 3.742 9.96512 4.0113 9.77251C4.28059 9.5799 4.48572 9.31074 4.6 9C4.73312 8.69838 4.77282 8.36381 4.714 8.03941C4.65519 7.71502 4.50054 7.41568 4.27 7.18L4.21 7.12C4.02405 6.93425 3.87653 6.71368 3.77588 6.47088C3.67523 6.22808 3.62343 5.96783 3.62343 5.705C3.62343 5.44217 3.67523 5.18192 3.77588 4.93912C3.87653 4.69632 4.02405 4.47575 4.21 4.29C4.39575 4.10405 4.61632 3.95653 4.85912 3.85588C5.10192 3.75523 5.36217 3.70343 5.625 3.70343C5.88783 3.70343 6.14808 3.75523 6.39088 3.85588C6.63368 3.95653 6.85425 4.10405 7.04 4.29L7.1 4.35C7.33568 4.58054 7.63502 4.73519 7.95941 4.794C8.28381 4.85282 8.61838 4.81312 8.92 4.68H9C9.29577 4.55324 9.54802 4.34276 9.72569 4.07447C9.90337 3.80618 9.99872 3.49179 10 3.17V3C10 2.46957 10.2107 1.96086 10.5858 1.58579C10.9609 1.21071 11.4696 1 12 1C12.5304 1 13.0391 1.21071 13.4142 1.58579C13.7893 1.96086 14 2.46957 14 3V3.09C14.0013 3.41179 14.0966 3.72618 14.2743 3.99447C14.452 4.26276 14.7042 4.47324 15 4.6C15.3016 4.73312 15.6362 4.77282 15.9606 4.714C16.285 4.65519 16.5843 4.50054 16.82 4.27L16.88 4.21C17.0657 4.02405 17.2863 3.87653 17.5291 3.77588C17.7719 3.67523 18.0322 3.62343 18.295 3.62343C18.5578 3.62343 18.8181 3.67523 19.0609 3.77588C19.3037 3.87653 19.5243 4.02405 19.71 4.21C19.896 4.39575 20.0435 4.61632 20.1441 4.85912C20.2448 5.10192 20.2966 5.36217 20.2966 5.625C20.2966 5.88783 20.2448 6.14808 20.1441 6.39088C20.0435 6.63368 19.896 6.85425 19.71 7.04L19.65 7.1C19.4195 7.33568 19.2648 7.63502 19.206 7.95941C19.1472 8.28381 19.1869 8.61838 19.32 8.92V9C19.4468 9.29577 19.6572 9.54802 19.9255 9.72569C20.1938 9.90337 20.5082 9.99872 20.83 10H21C21.5304 10 22.0391 10.2107 22.4142 10.5858C22.7893 10.9609 23 11.4696 23 12C23 12.5304 22.7893 13.0391 22.4142 13.4142C22.0391 13.7893 21.5304 14 21 14H20.91C20.5882 14.0013 20.2738 14.0966 20.0055 14.2743C19.7372 14.452 19.5268 14.7042 19.4 15V15Z",stroke:"#EA8C4B",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),O.jsx("div",{className:"px-8 mb-6",children:O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("div",{className:"relative",children:O.jsx("button",{onClick:()=>U(!M),className:"flex items-center gap-1 px-3 py-1 bg-white border border-grey-100 rounded",children:O.jsx("span",{className:"text-orange-accent font-crimson text-lg font-semibold",children:H?" ...":B})})}),O.jsx("span",{className:"text-grey-900 font-crimson text-lg font-bold",children:""})]})}),O.jsx("div",{className:"px-8 mb-8",children:O.jsx("h2",{className:"text-grey-900 font-crimson text-xl font-bold",children:"   !"})}),O.jsx("div",{className:"px-8",children:O.jsx("div",{className:"grid grid-cols-2 gap-6 mb-8",children:de.map(ye=>O.jsx("button",{onClick:()=>ue(ye.id),disabled:X,className:`relative h-32 border border-grey-100 rounded-2xl flex items-center justify-center px-4 xs:px-2 overflow-hidden transition-colors hover:shadow-md ${ye.id==="0"?"bg-orange-50":"bg-white"} ${P===ye.id?"border-orange-accent bg-orange-accent/5":""} ${X?"opacity-50 cursor-not-allowed":""}`,children:O.jsxs("div",{className:"flex items-center justify-center gap-3 xs:justify-between xs:w-full",children:[O.jsx("span",{className:"text-grey-900 font-crimson text-2xl xs:text-1.5xl font-bold whitespace-nowrap text-center pl-4",children:ye.name}),O.jsx("div",{className:"w-20 xs:w-16 flex items-center justify-center flex-shrink-0 pr-4",children:ye.icon})]})},ye.id))})}),w&&O.jsx("div",{className:"px-8 mb-4",children:O.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:O.jsx("p",{className:"text-red-600 font-crimson text-sm",children:w})})}),O.jsx("div",{className:"px-8 pb-12",children:O.jsx("div",{className:"h-24 relative",children:O.jsx("button",{onClick:Pe,disabled:!P||X,className:`w-full h-16 rounded-lg font-crimson text-2xl font-semibold text-white transition-all ${P&&!X?"bg-gradient-to-r from-yellow-300 to-red-gradient shadow-lg":"bg-gray-400 opacity-50 cursor-not-allowed"}`,children:X?" ...":" "})})})]})}const sne="modulepreload",one=function(u){return"/"+u},sj={},s0=function(h,f,g){let S=Promise.resolve();if(f&&f.length>0){let M=function(U){return Promise.all(U.map(B=>Promise.resolve(B).then(Y=>({status:"fulfilled",value:Y}),Y=>({status:"rejected",reason:Y}))))};var w=M;document.getElementsByTagName("link");const P=document.querySelector("meta[property=csp-nonce]"),k=P?.nonce||P?.getAttribute("nonce");S=M(f.map(U=>{if(U=one(U),U in sj)return;sj[U]=!0;const B=U.endsWith(".css"),Y=B?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${U}"]${Y}`))return;const H=document.createElement("link");if(H.rel=B?"stylesheet":sne,B||(H.as="script"),H.crossOrigin="",H.href=U,k&&H.setAttribute("nonce",k),document.head.appendChild(H),B)return new Promise((ie,X)=>{H.addEventListener("load",ie),H.addEventListener("error",()=>X(new Error(`Unable to preload CSS for ${U}`)))})}))}function C(P){const k=new Event("vite:preloadError",{cancelable:!0});if(k.payload=P,window.dispatchEvent(k),!k.defaultPrevented)throw P}return S.then(P=>{for(const k of P||[])k.status==="rejected"&&C(k.reason);return h().catch(C)})},oj={callId:null,matchingId:null,partner:null,agoraChannelInfo:null,isInCall:!1,isConnecting:!1,callStartTime:null,agoraState:{isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},error:null},aj=oF((u,h)=>({...oj,startCall:f=>{const g={id:String(f.partnerId),nickname:f.partnerNickname};u({callId:String(f.callId),matchingId:f.matchingId||null,partner:g,agoraChannelInfo:null,isInCall:!0,callStartTime:new Date,error:null})},endCall:()=>{const f=h();u({callId:f.callId,matchingId:null,partner:f.partner,agoraChannelInfo:null,isInCall:!1,isConnecting:!1,callStartTime:null,agoraState:{isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},error:null})},updateConnectingState:f=>{u({isConnecting:f})},updateAgoraState:f=>{u({agoraState:f})},setError:f=>{u({error:f})},reset:()=>{u(oj)},clearPartner:()=>{u({partner:null,callId:null})}}));var l0={exports:{}},ane=l0.exports,cj;function cne(){return cj||(cj=1,function(u,h){(function(f,g){u.exports=g()})(ane,function(){function f(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function S(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C=function(e){try{return!!e()}catch{return!0}},w=!C(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),P=w,k=Function.prototype,M=k.call,U=P&&k.bind.bind(M,M),B=P?U:function(e){return function(){return M.apply(e,arguments)}},Y=B({}.isPrototypeOf),H=function(e){return e&&e.Math===Math&&e},ie=H(typeof globalThis=="object"&&globalThis)||H(typeof window=="object"&&window)||H(typeof self=="object"&&self)||H(typeof g=="object"&&g)||H(typeof g=="object"&&g)||function(){return this}()||Function("return this")(),X=w,te=Function.prototype,ce=te.apply,Z=te.call,le=typeof Reflect=="object"&&Reflect.apply||(X?Z.bind(ce):function(){return Z.apply(ce,arguments)}),ne=B,de=ne({}.toString),Pe=ne("".slice),ue=function(e){return Pe(de(e),8,-1)},he=ue,ye=B,Ve=function(e){if(he(e)==="Function")return ye(e)},Je=typeof document=="object"&&document.all,Ue=Je===void 0&&Je!==void 0?function(e){return typeof e=="function"||e===Je}:function(e){return typeof e=="function"},xe={},Ge=!C(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),dt=w,Xe=Function.prototype.call,We=dt?Xe.bind(Xe):function(){return Xe.apply(Xe,arguments)},Ie={},De={}.propertyIsEnumerable,ze=Object.getOwnPropertyDescriptor,_e=ze&&!De.call({1:2},1);Ie.f=_e?function(e){var t=ze(this,e);return!!t&&t.enumerable}:De;var ke,ct,at=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ot=C,Gt=ue,yt=Object,pn=B("".split),vn=Ot(function(){return!yt("z").propertyIsEnumerable(0)})?function(e){return Gt(e)==="String"?pn(e,""):yt(e)}:yt,or=function(e){return e==null},hs=or,Ua=TypeError,Kr=function(e){if(hs(e))throw new Ua("Can't call method on "+e);return e},$d=vn,Fh=Kr,ps=function(e){return $d(Fh(e))},eu=Ue,pr=function(e){return typeof e=="object"?e!==null:eu(e)},Qr={},po=Qr,ki=ie,bl=Ue,Ms=function(e){return bl(e)?e:void 0},Ar=function(e,t){return arguments.length<2?Ms(po[e])||Ms(ki[e]):po[e]&&po[e][t]||ki[e]&&ki[e][t]},tu=ie.navigator,li=tu&&tu.userAgent,zr=li?String(li):"",Uc=ie,Il=zr,Us=Uc.process,Va=Uc.Deno,nu=Us&&Us.versions||Va&&Va.version,Vc=nu&&nu.v8;Vc&&(ct=(ke=Vc.split("."))[0]>0&&ke[0]<4?1:+(ke[0]+ke[1])),!ct&&Il&&(!(ke=Il.match(/Edge\/(\d+)/))||ke[1]>=74)&&(ke=Il.match(/Chrome\/(\d+)/))&&(ct=+ke[1]);var Ti=ct,ru=Ti,fo=C,iu=ie.String,mo=!!Object.getOwnPropertySymbols&&!fo(function(){var e=Symbol("symbol detection");return!iu(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ru&&ru<41}),jc=mo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Al=Ar,ja=Ue,_o=Y,Vs=Object,Fa=jc?function(e){return typeof e=="symbol"}:function(e){var t=Al("Symbol");return ja(t)&&_o(t.prototype,Vs(e))},Kt=String,fn=function(e){try{return Kt(e)}catch{return"Object"}},Fn=Ue,Ci=fn,Li=TypeError,Bn=function(e){if(Fn(e))return e;throw new Li(Ci(e)+" is not a function")},js=Bn,Zr=or,Xi=function(e,t){var n=e[t];return Zr(n)?void 0:js(n)},Ol=We,su=Ue,ou=pr,mm=TypeError,BE={exports:{}},WE=ie,U0=Object.defineProperty,Fc=ie,GE=function(e,t){try{U0(WE,e,{value:t,configurable:!0,writable:!0})}catch{WE[e]=t}return t},_m="__core-js_shared__",HE=BE.exports=Fc[_m]||GE(_m,{});(HE.versions||(HE.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Bh=BE.exports,gm=Bh,Bc=function(e,t){return gm[e]||(gm[e]=t||{})},KE=Kr,V0=Object,go=function(e){return V0(KE(e))},vr=go,j0=B({}.hasOwnProperty),fr=Object.hasOwn||function(e,t){return j0(vr(e),t)},zE=B,Wh=0,F0=Math.random(),YE=zE(1 .toString),Nl=function(e){return"Symbol("+(e===void 0?"":e)+")_"+YE(++Wh+F0,36)},Eo=Bc,qE=fr,Fs=Nl,B0=mo,W0=jc,Pl=ie.Symbol,Dl=Eo("wks"),Gh=W0?Pl.for||Pl:Pl&&Pl.withoutSetter||Fs,An=function(e){return qE(Dl,e)||(Dl[e]=B0&&qE(Pl,e)?Pl[e]:Gh("Symbol."+e)),Dl[e]},Hh=We,XE=pr,JE=Fa,Em=Xi,QE=function(e,t){var n,r;if(su(n=e.toString)&&!ou(r=Ol(n,e))||su(n=e.valueOf)&&!ou(r=Ol(n,e)))return r;throw new mm("Can't convert object to primitive value")},vm=TypeError,au=An("toPrimitive"),G0=function(e,t){if(!XE(e)||JE(e))return e;var n,r=Em(e,au);if(r){if(n=Hh(r,e,t),!XE(n)||JE(n))return n;throw new vm("Can't convert object to primitive value")}return QE(e)},Sm=Fa,On=function(e){var t=G0(e,"string");return Sm(t)?t:t+""},ym=pr,Kh=ie.document,Tm=ym(Kh)&&ym(Kh.createElement),zh=function(e){return Tm?Kh.createElement(e):{}},ZE=zh,Cm=!Ge&&!C(function(){return Object.defineProperty(ZE("div"),"a",{get:function(){return 7}}).a!==7}),Rm=Ge,Yh=We,Ba=Ie,Wa=at,Ga=ps,cu=On,lu=fr,Ha=Cm,$E=Object.getOwnPropertyDescriptor;xe.f=Rm?$E:function(e,t){if(e=Ga(e),t=cu(t),Ha)try{return $E(e,t)}catch{}if(lu(e,t))return Wa(!Yh(Ba.f,e,t),e[t])};var ev=C,du=Ue,H0=/#|\.prototype\./,kl=function(e,t){var n=tv[qh(e)];return n===uu||n!==K0&&(du(t)?ev(t):!!t)},qh=kl.normalize=function(e){return String(e).replace(H0,".").toLowerCase()},tv=kl.data={},K0=kl.NATIVE="N",uu=kl.POLYFILL="P",Ll=kl,xl=Bn,Xh=w,z0=Ve(Ve.bind),Ka=function(e,t){return xl(e),t===void 0?e:Xh?z0(e,t):function(){return e.apply(t,arguments)}},xi={},hu=Ge&&C(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),wm=pr,nv=String,za=TypeError,$r=function(e){if(wm(e))return e;throw new za(nv(e)+" is not an object")},Jh=Ge,rv=Cm,Qh=hu,Wc=$r,bm=On,Ji=TypeError,Ya=Object.defineProperty,Im=Object.getOwnPropertyDescriptor,Gc="enumerable",Am="configurable",pu="writable";xi.f=Jh?Qh?function(e,t,n){if(Wc(e),t=bm(t),Wc(n),typeof e=="function"&&t==="prototype"&&"value"in n&&pu in n&&!n[pu]){var r=Im(e,t);r&&r[pu]&&(e[t]=n.value,n={configurable:Am in n?n[Am]:r[Am],enumerable:Gc in n?n[Gc]:r[Gc],writable:!1})}return Ya(e,t,n)}:Ya:function(e,t,n){if(Wc(e),t=bm(t),Wc(n),rv)try{return Ya(e,t,n)}catch{}if("get"in n||"set"in n)throw new Ji("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Om=xi,fu=at,vo=Ge?function(e,t,n){return Om.f(e,t,fu(1,n))}:function(e,t,n){return e[t]=n,e},Ml=ie,Y0=le,q0=Ve,X0=Ue,Nm=xe.f,J0=Ll,Ul=Qr,Q0=Ka,Vl=vo,iv=fr,sv=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return Y0(e,this,arguments)};return t.prototype=e.prototype,t},qt=function(e,t){var n,r,i,s,o,c,l,p,m,E=e.target,v=e.global,y=e.stat,D=e.proto,A=v?Ml:y?Ml[E]:Ml[E]&&Ml[E].prototype,N=v?Ul:Ul[E]||Vl(Ul,E,{})[E],j=N.prototype;for(s in t)r=!(n=J0(v?s:E+(y?".":"#")+s,e.forced))&&A&&iv(A,s),c=N[s],r&&(l=e.dontCallGetSet?(m=Nm(A,s))&&m.value:A[s]),o=r&&l?l:t[s],(n||D||typeof c!=typeof o)&&(p=e.bind&&r?Q0(o,Ml):e.wrap&&r?sv(o):D&&X0(o)?q0(o):o,(e.sham||o&&o.sham||c&&c.sham)&&Vl(p,"sham",!0),Vl(N,s,p),D&&(iv(Ul,i=E+"Prototype")||Vl(Ul,i,{}),Vl(Ul[i],s,o),e.real&&j&&(n||!j[s])&&Vl(j,s,o)))},Z0=Math.ceil,$0=Math.floor,eC=Math.trunc||function(e){var t=+e;return(t>0?$0:Z0)(t)},Pm=eC,Dm=function(e){var t=+e;return t!=t||t===0?0:Pm(t)},tC=Dm,nC=Math.max,ov=Math.min,km=function(e,t){var n=tC(e);return n<0?nC(n+t,0):ov(n,t)},rC=Dm,iC=Math.min,av=function(e){var t=rC(e);return t>0?iC(t,9007199254740991):0},sC=av,qa=function(e){return sC(e.length)},oC=ps,Lm=km,mu=qa,cv=function(e){return function(t,n,r){var i=oC(t),s=mu(i);if(s===0)return!e&&-1;var o,c=Lm(r,s);if(e&&n!=n){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},Zh={includes:cv(!0),indexOf:cv(!1)},lv=Zh.includes;qt({target:"Array",proto:!0,forced:C(function(){return!Array(1).includes()})},{includes:function(e){return lv(this,e,arguments.length>1?arguments[1]:void 0)}});var dv=ie,uv=Qr,Qi=function(e,t){var n=uv[e+"Prototype"],r=n&&n[t];if(r)return r;var i=dv[e],s=i&&i.prototype;return s&&s[t]},jl=Qi("Array","includes"),aC=pr,cC=ue,lC=An("match"),xm=function(e){var t;return aC(e)&&((t=e[lC])!==void 0?!!t:cC(e)==="RegExp")},hv=xm,_u=TypeError,Fl={};Fl[An("toStringTag")]="z";var Mm=String(Fl)==="[object z]",$h=Mm,dC=Ue,gu=ue,Um=An("toStringTag"),Vm=Object,pv=gu(function(){return arguments}())==="Arguments",Xo=$h?gu:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(i,s){try{return i[s]}catch{}}(t=Vm(e),Um))=="string"?n:pv?gu(t):(r=gu(t))==="Object"&&dC(t.callee)?"Arguments":r},fv=Xo,uC=String,Mi=function(e){if(fv(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return uC(e)},hC=An("match"),pC=qt,fC=function(e){if(hv(e))throw new _u("The method doesn't accept regular expressions");return e},Bs=Kr,Bl=Mi,mv=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[hC]=!1,"/./"[e](t)}catch{}}return!1},_v=B("".indexOf);pC({target:"String",proto:!0,forced:!mv("includes")},{includes:function(e){return!!~_v(Bl(Bs(this)),Bl(fC(e)),arguments.length>1?arguments[1]:void 0)}});var gv=Qi("String","includes"),jm=Y,Fm=jl,mC=gv,Bm=Array.prototype,Xa=String.prototype,Wm=function(e){var t=e.includes;return e===Bm||jm(Bm,e)&&t===Bm.includes?Fm:typeof e=="string"||e===Xa||jm(Xa,e)&&t===Xa.includes?mC:t},Ae=S(Wm),Gm=Bn,Ev=go,ep=vn,Wl=qa,tp=TypeError,Hm="Reduce of empty array with no initial value",np=function(e){return function(t,n,r,i){var s=Ev(t),o=ep(s),c=Wl(s);if(Gm(n),c===0&&r<2)throw new tp(Hm);var l=e?c-1:0,p=e?-1:1;if(r<2)for(;;){if(l in o){i=o[l],l+=p;break}if(l+=p,e?l<0:c<=l)throw new tp(Hm)}for(;e?l>=0:c>l;l+=p)l in o&&(i=n(i,o[l],l,s));return i}},vv={left:np(!1)},Sv=C,Eu=function(e,t){var n=[][e];return!!n&&Sv(function(){n.call(null,t||function(){return 1},1)})},Gl=ie,yv=zr,Tv=ue,Ws=function(e){return yv.slice(0,e.length)===e},vu=Ws("Bun/")?"BUN":Ws("Cloudflare-Workers")?"CLOUDFLARE":Ws("Deno/")?"DENO":Ws("Node.js/")?"NODE":Gl.Bun&&typeof Bun.version=="string"?"BUN":Gl.Deno&&typeof Deno.version=="object"?"DENO":Tv(Gl.process)==="process"?"NODE":Gl.window&&Gl.document?"BROWSER":"REST",Hl=vu==="NODE",_C=vv.left;qt({target:"Array",proto:!0,forced:!Hl&&Ti>79&&Ti<83||!Eu("reduce")},{reduce:function(e){var t=arguments.length;return _C(this,e,t,t>1?arguments[1]:void 0)}});var gC=Qi("Array","reduce"),Su=Y,EC=gC,rp=Array.prototype,Cv=function(e){var t=e.reduce;return e===rp||Su(rp,e)&&t===rp.reduce?EC:t},zn=Cv,Ui=S(zn),ip=ue,Jo=Array.isArray||function(e){return ip(e)==="Array"},Rv=qt,Km=Jo,yu=B([].reverse),Tu=[1,2];Rv({target:"Array",proto:!0,forced:String(Tu)===String(Tu.reverse())},{reverse:function(){return Km(this)&&(this.length=this.length),yu(this)}});var Kl=Qi("Array","reverse"),wv=Y,vC=Kl,zm=Array.prototype,bv=function(e){var t=e.reverse;return e===zm||wv(zm,e)&&t===zm.reverse?vC:t},Cu=bv,Ru=S(Cu),Ym=Nl,sp=Bc("keys"),zl=function(e){return sp[e]||(sp[e]=Ym(e))},qm=!C(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),SC=fr,Iv=Ue,yC=go,TC=qm,op=zl("IE_PROTO"),So=Object,Av=So.prototype,Ja=TC?So.getPrototypeOf:function(e){var t=yC(e);if(SC(t,op))return t[op];var n=t.constructor;return Iv(n)&&t instanceof n?n.prototype:t instanceof So?Av:null},yo=B,wu=Bn,Qo=pr,Xm=function(e){return Qo(e)||e===null},CC=String,RC=TypeError,Hc=function(e,t,n){try{return yo(wu(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},bu=pr,Yl=Kr,ap=function(e){if(Xm(e))return e;throw new RC("Can't set "+CC(e)+" as a prototype")},Jm=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Hc(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return Yl(r),ap(i),bu(r)&&(t?e(r,i):r.__proto__=i),r}}():void 0),Zo={},Gs={},Wn=fr,Yn=ps,Qa=Zh.indexOf,di=Gs,Ri=B([].push),Za=function(e,t){var n,r=Yn(e),i=0,s=[];for(n in r)!Wn(di,n)&&Wn(r,n)&&Ri(s,n);for(;t.length>i;)Wn(r,n=t[i++])&&(~Qa(s,n)||Ri(s,n));return s},$a=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Vi=Za,cp=$a.concat("length","prototype");Zo.f=Object.getOwnPropertyNames||function(e){return Vi(e,cp)};var ql={};ql.f=Object.getOwnPropertySymbols;var Ov=Ar,lp=Zo,Nv=ql,$o=$r,dp=B([].concat),Qm=Ov("Reflect","ownKeys")||function(e){var t=lp.f($o(e)),n=Nv.f;return n?dp(t,n(e)):t},Zm=fr,wC=Qm,ec=xe,Xl=xi,tc={},up=Za,hp=$a,wi=Object.keys||function(e){return up(e,hp)},fs=Ge,Kc=hu,ea=xi,ta=$r,zc=ps,Pv=wi;tc.f=fs&&!Kc?Object.defineProperties:function(e,t){ta(e);for(var n,r=zc(t),i=Pv(t),s=i.length,o=0;s>o;)ea.f(e,n=i[o++],r[n]);return e};var Jl,pp=Ar("document","documentElement"),Zi=$r,$i=tc,Zn=$a,Hs=Gs,Dv=pp,kv=zh,Iu="prototype",Au="script",$m=zl("IE_PROTO"),Ql=function(){},e_=function(e){return"<"+Au+">"+e+"</"+Au+">"},Yc=function(e){e.write(e_("")),e.close();var t=e.parentWindow.Object;return e=null,t},Zl=function(){try{Jl=new ActiveXObject("htmlfile")}catch{}var e,t,n;Zl=typeof document<"u"?document.domain&&Jl?Yc(Jl):(t=kv("iframe"),n="java"+Au+":",t.style.display="none",Dv.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(e_("document.F=Object")),e.close(),e.F):Yc(Jl);for(var r=Zn.length;r--;)delete Zl[Iu][Zn[r]];return Zl()};Hs[$m]=!0;var Ou=Object.create||function(e,t){var n;return e!==null?(Ql[Iu]=Zi(e),n=new Ql,Ql[Iu]=null,n[$m]=e):n=Zl(),t===void 0?n:$i.f(n,t)},Nu=pr,fp=vo,t_=Error,Lv=B("".replace),$l=String(new t_("zxcasd").stack),n_=/\n\s*at [^:]*:[^\n]*/,mp=n_.test($l),_p=at,ed=!C(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",_p(1,7)),e.stack!==7)}),r_=vo,i_=function(e,t){if(mp&&typeof e=="string"&&!t_.prepareStackTrace)for(;t--;)e=Lv(e,n_,"");return e},s_=ed,gp=Error.captureStackTrace,Ks={},ms=Ks,qc=An("iterator"),o_=Array.prototype,a_=function(e){return e!==void 0&&(ms.Array===e||o_[qc]===e)},na=Xo,ra=Xi,c_=or,xv=Ks,ia=An("iterator"),zs=function(e){if(!c_(e))return ra(e,ia)||ra(e,"@@iterator")||xv[na(e)]},Ep=We,Mv=Bn,vp=$r,Uv=fn,Pu=zs,To=TypeError,Xc=function(e,t){var n=arguments.length<2?Pu(e):t;if(Mv(n))return vp(Ep(n,e));throw new To(Uv(e)+" is not iterable")},Du=We,nc=$r,l_=Xi,Jc=function(e,t,n){var r,i;nc(e);try{if(!(r=l_(e,"return"))){if(t==="throw")throw n;return n}r=Du(r,e)}catch(s){i=!0,r=s}if(t==="throw")throw n;if(i)throw r;return nc(r),n},Vv=Ka,d_=We,ar=$r,Sp=fn,u_=a_,h_=qa,ku=Y,p_=Xc,Qc=zs,rr=Jc,xr=TypeError,Sr=function(e,t){this.stopped=e,this.result=t},Lu=Sr.prototype,sa=function(e,t,n){var r,i,s,o,c,l,p,m=n&&n.that,E=!(!n||!n.AS_ENTRIES),v=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),D=!(!n||!n.INTERRUPTED),A=Vv(t,m),N=function(V){return r&&rr(r,"normal",V),new Sr(!0,V)},j=function(V){return E?(ar(V),D?A(V[0],V[1],N):A(V[0],V[1])):D?A(V,N):A(V)};if(v)r=e.iterator;else if(y)r=e;else{if(!(i=Qc(e)))throw new xr(Sp(e)+" is not iterable");if(u_(i)){for(s=0,o=h_(e);o>s;s++)if((c=j(e[s]))&&ku(Lu,c))return c;return new Sr(!1)}r=p_(e,i)}for(l=v?e.next:r.next;!(p=d_(l,r)).done;){try{c=j(p.value)}catch(V){rr(r,"throw",V)}if(typeof c=="object"&&c&&ku(Lu,c))return c}return new Sr(!1)},xu=Mi,bC=qt,ui=Y,f_=Ja,td=Jm,m_=function(e,t,n){for(var r=wC(t),i=Xl.f,s=ec.f,o=0;o<r.length;o++){var c=r[o];Zm(e,c)||n&&Zm(n,c)||i(e,c,s(t,c))}},Ys=Ou,ji=vo,Zc=at,__=function(e,t){Nu(t)&&"cause"in t&&fp(e,"cause",t.cause)},g_=function(e,t,n,r){s_&&(gp?gp(e,t):r_(e,"stack",i_(n,r)))},jv=sa,Fv=function(e,t){return e===void 0?arguments.length<2?"":t:xu(e)},Bv=An("toStringTag"),Mu=Error,Wv=[].push,$c=function(e,t){var n,r=ui(yp,this);td?n=td(new Mu,r?f_(this):yp):(n=r?this:Ys(yp),ji(n,Bv,"Error")),t!==void 0&&ji(n,"message",Fv(t)),g_(n,$c,n.stack,1),arguments.length>2&&__(n,arguments[2]);var i=[];return jv(e,Wv,{that:i}),ji(n,"errors",i),n};td?td($c,Mu):m_($c,Mu,{name:!0});var yp=$c.prototype=Ys(Mu.prototype,{constructor:Zc(1,$c),message:Zc(1,""),name:Zc(1,"AggregateError")});bC({global:!0},{AggregateError:$c});var Uu,oa,Vu,Tp=Ue,ju=ie.WeakMap,Gv=Tp(ju)&&/native code/.test(String(ju)),Cp=ie,Hv=pr,Kv=vo,Rp=fr,wp=Bh,E_=zl,zv=Gs,v_="Object already initialized",bp=Cp.TypeError,IC=Cp.WeakMap;if(Gv||wp.state){var qs=wp.state||(wp.state=new IC);qs.get=qs.get,qs.has=qs.has,qs.set=qs.set,Uu=function(e,t){if(qs.has(e))throw new bp(v_);return t.facade=e,qs.set(e,t),t},oa=function(e){return qs.get(e)||{}},Vu=function(e){return qs.has(e)}}else{var nd=E_("state");zv[nd]=!0,Uu=function(e,t){if(Rp(e,nd))throw new bp(v_);return t.facade=e,Kv(e,nd,t),t},oa=function(e){return Rp(e,nd)?e[nd]:{}},Vu=function(e){return Rp(e,nd)}}var el,S_,y_,rc={set:Uu,get:oa,has:Vu,enforce:function(e){return Vu(e)?oa(e):Uu(e,{})},getterFor:function(e){return function(t){var n;if(!Hv(t)||(n=oa(t)).type!==e)throw new bp("Incompatible receiver, "+e+" required");return n}}},rd=Ge,AC=fr,Yv=Function.prototype,OC=rd&&Object.getOwnPropertyDescriptor,_s=AC(Yv,"name"),Ip={PROPER:_s&&(function(){}).name==="something",CONFIGURABLE:_s&&(!rd||rd&&OC(Yv,"name").configurable)},Ap=vo,aa=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Ap(e,t,n),e},qv=C,Xv=Ue,T_=pr,id=Ou,Op=Ja,C_=aa,R_=An("iterator"),w_=!1;[].keys&&("next"in(y_=[].keys())?(S_=Op(Op(y_)))!==Object.prototype&&(el=S_):w_=!0);var Jv=!T_(el)||qv(function(){var e={};return el[R_].call(e)!==e});Xv((el=Jv?{}:id(el))[R_])||C_(el,R_,function(){return this});var b_={IteratorPrototype:el,BUGGY_SAFARI_ITERATORS:w_},Qv=Xo,Zv=Mm?{}.toString:function(){return"[object "+Qv(this)+"]"},NC=Mm,Fi=xi.f,bi=vo,$v=fr,eS=Zv,I_=An("toStringTag"),Co=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&($v(i,I_)||Fi(i,I_,{configurable:!0,value:t}),r&&!NC&&bi(i,"toString",eS))},tS=b_.IteratorPrototype,A_=Ou,nS=at,O_=Co,rS=Ks,iS=function(){return this},Fu=function(e,t,n,r){var i=t+" Iterator";return e.prototype=A_(tS,{next:nS(+!r,n)}),O_(e,i,!1,!0),rS[i]=iS,e},N_=qt,sS=We,P_=Ip,Np=Fu,PC=Ja,oS=Co,Pp=aa,D_=Ks,Dp=b_,ca=P_.PROPER,kp=Dp.BUGGY_SAFARI_ITERATORS,Lp=An("iterator"),xp="keys",Bu="values",k_="entries",Wu=function(){return this},ei=function(e,t,n,r,i,s,o){Np(n,t,r);var c,l,p,m=function(j){if(j===i&&A)return A;if(!kp&&j&&j in y)return y[j];switch(j){case xp:case Bu:case k_:return function(){return new n(this,j)}}return function(){return new n(this)}},E=t+" Iterator",v=!1,y=e.prototype,D=y[Lp]||y["@@iterator"]||i&&y[i],A=!kp&&D||m(i),N=t==="Array"&&y.entries||D;if(N&&(c=PC(N.call(new e)))!==Object.prototype&&c.next&&(oS(c,E,!0,!0),D_[E]=Wu),ca&&i===Bu&&D&&D.name!==Bu&&(v=!0,A=function(){return sS(D,this)}),i)if(l={values:m(Bu),keys:s?A:m(xp),entries:m(k_)},o)for(p in l)(kp||v||!(p in y))&&Pp(y,p,l[p]);else N_({target:t,proto:!0,forced:kp||v},l);return o&&y[Lp]!==A&&Pp(y,Lp,A,{}),D_[t]=A,l},Mp=function(e,t){return{value:e,done:t}},DC=ps,Gu=Ks,ti=rc;xi.f;var kC=ei,Et=Mp,tl="Array Iterator",L_=ti.set,aS=ti.getterFor(tl);kC(Array,"Array",function(e,t){L_(this,{type:tl,target:DC(e),index:0,kind:t})},function(){var e=aS(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Et(void 0,!0);switch(e.kind){case"keys":return Et(n,!1);case"values":return Et(t[n],!1)}return Et([n,t[n]],!1)},"values"),Gu.Arguments=Gu.Array;var LC=xi,ic=function(e,t,n){return LC.f(e,t,n)},Up=Ar,x_=ic,cS=Ge,M_=An("species"),lS=Y,U_=TypeError,Hu=function(e,t){if(lS(t,e))return e;throw new U_("Incorrect invocation")},ni=Ue,es=Bh,sc=B(Function.toString);ni(es.inspectSource)||(es.inspectSource=function(e){return sc(e)});var V_=es.inspectSource,dS=B,Xs=C,j_=Ue,Ro=Xo,xC=V_,F_=function(){},B_=Ar("Reflect","construct"),Vp=/^\s*(?:class|function)\b/,uS=dS(Vp.exec),MC=!Vp.test(F_),oc=function(e){if(!j_(e))return!1;try{return B_(F_,[],e),!0}catch{return!1}},jp=function(e){if(!j_(e))return!1;switch(Ro(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return MC||!!uS(Vp,xC(e))}catch{return!0}};jp.sham=!0;var hi,ln,Mr,mr,Or=!B_||Xs(function(){var e;return oc(oc.call)||!oc(Object)||!oc(function(){e=!0})||e})?jp:oc,ts=Or,sd=fn,Ur=TypeError,od=$r,nl=function(e){if(ts(e))return e;throw new Ur(sd(e)+" is not a constructor")},Fp=or,W_=An("species"),rl=function(e,t){var n,r=od(e).constructor;return r===void 0||Fp(n=od(r)[W_])?t:nl(n)},yr=B([].slice),G_=TypeError,gs=function(e,t){if(e<t)throw new G_("Not enough arguments");return e},wo=/(?:ipad|iphone|ipod).*applewebkit/i.test(zr),pi=ie,H_=le,ac=Ka,Ku=Ue,cc=fr,zu=C,ad=pp,K_=yr,Yu=zh,Bp=gs,Ii=wo,lc=Hl,ns=pi.setImmediate,fi=pi.clearImmediate,hS=pi.process,qu=pi.Dispatch,z_=pi.Function,pS=pi.MessageChannel,dc=pi.String,Wp=0,il={},uc="onreadystatechange";zu(function(){hi=pi.location});var Xu=function(e){if(cc(il,e)){var t=il[e];delete il[e],t()}},la=function(e){return function(){Xu(e)}},Y_=function(e){Xu(e.data)},q_=function(e){pi.postMessage(dc(e),hi.protocol+"//"+hi.host)};ns&&fi||(ns=function(e){Bp(arguments.length,1);var t=Ku(e)?e:z_(e),n=K_(arguments,1);return il[++Wp]=function(){H_(t,void 0,n)},ln(Wp),Wp},fi=function(e){delete il[e]},lc?ln=function(e){hS.nextTick(la(e))}:qu&&qu.now?ln=function(e){qu.now(la(e))}:pS&&!Ii?(mr=(Mr=new pS).port2,Mr.port1.onmessage=Y_,ln=ac(mr.postMessage,mr)):pi.addEventListener&&Ku(pi.postMessage)&&!pi.importScripts&&hi&&hi.protocol!=="file:"&&!zu(q_)?(ln=q_,pi.addEventListener("message",Y_,!1)):ln=uc in Yu("script")?function(e){ad.appendChild(Yu("script"))[uc]=function(){ad.removeChild(this),Xu(e)}}:function(e){setTimeout(la(e),0)});var cd={set:ns,clear:fi},Ju=ie,UC=Ge,VC=Object.getOwnPropertyDescriptor,X_=function(e){if(!UC)return Ju[e];var t=VC(Ju,e);return t&&t.value},J_=function(){this.head=null,this.tail=null};J_.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Es,Q_,hc,Gp,cr,fS=J_,mS=/ipad|iphone|ipod/i.test(zr)&&typeof Pebble<"u",jC=/web0s(?!.*chrome)/i.test(zr),ld=ie,_S=X_,Z_=Ka,$_=cd.set,vs=fS,eg=wo,FC=mS,pc=jC,dd=Hl,fc=ld.MutationObserver||ld.WebKitMutationObserver,Qu=ld.document,Hp=ld.process,ud=ld.Promise,tg=_S("queueMicrotask");if(!tg){var hd=new vs,Kp=function(){var e,t;for(dd&&(e=Hp.domain)&&e.exit();t=hd.get();)try{t()}catch(n){throw hd.head&&Es(),n}e&&e.enter()};eg||dd||pc||!fc||!Qu?!FC&&ud&&ud.resolve?((Gp=ud.resolve(void 0)).constructor=ud,cr=Z_(Gp.then,Gp),Es=function(){cr(Kp)}):dd?Es=function(){Hp.nextTick(Kp)}:($_=Z_($_,ld),Es=function(){$_(Kp)}):(Q_=!0,hc=Qu.createTextNode(""),new fc(Kp).observe(hc,{characterData:!0}),Es=function(){hc.data=Q_=!Q_}),tg=function(e){hd.head||Es(),hd.add(e)}}var ng=tg,sl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},bo=ie.Promise,zp=ie,pd=bo,rg=Ue,BC=Ll,gS=V_,ig=An,Zu=vu,$u=Ti,eh=pd&&pd.prototype,ES=ig("species"),vS=rg(zp.PromiseRejectionEvent),Yp=BC("Promise",function(){var e=gS(pd),t=e!==String(pd);if(!t&&$u===66||!eh.catch||!eh.finally)return!0;if(!$u||$u<51||!/native code/.test(e)){var n=new pd(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[ES]=r,!(n.then(function(){})instanceof r))return!0}return!(t||Zu!=="BROWSER"&&Zu!=="DENO"||vS)}),th={CONSTRUCTOR:Yp,REJECTION_EVENT:vS},Bi={},SS=Bn,qp=TypeError,a=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw new qp("Bad Promise constructor");t=r,n=i}),this.resolve=SS(t),this.reject=SS(n)};Bi.f=function(e){return new a(e)};var d,_,T=qt,I=Hl,L=ie,q=We,oe=aa,me=Co,Le=function(e){var t=Up(e);cS&&t&&!t[M_]&&x_(t,M_,{configurable:!0,get:function(){return this}})},Ze=Bn,$e=Ue,Qe=pr,_t=Hu,Tt=rl,Rt=cd.set,lr=ng,Ce=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ge=sl,Oe=fS,nt=rc,wt=bo,Dt=th,kt=Bi,Vt="Promise",Vr=Dt.CONSTRUCTOR,wn=Dt.REJECTION_EVENT,Io=nt.getterFor(Vt),WC=nt.set,OF=wt&&wt.prototype,sg=wt,GC=OF,$A=L.TypeError,HC=L.document,KC=L.process,zC=kt.f,NF=zC,PF=!!(HC&&HC.createEvent&&L.dispatchEvent),eO="unhandledrejection",tO=function(e){var t;return!(!Qe(e)||!$e(t=e.then))&&t},nO=function(e,t){var n,r,i,s=t.value,o=t.state===1,c=o?e.ok:e.fail,l=e.resolve,p=e.reject,m=e.domain;try{c?(o||(t.rejection===2&&kF(t),t.rejection=1),c===!0?n=s:(m&&m.enter(),n=c(s),m&&(m.exit(),i=!0)),n===e.promise?p(new $A("Promise-chain cycle")):(r=tO(n))?q(r,n,l,p):l(n)):p(s)}catch(E){m&&!i&&m.exit(),p(E)}},rO=function(e,t){e.notified||(e.notified=!0,lr(function(){for(var n,r=e.reactions;n=r.get();)nO(n,e);e.notified=!1,t&&!e.rejection&&DF(e)}))},iO=function(e,t,n){var r,i;PF?((r=HC.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),L.dispatchEvent(r)):r={promise:t,reason:n},!wn&&(i=L["on"+e])?i(r):e===eO&&Ce("Unhandled promise rejection",n)},DF=function(e){q(Rt,L,function(){var t,n=e.facade,r=e.value;if(sO(e)&&(t=ge(function(){I?KC.emit("unhandledRejection",r,n):iO(eO,n,r)}),e.rejection=I||sO(e)?2:1,t.error))throw t.value})},sO=function(e){return e.rejection!==1&&!e.parent},kF=function(e){q(Rt,L,function(){var t=e.facade;I?KC.emit("rejectionHandled",t):iO("rejectionhandled",t,e.value)})},Xp=function(e,t,n){return function(r){e(t,r,n)}},Jp=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,rO(e,!0))},YC=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new $A("Promise can't be resolved itself");var r=tO(t);r?lr(function(){var i={done:!1};try{q(r,t,Xp(YC,i,e),Xp(Jp,i,e))}catch(s){Jp(i,s,e)}}):(e.value=t,e.state=1,rO(e,!1))}catch(i){Jp({done:!1},i,e)}}};Vr&&(GC=(sg=function(e){_t(this,GC),Ze(e),q(d,this);var t=Io(this);try{e(Xp(YC,t),Xp(Jp,t))}catch(n){Jp(t,n)}}).prototype,(d=function(e){WC(this,{type:Vt,done:!1,notified:!1,parent:!1,reactions:new Oe,rejection:!1,state:0,value:null})}).prototype=oe(GC,"then",function(e,t){var n=Io(this),r=zC(Tt(this,sg));return n.parent=!0,r.ok=!$e(e)||e,r.fail=$e(t)&&t,r.domain=I?KC.domain:void 0,n.state===0?n.reactions.add(r):lr(function(){nO(r,n)}),r.promise}),_=function(){var e=new d,t=Io(e);this.promise=e,this.resolve=Xp(YC,t),this.reject=Xp(Jp,t)},kt.f=zC=function(e){return e===sg||e===void 0?new _(e):NF(e)}),T({global:!0,wrap:!0,forced:Vr},{Promise:sg}),me(sg,Vt,!1,!0),Le(Vt);var oO=An("iterator"),aO=!1;try{var LF=0,cO={next:function(){return{done:!!LF++}},return:function(){aO=!0}};cO[oO]=function(){return this},Array.from(cO,function(){throw 2})}catch{}var xF=bo,MF=function(e,t){try{if(!t&&!aO)return!1}catch{return!1}var n=!1;try{var r={};r[oO]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},yS=th.CONSTRUCTOR||!MF(function(e){xF.all(e).then(void 0,function(){})}),UF=We,VF=Bn,jF=Bi,FF=sl,BF=sa;qt({target:"Promise",stat:!0,forced:yS},{all:function(e){var t=this,n=jF.f(t),r=n.resolve,i=n.reject,s=FF(function(){var o=VF(t.resolve),c=[],l=0,p=1;BF(e,function(m){var E=l++,v=!1;p++,UF(o,t,m).then(function(y){v||(v=!0,c[E]=y,--p||r(c))},i)}),--p||r(c)});return s.error&&i(s.value),n.promise}});var WF=qt,GF=th.CONSTRUCTOR;bo&&bo.prototype,WF({target:"Promise",proto:!0,forced:GF,real:!0},{catch:function(e){return this.then(void 0,e)}});var HF=We,KF=Bn,zF=Bi,YF=sl,qF=sa;qt({target:"Promise",stat:!0,forced:yS},{race:function(e){var t=this,n=zF.f(t),r=n.reject,i=YF(function(){var s=KF(t.resolve);qF(e,function(o){HF(s,t,o).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var XF=Bi;qt({target:"Promise",stat:!0,forced:th.CONSTRUCTOR},{reject:function(e){var t=XF.f(this);return(0,t.reject)(e),t.promise}});var JF=$r,QF=pr,ZF=Bi,lO=function(e,t){if(JF(e),QF(t)&&t.constructor===e)return t;var n=ZF.f(e);return(0,n.resolve)(t),n.promise},$F=qt,e7=bo,t7=th.CONSTRUCTOR,n7=lO,r7=Ar("Promise"),i7=!t7;$F({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return n7(i7&&this===r7?e7:this,e)}});var s7=We,o7=Bn,a7=Bi,c7=sl,l7=sa;qt({target:"Promise",stat:!0,forced:yS},{allSettled:function(e){var t=this,n=a7.f(t),r=n.resolve,i=n.reject,s=c7(function(){var o=o7(t.resolve),c=[],l=0,p=1;l7(e,function(m){var E=l++,v=!1;p++,s7(o,t,m).then(function(y){v||(v=!0,c[E]={status:"fulfilled",value:y},--p||r(c))},function(y){v||(v=!0,c[E]={status:"rejected",reason:y},--p||r(c))})}),--p||r(c)});return s.error&&i(s.value),n.promise}});var d7=We,u7=Bn,h7=Ar,p7=Bi,f7=sl,m7=sa,dO="No one promise resolved";qt({target:"Promise",stat:!0,forced:yS},{any:function(e){var t=this,n=h7("AggregateError"),r=p7.f(t),i=r.resolve,s=r.reject,o=f7(function(){var c=u7(t.resolve),l=[],p=0,m=1,E=!1;m7(e,function(v){var y=p++,D=!1;m++,d7(c,t,v).then(function(A){D||E||(E=!0,i(A))},function(A){D||E||(D=!0,l[y]=A,--m||s(new n(l,dO)))})}),--m||s(new n(l,dO))});return o.error&&s(o.value),r.promise}});var _7=qt,g7=le,E7=yr,v7=Bi,S7=Bn,uO=sl,qC=ie.Promise,hO=!1;_7({target:"Promise",stat:!0,forced:!qC||!qC.try||uO(function(){qC.try(function(e){hO=e===8},8)}).error||!hO},{try:function(e){var t=arguments.length>1?E7(arguments,1):[],n=v7.f(this),r=uO(function(){return g7(S7(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var y7=Bi;qt({target:"Promise",stat:!0},{withResolvers:function(){var e=y7.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var T7=qt,XC=bo,C7=C,R7=Ar,w7=Ue,b7=rl,pO=lO,I7=XC&&XC.prototype;T7({target:"Promise",proto:!0,real:!0,forced:!!XC&&C7(function(){I7.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=b7(this,R7("Promise")),n=w7(e);return this.then(n?function(r){return pO(t,e()).then(function(){return r})}:e,n?function(r){return pO(t,e()).then(function(){throw r})}:e)}});var JC=B,A7=Dm,O7=Mi,N7=Kr,P7=JC("".charAt),fO=JC("".charCodeAt),D7=JC("".slice),mO=function(e){return function(t,n){var r,i,s=O7(N7(t)),o=A7(n),c=s.length;return o<0||o>=c?e?"":void 0:(r=fO(s,o))<55296||r>56319||o+1===c||(i=fO(s,o+1))<56320||i>57343?e?P7(s,o):r:e?D7(s,o,o+2):i-56320+(r-55296<<10)+65536}},QC={codeAt:mO(!1),charAt:mO(!0)},k7=QC.charAt,L7=Mi,_O=rc,x7=ei,gO=Mp,EO="String Iterator",M7=_O.set,U7=_O.getterFor(EO);x7(String,"String",function(e){M7(this,{type:EO,string:L7(e),index:0})},function(){var e,t=U7(this),n=t.string,r=t.index;return r>=n.length?gO(void 0,!0):(e=k7(n,r),t.index+=e.length,gO(e,!1))});var V7=Qr.Promise,j7={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},F7=ie,B7=Co,vO=Ks;for(var ZC in j7)B7(F7[ZC],ZC),vO[ZC]=vO.Array;var SO=V7,je=S(SO),W7=Qi("Array","values"),G7=Xo,H7=fr,K7=Y,z7=W7,$C=Array.prototype,Y7={DOMTokenList:!0,NodeList:!0},q7=function(e){var t=e.values;return e===$C||K7($C,e)&&t===$C.values||H7(Y7,G7(e))?z7:t},rs=S(q7),yO=fn,X7=TypeError,TO=yr,J7=Math.floor,eR=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var o=J7(n/2),c=eR(TO(e,0,o),t),l=eR(TO(e,o),t),p=c.length,m=l.length,E=0,v=0;E<p||v<m;)e[E+v]=E<p&&v<m?t(c[E],l[v])<=0?c[E++]:l[v++]:E<p?c[E++]:l[v++];return e},CO=eR,RO=zr.match(/firefox\/(\d+)/i),Q7=!!RO&&+RO[1],Z7=/MSIE|Trident/.test(zr),wO=zr.match(/AppleWebKit\/(\d+)\./),$7=!!wO&&+wO[1],e9=qt,bO=B,t9=Bn,n9=go,IO=qa,r9=function(e,t){if(!delete e[t])throw new X7("Cannot delete property "+yO(t)+" of "+yO(e))},AO=Mi,tR=C,i9=CO,s9=Eu,OO=Q7,o9=Z7,NO=Ti,PO=$7,fd=[],DO=bO(fd.sort),a9=bO(fd.push),c9=tR(function(){fd.sort(void 0)}),l9=tR(function(){fd.sort(null)}),d9=s9("sort"),kO=!tR(function(){if(NO)return NO<70;if(!(OO&&OO>3)){if(o9)return!0;if(PO)return PO<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)fd.push({k:t+r,v:n})}for(fd.sort(function(s,o){return o.v-s.v}),r=0;r<fd.length;r++)t=fd[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});e9({target:"Array",proto:!0,forced:c9||!l9||!d9||!kO},{sort:function(e){e!==void 0&&t9(e);var t=n9(this);if(kO)return e===void 0?DO(t):DO(t,e);var n,r,i=[],s=IO(t);for(r=0;r<s;r++)r in t&&a9(i,t[r]);for(i9(i,function(o){return function(c,l){return l===void 0?-1:c===void 0?1:o!==void 0?+o(c,l)||0:AO(c)>AO(l)?1:-1}}(e)),n=IO(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)r9(t,r++);return t}});var u9=Qi("Array","sort"),h9=Y,p9=u9,nR=Array.prototype,f9=function(e){var t=e.sort;return e===nR||h9(nR,e)&&t===nR.sort?p9:t},nh=S(f9),m9=qt,_9=B,g9=km,E9=RangeError,LO=String.fromCharCode,xO=String.fromCodePoint,v9=_9([].join);m9({target:"String",stat:!0,forced:!!xO&&xO.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],g9(t,1114111)!==t)throw new E9(t+" is not a valid code point");n[i]=t<65536?LO(t):LO(55296+((t-=65536)>>10),t%1024+56320)}return v9(n,"")}});var S9=C,y9=An("iterator"),TS=!S9(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,s){t.delete("b"),r+=s+i}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[y9]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),T9=aa,rR=qt,MO=ie,iR=X_,C9=Ar,CS=We,da=B,og=Ge,UO=TS,VO=aa,R9=ic,w9=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:T9(e,r,t[r],n);return e},b9=Co,I9=Fu,sR=rc,jO=Hu,oR=Ue,A9=fr,O9=Ka,N9=Xo,P9=$r,FO=pr,is=Mi,D9=Ou,BO=at,WO=Xc,k9=zs,RS=Mp,Qp=gs,L9=CO,x9=An("iterator"),Zp="URLSearchParams",GO=Zp+"Iterator",HO=sR.set,Ao=sR.getterFor(Zp),M9=sR.getterFor(GO),KO=iR("fetch"),wS=iR("Request"),ag=iR("Headers"),aR=wS&&wS.prototype,zO=ag&&ag.prototype,U9=MO.TypeError,V9=MO.encodeURIComponent,j9=String.fromCharCode,F9=C9("String","fromCodePoint"),B9=parseInt,bS=da("".charAt),YO=da([].join),md=da([].push),qO=da("".replace),W9=da([].shift),XO=da([].splice),JO=da("".split),QO=da("".slice),G9=da(/./.exec),H9=/\+/g,K9=/^[0-9a-f]+$/i,ZO=function(e,t){var n=QO(e,t,t+2);return G9(K9,n)?B9(n,16):NaN},z9=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},Y9=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},$O=function(e){for(var t=(e=qO(e,H9," ")).length,n="",r=0;r<t;){var i=bS(e,r);if(i==="%"){if(bS(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var s=ZO(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var o=z9(s);if(o===0)i=j9(s);else{if(o===1||o>4){n+="",r++;continue}for(var c=[s],l=1;l<o&&!(++r+3>t||bS(e,r)!=="%");){var p=ZO(e,r+1);if(p!=p){r+=3;break}if(p>191||p<128)break;md(c,p),r+=2,l++}if(c.length!==o){n+="";continue}var m=Y9(c);m===null?n+="":i=F9(m)}}n+=i,r++}return n},q9=/[!'()~]|%20/g,X9={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},J9=function(e){return X9[e]},eN=function(e){return qO(V9(e),q9,J9)},cR=I9(function(e,t){HO(this,{type:GO,target:Ao(e).entries,index:0,kind:t})},Zp,function(){var e=M9(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,RS(void 0,!0);var r=t[n];switch(e.kind){case"keys":return RS(r.key,!1);case"values":return RS(r.value,!1)}return RS([r.key,r.value],!1)},!0),tN=function(e){this.entries=[],this.url=null,e!==void 0&&(FO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?bS(e,0)==="?"?QO(e,1):e:is(e)))};tN.prototype={type:Zp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,o,c,l=this.entries,p=k9(e);if(p)for(n=(t=WO(e,p)).next;!(r=CS(n,t)).done;){if(s=(i=WO(P9(r.value))).next,(o=CS(s,i)).done||(c=CS(s,i)).done||!CS(s,i).done)throw new U9("Expected sequence with length 2");md(l,{key:is(o.value),value:is(c.value)})}else for(var m in e)A9(e,m)&&md(l,{key:m,value:is(e[m])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=JO(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=JO(t,"="),md(r,{key:$O(W9(n)),value:$O(YO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],md(n,eN(e.key)+"="+eN(e.value));return YO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var IS=function(){jO(this,$p);var e=HO(this,new tN(arguments.length>0?arguments[0]:void 0));og||(this.size=e.entries.length)},$p=IS.prototype;if(w9($p,{append:function(e,t){var n=Ao(this);Qp(arguments.length,2),md(n.entries,{key:is(e),value:is(t)}),og||this.length++,n.updateURL()},delete:function(e){for(var t=Ao(this),n=Qp(arguments.length,1),r=t.entries,i=is(e),s=n<2?void 0:arguments[1],o=s===void 0?s:is(s),c=0;c<r.length;){var l=r[c];if(l.key!==i||o!==void 0&&l.value!==o)c++;else if(XO(r,c,1),o!==void 0)break}og||(this.size=r.length),t.updateURL()},get:function(e){var t=Ao(this).entries;Qp(arguments.length,1);for(var n=is(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Ao(this).entries;Qp(arguments.length,1);for(var n=is(e),r=[],i=0;i<t.length;i++)t[i].key===n&&md(r,t[i].value);return r},has:function(e){for(var t=Ao(this).entries,n=Qp(arguments.length,1),r=is(e),i=n<2?void 0:arguments[1],s=i===void 0?i:is(i),o=0;o<t.length;){var c=t[o++];if(c.key===r&&(s===void 0||c.value===s))return!0}return!1},set:function(e,t){var n=Ao(this);Qp(arguments.length,1);for(var r,i=n.entries,s=!1,o=is(e),c=is(t),l=0;l<i.length;l++)(r=i[l]).key===o&&(s?XO(i,l--,1):(s=!0,r.value=c));s||md(i,{key:o,value:c}),og||(this.size=i.length),n.updateURL()},sort:function(){var e=Ao(this);L9(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Ao(this).entries,r=O9(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new cR(this,"keys")},values:function(){return new cR(this,"values")},entries:function(){return new cR(this,"entries")}},{enumerable:!0}),VO($p,x9,$p.entries,{}),VO($p,"toString",function(){return Ao(this).serialize()},{enumerable:!0}),og&&R9($p,"size",{get:function(){return Ao(this).entries.length},configurable:!0,enumerable:!0}),b9(IS,Zp),rR({global:!0,forced:!UO},{URLSearchParams:IS}),!UO&&oR(ag)){var Q9=da(zO.has),Z9=da(zO.set),nN=function(e){if(FO(e)){var t,n=e.body;if(N9(n)===Zp)return t=e.headers?new ag(e.headers):new ag,Q9(t,"content-type")||Z9(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),D9(e,{body:BO(0,is(n)),headers:BO(0,t)})}return e};if(oR(KO)&&rR({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return KO(e,arguments.length>1?nN(arguments[1]):{})}}),oR(wS)){var lR=function(e){return jO(this,aR),new wS(e,arguments.length>1?nN(arguments[1]):{})};aR.constructor=lR,lR.prototype=aR,rR({global:!0,dontCallGetSet:!0,forced:!0},{Request:lR})}}var Oo,$9={URLSearchParams:IS,getState:Ao},eB=Qr.URLSearchParams,rN=Ge,tB=B,nB=We,rB=C,dR=wi,iB=ql,sB=Ie,oB=go,aB=vn,ef=Object.assign,iN=Object.defineProperty,cB=tB([].concat),lB=!ef||rB(function(){if(rN&&ef({b:1},ef(iN({},"a",{enumerable:!0,get:function(){iN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),ef({},e)[n]!==7||dR(ef({},t)).join("")!==r})?function(e,t){for(var n=oB(e),r=arguments.length,i=1,s=iB.f,o=sB.f;r>i;)for(var c,l=aB(arguments[i++]),p=s?cB(dR(l),s(l)):dR(l),m=p.length,E=0;m>E;)c=p[E++],rN&&!nB(o,l,c)||(n[c]=l[c]);return n}:ef,dB=$r,uB=Jc,hB=Ge,pB=xi,fB=at,uR=function(e,t,n){hB?pB.f(e,t,fB(0,n)):e[t]=n},mB=Ka,_B=We,gB=go,EB=function(e,t,n,r){try{return r?t(dB(n)[0],n[1]):t(n)}catch(i){uB(e,"throw",i)}},vB=a_,SB=Or,yB=qa,sN=uR,TB=Xc,CB=zs,oN=Array,rh=B,hR=2147483647,RB=/[^\0-\u007E]/,aN=/[.\u3002\uFF0E\uFF61]/g,cN="Overflow: input needs wider integers to process",lN=RangeError,wB=rh(aN.exec),tf=Math.floor,pR=String.fromCharCode,dN=rh("".charCodeAt),uN=rh([].join),_d=rh([].push),bB=rh("".replace),IB=rh("".split),AB=rh("".toLowerCase),hN=function(e){return e+22+75*(e<26)},OB=function(e,t,n){var r=0;for(e=n?tf(e/700):e>>1,e+=tf(e/t);e>455;)e=tf(e/35),r+=36;return tf(r+36*e/(e+38))},NB=function(e){var t=[];e=function(j){for(var V=[],G=0,$=j.length;G<$;){var Q=dN(j,G++);if(Q>=55296&&Q<=56319&&G<$){var z=dN(j,G++);(64512&z)==56320?_d(V,((1023&Q)<<10)+(1023&z)+65536):(_d(V,Q),G--)}else _d(V,Q)}return V}(e);var n,r,i=e.length,s=128,o=0,c=72;for(n=0;n<e.length;n++)(r=e[n])<128&&_d(t,pR(r));var l=t.length,p=l;for(l&&_d(t,"-");p<i;){var m=hR;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<m&&(m=r);var E=p+1;if(m-s>tf((hR-o)/E))throw new lN(cN);for(o+=(m-s)*E,s=m,n=0;n<e.length;n++){if((r=e[n])<s&&++o>hR)throw new lN(cN);if(r===s){for(var v=o,y=36;;){var D=y<=c?1:y>=c+26?26:y-c;if(v<D)break;var A=v-D,N=36-D;_d(t,pR(hN(D+A%N))),v=tf(A/N),y+=36}_d(t,pR(hN(v))),c=OB(o,E,p===l),o=0,p++}}o++,s++}return uN(t,"")},PB=qt,fR=Ge,DB=TS,mR=ie,pN=Ka,No=B,AS=aa,Po=ic,kB=Hu,_R=fr,gR=lB,nf=function(e){var t=gB(e),n=SB(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=mB(i,r>2?arguments[2]:void 0));var o,c,l,p,m,E,v=CB(t),y=0;if(!v||this===oN&&vB(v))for(o=yB(t),c=n?new this(o):oN(o);o>y;y++)E=s?i(t[y],y):t[y],sN(c,y,E);else for(c=n?new this:[],m=(p=TB(t,v)).next;!(l=_B(m,p)).done;y++)E=s?EB(p,i,[l.value,y],!0):l.value,sN(c,y,E);return c.length=y,c},ua=yr,LB=QC.codeAt,xB=function(e){var t,n,r=[],i=IB(bB(AB(e),aN,"."),".");for(t=0;t<i.length;t++)n=i[t],_d(r,wB(RB,n)?"xn--"+NB(n):n);return uN(r,".")},ol=Mi,MB=Co,UB=gs,fN=$9,mN=rc,VB=mN.set,OS=mN.getterFor("URL"),jB=fN.URLSearchParams,FB=fN.getState,cg=mR.URL,ER=mR.TypeError,NS=mR.parseInt,BB=Math.floor,_N=Math.pow,Do=No("".charAt),ha=No(/./.exec),lg=No([].join),WB=No(1 .toString),GB=No([].pop),rf=No([].push),vR=No("".replace),HB=No([].shift),KB=No("".split),dg=No("".slice),PS=No("".toLowerCase),zB=No([].unshift),SR="Invalid scheme",ih="Invalid host",gN="Invalid port",EN=/[a-z]/i,YB=/[\d+-.a-z]/i,yR=/\d/,qB=/^0x/i,XB=/^[0-7]+$/,JB=/^\d+$/,vN=/^[\da-f]+$/i,QB=/[\0\t\n\r #%/:<>?@[\\\]^|]/,ZB=/[\0\t\n\r #/:<>?@[\\\]^|]/,$B=/^[\u0000-\u0020]+/,e2=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,t2=/[\t\n\r]/g,ug=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)zB(t,e%256),e=BB(e/256);return lg(t,".")}if(typeof e=="object"){for(t="",r=function(s){for(var o=null,c=1,l=null,p=0,m=0;m<8;m++)s[m]!==0?(p>c&&(o=l,c=p),l=null,p=0):(l===null&&(l=m),++p);return p>c?l:o}(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=WB(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},DS={},SN=gR({},DS,{" ":1,'"':1,"<":1,">":1,"`":1}),yN=gR({},SN,{"#":1,"?":1,"{":1,"}":1}),TR=gR({},yN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),gd=function(e,t){var n=LB(e,0);return n>32&&n<127&&!_R(t,e)?e:encodeURIComponent(e)},kS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hg=function(e,t){var n;return e.length===2&&ha(EN,Do(e,0))&&((n=Do(e,1))===":"||!t&&n==="|")},TN=function(e){var t;return e.length>1&&hg(dg(e,0,2))&&(e.length===2||(t=Do(e,2))==="/"||t==="\\"||t==="?"||t==="#")},n2=function(e){return e==="."||PS(e)==="%2e"},CR={},CN={},RR={},RN={},wN={},wR={},bN={},IN={},LS={},xS={},bR={},IR={},AR={},OR={},AN={},NR={},sf={},mc={},ON={},sh={},al={},PR=function(e,t,n){var r,i,s,o=ol(e);if(t){if(i=this.parse(o))throw new ER(i);this.searchParams=null}else{if(n!==void 0&&(r=new PR(n,!0)),i=this.parse(o,null,r))throw new ER(i);(s=FB(new jB)).bindURL(this),this.searchParams=s}};PR.prototype={type:"URL",parse:function(e,t,n){var r,i,s,o,c,l=this,p=t||CR,m=0,E="",v=!1,y=!1,D=!1;for(e=ol(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=vR(e,$B,""),e=vR(e,e2,"$1")),e=vR(e,t2,""),r=nf(e);m<=r.length;){switch(i=r[m],p){case CR:if(!i||!ha(EN,i)){if(t)return SR;p=RR;continue}E+=PS(i),p=CN;break;case CN:if(i&&(ha(YB,i)||i==="+"||i==="-"||i==="."))E+=PS(i);else{if(i!==":"){if(t)return SR;E="",p=RR,m=0;continue}if(t&&(l.isSpecial()!==_R(kS,E)||E==="file"&&(l.includesCredentials()||l.port!==null)||l.scheme==="file"&&!l.host))return;if(l.scheme=E,t)return void(l.isSpecial()&&kS[l.scheme]===l.port&&(l.port=null));E="",l.scheme==="file"?p=OR:l.isSpecial()&&n&&n.scheme===l.scheme?p=RN:l.isSpecial()?p=IN:r[m+1]==="/"?(p=wN,m++):(l.cannotBeABaseURL=!0,rf(l.path,""),p=ON)}break;case RR:if(!n||n.cannotBeABaseURL&&i!=="#")return SR;if(n.cannotBeABaseURL&&i==="#"){l.scheme=n.scheme,l.path=ua(n.path),l.query=n.query,l.fragment="",l.cannotBeABaseURL=!0,p=al;break}p=n.scheme==="file"?OR:wR;continue;case RN:if(i!=="/"||r[m+1]!=="/"){p=wR;continue}p=LS,m++;break;case wN:if(i==="/"){p=xS;break}p=mc;continue;case wR:if(l.scheme=n.scheme,i===Oo)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.query=n.query;else if(i==="/"||i==="\\"&&l.isSpecial())p=bN;else if(i==="?")l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.query="",p=sh;else{if(i!=="#"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.path.length--,p=mc;continue}l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.query=n.query,l.fragment="",p=al}break;case bN:if(!l.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,p=mc;continue}p=xS}else p=LS;break;case IN:if(p=LS,i!=="/"||Do(E,m+1)!=="/")continue;m++;break;case LS:if(i!=="/"&&i!=="\\"){p=xS;continue}break;case xS:if(i==="@"){v&&(E="%40"+E),v=!0,s=nf(E);for(var A=0;A<s.length;A++){var N=s[A];if(N!==":"||D){var j=gd(N,TR);D?l.password+=j:l.username+=j}else D=!0}E=""}else if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(v&&E==="")return"Invalid authority";m-=nf(E).length+1,E="",p=bR}else E+=i;break;case bR:case IR:if(t&&l.scheme==="file"){p=NR;continue}if(i!==":"||y){if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(l.isSpecial()&&E==="")return ih;if(t&&E===""&&(l.includesCredentials()||l.port!==null))return;if(o=l.parseHost(E))return o;if(E="",p=sf,t)return;continue}i==="["?y=!0:i==="]"&&(y=!1),E+=i}else{if(E==="")return ih;if(o=l.parseHost(E))return o;if(E="",p=AR,t===IR)return}break;case AR:if(!ha(yR,i)){if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()||t){if(E!==""){var V=NS(E,10);if(V>65535)return gN;l.port=l.isSpecial()&&V===kS[l.scheme]?null:V,E=""}if(t)return;p=sf;continue}return gN}E+=i;break;case OR:if(l.scheme="file",i==="/"||i==="\\")p=AN;else{if(!n||n.scheme!=="file"){p=mc;continue}switch(i){case Oo:l.host=n.host,l.path=ua(n.path),l.query=n.query;break;case"?":l.host=n.host,l.path=ua(n.path),l.query="",p=sh;break;case"#":l.host=n.host,l.path=ua(n.path),l.query=n.query,l.fragment="",p=al;break;default:TN(lg(ua(r,m),""))||(l.host=n.host,l.path=ua(n.path),l.shortenPath()),p=mc;continue}}break;case AN:if(i==="/"||i==="\\"){p=NR;break}n&&n.scheme==="file"&&!TN(lg(ua(r,m),""))&&(hg(n.path[0],!0)?rf(l.path,n.path[0]):l.host=n.host),p=mc;continue;case NR:if(i===Oo||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&hg(E))p=mc;else if(E===""){if(l.host="",t)return;p=sf}else{if(o=l.parseHost(E))return o;if(l.host==="localhost"&&(l.host=""),t)return;E="",p=sf}continue}E+=i;break;case sf:if(l.isSpecial()){if(p=mc,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==Oo&&(p=mc,i!=="/"))continue}else l.fragment="",p=al;else l.query="",p=sh;break;case mc:if(i===Oo||i==="/"||i==="\\"&&l.isSpecial()||!t&&(i==="?"||i==="#")){if((c=PS(c=E))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(l.shortenPath(),i==="/"||i==="\\"&&l.isSpecial()||rf(l.path,"")):n2(E)?i==="/"||i==="\\"&&l.isSpecial()||rf(l.path,""):(l.scheme==="file"&&!l.path.length&&hg(E)&&(l.host&&(l.host=""),E=Do(E,0)+":"),rf(l.path,E)),E="",l.scheme==="file"&&(i===Oo||i==="?"||i==="#"))for(;l.path.length>1&&l.path[0]==="";)HB(l.path);i==="?"?(l.query="",p=sh):i==="#"&&(l.fragment="",p=al)}else E+=gd(i,yN);break;case ON:i==="?"?(l.query="",p=sh):i==="#"?(l.fragment="",p=al):i!==Oo&&(l.path[0]+=gd(i,DS));break;case sh:t||i!=="#"?i!==Oo&&(i==="'"&&l.isSpecial()?l.query+="%27":l.query+=i==="#"?"%23":gd(i,DS)):(l.fragment="",p=al);break;case al:i!==Oo&&(l.fragment+=gd(i,SN))}m++}},parseHost:function(e){var t,n,r;if(Do(e,0)==="["){if(Do(e,e.length-1)!=="]"||(t=function(i){var s,o,c,l,p,m,E,v=[0,0,0,0,0,0,0,0],y=0,D=null,A=0,N=function(){return Do(i,A)};if(N()===":"){if(Do(i,1)!==":")return;A+=2,D=++y}for(;N();){if(y===8)return;if(N()!==":"){for(s=o=0;o<4&&ha(vN,N());)s=16*s+NS(N(),16),A++,o++;if(N()==="."){if(o===0||(A-=o,y>6))return;for(c=0;N();){if(l=null,c>0){if(!(N()==="."&&c<4))return;A++}if(!ha(yR,N()))return;for(;ha(yR,N());){if(p=NS(N(),10),l===null)l=p;else{if(l===0)return;l=10*l+p}if(l>255)return;A++}v[y]=256*v[y]+l,++c!=2&&c!==4||y++}if(c!==4)return;break}if(N()===":"){if(A++,!N())return}else if(N())return;v[y++]=s}else{if(D!==null)return;A++,D=++y}}if(D!==null)for(m=y-D,y=7;y!==0&&m>0;)E=v[y],v[y--]=v[D+m-1],v[D+--m]=E;else if(y!==8)return;return v}(dg(e,1,-1)),!t))return ih;this.host=t}else if(this.isSpecial()){if(e=xB(e),ha(QB,e)||(t=function(i){var s,o,c,l,p,m,E,v=KB(i,".");if(v.length&&v[v.length-1]===""&&v.length--,(s=v.length)>4)return i;for(o=[],c=0;c<s;c++){if((l=v[c])==="")return i;if(p=10,l.length>1&&Do(l,0)==="0"&&(p=ha(qB,l)?16:8,l=dg(l,p===8?1:2)),l==="")m=0;else{if(!ha(p===10?JB:p===8?XB:vN,l))return i;m=NS(l,p)}rf(o,m)}for(c=0;c<s;c++)if(m=o[c],c===s-1){if(m>=_N(256,5-s))return null}else if(m>255)return null;for(E=GB(o),c=0;c<o.length;c++)E+=o[c]*_N(256,3-c);return E}(e),t===null))return ih;this.host=t}else{if(ha(ZB,e))return ih;for(t="",n=nf(e),r=0;r<n.length;r++)t+=gd(n[r],DS);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return _R(kS,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&hg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,o=e.path,c=e.query,l=e.fragment,p=t+":";return i!==null?(p+="//",e.includesCredentials()&&(p+=n+(r?":"+r:"")+"@"),p+=ug(i),s!==null&&(p+=":"+s)):t==="file"&&(p+="//"),p+=e.cannotBeABaseURL?o[0]:o.length?"/"+lg(o,"/"):"",c!==null&&(p+="?"+c),l!==null&&(p+="#"+l),p},setHref:function(e){var t=this.parse(e);if(t)throw new ER(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new of(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+ug(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ol(e)+":",CR)},getUsername:function(){return this.username},setUsername:function(e){var t=nf(ol(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=gd(t[n],TR)}},getPassword:function(){return this.password},setPassword:function(e){var t=nf(ol(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=gd(t[n],TR)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?ug(e):ug(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,bR)},getHostname:function(){var e=this.host;return e===null?"":ug(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,IR)},getPort:function(){var e=this.port;return e===null?"":ol(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ol(e))===""?this.port=null:this.parse(e,AR))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+lg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,sf))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ol(e))===""?this.query=null:(Do(e,0)==="?"&&(e=dg(e,1)),this.query="",this.parse(e,sh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ol(e))!==""?(Do(e,0)==="#"&&(e=dg(e,1)),this.fragment="",this.parse(e,al)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var of=function(e){var t=kB(this,ss),n=UB(arguments.length,1)>1?arguments[1]:void 0,r=VB(t,new PR(e,!1,n));fR||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},ss=of.prototype,ko=function(e,t){return{get:function(){return OS(this)[e]()},set:t&&function(n){return OS(this)[t](n)},configurable:!0,enumerable:!0}};if(fR&&(Po(ss,"href",ko("serialize","setHref")),Po(ss,"origin",ko("getOrigin")),Po(ss,"protocol",ko("getProtocol","setProtocol")),Po(ss,"username",ko("getUsername","setUsername")),Po(ss,"password",ko("getPassword","setPassword")),Po(ss,"host",ko("getHost","setHost")),Po(ss,"hostname",ko("getHostname","setHostname")),Po(ss,"port",ko("getPort","setPort")),Po(ss,"pathname",ko("getPathname","setPathname")),Po(ss,"search",ko("getSearch","setSearch")),Po(ss,"searchParams",ko("getSearchParams")),Po(ss,"hash",ko("getHash","setHash"))),AS(ss,"toJSON",function(){return OS(this).serialize()},{enumerable:!0}),AS(ss,"toString",function(){return OS(this).serialize()},{enumerable:!0}),cg){var NN=cg.createObjectURL,PN=cg.revokeObjectURL;NN&&AS(of,"createObjectURL",pN(NN,cg)),PN&&AS(of,"revokeObjectURL",pN(PN,cg))}MB(of,"URL"),PB({global:!0,forced:!DB,sham:!fR},{URL:of});var r2=qt,DN=C,i2=gs,kN=Mi,s2=TS,DR=Ar("URL"),o2=s2&&DN(function(){DR.canParse()}),a2=DN(function(){return DR.canParse.length!==1});r2({target:"URL",stat:!0,forced:!o2||a2},{canParse:function(e){var t=i2(arguments.length,1),n=kN(e),r=t<2||arguments[1]===void 0?void 0:kN(arguments[1]);try{return!!new DR(n,r)}catch{return!1}}});var c2=qt,l2=gs,LN=Mi,d2=TS,u2=Ar("URL");c2({target:"URL",stat:!0,forced:!d2},{parse:function(e){var t=l2(arguments.length,1),n=LN(e),r=t<2||arguments[1]===void 0?void 0:LN(arguments[1]);try{return new u2(n,r)}catch{return null}}});var MS=S(Qr.URL);let xN=!0,MN=!0;function US(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function oh(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,c){if(o!==t)return i.apply(this,arguments);const l=p=>{const m=n(p);m&&(c.handleEvent?c.handleEvent(m):c(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,l),i.apply(this,[o,l])};const s=r.removeEventListener;r.removeEventListener=function(o,c){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const l=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function h2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(xN=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(MN=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function UN(){if(typeof window=="object"){if(xN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function kR(e,t){MN&&console.warn(e+" is deprecated, please use "+t+" instead.")}function VN(e){return Object.prototype.toString.call(e)==="[object Object]"}function jN(e){var t;return VN(e)?Ui(t=Object.keys(e)).call(t,function(n,r){const i=VN(e[r]),s=i?jN(e[r]):e[r],o=i&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[r]:s})},{}):e}function LR(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?LR(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{LR(e,e.get(i),n)})}))}function FN(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)}),s.forEach(o=>{e.forEach(c=>{c.type===r&&c.trackId===o.id&&LR(e,c,i)})}),i}const BN=UN;function WN(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const p=typeof o[l]=="object"?o[l]:{ideal:o[l]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const m=function(E,v){return E?E+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(p.ideal!==void 0){c.optional=c.optional||[];let E={};typeof p.ideal=="number"?(E[m("min",l)]=p.ideal,c.optional.push(E),E={},E[m("max",l)]=p.ideal,c.optional.push(E)):(E[m("",l)]=p.ideal,c.optional.push(E))}p.exact!==void 0&&typeof p.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[m("",l)]=p.exact):["min","max"].forEach(E=>{p[E]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[m(E,l)]=p[E])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(t.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const l=function(p,m,E){m in p&&!(E in p)&&(p[E]=p[m],delete p[m])};l((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),l(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let l=o.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const p=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let m;if(delete o.video.facingMode,l.exact==="environment"||l.ideal==="environment"?m=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(E=>{E=E.filter(y=>y.kind==="videoinput");let v=E.find(y=>m.some(D=>{var A;return Ae(A=y.label.toLowerCase()).call(A,D)}));return!v&&E.length&&Ae(m).call(m,"back")&&(v=E[E.length-1]),v&&(o.video.deviceId=l.exact?{exact:v.deviceId}:{ideal:v.deviceId}),o.video=r(o.video),BN("chrome: "+JSON.stringify(o)),c(o)})}o.video=r(o.video)}return BN("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,c,l){i(o,p=>{n.webkitGetUserMedia(p,c,m=>{l&&l(s(m))})})}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>o(l).then(p=>{if(l.audio&&!p.getAudioTracks().length||l.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return p},p=>je.reject(s(p))))}}}function GN(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function HN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.track.id):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.id):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else oh(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function KN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let l=i.apply(this,arguments);return l||(l=t(this,o),this._senders.push(l)),l};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{const o=this._senders.find(c=>c.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function zN(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const l={};return c.result().forEach(p=>{const m={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(E=>{m[E]=p.stat(E)}),l[m.id]=m}),l},o=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){r(o(s(l)))};return t.apply(this,[c,n])}return new je((c,l)=>{t.apply(this,[function(p){c(o(s(p)))},l])}).then(r,i)}}function YN(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>FN(s,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),oh(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>FN(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach(o=>{o.track===n&&(r?s=!0:r=o)}),this.getReceivers().forEach(o=>(o.track===n&&(i?s=!0:i=o),o.track===n)),s||r&&i?je.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():je.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function qN(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(m=>m.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>o.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function XN(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return qN(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(p=>this._reverseStreams[p.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(p=>{if(this.getSenders().find(E=>E.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const p=new e.MediaStream(l.getTracks());this._streams[l.id]=p,this._reverseStreams[p.id]=l,l=p}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;function s(l,p){let m=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(E=>{const v=l._reverseStreams[E],y=l._streams[v.id];m=m.replace(new RegExp(y.id,"g"),v.id)}),new RTCSessionDescription({type:p.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(y=>y===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[p.id];if(v)v.addTrack(l),je.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new e.MediaStream([l]);this._streams[p.id]=y,this._reverseStreams[y.id]=p,this.addStream(y)}return this.getSenders().find(y=>y.track===l)},["createOffer","createAnswer"].forEach(function(l){const p=e.RTCPeerConnection.prototype[l],m={[l](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[v=>{const y=s(this,v);E[0].apply(null,[y])},v=>{E[1]&&E[1].apply(null,v)},arguments[2]]):p.apply(this,arguments).then(v=>s(this,v))}};e.RTCPeerConnection.prototype[l]=m[l]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(l,p){let m=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(E=>{const v=l._reverseStreams[E],y=l._streams[v.id];m=m.replace(new RegExp(v.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:m})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(E=>l.track===E)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xR(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function JN(e,t){oh(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var QN=Object.freeze({__proto__:null,fixNegotiationNeeded:JN,shimAddTrackRemoveTrack:XN,shimAddTrackRemoveTrackWithNative:qN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:KN,shimGetStats:zN,shimGetUserMedia:WN,shimMediaStream:GN,shimOnTrack:HN,shimPeerConnection:xR,shimSenderReceiverGetStats:YN});function ZN(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){kR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,c,l){c in o&&!(l in o)&&(o[l]=o[c],delete o[c])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const c=o.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function $N(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function MR(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return r.apply(this,[i||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((p,m)=>{c.set(m,Object.assign({},p,{type:n[p.type]||p.type}))})}return c}).then(s,o)}}function eP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):je.resolve(new Map)}}function tP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),oh(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function nP(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){kR("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&Ae(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function rP(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function iP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function sP(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function oP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function aP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var cP=Object.freeze({__proto__:null,shimAddTransceiver:iP,shimCreateAnswer:aP,shimCreateOffer:oP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,je.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:sP,shimGetUserMedia:ZN,shimOnTrack:$N,shimPeerConnection:MR,shimRTCDataChannel:rP,shimReceiverGetStats:tP,shimRemoveStream:nP,shimSenderGetStats:eP});function lP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Ae(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach(o=>{var c;this._localStreams?Ae(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{Ae(r).call(r,i.track)&&this.removeTrack(i)})})}}function dP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Ae(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function uP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(l,p){const m=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[m]);return p?(E.then(l,p),je.resolve()):E},t.createAnswer=function(l,p){const m=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[m]);return p?(E.then(l,p),je.resolve()):E};let c=function(l,p,m){const E=i.apply(this,[l]);return m?(E.then(p,m),je.resolve()):E};t.setLocalDescription=c,c=function(l,p,m){const E=s.apply(this,[l]);return m?(E.then(p,m),je.resolve()):E},t.setRemoteDescription=c,c=function(l,p,m){const E=o.apply(this,[l]);return m?(E.then(p,m),je.resolve()):E},t.addIceCandidate=c}function hP(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(pP(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function pP(e){return e&&e.video!==void 0?Object.assign({},e,{video:jN(e.video)}):e}function fP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(kR("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function mP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _P(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function gP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var EP=Object.freeze({__proto__:null,shimAudioContext:gP,shimCallbacksAPI:uP,shimConstraints:pP,shimCreateOfferLegacy:_P,shimGetUserMedia:hP,shimLocalStreamsAPI:lP,shimRTCIceServerUrls:fP,shimRemoteStreamsAPI:dP,shimTrackEventTransceiver:mP}),vP=`	
\v\f\r \u2028\u2029\uFEFF`,f2=Kr,m2=Mi,UR=vP,SP=B("".replace),_2=RegExp("^["+UR+"]+"),g2=RegExp("(^|[^"+UR+"])["+UR+"]+$"),E2=function(e){return function(t){var n=m2(f2(t));return 1&e&&(n=SP(n,_2,"")),2&e&&(n=SP(n,g2,"$1")),n}},v2={trim:E2(3)},S2=Ip.PROPER,y2=C,yP=vP,T2=v2.trim;qt({target:"String",proto:!0,forced:function(e){return y2(function(){return!!yP[e]()||""[e]()!==""||S2&&yP[e].name!==e})}("trim")},{trim:function(){return T2(this)}});var C2=Qi("String","trim"),R2=Y,w2=C2,VR=String.prototype,b2=function(e){var t=e.trim;return typeof e=="string"||e===VR||R2(VR,e)&&t===VR.trim?w2:t},ri=S(b2),TP={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],s=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const c=i[o],l=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const p=t.parseRtpMap(l),m=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(p.parameters=m.length?t.parseFmtp(m[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(o=>{r.headerExtensions.push(t.parseExtmap(o))});const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(o=>{s.forEach(c=>{o.rtcpFeedback.find(l=>l.type===c.type&&l.parameter===c.parameter)||o.rtcpFeedback.push(c)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=t.writeRtpMap(o),i+=t.writeFmtp(o),i+=t.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=t.writeExtmap(o)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(n,"a=ssrc:").map(v=>t.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),l=c.length>0&&c[0].ssrc;let p;const m=t.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===l&&(p=m[0][1]),i.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let y={ssrc:l,codecPayloadType:parseInt(v.parameters.apt,10)};l&&p&&(y.rtx={ssrc:p}),r.push(y),s&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&l&&r.push({ssrc:l});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,r.forEach(v=>{v.maxBitrate=E})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(n,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const c=t.matchPrefix(n,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(TP);var CP=TP.exports,af=S(CP),I2=f({__proto__:null,default:af},[CP]);function VS(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=af.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,oh(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function jR(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||oh(e,"icecandidate",t=>{if(t.candidate){const n=af.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function jS(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const l=af.splitSections(c.sdp);return l.shift(),l.some(p=>{const m=af.parseMLine(p);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},r=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const p=parseInt(l[1],10);return p!=p?-1:p},i=function(c){let l=65536;return t.browser==="firefox"&&(l=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},s=function(c,l){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const m=af.matchPrefix(c.sdp,"a=max-message-size:");return m.length>0?p=parseInt(m[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(p=2147483637),p},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),p=s(arguments[0],c);let m;m=l===0&&p===0?Number.POSITIVE_INFINITY:l===0||p===0?Math.max(l,p):Math.min(l,p);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>m}),this._sctp=E}return o.apply(this,arguments)}}function FS(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const s=r.send;r.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},oh(e,"datachannel",r=>(t(r.channel,r.target),r))}function FR(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function BR(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(s=>ri(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function BS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?je.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),je.resolve())})}function WS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var A2=Object.freeze({__proto__:null,removeExtmapAllowMixed:BR,shimAddIceCandidateNullOrEmpty:BS,shimConnectionState:FR,shimMaxMessageSize:jS,shimParameterlessSetLocalDescription:WS,shimRTCIceCandidate:VS,shimRTCIceCandidateRelayProtocol:jR,shimSendThrowTypeError:FS});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=UN,r=function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=US(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=US(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=US(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o}(e),i={browserDetails:r,commonShim:A2,extractVersion:US,disableLog:h2,disableWarnings:p2,sdp:I2};switch(r.browser){case"chrome":if(!QN||!xR||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=QN,BS(e,r),WS(e),WN(e,r),GN(e),xR(e,r),HN(e),XN(e,r),KN(e),zN(e),YN(e),JN(e,r),VS(e),jR(e),FR(e),jS(e,r),FS(e),BR(e,r);break;case"firefox":if(!cP||!MR||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=cP,BS(e,r),WS(e),ZN(e,r),MR(e,r),$N(e),nP(e),eP(e),tP(e),rP(e),iP(e),sP(e),oP(e),aP(e),VS(e),FR(e),jS(e,r),FS(e);break;case"safari":if(!EP||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=EP,BS(e,r),WS(e),fP(e),_P(e),uP(e),lP(e),dP(e),mP(e),hP(e),gP(e),VS(e),jR(e),jS(e,r),FS(e),BR(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var WR=ie;qt({global:!0,forced:WR.globalThis!==WR},{globalThis:WR});var RP=S(ie),GR={exports:{}};(function(e,t){(function(n,r){var i="function",s="undefined",o="object",c="string",l="major",p="model",m="name",E="type",v="vendor",y="version",D="architecture",A="console",N="mobile",j="tablet",V="smarttv",G="wearable",$="embedded",Q="Amazon",z="Apple",re="ASUS",fe="BlackBerry",ve="Browser",Re="Chrome",Ct="Firefox",bt="Google",ut="Huawei",Yt="LG",Ht="Microsoft",Hr="Motorola",Ee="Opera",Ne="Samsung",He="Sharp",Se="Sony",b="Xiaomi",K="Zebra",J="Facebook",be="Chromium OS",gt="Mac OS",dn=" Browser",tr=function(Jn){for(var nr={},gn=0;gn<Jn.length;gn++)nr[Jn[gn].toUpperCase()]=Jn[gn];return nr},oo=function(Jn,nr){return typeof Jn===c&&Yo(nr).indexOf(Yo(Jn))!==-1},Yo=function(Jn){return Jn.toLowerCase()},_E=function(Jn,nr){if(typeof Jn===c)return Jn=Jn.replace(/^\s\s*/,""),typeof nr===s?Jn:Jn.substring(0,500)},Lh=function(Jn,nr){for(var gn,qi,Aa,jn,yl,Ut,Oa=0;Oa<nr.length&&!yl;){var xh=nr[Oa],Dc=nr[Oa+1];for(gn=qi=0;gn<xh.length&&!yl&&xh[gn];)if(yl=xh[gn++].exec(Jn))for(Aa=0;Aa<Dc.length;Aa++)Ut=yl[++qi],typeof(jn=Dc[Aa])===o&&jn.length>0?jn.length===2?typeof jn[1]==i?this[jn[0]]=jn[1].call(this,Ut):this[jn[0]]=jn[1]:jn.length===3?typeof jn[1]!==i||jn[1].exec&&jn[1].test?this[jn[0]]=Ut?Ut.replace(jn[1],jn[2]):r:this[jn[0]]=Ut?jn[1].call(this,Ut,jn[2]):r:jn.length===4&&(this[jn[0]]=Ut?jn[3].call(this,Ut.replace(jn[1],jn[2])):r):this[jn]=Ut||r;Oa+=2}},em=function(Jn,nr){for(var gn in nr)if(typeof nr[gn]===o&&nr[gn].length>0){for(var qi=0;qi<nr[gn].length;qi++)if(oo(nr[gn][qi],Jn))return gn==="?"?r:gn}else if(oo(nr[gn],Jn))return gn==="?"?r:gn;return nr.hasOwnProperty("*")?nr["*"]:Jn},WT={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},GT={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,Ee+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[m,Ee+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[m,Ee]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[m,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[m,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[m,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[m,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+ve]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[m,"Smart Lenovo "+ve]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+ve],y],[/\bfocus\/([\w\.]+)/i],[y,[m,Ct+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,Ee+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,Ee+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI"+dn]],[/fxios\/([\w\.-]+)/i],[y,[m,Ct]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[m,"360"]],[/\b(qq)\/([\w\.]+)/i],[[m,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1"+dn],y],[/samsungbrowser\/([\w\.]+)/i],[y,[m,Ne+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[m,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[m,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[m,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[m],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,J],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[m,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,Re+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,Re+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+ve]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,em,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[m,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,Ct+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[m,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,Yo]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,"",Yo]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,Yo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[v,Ne],[E,j]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[p,[v,Ne],[E,N]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[v,z],[E,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[v,z],[E,j]],[/(macintosh);/i],[p,[v,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[v,He],[E,N]],[/(?:honor)([-\w ]+)[;\)]/i],[p,[v,"Honor"],[E,N]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[v,ut],[E,j]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[v,ut],[E,N]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[p,/_/g," "],[v,b],[E,N]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[v,b],[E,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[v,"OPPO"],[E,N]],[/\b(opd2\d{3}a?) bui/i],[p,[v,"OPPO"],[E,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[v,"Vivo"],[E,N]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[p,[v,"Realme"],[E,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[v,Hr],[E,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[v,Hr],[E,j]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[v,Yt],[E,j]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[v,Yt],[E,N]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[v,"Lenovo"],[E,j]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[v,"Nokia"],[E,N]],[/(pixel c)\b/i],[p,[v,bt],[E,j]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[v,bt],[E,N]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[v,Se],[E,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[v,Se],[E,j]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[v,"OnePlus"],[E,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[v,Q],[E,j]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[v,Q],[E,N]],[/(playbook);[-\w\),; ]+(rim)/i],[p,v,[E,j]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[v,fe],[E,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[v,re],[E,j]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[v,re],[E,N]],[/(nexus 9)/i],[p,[v,"HTC"],[E,j]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[p,/_/g," "],[E,N]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[p,[v,"TCL"],[E,j]],[/(itel) ((\w+))/i],[[v,Yo],p,[E,em,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[v,"Acer"],[E,j]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[v,"Meizu"],[E,N]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[p,[v,"Ulefone"],[E,N]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[p,[v,"Energizer"],[E,N]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[p,[v,"Cat"],[E,N]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[p,[v,"Smartfren"],[E,N]],[/droid.+; (a(?:015|06[35]|142p?))/i],[p,[v,"Nothing"],[E,N]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,p,[E,N]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,p,[E,j]],[/(surface duo)/i],[p,[v,Ht],[E,j]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[v,"Fairphone"],[E,N]],[/(u304aa)/i],[p,[v,"AT&T"],[E,N]],[/\bsie-(\w*)/i],[p,[v,"Siemens"],[E,N]],[/\b(rct\w+) b/i],[p,[v,"RCA"],[E,j]],[/\b(venue[\d ]{2,7}) b/i],[p,[v,"Dell"],[E,j]],[/\b(q(?:mv|ta)\w+) b/i],[p,[v,"Verizon"],[E,j]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[v,"Barnes & Noble"],[E,j]],[/\b(tm\d{3}\w+) b/i],[p,[v,"NuVision"],[E,j]],[/\b(k88) b/i],[p,[v,"ZTE"],[E,j]],[/\b(nx\d{3}j) b/i],[p,[v,"ZTE"],[E,N]],[/\b(gen\d{3}) b.+49h/i],[p,[v,"Swiss"],[E,N]],[/\b(zur\d{3}) b/i],[p,[v,"Swiss"],[E,j]],[/\b((zeki)?tb.*\b) b/i],[p,[v,"Zeki"],[E,j]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],p,[E,j]],[/\b(ns-?\w{0,9}) b/i],[p,[v,"Insignia"],[E,j]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[v,"NextBook"],[E,j]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],p,[E,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],p,[E,N]],[/\b(ph-1) /i],[p,[v,"Essential"],[E,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[v,"Envizen"],[E,j]],[/\b(trio[-\w\. ]+) b/i],[p,[v,"MachSpeed"],[E,j]],[/\btu_(1491) b/i],[p,[v,"Rotor"],[E,j]],[/(shield[\w ]+) b/i],[p,[v,"Nvidia"],[E,j]],[/(sprint) (\w+)/i],[v,p,[E,N]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[v,Ht],[E,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[v,K],[E,j]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[v,K],[E,N]],[/smart-tv.+(samsung)/i],[v,[E,V]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[v,Ne],[E,V]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,Yt],[E,V]],[/(apple) ?tv/i],[v,[p,z+" TV"],[E,V]],[/crkey/i],[[p,Re+"cast"],[v,bt],[E,V]],[/droid.+aft(\w+)( bui|\))/i],[p,[v,Q],[E,V]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[v,He],[E,V]],[/(bravia[\w ]+)( bui|\))/i],[p,[v,Se],[E,V]],[/(mitv-\w{5}) bui/i],[p,[v,b],[E,V]],[/Hbbtv.*(technisat) (.*);/i],[v,p,[E,V]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,_E],[p,_E],[E,V]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,V]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,p,[E,A]],[/droid.+; (shield) bui/i],[p,[v,"Nvidia"],[E,A]],[/(playstation [345portablevi]+)/i],[p,[v,Se],[E,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[v,Ht],[E,A]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[p,[v,Ne],[E,G]],[/((pebble))app/i],[v,p,[E,G]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[v,z],[E,G]],[/droid.+; (glass) \d/i],[p,[v,bt],[E,G]],[/droid.+; (wt63?0{2,3})\)/i],[p,[v,K],[E,G]],[/droid.+; (glass) \d/i],[p,[v,bt],[E,G]],[/(pico) (4|neo3(?: link|pro)?)/i],[v,p,[E,G]],[/; (quest( \d| pro)?)/i],[p,[v,J],[E,G]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[E,$]],[/(aeobc)\b/i],[p,[v,Q],[E,$]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[p,[E,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[E,j]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,j]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,N]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[m,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[m,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[m,[y,em,WT]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,em,WT],[m,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,gt],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,y],[/\(bb(10);/i],[y,[m,fe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,Ct+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,Re+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,be],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[m,y]]},ao=function(Jn,nr){if(typeof Jn===o&&(nr=Jn,Jn=r),!(this instanceof ao))return new ao(Jn,nr).getResult();var gn=typeof n!==s&&n.navigator?n.navigator:r,qi=Jn||(gn&&gn.userAgent?gn.userAgent:""),Aa=gn&&gn.userAgentData?gn.userAgentData:r,jn=nr?function(Ut,Oa){var xh={};for(var Dc in Ut)Oa[Dc]&&Oa[Dc].length%2==0?xh[Dc]=Oa[Dc].concat(Ut[Dc]):xh[Dc]=Ut[Dc];return xh}(GT,nr):GT,yl=gn&&gn.userAgent==qi;return this.getBrowser=function(){var Ut={};return Ut[m]=r,Ut[y]=r,Lh.call(Ut,qi,jn.browser),Ut[l]=function(Oa){return typeof Oa===c?Oa.replace(/[^\d\.]/g,"").split(".")[0]:r}(Ut[y]),yl&&gn&&gn.brave&&typeof gn.brave.isBrave==i&&(Ut[m]="Brave"),Ut},this.getCPU=function(){var Ut={};return Ut[D]=r,Lh.call(Ut,qi,jn.cpu),Ut},this.getDevice=function(){var Ut={};return Ut[v]=r,Ut[p]=r,Ut[E]=r,Lh.call(Ut,qi,jn.device),yl&&!Ut[E]&&Aa&&Aa.mobile&&(Ut[E]=N),yl&&Ut[p]=="Macintosh"&&gn&&typeof gn.standalone!==s&&gn.maxTouchPoints&&gn.maxTouchPoints>2&&(Ut[p]="iPad",Ut[E]=j),Ut},this.getEngine=function(){var Ut={};return Ut[m]=r,Ut[y]=r,Lh.call(Ut,qi,jn.engine),Ut},this.getOS=function(){var Ut={};return Ut[m]=r,Ut[y]=r,Lh.call(Ut,qi,jn.os),yl&&!Ut[m]&&Aa&&Aa.platform&&Aa.platform!="Unknown"&&(Ut[m]=Aa.platform.replace(/chrome os/i,be).replace(/macos/i,gt)),Ut},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return qi},this.setUA=function(Ut){return qi=typeof Ut===c&&Ut.length>500?_E(Ut,500):Ut,this},this.setUA(qi),this};ao.VERSION="0.7.40",ao.BROWSER=tr([m,y,l]),ao.CPU=tr([D]),ao.DEVICE=tr([p,v,E,A,N,V,j,G,$]),ao.ENGINE=ao.OS=tr([m,y]),e.exports&&(t=e.exports=ao),t.UAParser=ao;var Sl=typeof n!==s&&(n.jQuery||n.Zepto);if(Sl&&!Sl.ua){var HT=new ao;Sl.ua=HT.getResult(),Sl.ua.get=function(){return HT.getUA()},Sl.ua.set=function(Jn){HT.setUA(Jn);var nr=HT.getResult();for(var gn in nr)Sl.ua[gn]=nr[gn]}}})(typeof window=="object"?window:g)})(GR,GR.exports);var O2=S(GR.exports),wP=cd.clear;qt({global:!0,bind:!0,forced:ie.clearImmediate!==wP},{clearImmediate:wP});var bP=ie,N2=le,P2=Ue,D2=vu,k2=zr,L2=yr,x2=gs,M2=bP.Function,U2=/MSIE .\./.test(k2)||D2==="BUN"&&function(){var e=bP.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),V2=qt,IP=ie,AP=cd.set,j2=function(e,t){var n=1;return U2?function(r,i){var s=x2(arguments.length,1)>n,o=P2(r)?r:M2(r),c=s?L2(arguments,n):[],l=s?function(){N2(o,this,c)}:o;return e(l)}:e},OP=IP.setImmediate?j2(AP):AP;V2({global:!0,bind:!0,forced:IP.setImmediate!==OP},{setImmediate:OP});var NP=S(Qr.setImmediate),F2=ie,B2=ng,W2=Bn,G2=gs,H2=Ge;qt({global:!0,dontCallGetSet:!0,forced:C(function(){return H2&&Object.getOwnPropertyDescriptor(F2,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){G2(arguments.length,1),B2(W2(e))}});var PP=S(Qr.queueMicrotask);function DP(e,t){return function(){return e.apply(t,arguments)}}const{toString:K2}=Object.prototype,{getPrototypeOf:HR}=Object,{iterator:GS,toStringTag:kP}=Symbol,HS=(KR=Object.create(null),e=>{const t=K2.call(e);return KR[t]||(KR[t]=t.slice(8,-1).toLowerCase())});var KR;const pa=e=>(e=e.toLowerCase(),t=>HS(t)===e),KS=e=>t=>typeof t===e,{isArray:cf}=Array,pg=KS("undefined"),LP=pa("ArrayBuffer"),z2=KS("string"),Ss=KS("function"),xP=KS("number"),zS=e=>e!==null&&typeof e=="object",YS=e=>{if(HS(e)!=="object")return!1;const t=HR(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||kP in e||GS in e)},Y2=pa("Date"),q2=pa("File"),X2=pa("Blob"),J2=pa("FileList"),Q2=pa("URLSearchParams"),[Z2,$2,eW,tW]=["ReadableStream","Request","Response","Headers"].map(pa);function fg(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),cf(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let c;for(n=0;n<o;n++)c=s[n],t.call(null,e[c],c,e)}}function MP(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const ah=RP!==void 0?RP:typeof self<"u"?self:typeof window<"u"?window:globalThis,UP=e=>!pg(e)&&e!==ah,nW=(zR=typeof Uint8Array<"u"&&HR(Uint8Array),e=>zR&&e instanceof zR);var zR;const rW=pa("HTMLFormElement"),VP=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),iW=pa("RegExp"),jP=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};fg(n,(i,s)=>{let o;(o=t(i,s,e))!==!1&&(r[s]=o||i)}),Object.defineProperties(e,r)},sW=pa("AsyncFunction"),FP=(BP=typeof NP=="function",WP=Ss(ah.postMessage),BP?NP:WP?(YR="axios@".concat(Math.random()),qS=[],ah.addEventListener("message",e=>{let{source:t,data:n}=e;t===ah&&n===YR&&qS.length&&qS.shift()()},!1),e=>{qS.push(e),ah.postMessage(YR,"*")}):e=>setTimeout(e));var BP,WP,YR,qS;const oW=PP!==void 0?PP.bind(ah):typeof process<"u"&&process.nextTick||FP;var Me={isArray:cf,isArrayBuffer:LP,isBuffer:function(e){return e!==null&&!pg(e)&&e.constructor!==null&&!pg(e.constructor)&&Ss(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ss(e.append)&&((t=HS(e))==="formdata"||t==="object"&&Ss(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&LP(e.buffer),t},isString:z2,isNumber:xP,isBoolean:e=>e===!0||e===!1,isObject:zS,isPlainObject:YS,isReadableStream:Z2,isRequest:$2,isResponse:eW,isHeaders:tW,isUndefined:pg,isDate:Y2,isFile:q2,isBlob:X2,isRegExp:iW,isFunction:Ss,isStream:e=>zS(e)&&Ss(e.pipe),isURLSearchParams:Q2,isTypedArray:nW,isFileList:J2,forEach:fg,merge:function e(){const{caseless:t}=UP(this)&&this||{},n={},r=(i,s)=>{const o=t&&MP(n,s)||s;YS(n[o])&&YS(i)?n[o]=e(n[o],i):YS(i)?n[o]=e({},i):cf(i)?n[o]=i.slice():n[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&fg(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return fg(t,(i,s)=>{n&&Ss(i)?e[s]=DP(i,n):e[s]=i},{allOwnKeys:r}),e},trim:e=>ri(e)?ri(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,o;const c={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],r&&!r(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=n!==!1&&HR(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:HS,kindOfTest:pa,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(cf(e))return e;let t=e.length;if(!xP(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[GS]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:rW,hasOwnProperty:VP,hasOwnProp:VP,reduceDescriptors:jP,freezeMethods:e=>{jP(e,(t,n)=>{if(Ss(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];Ss(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach(s=>{n[s]=!0})};return cf(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:MP,global:ah,isContextDefined:UP,isSpecCompliantForm:function(e){return!!(e&&Ss(e.append)&&e[kP]==="FormData"&&e[GS])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(zS(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const s=cf(r)?[]:{};return fg(r,(o,c)=>{const l=n(o,i+1);!pg(l)&&(s[c]=l)}),t[i]=void 0,s}}return r};return n(e,0)},isAsyncFn:sW,isThenable:e=>e&&(zS(e)||Ss(e))&&Ss(e.then)&&Ss(e.catch),setImmediate:FP,asap:oW,isIterable:e=>e!=null&&Ss(e[GS])};function tn(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Me.inherits(tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Me.toJSONObject(this.config),code:this.code,status:this.status}}});const GP=tn.prototype,HP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{HP[e]={value:e}}),Object.defineProperties(tn,HP),Object.defineProperty(GP,"isAxiosError",{value:!0}),tn.from=(e,t,n,r,i,s)=>{const o=Object.create(GP);return Me.toFlatObject(e,o,function(c){return c!==Error.prototype},c=>c!=="isAxiosError"),tn.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function qR(e){return Me.isPlainObject(e)||Me.isArray(e)}function KP(e){return Me.endsWith(e,"[]")?e.slice(0,-2):e}function zP(e,t,n){return e?e.concat(t).map(function(r,i){return r=KP(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}const aW=Me.toFlatObject(Me,{},null,function(e){return/^is[A-Z]/.test(e)});function XS(e,t,n){if(!Me.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Me.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,y){return!Me.isUndefined(y[v])})).metaTokens,i=n.visitor||p,s=n.dots,o=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&Me.isSpecCompliantForm(t);if(!Me.isFunction(i))throw new TypeError("visitor must be a function");function l(v){if(v===null)return"";if(Me.isDate(v))return v.toISOString();if(!c&&Me.isBlob(v))throw new tn("Blob is not supported. Use a Buffer instead.");return Me.isArrayBuffer(v)||Me.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function p(v,y,D){let A=v;if(v&&!D&&typeof v=="object"){if(Me.endsWith(y,"{}"))y=r?y:y.slice(0,-2),v=JSON.stringify(v);else if(Me.isArray(v)&&function(N){return Me.isArray(N)&&!N.some(qR)}(v)||(Me.isFileList(v)||Me.endsWith(y,"[]"))&&(A=Me.toArray(v)))return y=KP(y),A.forEach(function(N,j){!Me.isUndefined(N)&&N!==null&&t.append(o===!0?zP([y],j,s):o===null?y:y+"[]",l(N))}),!1}return!!qR(v)||(t.append(zP(D,y,s),l(v)),!1)}const m=[],E=Object.assign(aW,{defaultVisitor:p,convertValue:l,isVisitable:qR});if(!Me.isObject(e))throw new TypeError("data must be an object");return function v(y,D){if(!Me.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+D.join("."));m.push(y),Me.forEach(y,function(A,N){(!(Me.isUndefined(A)||A===null)&&i.call(t,A,Me.isString(N)?ri(N).call(N):N,D,E))===!0&&v(A,D?D.concat(N):[N])}),m.pop()}}(e),t}function YP(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function XR(e,t){this._pairs=[],e&&XS(e,this,t)}const qP=XR.prototype;function cW(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function XP(e,t,n){if(!t)return e;const r=n&&n.encode||cW;Me.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):Me.isURLSearchParams(t)?t.toString():new XR(t,n).toString(r),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}qP.append=function(e,t){this._pairs.push([e,t])},qP.toString=function(e){const t=e?function(n){return e.call(this,n,YP)}:YP;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var JP=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Me.forEach(this.handlers,function(t){t!==null&&e(t)})}},QP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ZP={exports:{}},lW=qt,dW=Ge,$P=xi.f;lW({target:"Object",stat:!0,forced:Object.defineProperty!==$P,sham:!dW},{defineProperty:$P});var eD=Qr.Object,uW=ZP.exports=function(e,t,n){return eD.defineProperty(e,t,n)};eD.defineProperty.sham&&(uW.sham=!0);var tD=S(ZP.exports),hW=TypeError,nD=Jo,pW=Or,fW=pr,mW=An("species"),rD=Array,_W=function(e){var t;return nD(e)&&(t=e.constructor,(pW(t)&&(t===rD||nD(t.prototype))||fW(t)&&(t=t[mW])===null)&&(t=void 0)),t===void 0?rD:t},iD=function(e,t){return new(_W(e))(t===0?0:t)},gW=C,EW=Ti,vW=An("species"),sD=function(e){return EW>=51||!gW(function(){var t=[];return(t.constructor={})[vW]=function(){return{foo:1}},t[e](Boolean).foo!==1})},SW=qt,yW=C,TW=Jo,CW=pr,RW=go,wW=qa,oD=function(e){if(e>9007199254740991)throw hW("Maximum allowed index exceeded");return e},aD=uR,bW=iD,IW=sD,AW=Ti,cD=An("isConcatSpreadable"),OW=AW>=51||!yW(function(){var e=[];return e[cD]=!1,e.concat()[0]!==e}),NW=function(e){if(!CW(e))return!1;var t=e[cD];return t!==void 0?!!t:TW(e)};SW({target:"Array",proto:!0,forced:!OW||!IW("concat")},{concat:function(e){var t,n,r,i,s,o=RW(this),c=bW(o,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(NW(s=t===-1?o:arguments[t]))for(i=wW(s),oD(l+i),n=0;n<i;n++,l++)n in s&&aD(c,l,s[n]);else oD(l+1),aD(c,l++,s);return c.length=l,c}});var lD={},PW=ue,DW=ps,dD=Zo.f,kW=yr,uD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];lD.f=function(e){return uD&&PW(e)==="Window"?function(t){try{return dD(t)}catch{return kW(uD)}}(e):dD(DW(e))};var lf={},LW=An;lf.f=LW;var hD=Qr,xW=fr,MW=lf,UW=xi.f,Tr=function(e){var t=hD.Symbol||(hD.Symbol={});xW(t,e)||UW(t,e,{value:MW.f(e)})},VW=We,jW=Ar,FW=An,BW=aa,pD=function(){var e=jW("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=FW("toPrimitive");t&&!t[r]&&BW(t,r,function(i){return VW(n,this)},{})},WW=Ka,GW=vn,HW=go,KW=qa,zW=iD,fD=B([].push),YW=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,s=e===6,o=e===7,c=e===5||s;return function(l,p,m,E){for(var v,y,D=HW(l),A=GW(D),N=KW(A),j=WW(p,m),V=0,G=E||zW,$=t?G(l,N):n||o?G(l,0):void 0;N>V;V++)if((c||V in A)&&(y=j(v=A[V],V,D),e))if(t)$[V]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return V;case 2:fD($,v)}else switch(e){case 4:return!1;case 7:fD($,v)}return s?-1:r||i?i:$}},mD={forEach:YW(0)},JS=qt,mg=ie,JR=We,qW=B,df=Ge,uf=mo,XW=C,mi=fr,JW=Y,QR=$r,QS=ps,ZR=On,QW=Mi,$R=at,hf=Ou,_D=wi,ZW=Zo,gD=lD,$W=ql,ED=xe,vD=xi,eG=tc,SD=Ie,yD=aa,tG=ic,ew=Bc,TD=Gs,CD=Nl,nG=An,rG=lf,iG=Tr,sG=pD,oG=Co,RD=rc,ZS=mD.forEach,ys=zl("hidden"),$S="Symbol",_g="prototype",aG=RD.set,wD=RD.getterFor($S),fa=Object[_g],ch=mg.Symbol,ey=ch&&ch[_g],cG=mg.RangeError,lG=mg.TypeError,tw=mg.QObject,bD=ED.f,lh=vD.f,ID=gD.f,dG=SD.f,AD=qW([].push),cl=ew("symbols"),gg=ew("op-symbols"),uG=ew("wks"),nw=!tw||!tw[_g]||!tw[_g].findChild,OD=function(e,t,n){var r=bD(fa,t);r&&delete fa[t],lh(e,t,n),r&&e!==fa&&lh(fa,t,r)},rw=df&&XW(function(){return hf(lh({},"a",{get:function(){return lh(this,"a",{value:7}).a}})).a!==7})?OD:lh,iw=function(e,t){var n=cl[e]=hf(ey);return aG(n,{type:$S,tag:e,description:t}),df||(n.description=t),n},ty=function(e,t,n){e===fa&&ty(gg,t,n),QR(e);var r=ZR(t);return QR(n),mi(cl,r)?(n.enumerable?(mi(e,ys)&&e[ys][r]&&(e[ys][r]=!1),n=hf(n,{enumerable:$R(0,!1)})):(mi(e,ys)||lh(e,ys,$R(1,hf(null))),e[ys][r]=!0),rw(e,r,n)):lh(e,r,n)},sw=function(e,t){QR(e);var n=QS(t),r=_D(n).concat(kD(n));return ZS(r,function(i){df&&!JR(ND,n,i)||ty(e,i,n[i])}),e},ND=function(e){var t=ZR(e),n=JR(dG,this,t);return!(this===fa&&mi(cl,t)&&!mi(gg,t))&&(!(n||!mi(this,t)||!mi(cl,t)||mi(this,ys)&&this[ys][t])||n)},PD=function(e,t){var n=QS(e),r=ZR(t);if(n!==fa||!mi(cl,r)||mi(gg,r)){var i=bD(n,r);return!i||!mi(cl,r)||mi(n,ys)&&n[ys][r]||(i.enumerable=!0),i}},DD=function(e){var t=ID(QS(e)),n=[];return ZS(t,function(r){mi(cl,r)||mi(TD,r)||AD(n,r)}),n},kD=function(e){var t=e===fa,n=ID(t?gg:QS(e)),r=[];return ZS(n,function(i){!mi(cl,i)||t&&!mi(fa,i)||AD(r,cl[i])}),r};uf||(ch=function(){if(JW(ey,this))throw new lG("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?QW(arguments[0]):void 0,t=CD(e),n=function(r){var i=this===void 0?mg:this;i===fa&&JR(n,gg,r),mi(i,ys)&&mi(i[ys],t)&&(i[ys][t]=!1);var s=$R(1,r);try{rw(i,t,s)}catch(o){if(!(o instanceof cG))throw o;OD(i,t,s)}};return df&&nw&&rw(fa,t,{configurable:!0,set:n}),iw(t,e)},yD(ey=ch[_g],"toString",function(){return wD(this).tag}),yD(ch,"withoutSetter",function(e){return iw(CD(e),e)}),SD.f=ND,vD.f=ty,eG.f=sw,ED.f=PD,ZW.f=gD.f=DD,$W.f=kD,rG.f=function(e){return iw(nG(e),e)},df&&tG(ey,"description",{configurable:!0,get:function(){return wD(this).description}})),JS({global:!0,wrap:!0,forced:!uf,sham:!uf},{Symbol:ch}),ZS(_D(uG),function(e){iG(e)}),JS({target:$S,stat:!0,forced:!uf},{useSetter:function(){nw=!0},useSimple:function(){nw=!1}}),JS({target:"Object",stat:!0,forced:!uf,sham:!df},{create:function(e,t){return t===void 0?hf(e):sw(hf(e),t)},defineProperty:ty,defineProperties:sw,getOwnPropertyDescriptor:PD}),JS({target:"Object",stat:!0,forced:!uf},{getOwnPropertyNames:DD}),sG(),oG(ch,$S),TD[ys]=!0;var LD=mo&&!!Symbol.for&&!!Symbol.keyFor,hG=qt,pG=Ar,fG=fr,mG=Mi,xD=Bc,_G=LD,ow=xD("string-to-symbol-registry"),gG=xD("symbol-to-string-registry");hG({target:"Symbol",stat:!0,forced:!_G},{for:function(e){var t=mG(e);if(fG(ow,t))return ow[t];var n=pG("Symbol")(t);return ow[t]=n,gG[n]=t,n}});var EG=qt,vG=fr,SG=Fa,yG=fn,TG=LD,MD=Bc("symbol-to-string-registry");EG({target:"Symbol",stat:!0,forced:!TG},{keyFor:function(e){if(!SG(e))throw new TypeError(yG(e)+" is not a symbol");if(vG(MD,e))return MD[e]}});var UD=Jo,CG=Ue,VD=ue,RG=Mi,jD=B([].push),wG=qt,FD=Ar,BD=le,bG=We,Eg=B,WD=C,GD=Ue,HD=Fa,KD=yr,IG=function(e){if(CG(e))return e;if(UD(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?jD(n,i):typeof i!="number"&&VD(i)!=="Number"&&VD(i)!=="String"||jD(n,RG(i))}var s=n.length,o=!0;return function(c,l){if(o)return o=!1,l;if(UD(this))return l;for(var p=0;p<s;p++)if(n[p]===c)return l}}},AG=mo,OG=String,Ed=FD("JSON","stringify"),ny=Eg(/./.exec),zD=Eg("".charAt),NG=Eg("".charCodeAt),PG=Eg("".replace),DG=Eg(1 .toString),kG=/[\uD800-\uDFFF]/g,YD=/^[\uD800-\uDBFF]$/,qD=/^[\uDC00-\uDFFF]$/,XD=!AG||WD(function(){var e=FD("Symbol")("stringify detection");return Ed([e])!=="[null]"||Ed({a:e})!=="{}"||Ed(Object(e))!=="{}"}),JD=WD(function(){return Ed("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ed("\uDEAD")!=='"\\udead"'}),LG=function(e,t){var n=KD(arguments),r=IG(t);if(GD(r)||e!==void 0&&!HD(e))return n[1]=function(i,s){if(GD(r)&&(s=bG(r,this,OG(i),s)),!HD(s))return s},BD(Ed,null,n)},xG=function(e,t,n){var r=zD(n,t-1),i=zD(n,t+1);return ny(YD,e)&&!ny(qD,i)||ny(qD,e)&&!ny(YD,r)?"\\u"+DG(NG(e,0),16):e};Ed&&wG({target:"JSON",stat:!0,forced:XD||JD},{stringify:function(e,t,n){var r=KD(arguments),i=BD(XD?LG:Ed,null,r);return JD&&typeof i=="string"?PG(i,kG,xG):i}});var QD=ql,MG=go;qt({target:"Object",stat:!0,forced:!mo||C(function(){QD.f(1)})},{getOwnPropertySymbols:function(e){var t=QD.f;return t?t(MG(e)):[]}}),Tr("asyncIterator"),Tr("hasInstance"),Tr("isConcatSpreadable"),Tr("iterator"),Tr("match"),Tr("matchAll"),Tr("replace"),Tr("search"),Tr("species"),Tr("split");var UG=pD;Tr("toPrimitive"),UG();var VG=Ar,jG=Co;Tr("toStringTag"),jG(VG("Symbol"),"Symbol"),Tr("unscopables"),Co(ie.JSON,"JSON",!0);var FG=Qr.Symbol,BG=An,WG=xi.f,ZD=BG("metadata"),$D=Function.prototype;$D[ZD]===void 0&&WG($D,ZD,{value:null}),Tr("asyncDispose"),Tr("dispose"),Tr("metadata");var GG=FG,HG=B,aw=Ar("Symbol"),KG=aw.keyFor,zG=HG(aw.prototype.valueOf),ek=aw.isRegisteredSymbol||function(e){try{return KG(zG(e))!==void 0}catch{return!1}};qt({target:"Symbol",stat:!0},{isRegisteredSymbol:ek});for(var YG=Bc,tk=Ar,qG=B,XG=Fa,JG=An,ry=tk("Symbol"),nk=ry.isWellKnownSymbol,rk=tk("Object","getOwnPropertyNames"),QG=qG(ry.prototype.valueOf),ik=YG("wks"),cw=0,sk=rk(ry),ZG=sk.length;cw<ZG;cw++)try{var ok=sk[cw];XG(ry[ok])&&JG(ok)}catch{}var ak=function(e){if(nk&&nk(e))return!0;try{for(var t=QG(e),n=0,r=rk(ik),i=r.length;n<i;n++)if(ik[r[n]]==t)return!0}catch{}return!1};qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:ak}),Tr("customMatcher"),Tr("observable"),qt({target:"Symbol",stat:!0},{isRegistered:ek}),qt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:ak}),Tr("matcher"),Tr("metadataKey"),Tr("patternMatch"),Tr("replaceAll");var pf=S(GG),ck=S(lf.f("iterator"));function vg(e){return vg=typeof pf=="function"&&typeof ck=="symbol"?function(t){return typeof t}:function(t){return t&&typeof pf=="function"&&t.constructor===pf&&t!==pf.prototype?"symbol":typeof t},vg(e)}var $G=S(lf.f("toPrimitive"));function eH(e){var t=function(n,r){if(vg(n)!="object"||!n)return n;var i=n[$G];if(i!==void 0){var s=i.call(n,r);if(vg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return vg(t)=="symbol"?t:t+""}function x(e,t,n){return(t=eH(t))in e?tD(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var lk=S(eB),tH={isBrowser:!0,classes:{URLSearchParams:lk!==void 0?lk:XR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const lw=typeof window<"u"&&typeof document<"u",dw=typeof navigator=="object"&&navigator||void 0,nH=lw&&(!dw||["ReactNative","NativeScript","NS"].indexOf(dw.product)<0),rH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",iH=lw&&window.location.href||"http://localhost";function dk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function uk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dk(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Wi=uk(uk({},Object.freeze({__proto__:null,hasBrowserEnv:lw,hasStandardBrowserEnv:nH,hasStandardBrowserWebWorkerEnv:rH,navigator:dw,origin:iH})),tH),sH=$r,oH=We,aH=fr,cH=Y,lH=function(){var e=sH(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},hk=RegExp.prototype,pk=function(e){var t=e.flags;return t!==void 0||"flags"in hk||aH(e,"flags")||!cH(hk,e)?t:oH(lH,e)},dH=QC.charAt,fk=We,uH=$r,hH=Ue,pH=ue,fH=/./.exec,mH=TypeError,_H=qt,mk=We,_k=Ve,gH=Fu,iy=Mp,gk=Kr,Ek=av,Sg=Mi,EH=$r,vH=pr,SH=ue,yH=xm,vk=pk,TH=Xi,CH=C,RH=rl,wH=function(e,t,n){return t+(n?dH(e,t).length:1)},bH=function(e,t){var n=e.exec;if(hH(n)){var r=fk(n,e,t);return r!==null&&uH(r),r}if(pH(e)==="RegExp")return fk(fH,e,t);throw new mH("RegExp#exec called on incompatible receiver")},Sk=rc,IH=An("matchAll"),yk="RegExp String",Tk=yk+" Iterator",AH=Sk.set,OH=Sk.getterFor(Tk),NH=TypeError,uw=_k("".indexOf),sy=_k("".matchAll),hw=!!sy&&!CH(function(){sy("a",/./)}),PH=gH(function(e,t,n,r){AH(this,{type:Tk,regexp:e,string:t,global:n,unicode:r,done:!1})},yk,function(){var e=OH(this);if(e.done)return iy(void 0,!0);var t=e.regexp,n=e.string,r=bH(t,n);return r===null?(e.done=!0,iy(void 0,!0)):e.global?(Sg(r[0])===""&&(t.lastIndex=wH(n,Ek(t.lastIndex),e.unicode)),iy(r,!1)):(e.done=!0,iy(r,!1))}),Ck=function(e){var t,n,r,i=EH(this),s=Sg(e),o=RH(i,RegExp),c=Sg(vk(i));return t=new o(o===RegExp?i.source:i,c),n=!!~uw(c,"g"),r=!!~uw(c,"u"),t.lastIndex=Ek(i.lastIndex),new PH(t,s,n,r)};_H({target:"String",proto:!0,forced:hw},{matchAll:function(e){var t,n,r,i,s=gk(this);if(vH(e)){if(yH(e)&&(t=Sg(gk(vk(e))),!~uw(t,"g")))throw new NH("`.matchAll` does not allow non-global regexes");if(hw)return sy(s,e);if((r=TH(e,IH))===void 0&&SH(e)==="RegExp"&&(r=Ck),r)return mk(r,e,s)}else if(hw)return sy(s,e);return n=Sg(s),i=new RegExp(e,"g"),mk(Ck,i,n)}});var DH=Qi("String","matchAll"),kH=Y,LH=DH,pw=String.prototype,xH=function(e){var t=e.matchAll;return typeof e=="string"||e===pw||kH(pw,e)&&t===pw.matchAll?LH:t},MH=S(xH);function Rk(e){function t(n,r,i,s){let o=n[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),l=s>=n.length;return o=!o&&Me.isArray(i)?i.length:o,l?(Me.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!c):(i[o]&&Me.isObject(i[o])||(i[o]=[]),t(n,r,i[o],s)&&Me.isArray(i[o])&&(i[o]=function(p){const m={},E=Object.keys(p);let v;const y=E.length;let D;for(v=0;v<y;v++)D=E[v],m[D]=p[D];return m}(i[o])),!c)}if(Me.isFormData(e)&&Me.isFunction(e.entries)){const n={};return Me.forEachEntry(e,(r,i)=>{t(function(s){return MH(Me).call(Me,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])}(r),i,n,0)}),n}return null}const fw={transitional:QP,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Me.isObject(e);if(i&&Me.isHTMLForm(e)&&(e=new FormData(e)),Me.isFormData(e))return r?JSON.stringify(Rk(e)):e;if(Me.isArrayBuffer(e)||Me.isBuffer(e)||Me.isStream(e)||Me.isFile(e)||Me.isBlob(e)||Me.isReadableStream(e))return e;if(Me.isArrayBufferView(e))return e.buffer;if(Me.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(o,c){return XS(o,new Wi.classes.URLSearchParams,Object.assign({visitor:function(l,p,m,E){return Wi.isNode&&Me.isBuffer(l)?(this.append(p,l.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},c))}(e,this.formSerializer).toString();if((s=Me.isFileList(e))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return XS(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(o,c,l){if(Me.isString(o))try{return(c||JSON.parse)(o),ri(Me).call(Me,o)}catch(p){if(p.name!=="SyntaxError")throw p}return(l||JSON.stringify)(o)}(e)):e}],transformResponse:[function(e){const t=this.transitional||fw.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Me.isResponse(e)||Me.isReadableStream(e))return e;if(e&&Me.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(i)throw s.name==="SyntaxError"?tn.from(s,tn.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wi.classes.FormData,Blob:Wi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Me.forEach(["delete","get","head","post","put","patch"],e=>{fw.headers[e]={}});var mw=fw;const UH=Me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wk=Symbol("internals");function yg(e){var t;return e&&ri(t=String(e)).call(t).toLowerCase()}function oy(e){return e===!1||e==null?e:Me.isArray(e)?e.map(oy):String(e)}function _w(e,t,n,r,i){return Me.isFunction(r)?r.call(this,t,n):(i&&(t=n),Me.isString(t)?Me.isString(r)?t.indexOf(r)!==-1:Me.isRegExp(r)?r.test(t):void 0:void 0)}class ay{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function s(l,p,m){const E=yg(p);if(!E)throw new Error("header name must be a non-empty string");const v=Me.findKey(i,E);(!v||i[v]===void 0||m===!0||m===void 0&&i[v]!==!1)&&(i[v||p]=oy(l))}const o=(l,p)=>Me.forEach(l,(m,E)=>s(m,E,p));if(Me.isPlainObject(t)||t instanceof this.constructor)o(t,n);else if(Me.isString(t)&&(t=ri(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ri(c=t).call(c)))o((l=>{const p={};let m,E,v;return l&&l.split(`
`).forEach(function(y){var D,A;v=y.indexOf(":"),m=ri(D=y.substring(0,v)).call(D).toLowerCase(),E=ri(A=y.substring(v+1)).call(A),!m||p[m]&&UH[m]||(m==="set-cookie"?p[m]?p[m].push(E):p[m]=[E]:p[m]=p[m]?p[m]+", "+E:E)}),p})(t),n);else if(Me.isObject(t)&&Me.isIterable(t)){let l,p,m={};for(const E of t){if(!Me.isArray(E))throw TypeError("Object iterator must return a key-value pair");m[p=E[0]]=(l=m[p])?Me.isArray(l)?[...l,E[1]]:[l,E[1]]:E[1]}o(m,n)}else t!=null&&s(n,t,r);var c;return this}get(t,n){if(t=yg(t)){const r=Me.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(s){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=c.exec(s);)o[l[1]]=l[2];return o}(i);if(Me.isFunction(n))return n.call(this,i,r);if(Me.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=yg(t)){const r=Me.findKey(this,t);return!(!r||this[r]===void 0||n&&!_w(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function s(o){if(o=yg(o)){const c=Me.findKey(r,o);!c||n&&!_w(0,r[c],c,n)||(delete r[c],i=!0)}}return Me.isArray(t)?t.forEach(s):s(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];t&&!_w(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const n=this,r={};return Me.forEach(this,(i,s)=>{var o;const c=Me.findKey(r,s);if(c)return n[c]=oy(i),void delete n[s];const l=t?function(p){return ri(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,E,v)=>E.toUpperCase()+v)}(s):ri(o=String(s)).call(o);l!==s&&delete n[s],n[l]=oy(i),r[l]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Me.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&Me.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[wk]=this[wk]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=yg(s);n[o]||(function(c,l){const p=Me.toCamelCase(" "+l);["get","set","has"].forEach(m=>{Object.defineProperty(c,m+p,{value:function(E,v,y){return this[m].call(this,l,E,v,y)},configurable:!0})})}(r,s),n[o]=!0)}return Me.isArray(t)?t.forEach(i):i(t),this}}ay.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Me.reduceDescriptors(ay.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),Me.freezeMethods(ay);var ma=ay;function gw(e,t){const n=this||mw,r=t||n,i=ma.from(r.headers);let s=r.data;return Me.forEach(e,function(o){s=o.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function bk(e){return!(!e||!e.__CANCEL__)}function ff(e,t,n){tn.call(this,e??"canceled",tn.ERR_CANCELED,t,n),this.name="CanceledError"}function Ik(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new tn("Request failed with status code "+n.status,[tn.ERR_BAD_REQUEST,tn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Me.inherits(ff,tn,{__CANCEL__:!0});const cy=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(s,o){s=s||10;const c=new Array(s),l=new Array(s);let p,m=0,E=0;return o=o!==void 0?o:1e3,function(v){const y=Date.now(),D=l[E];p||(p=y),c[m]=v,l[m]=y;let A=E,N=0;for(;A!==m;)N+=c[A++],A%=s;if(m=(m+1)%s,m===E&&(E=(E+1)%s),y-p<o)return;const j=D&&y-D;return j?Math.round(1e3*N/j):void 0}}(50,250);return function(s,o){let c,l,p=0,m=1e3/o;const E=function(v){p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,l&&(clearTimeout(l),l=null),s.apply(null,v)};return[function(){const v=Date.now(),y=v-p;for(var D=arguments.length,A=new Array(D),N=0;N<D;N++)A[N]=arguments[N];y>=m?E(A,v):(c=A,l||(l=setTimeout(()=>{l=null,E(c)},m-y)))},()=>c&&E(c)]}(s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,l=o-r,p=i(l);r=o,e({loaded:o,total:c,progress:c?o/c:void 0,bytes:l,rate:p||void 0,estimated:p&&c&&o<=c?(c-o)/p:void 0,event:s,lengthComputable:c!=null,[t?"download":"upload"]:!0})},n)},Ak=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Ok=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Me.asap(()=>e(...n))};var VH=Wi.hasStandardBrowserEnv?((e,t)=>n=>(n=new MS(n,Wi.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new MS(Wi.origin),Wi.navigator&&/(msie|trident)/i.test(Wi.navigator.userAgent)):()=>!0,jH=Wi.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const o=[e+"="+encodeURIComponent(t)];Me.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Me.isString(r)&&o.push("path="+r),Me.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Nk(e,t,n){let r=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t);return e&&(r||n==0)?function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i}(e,t):t}function Pk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const Dk=e=>e instanceof ma?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Pk(Object(r),!0).forEach(function(i){x(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pk(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e):e;function dh(e,t){t=t||{};const n={};function r(p,m,E,v){return Me.isPlainObject(p)&&Me.isPlainObject(m)?Me.merge.call({caseless:v},p,m):Me.isPlainObject(m)?Me.merge({},m):Me.isArray(m)?m.slice():m}function i(p,m,E,v){return Me.isUndefined(m)?Me.isUndefined(p)?void 0:r(void 0,p,0,v):r(p,m,0,v)}function s(p,m){if(!Me.isUndefined(m))return r(void 0,m)}function o(p,m){return Me.isUndefined(m)?Me.isUndefined(p)?void 0:r(void 0,p):r(void 0,m)}function c(p,m,E){return E in t?r(p,m):E in e?r(void 0,p):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(p,m,E)=>i(Dk(p),Dk(m),0,!0)};return Me.forEach(Object.keys(Object.assign({},e,t)),function(p){const m=l[p]||i,E=m(e[p],t[p],p);Me.isUndefined(E)&&m!==c||(n[p]=E)}),n}var kk=e=>{const t=dh({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:l}=t;if(t.headers=c=ma.from(c),t.url=XP(Nk(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&c.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Me.isFormData(r)){if(Wi.hasStandardBrowserEnv||Wi.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((n=c.getContentType())!==!1){const[p,...m]=n?n.split(";").map(E=>ri(E).call(E)).filter(Boolean):[];c.setContentType([p||"multipart/form-data",...m].join("; "))}}if(Wi.hasStandardBrowserEnv&&(i&&Me.isFunction(i)&&(i=i(t)),i||i!==!1&&VH(t.url))){const p=s&&o&&jH.read(o);p&&c.set(s,p)}return t},FH=typeof XMLHttpRequest<"u"&&function(e){return new je(function(t,n){const r=kk(e);let i=r.data;const s=ma.from(r.headers).normalize();let o,c,l,p,m,{responseType:E,onUploadProgress:v,onDownloadProgress:y}=r;function D(){p&&p(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let A=new XMLHttpRequest;function N(){if(!A)return;const V=ma.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());Ik(function(G){t(G),D()},function(G){n(G),D()},{data:E&&E!=="text"&&E!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:V,config:e,request:A}),A=null}A.open(r.method.toUpperCase(),r.url,!0),A.timeout=r.timeout,"onloadend"in A?A.onloadend=N:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(N)},A.onabort=function(){A&&(n(new tn("Request aborted",tn.ECONNABORTED,e,A)),A=null)},A.onerror=function(){n(new tn("Network Error",tn.ERR_NETWORK,e,A)),A=null},A.ontimeout=function(){let V=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const G=r.transitional||QP;r.timeoutErrorMessage&&(V=r.timeoutErrorMessage),n(new tn(V,G.clarifyTimeoutError?tn.ETIMEDOUT:tn.ECONNABORTED,e,A)),A=null},i===void 0&&s.setContentType(null),"setRequestHeader"in A&&Me.forEach(s.toJSON(),function(V,G){A.setRequestHeader(G,V)}),Me.isUndefined(r.withCredentials)||(A.withCredentials=!!r.withCredentials),E&&E!=="json"&&(A.responseType=r.responseType),y&&([l,m]=cy(y,!0),A.addEventListener("progress",l)),v&&A.upload&&([c,p]=cy(v),A.upload.addEventListener("progress",c),A.upload.addEventListener("loadend",p)),(r.cancelToken||r.signal)&&(o=V=>{A&&(n(!V||V.type?new ff(null,e,A):V),A.abort(),A=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const j=function(V){const G=/^([-+\w]{1,25})(:?\/\/|:)/.exec(V);return G&&G[1]||""}(r.url);j&&Wi.protocols.indexOf(j)===-1?n(new tn("Unsupported protocol "+j+":",tn.ERR_BAD_REQUEST,e)):A.send(i||null)})},BH=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController;const s=function(p){if(!r){r=!0,c();const m=p instanceof Error?p:this.reason;i.abort(m instanceof tn?m:new ff(m instanceof Error?m.message:m))}};let o=t&&setTimeout(()=>{o=null,s(new tn("timeout ".concat(t," of ms exceeded"),tn.ETIMEDOUT))},t);const c=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(p=>{p.unsubscribe?p.unsubscribe(s):p.removeEventListener("abort",s)}),e=null)};e.forEach(p=>p.addEventListener("abort",s));const{signal:l}=i;return l.unsubscribe=()=>Me.asap(c),l}},Ew=S(SO),Lk=lf.f("asyncIterator"),WH=S(Lk);function vw(e,t){this.v=e,this.k=t}function Js(e){return function(){return new Tg(e.apply(this,arguments))}}function Tg(e){var t,n;function r(s,o){try{var c=e[s](o),l=c.value,p=l instanceof vw;Ew.resolve(p?l.v:l).then(function(m){if(p){var E=s==="return"?"return":"next";if(!l.k||m.done)return r(E,m);m=e[E](m).value}i(c.done?"return":"normal",m)},function(m){r("throw",m)})}catch(m){i("throw",m)}}function i(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(s,o){return new Ew(function(c,l){var p={key:s,arg:o,resolve:c,reject:l,next:null};n?n=n.next=p:(t=n=p,r(s,o))})},typeof e.return!="function"&&(this.return=void 0)}function jt(e){return new vw(e,0)}function ly(e){var t={},n=!1;function r(i,s){return n=!0,s=new Ew(function(o){o(e[i](s))}),{done:!1,value:new vw(s,1)}}return t[pf!==void 0&&ck||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}Tg.prototype[typeof pf=="function"&&WH||"@@asyncIterator"]=function(){return this},Tg.prototype.next=function(e){return this._invoke("next",e)},Tg.prototype.throw=function(e){return this._invoke("throw",e)},Tg.prototype.return=function(e){return this._invoke("return",e)};var Sw=S(Lk);function yw(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=Sw,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new dy(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function dy(e){function t(n){if(Object(n)!==n)return je.reject(new TypeError(n+" is not an object."));var r=n.done;return je.resolve(n.value).then(function(i){return{value:i,done:r}})}return dy=function(n){this.s=n,this.n=n.next},dy.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?je.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?je.reject(n):t(r.apply(this.s,arguments))}},new dy(e)}const GH=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},HH=function(){var e=Js(function*(t,n){var r,i=!1,s=!1;try{for(var o,c=yw(KH(t));i=!(o=yield jt(c.next())).done;i=!1){const l=o.value;yield*ly(yw(GH(l,n)))}}catch(l){s=!0,r=l}finally{try{i&&c.return!=null&&(yield jt(c.return()))}finally{if(s)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),KH=function(){var e=Js(function*(t){if(t[Sw])return void(yield*ly(yw(t)));const n=t.getReader();try{for(;;){const{done:r,value:i}=yield jt(n.read());if(r)break;yield i}}finally{yield jt(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),xk=(e,t,n,r)=>{const i=HH(e,t);let s,o=0,c=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:p,value:m}=await i.next();if(p)return c(),void l.close();let E=m.byteLength;if(n){let v=o+=E;n(v)}l.enqueue(new Uint8Array(m))}catch(p){throw c(p),p}},cancel:l=>(c(l),i.return())},{highWaterMark:2})};function Mk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Uk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Mk(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const uy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Vk=uy&&typeof ReadableStream=="function",zH=uy&&(typeof TextEncoder=="function"?(jk=new TextEncoder,e=>jk.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var jk;const Fk=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},YH=Vk&&Fk(()=>{let e=!1;const t=new Request(Wi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Tw=Vk&&Fk(()=>Me.isReadableStream(new Response("").body)),hy={stream:Tw&&(e=>e.body)};var Bk;uy&&(Bk=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!hy[e]&&(hy[e]=Me.isFunction(Bk[e])?t=>t[e]():(t,n)=>{throw new tn("Response type '".concat(e,"' is not supported"),tn.ERR_NOT_SUPPORT,n)})}));const qH=async(e,t)=>{const n=Me.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:Me.isBlob(r)?r.size:Me.isSpecCompliantForm(r)?(await new Request(Wi.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Me.isArrayBufferView(r)||Me.isArrayBuffer(r)?r.byteLength:(Me.isURLSearchParams(r)&&(r+=""),Me.isString(r)?(await zH(r)).byteLength:void 0))(t)};var XH=uy&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:l,responseType:p,headers:m,withCredentials:E="same-origin",fetchOptions:v}=kk(e);p=p?(p+"").toLowerCase():"text";let y,D=BH([i,s&&s.toAbortSignal()],o);const A=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let N;try{if(l&&YH&&n!=="get"&&n!=="head"&&(N=await qH(m,r))!==0){let Q,z=new Request(t,{method:"POST",body:r,duplex:"half"});if(Me.isFormData(r)&&(Q=z.headers.get("content-type"))&&m.setContentType(Q),z.body){const[re,fe]=Ak(N,cy(Ok(l)));r=xk(z.body,65536,re,fe)}}Me.isString(E)||(E=E?"include":"omit");const j="credentials"in Request.prototype;y=new Request(t,Uk(Uk({},v),{},{signal:D,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:r,duplex:"half",credentials:j?E:void 0}));let V=await fetch(y);const G=Tw&&(p==="stream"||p==="response");if(Tw&&(c||G&&A)){const Q={};["status","statusText","headers"].forEach(ve=>{Q[ve]=V[ve]});const z=Me.toFiniteNumber(V.headers.get("content-length")),[re,fe]=c&&Ak(z,cy(Ok(c),!0))||[];V=new Response(xk(V.body,65536,re,()=>{fe&&fe(),A&&A()}),Q)}p=p||"text";let $=await hy[Me.findKey(hy,p)||"text"](V,e);return!G&&A&&A(),await new je((Q,z)=>{Ik(Q,z,{data:$,headers:ma.from(V.headers),status:V.status,statusText:V.statusText,config:e,request:y})})}catch(j){throw A&&A(),j&&j.name==="TypeError"&&/Load failed|fetch/i.test(j.message)?Object.assign(new tn("Network Error",tn.ERR_NETWORK,e,y),{cause:j.cause||j}):tn.from(j,j&&j.code,e,y)}});const Cw={http:null,xhr:FH,fetch:XH};Me.forEach(Cw,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Wk=e=>"- ".concat(e),JH=e=>Me.isFunction(e)||e===null||e===!1;var Gk={getAdapter:e=>{e=Me.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let o;if(n=e[s],r=n,!JH(n)&&(r=Cw[(o=String(n)).toLowerCase()],r===void 0))throw new tn("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map(o=>{let[c,l]=o;return"adapter ".concat(c," ")+(l===!1?"is not supported by the environment":"is not available in the build")});throw new tn("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(Wk).join(`
`):" "+Wk(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:Cw};function Rw(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ff(null,e)}function Hk(e){return Rw(e),e.headers=ma.from(e.headers),e.data=gw.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Gk.getAdapter(e.adapter||mw.adapter)(e).then(function(t){return Rw(e),t.data=gw.call(e,e.transformResponse,t),t.headers=ma.from(t.headers),t},function(t){return bk(t)||(Rw(e),t&&t.response&&(t.response.data=gw.call(e,e.transformResponse,t.response),t.response.headers=ma.from(t.response.headers))),je.reject(t)})}const Kk="1.9.0",py={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{py[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const zk={};py.transitional=function(e,t,n){function r(i,s){return"[Axios v"+Kk+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,o)=>{if(e===!1)throw new tn(r(s," has been removed"+(t?" in "+t:"")),tn.ERR_DEPRECATED);return t&&!zk[s]&&(zk[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,o)}},py.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var fy={assertOptions:function(e,t,n){if(typeof e!="object")throw new tn("options must be an object",tn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],o=t[s];if(o){const c=e[s],l=c===void 0||o(c,s,e);if(l!==!0)throw new tn("option "+s+" must be "+l,tn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new tn("Unknown option "+s,tn.ERR_BAD_OPTION)}},validators:py};const _c=fy.validators;let my=class{constructor(e){this.defaults=e||{},this.interceptors={request:new JP,response:new JP}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=dh(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&fy.assertOptions(n,{silentJSONParsing:_c.transitional(_c.boolean),forcedJSONParsing:_c.transitional(_c.boolean),clarifyTimeoutError:_c.transitional(_c.boolean)},!1),r!=null&&(Me.isFunction(r)?t.paramsSerializer={serialize:r}:fy.assertOptions(r,{encode:_c.function,serialize:_c.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),fy.assertOptions(t,{baseUrl:_c.spelling("baseURL"),withXsrfToken:_c.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Me.merge(i.common,i[t.method]);i&&Me.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),t.headers=ma.concat(s,i);const o=[];let c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(c=c&&y.synchronous,o.unshift(y.fulfilled,y.rejected))});const l=[];let p;this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let m,E=0;if(!c){const y=[Hk.bind(this),void 0];for(y.unshift.apply(y,o),y.push.apply(y,l),m=y.length,p=je.resolve(t);E<m;)p=p.then(y[E++],y[E++]);return p}m=o.length;let v=t;for(E=0;E<m;){const y=o[E++],D=o[E++];try{v=y(v)}catch(A){D.call(this,A);break}}try{p=Hk.call(this,v)}catch(y){return je.reject(y)}for(E=0,m=l.length;E<m;)p=p.then(l[E++],l[E++]);return p}getUri(e){return XP(Nk((e=dh(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Me.forEach(["delete","get","head","options"],function(e){my.prototype[e]=function(t,n){return this.request(dh(n||{},{method:e,url:t,data:(n||{}).data}))}}),Me.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,s){return this.request(dh(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}my.prototype[e]=t(),my.prototype[e+"Form"]=t(!0)});var _y=my;class ww{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new je(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new je(c=>{r.subscribe(c),s=c}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},t(function(i,s,o){r.reason||(r.reason=new ff(i,s,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new ww(function(r){t=r}),cancel:t}}}var QH=ww;const bw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(bw).forEach(e=>{let[t,n]=e;bw[n]=t});var ZH=bw;const Yr=function e(t){const n=new _y(t),r=DP(_y.prototype.request,n);return Me.extend(r,_y.prototype,n,{allOwnKeys:!0}),Me.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(dh(t,i))},r}(mw);Yr.Axios=_y,Yr.CanceledError=ff,Yr.CancelToken=QH,Yr.isCancel=bk,Yr.VERSION=Kk,Yr.toFormData=XS,Yr.AxiosError=tn,Yr.Cancel=Yr.CanceledError,Yr.all=function(e){return je.all(e)},Yr.spread=function(e){return function(t){return e.apply(null,t)}},Yr.isAxiosError=function(e){return Me.isObject(e)&&e.isAxiosError===!0},Yr.mergeConfig=dh,Yr.AxiosHeaders=ma,Yr.formToJSON=e=>Rk(Me.isHTMLForm(e)?new FormData(e):e),Yr.getAdapter=Gk.getAdapter,Yr.HttpStatusCode=ZH,Yr.default=Yr;var Ai=Yr;const $H=()=>{};function Cg(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:$H};return e.promise=new je((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const gy=new Map,Ey=new Map,gc=new Map;let dr=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Wt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Yk=new O2;let _a=Yk.getResult(),Iw=null;function xt(e){if(!Iw){_a=Yk.getResult();const t=function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return Wt.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Wt.CHROME;case"Safari":case"Mobile Safari":return Wt.SAFARI;case"Edge":return Wt.EDGE;case"Firefox":return Wt.FIREFOX;case"QQ":case"QQBrowser":return Wt.QQ;case"Opera":return Wt.OPERA;case"WeChat":return Wt.WECHAT;default:return c.browser.name||""}}(_a),n=qk(_a),r=function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""}(_a),i=_a.os.version,s=qk(_a,!1),o=_a.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o};Iw={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o}}return Iw}function qk(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function vy(){return xt().os}function Xk(){const e=xt();return"".concat(e.os," ").concat(e.osVersion)}function Sy(){const e=xt();return!!(_a.engine.name==="WebKit"&&e.os===dr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Wt.SAFARI||qr()&&e.name!==Wt.SAFARI)}function ll(){return xt().name===Wt.CHROME}function Nr(){return xt().name===Wt.SAFARI}function Jk(){const e=xt();if(e.name!==Wt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function Qk(){return xt().name===Wt.EDGE}function Nn(){return xt().name===Wt.FIREFOX}function qr(){return xt().os===dr.IOS}function mf(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)>=e}function Zk(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)<e}function Aw(e,t,n){const r=xt();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function Ow(e){const t=xt();return!(t.name!==Wt.EDGE||!t.osVersion)&&Number(t.version)>=e}function Nw(e){const t=xt();return!(t.name!==Wt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function $k(e){const t=xt();return!(t.name!==Wt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function eL(e,t,n){const r=xt();if(r.os!==dr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function tL(e,t,n){const r=xt();if(r.os!==dr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function Pw(e,t,n){const r=xt();if(r.name!==Wt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function Dw(e){const t=xt();return!(t.name!==Wt.OPERA||!t.osVersion)&&Number(t.version)>=e}function nL(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function _f(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function kw(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function rL(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Lo(){return Nr()&&navigator.maxTouchPoints>0}function iL(){return xt().name===Wt.WECHAT}function sL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Lw(){const e=vy();return function(){const{deviceType:t}=xt();return t==="mobile"||t==="tablet"}()||e===dr.ANDROID||e===dr.IOS||e===dr.HARMONY_OS}function dl(){const e=xt();return e.name!==Wt.EDGE&&e.name!==Wt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function yy(){return vy()===dr.ANDROID}function Rg(){const e=xt();return yy()&&(e.name===Wt.CHROME||e.name===Wt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function pt(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oL(Object(n),!0).forEach(function(r){pt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let F=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),pe=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),pt(this,"code",void 0),pt(this,"message",void 0),pt(this,"data",void 0),pt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ga(e,t){if(typeof e!="boolean")throw new pe(F.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ir(e,t,n){if(!Ae(n).call(n,e))throw new pe(F.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function nn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new pe(F.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function xw(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new pe(F.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&nn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&nn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&nn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&nn(e.ideal,"".concat(t,".ideal"),1,1/0)}else nn(e,t,1,1/0)}function Cr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new pe(F.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!aL(e,n,r,i))throw new pe(F.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function ul(e,t){if(!Array.isArray(e))throw new pe(F.INVALID_PARAMS,"".concat(t," should be an array"))}function Pn(e){return e==null}function aL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0}(e))}var wg=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(wg||{}),Mw=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Mw||{});const cL=new class{constructor(){pt(this,"_clientSize",null),pt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),pt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),pt(this,"getStyle",e=>window.getComputedStyle(e,null)),pt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:o,filter:c}=r;return(i==="none"||Ae(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(n=!1),!!n&&(c&&c.split(" ").filter(l=>{var p;const m=l.split("(")[0];return Ae(p=["brightness","blur","opacity"]).call(p,m)}).map(l=>{const[p,m]=l.split(/\(|\)/);return[p,Number(m.match(/^[0-9\.]+/))]}).forEach(l=>{const[p,m]=l;switch(p){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),pt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=o=>t(o);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),pt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),pt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:o}=e.getBoundingClientRect(),c=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:o,clientWidth:c,clientHeight:l,clientMin:Math.min(c,l)}}),pt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),pt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),pt(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),pt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,o=[],c=10**6;for(let l=0;l<5;l++)for(let p=0;p<5;p++){const m=(n*c+(l===0?.1:l===4?(i*l*c-1e5)/c:i*l)*c)/c,E=(r*c+(p===0?.1:p===4?(s*p*c-1e5)/c:s*p)*c)/c;o.push({x:m,y:E})}return[...o]}),pt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),pt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),pt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let c,l,p,m;if(e<0)c=0;else{if(!(e<s))return!1;c=e}if(t<0)return!1;if(l=t<s?t:s,n<0)p=0;else{if(!(n<i))return!1;p=n}if(r<0)return!1;m=r<i?r:i;const E=l-c,v=m-p;return this.checkSizeIsVisible(E,v,o)}),pt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),pt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(wg.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(wg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(wg.SIZE)}}return this.returnHiddenResult(wg.STYLE)}return this.returnHiddenResult(Mw.UNMOUNTED)}return this.returnHiddenResult(Mw.INVALID_HTML_ELEMENT)}),pt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Uw(e){return new TextEncoder().encode(e)}const lL=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Vw=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",Uw(e)),16);class bn{constructor(){pt(this,"_events",{}),pt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],i=this._indexOfListener(r,n);i!==-1&&r.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(o=>o);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(let o=0;o<n.length;o+=1){const c=n[o];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o?.toString()))}})}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}let bg=null;function dL(){if(bg)return bg;if(window.electron)return bg=window.electron;if(!window.require)return null;try{return bg=window.require("electron"),bg}catch{return null}}let xn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Tn=function(e){return e.TRACER="tracer",e}({});function uL(e){return nn(e.timeout,"config.timeout",0,1e5),nn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),nn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),nn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let eK=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Xt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Ig(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function hL(e){return Cr(e.turnServerURL,"turnServerURL"),Cr(e.username,"username"),Cr(e.password,"password"),e.udpport&&nn(e.udpport,"udpport",1,99999,!0),e.forceturn&&ga(e.forceturn,"forceturn"),e.security&&ga(e.security,"security"),e.tcpport&&nn(e.tcpport,"tcpport",1,99999,!0),!0}function jw(e){return e.level!==void 0&&ir(e.level,"level",[1,2,3]),e.delay!==void 0&&nn(e.delay,"delay",0,3e3,!0),!0}let Nt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Pr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),os=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),gf=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Dr(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?je.reject(new pe(F.UNEXPECTED_ERROR,"can not emit promise")):new je((s,o)=>{e.emit(t,...r,s,o)})}function sn(e,t){if(e.getListeners(t).length===0)return je.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Dr(e,t,...r)}function Ts(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Ag(e,t,...r)}function Ag(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(e.emit(t,...s,c=>{n=c},c=>{r=c}),r!==null)throw r;if(n===null)throw new pe(F.UNEXPECTED_ERROR,"handler is not sync");return n}const Gn=new class extends bn{set networkState(e){this.emit(gf.NETWORK_STATE_CHANGE,e,this._networkState),e===os.ONLINE?this.emit(gf.ONLINE):e===os.OFFLINE&&(this.onlineWaiter=new je(t=>{this.once(gf.ONLINE,()=>{this.onlineWaiter=void 0,t(os.ONLINE)})}),this.emit(gf.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===os.ONLINE}constructor(){super(),pt(this,"_moduleName","network-indicator"),pt(this,"_networkState",os.ONLINE),pt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=os.ONLINE}),window.addEventListener("offline",()=>{this.networkState=os.OFFLINE})}};function Ty(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Ef(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Cy(e){je!==void 0?je.resolve().then(e):setTimeout(e,0)}function Cn(e){return JSON.parse(JSON.stringify(e))}function uh(e){try{return Cn(e)}catch{return e}}const pL={};function vd(e,t){pL[t]||(pL[t]=!0,e())}function hh(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Sd(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function fL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function mL(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Ui(t).call(t,(o,c)=>o+c.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach(o=>{i.set(o,s),s+=o.length}),i}function Ec(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function _L(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Ec(n):n.size}),t+138}function tK(e){const t=new pe(F.TIMEOUT,"timeout");return new je((n,r)=>{window.setTimeout(()=>r(t),e)})}function Rr(e){return new je(t=>{window.setTimeout(t,e)})}function on(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+on(e-n.length,"")}function ph(){return on(32,"").toUpperCase()}const Ry=()=>{},gL=new class{constructor(){pt(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==n){c.fn(...c.args),clearTimeout(c.timer);const l=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:s,skipFn:r})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,we(we({},c),{},{fn:e,args:s,skipFn:r}))}else{const c=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:c,args:s,skipFn:r})}}},EL=gL.throttleByKey.bind(gL);function vL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function Fw(e,t){if(!vL(e)||!vL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=Fw(e[r],t[r]);return n}{const n=we({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=Fw(e[r],t[r]):n[r]=t[r]);return n}}function SL(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function vf(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Bw(e){return Ui(e).call(e,(t,n)=>t+n,0)}function yL(e){const t="0123456789abcdef";function n(G){let $,Q="";for($=0;$<=3;$++)Q+=t.charAt(G>>8*$+4&15)+t.charAt(G>>8*$&15);return Q}function r(G,$){const Q=(65535&G)+(65535&$);return(G>>16)+($>>16)+(Q>>16)<<16|65535&Q}function i(G,$,Q,z,re,fe){return r(function(ve,Re){return ve<<Re|ve>>>32-Re}(r(r($,G),r(z,fe)),re),Q)}function s(G,$,Q,z,re,fe,ve){return i($&Q|~$&z,G,$,re,fe,ve)}function o(G,$,Q,z,re,fe,ve){return i($&z|Q&~z,G,$,re,fe,ve)}function c(G,$,Q,z,re,fe,ve){return i($^Q^z,G,$,re,fe,ve)}function l(G,$,Q,z,re,fe,ve){return i(Q^($|~z),G,$,re,fe,ve)}const p=function(G){let $;const Q=1+(G.length+8>>6),z=new Array(16*Q);for($=0;$<16*Q;$++)z[$]=0;for($=0;$<G.length;$++)z[$>>2]|=G.charCodeAt($)<<$%4*8;return z[$>>2]|=128<<$%4*8,z[16*Q-2]=8*G.length,z}(e);let m,E,v,y,D,A=1732584193,N=-271733879,j=-1732584194,V=271733878;for(m=0;m<p.length;m+=16)E=A,v=N,y=j,D=V,A=s(A,N,j,V,p[m+0],7,-680876936),V=s(V,A,N,j,p[m+1],12,-389564586),j=s(j,V,A,N,p[m+2],17,606105819),N=s(N,j,V,A,p[m+3],22,-1044525330),A=s(A,N,j,V,p[m+4],7,-176418897),V=s(V,A,N,j,p[m+5],12,1200080426),j=s(j,V,A,N,p[m+6],17,-1473231341),N=s(N,j,V,A,p[m+7],22,-45705983),A=s(A,N,j,V,p[m+8],7,1770035416),V=s(V,A,N,j,p[m+9],12,-1958414417),j=s(j,V,A,N,p[m+10],17,-42063),N=s(N,j,V,A,p[m+11],22,-1990404162),A=s(A,N,j,V,p[m+12],7,1804603682),V=s(V,A,N,j,p[m+13],12,-40341101),j=s(j,V,A,N,p[m+14],17,-1502002290),N=s(N,j,V,A,p[m+15],22,1236535329),A=o(A,N,j,V,p[m+1],5,-165796510),V=o(V,A,N,j,p[m+6],9,-1069501632),j=o(j,V,A,N,p[m+11],14,643717713),N=o(N,j,V,A,p[m+0],20,-373897302),A=o(A,N,j,V,p[m+5],5,-701558691),V=o(V,A,N,j,p[m+10],9,38016083),j=o(j,V,A,N,p[m+15],14,-660478335),N=o(N,j,V,A,p[m+4],20,-405537848),A=o(A,N,j,V,p[m+9],5,568446438),V=o(V,A,N,j,p[m+14],9,-1019803690),j=o(j,V,A,N,p[m+3],14,-187363961),N=o(N,j,V,A,p[m+8],20,1163531501),A=o(A,N,j,V,p[m+13],5,-1444681467),V=o(V,A,N,j,p[m+2],9,-51403784),j=o(j,V,A,N,p[m+7],14,1735328473),N=o(N,j,V,A,p[m+12],20,-1926607734),A=c(A,N,j,V,p[m+5],4,-378558),V=c(V,A,N,j,p[m+8],11,-2022574463),j=c(j,V,A,N,p[m+11],16,1839030562),N=c(N,j,V,A,p[m+14],23,-35309556),A=c(A,N,j,V,p[m+1],4,-1530992060),V=c(V,A,N,j,p[m+4],11,1272893353),j=c(j,V,A,N,p[m+7],16,-155497632),N=c(N,j,V,A,p[m+10],23,-1094730640),A=c(A,N,j,V,p[m+13],4,681279174),V=c(V,A,N,j,p[m+0],11,-358537222),j=c(j,V,A,N,p[m+3],16,-722521979),N=c(N,j,V,A,p[m+6],23,76029189),A=c(A,N,j,V,p[m+9],4,-640364487),V=c(V,A,N,j,p[m+12],11,-421815835),j=c(j,V,A,N,p[m+15],16,530742520),N=c(N,j,V,A,p[m+2],23,-995338651),A=l(A,N,j,V,p[m+0],6,-198630844),V=l(V,A,N,j,p[m+7],10,1126891415),j=l(j,V,A,N,p[m+14],15,-1416354905),N=l(N,j,V,A,p[m+5],21,-57434055),A=l(A,N,j,V,p[m+12],6,1700485571),V=l(V,A,N,j,p[m+3],10,-1894986606),j=l(j,V,A,N,p[m+10],15,-1051523),N=l(N,j,V,A,p[m+1],21,-2054922799),A=l(A,N,j,V,p[m+8],6,1873313359),V=l(V,A,N,j,p[m+15],10,-30611744),j=l(j,V,A,N,p[m+6],15,-1560198380),N=l(N,j,V,A,p[m+13],21,1309151649),A=l(A,N,j,V,p[m+4],6,-145523070),V=l(V,A,N,j,p[m+11],10,-1120210379),j=l(j,V,A,N,p[m+2],15,718787259),N=l(N,j,V,A,p[m+9],21,-343485551),A=r(A,E),N=r(N,v),j=r(j,y),V=r(V,D);return n(A)+n(N)+n(j)+n(V)}let nK=1,TL=console,jr=class{static setLogger(e){TL=e}constructor(e,t){pt(this,"id",void 0),pt(this,"lockingPromise",je.resolve()),pt(this,"locks",0),pt(this,"name",""),pt(this,"lockId",void 0),this.lockId=nK++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");TL.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new je(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Sf(e,t){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const c=await o.lock("From ".concat(e,".").concat(r));try{for(var l=arguments.length,p=new Array(l),m=0;m<l;m++)p[m]=arguments[m];return await s.apply(this,p)}finally{c()}},i}}const qn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Ww(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ea(e,t,n,r){const i=Object.assign({},qn,r);let s=i.timeout;const o=async()=>{await function(p){return new je(m=>{window.setTimeout(m,p)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let c=!1;const l=new je(async(p,m)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<i.maxRetryCount;E+=1){if(c)return m(new pe(F.OPERATION_ABORTED));try{const v=await e();if(!t(v,E)||E+1===i.maxRetryCount)return p(v);await o()}catch(v){if(!n(v,E)||E+1===i.maxRetryCount)return m(v);await o()}}});return l.cancel=()=>c=!0,l}let wy,CL=class{constructor(e){pt(this,"input",[]),pt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ui(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},by=0,Gw=0;function Hw(e,t,n,r){return new je((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),by+=Ec(t.data)):n&&(t.data.size?by+=t.data.size:t.data instanceof FormData?by+=_L(t.data):by+=Ec(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ai.request(t).then(o=>{typeof o.data=="string"?Gw+=Ec(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?Gw+=o.data.byteLength:Gw+=Ec(JSON.stringify(o.data)),i(o.data)}).catch(o=>{Ai.isCancel(o)?s(new pe(F.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new pe(F.NETWORK_TIMEOUT,o.message)):o.response?s(new pe(F.NETWORK_RESPONSE_ERROR,o.response.status)):s(new pe(F.NETWORK_ERROR,o.message))})})}async function rK(e,t){const n=new Blob([t.data],{type:"buffer"});return await Hw(e,we(we({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const RL=()=>window.isSecureContext!==void 0;function xo(e){if(Array.isArray(e))return e.map(n=>n);if(!wL(e))return e;const t={};for(const n in e){const r=e[n];wL(r)||Array.isArray(r)?t[n]=xo(r):t[n]=r}return t}function wL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Kw=class{constructor(e){pt(this,"input",[]),pt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const vc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Og={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:vc,remoteCandidate:vc},updateInterval:0},bL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},IL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},AL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},OL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let zw=class{constructor(e,t){pt(this,"onFirstVideoReceived",void 0),pt(this,"onFirstVideoDecoded",void 0),pt(this,"onFirstAudioReceived",void 0),pt(this,"onFirstVideoDecodedTimeout",void 0),pt(this,"onFirstAudioDecoded",void 0),pt(this,"onSelectedLocalCandidateChanged",void 0),pt(this,"onSelectedRemoteCandidateChanged",void 0),pt(this,"videoIsReady",!1),pt(this,"videoIsReady2",{}),pt(this,"pc",void 0),pt(this,"options",void 0),pt(this,"intervalTimer",void 0),pt(this,"stats",xo(Og)),pt(this,"isFirstVideoReceived",{}),pt(this,"isFirstVideoDecoded",{}),pt(this,"isFirstAudioReceived",{}),pt(this,"isFirstAudioDecoded",{}),pt(this,"isFirstVideoDecodedTimeout",{}),pt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new je(e=>{e({local:we({},vc),remote:we({},vc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,o=0;for(const c of n)e[c].forEach((l,p)=>{if(!this.lossRateWindowStats[t-1][c][p]||!this.lossRateWindowStats[0][c][p])return;const m=this.lossRateWindowStats[t-1][c][p].packets-this.lossRateWindowStats[0][c][p].packets,E=this.lossRateWindowStats[t-1][c][p].packetsLost-this.lossRateWindowStats[0][c][p].packetsLost;c==="videoSend"||c==="audioSend"?(r+=m,s+=E):(i+=m,o+=E),Number.isNaN(m)||Number.isNaN(m)?l.packetLostRate=0:l.packetLostRate=m<=0||E<=0?0:E/(m+E)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},iK=class extends zw{constructor(){super(...arguments),pt(this,"_stats",Og),pt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=xo(Og);const n=t.filter(i=>i.type==="ssrc");this.processSSRCStats(n);const r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const r=Ae(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=xo(IL);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=xo(bL),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){const o=s.stats,c=Date.now()-s.lts;i.framesDecodeFreezeTime=o.framesDecodeFreezeTime,i.framesDecodeInterval=o.framesDecodeInterval,i.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=c,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:we({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=xo(OL);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=xo(AL);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new je((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(i=>{r[i]=n.stat(i)}),t.push(r)}),t}},Ng=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Iy=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Yw=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Cs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var yf=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(yf||{});function Pg(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:yf.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const o=Number(t[r]);if(typeof o!="number")return;if(!e)return o?s/o*i:void 0;const c=Number(e[n]);if(typeof c!="number")return;const l=Number(e[r]);if(typeof l!="number")return;const p=o-l;return p?(s-c)/p*i:void 0}let NL=class extends zw{constructor(){super(...arguments),pt(this,"_stats",Og),pt(this,"report",void 0),pt(this,"lastDecodeVideoReceiverStats",new Map),pt(this,"lastVideoFramesRecv",new Map),pt(this,"lastVideoFramesSent",new Map),pt(this,"lastVideoFramesDecode",new Map),pt(this,"lastVideoFramesOutput",new Map),pt(this,"lastVideoJBDelay",new Map),pt(this,"lastAudioJBDelay",new Map),pt(this,"mediaBytesSent",new Map),pt(this,"mediaBytesRetransmit",new Map),pt(this,"mediaBytesTargetEncode",new Map),pt(this,"lastDecodeAudioReceiverStats",new Map),pt(this,"lastAudioConcealment",new Map),pt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=xo(Og),this.report.forEach(e=>{switch(e.type){case Cs.OUTBOUND:case Cs.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Cs.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Cs.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Cs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Cs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:we({},vc),remote:we({},vc)};return e.forEach(n=>{let r;if(n.type===Cs.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===Cs.CANDIDATE_PAIR&&n.selected&&(r=n),r){const i=(s,o)=>{s.type=o.type,s.id=o.id,o.address&&(s.address=o.address),o.candidateType&&(s.candidateType=o.candidateType),o.port&&(s.port=o.port),o.priority&&(s.priority=o.priority),o.protocol&&(s.protocol=o.protocol),o.relayProtocol&&(s.relayProtocol=o.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&i(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&i(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Cs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Cs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Cs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(we({},t),we({},this.stats.selectedCandidatePair.localCandidate)),e.type===Cs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(we({},t),we({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=xo(OL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Pg(n,t,"totalProcessingDelay","jitterBufferEmittedCount",yf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,we({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,s=n.timestamp,o=s-i;if(o<=0)return;const c=e.concealedSamples-t.concealedSamples-0,l=r.nonSilent+c,p=e.totalSamplesReceived-t.totalSamplesReceived;if(p<=0)return;const m=80*p/o,E=200*p/o,v=o/p;let y=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,l>m&&(r.plc80>0?(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*v)):(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*v)),y=r.plc80+1);let D=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,l>E&&(r.plc200>0?(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*v)):(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*v)),D=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:c,lts:s,plc80:y,plc200:D})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(o=>o.ssrc===e.ssrc);t||(t=xo(bL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const o=t.decodedFrame?t.decodedFrame.width:0,c=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,c),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const o=n.stats,c=s-n.lts;t.framesDecodeFreezeTime=o.framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Pg(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Pg(n?.stats,t,"totalProcessingDelay","framesDecodeCount",yf.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Pg(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",yf.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Pg(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",yf.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:we({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=xo(IL),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new Kw(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new Kw(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new Kw(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Cs.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=xo(AL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Cs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(rs(n=this.report).call(n)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=c?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof l!="number")return;let p=(i=c?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,m=(s=c?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,E=(o=c?.framesPerSecond)!==null&&o!==void 0?o:e.framesPerSecond;if(typeof p=="number"&&typeof m=="number"||(p=0,m=0),E==null){const v=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&v-y.lts>=800?(E=Math.round((l-y.count)/((v-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:v,rate:E})):y?E=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:v,rate:0})}n.sentFrame={width:p,height:m,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,o,c;const l=t?this.report.get(t):void 0,p=(r=l?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,m=(i=l?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,E=(s=l?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,v=(o=l?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,y=(c=l?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount;if(typeof p=="number"){const D=this.lastVideoFramesRecv.get(n.ssrc),A=Date.now();n.framesReceivedCount=p;let N=0;D&&A-D.lts>=800?(N=Math.round((p-D.count)/((A-D.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:N})):D?N=D.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:0}),n.receivedFrame={width:m||0,height:E||0,frameRate:N||0},n.decodedFrame={width:m||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(v&&y){const D=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=D.jitterBufferMs;const N=y-D.jitterBufferEmittedCount;N>0&&(A=1e3*(v-D.jitterBufferDelay)/N),n.jitterBufferMs=A,n.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=(i=c?.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,p=(s=(o=c?.echoReturnLossEnhancement)!==null&&o!==void 0?o:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=l,n.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(e,t,n){var r,i,s,o,c,l,p,m,E;const v=t?this.report.get(t):void 0,y=(r=v?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,D=(i=v?.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,A=(s=v?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,N=(o=v?.jitterBufferEmittedCount)!==null&&o!==void 0?o:e.jitterBufferEmittedCount,j=(c=v?.audioLevel)!==null&&c!==void 0?c:e?.audioLevel,V=(l=v?.totalSamplesDuration)!==null&&l!==void 0?l:e?.totalSamplesDuration,G=(p=v?.concealedSamples)!==null&&p!==void 0?p:e.concealedSamples,$=(m=v?.silentConcealedSamples)!==null&&m!==void 0?m:e.silentConcealedSamples,Q=(E=v?.concealmentEvents)!==null&&E!==void 0?E:e.concealmentEvents;if(typeof D=="number"&&(n.totalSamplesReceived=D),typeof $=="number"&&(n.silentConcealedSamples=$),typeof Q=="number"&&(n.concealmentEvents=Q),typeof G=="number"&&(n.concealedSamples=G),y&&D&&(n.accelerateRate=y/D),A&&N){const re=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let fe=re.jitterBufferMs;const ve=N-re.jitterBufferEmittedCount;ve>0&&(fe=1e3*(A-re.jitterBufferDelay)/ve),n.jitterBufferMs=Math.round(fe),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:N,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=j;let z=1920;V&&D&&(z=D/V/50,n.receivedFrames=Math.round(D/z)),G&&(n.droppedFrames=Math.round(G/z))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{n=n===null?i.diffMean():n+i.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},sK=class extends zw{updateStats(){return je.resolve()}};function qw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return s?s<76?new iK(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new NL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(o){if(!window.RTCStatsReport)return!1;const c=o.getStats();return!!(c instanceof je||function(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}(c))}(e)?new NL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new sK(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const PL="websdk_ng_install_id";function Xw(){try{if(W("INSTALL_ID"))return W("INSTALL_ID");let e=window.localStorage.getItem(PL);return e||(e=ph(),window.localStorage.setItem(PL,e)),$t("INSTALL_ID",e),e}catch{return}}const Qs=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.24.0"),Jw=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let fh=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const kr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let c=0;c<6;c++)i.push("1");const s=i.join(""),o={};return o[e]=r,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=kr;const Ay={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Qw={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Zw="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",$w={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Sn=we(we(we(we({},$w),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Qw,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Ay),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function $t(e,t,n){var r,i,s;Ae(r=Object.keys(Sn)).call(r,e)&&(!n&&Ae(i=Object.keys(va)).call(i,e)||(Sn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Sn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,Sn.USE_NEW_NETWORK_CONFIG=s,s&&(Sn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Sn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Sn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Sn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Sn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Sn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Sn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Sn.ENABLE_INSTANT_VIDEO=!0,Sn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Sn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Sn.NEW_TURN_MODE||(Sn.NEW_TURN_MODE=4))))}function W(e){return Sn[e]}Jw||(Sn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Sn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Sn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Sn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Sn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Sn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Sn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Sn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Sn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Sn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Sn.AREAS=["NORTH_AMERICA","OVERSEA"]);let DL=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const va={};var ft=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ft||{});let Dg=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const kL=128,oK=96,LL=1e3,Tf=10;let aK=0;var xL=(()=>{var e={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>ve,Printer:()=>Yt,parse:()=>Ne,print:()=>He});const o=`
`,c="".concat("\r").concat(o),l=" ";let p;function m(Se){return Se>="0"&&Se<="9"}function E(Se){return Se>="!"&&Se<="~"}function v(Se){return E(Se)||Se>=""&&Se<=""}function y(Se){return Se==="!"||Se>="#"&&Se<="'"||Se>="*"&&Se<="+"||Se>="-"&&Se<="."||Se>="0"&&Se<="9"||Se>="A"&&Se<="Z"||Se>="^"&&Se<="~"}function D(Se){return Se>="1"&&Se<="9"}function A(Se){return Se>="A"&&Se<="Z"||Se>="a"&&Se<="z"}function N(Se){return Se==="d"||Se==="h"||Se==="m"||Se==="s"}function j(Se){return Se>""&&Se<"	"||Se>"\v"&&Se<"\f"||Se>""&&Se<""}function V(Se){return A(Se)||m(Se)||Se==="+"||Se==="/"}function G(Se){return m(Se)||A(Se)||Se==="+"||Se==="/"||Se==="-"||Se==="_"}function $(Se){return A(Se)||m(Se)||Se==="+"||Se==="/"}function Q(Se,b){var K=Object.keys(Se);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(Se);b&&(J=J.filter(function(be){return Object.getOwnPropertyDescriptor(Se,be).enumerable})),K.push.apply(K,J)}return K}function z(Se){for(var b=1;b<arguments.length;b++){var K=arguments[b]!=null?arguments[b]:{};b%2?Q(Object(K),!0).forEach(function(J){re(Se,J,K[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Se,Object.getOwnPropertyDescriptors(K)):Q(Object(K)).forEach(function(J){Object.defineProperty(Se,J,Object.getOwnPropertyDescriptor(K,J))})}return Se}function re(Se,b,K){return b in Se?Object.defineProperty(Se,b,{value:K,enumerable:!0,configurable:!0,writable:!0}):Se[b]=K,Se}(function(Se){Se.VERSION="v",Se.ORIGIN="o",Se.SESSION_NAME="s",Se.INFORMATION="i",Se.URI="u",Se.EMAIL="e",Se.PHONE="p",Se.CONNECTION="c",Se.BANDWIDTH="b",Se.TIME="t",Se.REPEAT="r",Se.ZONE_ADJUSTMENTS="z",Se.KEY="k",Se.ATTRIBUTE="a",Se.MEDIA="m"})(p||(p={}));class fe{consumeText(b,K){let J=K;for(;J<b.length;){const be=b[J];if(be==="\0"||be==="\r"||be===o)break;J+=1}if(J-K==0)throw new Error("Invalid text, at ".concat(b));return J}consumeUnicastAddress(b,K,J){return this.consumeTill(b,K,l)}consumeOneOrMore(b,K,J){let be=K;for(;J(b[be]);)be++;if(be-K==0)throw new Error("Invalid rule at ".concat(K,"."));return be}consumeSpace(b,K){if(b[K]===l)return K+1;throw new Error("Invalid space at ".concat(K,"."))}consumeIP4Address(b,K){let J=K;for(let be=0;be<4;be++)if(J=this.consumeDecimalUChar(b,J),be!==3){if(b[J]!==".")throw new Error("Invalid IP4 address.");J++}return J}consumeDecimalUChar(b,K){let J=K;for(let gt=0;gt<3&&m(b[J]);gt++,J++);if(J-K==0)throw new Error("Invalid decimal uchar.");const be=parseInt(b.slice(K,J));if(be>=0&&be<=255)return J;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,K){let J=this.consumeHexpart(b,K);return b[J]===":"&&(J+=1,J=this.consumeIP4Address(b,J)),J}consumeHexpart(b,K){let J=K;if(b[J]===":"&&b[J+1]===":"){J+=2;try{J=this.consumeHexseq(b,J)}catch{}return J}if(J=this.consumeHexseq(b,J),b[J]===":"&&b[J+1]===":"){J+=2;try{J=this.consumeHexseq(b,J)}catch{}return J}return J}consumeHexseq(b,K){let J=K;for(;J=this.consumeHex4(b,J),b[J]===":"&&b[J+1]!==":";)J+=1;return J}consumeHex4(b,K){let J=0;for(;J<4;J++)if(!((be=b[K+J])>="0"&&be<="9"||be>="a"&&be<="f"||be>="A"&&be<="F")){if(J===0)throw new Error("Invalid hex 4");break}var be;return K+J}consumeFQDN(b,K){let J=K;for(;m(b[J])||A(b[J])||b[J]==="-"||b[J]===".";)J+=1;if(J-K<4)throw new Error("Invalid FQDN");return J}consumeExtnAddr(b,K){return this.consumeOneOrMore(b,K,v)}consumeMulticastAddress(b,K,J){switch(J){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,K);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,K);default:try{return this.consumeFQDN(b,K)}catch{return this.consumeExtnAddr(b,K)}}}consumeIP6MulticastAddress(b,K){const J=this.consumeHexpart(b,K);return b[J]==="/"?this.consumeInteger(b,J+1):J}consumeIP4MulticastAddress(b,K){let J=K+3;const be=b.slice(K,J),gt=parseInt(be);if(gt<224||gt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dn=0;dn<3;dn++){if(b[J]!==".")throw new Error("Invalid IP4 multicast address.");J+=1,J=this.consumeDecimalUChar(b,J)}return b[J]==="/"&&(J+=1),J=this.consumeTTL(b,J),b[J]==="/"&&(J=this.consumeInteger(b,J)),J}consumeInteger(b,K){if(!D(b[K]))throw new Error("Invalid integer.");for(K+=1;m(b[K]);)K+=1;return K}consumeTTL(b,K){if(b[K]==="0")return K+1;if(!D(b[K]))throw new Error("Invalid TTL.");K+=1;for(let J=0;J<2&&m(b[K]);J++)K+=1;return K}consumeToken(b,K){return this.consumeOneOrMore(b,K,y)}consumeTime(b,K){let J=K;if(b[J]==="0")return J+1;for(D(b[J])&&(J+=1);m(b[J]);)J++;if(J-K<10)throw new Error("Invalid time");return J}consumeAddress(b,K){return this.consumeTill(b,K,l)}consumeTypedTime(b,K){let J=K;return J=this.consumeOneOrMore(b,J,m),N(b[J])?J+1:J}consumeRepeatInterval(b,K){if(!D(b[K]))throw new Error("Invalid repeat interval");for(K+=1;m(b[K]);)K+=1;return N(b[K])&&(K+=1),K}consumePort(b,K){return this.consumeOneOrMore(b,K,m)}consume(b,K,J){for(let be=0;be<J.length;be++){if(K+be>=b.length)throw new Error("consume exceeding value length");if(b[K+be]!==J[be])throw new Error("consume ".concat(J," failed at ").concat(be))}return K+J.length}consumeTill(b,K,J){let be=K;for(;be<b.length&&(typeof J!="string"||b[be]!==J)&&(typeof J!="function"||!J(b[be]));)be++;return be}}class ve extends fe{constructor(){super(),re(this,"records",[]),re(this,"currentLine",0)}parse(b){const K=this.probeEOL(b);this.records=b.split(K).filter(Sl=>!!ri(Sl).call(Sl)).map(this.parseLine),this.currentLine=0;const J=this.parseVersion(),be=this.parseOrigin(),gt=this.parseSessionName(),dn=this.parseInformation(),tr=this.parseUri(),oo=this.parseEmail(),Yo=this.parsePhone(),_E=this.parseConnection(),Lh=this.parseBandWidth(),em=this.parseTimeFields(),WT=this.parseKey(),GT=this.parseSessionAttribute(),ao=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:J,origin:be,sessionName:gt,information:dn,uri:tr,emails:oo,phones:Yo,connection:_E,bandwidths:Lh,timeFields:em,key:WT,attributes:GT,mediaDescriptions:ao}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let K=0;K<b.length;K++)if(b[K]===o)return b[K-1]==="\r"?c:o;throw new Error("Invalid newline character.")}parseLine(b,K){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const J=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:J,value:b.slice(2),line:K,cur:0}}parseSessionAttribute(){const b=new Ct;for(;this.currentLine<this.records.length;){const K=this.getCurrentRecord();if(K.type!==p.ATTRIBUTE)break;const J={attField:this.extractOneOrMore(K,be=>y(be)&&be!==":"),_cur:0};K.value[K.cur]===":"&&(K.cur+=1,J.attValue=this.extractOneOrMore(K,j)),b.parse(J),this.currentLine++}return b.digest()}parseMediaAttributes(b){const K=new bt(b);for(;this.currentLine<this.records.length;){const J=this.getCurrentRecord();if(J.type!==p.ATTRIBUTE)break;const be={attField:this.extractOneOrMore(J,gt=>y(gt)&&gt!==":"),_cur:0};J.value[J.cur]===":"&&(J.cur+=1,be.attValue=this.extractOneOrMore(J,j)),K.parse(be),this.currentLine++}return K.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===p.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===p.ZONE_ADJUSTMENTS){const K=[];for(;;)try{const J=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let be=!1;b.value[b.cur]==="-"&&(be=!0,b.cur+=1);const gt=this.extract(b,this.consumeTypedTime);K.push({time:J,typedTime:gt,back:be})}catch{break}if(K.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,K}return[]}parseRepeat(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==p.REPEAT)break;{const J=this.extract(K,this.consumeRepeatInterval),be=this.parseTypedTime(K);b.push({repeatInterval:J,typedTimes:be}),this.currentLine++}}return b}parseTypedTime(b){const K=[];for(;;)try{this.consumeSpaceForRecord(b),K.push(this.extract(b,this.consumeTypedTime))}catch{break}if(K.length===0)throw new Error("Invalid typed time.");return K}parseTime(){const b=this.getCurrentRecord(),K=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const J=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:K,stopTime:J}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const K=this.getCurrentRecord();if(K.type!==p.BANDWIDTH)break;{const J=this.extractOneOrMore(K,y);if(K.value[K.cur]!==":")throw new Error("Invalid bandwidth field.");K.cur++;const be=this.extractOneOrMore(K,m);b.push({bwtype:J,bandwidth:be}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==p.VERSION)throw new Error("first sdp record must be version");const K=b.value.slice(0,this.consumeOneOrMore(b.value,0,m));if(K.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,K}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==p.ORIGIN)throw new Error("second line of sdp must be origin");const K=this.extractOneOrMore(b,v);this.consumeSpaceForRecord(b);const J=this.extractOneOrMore(b,m);this.consumeSpaceForRecord(b);const be=this.extractOneOrMore(b,m);this.consumeSpaceForRecord(b);const gt=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const dn=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const tr=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:K,sessId:J,sessVersion:be,nettype:gt,addrtype:dn,unicastAddress:tr}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===p.SESSION_NAME){const K=this.extract(b,this.consumeText);return this.currentLine++,K}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==p.INFORMATION)return;const K=this.extract(b,this.consumeText);return this.currentLine++,K}parseUri(){const b=this.getCurrentRecord();if(b.type===p.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==p.EMAIL)break;b.push(K.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==p.PHONE)break;b.push(K.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===p.CONNECTION){const K=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const J=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const be=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:K,addrtype:J,address:be}}}parseMedia(){const b=this.getCurrentRecord(),K=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let J=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,J+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const be=[];for(be.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,be.push(this.extract(b,this.consumeToken));if(be.length===0)throw new Error("Invalid proto");const gt=this.parseFmt(b);return this.currentLine++,{mediaType:K,port:J,protos:be,fmts:gt}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===p.TIME;){const K=this.parseTime(),J=this.parseRepeat(),be=this.parseZone();b.push({time:K,repeats:J,zones:be})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.MEDIA;){const K=this.parseMedia(),J=this.parseInformation(),be=this.parseConnections(),gt=this.parseBandWidth(),dn=this.parseKey(),tr=this.parseMediaAttributes(K);b.push({media:K,information:J,connections:be,bandwidths:gt,key:dn,attributes:tr})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const K=[];for(;;)try{this.consumeSpaceForRecord(b),K.push(this.extract(b,this.consumeToken))}catch{break}if(K.length===0)throw new Error("Invalid fmts");return K}extract(b,K){for(var J=arguments.length,be=new Array(J>2?J-2:0),gt=2;gt<J;gt++)be[gt-2]=arguments[gt];const dn=K.call(this,b.value,b.cur,...be),tr=b.value.slice(b.cur,dn);return b.cur=dn,tr}extractOneOrMore(b,K){const J=this.consumeOneOrMore(b.value,b.cur,K),be=b.value.slice(b.cur,J);return b.cur=J,be}consumeSpaceForRecord(b){if(b.value[b.cur]!==l)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class Re extends fe{constructor(){super(...arguments),re(this,"attributes",void 0),re(this,"digested",!1)}extractOneOrMore(b,K,J){const be=this.consumeOneOrMore(b.attValue,b._cur,K),gt=b.attValue.slice(b._cur,be),[dn,tr]=J||[];if(typeof dn=="number"&&gt.length<dn)throw new Error("error in length, should be more or equal than ".concat(dn," characters."));if(typeof tr=="number"&&gt.length>tr)throw new Error("error in length, should be less or equal than ".concat(tr," characters."));return b._cur=be,gt}consumeAttributeSpace(b){if(b.attValue[b._cur]!==l)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,K){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var J=arguments.length,be=new Array(J>2?J-2:0),gt=2;gt<J;gt++)be[gt-2]=arguments[gt];const dn=K.call(this,b.attValue,b._cur,...be),tr=b.attValue.slice(b._cur,dn);return b._cur=dn,tr}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,K){if(!b.attValue)throw new Error;for(let J=0;J<K.length;J++)if(K[J]!==b.attValue[b._cur+J])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,V,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,V,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const K=[];for(;!this.atEnd(b);){K.push(this.extractOneOrMore(b,V));try{this.consumeAttributeSpace(b)}catch(J){if(this.atEnd(b))break;throw J}}this.attributes.iceOptions=K}parseFingerprint(b){const K=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:K,fingerprint:J})}parseExtmap(b){const K=this.extractOneOrMore(b,m);let J;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),J=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeTill,l),gt=z(z({entry:parseInt(K,10)},J&&{direction:J}),{},{extensionName:be});this.peekChar(b)===l&&(this.consumeAttributeSpace(b),gt.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push(gt)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const K=this.extract(b,this.consumeTill);if(K!=="active"&&K!=="passive"&&K!=="actpass"&&K!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=K}}class Ct extends Re{constructor(){super(...arguments),re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(K){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),K}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const K=this.extract(b,this.consumeToken),J=[];for(;!this.atEnd(b)&&this.peekChar(b)===l;)this.consumeAttributeSpace(b),J.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:K,identificationTag:J})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,G)}parseIdentity(b){const K=this.extractOneOrMore(b,$),J=[];for(;!this.atEnd(b)&&this.peekChar(b)===l;){this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const gt=this.extractOneOrMore(b,dn=>dn!==l&&j(dn));J.push({name:be,value:gt})}this.attributes.identities.push({assertionValue:K,extensions:J})}parseMsidSemantic(b){this.peekChar(b)===l&&this.consumeAttributeSpace(b);const K={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),K.applyForAll=!0;break}{const J=this.extract(b,this.consumeTill,l);K.identifierList.push(J)}}this.attributes.msidSemantic=K}}class bt extends Re{constructor(b){super(),re(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(K){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),K}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const K=this.extractOneOrMore(b,V,[1,32]);this.consumeAttributeSpace(b);const J=this.extractOneOrMore(b,m,[1,5]);this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const gt=this.extractOneOrMore(b,m,[1,10]);this.consumeAttributeSpace(b);const dn=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const tr=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const oo={foundation:K,componentId:J,transport:be,priority:gt,connectionAddress:dn,port:tr,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),oo.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),oo.relPort=this.extract(b,this.consumePort));this.peekChar(b)===l;){this.consumeAttributeSpace(b);const Yo=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),oo.extension[Yo]=this.extractOneOrMore(b,E)}this.attributes.candidates.push(oo)}parseRemoteCandidate(b){const K=[];for(;;){const J=this.extractOneOrMore(b,m,[1,5]);this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const gt=this.extract(b,this.consumePort);K.push({componentId:J,connectionAddress:be,port:gt});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(K)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const K=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const be={encodingName:J,clockRate:this.extractOneOrMore(b,m)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),be.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(K,10));gt?gt.rtpMap=be:this.attributes.payloads.push({payloadType:parseInt(K,10),rtpMap:be,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const K=this.extractOneOrMore(b,m);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill,":");let be;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),be=this.extract(b,this.consumeTill));const gt=this.attributes.ssrcs.find(dn=>dn.ssrcId===parseInt(K,10));gt?gt.attributes[J]=be:this.attributes.ssrcs.push({ssrcId:parseInt(K,10),attributes:{[J]:be}})}parseFmtp(b){const K=this.extract(b,this.consumeTill,l);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill),be={};J.split(";").forEach(dn=>{let[tr,oo]=dn.split("=");tr=ri(tr).call(tr);const Yo=typeof oo=="string"?ri(oo).call(oo):null;typeof tr=="string"&&tr.length>0&&(be[tr]=Yo)});const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(K,10));gt?gt.fmtp={parameters:be}:this.attributes.payloads.push({payloadType:parseInt(K,10),rtcpFeedbacks:[],fmtp:{parameters:be}})}parseFmtParameters(b){const K={},J=this.extract(b,this.consumeTill,"=");b._cur++;const be=this.extract(b,this.consumeTill,";");for(K[J]=be;b.attValue[b._cur]===";";){const gt=this.extract(b,this.consumeTill,"=");b._cur++;const dn=this.extract(b,this.consumeTill,";");K[gt]=dn}return K}parseRtcpFb(b){let K="";K=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,l),this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill,l);let be;if(J==="trr-int")be={type:J,interval:this.extract(b,this.consumeTill)};else{const gt={type:J};this.peekChar(b)===l&&(this.consumeAttributeSpace(b),gt.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===l&&(gt.additional=this.extract(b,this.consumeTill))),be=gt}if(K==="*")this.attributes.rtcpFeedbackWildcards.push(be);else{const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(K,10));gt?gt.rtcpFeedbacks.push(be):this.attributes.payloads.push({payloadType:parseInt(K,10),rtcpFeedbacks:[be]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const K={port:this.extract(b,this.consumePort)};this.peekChar(b)===l&&(this.consumeAttributeSpace(b),K.netType=this.extractOneOrMore(b,y),this.consumeAttributeSpace(b),K.addressType=this.extractOneOrMore(b,y),this.consumeAttributeSpace(b),K.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=K}parseMsid(b){const K={id:this.extractOneOrMore(b,y,[1,64])};this.peekChar(b)===l&&(this.consumeAttributeSpace(b),K.appdata=this.extractOneOrMore(b,y,[1,64])),this.attributes.msids.push(K)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const K=this.extractOneOrMore(b,be=>A(be)||m(be)||be==="_"||be==="-");this.consumeAttributeSpace(b);const J={id:K,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===l){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const be=[];for(;;){const gt=this.extract(b,this.consumeToken);be.push(gt);try{this.extract(b,this.consume,",")}catch{break}}J.payloads=be,this.peekChar(b)===l&&this.extract(b,this.consume,l)}for(;;){const be=this.extract(b,this.consumeToken);switch(be){case"depend":{const gt={type:be,rids:this.extract(b,this.consume,"=").split(",")};J.params.push(gt);break}default:{const gt={type:be};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),gt.val=this.extract(b,this.consumeTill,";")),J.params.push(gt)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(J)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,m,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const K=this.extract(b,this.consumeToken),J=[];for(;;)try{this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeInteger);J.push(parseInt(be,10))}catch{break}this.attributes.ssrcGroups.push({semantic:K,ssrcIds:J})}}function ut(Se,b,K){return b in Se?Object.defineProperty(Se,b,{value:K,enumerable:!0,configurable:!0,writable:!0}):Se[b]=K,Se}class Yt{constructor(){ut(this,"eol",c)}print(b,K){let J="";return K&&(this.eol=K),J+=this.printVersion(b.version),J+=this.printOrigin(b.origin),J+=this.printSessionName(b.sessionName),J+=this.printInformation(b.information),J+=this.printUri(b.uri),J+=this.printEmail(b.emails),J+=this.printPhone(b.phones),J+=this.printConnection(b.connection),J+=this.printBandwidth(b.bandwidths),J+=this.printTimeFields(b.timeFields),J+=this.printKey(b.key),J+=this.printSessionAttributes(b.attributes),J+=this.printMediaDescription(b.mediaDescriptions),J}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let K="";for(const J of b)K+="e=".concat(J).concat(this.eol);return K}printPhone(b){let K="";for(const J of b)K+="e=".concat(J).concat(this.eol);return K}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let K="";for(const J of b)K+="b=".concat(J.bwtype,":").concat(J.bandwidth).concat(this.eol);return K}printTimeFields(b){let K="";for(const J of b){K+="t=".concat(J.time.startTime," ").concat(J.time.startTime).concat(this.eol);for(const be of J.repeats)K+="r=".concat(be.repeatInterval," ").concat(be.typedTimes.join(" ")).concat(this.eol);J.zoneAdjustments&&(K+="z=",K+="z=".concat(J.zoneAdjustments.map(be=>"".concat(be.time," ").concat(be.back?"-":""," ").concat(be.typedTime)).join(" ")).concat(this.eol),K+=this.eol)}return K}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let K="";for(const J of b)K+="a=".concat(J.attField).concat(J.attValue?":".concat(J.attValue):"").concat(this.eol);return K}printMediaDescription(b){let K="";for(const J of b)K+=this.printMedia(J.media),K+=this.printInformation(J.information),K+=this.printConnections(J.connections),K+=this.printBandwidth(J.bandwidths),K+=this.printKey(J.key),K+=this.printMediaAttributes(J);return K}printConnections(b){let K="";for(const J of b)K+=this.printConnection(J);return K}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new Hr(this.eol).print(b)}printMediaAttributes(b){return new Ee(this.eol).print(b)}}class Ht{constructor(b){ut(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(l)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map(K=>"a=fingerprint:".concat(K.hashFunction).concat(l).concat(K.fingerprint)).join(this.eol)+this.eol:""}printExtmap(b){return b.map(K=>"a=extmap:".concat(K.entry).concat(K.direction?"/".concat(K.direction):"").concat(l).concat(K.extensionName).concat(K.extensionAttributes?"".concat(l).concat(K.extensionAttributes):"").concat(this.eol)).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map(K=>"a=".concat(K.attField).concat(K.attValue?":".concat(K.attValue):"").concat(this.eol)).join("")}}class Hr extends Ht{print(b){let K="";return K+=this.printGroups(b.groups),K+=this.printMsidSemantic(b.msidSemantic),K+=this.printIceLite(b.iceLite),K+=this.printIceUfrag(b.iceUfrag),K+=this.printIcePwd(b.icePwd),K+=this.printIceOptions(b.iceOptions),K+=this.printFingerprints(b.fingerprints),K+=this.printSetup(b.setup),K+=this.printTlsId(b.tlsId),K+=this.printIdentity(b.identities),K+=this.printExtmap(b.extmaps),K+=this.printUnrecognized(b.unrecognized),K}printGroups(b){let K="";return b.length>0&&(K+=b.map(J=>"a=group:".concat(J.semantic).concat(J.identificationTag.map(be=>"".concat(l).concat(be)).join("")).concat(this.eol)).join("")),K}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map(K=>"a=identity:".concat(K.assertionValue).concat(K.extensions.map(J=>"".concat(l).concat(J.name).concat(J.value?"=".concat(J.value):"")))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let K="a=msid-semantic:".concat(b.semantic);return b.applyForAll?K+="".concat(l,"*"):b.identifierList.length>0&&(K+=b.identifierList.map(J=>"".concat(l).concat(J))),K+this.eol}}class Ee extends Ht{print(b){const K=b.attributes;let J="";return J+=this.printRTCP(K.rtcp),J+=this.printIceUfrag(K.iceUfrag),J+=this.printIcePwd(K.icePwd),J+=this.printIceOptions(K.iceOptions),J+=this.printCandidates(K.candidates),J+=this.printRemoteCandidatesList(K.remoteCandidatesList),J+=this.printEndOfCandidates(K.endOfCandidates),J+=this.printFingerprints(K.fingerprints),J+=this.printSetup(K.setup),J+=this.printMid(K.mid),J+=this.printExtmap(K.extmaps),J+=this.printRTPRelated(K),J+=this.printPtime(K.ptime),J+=this.printMaxPtime(K.maxPtime),J+=this.printDirection(K.direction),J+=this.printSSRCGroups(K.ssrcGroups),J+=this.printSSRC(K.ssrcs),J+=this.printRTCPMux(K.rtcpMux),J+=this.printRTCPMuxOnly(K.rtcpMuxOnly),J+=this.printRTCPRsize(K.rtcpRsize),J+=this.printMSId(K.msids),J+=this.printImageattr(K.imageattr),J+=this.printRid(K.rids),J+=this.printSimulcast(K.simulcast),J+=this.printSCTPPort(K.sctpPort),J+=this.printMaxMessageSize(K.maxMessageSize),J+=this.printUnrecognized(K.unrecognized),J}printCandidates(b){return b.map(K=>"a=candidate:".concat(K.foundation).concat(l).concat(K.componentId).concat(l).concat(K.transport).concat(l).concat(K.priority).concat(l).concat(K.connectionAddress).concat(l).concat(K.port).concat(l,"typ").concat(l).concat(K.type).concat(K.relAddr?"".concat(l,"raddr").concat(l).concat(K.relAddr):"").concat(K.relPort?"".concat(l,"rport").concat(l).concat(K.relPort):"").concat(Object.keys(K.extension).map(J=>"".concat(l).concat(J).concat(l).concat(K.extension[J])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(b){return b.map(K=>"a=remote-candidates:".concat(K.join(l)).concat(this.eol)).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const K=b.payloads;let J="";J+=b.rtcpFeedbackWildcards.map(be=>this.printRTCPFeedback("*",be)).join("");for(const be of K)J+=this.printRtpMap(be.payloadType,be.rtpMap),J+=this.printFmtp(be.payloadType,be.fmtp),J+=be.rtcpFeedbacks.map(gt=>this.printRTCPFeedback(be.payloadType,gt)).join("");return J}printFmtp(b,K){if(!K)return"";const J=Object.keys(K.parameters);return J.length===1&&K.parameters[J[0]]===null?"a=fmtp:".concat(b).concat(l).concat(J[0]).concat(this.eol):"a=fmtp:".concat(b).concat(l).concat(Object.keys(K.parameters).map(be=>"".concat(be,"=").concat(K.parameters[be])).join(";")).concat(this.eol)}printRtpMap(b,K){return K?"a=rtpmap:".concat(b).concat(l).concat(K.encodingName,"/").concat(K.clockRate).concat(K.encodingParameters?"/".concat(K.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,K){let J="a=rtcp-fb:".concat(b).concat(l),be=K;return be.type==="trr-int"?J+="ttr-int".concat(l).concat(be.interval):(J+="".concat(be.type),be.parameter&&(J+="".concat(l).concat(be.parameter),be.additional&&(J+="".concat(l).concat(be.additional)))),J+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map(K=>Object.keys(K.attributes).map(J=>"a=ssrc:".concat(K.ssrcId.toString(10)).concat(l).concat(J).concat(K.attributes[J]?":".concat(K.attributes[J]):"").concat(this.eol)).join("")).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let K="a=rtcp:".concat(b.port);return b.netType&&(K+="".concat(l).concat(b.netType)),b.addressType&&(K+="".concat(l).concat(b.addressType)),b.address&&(K+="".concat(l).concat(b.address)),K+this.eol}printMSId(b){return b.map(K=>"a=msid:".concat(K.id).concat(K.appdata?"".concat(l).concat(K.appdata):"").concat(this.eol)).join("")}printImageattr(b){return b.map(K=>"a=imageattr:".concat(K).concat(this.eol)).join("")}printRid(b){return b.map(K=>{let J="a=rid:".concat(K.id).concat(l).concat(K.direction);return K.payloads&&(J+="".concat(l,"pt=").concat(K.payloads.join(","))),K.params.length>0&&(J+="".concat(l).concat(K.params.map(be=>be.type==="depend"?"depend=".concat(be.rids.join(",")):"".concat(be.type,"=").concat(be.val)).join(";"))),J+this.eol}).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map(K=>"a=ssrc-group:".concat(K.semantic).concat(K.ssrcIds.map(J=>"".concat(l).concat(J.toString(10))).join("")).concat(this.eol)).join("")}}function Ne(Se){return new ve().parse(Se)}function He(Se,b){return new Yt().print(Se,b)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function Gi(e){return xL.parse(e)}function yd(e,t){return xL.print(e,t)}var cK=Qi("Array","keys"),lK=Xo,dK=fr,uK=Y,hK=cK,eb=Array.prototype,pK={DOMTokenList:!0,NodeList:!0},fK=function(e){var t=e.keys;return e===eb||uK(eb,e)&&t===eb.keys||dK(pK,lK(e))?hK:t},Hi=S(fK);function Dn(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ML(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ML(Object(n),!0).forEach(function(r){Dn(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ML(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const UL=new class extends bn{constructor(){super(...arguments),Dn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class mK{constructor(t){Dn(this,"logger",void 0),Dn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function tb(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function VL(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Zs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Oy=Date.now(),kg=e=>{for(const t in Zs)if(Object.prototype.hasOwnProperty.call(Zs,t)&&Zs[t]===e)return t;return"DEFAULT"},R=new class{constructor(){Dn(this,"proxyServerURL",void 0),Dn(this,"logLevel",Zs.DEBUG),Dn(this,"uploadState","collecting"),Dn(this,"uploadLogWaitingList",[]),Dn(this,"uploadLogUploadingList",[]),Dn(this,"uploadErrorCount",0),Dn(this,"currentLogID",0),Dn(this,"url",void 0),Dn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){$t("UPLOAD_LOG",!0)}disableLogUpload(){$t("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new mK(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Oy<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Oy);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=tb()+" Agora-SDK [".concat(kg(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=tb()+" %cAgora-SDK [".concat(kg(r),"]:");let s=[];if(!W("USE_NEW_LOG"))switch(r){case Zs.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case Zs.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case Zs.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case Zs.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Oy<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Oy);const r=Math.max(0,Math.min(4,t[0]));t[0]=tb()+" Agora-SDK [".concat(kg(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!W("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=VL()+" Agora-SDK [".concat(kg(e),"]:"):n[0]=VL()+" Agora-SDK [".concat(kg(e),"]:");let i="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Qs,process_id:W("PROCESS_ID"),payload:JSON.stringify(e)};return Ea(async()=>{const n=await Ai.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(W("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(W("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),UL.reportLogUploadError(r),!0},{timeout:W("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:W("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,W("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var jL;function _K(e){return Cr(e.reportId,"params.reportId",0,100,!1),Cr(e.category,"params.category",0,100,!1),Cr(e.event,"params.event",0,100,!1),Cr(e.label,"params.label",0,100,!1),nn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(jL={}).FREE="free",jL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const gK={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),yn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let EK=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function ot(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var o,c=arguments.length,l=new Array(c),p=0;p<c;p++)l[p]=arguments[p];let m=l;if(e.argsMap)try{m=e.argsMap(this,...l)}catch(v){R.warning(v),m=[]}try{JSON.stringify(m)}catch{R.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const E=(e.report||qe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:m,tag:Tn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const v=i.apply(this,l);return v instanceof je?v.then(y=>(E.onSuccess(e.reportResult&&y),y)).catch(y=>{throw E.onError(y),y}):(E.onSuccess(e.reportResult&&v),v)}catch(v){throw E.onError(v),v}}}return r}}const qe=new class{constructor(){Dn(this,"baseInfoMap",new Map),Dn(this,"proxyServer",void 0),Dn(this,"eventUploadTimer",void 0),Dn(this,"setSessionIdTimer",void 0),Dn(this,"url",void 0),Dn(this,"sids",new Set),Dn(this,"backupUrl",void 0),Dn(this,"_appId",void 0),Dn(this,"_aid",0),Dn(this,"keyEventUploadPendingItems",[]),Dn(this,"normalEventUploadPendingItems",[]),Dn(this,"apiInvokeUploadPendingItems",[]),Dn(this,"apiInvokeCount",0),Dn(this,"apiInvokeLoggedCount",0),Dn(this,"ltsList",[]),Dn(this,"lastSendNormalEventTime",Date.now()),Dn(this,"customReportCounterTimer",void 0),Dn(this,"customReportCount",0),Dn(this,"extApiInvoke",async e=>{for(const t of e){const n=St(St({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Tn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),W("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),W("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!W("SHOW_REPORT_INVOKER_LOG"),o=!!W("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&t.id;c&&(this.apiInvokeLoggedCount+=1);const l=this.apiInvokeLoggedCount;function p(y,D){if(c){let A="[apiInvoke-".concat(l,"]");if(t.id&&(A+="[".concat(t.id,"]")),t.name&&(A+="[".concat(t.name,"]"),t.name===xn.JOIN))return R.info("".concat(A," ").concat(y));R.info("".concat(A," ").concat(y),y==="start"?t.options:D||"")}}const m=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});p("start");let E=!1;Rr(t.timeout).then(()=>{E||(this.sendApiInvoke(St(St({},m()),{},{error:F.API_INVOKE_TIMEOUT,success:!1})),p("timeout"))});const v=new pe(F.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:y=>{const D=()=>{if(E)throw v;return E=!0,this.sendApiInvoke(St(St({},m()),{},{success:!0},t.reportResult&&{result:y})),p("onSuccess"),y};return n?EL(D,t.name+"Success",n,()=>E=!0):D()},onError:y=>{const D=()=>{if(E)throw y;E=!0,this.sendApiInvoke(St(St({},m()),{},{success:!1,error:y})),p("onFailure",y.toString())};return n?EL(D,t.name+"Error",n,()=>E=!0):D()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:W("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Jw?"global":"oversea",areas:W("AREAS")&&W("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:p,clientRole:m}=t,E=Date.now(),v=St(St({},r),{},{eventType:sr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Zw,lts:E,elapse:E-n,extend:JSON.stringify(i),mode:t.mode,process:W("PROCESS_ID"),appType:W("APP_TYPE"),success:!0,version:Qs,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:p,clientType:Ae(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:m,serviceId:W("PROCESS_ID"),extensionID:W("PLUGIN_INFO").join(",")||""});var y;this.send({type:yn.SESSION,data:v},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{role:t.role,eventType:sr.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:yn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:yn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:o,isProxy:c}=t,l=i-n.startTime,p=St(St({},r),{},{eventType:sr.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:l,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:Xw(),isABTestSuccess:t.isABTestSuccess?1:0}),m=p.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),s)this.send({type:yn.JOIN_GATEWAY,data:p},!0);else{let E;if(o)if(c){const y=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=o.match(/p=[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:y&&y.length?y[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:c?1:0}}else{const y=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=o.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:y&&y.length?y[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else E={isSuccess:m,gatewayIp:"",port:"",isProxy:c?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const v=Object.assign({},p,E,{eventType:sr.REJOIN_GATEWAY});this.send({type:yn.RE_JOIN_GATEWAY,data:v},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=St(St({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:yn.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:yn.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=St(St({},i),{},{eventType:sr.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:yn.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const n=[...Hi(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,o=Date.now(),c=St(St({},s),{},{eventType:sr.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:yn.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),o=St(St({},r),{},{elapse:i-n.startTime,eventType:sr.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:yn.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:c},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:c},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:sr.AB_TEST,lts:i});this.send({type:yn.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:sr.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:yn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:sr.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:yn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{eventType:t,lts:o});this.send({type:n,data:c},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:yn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?R.debug("reportProxyServerurl: ".concat(e)):R.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:yn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(s,o,c){const l=s[o];if(!l||typeof l!="string")return[s];s[o]="";const p=Ec(JSON.stringify(s));let m=0;const E=[];let v=0;for(let y=0;y<l.length;y++)v+=l.charCodeAt(y)<=127?1:3,v<=c-p||(E[E.length]=we(we({},s),{},{[o]:l.substring(m,y)}),m=y,v=l.charCodeAt(y)<=127?1:3);return m!==l.length-1&&(E[E.length]=we(we({},s),{},{[o]:l.substring(m)})),E})(St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:yn.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:yn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:yn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:yn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>W("CUSTOM_REPORT_LIMIT"))throw new pe(F.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(i=>({type:yn.USER_ANALYTICS,data:St(St({sid:e},i),{},{lts:n})}));try{W("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw R.error("send custom report message failed",i.toString()),new pe(F.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=W("NOT_REPORT_EVENT");if(e.tag&&Ae(t)&&Ae(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof pe){const{code:l,message:p}=e.error;o=l||p||e.error.toString()}else o=e.error.toString();const c={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:yn.API_INVOKE,data:c},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):r.push(s)}e.push(...r);for(const s of[...n]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),nh(i=this.ltsList).call(i,(o,c)=>o-c))}return t||(this.lastSendNormalEventTime=Date.now()),W("ENABLE_EVENT_REPORT")&&n.length&&(W("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>o=>{W("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-W("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Gn.networkState===os.OFFLINE&&await je.race([Gn.onlineWaiter,Rr(2*qn.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach(o=>{const c=Uw(JSON.stringify(o.data)),l=new ArrayBuffer(5),p=(E=>{let v=0;return Object.entries(yn).forEach(y=>{let[D,A]=y;A===E.type&&(v=EK[D])}),v})(o),m=new DataView(l);m.setUint16(0,c.byteLength,!0),m.setUint8(2,255&p),m.setUint8(3,p>>>8&255),m.setUint8(4,p>>>16&255),s=lL(s,new Uint8Array(l)),s=lL(s,c)}),s},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Hw(r,{timeout:1e4,data:t(e),headers:St(St({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(c=>{const l=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return l&&l.info.vid&&+l.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(c=>JSON.stringify(c)),vid:n,aid:r};Gn.networkState===os.OFFLINE&&await je.race([Gn.onlineWaiter,Rr(2*qn.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(W("EVENT_REPORT_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(W("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(s)));try{t?await rK(o,{timeout:1e4,data:i}):await Hw(o,{timeout:1e4,data:i})}catch(l){if(c===1)throw l;continue}return}}createBaseInfo(e,t){const n=Object.assign({},gK);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Tn.TRACER}).onSuccess()}};UL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Gn.networkState,qe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Tn.TRACER}).onSuccess("logUploadError")});class ae extends pe{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Dn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}}const wr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ft(){return wr}function FL(){return"setSinkId"in HTMLAudioElement.prototype&&(!W("RESTRICTION_SET_PLAYBACK_DEVICE")||(ll()||Qk())&&!Lw())}function Ny(){return!wr.supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dl()}function nb(e){return!(Nn()||Zk(87)||Ny()||!W("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}function BL(e){return!!W("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB"))}let br=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Cf(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Bt(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Mo(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function rb(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const vK={"90p":Bt(160,90),"90p_1":Bt(160,90),"120p":Bt(160,120,15,30,65),"120p_1":Bt(160,120,15,30,65),"120p_3":Bt(120,120,15,30,50),"120p_4":Bt(212,120),"180p":Bt(320,180,15,30,140),"180p_1":Bt(320,180,15,30,140),"180p_3":Bt(180,180,15,30,100),"180p_4":Bt(240,180,15,30,120),"240p":Bt(320,240,15,40,200),"240p_1":Bt(320,240,15,40,200),"240p_3":Bt(240,240,15,40,140),"240p_4":Bt(424,240,15,40,220),"360p":Bt(640,360,15,80,400),"360p_1":Bt(640,360,15,80,400),"360p_3":Bt(360,360,15,80,260),"360p_4":Bt(640,360,30,80,600),"360p_6":Bt(360,360,30,80,400),"360p_7":Bt(480,360,15,80,320),"360p_8":Bt(480,360,30,80,490),"360p_9":Bt(640,360,15,80,800),"360p_10":Bt(640,360,24,80,800),"360p_11":Bt(640,360,24,80,1e3),"480p":Bt(640,480,15,100,500),"480p_1":Bt(640,480,15,100,500),"480p_2":Bt(640,480,30,100,1e3),"480p_3":Bt(480,480,15,100,400),"480p_4":Bt(640,480,30,100,750),"480p_6":Bt(480,480,30,100,600),"480p_8":Bt(848,480,15,100,610),"480p_9":Bt(848,480,30,100,930),"480p_10":Bt(640,480,10,100,400),"720p":Bt(1280,720,15,120,1130),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Bt(1280,720,15,120,1130),"720p_2":Bt(1280,720,30,120,2e3),"720p_3":Bt(1280,720,30,120,1710),"720p_5":Bt(960,720,15,120,910),"720p_6":Bt(960,720,30,120,1380),"1080p":Bt(1920,1080,15,120,2080),"1080p_1":Bt(1920,1080,15,120,2080),"1080p_2":Bt(1920,1080,30,120,3e3),"1080p_3":Bt(1920,1080,30,120,3150),"1080p_5":Bt(1920,1080,60,120,4780),"1440p":Bt(2560,1440,30,120,4850),"1440p_1":Bt(2560,1440,30,120,4850),"1440p_2":Bt(2560,1440,60,120,7350),"4k":Bt(3840,2160,30,120,8910),"4k_1":Bt(3840,2160,30,120,8910),"4k_3":Bt(3840,2160,60,120,13500)},SK={"480p":Mo(640,480,5),"480p_1":Mo(640,480,5),"480p_2":Mo(640,480,30),"480p_3":Mo(640,480,15),"720p":Mo(1280,720,5),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Mo(1280,720,5),"720p_2":Mo(1280,720,30),"720p_3":Mo(1280,720,15),"1080p":Mo(1920,1080,5),"1080p_1":Mo(1920,1080,5),"1080p_2":Mo(1920,1080,30),"1080p_3":Mo(1920,1080,15)},yK={"1SL1TL":rb(1,1),"3SL3TL":rb(3,3),"2SL3TL":rb(2,3)};function Uo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},vK[e]):e}function ib(e){return typeof e=="string"?Object.assign({},SK[e]):e}function Py(e){return typeof e=="string"?Object.assign({},yK[e]):e}const TK={speech_low_quality:Cf(16e3,!1),speech_standard:Cf(32e3,!1,18),music_standard:Cf(48e3,!1),standard_stereo:Cf(48e3,!0,56),high_quality:Cf(48e3,!1,128),high_quality_stereo:Cf(48e3,!0,192)};function Dy(e){return typeof e=="string"?Object.assign({},TK[e]):e}const Rf=[];function WL(e){return ir(e,"mediaSource",["screen","window","application"]),!0}let Ke=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),rn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),wf=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),CK=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),RK=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),mh=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),bf=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),$s=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),If=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Rs=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const sb={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},ob={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},GL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},wK={uplinkNetworkQuality:0,downlinkNetworkQuality:0},HL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let _i=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),ws=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Lg=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),_h=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Fr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Sc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const ab={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ky=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Lt(e,t,n,r,i){var s,o,c={};return Object.keys(r).forEach(function(l){c[l]=r[l]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Ui(s=Ru(o=n.slice()).call(o)).call(s,function(l,p){return p(e,t,l)||l},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(e,t,c),null):c}function se(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KL(Object(n),!0).forEach(function(r){se(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class zL extends bn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(mh.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),se(this,"trackMediaType",void 0),se(this,"_ID",void 0),se(this,"_rtpTransceiver",void 0),se(this,"_lowRtpTransceiver",void 0),se(this,"_hints",[]),se(this,"_isClosed",!1),se(this,"_originMediaStreamTrack",void 0),se(this,"mediaStreamTrack",void 0),se(this,"_external",{}),this._ID=n||on(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){Ae(Rf).call(Rf,r)||Rf.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||vd(()=>{var n;qe.reportApiInvoke(null,{name:xn.GET_MEDIA_STREAM_TRACK,options:[],tag:Tn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===wf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Rf.indexOf(t);n!==-1&&Rf.splice(n,1)}(this),this.emit(bf.CLOSED),this.removeAllListeners(mh.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===wf.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(mh.TRANSCEIVER_UPDATED,t,n)}}class Af extends zL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),se(this,"_enabled",!0),se(this,"_muted",!1),se(this,"_isExternalTrack",!1),se(this,"_isClosed",!1),se(this,"_enabledMutex",void 0),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new jr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ke.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(bf.TRACK_ENDED)}stateCheck(t,n){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),ga(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new pe(F.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new pe(F.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():je.resolve([])}}const YL=window.AudioContext||window.webkitAudioContext;let bs=null;const en=new class extends bn{constructor(){super(...arguments),se(this,"prevState",void 0),se(this,"curState",void 0),se(this,"currentTime",void 0),se(this,"currentTimeStuckAt",void 0),se(this,"interruptDetectorTrack",void 0),se(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(br.IOS_15_16_INTERRUPTION_START)}),se(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(bs&&await bs.suspend(),this.emit(br.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){R.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){R.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Of(){if(!bs){if(function(){if(!YL)return void R.error("your browser is not support web audio");R.info("create audio context");const e=un({},W("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(e)),bs=new YL(e),en.curState=bs.state,bs.onstatechange=()=>{en.prevState=en.curState,en.curState=bs?bs.state:void 0;const{prevState:t,curState:n}=en,r=n==="running",i=n==="interrupted",s=t==="running",o=t==="suspended",c=t==="interrupted",l=xt().osVersion;(qr()||Lo())&&s&&i&&(R.info("ios".concat(l,"-interruption-start")),en.emit(br.IOS_INTERRUPTION_START)),(qr()||Lo())&&(o||c)&&r&&(R.info("ios".concat(l,"-interruption-end")),en.emit(br.IOS_INTERRUPTION_END)),t!==n&&en.emit(br.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=bs)===null||t===void 0?void 0:t.currentTime;en.currentTime!==n?(en.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(n)),en.currentTimeStuckAt=void 0),en.currentTime=n):(n!==en.currentTimeStuckAt&&(qe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Tn.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(n))),en.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,o=!1;function c(A){t.state==="running"?l(!1):qr()||Lo()?t.state==="suspended"&&(l(!0),A&&t.resume().then(p,p)):t.state!=="closed"&&(l(!0),A&&t.resume().then(p,p))}function l(A){if(i!==A){i=A;for(let N=0,j=n;N<j.length;N+=1){const V=j[N];A?window.addEventListener(V,m,{capture:!0,passive:!0}):window.removeEventListener(V,m,{capture:!0,passive:!0})}}}function p(){c(!1)}function m(){c(!0)}function E(A){if(!o)if(r.paused)if(A){let N;v(!1),o=!0;try{N=r.play(),N?N.then(y,y):(r.addEventListener("playing",y),r.addEventListener("abort",y),r.addEventListener("error",y))}catch{y()}}else v(!0);else v(!1)}function v(A){if(s!==A){s=A;for(let N=0,j=n;N<j.length;N++){const V=j[N];A?window.addEventListener(V,D,{capture:!0,passive:!0}):window.removeEventListener(V,D,{capture:!0,passive:!0})}}}function y(){r.removeEventListener("playing",y),r.removeEventListener("abort",y),r.removeEventListener("error",y),o=!1,E(!1)}function D(){E(!0)}if(qr()){const A=t.createMediaStreamDestination(),N=document.createElement("div");N.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=N.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=A.stream,E(!0)}en.on(br.STATE_CHANGE,function(){c(!0)}),c(!1)}(bs)}(),!bs)throw new pe(F.NOT_SUPPORTED,"can not create audio context");return bs}return bs}function gh(e){if(function(){if(cb!==null)return cb;const r=Of(),i=r.createBufferSource(),s=r.createGain(),o=r.createGain();i.connect(s),i.connect(o),i.disconnect(s);let c=!1;try{i.disconnect(s)}catch{c=!0}return i.disconnect(),cb=c,c}())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),Ae(o=e._inputNodes).call(o,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,s)):t.call(e,r,i)),e},e.disconnect=(r,i,s)=>{n.call(e),r?Ty(e._inputNodes,r):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let cb=null;function lb(e,t){let n=!1;const r=1/t;if(W("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=Of();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(n)return void(s=null);const c=i.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(i.currentTime+r),e(i.currentTime)};o()}return()=>{n=!0}}class qL{constructor(){se(this,"context",void 0),se(this,"analyserNode",void 0),se(this,"sourceNode",void 0),this.context=Of(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||qr()||Lo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=Ui(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class XL extends bn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),se(this,"outputNode",void 0),se(this,"outputTrack",void 0),se(this,"isPlayed",!1),se(this,"sourceNode",void 0),se(this,"context",void 0),se(this,"audioBufferNode",void 0),se(this,"destNode",void 0),se(this,"audioOutputLevel",0),se(this,"volumeLevelAnalyser",void 0),se(this,"_processedNode",void 0),se(this,"playNode",void 0),se(this,"isDestroyed",!1),se(this,"onNoAudioInput",void 0),se(this,"isNoAudioInput",!1),se(this,"_noAudioInputCount",0),this.context=Of(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),gh(this.outputNode),this.volumeLevelAnalyser=new qL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Rs.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ft().webAudioMediaStreamDest)throw new pe(F.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Cy(()=>{en.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;qr()||Lo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Rr(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class JL extends XL{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),se(this,"sourceNode",void 0),se(this,"track",void 0),se(this,"clonedTrack",void 0),se(this,"audioElement",void 0),se(this,"isCurrentTrackCloned",!1),se(this,"isRemoteTrack",!1),se(this,"originVolumeLevelAnalyser",void 0),se(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),gh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),gh(this.outputNode),this.emit(Rs.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new pe(F.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),gh(this.sourceNode),r){const c=r.clone();c.enabled=!0,this.clonedTrack=c,R.debug("create an unmuted track ".concat(c.id," from the original track ").concat(r.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([c]));gh(l),this.originVolumeLevelAnalyser=new qL,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=xt();n&&o.os===dr.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(en.on(br.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),gh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Rs.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),en.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),R.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));gh(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function QL(e,t,n){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function bK(e,t){const n=await ZL(e.mediaSource),{sourceId:r,audio:i}=await function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new je((c,l)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(j);const V=new Error("NotAllowedError");V.name="NotAllowedError",l(V)};let A=o;const N=document.createElement("div");if(o){const V=document.createElement("input");V.setAttribute("type","checkbox");const G=document.createElement("span");V.setAttribute("style","margin-right: 6px;"),G.innerText="Share audio",V.checked=A,V.onchange=()=>{A=V.checked},N.appendChild(V),N.appendChild(G)}y.appendChild(N),y.appendChild(D),m.appendChild(E),m.appendChild(v),m.appendChild(y);const j=document.createElement("div");j.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),j.appendChild(p),j.appendChild(m),document.body.appendChild(j),s.map(V=>{if(V.id){const G=document.createElement("div");G.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let $=V.thumbnail;try{const{width:Q}=$.getSize();Q>1920&&($=$.resize({width:1920}))}catch(Q){throw Q&&Q.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Q}G.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+V.name.replace(/[\u00A0-\u9999<>\&]/g,function(Q){return"&#"+Q.charCodeAt(0)+";"})+"</span>",G.onclick=()=>{document.body.removeChild(j),c({sourceId:V.id,audio:A})},v.appendChild(G)}})})}(n,t);return await QL(r,e,i)}async function ZL(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=dL();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new pe(F.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new je((s,o)=>{n.desktopCapturer.getSources({types:t},(c,l)=>{c?o(c):s(l)})}));try{return await r}catch(s){throw new pe(F.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const db=new jr("safari");let $L=!1,ex=!1;async function Is(e,t){let n=0,r=null;for(;n<2;)try{r=await IK(e,t,n>0);break}catch(i){if(i instanceof pe)throw R.error("[".concat(t,"] ").concat(i.toString())),i;const s=Ly(i.name||i.code||i,i.message);if(s.code===F.MEDIA_OPTION_INVALID){R.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Rr(500);continue}throw R.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new pe(F.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function IK(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new pe(F.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ft(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return R.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(dL())e.screen.sourceId?Nf(i,await QL(e.screen.sourceId,e.screen,!!e.screenAudio)):Nf(i,await bK(e.screen,!!e.screenAudio));else if(ll()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new pe(F.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const v=await(o=e.screen.extensionId,c=t,new je((y,D)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},A=>{if(!A||!A.streamId)return R.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),A),void D(new pe(F.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(A.streamId)})}catch(A){R.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),A.toString()),D(new pe(F.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=v,Nf(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&WL(e.screen.mediaSource);const v={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:N}=e.screen,j={selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:N};!y&&delete j.selfBrowserSurface,!D&&delete j.surfaceSwitching,!A&&delete j.systemAudio,!N&&delete j.preferCurrentTab,R.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:v,audio:e.screenAudio,controls:j})),Nf(i,await navigator.mediaDevices.getDisplayMedia(un({video:v,audio:e.screenAudio},j)))}else{if(!Nn())throw R.error("[".concat(t,"] This browser does not support screenSharing")),new pe(F.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&WL(e.screen.mediaSource);const v={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};R.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(v))),Nf(i,await navigator.mediaDevices.getUserMedia(v))}}var o,c;if(!e.video&&!e.audio)return i;let l={video:e.video,audio:e.audio},p=W("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),l=Fw(l,p)}catch{}R.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),xt();let m,E=null;(Nr()||qr()||Sy())&&(E=await db.lock());try{m=await navigator.mediaDevices.getUserMedia(l)}catch(v){throw E&&E(),v}return l.audio&&($L=!0),l.video&&(ex=!0),Nf(i,m),E&&E(),i}function Ly(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new pe(F.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new pe(F.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new pe(F.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new pe(F.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new pe(F.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new pe(F.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return R.error("getUserMedia unexpected error",e),new pe(F.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Nf(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const As=new class extends bn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(_h.STATE_CHANGE,e),this._state=e)}constructor(){super(),se(this,"_state",Lg.IDLE),se(this,"isAccessMicrophonePermission",!1),se(this,"isAccessCameraPermission",!1),se(this,"lastAccessMicrophonePermission",!1),se(this,"lastAccessCameraPermission",!1),se(this,"checkdeviceMatched",!1),se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(W("ENUMERATE_DEVICES_INTERVAL")||(yy()||vy()===dr.HARMONY_OS)&&dl())&&this.updateDevicesInfo()},W("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>R.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new pe(F.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(o=!1);let c=null,l=null,p=null;if(!n&&(s||o)){if(db.isLocked&&(R.debug("[device manager] wait GUM lock"),(await db.lock())(),R.debug("[device manager] GUM unlock")),$L&&(s=!1,this.isAccessMicrophonePermission=!0),ex&&(o=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const E=Ly(m.name||m.code||m,m.message);if(E.code===F.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){const E=Ly(m.name||m.code||m,m.message);if(E.code===F.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(o){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){const E=Ly(m.name||m.code||m,m.message);if(E.code===F.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",e,"cam permission",t)}try{const m=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(E=>E.stop()),l&&l.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),c=null,l=null,p=null,m}catch(m){return c&&c.getTracks().forEach(E=>E.stop()),l&&l.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),c=null,l=null,p=null,new pe(F.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new pe(F.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Lg.INITING;try{await this.updateDevicesInfo(),this.state=Lg.INITEND}catch(e){throw R.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Lg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new pe(F.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=e.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");i&&s?s.groupId===i.groupId?R.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):R.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):R.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),n.push(o)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Lg.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(_h.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(_h.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(_h.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let ub=!1;const Os=new class extends bn{constructor(){super(...arguments),se(this,"onAutoplayFailed",void 0),se(this,"onAudioAutoplayFailed",void 0)}};function tx(){if(xt(),!ub){const e=t=>{t.preventDefault(),ub=!1,Rg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};ub=!0,Rg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Os.onAutoplayFailed?Os.onAutoplayFailed():Os.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Os.emit("autoplay-failed")}}function nx(e,t,n,r){if(!e)return;const i=qe.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,o=Date.now(),c=un(un({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:Os.onAutoplayFailed||Os.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});qe.send({type:yn.AUTOPLAY_FAILED,data:c},!0)}const AK=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Oi=new class{constructor(){se(this,"onAutoplayFailed",void 0),se(this,"elementMap",new Map),se(this,"elementStateMap",new Map),se(this,"elementsNeedToResume",[]),se(this,"sinkIdMap",new Map),se(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(R.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return r.pause(),void r.play();if(en.curState==="running")return _f()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),en.on(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),en.on(br.STATE_CHANGE,()=>{qr()&&en.prevState==="suspended"&&en.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new pe(F.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Fr.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch(c=>{R.warning("[".concat(t,"] set sink id failed"),c.toString())})}catch(c){R.warning("[".concat(t,"] set sink id failed"),c.toString())}const o=i.play();o&&o.then&&o.catch(c=>{r&&nx(r,"audio",c.message,t),R.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Cy(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),tx()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){AK.forEach(n=>{t.addEventListener(n,r=>{const i=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(R.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const o=t?.error;o&&R.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{R.debug("Auto resume audio element success")}).catch(n=>{R.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new je(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Rg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function kn(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new pe(F.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const c=r.apply(this,s);return c instanceof je?new je((l,p)=>{c.then(l).catch(p)}):c}),n}}class rx extends bn{constructor(t){super(),se(this,"name","VideoProcessorDestination"),se(this,"ID","0"),se(this,"_source",void 0),se(this,"videoContext",void 0),se(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new pe(F.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new pe(F.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(_i.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(_i.ON_TRACK,void 0)}}class ix extends bn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"usageRegistry",[]),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Dr(this,ws.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return R.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){R.error(new pe(F.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof je&&(r=await r),t.push(un(un({},r),{},{direction:this.direction}))}catch(r){R.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class sx extends bn{constructor(t){super(),se(this,"name","AudioProcessorDestination"),se(this,"ID","0"),se(this,"inputTrack",void 0),se(this,"inputNode",void 0),se(this,"audioProcessorContext",void 0),se(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new pe(F.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new pe(F.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(_i.ON_TRACK,void 0),this.emit(_i.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(_i.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(_i.ON_NODE,this.inputNode))}}class ox extends bn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"audioContext",void 0),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"usageRegistry",[]),se(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Dr(this,ws.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){R.error(new pe(F.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof je&&(r=await r),t.push(un(un({},r),{},{direction:this.direction}))}catch(r){R.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class hb extends bn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),se(this,"context",void 0),se(this,"processSourceNode",void 0),se(this,"outputTrack",void 0),se(this,"processedNode",void 0),se(this,"clonedTrack",void 0),se(this,"outputNode",void 0),this.outputNode=new OK}setVolume(){}createOutputTrack(){throw new pe(F.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class OK{disconnect(){}connect(){}}function ax(e){return new je((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=qr()?"canplay":"playing";i.addEventListener(s,()=>{const o=i.videoWidth,c=i.videoHeight;!o&&Nn()||(r=!0,i.srcObject=null,i.remove(),t([o,c]))}),i.srcObject=new MediaStream([e]),i.play().catch(Ry),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function xy(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Uo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!sL()&&n.frameRate&&(t.frameRate=n.frameRate),Qk()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Nn()&&(t.frameRate={ideal:30,max:30}),t}function cx(e){const t={};return sL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,ll()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function lx(e){const t=cx(e);if(e.encoderConfig){const n=Dy(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),yy()&&(t.sampleRate=void 0),t}const NK=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=r,height:c=i}=t;if(!s||!o||!c)return;o=vf(o),c=vf(c),s=vf(s);const{max:l,min:p}=function(y,D,A){const N=200*Math.pow(A/15,.6)*Math.pow(y*D/640/360,.75);return{min:Math.floor(N),max:Math.floor(4*N)}}(o,c,s),{bitrateMax:m,bitrateMin:E}=t||{};m||R.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(m,", brMin: ").concat(E,"]"));const{maxFramerate:v}=W("ENCODER_CONFIG_LIMIT");return v&&typeof v=="number"&&(s=Math.min(s,v)),{frameRate:s,bitrateMax:m||l,bitrateMin:E||p,scaleResolutionDownBy:1,scale:0}},dx=async(e,t,n)=>await(async(r,i,s)=>{const o=function(p){const m=[];for(let E=0;E<p.length;E+=2)m.push(parseInt(p.slice(E,E+2),16));return Uint8Array.from(m)}(yL(""+i+s)).slice(0,16),c=o.slice(0,12),l=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},l,r))})(e.buffer,t,n),pb=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new je((n,r)=>{t.toBlob(async i=>{if(t.remove(),i){const s=await ux(i);n({buffer:s,width:t.width,height:t.height})}else r(new pe(F.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},ux=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var hx,px,fx,mx,_x,gx,Ex,vx,Sx,yx,Tx,Cx,Rx,wx,bx,Ix,Ax,Ox,In,Nx,Px,Dx,kx,Lx,xx,yc,Mx,Ux,Vx,jx,Fx,Bx,Wx,Gx,Hx,Kx,zx,Yx,qx,Lr;let Ln=(hx=ot({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),px=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),fx=kn(),mx=Sf("LocalAudioTrack","_enabledMutex"),_x=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),gx=kn(),Ex=Sf("LocalAudioTrack","_enabledMutex"),vx=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),Sx=kn(),yx=kn(),Tx=kn(),Cx=ot({argsMap:e=>[e.getTrackId()]}),Rx=kn(),wx=ot({argsMap:e=>[e.getTrackId()]}),bx=kn(),Ix=ot({argsMap:e=>[e.getTrackId()]}),Ax=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ox=ot({argsMap:e=>[e.getTrackId()]}),Lt((In=class extends Af{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),se(this,"trackMediaType",If.AUDIO),se(this,"_encoderConfig",void 0),se(this,"_trackSource",void 0),se(this,"metadata",[]),se(this,"_enabled",!0),se(this,"_volume",100),se(this,"_useAudioElement",!0),se(this,"_bypassWebAudio",!1),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_processorDestination",void 0),se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new hb,W("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),W("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Nr()&&!bs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){nn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Oi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,sn(this,Ke.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!FL())throw new pe(F.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await sn(this,Ke.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await sn(this,Ke.NEED_MUTE_TRACK,this):await sn(this,Ke.NEED_UNMUTE_TRACK,this))}getStats(){return vd(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},sb)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),this._source.on(Rs.ON_AUDIO_BUFFER,n=>e(n))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return je.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new pe(F.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(_i.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await sn(this,Ke.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this))}),e.on(_i.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(_i.ON_TRACK),e.removeAllListeners(_i.ON_NODE)}bindProcessorContextEvents(e){e.on(ws.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ws.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof hb&&(this._trackSource=new JL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new ox(this._source.context,this.getTrackId(),"local"),t=new sx(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Rs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Oi.stop(this.getTrackId()),this._source.play()),sn(this,Ke.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[hx],Object.getOwnPropertyDescriptor(In.prototype,"setVolume"),In.prototype),Lt(In.prototype,"setPlaybackDevice",[px,fx],Object.getOwnPropertyDescriptor(In.prototype,"setPlaybackDevice"),In.prototype),Lt(In.prototype,"setEnabled",[mx,_x,gx],Object.getOwnPropertyDescriptor(In.prototype,"setEnabled"),In.prototype),Lt(In.prototype,"setMuted",[Ex,vx,Sx],Object.getOwnPropertyDescriptor(In.prototype,"setMuted"),In.prototype),Lt(In.prototype,"getStats",[yx],Object.getOwnPropertyDescriptor(In.prototype,"getStats"),In.prototype),Lt(In.prototype,"setAudioFrameCallback",[Tx],Object.getOwnPropertyDescriptor(In.prototype,"setAudioFrameCallback"),In.prototype),Lt(In.prototype,"play",[Cx,Rx],Object.getOwnPropertyDescriptor(In.prototype,"play"),In.prototype),Lt(In.prototype,"stop",[wx,bx],Object.getOwnPropertyDescriptor(In.prototype,"stop"),In.prototype),Lt(In.prototype,"close",[Ix],Object.getOwnPropertyDescriptor(In.prototype,"close"),In.prototype),Lt(In.prototype,"pipe",[Ax],Object.getOwnPropertyDescriptor(In.prototype,"pipe"),In.prototype),Lt(In.prototype,"unpipe",[Ox],Object.getOwnPropertyDescriptor(In.prototype,"unpipe"),In.prototype),In),xg=(Nx=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),Px=kn(),Dx=Sf("MicrophoneAudioTrack","_enabledMutex"),kx=ot({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Lx=kn(),xx=ot({argsMap:e=>[e.getTrackId()]}),Lt((yc=class extends Ln{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Dy(t.encoderConfig):{},r,W("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),se(this,"_config",void 0),se(this,"_deviceName","default"),se(this,"_constraints",void 0),se(this,"_originalConstraints",void 0),se(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(_f()||kw())&&en.bindInterruptDetectorTrack(this)}async setDevice(e){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await As.getDeviceById(e),n={};n.audio=un({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Is(n,this.getTrackId())}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Is({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await As.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}R.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),W("AUTO_RESET_AUDIO_ROUTE")&&(qr()||Lo())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(o){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=un({},this._constraints),s=As.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const o=await Is({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await sn(this,Ke.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(_f()||kw())&&en.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((qr()||Lo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const e=async()=>{en.off(br.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(br.IOS_INTERRUPTION_END,e)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(bf.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=As.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Is({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ws.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ws.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Nx,Px],Object.getOwnPropertyDescriptor(yc.prototype,"setDevice"),yc.prototype),Lt(yc.prototype,"setEnabled",[Dx,kx,Lx],Object.getOwnPropertyDescriptor(yc.prototype,"setEnabled"),yc.prototype),Lt(yc.prototype,"close",[xx],Object.getOwnPropertyDescriptor(yc.prototype,"close"),yc.prototype),yc),PK=(Mx=ot({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Ux=kn(),Vx=ot({argsMap:e=>[e.getTrackId()]}),jx=kn(),Fx=ot({argsMap:e=>[e.getTrackId()]}),Bx=kn(),Wx=ot({argsMap:e=>[e.getTrackId()]}),Gx=kn(),Hx=ot({argsMap:e=>[e.getTrackId()]}),Kx=kn(),zx=ot({argsMap:e=>[e.getTrackId()]}),Yx=ot({argsMap:e=>[e.getTrackId()]}),qx=kn(),Lt((Lr=class extends Ln{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),se(this,"source",void 0),se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Rs.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(bf.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){nn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Mx,Ux],Object.getOwnPropertyDescriptor(Lr.prototype,"startProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"pauseProcessAudioBuffer",[Vx,jx],Object.getOwnPropertyDescriptor(Lr.prototype,"pauseProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"seekAudioBuffer",[Fx,Bx],Object.getOwnPropertyDescriptor(Lr.prototype,"seekAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"resumeProcessAudioBuffer",[Wx,Gx],Object.getOwnPropertyDescriptor(Lr.prototype,"resumeProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"stopProcessAudioBuffer",[Hx,Kx],Object.getOwnPropertyDescriptor(Lr.prototype,"stopProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"close",[zx],Object.getOwnPropertyDescriptor(Lr.prototype,"close"),Lr.prototype),Lt(Lr.prototype,"setAudioBufferPlaybackSpeed",[Yx,qx],Object.getOwnPropertyDescriptor(Lr.prototype,"setAudioBufferPlaybackSpeed"),Lr.prototype),Lr);class $n extends Ln{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Of().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,on(8,"track-mix-")),se(this,"trackList",void 0),se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(R.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):R.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){R.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Ty(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof $n?n.emit(mh.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class DK extends XL{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Rs.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),se(this,"audioBuffer",void 0),se(this,"sourceNode",void 0),se(this,"startPlayTime",0),se(this,"startPlayOffset",0),se(this,"pausePlayTime",0),se(this,"options",void 0),se(this,"currentLoopCount",0),se(this,"currentPlaybackSpeed",100),se(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Xx=new Map;function Jx(e,t){if(e.length===0||t.length===0)return 1/0;const n=Bw(e),r=Bw(t);return Math.floor(r/n)}class fb{get rendFrameRate(){const t=Math.max(1,Jx(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Fr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){se(this,"trackId",void 0),se(this,"config",void 0),se(this,"onFirstVideoFrameDecoded",void 0),se(this,"onFirstVideoFrameRender",void 0),se(this,"onVideoStateChanged",void 0),se(this,"freezeTimeCounterList",[]),se(this,"renderFreezeAccTime",0),se(this,"renderFreezeAccTime2",0),se(this,"isKeepLastFrame",!1),se(this,"isDestroyed",!1),se(this,"timeUpdatedCount",0),se(this,"freezeTime",0),se(this,"playbackTime",0),se(this,"lastTimeUpdatedTime",0),se(this,"autoplayFailed",!1),se(this,"videoTrack",void 0),se(this,"videoElement",void 0),se(this,"cacheVideoElement",void 0),se(this,"internal",!1),se(this,"_render_interframe_delays",[]),se(this,"_render_interframe_delays_sizes",[]),se(this,"_videoState",Sc.VideoStateStopped),se(this,"videoElementCheckInterval",void 0),se(this,"videoElementFreezeTimeout",void 0),se(this,"_videoElementStatus",Fr.NONE),se(this,"_isInPage",!0),se(this,"isGettingVideoDimensions",!1),se(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&en.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Xk())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),se(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Fr.PLAYING;break;case"loadeddata":if(this.videoState=Sc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Fr.CANPLAY;break;case"stalled":this.videoElementStatus=Fr.STALLED;break;case"suspend":this.videoElementStatus=Fr.SUSPEND;break;case"pause":this.videoElementStatus=Fr.PAUSED,qr()||Lo()||Nr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Fr.WAITING;break;case"abort":this.videoElementStatus=Fr.ABORT;break;case"ended":this.videoElementStatus=Fr.ENDED;break;case"emptied":this.videoElementStatus=Fr.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=Fr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Tc.lastVisibleTime<Tc.lastHiddenTime||s<Tc.lastHiddenTime||s<Tc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>W("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Xk())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),en.on(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&nx(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),i)});const r=xt();if((r.name==="Safari"&&Number(r.version)===15||_f())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return R.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new je((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const l=await ux(c);s({buffer:l,width:r.width,height:r.height})}else o(new pe(F.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await pb(t)}destroy(){this.isDestroyed=!0,en.off(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.off(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Sc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Fr.INIT,!this.videoElementCheckInterval&&(Qx.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(s){return s!==document.body&&document.body.contains(s)}(this.videoElement)},1e3),W("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,W("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Sc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Sc.VideoStateFrozen:document.addEventListener("visibilitychange",o))},l=(p,m)=>{if(this.videoElementStatus===Fr.PLAYING){if(s){const y=m.presentationTime-s.presentationTime,D=m.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(D),this._render_interframe_delays.push(y);const A=Bw(this._render_interframe_delays_sizes),N=A-this._render_interframe_delays_sizes[0];if(A>30&&N>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Sc.VideoStateStarting&&(this.videoState=Sc.VideoStateDecoding),this.videoState===Sc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,W("VIDEO_FREEZE_DURATION"))),y<W("VIDEO_FREEZE_DURATION")&&this.videoState===Sc.VideoStateFrozen&&(this.videoState=Sc.VideoStateDecoding),y>W("VIDEO_FREEZE_DURATION")&&Tc.lastVisibleTime>=Tc.lastHiddenTime&&s.timestamp>Tc.lastVisibleTime&&s.timestamp>Tc.lastHiddenTime){const j=Math.min(66,Jx(this._render_interframe_delays_sizes,this._render_interframe_delays)),V=Math.max(0,y-(D-1)*j);this.renderFreezeAccTime2+=V>j?V:0,this.renderFreezeAccTime+=y}}s=un(un({},m),{},{timestamp:p})}else this.isSkipCalcRenderFreezeTime()&&(s=un(un({},m),{},{timestamp:p}));var E,v;W("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(v=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(v,l))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,l)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),yy()&&!W("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=xt();r.name==="Safari"&&Number(r.version)===15||_f()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{R.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){Qx.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Fr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Fr.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{R.error(r)}),this.autoplayFailed=!1,Rg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Rg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),tx()}}const Qx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class mb extends fb{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),se(this,"container",void 0),se(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await pb(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",W("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Zx,$x,eM,tM,nM,rM,iM,sM,oM,aM,cM,lM,dM,uM,hM,pM,fM,mM,_M,gM,EM,vM,SM,yM,TM,CM,RM,wM,It,bM,IM,AM,OM,NM,PM,DM,kM,Ns;let mn=(Zx=ot({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),$x=kn(),eM=ot({argsMap:e=>[e.getTrackId()]}),tM=Sf("LocalVideoTrack","_enabledMutex"),nM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),rM=kn(),iM=Sf("LocalVideoTrack","_enabledMutex"),sM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),oM=kn(),aM=ot({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),cM=kn(),lM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),dM=kn(),uM=kn(),hM=ot({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),pM=kn(),fM=kn(),mM=kn(),_M=ot({argsMap:e=>[e.getTrackId()]}),gM=kn(),EM=kn(),vM=kn(),SM=kn(),yM=kn(),TM=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),CM=ot({argsMap:e=>[e.getTrackId()]}),RM=ot({argsMap:e=>[e.getTrackId()]}),wM=ot({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),It=class vF extends Af{get videoHeight(){if(Nr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Nr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,s,o){if(super(t,s),se(this,"trackMediaType",If.VIDEO),se(this,"_player",void 0),se(this,"isUseScaleResolutionDownBy",!1),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"_encoderConfig",void 0),se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),se(this,"_optimizationMode",void 0),se(this,"_saveEncodeBitrateRatio",1),se(this,"_videoHeight",void 0),se(this,"_videoWidth",void 0),se(this,"_forceBitrateLimit",void 0),se(this,"_enabled",!0),se(this,"_processorDestination",void 0),se(this,"_processorContext",void 0),Nr()){const{width:c,height:l}=t.getSettings();this._videoWidth=c,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],n&&this._hints.indexOf(rn.CUSTOM_TRACK)!==-1?this._encoderConfig=Cn(n):this._encoderConfig=n,this._hints.indexOf(rn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Aw(Wt.CHROME,115)&&vy().indexOf("Windows")!==-1){const c=function(l,p){if("VideoFrame"in window&&"TransformStream"in window&&Ft().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(l),E=new MediaStreamTrackGenerator({kind:"video"});let v,y,D=Date.now();const A=()=>{N&&(clearInterval(N),N=void 0),v&&(v.close(),v=void 0),l.stop(),y=void 0,E.removeEventListener("ended",A)};let N=window.setInterval(()=>{if(y&&v&&Date.now()-D>1e3)try{E.readyState==="live"?y.enqueue(v.clone()):A()}catch{A()}},1e3);const j=new TransformStream({transform:(V,G)=>{E.readyState==="live"?(y=G,D=Date.now(),v===void 0?(v=V,G.enqueue(V.clone())):(G.enqueue(v),v=V)):V.close()}});return E.addEventListener("ended",A),m.readable.pipeThrough(j).pipeTo(E.writable),E}}(t);c&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}n&&this._hints.indexOf(rn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new ix(this.getTrackId(),"local"),this._processorDestination=new rx(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=un(un(un({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new fb(r):this._player=new mb(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(bf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sn(this,Ke.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await sn(this,Ke.NEED_MUTE_TRACK,this):await sn(this,Ke.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new pe(F.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Uo(t),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=xy({encoderConfig:t});(Nr()||qr()||Lo())&&(r.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new pe(F.UNEXPECTED_ERROR,i.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(R)}}getStats(){return vd(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},ob)}async setBeautyEffect(t){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await pb(t)}async findClosestProfile(){const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:o}=this._encoderConfig||{},c=vf(this._videoWidth||t||i||0),l=vf(this._videoHeight||n||s||0),p=function(m,E,v){if(!Array.isArray(W("VIDEO_ENCODER_CONFIG_LIST"))||W("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const y=Math.min(m,E);return!(y>=480)&&un(un({},W("VIDEO_ENCODER_CONFIG_LIST").find(D=>D.height>y)),{},{frameRate:v})}(c,l,vf(r||o||15));if(p)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(l," => ").concat(JSON.stringify(p))),this.setEncoderConfiguration(p)}async setBitrateLimit(t){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void R.error(F.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await sn(this,Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return R.error(F.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){ax(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Ry)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new pe(F.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Uo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:c}=function(l,p,m,E,v){const y=W("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:E,max:v};if(v===void 0){const D=Math.floor(200*Math.pow(m/15,.6)*Math.pow(l*p/640/360,.75));v=y==="STANDARD_BITRATE"?4*D:2*D,E=E??D}else E=E??Math.floor(v/10);return{min:E,max:v}}(t,n,r,s,i);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,W("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){const[l,p]=function(m,E,v){const y=4*Math.floor(2e5*Math.pow(v/15,.6)*Math.pow(m*E/230400,.75)),D=m*E,A=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),N=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let j=rs(A).call(A).next().value,V=1;if(A.has(D))j=A.get(D);else{var G;const Re=nh(G=Array.from(A.entries())).call(G,(bt,ut)=>{let[Yt]=bt,[Ht]=ut;return Yt-Ht}),Ct=Re.find(bt=>{let[ut]=bt;return ut>D});if(Ct){const bt=Re.indexOf(Ct);if(bt>0){const ut=Re[bt-1],Yt=(D-ut[0])/(Ct[0]-ut[0]);j=ut[1]+Yt*(Ct[1]-ut[1])}else j=Ct[1]}else j=Re[Re.length-1][1]}if(N.has(D))V=N.get(D);else{var $;const Re=nh($=Array.from(N.entries())).call($,(bt,ut)=>{let[Yt]=bt,[Ht]=ut;return Yt-Ht}),Ct=Re.find(bt=>{let[ut]=bt;return ut>D});if(Ct){const bt=Re.indexOf(Ct);if(bt>0){const ut=Re[bt-1],Yt=(D-ut[0])/(Ct[0]-ut[0]);V=ut[1]+Yt*(Ct[1]-ut[1])}else V=Ct[1]}else V=Re[Re.length-1][1]}const Q=W("VIDEO_NEW_BITRATE_RATIO");Q&&Q>0&&(j=Q/100);const z=Math.floor(y*j),re=Math.floor(65e4*Math.pow(m*E/230400,.5)*Math.pow(v/15,.69));let fe=z;const ve=W("VIDEO_STANDARD_BITRATE_VERSION");return ve&&ve>0&&(ve===1?fe=y:ve===2?fe=z:ve===3&&(fe=re)),[Math.floor(fe/1e3),V]}(t,n,r);this._encoderConfig.bitrateMax=l,this._encoderConfig.bitrateMin=c?Math.min(c,l):l,this._saveEncodeBitrateRatio=p,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r?.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=cL.checkOneElementVisible(s),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const p=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(r){throw new pe(F.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=un(un({},r),Uo(t))),r=uh(r);const i=on(8,"track-video-cloned-"),s=new vF(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,uh(this._scalabilityMode),this._optimizationMode,i,uh(this._hints));return t&&r&&s.setEncoderConfiguration(r),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new pe(F.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new pe(F.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(vd(()=>{qe.reportApiInvoke(null,{name:xn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Tn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!W("ENABLE_VIDEO_SEI")||!W("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new pe(F.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void R.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):R.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ws.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ws.REQUEST_CONSTRAINTS)}},Lt(It.prototype,"play",[Zx,$x],Object.getOwnPropertyDescriptor(It.prototype,"play"),It.prototype),Lt(It.prototype,"stop",[eM],Object.getOwnPropertyDescriptor(It.prototype,"stop"),It.prototype),Lt(It.prototype,"setEnabled",[tM,nM,rM],Object.getOwnPropertyDescriptor(It.prototype,"setEnabled"),It.prototype),Lt(It.prototype,"setMuted",[iM,sM,oM],Object.getOwnPropertyDescriptor(It.prototype,"setMuted"),It.prototype),Lt(It.prototype,"setSaveEncodeBitrateRatio",[aM,cM],Object.getOwnPropertyDescriptor(It.prototype,"setSaveEncodeBitrateRatio"),It.prototype),Lt(It.prototype,"setEncoderConfiguration",[lM,dM],Object.getOwnPropertyDescriptor(It.prototype,"setEncoderConfiguration"),It.prototype),Lt(It.prototype,"getStats",[uM],Object.getOwnPropertyDescriptor(It.prototype,"getStats"),It.prototype),Lt(It.prototype,"setBeautyEffect",[hM,pM],Object.getOwnPropertyDescriptor(It.prototype,"setBeautyEffect"),It.prototype),Lt(It.prototype,"getCurrentFrameData",[fM],Object.getOwnPropertyDescriptor(It.prototype,"getCurrentFrameData"),It.prototype),Lt(It.prototype,"getCurrentFrameImage",[mM],Object.getOwnPropertyDescriptor(It.prototype,"getCurrentFrameImage"),It.prototype),Lt(It.prototype,"findClosestProfile",[_M,gM],Object.getOwnPropertyDescriptor(It.prototype,"findClosestProfile"),It.prototype),Lt(It.prototype,"setBitrateLimit",[EM],Object.getOwnPropertyDescriptor(It.prototype,"setBitrateLimit"),It.prototype),Lt(It.prototype,"setOptimizationMode",[vM],Object.getOwnPropertyDescriptor(It.prototype,"setOptimizationMode"),It.prototype),Lt(It.prototype,"setScalabiltyMode",[SM],Object.getOwnPropertyDescriptor(It.prototype,"setScalabiltyMode"),It.prototype),Lt(It.prototype,"updateMediaStreamTrackResolution",[yM],Object.getOwnPropertyDescriptor(It.prototype,"updateMediaStreamTrackResolution"),It.prototype),Lt(It.prototype,"pipe",[TM],Object.getOwnPropertyDescriptor(It.prototype,"pipe"),It.prototype),Lt(It.prototype,"unpipe",[CM],Object.getOwnPropertyDescriptor(It.prototype,"unpipe"),It.prototype),Lt(It.prototype,"close",[RM],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),Lt(It.prototype,"replaceTrack",[wM],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),It),My=(bM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),IM=kn(),AM=Sf("CameraVideoTrack","_enabledMutex"),OM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),NM=kn(),PM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),DM=kn(),kM=ot({argsMap:e=>[e.getTrackId()]}),Ns=class SF extends mn{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,s,o){super(t,Uo(n.encoderConfig),i,s,o),se(this,"_config",void 0),se(this,"_originalConstraints",void 0),se(this,"_constraints",void 0),se(this,"_enabled",!0),se(this,"_deviceName","default"),se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(_f()||kw())&&!function(){const c=xt();if(c.os!==dr.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&iL()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Uo(this._config.encoderConfig),en.on(br.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.on(br.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await As.getDeviceById(t),r={};r.video=un({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Is(r,this.getTrackId())}catch(s){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Is({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await As.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:un(un({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Is(n,this.getTrackId())}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Is({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=un({},n.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Is({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await sn(this,Ke.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new pe(F.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Uo(t),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Cn(this._config);r.encoderConfig=t;const i=xy(r);(Nr()||qr()||Lo())&&(i.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new pe(F.UNEXPECTED_ERROR,s.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((qr()||Lo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const t=async()=>{en.off(br.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(br.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(bf.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=As.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await Is({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),en.off(br.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.off(br.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=un(un({},r),Uo(t))),r=uh(r);const i=on(8,"track-cam-cloned-"),s=new SF(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,uh(un(un({},this._config),{},{encoderConfig:r})),uh(this._constraints),uh(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(ws.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(ws.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Lt(Ns.prototype,"setDevice",[bM,IM],Object.getOwnPropertyDescriptor(Ns.prototype,"setDevice"),Ns.prototype),Lt(Ns.prototype,"setEnabled",[AM,OM,NM],Object.getOwnPropertyDescriptor(Ns.prototype,"setEnabled"),Ns.prototype),Lt(Ns.prototype,"setEncoderConfiguration",[PM,DM],Object.getOwnPropertyDescriptor(Ns.prototype,"setEncoderConfiguration"),Ns.prototype),Lt(Ns.prototype,"close",[kM],Object.getOwnPropertyDescriptor(Ns.prototype,"close"),Ns.prototype),Ns);function _b(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=un(un({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?R.debug("[".concat(e,"] set content hint to"),n.optimizationMode):R.debug("[".concat(e,"] set content hint failed")))):R.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var LM,xM,MM,UM,eo,VM,jM,FM,BM,WM,GM,ii;class HM extends zL{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(on(5,""))),se(this,"_userId",void 0),se(this,"_uintId",void 0),se(this,"_isDestroyed",!1),se(this,"store",void 0),se(this,"processor",void 0),se(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Pf=(LM=ot({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),xM=ot({argsMap:e=>[e.getTrackId()]}),MM=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),UM=ot({argsMap:e=>[e.getTrackId()]}),Lt((eo=class extends HM{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"trackMediaType",If.VIDEO),se(this,"_videoWidth",void 0),se(this,"_videoHeight",void 0),se(this,"_player",void 0),se(this,"_prePlayer",void 0),se(this,"processorDestination",void 0),se(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new ix(this.getTrackId(),"remote"),this.processorDestination=new rx(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return vd(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},HL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit($s.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=un(un({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new fb(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new mb(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit($s.FIRST_FRAME_DECODED),i&&this.safeEmit($s.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit($s.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit($s.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit($s.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){ax(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Ry)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=cL.checkOneElementVisible(i),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const l=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new pe(F.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(mh.SEI_RECEIVED,e)}}).prototype,"play",[LM],Object.getOwnPropertyDescriptor(eo.prototype,"play"),eo.prototype),Lt(eo.prototype,"stop",[xM],Object.getOwnPropertyDescriptor(eo.prototype,"stop"),eo.prototype),Lt(eo.prototype,"pipe",[MM],Object.getOwnPropertyDescriptor(eo.prototype,"pipe"),eo.prototype),Lt(eo.prototype,"unpipe",[UM],Object.getOwnPropertyDescriptor(eo.prototype,"unpipe"),eo.prototype),eo),Df=(VM=ot({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),jM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),FM=ot({argsMap:e=>[e.getTrackId()]}),BM=ot({argsMap:e=>[e.getTrackId()]}),WM=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),GM=ot({argsMap:e=>[e.getTrackId()]}),Lt((ii=class extends HM{get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),se(this,"trackMediaType",If.AUDIO),se(this,"_source",void 0),se(this,"_useAudioElement",!0),se(this,"_volume",100),se(this,"processorContext",void 0),se(this,"processorDestination",void 0),se(this,"_played",!1),se(this,"_bypassWebAudio",!1),W("DISABLE_WEBAUDIO")?(this._source=new hb,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new JL(e,!0),W("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Rs.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit($s.FIRST_FRAME_DECODED)}),this.processorContext=new ox(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new sx(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Rs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),this._source.on(Rs.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Oi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!FL())throw new pe(F.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return vd(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},GL)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(_i.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK),this.processorDestination.removeAllListeners(_i.ON_NODE)}}).prototype,"setVolume",[VM],Object.getOwnPropertyDescriptor(ii.prototype,"setVolume"),ii.prototype),Lt(ii.prototype,"setPlaybackDevice",[jM],Object.getOwnPropertyDescriptor(ii.prototype,"setPlaybackDevice"),ii.prototype),Lt(ii.prototype,"play",[FM],Object.getOwnPropertyDescriptor(ii.prototype,"play"),ii.prototype),Lt(ii.prototype,"stop",[BM],Object.getOwnPropertyDescriptor(ii.prototype,"stop"),ii.prototype),Lt(ii.prototype,"pipe",[WM],Object.getOwnPropertyDescriptor(ii.prototype,"pipe"),ii.prototype),Lt(ii.prototype,"unpipe",[GM],Object.getOwnPropertyDescriptor(ii.prototype,"unpipe"),ii.prototype),ii);const Tc=new class extends bn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),se(this,"_lastHiddenTime",0),se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class KM extends bn{constructor(t,n){super(),se(this,"trackMediaType",If.DATA),se(this,"_version",1),se(this,"_type",3),se(this,"_config",void 0),se(this,"_originDataChannel",void 0),se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),se(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),se(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return W("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new je((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;n(new pe(F.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new pe(F.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new pe(F.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[ky.OPEN,ky.CLOSE,ky.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class kK extends KM{constructor(t){super(t),se(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(W("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(ky.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class LK extends KM{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function Uy(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>MS.revokeObjectURL(e),0),new Worker(MS.createObjectURL(e))}const zM=71,gb=1,Eb=2,vb=1,YM=2;var Td=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Td||{});function Sb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==zM)return;const r=e.getUint16(1),i=gb+Eb+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const o={m:n,tlvLen:r,tlv:[],frame:s};let c=gb+Eb;for(;c<i;){const l=e.getUint8(c),p=e.getUint16(c+vb),m=vb+YM;if(l===Td.AUDIO_LEVEL){let E=e.getUint8(c+m);for(let v=1;v<p;v++)E=E<<8|e.getUint8(c+m+v);o.tlv.push({tag:l,length:p,value:t?127^E>>1:127&E})}else if(l===Td.METADATA||l===Td.AUDIO_64_BIT_PTS){const E=new Uint8Array(p);for(let v=0;v<p;v++)E[v]=e.getUint8(c+m+v);o.tlv.push({tag:l,length:p,value:E})}c+=m+p}return o}const Vy=new Map,jy=127,Eh=1e-10,yb=139/13,Fy=new Map;function Tb(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;return Fy.has(r)?i=Fy.get(r):(i=Math.log(function(o,c){const l=o-c;c<l&&(c=l);let p=1;for(let m=o,E=1;m>c;m--,E++)p=p*m/E;return p}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,Fy.set(r,i)),i<Eh&&(i=Eh),i}function qM(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let o=0,c=0;o<r;o++){let l=0;for(let p=c+i;c<p;c++)e[c]>n&&l++;t[o]!==l&&(t[o]=l,s=!0)}return s}window.cache=Fy;let xK=0;class XM{constructor(t){se(this,"id",void 0),se(this,"immediates",[]),se(this,"lastNonSilence",-1),se(this,"immediateSpeechActivityScore",Eh),se(this,"lastLevelChangedTime",Date.now()),se(this,"levels",[]),se(this,"longs",[]),se(this,"longSpeechActivityScore",Eh),se(this,"mediums",[]),se(this,"mediumSpeechActivityScore",Eh),se(this,"minLevel",0),se(this,"nextMinLevel",0),se(this,"nextMinLevelWindowLength",0),se(this,"energyScore",0),this.id=t||"".concat(xK++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+yb;let i=!1;for(let s=0;s<t.length;++s){let o=n[s];o<r&&(o=0);const c=Math.floor(o/yb);t[s]!==c&&(t[s]=c,i=!0)}return i}computeLongs(){return qM(this.mediums,this.longs,4)}computeMediums(){return qM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Tb(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=Tb(this.longs[0],10,47),this.longSpeechActivityScore>Eh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Tb(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Ru(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>jy&&(r=jy),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+yb?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>jy&&(n=jy),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class MK{constructor(t){se(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Cb{constructor(t,n,r){se(this,"isDominant",void 0),se(this,"energyRanking",void 0),se(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class UK extends bn{constructor(t){super(),se(this,"dominantId",null),se(this,"lastDecisionTime",0),se(this,"lastLevelChangedTime",0),se(this,"lastLevelIdleTime",0),se(this,"relativeSpeechActivities",[]),se(this,"speakers",new Map),se(this,"enableSilence",!1),se(this,"timeoutToSilenceInterval",0),se(this,"decisionMaker",null),se(this,"loudest",[]),se(this,"numLoudestToTrack",3),se(this,"energyExpireTimeMs",250),se(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=i.levelChanged(n,r);return this.updateLoudestList(i,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new XM(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const i=t.id===this.dominantId;if(n<0){let l=0;for(;l<this.loudest.length&&this.loudest[l]!==t;)++l;return new Cb(i,l,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new Cb(i,0,t.energyScore);const s=r-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const l=this.loudest[o];if(l.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(l.id!==t.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<t.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Cb(i,c,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new MK(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const i=this.speakers.size;let s=null;if(i===0)s=null;else if(i===1){var o;const c=rs(o=this.speakers).call(o).next().value;this.enableSilence&&c&&(s=c.id,c.evaluateSpeechActivityScores(t),t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){const m=this.speakers.entries().next();m.value&&(s=m.value[0],c=m.value[1])}else s=c.id;c?.evaluateSpeechActivityScores(t);const l=this.relativeSpeechActivities;let p=2;for(const m of this.speakers.entries()){const[E,v]=m;if(v===c)continue;v.evaluateSpeechActivityScores(t);for(let N=0;N<l.length;++N){const j=c==null?Eh:c.getSpeechActivityScore(N);l[N]=Math.log(v.getSpeechActivityScore(N)/j)}const y=l[0],D=l[1],A=l[2];y>3&&D>2&&A>0&&D>p&&(p=D,s=E)}this.enableSilence&&c!=null&&s===c.id&&t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const n=[];for(const i of rs(r=this.speakers).call(r)){var r;const s=t-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<s&&i.levelTimedOut()}n.forEach(i=>this.speakers.delete(i))}}const kf=new Map;let Sa=null,By=null;const JM=3;let vh=[];const ya=new Map,Wy=new Map;class VK{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){se(this,"id",void 0),se(this,"track",void 0),se(this,"score",0),se(this,"active",!0),se(this,"muted",!1),se(this,"timer",0),se(this,"actives",0),se(this,"inactives",0),this.id=t,this.track=n,this.setActive(ya.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=function(){const i=[],s=[];return Array.from(rs(ya).call(ya)).forEach(o=>{o.active?i.push(o):s.push(o)}),{actives:i,inactives:s}}();if(n.length>3){let i;n.forEach(s=>{(!i||i.score>s.score)&&(i=s)}),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach(s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let r;return Array.from(rs(ya).call(ya)).forEach(i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let r;return Array.from(rs(ya).call(ya)).forEach(i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Gy;function QM(e){const t=ya.get(e);t&&(ya.delete(e),t.clearTimer())}const Hy=new Map,jK=new Map,Rb="video/h264",wb="video/h265";function ZM(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function $M(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function eU(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?wb:(31&r)<=31?Rb:""}const Ky=new Map,Mg=new Map;(function(){const e=xt();wr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),wr.getStreamFromExtension=e.name===Wt.CHROME&&Number(e.version)>34,wr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),wr.supportMinBitrate=e.name===Wt.CHROME||e.name===Wt.EDGE,wr.supportSetRtpSenderParameters=function(){const t=xt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!dl()||!(!Nr()&&!Sy())||t.name===Wt.FIREFOX&&Number(t.version)>=64)}(),e.name===Wt.SAFARI&&(Number(e.version)>=14?wr.supportDualStream=!0:wr.supportDualStream=!1),wr.webAudioMediaStreamDest=function(){const t=xt();return!(t.name===Wt.SAFARI&&Number(t.version)<12)}(),wr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",wr.supportWebGL=typeof WebGLRenderingContext<"u",wr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,dl()||(wr.webAudioWithAEC=!0),wr.supportShareAudio=function(){const t=xt();return(t.os===dr.WIN_10||t.os===dr.WIN_81||t.os===dr.WIN_7||t.os===dr.LINUX||t.os===dr.MAC_OS||t.os===dr.CHROMIUM_OS)&&t.name===Wt.CHROME&&Number(t.version)>=74}(),wr.supportDataChannel=!!(mf(76)||Nw(68)||$k(14)),wr.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Nn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),wr.supportWebRTCEncodedTransform=mf(87)||Jk()||Nw(117),wr.supportWebRTCInsertableStream=function(){const t=xt();return(t.name===Wt.CHROME||t.name===Wt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),wr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,wr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Cy(()=>{wr.supportDualStreamEncoding=function(){const t=xt();return!!W("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&W("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",e),R.info("browser compatibility: ",wr)})})();const FK=["CHINA","GLOBAL"],tU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Sh=[],Lf=[];function yh(e,t){return!!t&&Sh.some(n=>n.uid===e&&n.channelName===t)}function bb(){return Lf.length>0}var BK=mD.forEach,nU=Eu("forEach")?[].forEach:function(e){return BK(this,e,arguments.length>1?arguments[1]:void 0)};qt({target:"Array",proto:!0,forced:[].forEach!==nU},{forEach:nU});var WK=Qi("Array","forEach"),GK=Xo,HK=fr,KK=Y,zK=WK,Ib=Array.prototype,YK={DOMTokenList:!0,NodeList:!0},qK=function(e){var t=e.forEach;return e===Ib||KK(Ib,e)&&t===Ib.forEach||HK(YK,GK(e))?zK:t},XK=S(qK),JK=go,rU=wi;qt({target:"Object",stat:!0,forced:C(function(){rU(1)})},{keys:function(e){return rU(JK(e))}});var QK=S(Qr.Object.keys),ZK=S(zn),$K=S(Cu),ez=qt,iU=Jo,tz=Or,nz=pr,sU=km,rz=qa,iz=ps,sz=uR,oz=An,az=yr,cz=sD("slice"),lz=oz("species"),Ab=Array,dz=Math.max;ez({target:"Array",proto:!0,forced:!cz},{slice:function(e,t){var n,r,i,s=iz(this),o=rz(s),c=sU(e,o),l=sU(t===void 0?o:t,o);if(iU(s)&&(n=s.constructor,(tz(n)&&(n===Ab||iU(n.prototype))||nz(n)&&(n=n[lz])===null)&&(n=void 0),n===Ab||n===void 0))return az(s,c,l);for(r=new(n===void 0?Ab:n)(dz(l-c,0)),i=0;c<l;c++,i++)c in s&&sz(r,i,s[c]);return r.length=i,r}});var uz=Qi("Array","slice"),hz=Y,pz=uz,Ob=Array.prototype,fz=function(e){var t=e.slice;return e===Ob||hz(Ob,e)&&t===Ob.slice?pz:t},mz=S(fz);function Ye(e,t,n,r,i){var s,o,c,l={};return XK(s=QK(r)).call(s,function(p){l[p]=r[p]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=ZK(o=$K(c=mz(n).call(n)).call(c)).call(o,function(p,m){return m(e,t,p)||p},l),i&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(i):void 0,l.initializer=void 0),l.initializer===void 0?(tD(e,t,l),null):l}let zy=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Nb=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Vo=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),gi=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),rt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),hn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ht=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),lt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Ug=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Pt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Ei=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),vt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Yy(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw R.error("Invalid Channel Name ".concat(e)),new ae(F.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function qy(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||aL(e,1,255)))throw new ae(F.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let hl=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const _z={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Pb={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Db(e,t){Cr(e.url,"".concat(t,".url"),1,1e3,!1),Pn(e.x)||nn(e.x,"".concat(t,".x"),0,1e4),Pn(e.y)||nn(e.y,"".concat(t,".y"),0,1e4),Pn(e.width)||nn(e.width,"".concat(t,".width"),0,1e4),Pn(e.height)||nn(e.height,"".concat(t,".height"),0,1e4),Pn(e.zOrder)||nn(e.zOrder,"".concat(t,".zOrder"),0,255),Pn(e.alpha)||nn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const gz={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Cd=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),kb=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),er=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function oU(e){if(!e.channelName)throw new ae(F.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ae(F.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Cr(e.token,"info.token",1,2047),qy(e.uid),Yy(e.channelName),!0}let vi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),pl=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ki=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),xf=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Qt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),_r=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),Xy=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ur=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),zt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const aU=[zt.AFRICA,zt.ASIA,zt.CHINA,zt.EUROPE,zt.GLOBAL,zt.INDIA,zt.JAPAN,zt.NORTH_AMERICA,zt.OCEANIA,zt.OVERSEA,zt.SOUTH_AMERICA];let Br=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const Jy={CHINA:{},ASIA:{CODE:Br.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Br.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Br.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Br.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Br.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Br.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Br.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Br.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Br.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Br.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Br.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Br.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Br.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Jw&&(Jy.CHINA={CODE:Br.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Vg=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function cU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class lU extends bn{constructor(t,n){super(),x(this,"onICEConnectionStateChange",void 0),x(this,"onConnectionStateChange",void 0),x(this,"onDTLSTransportStateChange",void 0),x(this,"onDTLSTransportError",void 0),x(this,"onICETransportStateChange",void 0),x(this,"onFirstAudioReceived",void 0),x(this,"onFirstVideoReceived",void 0),x(this,"onFirstAudioDecoded",void 0),x(this,"onFirstVideoDecoded",void 0),x(this,"onFirstVideoRender",void 0),x(this,"onFirstVideoDecodedTimeout",void 0),x(this,"onSelectedLocalCandidateChanged",void 0),x(this,"onSelectedRemoteCandidateChanged",void 0),x(this,"onICECandidateError",void 0),x(this,"getLocalVideoStats",void 0)}}class dU extends lU{constructor(t,n){super(t,n),x(this,"establishPromise",void 0)}}let Be=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Wr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),fl=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const uU=["disconnected","failed"];let Te=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Jt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),et=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),jo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Fo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),gr=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),hU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Cc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),to=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ta=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Mf=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Vn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Uf=function(e){return e.ABORT="abort",e}({}),Rd=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Ez=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const vz={[zy.ACCESS_POINT]:{[gi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[gi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[gi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[gi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[gi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[gi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[zy.UNILBS]:{[Vo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Vo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Vo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Vo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Vo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Vo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Vo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Vo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Vo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Vo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Vo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Vo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[zy.STRING_UID_ALLOCATOR]:{[Nb.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Nb.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Nb.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Vf(e){const t=vz[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===zy.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Sz={[rt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[rt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[rt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[rt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[rt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[rt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[rt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[rt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[rt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[rt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[rt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[rt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[rt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[rt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[rt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[rt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[rt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[rt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[rt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[rt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[rt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[rt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[rt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[rt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[rt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[rt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[rt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[rt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[rt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[rt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[rt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[rt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[rt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[rt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[rt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[rt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[rt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[rt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[rt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[rt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[rt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[rt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[rt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[rt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[rt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[rt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[rt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[rt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[rt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[rt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[rt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[rt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[rt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[rt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[rt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[rt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[rt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[rt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[rt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[rt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[rt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[rt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[rt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function jg(e){return Sz[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function pU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Lb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function xb(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const s=W("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const yz=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Tz=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Cz=/wss:\/\/(.+):([0-9]+)\/?/,Rz=/wss:\/\/(.[^\/]+)\/?/;let wz=0;class bz{constructor(t,n){x(this,"id",0),x(this,"store",void 0),x(this,"recordIndex",void 0),x(this,"websockets",[]),x(this,"try443PortDuration",2e3),x(this,"forceCloseWSDuration",5e3),x(this,"try443PortTimeout",null),x(this,"forceCloseTimeout",null),x(this,"isTry443PortFailed",!1),x(this,"isNormalPortFailed",!1),x(this,"useDoubleDomain",!1),x(this,"useProxy",!1),x(this,"startTime",Date.now()),this.id=++wz,this.try443PortDuration=W("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];R.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=W("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=i.find(v=>{var y;return Ae(y=t.host).call(y,v)});c||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)i.forEach(v=>{l.push(xb(Lb(Lb({},t),{},{host:t.host.replace(c,v)}),n))});else{const v=Lb({},t);if(n&&c){const y=i.find(D=>D!==c);y&&(v.host=v.host.replace(c,y))}l.push(xb(v,n))}try{l.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",o.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),o.forEach(y=>y.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new ae(F.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const p=Cg();this.store&&this.store.recordJoinChannelService({urls:o.map(v=>v.url),service:"gateway"},this.recordIndex),o.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,p.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(v.readyState));const D=o.every(A=>A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(D)),D&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),p.reject({code:y.code,reason:Xy.A_ROUND_WS_FAILED})):!n&&D&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=D:this.isNormalPortFailed=D},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...o);const m=()=>{this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())},E=()=>{if(p.isResolved)return m();xt().os===dr.MAC_OS&&Nn()&&m(),this.createWebSocket(t,!0,!0).then(v=>{p.resolve(v)}).catch(v=>{this.isNormalPortFailed&&p.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",p.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(s){let o,c,l;return[,o,c,l]=s.match(yz)||[],o||([,c,l]=s.match(Tz)||[]),c&&l||([,c,l]=s.match(Cz)||[]),c&&l||([,c]=s.match(Rz)||[]),c||R.warning("un-destructible url: ",s),{proxy:o,host:c,port:l||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function fU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class mU extends bn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Ae(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(vt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(vt.CONNECTED):this._state==="closed"?this.emit(vt.CLOSED):this._state==="failed"&&this.emit(vt.FAILED))}resetReconnectCount(t){R.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),x(this,"_websocketUrl",null),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"urls",[]),x(this,"_reconnectMode","tryNext"),x(this,"reconnectReason",void 0),x(this,"_initMutex",void 0),x(this,"name",void 0),x(this,"_state","closed"),x(this,"reconnectInterrupter",void 0),x(this,"websocket",void 0),x(this,"retryConfig",void 0),x(this,"reconnectCount",0),x(this,"forceCloseTimeout",5e3),x(this,"onlineReconnectListener",void 0),x(this,"useCompress",void 0),x(this,"tryDoubleDomain",!1),x(this,"use443PortOnly",!1),x(this,"wsInflateLength",0),x(this,"wsDeflateLength",0),x(this,"closeEstablishingWs",()=>{}),x(this,"store",void 0),x(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=function(E){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?fU(Object(y),!0).forEach(function(D){x(E,D,y[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(y)):fU(Object(y)).forEach(function(D){Object.defineProperty(E,D,Object.getOwnPropertyDescriptor(y,D))})}return E}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new jr("websocket",o?o.clientId:void 0);const{timeout:c,timeoutFactor:l}=n,p=Math.max(300,Math.floor(3*c/5)),m=Math.max(1.2,Math.floor(8*l)/10);os.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m),Gn.on(gf.NETWORK_STATE_CHANGE,(E,v)=>{E!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(E)),E===os.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var i;const s=Cg(),o=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(c){return!(Ny()||W("USE_NEW_TOKEN")||!W("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(hU.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(vt.CLOSED,()=>{s.reject(new pe(F.WS_DISCONNECT))}),this.once(vt.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new pe(F.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new pe(F.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=Cg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=m=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async m=>{var E;if(R.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new pe(F.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const v=Ts(this,vt.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=await this.reconnectWithAction(v);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return r.reject(new pe(F.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);r.resolve()}},o=m=>{this.emit(vt.ON_MESSAGE,m)},c=m=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),W("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=W("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),t);const l=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;this._websocketUrl=xb(t);const m=await this.chooseBestWebsocketConnection(t);this.websocket=m,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(m){const E=this.state==="closed",v=m instanceof pe,y=v&&m.code===F.WS_ABORT,D=v&&m.code===F.WS_ERR,A=v?m.message:m&&(m.reason||m.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},l),E||D?(r.reject(E?new pe(F.WS_DISCONNECT,"websocket is closed: ".concat(A)):new pe(F.WS_ERR,"init websocket failed: ".concat(A))),D&&R.error("[".concat(this.name,"] init websocket failed: ").concat(A))):s&&s(m)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Gn.isOnline||!Gn.onlineWaiter||(this.onlineReconnectListener=Gn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const o=Ww(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await je.race([Rr(o),this.onlineReconnectListener||new je(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(o,c)=>{this.emit(vt.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Dr(this,vt.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(o){var s;R.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&Ae(c).call(c,"dynamic key expired")?(this.emit(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class Mb extends mU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=Cg(),i=function(o,c){return new bz(o,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new pe(F.WS_ABORT,"choose best websocket aborted"))};const s=W("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Fg extends mU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new je((r,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),o.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),i(new pe(F.WS_ABORT,"choose best websocket aborted"))};const c=W("GATEWAY_DOMAINS");let l;const p=t.indexOf("?h="),m=c.find(D=>p!==-1?Ae(t).call(t,D,p):Ae(t).call(t,D));R.debug("[choose-best-ws] currentDomain: ",m,", domains: ",c);let E=!this.tryDoubleDomain||!m;if(!E&&m){var v;const D=Date.now();try{c.forEach(A=>{const N=p===-1?t.replace(m,A):t.substr(0,p)+t.substr(p).replace(m,A),j=new WebSocket(N);j.binaryType="arraybuffer",o.push(j),R.debug("[choose-best-ws] ws is connecting:",j.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(N=>N.close());o.length;)o.pop();E=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:o.map(A=>A.url),service:"gateway"},n),o.forEach(A=>{A.onopen=()=>{if(s)return;const N=Date.now()-D;R.debug("[choose-best-ws] ws open cost ".concat(N,"ms")),o.filter(j=>j!==A).forEach(j=>{R.debug("[choose-best-ws]close backup websocket: ".concat(j.url)),j.close()}),s=!0,r(A)},A.onclose=N=>{l=N,!s&&(o.find(j=>!(j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),s=!0,i(l)))},A.onmessage=N=>{R.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(N.data))}}),Rr(this.forceCloseTimeout).then(()=>{o.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(E){var y;let D;R.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},n);try{D=new WebSocket(t),o.push(D),D.binaryType="arraybuffer"}catch(A){const N=new pe(F.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return R.error("[".concat(this.name,"]").concat(N)),void i(N)}D.onopen=()=>{r(D)},D.onclose=A=>{i(A)},D.onmessage=A=>{R.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(A.data))},Rr(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class Iz extends bn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===hn.CONNECTED?this.emit(ht.WS_CONNECTED):t===hn.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===hn.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",hn.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new CL(5)),x(this,"pingpongTimer",void 0),x(this,"wsInflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"ortc",void 0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Xt.UID_BANNED);break;case 15:this.close(Xt.IP_BANNED);break;case 16:this.close(Xt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case rt.ERR_LICENSE_MISSING:this.close(Xt.LICENSE_MISSING);break;case rt.ERR_LICENSE_EXPIRED:this.close(Xt.LICENSE_EXPIRED);break;case rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xt.LICENSE_MINUTES_EXCEEDED);break;case rt.ERR_LICENSE_PERIOD_INVALID:this.close(Xt.LICENSE_PERIOD_INVALID);break;case rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xt.LICENSE_MULTIPLE_SDK_SERVICE);break;case rt.ERR_LICENSE_ILLEGAL:this.close(Xt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Mb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hn.CONNECTED&&this.reconnect("retry",Pr.OFFLINE)})}async request(t,n,r,i){const s=on(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new je((D,A)=>{if(this.connectionState===hn.CONNECTED)return D();const N=()=>{this.off(ht.WS_CLOSED,j),D()},j=()=>{this.off(ht.WS_CONNECTED,N),A(new ae(F.WS_ABORT))};this.once(ht.WS_CONNECTED,N),this.once(ht.WS_CLOSED,j),t!==lt.PUBLISH&&t!==lt.PUBLISH_DATASTREAM&&t!==lt.SUBSCRIBE&&t!==lt.SUBSCRIBE_DATASTREAM&&t!==lt.UNSUBSCRIBE&&t!==lt.UNSUBSCRIBE_DATASTREAM&&t!==lt.UNPUBLISH&&t!==lt.UNPUBLISH_DATASTREAM&&t!==lt.CONTROL&&t!==lt.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{A(new ae(F.DISCONNECT_P2P))}),t!==lt.PUBLISH&&t!==lt.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{A(new ae(F.DISCONNECT_P2P))})});if(this.connectionState!==hn.CONNECTING&&this.connectionState!==hn.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const p=new je((D,A)=>{let N=!1;const j=(G,$)=>{N=!0,D({isSuccess:G==="success",message:$||{}}),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.emit(ht.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),j);const V=()=>{A(new ae(F.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.off("res-@".concat(s),j)};this.once(ht.WS_CLOSED,V),this.once(ht.WS_RECONNECTING,V),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||N||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===hn.CLOSED||t===lt.LEAVE)throw new ae(F.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?D.throw():t===lt.JOIN||t===lt.REJOIN?null:(await l(),await this.request(t,n))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=jg(E),y=new ae(F.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:v.desc});return v.action==="success"?m.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===rt.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pr.MULTI_IP)):this.reconnect(v.action,Pr.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new je(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ug.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new je((n,r)=>{this.once(ht.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ht.WS_CLOSED,i=>r(this.initError||new ae(F.WS_ABORT,i))),this.connectionState=hn.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Xt.LEAVE,this.connectionState=hn.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Dr(this,ht.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(lt.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(ht.REPORT_JOIN_GATEWAY,Xy.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ae(F.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ag(this,ht.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(lt.REJOIN,t);return!!n&&(this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Pt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Pt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Pt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Pt.MUTE_AUDIO,{uid:r.uid}):this.emit(Pt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Pt.MUTE_VIDEO,{uid:r.uid}):this.emit(Pt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Pt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Pt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Pt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(lt.DOWNGRADE_CODEC,n)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=jg(t.code);if(t.code===28&&"detail"in t&&(R.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ht.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xt.UID_BANNED),void this.close()):void this.reconnect(n.action,Pr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pr.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),W("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Ug.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(vt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(vt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(vt.CLOSED,()=>{this.connectionState=hn.CLOSED}),this.websocket.on(vt.FAILED,()=>{this._disconnectedReason=Xt.NETWORK_ERROR,this.connectionState=hn.CLOSED}),this.websocket.on(vt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===hn.CONNECTED?this.connectionState=hn.RECONNECTING:this.connectionState=hn.CONNECTING}),this.websocket.on(vt.WILL_RECONNECT,(t,n,r)=>{const i=Ag(this,ht.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=Xy.P2P_DISCONNECTED),s&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ht.REPORT_JOIN_GATEWAY,n||Xy.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ht.DISCONNECT_P2P)),r(t)}),this.websocket.on(vt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Pr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ae){if(t.code===F.UNEXPECTED_RESPONSE&&t.data.code===rt.ERR_NO_AUTHORIZED)return this.initError=new ae(F.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Xt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(vt.REQUEST_NEW_URLS,(t,n)=>{Dr(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hU.PRE_CONNECT_PC,()=>{this.emit(ht.PRE_CONNECT_PC)})}}let Az=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Hn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function _U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Qy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_U(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_U(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function wd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(W("TURN_DOMAIN")):(R.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function Zy(e){try{const t=W("GATEWAY_DOMAINS").concat(W("TURN_DOMAIN")).find(n=>Ae(e).call(e,n));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return R.debug("serverUrlToIp error, fallback to url",e),e}}function Ub(e,t){e.addresses||(e.addresses=[]);const n=function(c,l){if(W("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map(E=>{let{ip:v,port:y}=E;return{address:"".concat(v,":").concat(y)}});const p=W("GATEWAY_DOMAINS");let m=p[1]&&Ae(l).call(l,p[1])?1:0;return c.map(E=>{let{domain_prefix:v,port:y,ip:D}=E;if(v)return{address:"".concat(v,".").concat(p[m++%p.length],":").concat(y)};const A=/^[\.\:\d]+$/.test(D),N=A?"".concat(D.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(y):"".concat(D,":").concat(y);return A||R.debug("Cannot recognized as ip address: ".concat(D,", use as host3")),{ip:D,port:y,address:N}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const c=r.split(";");for(let l=0;l<c.length;l++){var i;const p=ri(i=c[l]).call(i);n[l]&&p&&(n[l].ip6=p)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[c,l]=s.split(":");c&&l&&(o={port:Number(l),ip:c,address:"".concat(c,":").concat(l)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function as(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function gU(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(as(t.width),"x").concat(as(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function EU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Bg(e,t){let n,r,i;switch(t){case Hn.CHOOSE_SERVER:r=4096,i="choose server";break;case Hn.CLOUD_PROXY:r=1048576,i="proxy";break;case Hn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Hn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new ae(F.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>Qy(Qy({},o),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:Qy(Qy({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!n)throw new ae(F.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function vU(e,t){return await je.all(e.addresses.map(async n=>({address:wd(n.ip),tcpport:n.port,udpport:n.port,username:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():kr.username,password:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Vw(t.toString()):kr.password})))}function Vb(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(as(e.height),as(e.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function bd(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:o}=e;const c={candidateType:t,relayProtocol:n,protocol:o};if(r!=="local-candidate"){const l=i.split(".");l.length>=4&&(l[1]="*",l[2]="*"),c.address=l.join("."),c.port=s}return c}function Th(e){const t=e.split(":"),n=e.split(/[-.]/),r=Ae(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function $y(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W("SVC_MODE");if(W("ENABLE_SVC"))return function(t){return t in Iy}(e)?e:Iy.L1T3}const SU={[Be.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Be.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function eT(e,t,n){t.forEach(r=>{var i;const s=SU[e].find(c=>{var l;let{key:p}=c;return Ae(l=r.extensionName).call(l,p)});if(!s)return;const o=n.find(c=>{let{extensionName:l}=c;return Ae(l).call(l,s.key)});o&&Ae(i=o.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=o.extensionName)})}function jf(e,t){t.forEach(n=>{var r;const i=SU[e].find(s=>{var o;let{key:c}=s;return Ae(o=n.extensionName).call(o,c)});Ae(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)})}function yU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ae(e).call(e,"abs-send-time")}function tT(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ae(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function TU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function CU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?TU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Wg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:l,unsupportedVideoUplinkCodec:p,unsupportedVideoDownlinkCodec:m}=t,{useXR:E}=n;let v=[],y=[],D=[],A=[],N=!1,j=!1;if(Gi(e).mediaDescriptions.forEach(G=>{r&&r!==G.attributes.direction||(G.media.mediaType!=="video"||N||(y=G.attributes.payloads,A=G.attributes.extmaps,N=!0),G.media.mediaType!=="audio"||j||(v=G.attributes.payloads,D=G.attributes.extmaps,j=!0))}),!A||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!D||v.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(G=>{var $;($=G.rtpMap)!==null&&$!==void 0&&$.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),E&&G.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(G=>{var $;($=G.rtpMap)!==null&&$!==void 0&&$.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),E&&G.rtcpFeedbacks.push({type:"rrtr"})}),i&&(v=v.filter(G=>{var $;return(($=G.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"}),y=y.filter(G=>{var $;return(($=G.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"})),s){const G=y.filter(z=>{var re;return/(red)|(ulpfec)|(flexfec)/i.test(((re=z.rtpMap)===null||re===void 0?void 0:re.encodingName)||"")}),$=Ad(G,y).map(z=>z.payloadType),Q=[...G.map(z=>z.payloadType),...$];y=y.filter(z=>!Ae(Q).call(Q,z.payloadType))}if(o&&(v=v.filter(G=>{var $;return!/(red)|(ulpfec)|(flexfec)/i.test((($=G.rtpMap)===null||$===void 0?void 0:$.encodingName)||"")})),c&&c?.length>0&&(v=v.filter(G=>{var $;return Ae(c).call(c,(($=G.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())||"")})),l&&l?.length>0){const G=y.filter($=>{var Q;return Ae(l).call(l,((Q=$.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())||"")});y=G.concat(i?[]:Ad(G,y))}const V=W("UNSUPPORTED_VIDEO_CODEC");if(V&&V.length>0){const G=y.filter(z=>z.rtpMap&&Ae(V).call(V,z.rtpMap.encodingName.toLowerCase())),$=Ad(G,y),Q=G.concat($).map(z=>z.payloadType);y=y.filter(z=>!Ae(Q).call(Q,z.payloadType)),R.debug("unsupportedVideoCodec: ".concat(V,", toBeRemoved: ").concat(Q))}if(p&&p.length>0&&r==="sendonly"){const G=y.filter(z=>z.rtpMap&&Ae(p).call(p,z.rtpMap.encodingName.toLowerCase())),$=Ad(G,y),Q=G.concat($).map(z=>z.payloadType);y=y.filter(z=>!Ae(Q).call(Q,z.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(p,", toBeRemoved: ").concat(Q))}if(m&&m.length>0&&r==="recvonly"){const G=y.filter(z=>z.rtpMap&&Ae(m).call(m,z.rtpMap.encodingName.toLowerCase())),$=Ad(G,y),Q=G.concat($).map(z=>z.payloadType);y=y.filter(z=>!Ae(Q).call(Q,z.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(m,", toBeRemoved: ").concat(Q))}return{audioCodecs:v,videoCodecs:y,audioExtensions:D,videoExtensions:A}}function Id(e){const t=Gi(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function RU(e,t){const n=[],r=e.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),i=e.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(o=>{var c;const l=(c=r.find(p=>p.ssrcIds[0]===o))===null||c===void 0?void 0:c.ssrcIds[1];n.push({ssrcId:o,rtx:t?l:void 0})});else if(r.length>0){const o=r[0].ssrcIds[0],c=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function wU(e,t,n){const{cname:r}=e;let i=[];t&&(i=bU(t)),i.length===0&&(i=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),R.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const l=rT(e.rtpCapabilities),p=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{p.push({kind:Be.VIDEO,ssrcMsg:[{ssrcId:m.v,rtx:m.v_rtx}],mslabel:"".concat(m.v,"_").concat(m.a)},{kind:Be.AUDIO,ssrcMsg:[{ssrcId:m.a}],mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:l,setup:c,cname:r,preSSRCs:p}}function bU(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(Th(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(Th(e.ip6),":").concat(e.port)))),t}function Gg(e,t,n){const r=[],i=[];return e.forEach(s=>{let{ssrcId:o,rtx:c}=s;const l=on(8,"track-"),p={ssrcId:o,attributes:CU({label:l,mslabel:n=n||on(10,""),msid:"".concat(n," ").concat(l)},t&&{cname:t})};if(r.push(p),c!==void 0){const m={ssrcId:c,attributes:CU({label:l,mslabel:n,msid:"".concat(n," ").concat(l)},t&&{cname:t})};r.push(m),i.push({semantic:"FID",ssrcIds:[o,c]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:r,ssrcGroups:i}}function Ff(e,t){t instanceof Ln&&e.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof W("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=W("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Nn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof xg&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function jb(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function Fb(e,t){var n;if(!(t instanceof mn&&t._encoderConfig&&t._hints.indexOf(rn.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ft().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var s,o;Ae(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ft().supportMinBitrate&&!Ae(n=t._hints).call(n,rn.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var s,o;Ae(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(W("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function IU(e){if(e.media.mediaType!=="video")return;const t=xt();if(t.name!==Wt.SAFARI&&t.os!==dr.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function nT(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const s=r.find(o=>tT(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(l=>tT(l.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(l,p){return p.filter(m=>!!l.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(p=>p.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex(o=>tT(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}if(t.remb===!0){const s=r.find(o=>yU(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(l=>l.extensionName===o)||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(l,p){return p.filter(m=>!!l.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(p=>p.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex(o=>yU(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="goog-remb");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}}function AU(e,t,n){if(Nn()||e.media.mediaType!=="video"||!(t instanceof mn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!W("SIMULCAST")||n==="vp9"&&W("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===i.ssrcId),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let c=1;c<r;c++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+c,attributes:Cn(i.attributes)}),o.ssrcIds.push(i.ssrcId+c),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:Cn(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+c,s.ssrcIds[1]+c]}));e.attributes.ssrcGroups.unshift(o)}async function OU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const m=Wg(p,c,l,"sendonly"),E=Wg(p,c,l,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(m,E,"videoExtensions",v,y,D),Bo(m,E,"videoCodecs",v,y,D),Bo(m,E,"audioExtensions",v,y,D),Bo(m,E,"audioCodecs",v,y,D),W("RAISE_H264_BASELINE_PRIORITY")){const A=[],N=[];if(D.videoCodecs.forEach((j,V)=>{var G;if(((G=j.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){var $,Q;const z=D.videoCodecs[V+1],re=z&&LU(j,z),fe=($=j.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"],ve=(Q=j.fmtp)===null||Q===void 0?void 0:Q.parameters["packetization-mode"];!fe||fe!==W("FIRST_H264_PROFILE_LEVEL_ID")||W("FIRST_PACKETIZATION_MODE")&&ve!==W("FIRST_PACKETIZATION_MODE")?re?N.push([j,z]):N.push([j]):re?A.push([j,z]):A.push([j])}}),A.length>0&&N.length>0){R.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((V,G)=>{var $;if((($=V.rtpMap)===null||$===void 0?void 0:$.encodingName.toLocaleLowerCase())==="h264"){const Q=LU(V,D.videoCodecs[G+1]),z=A.shift()||N.shift()||[];z.length>0&&(Q?D.videoCodecs.splice(G,2,...z):D.videoCodecs.splice(G,1,...z))}});const j=y.videoCodecs.filter(V=>{var G,$;return((G=V.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&(($=V.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID")});if(j.length>0){const V=Ad(j,y.videoCodecs).map($=>$.payloadType),G=[...j.map($=>$.payloadType),...V];y.videoCodecs=y.videoCodecs.filter($=>!Ae(G).call(G,$.payloadType))}W("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(V=>{var G,$;return!(((G=V.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&(($=V.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:v,recv:y,sendrecv:D}}return{send:v,recv:y,sendrecv:D}}(e,t,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:o}}function NU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Wg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(e,t,"videoExtensions",n,r,i),Bo(e,t,"videoCodecs",n,r,i),Bo(e,t,"audioExtensions",n,r,i),Bo(e,t,"audioCodecs",n,r,i),W("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const o=i.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){R.debug("raising H264 baseline profile priority");const c=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,c)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter(c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function Bo(e,t,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return e[n].forEach(c=>{t[n].some((l,p)=>{if(c.entry===l.entry&&c.extensionName===l.extensionName)return o.push(p),!0})?s[n].push(c):r[n].push(c)}),void t[n].forEach((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)})}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return e[n].forEach(c=>{t[n].some((l,p)=>{if(c.payloadType===l.payloadType&&JSON.stringify(c)===JSON.stringify(l))return o.push(p),!0})?s[n].push(c):r[n].push(c)}),void t[n].forEach((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)})}}function rT(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function Bf(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Hg(e,t,n,r){let i=[];if(e===Be.VIDEO){if(W("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(s=>{var o;return Ae(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===W("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const o=[],c=[],l=[];if(n.videoCodecs.forEach(p=>{const m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";Ae(m).call(m,r)?s.push(p):Ae(m).call(m,"vp9")?o.push(p):Ae(m).call(m,"vp8")?c.push(p):Ae(m).call(m,"h264")&&l.push(p)}),s.length===0){let p="";o.length!==0?(s=o,p="vp9"):c.length!==0?(s=c,p="vp8"):l.length!==0&&(s=l,p="h264"),R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}s.length!==0&&(i=t.videoCodecs.filter(p=>s.some(m=>m.payloadType===p.payloadType)))}if(i.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),W("USE_PUB_RTX")||W("USE_SUB_RTX")){const s=Ad(i,t.videoCodecs);i=[...i,...s]}}else{i=t.audioCodecs.filter(o=>{var c;return Ae(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,r)});const s=t.audioCodecs.filter(o=>{var c;return Ae(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"red")});i.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(o=>{var c;return Ae(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")})),W("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function Ad(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Ae(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function Od(e,t,n){const r=t.toString(),i=DU(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=PU(o,n||{}),i?.(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function PU(e,t,n){const r=Gi(e),{useXR:i}=t;return r.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!Ae(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Bf(s),i&&Ae(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(c=>{c.rtcpFeedbacks.findIndex(l=>l.type==="rrtr")===-1&&c.rtcpFeedbacks.push({type:"rrtr"})})))}),yd(r)}function DU(e,t,n,r){if(W("SDP_LOGGING"))return R.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{DU(i,"answer",n==="local"?"remote":"local",r)}:void 0}function kU(e){const t=W("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Ae(e).call(e,n))}function LU(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function xU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ps(e,t){return typeof W(e)===t?W(e):void 0}function Oz(){try{const e=W("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?xU(Object(r),!0).forEach(function(i){x(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xU(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e)}catch(e){return R.debug("handle gateway attributes failed: ",e),{}}}const MU={};function Nd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(e.name)),MU[e.name]=e}function ml(e){const t=MU[e];if(!t)throw new pe(F.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function UU(e,t){return ml("DataStream").create(e,t)}function iT(){return ml("InterceptFrame").create()}function VU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Xr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Bb=new Map;class Nz extends bn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(_r.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(_r.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,s;super(),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"key",void 0),x(this,"ntpOffset",0),x(this,"signal",void 0),x(this,"role",void 0),x(this,"isPreallocation",void 0),x(this,"isPreSub",void 0),x(this,"inChannelInfo",{joinAt:null,duration:0}),x(this,"spec",void 0),x(this,"_state","DISCONNECTED"),x(this,"_statsCollector",void 0),x(this,"_disconnectedReason",void 0),x(this,"isSignalRecover",!1),x(this,"hasChangeBGPAddress",!1),x(this,"trafficStatsInterval",void 0),x(this,"networkQualityInterval",void 0),x(this,"_joinGatewayStartTime",0),x(this,"_signalTimeout",!1),x(this,"_clientRoleOptions",void 0),x(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:Xr(Xr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(s=ml("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,r)):new Iz(Xr(Xr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=Bb.get(t.cname);if(s||(s=new Map,Bb.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const p=new ae(F.UID_CONFLICT);throw qe.joinGateway(t.sid,{lts:i,succ:!1,ec:p.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),p}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let o=0;this.joinGatewayStartTime=i;const c=t.proxyServer;try{R.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const p=t.gatewayAddrs.map(m=>{let{address:E}=m;const[v,y]=E.split(":"),D={host:v,port:y};return t.proxyServer&&(D.proxy=t.proxyServer),D});o=(await this.signal.init(p)).uid,R.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var l;throw R.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),qe.joinGateway(t.sid,{lts:i,succ:!1,ec:((l=p.data)===null||l===void 0?void 0:l.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),p}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:EU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:EU(this._statsCollector.trafficStats.B_dnq)}):this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Xt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==hn.CONNECTED||await function(r,i){return i===1/0?r:je.race([r,tK(i)])}(this.signal.request(lt.LEAVE,void 0,!0),3e3)}catch(r){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Xt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:W("PUB_EXTEND"),twcc:!!W("PUBLISH_TWCC"),rtx:!!W("USE_PUB_RTX")};try{return(await this.signal.request(lt.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===rt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(lt.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===rt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw o}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(lt.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await je.all(t.map(n=>this.signal.request(lt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){R.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX")||void 0,extend:W("SUB_EXTEND"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(lt.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX"),extend:W("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return(await this.signal.request(lt.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(lt.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!W("USE_SUB_RTX"),twcc:!!W("SUBSCRIBE_TWCC"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(lt.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,o=r.height,c=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(c=!1)),c?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(lt.SET_VIDEO_PROFILE,n);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await je.all(t.map(r=>this.signal.request(lt.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){R.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(lt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(lt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(lt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),W("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),W("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(lt.SET_CLIENT_ROLE,Xr(Xr({role:t,level:i,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(lt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(lt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(lt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(lt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(lt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(lt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=Bb.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:kr.username,password:kr.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Xr(Xr({},kr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(lt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Cy(()=>{this.emit(_r.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,r;if(!this.joinInfo||!this.key)throw new ae(F.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=W("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var o;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(_r.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,Ae(Lf).call(Lf,o)||Lf.push(o);const c=nb(this.store),l=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),p=BL(this.store),m=Oz(),E=mf(87)||Jk()||Nw(117),v=(function(){const D=xt();if(D.name!==Wt.SAFARI||!D.browserVersion)return!1;const A=D.browserVersion.split(".");return Number(A[0])>18||Number(A[0])===18&&Number(A[1])>=4}()||eL(18,4,!1))&&Pw(18,6,!0)&&this.spec.codec==="h264"&&W("ENABLE_ABSSENDTIME_AS_SENTTS"),y=Xr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Qs,browser:navigator.userAgent,process_id:W("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:W("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Xr(Xr({enableEncodedTransform:(!!W("ENABLE_AUDIO_METADATA")||!!W("ENABLE_AUDIO_PTS"))&&E||!!W("ENABLE_AUDIO_TOPN")&&Aw(Wt.CHROME,87,116)||void 0,enableAudioMetadata:!!W("ENABLE_AUDIO_METADATA")&&E,enableAudioPts:!!W("ENABLE_AUDIO_PTS")&&E,topnSmoothLevel:W("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:W("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:W("TOPN_SWITCH_HOLD_MS"),topnAudioGain:W("TOPN_AUDIO_GAIN"),enablePublishedUserList:W("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:W("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ps("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ps("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ps("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:W("USE_PUB_RTX")===!0||W("USE_SUB_RTX")===!0||void 0,disableFEC:W("DISABLE_FEC"),enableNTPReport:!!W("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:p,enableFulllinkAvSync:!!W("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ps("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!W("FORCE_ENABLE_AUT_CC")||!Ny()&&(!!W("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!W("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ps("USE_XR","boolean"),enableLossbasedBwe:Ps("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!W("FORCE_ENABLE_AUT_CC")||!Ny()&&(!!W("ENABLE_AUT_CC")||void 0),enableCCFallback:Ps("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:c?Ps("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ps("PUBLISH_TWCC","boolean"),enableSubTWCC:Ps("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ps("USE_PUB_RTX","boolean"),enableSubRTX:Ps("USE_SUB_RTX","boolean"),enableSubSVC:W("ENABLE_SVC")?W("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0,enableSvcExtended:W("ENABLE_SVC")&&Array.isArray(W("SVC_EXTENDED"))&&W("SVC_EXTENDED").length!==0?W("SVC_EXTENDED"):void 0},m),{},{audioDuplicate:Ps("ENABLE_AUDIO_RED","boolean")?(r=Ps("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!v||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,W("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new ae(F.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ht.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ht.WS_RECONNECTING,t=>{this.joinInfo&&qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Pr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",qe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ht.WS_CLOSED,t=>{let n;switch(t){case Xt.LEAVE:n=Pr.LEAVE;break;case Xt.UID_BANNED:case Xt.IP_BANNED:case Xt.CHANNEL_BANNED:case Xt.SERVER_ERROR:n=Pr.SERVER_ERROR;break;case Xt.FALLBACK:n=Pr.FALLBACK;break;case Xt.LICENSE_MISSING:case Xt.LICENSE_EXPIRED:case Xt.LICENSE_MINUTES_EXCEEDED:case Xt.LICENSE_PERIOD_INVALID:case Xt.LICENSE_MULTIPLE_SDK_SERVICE:case Xt.LICENSE_ILLEGAL:case Xt.TOKEN_EXPIRE:n=t;break;default:n=Pr.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Pr.NETWORK_ERROR)),this.joinInfo&&qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Xt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Xt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ht.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=W("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));$t("EVENT_REPORT_DOMAIN",t[1]),$t("EVENT_REPORT_BACKUP_DOMAIN",t[1]),$t("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Pt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ht.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new ae(F.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Dr(this,_r.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(ht.REQUEST_JOIN_INFO,async(t,n,r)=>{var i,s,o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const c=Cn((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(W("NEW_TURN_MODE")&&c&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var l;let v=c.servers.map(A=>"turnServerURL"in A&&W("USE_TURN_IP")?Xr(Xr({},A),{},{turnServerURL:Zy(A.turnServerURL)}):A),y=(l=c.serversFromGateway)===null||l===void 0?void 0:l.map(A=>W("USE_TURN_IP")?Xr(Xr({},A),{},{turnServerURL:Zy(A.turnServerURL)}):A);const D=this.signal.currentURLIndex;v.length>0&&(v=[v[D%v.length]],c.servers=v),Array.isArray(y)&&y.length>0&&(y=[y[0]],c.serversFromGateway=y),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(D))}const{iceParameters:p,dtlsParameters:m,rtpCapabilities:E}=await Dr(this,_r.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:m,rtpCapabilities:E,version:"2"}}))}catch(v){n(v)}}),this.signal.on(ht.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ht.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,i="";var s;t instanceof ae?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):r=t,qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ht.IS_P2P_DISCONNECTED,t=>{t(Ag(this,_r.IS_P2P_DISCONNECTED))}),this.signal.on(ht.DISCONNECT_P2P,()=>{this.emit(_r.DISCONNECT_P2P)}),this.signal.on(ht.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ht.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ht.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(_r.JOIN_RESPONSE,t,n)}),this.signal.on(ht.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=Cn((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(W("NEW_TURN_MODE")&&s&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var r;let c=s.servers.map(m=>"turnServerURL"in m&&W("USE_TURN_IP")?Xr(Xr({},m),{},{turnServerURL:Zy(m.turnServerURL)}):m),l=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map(m=>W("USE_TURN_IP")?Xr(Xr({},m),{},{turnServerURL:Zy(m.turnServerURL)}):m);const p=this.signal.currentURLIndex;c.length>0&&(c=[c[p%c.length]],s.servers=c),Array.isArray(l)&&l.length>0&&(l=[l[0]],s.serversFromGateway=l),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(p,",in pre pc"))}const o=W("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&o){const c=bU(i);this.emit(_r.PRE_CONNECT_PC,{candidates:c,fingerprint:o,turnServer:s})}}}),this.signal.on(ht.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof W("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(W("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(lt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw R.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(lt.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(lt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw R.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(i=>i.stream_type===Qt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find(i=>i.stream_type===Qt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===Be.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===Be.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(lt.RESTART_ICE,n,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Pr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!W("GATEWAY_WSS_ADDRESS"))return W("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(lt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let sT=0,Wb=0;function Ca(e,t,n,r){return new je((i,s)=>{t.timeout=t.timeout||W("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),sT+=Ec(t.data)):n&&(t.data.size?sT+=t.data.size:t.data instanceof FormData?sT+=_L(t.data):sT+=Ec(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ai.request(t).then(o=>{typeof o.data=="string"?Wb+=Ec(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?Wb+=o.data.byteLength:Wb+=Ec(JSON.stringify(o.data)),r&&i({data:o.data,headers:o.headers}),i(o.data)}).catch(o=>{Ai.isCancel(o)?s(new ae(F.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ae(F.NETWORK_TIMEOUT,o.message)):o.response?s(new ae(F.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ae(F.NETWORK_ERROR,o.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Ee){var Ne=0;return function(){return Ne<Ee.length?{done:!1,value:Ee[Ne++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Ee,Ne,He){return Ee==Array.prototype||Ee==Object.prototype||(Ee[Ne]=He.value),Ee},r,i=function(Ee){Ee=[typeof globalThis=="object"&&globalThis,Ee,typeof window=="object"&&window,typeof self=="object"&&self,typeof g=="object"&&g];for(var Ne=0;Ne<Ee.length;++Ne){var He=Ee[Ne];if(He&&He.Math==Math)return He}throw Error("Cannot find global object")}(this);function s(Ee,Ne){if(Ne)e:{var He=i;Ee=Ee.split(".");for(var Se=0;Se<Ee.length-1;Se++){var b=Ee[Se];if(!(b in He))break e;He=He[b]}(Ne=Ne(Se=He[Ee=Ee[Ee.length-1]]))!=Se&&Ne!=null&&n(He,Ee,{configurable:!0,writable:!0,value:Ne})}}function o(Ee){return(Ee={next:Ee})[Symbol.iterator]=function(){return this},Ee}function c(Ee){var Ne=typeof Symbol<"u"&&Symbol.iterator&&Ee[Symbol.iterator];return Ne?Ne.call(Ee):{next:t(Ee)}}if(s("Symbol",function(Ee){function Ne(b,K){this.A=b,n(this,"description",{configurable:!0,writable:!0,value:K})}if(Ee)return Ee;Ne.prototype.toString=function(){return this.A};var He="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Se=0;return function b(K){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new Ne(He+(K||"")+"_"+Se++,K)}}),s("Symbol.iterator",function(Ee){if(Ee)return Ee;Ee=Symbol("Symbol.iterator");for(var Ne="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),He=0;He<Ne.length;He++){var Se=i[Ne[He]];typeof Se=="function"&&typeof Se.prototype[Ee]!="function"&&n(Se.prototype,Ee,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return Ee}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var l;e:{var p={};try{p.__proto__={a:!0},l=p.a;break e}catch{}l=!1}r=l?function(Ee,Ne){if(Ee.__proto__=Ne,Ee.__proto__!==Ne)throw new TypeError(Ee+" is not extensible");return Ee}:null}var m=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(Ee){if(Ee.m)throw new TypeError("Generator is already running");Ee.m=!0}function y(Ee,Ne){return Ee.h=3,{value:Ne}}function D(Ee){this.g=new E,this.G=Ee}function A(Ee,Ne,He,Se){try{var b=Ne.call(Ee.g.j,He);if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");if(!b.done)return Ee.g.m=!1,b;var K=b.value}catch(J){return Ee.g.j=null,Ee.g.s(J),N(Ee)}return Ee.g.j=null,Se.call(Ee.g,K),N(Ee)}function N(Ee){for(;Ee.g.h;)try{var Ne=Ee.G(Ee.g);if(Ne)return Ee.g.m=!1,{value:Ne.value,done:!1}}catch(He){Ee.g.v=void 0,Ee.g.s(He)}if(Ee.g.m=!1,Ee.g.l){if(Ne=Ee.g.l,Ee.g.l=null,Ne.F)throw Ne.D;return{value:Ne.return,done:!0}}return{value:void 0,done:!0}}function j(Ee){this.next=function(Ne){return Ee.o(Ne)},this.throw=function(Ne){return Ee.s(Ne)},this.return=function(Ne){return function(He,Se){v(He.g);var b=He.g.j;return b?A(He,"return"in b?b.return:function(K){return{value:K,done:!0}},Se,He.g.return):(He.g.return(Se),N(He))}(Ee,Ne)},this[Symbol.iterator]=function(){return this}}function V(Ee,Ne){return Ne=new j(new D(Ne)),m&&Ee.prototype&&m(Ne,Ee.prototype),Ne}if(E.prototype.o=function(Ee){this.v=Ee},E.prototype.s=function(Ee){this.l={D:Ee,F:!0},this.h=this.C||this.u},E.prototype.return=function(Ee){this.l={return:Ee},this.h=this.u},D.prototype.o=function(Ee){return v(this.g),this.g.j?A(this,this.g.j.next,Ee,this.g.o):(this.g.o(Ee),N(this))},D.prototype.s=function(Ee){return v(this.g),this.g.j?A(this,this.g.j.throw,Ee,this.g.o):(this.g.s(Ee),N(this))},s("Array.prototype.entries",function(Ee){return Ee||function(){return function(Ne,He){Ne instanceof String&&(Ne+="");var Se=0,b=!1,K={next:function(){if(!b&&Se<Ne.length){var J=Se++;return{value:He(J,Ne[J]),done:!1}}return b=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}(this,function(Ne,He){return[Ne,He]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var G=function(Ee,Ne){for(var He=0;He<Ee.length;He++)Ne(Ee[He])},$=function(Ee){return Ee.replace(/\r?\n|\r/g,`\r
`)},Q=function(Ee,Ne,He){return Ne instanceof Blob?(He=He!==void 0?He+"":typeof Ne.name=="string"?Ne.name:"blob",Ne.name===He&&Object.prototype.toString.call(Ne)!=="[object Blob]"||(Ne=new File([Ne],He)),[String(Ee),Ne]):[String(Ee),String(Ne)]},z=function(Ee,Ne){if(Ee.length<Ne)throw new TypeError(Ne+" argument required, but only "+Ee.length+" present.")},re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,fe=re.FormData,ve=re.XMLHttpRequest&&re.XMLHttpRequest.prototype.send,Re=re.Request&&re.fetch,Ct=re.navigator&&re.navigator.sendBeacon,bt=re.Element&&re.Element.prototype,ut=re.Symbol&&Symbol.toStringTag;ut&&(Blob.prototype[ut]||(Blob.prototype[ut]="Blob"),"File"in re&&!File.prototype[ut]&&(File.prototype[ut]="File"));try{new File([],"")}catch{re.File=function(Ne,He,Se){return Ne=new Blob(Ne,Se||{}),Object.defineProperties(Ne,{name:{value:He},lastModified:{value:+(Se&&Se.lastModified!==void 0?new Date(Se.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ut&&Object.defineProperty(Ne,ut,{value:"File"}),Ne}}var Yt=function(Ee){return Ee.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ht=function(Ee){this.i=[];var Ne=this;Ee&&G(Ee.elements,function(He){if(He.name&&!He.disabled&&He.type!=="submit"&&He.type!=="button"&&!He.matches("form fieldset[disabled] *"))if(He.type==="file"){var Se=He.files&&He.files.length?He.files:[new File([],"",{type:"application/octet-stream"})];G(Se,function(b){Ne.append(He.name,b)})}else He.type==="select-multiple"||He.type==="select-one"?G(He.options,function(b){!b.disabled&&b.selected&&Ne.append(He.name,b.value)}):He.type==="checkbox"||He.type==="radio"?He.checked&&Ne.append(He.name,He.value):(Se=He.type==="textarea"?$(He.value):He.value,Ne.append(He.name,Se))})};if((e=Ht.prototype).append=function(Ee,Ne,He){z(arguments,2),this.i.push(Q(Ee,Ne,He))},e.delete=function(Ee){z(arguments,1);var Ne=[];Ee=String(Ee),G(this.i,function(He){He[0]!==Ee&&Ne.push(He)}),this.i=Ne},e.entries=function Ee(){var Ne,He=this;return V(Ee,function(Se){if(Se.h==1&&(Ne=0),Se.h!=3)return Ne<He.i.length?Se=y(Se,He.i[Ne]):(Se.h=0,Se=void 0),Se;Ne++,Se.h=2})},e.forEach=function(Ee,Ne){z(arguments,1);for(var He=c(this),Se=He.next();!Se.done;Se=He.next()){var b=c(Se.value);Se=b.next().value,b=b.next().value,Ee.call(Ne,b,Se,this)}},e.get=function(Ee){z(arguments,1);var Ne=this.i;Ee=String(Ee);for(var He=0;He<Ne.length;He++)if(Ne[He][0]===Ee)return Ne[He][1];return null},e.getAll=function(Ee){z(arguments,1);var Ne=[];return Ee=String(Ee),G(this.i,function(He){He[0]===Ee&&Ne.push(He[1])}),Ne},e.has=function(Ee){z(arguments,1),Ee=String(Ee);for(var Ne=0;Ne<this.i.length;Ne++)if(this.i[Ne][0]===Ee)return!0;return!1},e.keys=function Ee(){var Ne,He,Se,b,K=this;return V(Ee,function(J){if(J.h==1&&(Ne=c(K),He=Ne.next()),J.h!=3)return He.done?void(J.h=0):(Se=He.value,b=c(Se),y(J,b.next().value));He=Ne.next(),J.h=2})},e.set=function(Ee,Ne,He){z(arguments,2),Ee=String(Ee);var Se=[],b=Q(Ee,Ne,He),K=!0;G(this.i,function(J){J[0]===Ee?K&&(K=!Se.push(b)):Se.push(J)}),K&&Se.push(b),this.i=Se},e.values=function Ee(){var Ne,He,Se,b,K=this;return V(Ee,function(J){if(J.h==1&&(Ne=c(K),He=Ne.next()),J.h!=3)return He.done?void(J.h=0):(Se=He.value,(b=c(Se)).next(),y(J,b.next().value));He=Ne.next(),J.h=2})},Ht.prototype._asNative=function(){for(var Ee=new fe,Ne=c(this),He=Ne.next();!He.done;He=Ne.next()){var Se=c(He.value);He=Se.next().value,Se=Se.next().value,Ee.append(He,Se)}return Ee},Ht.prototype._blob=function(){var Ee="----formdata-polyfill-"+Math.random(),Ne=[],He="--"+Ee+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Se,b){return typeof Se=="string"?Ne.push(He+Yt($(b))+`"\r
\r
`+$(Se)+`\r
`):Ne.push(He+Yt($(b))+'"; filename="'+Yt(Se.name)+`"\r
Content-Type: `+(Se.type||"application/octet-stream")+`\r
\r
`,Se,`\r
`)}),Ne.push("--"+Ee+"--"),new Blob(Ne,{type:"multipart/form-data; boundary="+Ee})},Ht.prototype[Symbol.iterator]=function(){return this.entries()},Ht.prototype.toString=function(){return"[object FormData]"},bt&&!bt.matches&&(bt.matches=bt.matchesSelector||bt.mozMatchesSelector||bt.msMatchesSelector||bt.oMatchesSelector||bt.webkitMatchesSelector||function(Ee){for(var Ne=(Ee=(this.document||this.ownerDocument).querySelectorAll(Ee)).length;0<=--Ne&&Ee.item(Ne)!==this;);return-1<Ne}),ut&&(Ht.prototype[ut]="FormData"),ve){var Hr=re.XMLHttpRequest.prototype.setRequestHeader;re.XMLHttpRequest.prototype.setRequestHeader=function(Ee,Ne){Hr.call(this,Ee,Ne),Ee.toLowerCase()==="content-type"&&(this.B=!0)},re.XMLHttpRequest.prototype.send=function(Ee){Ee instanceof Ht?(Ee=Ee._blob(),this.B||this.setRequestHeader("Content-Type",Ee.type),ve.call(this,Ee)):ve.call(this,Ee)}}Re&&(re.fetch=function(Ee,Ne){return Ne&&Ne.body&&Ne.body instanceof Ht&&(Ne.body=Ne.body._blob()),Re.call(this,Ee,Ne)}),Ct&&(re.navigator.sendBeacon=function(Ee,Ne){return Ne instanceof Ht&&(Ne=Ne._asNative()),Ct.call(this,Ee,Ne)}),re.FormData=Ht}})();const Kg=()=>{const e=W("AREAS");return e.length===0&&e.push(zt.GLOBAL),Ui(e).call(e,(t,n,r)=>{const i=jU(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},jU=e=>e===zt.OVERSEA?"".concat(Br.ASIA,",").concat(Br.EUROPE,",").concat(Br.AFRICA,",").concat(Br.NORTH_AMERICA,",").concat(Br.SOUTH_AMERICA,",").concat(Br.OCEANIA):Br[e],Pz=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=Jy[n],i=Object.keys(r);i&&i.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))})}),t},oT={GLOBAL:{ASIA:[zt.CHINA,zt.JAPAN,zt.INDIA,zt.KOREA,zt.HKMC],EUROPE:[],NORTH_AMERICA:[zt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},aT=Object.keys(oT[zt.GLOBAL]),Gb=[zt.CHINA,zt.NORTH_AMERICA,zt.EUROPE,zt.ASIA,zt.JAPAN,zt.INDIA,zt.OCEANIA,zt.SOUTH_AMERICA,zt.AFRICA,zt.KOREA,zt.HKMC,zt.US],Dz=function(e,t){let n=[];if(Ae(e).call(e,zt.GLOBAL)){const s=[zt.GLOBAL,zt.OVERSEA],o=Object.keys(Jy);if(t===zt.GLOBAL)throw new ae(F.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===zt.CHINA)n=[zt.OVERSEA];else if(i=t,Ae(aT).call(aT,i)){const c=(r=t,oT[zt.GLOBAL][r]||[]),l=[...s,t,...c];n=o.filter(p=>!Ae(l).call(l,p))}else if(function(c){let l=!1;return aT.forEach(p=>{var m;Ae(m=oT[zt.GLOBAL][p]).call(m,c)&&(l=!0)}),l}(t)){const c=function(p){let m;return aT.forEach(E=>{var v;Ae(v=oT[zt.GLOBAL][E]).call(v,p)&&(m=E)}),m}(t),l=[...s,c,t];n=o.filter(p=>!Ae(l).call(l,p))}else n=e;n=function(c){const l=[];return Gb.forEach(p=>{Ae(c).call(c,p)&&l.push(p)}),l.concat(c.filter(p=>!Ae(Gb).call(Gb,p)))}(n)}else n=e;var r,i;return n};function FU(e){var t,n;if(!e&&Ae(t=W("AREAS")).call(t,zt.EXTENSIONS))return R.debug("update area from ap : reset"),void Hb(FK,!0);if(!Ae(n=W("AREAS")).call(n,zt.GLOBAL)||!e)return;let r=Jy.EXTENSIONS;r&&(r={CODE:jU(zt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},R.debug("update area from ap success: ".concat(e,",config is "),r),$t("AREAS",[zt.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?$t(i,r[i][0]):$t(i,r[i])}))}function Hb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=qe.reportApiInvoke(null,{name:xn.SET_AREA,options:e,tag:Tn.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!Ae(aU).call(aU,s))throw new ae(F.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new ae(F.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),r=o?Dz(c,o):c}if(!t){if(va.AREAS){const s=new ae(F.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void R.warning("setArea is prohibited because of config-distribute")}if(Ae(r).call(r,zt.GLOBAL)&&W("AREAS")===zt.EXTENSIONS){const s=new ae(F.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void R.warning("setArea is prohibited because of ap extensions")}}$t("AREAS",r,t);const i=Pz(r);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?$t(s,i[s][0]):$t(s,i[s])}),R.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function BU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Rc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Kb=1;function kz(e,t,n,r,i){Kb+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Kb,requestId:Kb,version:Qs,cname:n.cname},o={service_name:t,json_body:JSON.stringify(s)};let c,l,p=e[0];return Ea(async()=>{c=Date.now();const m=await Ca(p,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-c,m.code!==0){const y=new ae(F.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:l});throw R.error(y.toString()),y}const E=JSON.parse(m.json_body);if(E.code!==200){const y=new ae(F.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:l});throw R.error(y.toString()),y}if(!E.servers||E.servers.length===0){const y=new ae(F.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:l});throw R.error(y.toString()),y}const v=function(y,D){return{addressList:y.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:y.workerToken,vid:y.vid}}(E,t);return W("LIVE_STREAMING_ADDRESS")&&(v.addressList=W("LIVE_STREAMING_ADDRESS")instanceof Array?W("LIVE_STREAMING_ADDRESS"):[W("LIVE_STREAMING_ADDRESS")]),Rc(Rc({},v),{},{responseTime:l})},(m,E)=>(qe.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:E===0,responseTime:l,serverIp:e[E%e.length]}),!1),(m,E)=>(qe.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:l,serverIp:e[E%e.length]}),!!(m.code!==F.OPERATION_ABORTED&&m.code!==F.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(p=e[(E+1)%e.length],!0)),i)}let zb=1;function WU(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:o,sid:c}=t,l=Date.now();let p;const m=t.role,[E,v]=qb(t,s,[Hn.CHOOSE_SERVER]);let y=Gn.networkState;return Ea(async()=>{y&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(r&&r.maxRetryTimeout||qn.maxRetryTimeout)]),y=Gn.networkState;const{data:D,headers:A}=await Ca(i,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=A.http3==="1"?1:-1,qe.reportResourceTiming(i,c),HU(D,i,t,l,[Hn.CHOOSE_SERVER],p);const N=Bg(D,Hn.CHOOSE_SERVER);return Yb(N),Ub(N,i)},D=>(D&&qe.joinChooseServer(c,{role:m,lts:l,succ:!0,csAddr:i,opid:v,serverList:D.gatewayAddrs.map(A=>A.address),ec:null,cid:D.cid.toString(),uid:D.uid.toString(),csIp:D.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),isHttp3:p,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.res.detail&&D.res.detail[38]}),!1),D=>D.code!==F.OPERATION_ABORTED&&(D.code===F.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(qe.joinChooseServer(c,{role:m,lts:l,succ:!1,csAddr:i,serverList:null,opid:v,ec:D.code,csIp:D.data&&D.data.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:p,corssRegionTagReq:t.apRequestDetail}),R.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),D),!0)),r)}function GU(e,t,n,r){let i,{url:s,areaCode:o,serviceIds:c}=e;const l=Date.now(),p=t.role,[m,E]=qb(t,o,c);let v;return Ea(async()=>{v&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(r&&r.maxRetryTimeout||qn.maxRetryTimeout)]),v=Gn.networkState;const{data:y,headers:D}=await Ca(s,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=D.http3==="1"?1:-1,qe.reportResourceTiming(s,t.sid),HU(y,s,t,l,c,i);const A=Bg(y,Hn.CHOOSE_SERVER),N=Bg(y,t.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK),j=performance.getEntriesByName(s),V=j[j.length-1];let G;return V&&(G={name:V.name,protocol:"nextHopProtocol"in V?V.nextHopProtocol:"",dnscost:"domainLookupEnd"in V&&"domainLookupStart"in V&&typeof V.domainLookupEnd=="number"&&typeof V.domainLookupStart=="number"?V.domainLookupEnd-V.domainLookupStart:-1,tcpTlsCost:"connectEnd"in V&&"connectStart"in V&&typeof V.connectEnd=="number"&&typeof V.connectStart=="number"?V.connectEnd-V.connectStart:-1,reqCost:"requestStart"in V&&typeof V.requestStart=="number"&&"responseEnd"in V&&typeof V.responseEnd=="number"?V.responseEnd-V.requestStart:-1,handleCost:"leave_ts"in y&&"enter_ts"in y&&typeof y.leave_ts=="number"&&typeof y.enter_ts=="number"?y.leave_ts-y.enter_ts:-1}),Yb(A),{gatewayInfo:Ub(A,s),proxyInfo:N,url:s,resourceTimingInfo:G}},y=>(y.gatewayInfo&&qe.joinChooseServer(t.sid,{role:p,lts:l,succ:!0,csAddr:s,serverList:y.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:E,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38],resourceTimingInfo:y.resourceTimingInfo?JSON.stringify(y.resourceTimingInfo):void 0}),y.proxyInfo&&qe.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:s,turnServerAddrList:y.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),y=>y.code!==F.OPERATION_ABORTED&&(y.code===F.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(qe.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:v})}),R.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),r)}const HU=(e,t,n,r,i,s)=>{const{sid:o,clientId:c,cloudProxyServer:l}=n,p=[],m=E=>{E.flag===4096?qe.joinChooseServer(o,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||qe.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:l,unilbsServerIds:i.toString()})};if(e.response_body.forEach(E=>{const v=E.buffer.code;if(E.uri===23&&v===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const y={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};p.push(y),m(y)}if(v!==0){const y=Vf(v),D={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?R.warning(D.error.toString()):p.push(D),m(D)}}),p.length)throw R.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(p.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new ae(F.CAN_NOT_GET_GATEWAY_SERVER,p.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!p.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(p.map(E=>{var v;return E==null||(v=E.error)===null||v===void 0||(v=v.data)===null||v===void 0?void 0:v.desc}).filter(E=>!!E))]})},Yb=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ae(F.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(W("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?FU(e.detail[23].toLowerCase()):FU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const o=e.detail[19],c=o?.split(";");for(let l=0;l<c.length;l++){var s;const p=ri(s=c[l]).call(s);e.addresses[l]&&c&&(e.addresses[l].fingerprint=p)}}if(W("GATEWAY_ADDRESS")&&W("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",W("GATEWAY_ADDRESS"));const o=W("GATEWAY_ADDRESS").map(c=>{var l,p;const m=(l=(p=e.addresses.find(E=>E.ip===c.ip&&E.port===c.port))===null||p===void 0?void 0:p.fingerprint)!==null&&l!==void 0?l:"";return{ip:c.ip,port:c.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=o}},Lz=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=Vf(n.buffer.code);throw new ae(F.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",t),new ae(F.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},qb=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Rc(Rc(Rc({6:e.stringUid,11:t,12:W("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const o=new FormData;return o.append("request",JSON.stringify(s)),[o,r]},xz=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let Wf=0;function Gf(e){return je.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const zg=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,o=0;const c=t;let l,p=0;const m=async()=>{const E=(()=>{const v=o*c,y=v+c;return n.slice(v,y).map(r)})();s&&s.push(...E);try{l=await Gf(E)}catch(v){if(p+=c,o++,!(p>=n.length))return void await m();i(v)}E.forEach(v=>v.cancel())};return await m(),l},KU=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const o=async()=>{const c=n(t.shift());try{return await c}catch(l){if(s++,s>=i||r!=null&&r(l))throw l;return o()}};return o()};async function Mz(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new je((l,p)=>{let m;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:v=>{v.close(),clearTimeout(m),l(!0)},error:v=>{clearTimeout(m),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const E=[t,n,r,i,s,o];for(let v=0;v<E.length;v++){const y=new EncodedVideoChunk({type:v==0?"key":"delta",timestamp:33333*v,duration:33333,data:new Uint8Array(E[v])});try{await e.decode(y)}catch{return void l(!1)}}})(),m=setTimeout(()=>{l(!1)},5e3)})}async function Xb(e,t,n,r){return{gatewayInfo:await async function(s,o,c,l){let p=null;const m=[],E=async()=>{const y=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(N=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:Kg()})),D=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(N=>N.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:N=>(R.debug("[".concat(s.clientId,"] Connect to choose_server:"),N.url),WU(N,s,o,c)),allFailedhandler:N=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:m});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},v=async()=>{if(await Rr(1e3),p!==null)return p;const y=W("WEBCS_DOMAIN_BACKUP_LIST").map(N=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:Kg()})),D=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(N=>N.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:N=>(R.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),N.url),WU(N,s,o,c)),allFailedhandler:N=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:m});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};try{return p=await Gf([E(),v()]),m.length&&m.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),p}catch(y){throw y[0]}}(e,t,n,r)}}async function zU(e,t,n,r,i){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await Xb(e,t,n,i);if(W("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:y}=await XU(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:v};const D=y.map(A=>({turnServerURL:A.address,tcpport:A.tcpport||kr.tcpport,udpport:A.udpport||kr.udpport,username:A.username||kr.username,password:A.password||kr.password,forceturn:!1,security:!0}));if(i.useP2P){var o;const A=(o=e.uid)!==null&&o!==void 0?o:v.uid,N="glb:".concat(A.toString()),j=await Vw(N),V=y.map(G=>({turnServerURL:G.address,tcpport:G.tcpport||kr.tcpport,udpport:G.udpport||kr.udpport,username:N,password:j,forceturn:!1,security:!0}));D.push(...V)}return e.turnServer={mode:"manual",servers:D},{gatewayInfo:v}}return await Xb(e,t,n,i)}const{proxyInfo:c,gatewayInfo:l}=await XU(e,t,n,i),p={gatewayInfo:l},m=c.map(v=>({turnServerURL:v.address,tcpport:s==="proxy3"?void 0:v.tcpport?v.tcpport:kr.tcpport,udpport:s==="proxy4"?void 0:v.udpport?v.udpport:kr.udpport,username:v.username||kr.username,password:v.password||kr.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var E;const v=(E=e.uid)!==null&&E!==void 0?E:l.uid,y="glb:".concat(v.toString()),D=await Vw(y),A=c.map(N=>({turnServerURL:N.address,tcpport:s==="proxy3"?void 0:N.tcpport||kr.tcpport,udpport:s==="proxy4"?void 0:N.udpport||kr.udpport,username:y,password:D,forceturn:s!=="proxy4",security:s==="proxy5"}));m.push(...A)}return e.turnServer={mode:"manual",servers:m},R.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),p}async function YU(e,t,n,r,i){const s=W("ACCOUNT_REGISTER").slice(0,W("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):s.map(l=>"https://".concat(l,"/api/v1"));const c=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const l=await async function(p,m,E,v,y){const D=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:m};let N=p[0];const j=await Ea(()=>Ca(N+"".concat(N.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(V,G)=>{if(V.code===0){if(V.uid<=0||V.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(m," => ").concat(V.uid),V),qe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:N,stringUid:A.string_uid,uid:V.uid,errorCode:F.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new ae(F.INVALID_UINT_UID_FROM_STRING_UID);return qe.reqUserAccount(A.sid,{lts:D,success:!0,serverAddr:N,stringUid:A.string_uid,uid:V.uid,errorCode:null,extend:A}),!1}const $=Vf(V.code);return $.retry&&(N=p[(G+1)%p.length]),qe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:N,stringUid:A.string_uid,uid:V.uid,errorCode:$.desc,extend:A}),$.retry},(V,G)=>V.code!==F.OPERATION_ABORTED&&(qe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:N,stringUid:A.string_uid,uid:null,errorCode:V.code,extend:A}),N=p[(G+1)%p.length],!0),y);if(j.code!==0){const V=Vf(j.code);throw new ae(F.UNEXPECTED_RESPONSE,V.desc)}return j}(o,e,t,n,r);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},c),l.uid}catch(l){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},c),l}}async function Uz(e,t,n){const r=W("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await KU({referenceList:i,asyncMapHandler:o=>async function(c,l,p,m){const E=Date.now(),v={sid:p.sid,opid:10,appid:p.appId,string_uid:l};try{const y=await Ca(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const D=Vf(y.code);throw new ae(F.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new ae(F.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:c,req:v,uid:y.uid,elapse:Date.now()-E}}catch(y){throw y}}(o,e,t,n),closeFn:o=>o.code===F.OPERATION_ABORTED||o.code===F.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function Vz(e,t,n){const r=W("CDS_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")),i=r.map(l=>function(p,m,E,v){const y=xt(),D={flag:64,cipher_method:0,features:Rc(Rc(Rc(Rc(Rc({install_id:Xw(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:Qs,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:Az.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return Ea(()=>Ca(p,{data:D,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,A=>A.code!==F.OPERATION_ABORTED,v)}(l,e,t,n));let s=null,o=null,c={};try{s=await Gf(i)}catch(l){if(l.code===F.OPERATION_ABORTED)throw l;o=l}if(i.forEach(l=>l.cancel()),qe.reportApiInvoke(e.sid,{name:xn.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=function(l){if(!l.test_tags)return{};const p=l.test_tags,m=Object.keys(p),E={};return m.forEach(v=>{var y;const D=ri(y=v.slice(4)).call(y),A=JSON.parse(p[v]),N=A[1];E[D]={tag:A[0]||"",value:N}}),E}(s)}catch{}return c}async function qU(e,t){const n=W("WEBCS_DOMAIN").concat(W("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Kg(),serviceIds:[Hn.CHOOSE_SERVER,Hn.CLOUD_PROXY_FALLBACK]}));try{return await KU({referenceList:n,asyncMapHandler:i=>async function(s,o,c){let l,{url:p,areaCode:m,serviceIds:E}=s;const v=Date.now(),[y,D]=qb(o,m,E);let A=Gn.networkState;try{A&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(qn.maxRetryTimeout)]),A=Gn.networkState;const{data:N,headers:j}=await Ca(p,{data:y,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=j.http3==="1"?1:-1,(Q=>{const z=[];if(Q.response_body.forEach(re=>{const fe=re.buffer.code;if(re.uri===23&&fe===0&&!re.buffer.edges_services)if(re.buffer.flag===4194310)re.buffer.edges_services=[];else{const ve={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Q.detail[502]}),flag:re.buffer.flag};z.push(ve)}if(fe!==0){const ve=Vf(fe),Re={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,ve.desc,{desc:ve.desc,retry:ve.retry,csIp:Q.detail[502]}),flag:re.buffer.flag};re.buffer.flag===4194310?R.warning(Re.error.toString()):z.push(Re)}}),z.length)throw new ae(F.CAN_NOT_GET_GATEWAY_SERVER,z.map(re=>"flag: ".concat(re.flag,", message: ").concat(re.error.message)).join(" | "),{retry:!!z.find(re=>re.error.data.retry),csIp:Q.detail[502],desc:[...new Set(z.map(re=>{var fe;return re==null||(fe=re.error)===null||fe===void 0||(fe=fe.data)===null||fe===void 0?void 0:fe.desc}).filter(re=>!!re))]})})(N);const G=Bg(N,Hn.CHOOSE_SERVER),$=Bg(N,Hn.CLOUD_PROXY_FALLBACK);return Yb(G),{gatewayInfo:Ub(G,p),proxyInfo:$,opid:D,requestTime:v,url:p,isHttp3:l,elapse:Date.now()-v}}catch(N){throw N}}(i,e,t),closeFn:i=>i.code===F.OPERATION_ABORTED||i.code===F.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function XU(e,t,n,r){const i=W("PROXY_SERVER_TYPE3"),s=(y,D,A)=>{let N=A||i;return Array.isArray(N)&&(N=D%2==0&&i[1]||i[0]),"https://".concat(N,"/ap/?url=").concat(y)};let o=null;const c=[],l=async()=>{const y=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map((N,j)=>{let V;return V=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j),{url:V,areaCode:Kg(),serviceIds:[Hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK]}}),D=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(N=>N.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:N=>(R.debug("[".concat(e.clientId,"] Connect to choose_server:"),N.url),GU(N,e,t,n)),allFailedhandler:N=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},p=async()=>{if(await Rr(1e3),o!==null)return o;const y=W("WEBCS_DOMAIN_BACKUP_LIST").map((N,j)=>{let V;return V=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):s("".concat(N,"/api/v2/transpond/webrtc?v=2"),j),{url:V,areaCode:Kg(),serviceIds:[Hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK]}}),D=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(N=>N.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:N=>(R.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),N.url),GU(N,e,t,n)),allFailedhandler:N=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};let m,E,v;try{({gatewayInfo:m,proxyInfo:E,url:v}=await Gf([l(),p()]))}catch(y){throw y[0]}if(c.length&&c.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!E)throw new ae(F.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=v,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&v){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];Ae(i).call(i,y)&&(e.proxyServer=y,R.setProxyServer(y),qe.setProxyServer(y))}return o={gatewayInfo:m,proxyInfo:await vU(E,m.uid)},o}async function jz(e,t,n){const r=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=r.map(s=>function(o,c,l,p){const m={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:Qs,cname:c.cname,uid:c.uid.toString(),requestId:zb,seq:zb};zb+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(m)};return Ea(async()=>{const v=await Ca(o,{data:E,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const D=new ae(F.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw R.error(D.toString()),D}const y=JSON.parse(v.json_body);if(y.code!==200){const D=new ae(F.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw R.error(D.toString()),D}if(!y.servers||y.servers.length===0){const D=new ae(F.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(D.toString()),D}return{vid:y.vid,workerToken:y.workerToken,addressList:(W("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,v=>!!(v.code!==F.OPERATION_ABORTED&&v.code!==F.UNEXPECTED_RESPONSE||v.data&&v.data.retry),p)}(s,e,t,n));try{const s=await Gf(i);return i.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function Fz(e,t,n){let r=null;const i=[],s=async o=>{const c=W(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return o&&(await Rr(1e3),r!==null)?r:await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:l=>(R.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),l),function(p,m,E,v){const[y]=xz(m,[Hn.CHOOSE_SERVER]);let D=Gn.networkState;return Ea(async()=>{D&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(v&&v.maxRetryTimeout||qn.maxRetryTimeout)]),D=Gn.networkState;const A=await Ca(p,{data:y,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return Lz(A,p)},()=>!1,A=>A.code!==F.OPERATION_ABORTED&&(A.code===F.UPDATE_TICKET_FAILED?A.data.retry:(R.warning("[".concat(m.clientId,"] update ticket network error, retry"),A),!0)),v)}(l,e,t,n)),allFailedhandler:l=>{throw l[0]},promisesCollector:i})};try{return r=await Gf([s(!1),s(!0)]),i.length&&i.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),r}catch(o){throw o[0]}}function JU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Jb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Bz extends bn{get isSuccess(){return!!this.configs}constructor(t,n){super(),x(this,"configs",void 0),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"cancelToken",void 0),x(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),x(this,"interval",void 0),x(this,"mutex",void 0),x(this,"mutableParamsRead",!1),x(this,"configCache",{}),x(this,"limit_bitrate",void 0),this.mutex=new jr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),W("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},W("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,qe.reportApiInvoke(null,{options:void 0,name:xn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Tn.TRACER}).onSuccess(JSON.stringify(va))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await Vz(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(i){var s;const o=nh(s=Object.keys(i).filter(p=>/^webrtc_ng_global_parameter/.test(p))).call(s);for(let p=0;p<o.length;p++)for(let m=o.length-1;m>p;m--){const E=o[m],v=i[E].value;if(typeof v.__priority=="number"){const y=v.__priority,D=o[m-1],A=i[D].value;if(typeof A.__priority=="number"){if(!(y>A.__priority))continue;{const N=E;o[m]=o[m-1],o[m-1]=N}}else{const N=E;o[m]=o[m-1],o[m-1]=N}}}const c=Date.now();let l={};return o.forEach(p=>{const m=i[p].value.__expires;m&&m<=c||(l[p]=i[p])}),l}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new ae(F.NETWORK_RESPONSE_ERROR,r);R.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){cU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Vg.UPDATE_BITRATE_LIMIT,t):this.emit(Vg.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Jb({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),i=[];r.forEach(s=>{const o=t[s].value;n[s]=o;const c=o.__id;if(c&&this.configCache[s]&&this.configCache[s].__id===c)return;const l=o.__type,p=t[s].value,m=t[s].tag;let E=0;l?l===DL.REALTIME&&(E=1):Object.keys(p).some(v=>Object.prototype.hasOwnProperty.call($w,v)||!bb()&&Object.prototype.hasOwnProperty.call(Ay,v)?(E=1,!0):void 0),i.push({tag:m,isApplied:E,feature:s,params:JSON.stringify(o)})}),i.forEach(s=>{let{tag:o,feature:c,params:l,isApplied:p}=s;this.store.sessionId&&qe.abTest(this.store.sessionId,{intSucc:1,isApplied:p,tag:o,feature:c,params:l,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){R.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(i){const s={};return Object.keys(i).forEach(o=>{const c=i[o].value,l=c.__expires,p=c.__type;Object.keys(c).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(s,m)||(s[m]=Jb(Jb({value:c[m]},l&&{expires:l}),p&&{type:p}))})}),s}(t);try{var r;const i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&cU(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(c){try{const l=Date.now();Object.keys(c).forEach(p=>{const{value:m,type:E,expires:v}=c[p];v&&v<=l||((E===DL.REALTIME||Object.prototype.hasOwnProperty.call($w,p))&&(va[p]=m,Sn[p]=m,R.debug("Update realtime parameters from config distribute",p,m)),E||bb()||!Object.prototype.hasOwnProperty.call(Ay,p)||(va[p]=m,Sn[p]=m,R.debug("Update gateway parameters from config distribute",p,m)))})}catch(l){R.error("Error update config immediately: ".concat(c),l.message)}}(n);const s=JSON.stringify(n),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),R.debug("Caching global parameters ".concat(s))}catch(i){R.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Sn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;(function(o,c){try{return typeof o=="object"&&typeof c=="object"&&JSON.stringify(o)===JSON.stringify(c)}catch{return!1}})(Sn[r],i)||(va[r]=i,Sn[r]=i,this.emit(Vg.UPDATE_CLIENT_ROLE_OPTIONS,i),R.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(n){R.error("Error handling global parameter config:",n.message)}}}class Wz extends bn{constructor(){super(...arguments),x(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(W("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?W("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var o;const c=Ae(o=i.result).call(o,!0);i.isPrevNormal&&!c&&this.emit("exception",Qb[t],t,n),!i.isPrevNormal&&c&&this.emit("exception",Qb[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof $n&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=as(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||Ae(n=W("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof $n&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Qb={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Gr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function QU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ch(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Yg{constructor(t){x(this,"store",void 0),x(this,"onStatsException",void 0),x(this,"onUploadPublishDuration",void 0),x(this,"onStatsChanged",void 0),x(this,"onVideoCodecChanged",void 0),x(this,"localStats",new Map),x(this,"remoteStats",new Map),x(this,"updateStatsInterval",void 0),x(this,"trafficStats",void 0),x(this,"trafficStatsPeerList",[]),x(this,"uplinkStats",void 0),x(this,"exceptionMonitor",void 0),x(this,"p2pChannel",void 0),x(this,"scalabilityMode",Iy.L1T1),x(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Wz,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Te.LocalAudioTrack)||Ch({},sb)}getLocalVideoTrackStats(){return this.localStats.get(Te.LocalVideoTrack)||Ch({},ob)}getRemoteAudioTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:c}]=s;c&&(r[o]=n(o,c))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:o}]=i;o&&(n[s]=o)});return n}getRemoteVideoTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:c}]=s;c&&(r[o]=n(o,c))});return r}getRTCStats(){let t=0,n=0,r=0,i=0;const s=this.localStats.get(Te.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(Te.LocalVideoTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(Te.LocalVideoLowTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:m,videoStats:E}=p;m&&(r+=m.receiveBytes,i+=m.receiveBitrate),E&&(r+=E.receiveBytes,i+=E.receiveBitrate)});let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?Gr.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?Gr.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case Te.LocalVideoTrack:case Te.LocalVideoLowTrack:{const c=i,l=Ch({},ob),p=t.getStats(),m=t.getLocalMedia(r);if(p){const E=p.videoSend.find(v=>v.ssrc===m?.ssrcs[0].ssrcId);if(E){const v=t.getLocalVideoSize(),y=t.getEncoderConfig(Te.LocalVideoTrack);var s;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(l.codecType=E.codec,c?.codecType!==E.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,E.codec.toLocaleLowerCase()))),l.sendBytes=E.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,E.inputFrame?(l.captureFrameRate=E.inputFrame.frameRate,l.captureResolutionHeight=E.inputFrame.height,l.captureResolutionWidth=E.inputFrame.width):v&&(l.captureResolutionWidth=v.width,l.captureResolutionHeight=v.height),E.sentFrame?(l.sendFrameRate=E.sentFrame.frameRate,l.sendResolutionHeight=E.sentFrame.height,l.sendResolutionWidth=E.sentFrame.width):v&&(l.sendResolutionWidth=v.width,l.sendResolutionHeight=v.height),E.avgEncodeMs&&(l.encodeDelay=E.avgEncodeMs),y&&y.bitrateMax?l.targetSendBitrate=1e3*y.bitrateMax:E.targetBitrate&&(l.targetSendBitrate=E.targetBitrate),l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(l.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,l),(c?.sendResolutionWidth!==l.sendResolutionWidth||c?.sendResolutionHeight!==l.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,l);break}case Te.LocalAudioTrack:{const c=i,l=Ch({},sb),p=t.getStats(),m=t.getLocalMedia(r);if(p){const E=p.audioSend.find(v=>v.ssrc===m?.ssrcs[0].ssrcId);if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(l.codecType=E.codec),E.inputLevel)l.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const v=t.getLocalAudioVolume();v&&(l.sendVolumeLevel=Math.round(32767*v))}l.sendBytes=E.bytes,l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Te.LocalAudioTrack,l),l&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[s,{videoStats:o,audioStats:c,videoPcStats:l}]=n;const p=c,m=o,E=l,v=Ch({},GL),y=Ch({},HL),D=Ch({},wK),{audioTrack:A,videoTrack:N,audioSSRC:j,videoSSRC:V}=t.getRemoteMedia(s);let G;G=this.store.useP2P?t.getStats(!0):t.getStats();const $=(r=G)===null||r===void 0?void 0:r.audioRecv.find(fe=>fe.ssrc===j),Q=(i=G)===null||i===void 0?void 0:i.videoRecv.find(fe=>fe.ssrc===V),z=this.trafficStats&&this.trafficStats.peer_delay.find(fe=>fe.peer_uid===s);if($&&($.codec!=="opus"&&$.codec!=="aac"&&$.codec!=="PCMU"&&$.codec!=="PCMA"&&$.codec!=="G722"||(v.codecType=$.codec),$.outputLevel?v.receiveLevel=Math.round(32767*$.outputLevel):A&&(v.receiveLevel=Math.round(32767*A.getVolumeLevel())),v.receiveBytes=$.bytes,v.receivePackets=$.packets,v.receivePacketsLost=$.packetsLost,v.receivePacketsDiscarded=$.packetsDiscarded,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=p?8*Math.max(0,v.receiveBytes-p.receiveBytes):0,v.totalDuration=p?p.totalDuration+1:1,v.totalFreezeTime=p?p.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=$.jitterBufferMs,v.totalDuration>10&&Yg.isRemoteAudioFreeze(A)&&(v.totalFreezeTime+=1)),Q){var re;Q.codec!=="H264"&&Q.codec!=="H265"&&Q.codec!=="VP8"&&Q.codec!=="VP9"&&Q.codec!=="AV1X"&&Q.codec!=="AV1"||(y.codecType=Q.codec),y.receiveBytes=Q.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,y.renderFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,Q.outputFrame&&(y.renderFrameRate=Q.outputFrame.frameRate),Q.receivedFrame?(y.receiveFrameRate=Q.receivedFrame.frameRate,y.receiveResolutionHeight=Q.receivedFrame.height,y.receiveResolutionWidth=Q.receivedFrame.width):N&&(y.receiveResolutionHeight=N._videoHeight||0,y.receiveResolutionWidth=N._videoWidth||0),Q.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(Q.framesRateFirefox)),y.receivePackets=Q.packets,y.receivePacketsLost=Q.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const fe=m?m.totalFreezeTime:0,ve=m?m.totalDuration:0;y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=(re=Q.totalFreezesDuration)!==null&&re!==void 0?re:fe||0,y.receiveDelay=Q.jitterBufferMs||0;const Re=!!V&&t.getRemoteVideoIsReady(V);Q.totalFreezesDuration===void 0&&N&&Re&&Yg.isRemoteVideoFreeze(N,Q,E)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-fe)/(y.totalDuration-ve),1))}z&&(v.end2EndDelay=z.B_ad,y.end2EndDelay=z.B_vd,v.transportDelay=z.B_ed,y.transportDelay=z.B_ed,v.currentPacketLossRate=z.B_ealr4/100,y.currentPacketLossRate=z.B_evlr4/100,D.uplinkNetworkQuality=z.B_punq?z.B_punq:0,D.downlinkNetworkQuality=z.B_pdnq?z.B_pdnq:0),this.remoteStats.set(s,{audioStats:v,videoStats:y,videoPcStats:Q,networkStats:D}),A&&this.exceptionMonitor.setRemoteAudioStats(A,v),N&&this.exceptionMonitor.setRemoteVideoStats(N,y)})}}class ZU{constructor(){x(this,"destChannelMediaInfos",new Map),x(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){oU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){oU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Yy(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function $U(e){if(!(e instanceof ZU))return new ae(F.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new ae(F.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new ae(F.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Pd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){x(this,"uid",void 0),x(this,"_uintid",void 0),x(this,"_trust_in_room_",!0),x(this,"_trust_audio_enabled_state_",!0),x(this,"_trust_video_enabled_state_",!0),x(this,"_trust_audio_mute_state_",!0),x(this,"_trust_video_mute_state_",!0),x(this,"_audio_muted_",!1),x(this,"_video_muted_",!1),x(this,"_audio_enabled_",!0),x(this,"_video_enabled_",!0),x(this,"_audio_added_",!1),x(this,"_video_added_",!1),x(this,"_is_pre_created",!1),x(this,"_video_pre_subscribed",!1),x(this,"_audio_pre_subscribed",!1),x(this,"_trust_video_stream_added_state_",!0),x(this,"_trust_audio_stream_added_state_",!0),x(this,"_audioTrack",void 0),x(this,"_videoTrack",void 0),x(this,"_dataChannels",[]),x(this,"_audioSSRC",void 0),x(this,"_videoSSRC",void 0),x(this,"_audioOrtc",void 0),x(this,"_videoOrtc",void 0),x(this,"_cname",void 0),x(this,"_rtxSsrcId",void 0),x(this,"_videoMid",void 0),x(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function e5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Zb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const cT="9",$b=2e4,lT=4e4;function t5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function _l(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?t5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Hf=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Hf||{});const dT=new Map;function n5(e,t,n,r){let{scale:i}=e;if(i===0&&r===Hf.UP||i>=t.length-1&&r===Hf.DOWN)return e;let s=_l(_l({},e),{},{scale:r===Hf.DOWN?++i:--i});switch(n){case"maintain-framerate":s=_l(_l({},s),t[i].motion);break;case"maintain-resolution":s=_l(_l({},s),t[i].detail);break;case"balanced":s=_l(_l({},s),t[i].balanced)}return s}function r5(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:i5(t)};dT.set(e,n)}else dT.delete(e)}function i5(e){const t=_l({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:l,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:N,BALANCE_RESOLUTION_FACTOR:j,MOTION_RESOLUTION_FACTOR:V,MOTION_BITRATE_FACTOR:G,DETAIL_FRAMERATE_FACTOR:$,DETAIL_BITRATE_FACTOR:Q}=Qw,z=Math.min(t.frameRate,c),re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(v,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*z),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let fe=1;fe<=l;fe++){const ve={bwe_up:Math.round(Math.pow(E,fe)*n),bwe_down:Math.round(Math.pow(v,fe+1)*n),fps_up:Math.round(Math.pow(D,fe)*z),fps_down:Math.round(Math.pow(y,fe+1)*z)},Re={scaleResolutionDownBy:i/Math.pow(j,fe),frameRate:Math.max(Math.round(Math.pow(N,fe)*r),o),bitrateMax:Math.max(Math.round(Math.pow(A,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(A,fe)*s),p)},Ct={scaleResolutionDownBy:i/Math.pow(V,fe),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(G,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(G,fe)*s),p)},bt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow($,fe)*r),o),bitrateMax:Math.max(Math.round(Math.pow(Q,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(Q,fe)*s),p)};re.push({scale:fe,threshold:ve,balanced:Re,motion:Ct,detail:bt})}return re}function Gz(e,t,n,r,i,s){const o=dT.get(e)||{overUse:0,underUse:0,adaptationList:i5(i)},{adaptationList:c}=o;dT.set(e,o);const{OVERUSE_TIMES_THRESHOLD:l,UNDERUSE_TIMES_THRESHOLD:p}=Qw,{scale:m}=r;let E,v;return typeof t=="number"&&t>0&&function(y,D,A,N){if(D>=A.length)return!1;let{threshold:{fps_down:j}}=A[D];return W("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(j=A[0].threshold.fps_down),y<j}(t,m,c,s)&&(o.overUse++,v=Ng.CPU,o.overUse>l)||typeof n=="number"&&n>0&&function(y,D,A){if(D>=A.length)return!1;const{threshold:{bwe_down:N}}=A[D];return y<N}(n,m,c)&&(o.overUse++,v=Ng.BANDWIDTH,o.overUse>l)?(o.overUse=0,o.underUse=0,E=n5(r,c,s,Hf.DOWN),[E,v]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(y,D,A,N){if(D===0)return;let{threshold:{fps_up:j}}=A[D];return W("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(j=A[1].threshold.fps_up),y>j}(t,m,c,s)&&function(y,D,A){if(D===0)return;const{threshold:{bwe_up:N}}=A[D];return y>N}(n,m,c)&&(o.underUse++,o.underUse>p&&(o.overUse=0,o.underUse=0,E=n5(r,c,s,Hf.UP),E.scale===0&&(v=Ng.NONE))),[E,v])}function s5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function eI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const uT=new Map;function hT(e,t){const n=uT.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),uT.delete(e)}t.qualityLimitationReason=Ng.NONE,r5(e)}function Hz(e,t){var n;let r;switch(t){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=e._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return r}function tI(e){const t=Ft();if(e.some(n=>n._bypassWebAudio))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function nI(e,t){tI(e);const n=new $n;return e.forEach(r=>n.addAudioTrack(r)),n}const Kz=!Ft().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dl();function pT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return Kz?(n={spec:t,store:e},ml("PlanBConnection").create(n)):new no(t,e)}function rI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function o5(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Ig(e.turnServer.servers))return!1;if(W("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Mt;function a5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?a5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let no=(Mt=class Mh extends dU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ae(n=Object.keys(Dg)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"id",on(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:W("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"preMediaMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Ng.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=o5(t),this.mutex=new jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Mh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=qw(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Id(r.sdp),s=await OU({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:W("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:W("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=rT(s),this.initialOffer=r,W("ENABLE_SVC")&&this.store.codec=="av1"){const c=await async function(){try{const l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Iy.L1T3}]});const p=await l.createOffer();if(!p.sdp)return void l.close();const m=Gi(p.sdp).mediaDescriptions[0];if(!m)return;const E=m.attributes.extmaps.find(v=>v.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return l.close(),E}catch{return}}();var t;c&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(c))}let o;return r.sdp&&kU(r.sdp)&&(o=Cn(s),(n=o).send&&(jf(Be.VIDEO,n.send.videoExtensions),jf(Be.AUDIO,n.send.audioExtensions)),n.recv&&(jf(Be.VIDEO,n.recv.videoExtensions),jf(Be.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(jf(Be.VIDEO,n.sendrecv.videoExtensions),jf(Be.AUDIO,n.sendrecv.audioExtensions))),Ra(Ra({},i),{},{rtpCapabilities:o||s,offerSDP:r.sdp})}catch(r){throw new pe(F.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&kU(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(eT(Be.VIDEO,n.send.videoExtensions,r.send.videoExtensions),eT(Be.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(eT(Be.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),eT(Be.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Cn(this._localCapabilities)}get rtpCapabilities(){return Cn(this._rtpCapabilities)}get candidates(){return Cn(this._candidates)}get iceParameters(){return Cn(this._iceParameters)}get dtlsParameters(){return Cn(this._dtlsParameters)}constructor(l){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1],m=arguments.length>2&&arguments[2]!==void 0&&arguments[2];x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_originCandidates",void 0),x(this,"_iceParameters",void 0),x(this,"_isUseExtmapAllowMixed",void 0),x(this,"_isUseLocalCodecs",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),x(this,"useLocalCodecsMids",[]),x(this,"preloadSsrcs",[]),x(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,this._isUseLocalCodecs=m,l=Cn(l);const{iceParameters:E,dtlsParameters:v,candidates:y,rtpCapabilities:D,setup:A,localCapabilities:N,cname:j}=l;this._rtpCapabilities=D,this._candidates=y,this._originCandidates=Cn(y),this._iceParameters=E,this._dtlsParameters=v,this._localCapabilities=N,this.setup=A,this.cname=j,[this.sessionDesc]=this.updateRemoteRTPCapabilities(D),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(l){return l.length===this.preloadSsrcs.length&&l.every(p=>{var m;return Ae(m=this.preloadSsrcs).call(m,p)})}preloadRemoteMedia(l){let p=0;const m=[],E=[];for(;l>0;){const v=[Zb({ssrcId:lT+p},W("USE_SUB_RTX")?{rtx:lT+p+1}:{})],y="".concat(lT+p,"_").concat($b+p),{ssrcs:D,ssrcGroups:A}=Gg(v,this.cname,W("SYNC_GROUP")?y:void 0),N=this.preCreateOrRecycleSendMedia("video",D,A,void 0),j=[{ssrcId:$b+p}],V="".concat(lT+p,"_").concat($b+p),{ssrcs:G,ssrcGroups:$}=Gg(j,this.cname,W("SYNC_GROUP")?V:void 0),Q=this.preCreateOrRecycleSendMedia("audio",G,$,void 0);l--,p+=2,m.push(N,Q),E.push(D[0].ssrcId,G[0].ssrcId)}return this.useLocalCodecsMids.push(...m),this.preloadSsrcs=E,{mids:m,preSSRCs:E,isAvailable:!0}}preCreateOrRecycleSendMedia(l,p,m,E){const v=this.rtpCapabilities.send.videoCodecs,y=this._isUseLocalCodecs||v.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",p[0].ssrcId);const D=l===Be.VIDEO?y.videoCodecs:y.audioCodecs,A=l===Be.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;const N="".concat(this.currentMidIndex);let j={media:{mediaType:l,port:cT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.map(V=>V.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:D,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};return j=this.mungSendMediaDesc(j,E),this.sessionDesc.mediaDescriptions.push(j),this.updateBundleMids(),N}toString(){return yd(this.sessionDesc)}send(l,p,m,E){const{ssrcs:v,ssrcGroups:y}=Gg(p,this.cname,W("SYNC_GROUP")?m:void 0),D=this.findPreloadMediaDesc(v);if(D){if(Nn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,D.attributes.mid),E&&(E.twcc||E.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(D);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(D,E),{mid:D.attributes.mid,needExchangeSDP:!0}}return{mid:D.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(l,v);let N;return A===-1||A===1&&(Nr()||function(){const j=xt();return!(j.name!==Wt.CHROME||!j.osVersion)&&Number(j.version)<=90}()||W("ENABLE_ENCODED_TRANSFORM")&&ll())||A===0&&!function(j){const V=xt();return!(V.name!==Wt.FIREFOX||!V.osVersion)&&Number(V.version)===j}(138)&&W("USE_SUB_RTX")||nL()?(N=this.createOrRecycleSendMedia(l,v,y,"sendonly",E),this.updateBundleMids()):(N=Cn(this.sessionDesc.mediaDescriptions[A]),N.attributes.direction="sendonly",N.attributes.ssrcs=v,N.attributes.ssrcGroups=y,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(N,E)),Nn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,N.attributes.mid),{mid:N.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:l,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:l.attributes.mid,needExchangeSDP:p}}batchSend(l){const p=l.map(v=>{let{kind:y,ssrcMsg:D,mslabel:A}=v;return this.send(y,D,A)}),m=[];let E=!1;return p.forEach(v=>{let{mid:y,needExchangeSDP:D}=v;D&&(E=!0),m.push(y)}),{mids:m,needExchangeSDP:E}}stopSending(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&l.indexOf(m.attributes.mid)!==-1);if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(m=>{m.attributes.mid==="0"||Nn()||nL()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(l){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l);if(!p)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(l){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l);if(!p)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>Ae(l).call(l,m.attributes.mid||""));if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>Ae(l).call(l,m.attributes.mid||""));if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="recvonly"})}receive(l,p,m,E){l.forEach((v,y)=>{this.createOrRecycleRecvMedia(v,[],"recvonly",p,m,E[y])}),this.updateBundleMids()}stopReceiving(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>l.indexOf(m.attributes.mid)!==-1);if(p.length!==l.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(l){const p=this.sessionDesc||Gi((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=l;let E=!1;const v=this.rtpCapabilities.send,y=this.localCapabilities.send,D=this.localCapabilities.recv,A=D.videoCodecs,N=D.audioCodecs,j=D.videoExtensions,V=D.audioExtensions;for(const z of p.mediaDescriptions){var G;if(z.attributes.direction!=="sendonly"||typeof z.attributes.mid!="string"||!Ae(G=this.useLocalCodecsMids).call(G,z.attributes.mid)){if(E=!0,z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var $;z.media.fmts=A.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=A,z.attributes.extmaps=j;const re=z.attributes.mid;typeof re!="string"||Ae($=this.useLocalCodecsMids).call($,re)||this.useLocalCodecsMids.push(re)}else if(v.videoCodecs.length===0){const re=y.videoCodecs.filter(fe=>{var ve,Re;return(ve=fe.rtpMap)===null||ve===void 0?void 0:Ae(Re=ve.encodingName.toLowerCase()).call(Re,"vp8")})||[y.videoCodecs[0]];z.media.fmts=re.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=re,z.attributes.extmaps=[]}else z.media.fmts=v.videoCodecs.map(re=>re.payloadType.toString(10)),z.attributes.payloads=v.videoCodecs,z.attributes.extmaps=v.videoExtensions;if(z.media.mediaType==="audio")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var Q;z.media.fmts=N.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=N,z.attributes.extmaps=V;const re=z.attributes.mid;typeof re!="string"||Ae(Q=this.useLocalCodecsMids).call(Q,re)||this.useLocalCodecsMids.push(re)}else if(v.audioCodecs.length===0){const re=y.audioCodecs.filter(fe=>{var ve,Re;return(ve=fe.rtpMap)===null||ve===void 0?void 0:Ae(Re=ve.encodingName.toLowerCase()).call(Re,"opus")})||[y.audioCodecs[0]];z.media.fmts=re.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=re,z.attributes.extmaps=[]}else z.media.fmts=v.audioCodecs.map(re=>re.payloadType.toString(10)),z.attributes.payloads=v.audioCodecs,z.attributes.extmaps=v.audioExtensions,Bf(z)}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,[this.sessionDesc,E]}updateCandidates(l){const p=this._originCandidates.filter(E=>E.transport==="udp"),m=[];if(p.forEach(E=>{m.push(Zb(Zb({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}),p.length!==0){switch(l){case Wr.TCP_RELAY:this._candidates=m;break;case Wr.UDP_TCP_RELAY:case Wr.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(l){l=Cn(l),this._iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=l.iceUfrag,p.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const p=[];for(let m=0;m<l;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(l,p){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const E=m.media.mediaType===l&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(Nn()){if(E){const v=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(v||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!v||v!==m.attributes.mid)}return!1}return E})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const l="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:cT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(l),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(l,p,m,E,v,y){const D=l._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,N=Hg(D,A,this.localCapabilities.send,D===Be.VIDEO?E:v),j=D===Be.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let G={media:{mediaType:D,port:cT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map(Q=>Q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};G=this.mungRecvMediaDsec(G,l,y);const $=this.findFirstClosedMedia(D);if($){const Q=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[Q]=G}else this.sessionDesc.mediaDescriptions.push(G);return G}updateRemoteDtlsParameters(l){const p=new Set(this._dtlsParameters.fingerprints.map(v=>v.fingerprint)),m=new Set(l.map(v=>v.fingerprint));let E=!1;p.size!==m.size&&(E=!0);for(const v of p)m.has(v)||(E=!0);return E}updateRemoteCodec(l,p,m){const E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(G=>G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||"").filter(G=>{var $;return Ae($=Object.keys(Dg)).call($,G)}))],v=new Set(p);if(E.every(G=>v.has(G)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const y=this._rtpCapabilities.recv.videoCodecs.filter(G=>p.some($=>{var Q;return Ae(Q=G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||"").call(Q,$)}));if(y.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(p)),!1;const D=[...new Set(y.map(G=>G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||""))];let A;if(R.debug("updateRemoteCodec, from ".concat(E," to ").concat(D)),l.length===0)A=this.sessionDesc.mediaDescriptions.filter(G=>G.media.mediaType==="video"&&G.attributes.direction==="recvonly");else if(A=this.sessionDesc.mediaDescriptions.filter(G=>G.attributes.mid&&G.media.mediaType==="video"&&Ae(l).call(l,G.attributes.mid)&&G.attributes.direction==="recvonly"),A.length!==l.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(l,", codecs: ").concat(p)),!1;if(W("USE_PUB_RTX")||W("USE_SUB_RTX")){const G=Ad(y,this.rtpCapabilities.recv.videoCodecs);y.push(...G)}this._rtpCapabilities.recv.videoCodecs=y;const N=this.localCapabilities.send,j=this.rtpCapabilities.recv,V=Hg(Be.VIDEO,j,N,m);return A.forEach(G=>{const $=V.map(Q=>Q.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(G.attributes.mid,", from"),G.attributes.payloads,"to",V),G.attributes.payloads=V,G.media.fmts=$}),!0}createOrRecycleSendMedia(l,p,m,E,v){const y=this.rtpCapabilities.send.videoCodecs,D=this._isUseLocalCodecs||y.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,A=l===Be.VIDEO?D.videoCodecs:D.audioCodecs,N=l===Be.VIDEO?D.videoExtensions:D.audioExtensions;this.currentMidIndex+=1;const j="".concat(this.currentMidIndex);let V={media:{mediaType:l,port:cT,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map($=>$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:N,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(j)}};V=this.mungSendMediaDesc(V,v);const G=this.findFirstClosedMedia(l);if(G){const $=this.sessionDesc.mediaDescriptions.indexOf(G);this.sessionDesc.mediaDescriptions[$]=V}else this.sessionDesc.mediaDescriptions.push(V);return V}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(l=>l.media.port!=="0").map(l=>l.attributes.mid)}mungRecvMediaDsec(l,p,m){const E=Cn(l);return jb(E),Ff(E,p),Fb(E,p),IU(E),nT(E,m,this.localCapabilities.send),E}mungSendMediaDesc(l,p){const m=Cn(l);return nT(m,p,this.localCapabilities.recv),Bf(m),m}updateRecvMedia(l,p){const m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===l);if(m!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=E}}bumpMid(l){this.currentMidIndex+=l}findFirstClosedMedia(l){return this.sessionDesc.mediaDescriptions.find(p=>Nn()?p.media.port==="0"&&p.media.mediaType===l:p.media.port==="0")}findPreloadMediaDesc(l){return this.sessionDesc.mediaDescriptions.find(p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===l[0].ssrcId})}getSSRC(l){var p;return(p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l))===null||p===void 0?void 0:p.attributes.ssrcs}}(Ra(Ra({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!W("ENABLE_PRE_SUB_WITH_PRE_PC")||!W("PRE_USE_LOCAL_CODECS"))&&nb(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=PU(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),nb(this.store))if(t.preallocation&&W("ENABLE_PRE_SUB_WITH_PRE_PC")){const l=W("PRE_SUB_NUM"),{mids:p,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(l);await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(p,m)}else{const{preSSRCs:l=[]}=t,p=l.map(E=>E.ssrcMsg[0].ssrcId);if(l.length===0)return;const{mids:m}=this.remoteSDP.batchSend(l.map(E=>Object.assign({},E)));await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(p)),this.presetMedia(m,p)}}catch(i){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var n,r}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const o=s.receiver.track;let c;o.kind==="video"&&W("ENABLE_PRE_RENDER")&&(c=new mb({trackId:"track-".concat(o.kind,"-unknown-").concat(this.store.clientId,"_").concat(on(5,""))},!0),c.updateVideoTrack(o),c.onFirstVideoFrameRender=()=>{var l;const p=this.preMediaMap.get(n[i]);p&&(p.firstVideoRender=Date.now()),(l=this.onFirstVideoRender)===null||l===void 0||l.call(this,n[i])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:o,player:c,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const o=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||o}const{preSSRCs:i=[]}=t,s=i.map(o=>o.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const o=[],c=[];if(Array.from(this.preMediaMap.entries()).every(l=>{let[p,{mid:m,player:E,track:v}]=l;return o.push(m),c.push(p),this.preMediaMap.delete(p),E&&E.destroy(),!0}),o.length>0&&(this.remoteSDP.stopSending(o),await Od(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),qe.reportApiInvoke(this.store.sessionId,{name:xn.PRELOAD_MEDIA_FAILED,options:[i,c],tag:Tn.TRACER}).onSuccess()),i.length>0){const{mids:l}=this.remoteSDP.batchSend(i.map(p=>Object.assign({},p)));await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(l,s)}}n?(await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return Js(function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=$y();t.forEach(N=>{const j=i.peerConnection.addTransceiver(N._mediaStreamTrack,Ra({direction:"sendonly"},N.trackMediaType==="video"&&i.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));o.push(j),N._updateRtpTransceiver(j)}),Nn()&&W("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=yield jt(i.peerConnection.createOffer()),p=i.remoteSDP.predictReceivingMids(t.length),m=i.mungSendOfferSDP(l.sdp,t,p),E=Gi(m),v=p.map(N=>{const j=E.mediaDescriptions.find(V=>V.attributes.mid===N);if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return RU(j,W("USE_PUB_RTX"))});let y;try{y=yield v}catch(N){y=[],i.remoteSDP.receive(t,n,r,y);const j=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:j})),yield jt(i.stopSending(p,!0)),N}i.remoteSDP.receive(t,n,r,y);const D=i.remoteSDP.toString(),A=i.logSDPExchange(m,"offer","local","send");return yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t)),A?.(D),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:D})),o.map((N,j)=>{const V=p[j];return{localSSRC:v[j],id:V,transceiver:N}})}catch(o){throw o instanceof pe?o:new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof pe?r:new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof pe?n:new pe(F.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(l=>{var p;hT(this.id+l.mid,this),l.direction="inactive",(p=l.stop)===null||p===void 0||p.call(l)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);o&&(await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(o=>o.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(o=>{let[c,{mid:l,player:p}]=o;if(l===s)return this.preMediaMap.delete(c),p&&p.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(o,c)=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Js(function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration,s=W("FORCE_TURN_TCP")||n.forceTurn;if(t===Wr.RELAY&&!i)return;if(i&&!s){const E=t===Wr.RELAY?"relay":"all",v=n.peerConnection.getConfiguration();v.iceTransportPolicy!==E&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(E,"]")),v.iceTransportPolicy=E,n.peerConnection.setConfiguration(v))}n.remoteSDP.updateCandidates(t);const o=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Id(o.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const p=n.remoteSDP.toString(),m=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield jt(n.peerConnection.setLocalDescription(o)),m?.(p),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(i){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Wr.TCP_RELAY),await Od(this.peerConnection,this.remoteSDP,this.extension)}catch(n){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{hT(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ra(Ra({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new pe(F.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Ra(Ra({},vc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Ra(Ra({},vc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=Th(t.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Ig(t.turnServer.servers)?n.iceServers=t.turnServer.servers:W("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(W("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Mh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Mh.newTurnServerConfigToIceServers(t.turnServer.servers)),W("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Mh.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Mh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(wd(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!W("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const i=W("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(wd(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(wd(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n?.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const o=i.address+":"+i.port,c=s.address+":"+s.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Th(o)),", remote ").concat(JSON.stringify(Th(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(N=>N.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=function(A,N){return A.getTransceivers().find(j=>j.sender.track===N||j.receiver.track===N)}(this.peerConnection,t._mediaStreamTrack),l=NK(t);if(function(A){var N;return!(!W("ENABLE_AG_ADAPTATION")||!(A instanceof My||Ae(N=A._hints).call(N,rn.CUSTOM_TRACK))||!W("FORCE_SUPPORT_AG_ADAPTATION")&&!(eL(14,0,!1)&&tL(17,4)||$k(14)&&Pw(17,4,!0)))}(t)&&c&&n&&l&&this.getLocalVideoStats&&Ae(r=["vp8","vp9"]).call(r,this.store.codec)){var p;const A=s.degradationPreference||(Ae(p=t._hints).call(p,rn.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(N,j,V,G,$,Q){if(hT(N,V),$(j),G!=="balanced"&&G!=="maintain-framerate"&&G!=="maintain-resolution")return;let z=-1;r5(N,j);const re=window.setInterval(()=>{const ve=uT.get(N);if(!W("ENABLE_AG_ADAPTATION")||!ve)return hT(N,V),void $(j);const Re=Q();if(Re.sendPackets>0&&Re.OutgoingAvailableBandwidth>0){if(z===-1)return void(z=Date.now());if(Date.now()-z<1e3)return;const Ct=Re.sendFrameRate,bt=Re.OutgoingAvailableBandwidth,[ut,Yt]=Gz(N,Ct,bt,ve.adaptationConfig,j,G);Yt&&(V.qualityLimitationReason=Yt),ut&&ve.adaptationConfig.scale!==ut.scale&&(R.debug("[".concat(N,"] applyAdaptation: ").concat(V.qualityLimitationReason,`
           sendFps `).concat(Ct,", bwe ").concat(bt,", switch from ").concat(ve.adaptationConfig.scale," to ").concat(ut.scale," ")),ve.adaptationConfig=eI(eI({},ve.adaptationConfig),ut),$(ut))}},W("CHECK_LOCAL_STATS_INTERVAL")),fe=eI({},j);uT.set(N,{timer:re,adaptationConfig:fe,originConfig:j,adaptationFunc:$}),R.debug("[".concat(N,"] start adaptation, originConfig: ").concat(JSON.stringify(j),", degradationPreference: ").concat(G))})(this.id+c.mid,l,this,A,N=>{n&&this.updateAdaptation(n,N)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;const{bitrateMax:A,frameRate:N,scaleResolutionDownBy:j}=t._encoderConfig;A&&(o.maxBitrate=1e3*A),(Ae(m=t._hints).call(m,rn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(o.maxFramerate=as(N)),j&&j>=1&&(o.scaleResolutionDownBy=j))}const{maxFramerate:E}=W("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,E):E),W("DSCP_TYPE")&&dl()){var v;const A=W("DSCP_TYPE");Ae(v=["very-low","low","medium","high"]).call(v,A)&&(o.networkPriority=A)}const y=n.getParameters(),D=(i=y.encodings)===null||i===void 0?void 0:i[0];Nn()&&!D&&(s.encodings=[o]),D&&Object.assign(D,o),Object.assign(y,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await n.setParameters(y),await async function(A,N,j){try{var V;if(!Ft().supportSetRtpSenderParameters||!function(re){return re==="vp9"||re==="av1"}(A)||!W("ENABLE_SVC"))return;const G={},$={},Q=N.getParameters(),z=(V=Q.encodings)===null||V===void 0?void 0:V[0];$.scalabilityMode=$y(j),z&&Object.assign(z,$),Object.assign(Q,G),await N.setParameters(Q),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Q.encodings)))}catch(G){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",G)}}(this.store.codec,n,W("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return R.debug("[updateAdaptation] no rtpSender found");if(!Ft().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:l}=n;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=as(c)),l&&l>=1&&Ae(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=l);const p=t.getParameters(),m=(i=p.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,s),Object.assign(p,{});try{await t.setParameters(p),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof mn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Gi(t);return n.forEach((s,o)=>{const c=r[o],l=i.mediaDescriptions.find(p=>p.attributes.mid===c);l&&(Ff(l,s),AU(l,s,this.store.codec))}),yd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const p=t[l],m=n[l];if(m instanceof mn&&!Ae(r=m._hints).call(r,rn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,n){if(!Nn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof mn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof mn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ae(n=t._hints).call(n,rn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=Mh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ye(Mt.prototype,"updateRemoteRTPCapabilities",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteRTPCapabilities"),Mt.prototype),Ye(Mt.prototype,"connect",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"connect"),Mt.prototype),Ye(Mt.prototype,"updateRemoteConnect",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteConnect"),Mt.prototype),Ye(Mt.prototype,"createDataChannels",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"createDataChannels"),Mt.prototype),Ye(Mt.prototype,"receive",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"receive"),Mt.prototype),Ye(Mt.prototype,"batchReceive",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"batchReceive"),Mt.prototype),Ye(Mt.prototype,"stopReceiving",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"stopReceiving"),Mt.prototype),Ye(Mt.prototype,"muteRemote",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"muteRemote"),Mt.prototype),Ye(Mt.prototype,"unmuteRemote",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteRemote"),Mt.prototype),Ye(Mt.prototype,"muteLocal",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"muteLocal"),Mt.prototype),Ye(Mt.prototype,"unmuteLocal",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteLocal"),Mt.prototype),Ye(Mt.prototype,"close",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),Ye(Mt.prototype,"updateEncoderConfig",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateEncoderConfig"),Mt.prototype),Ye(Mt.prototype,"updateSendParameters",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateSendParameters"),Mt.prototype),Ye(Mt.prototype,"replaceTrack",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),Ye(Mt.prototype,"updateAdaptation",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateAdaptation"),Mt.prototype),Ye(Mt.prototype,"getRemoteSSRC",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"getRemoteSSRC"),Mt.prototype),Mt);function Ni(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function iI(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=as(t.width),r.height=as(t.height);const i=as(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=r.getContext("2d");if(!o)throw new ae(F.UNEXPECTED_ERROR,"can not get canvas context");const c=Ft(),l=r.captureStream(c.supportRequestFrame?0:i).getVideoTracks()[0];l.canvas||(l.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,E=n.videoHeight/m,v=r.width*E;Math.abs(v-r.height)>=2&&(R.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(v)),r.height=v)}o.drawImage(n,0,0,r.width,r.height),l.requestFrame&&l.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=lb(()=>r.startCapture&&r.startCapture(),i);const p=l.stop;return l.stop=()=>{p.call(l),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),R.debug("clean low stream renderer")},l}var c5=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(c5||{}),wa=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(wa||{}),mt=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(mt||{}),Ir=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(Ir||{}),Pi=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Pi||{}),fT=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(fT||{});const Rh=1e3,mT=6,qg=3,zz=Math.max(mT,qg,60);function it(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function l5(e){const t={[Pi.CONN_TYPE]:0,[Pi.RTT]:e.rtt,[Pi.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Pi.CONN_TYPE]=1),n==="tcp"&&(t[Pi.CONN_TYPE]=3),n==="tls"&&(t[Pi.CONN_TYPE]=4);break}case"srflx":t[Pi.CONN_TYPE]=2;break;case"unknown":t[Pi.CONN_TYPE]=5;break;default:t[Pi.CONN_TYPE]=0}return t}function d5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class u5 extends bn{constructor(t){super(),x(this,"store",void 0),x(this,"uploadWRTCStatsTimer",void 0),x(this,"uploadOutboundDenoiserStatsTimer",void 0),x(this,"uploadExtStatsTimer",void 0),x(this,"uploadExtUsageStatsTimer",void 0),x(this,"uploadInboundExtStatsTimer",void 0),x(this,"requestStats",void 0),x(this,"requestTransportStats",void 0),x(this,"requestLocalMedia",void 0),x(this,"requestRemoteMedia",void 0),x(this,"requestAllTracks",void 0),x(this,"requestVideoIsReady",void 0),x(this,"requestUploadStats",void 0),x(this,"requestUpload",void 0),x(this,"uploadOutboundStarted",!1),x(this,"uploadInboundStarted",!1),x(this,"uploadTransportStarted",!1),x(this,"uploadBaseStatsStarted",!1),x(this,"uploadExtensionUsageStarted",!1),x(this,"lastRecvStats",void 0),x(this,"lastSendStats",void 0),x(this,"lastRefRecvStats",void 0),x(this,"lastRefSendStats",void 0),x(this,"lastNormalRecvStats",void 0),x(this,"lastNormalSendStats",void 0),x(this,"lastExtendStats",{}),x(this,"needUploadStats",{}),x(this,"needUploadRenderFreezeTime",!0),x(this,"lastUploadCompensateTime",-1),x(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%qg==0,r=t%mT==0,i=t%60==0;let s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;const l={};if(this.uploadTransportStarted&&s){const m=this.getTransportStats(s,o,n);m&&(l.misc=[m])}if(this.uploadOutboundStarted&&s){const m=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);m&&(l.outbound=[m])}if(this.uploadInboundStarted&&o){this.uploadCompensateStats(t);const m=this.getInboundStats(o,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);m&&(l.inbound=m)}const p=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;p&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[fT.RTC_PEER_CONNECTION_STATE]=Yw[p]):l.misc=[{addition:{[fT.RTC_PEER_CONNECTION_STATE]:Yw[p]}}]),this.needUploadStats.sendType&&(Array.isArray(l.outbound)&&l.outbound[0]&&l.outbound[0].high&&(l.outbound[0].high[c5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(l)}this.lastRecvStats=o,this.lastSendStats=s,r&&(this.lastNormalRecvStats=o,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[fT.RTC_PEER_CONNECTION_STATE]:Yw[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===zz+1&&(t=1)},Rh)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%qg==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const o={};if(this.uploadInboundStarted&&s){const c=this.requestRemoteMedia()||[],l=[];c.forEach(p=>{let[m,E]=p;const v={peer:m.uid};if(m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)&&E.has(Be.VIDEO)&&m.videoTrack){const y=function(D,A,N){if(!A.videoRecv.find(V=>V.ssrc===D))return;const j={};if(N&&N._player){const V=N._player,{renderFreezeAccTime2:G,videoElementStatus:$}=V;if(Tc.visibility==="visible"&&$===Fr.PLAYING&&Ft().supportRequestVideoFrameCallback){const Q=Math.min(6e3,G);V.renderFreezeAccTime2=Math.max(0,G-Q),it(j,wa.Video_Render_Freeze_Time_Render2,Q),W("USE_NEW_RENDER_FREEZE_TIME")&&it(j,wa.Video_Render_Freeze_Time_Render,Q)}}return j}(m._videoSSRC,s,m.videoTrack);y&&(v.video=y)}v.video&&l.push(v)}),l.length>0&&(o.inbound=l,this.requestUploadStats(o))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[Pi.RTT]:t.rtt,[Pi.CONN_TYPE]:void 0,[Pi.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const i=l5(t);if(this.store.useP2P){if(n){const s=l5(n);i[Pi.CONN_TYPE]+=s[Pi.CONN_TYPE]<<3}i[Pi.CONN_TYPE]+=110}else i[Pi.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,l,p;return o.forEach(m=>{let[E,{track:v,ssrcs:y}]=m;switch(E){case Te.LocalVideoLowTrack:case Te.LocalVideoTrack:if(E===Te.LocalVideoTrack){var D;const A=function(G,$,Q,z,re,fe){const ve=$.videoSend.find(ut=>ut.ssrc===G);if(!ve)return;const Re={},{sentFrame:Ct,inputFrame:bt}=ve;if(z&&(it(Re,wa.Video_Send_Qp_Sum,ve.qpSumPerFrame),bt&&Ct)){const ut=bt.frameRate,Yt=Ct.frameRate;Re[wa.Video_Send_Freeze]=function(Ht,Hr){let Ee=!0;return Ee=!(Ht<=5)&&(Ht<=10?Hr<3:Ht<=20?Hr<4:Hr<5),Ee}(ut,Yt)?1:0}if(re){switch(Ct&&(it(Re,mt.Video_Send_Height,Ct.height),it(Re,mt.Video_Send_Width,Ct.width),it(Re,mt.Video_Send_Frame_Rate,Ct.frameRate)),Re[mt.Video_Send_Disabled]=Q._originMediaStreamTrack&&!Q._originMediaStreamTrack.enabled||Q._mediaStreamTrack&&!Q._mediaStreamTrack.enabled?1:0,ve.adaptionChangeReason){case"none":Re[mt.Video_Send_Adaptation]=0;break;case"cpu":Re[mt.Video_Send_Adaptation]=1;break;case"bandwidth":Re[mt.Video_Send_Adaptation]=2;break;case"other":Re[mt.Video_Send_Adaptation]=3}let ut=0;ve.adaptionChangeReason&&(ut+=d5(ve.adaptionChangeReason)),$.qualityLimitationReason&&(ut+=d5($.qualityLimitationReason)<<3),Re[mt.Video_Send_Adaptation]=ut,Re[mt.Video_Send_Player_Status]=ab[Q._player?Q._player.videoElementStatus:"uninit"],it(Re,mt.Video_Send_Nacks,ve.nacksCount),it(Re,mt.Video_Send_Plis,ve.plisCount),it(Re,mt.Video_Send_Firs,ve.firsCount),it(Re,mt.Video_Send_Avg_Encode,ve.avgEncodeMs),it(Re,mt.Video_Send_Huge_Frame_Sent,ve.hugeFramesSent),it(Re,mt.Video_Send_Bytes_Retransmit,ve.retransmittedBytesSent),it(Re,mt.Video_Send_Packages_Retransmit,ve.retransmittedPacketsSent),it(Re,mt.Video_Send_Key_Frames_Encoded,ve.keyFramesEncoded);const Yt=re.videoSend.find(Ht=>Ht.ssrc===G);if(Yt){let Ht=Rh*qg;Yt.timestamp&&ve.timestamp&&(Ht=ve.timestamp-Yt.timestamp),Yt.packets!=null&&ve.packets!=null&&it(Re,mt.Video_Send_Package_Rate,1e3*(ve.packets-Yt.packets)/Ht),ve.packetsLost!=null&&Yt.packetsLost!=null&&it(Re,mt.Video_Send_Package_Lost,ve.packetsLost-Yt.packetsLost),Yt.bytes!=null&&ve.bytes!=null&&it(Re,mt.Video_Send_Bitrate,8*(ve.bytes-Yt.bytes)/Ht)}}return Re}(y[0].ssrcId,t,v,n,r),N=v.__className__==="CameraVideoTrack"?3:Ae(D=v._hints).call(D,rn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==N||s)&&(this.needUploadStats={sendType:N},this.lastExtendStats.sendType=N);const j=v&&function(G,$,Q,z){const re=$.videoSend.find(ve=>ve.ssrc===G);if(!re)return null;const fe={};if(z){const ve=re.inputFrame,Re=ve&&ve.height||Q.videoHeight||0,Ct=ve&&ve.width||Q.videoWidth||0,bt=ve&&ve.frameRate||0;it(fe,mt.Video_Capture_Height,Re),it(fe,mt.Video_Capture_Width,Ct),it(fe,mt.Video_Capture_Frame_Rate,bt)}return fe}(y[0].ssrcId,t,v,!!r),V=function(G,$){const Q={};return $&&(it(Q,mt.Video_Send_Retransmit,G.bitrate.retransmit),it(Q,mt.Video_Send_Target_Encoded,G.bitrate.targetEncoded),it(Q,mt.Video_Send_Actual_Encoded,G.bitrate.actualEncoded),it(Q,mt.Video_Send_Transmit,G.bitrate.transmit),it(Q,mt.Video_Send_Bandwidth,G.sendBandwidth)),Q}(t,!!r);l=Object.assign({},A,j,V)}else p=function(A,N,j,V,G){const $=N.videoSend.find(z=>z.ssrc===A);if(!$)return;const Q={};if(V){const z=$.sentFrame;z&&(it(Q,mt.Video_Send_Low_Height,z.height),it(Q,mt.Video_Send_Low_Width,z.width),it(Q,mt.Video_Send_Low_Frame_Rate,z.frameRate));const re=V.videoSend.find(fe=>fe.ssrc===A);if(re){let fe=Rh*mT;re.timestamp&&$.timestamp&&(fe=$.timestamp-re.timestamp),re.packets!=null&&$.packets!=null&&it(Q,mt.Video_Send_Low_Package_Rate,1e3*($.packets-re.packets)/fe),$.packetsLost!=null&&re.packetsLost!=null&&it(Q,mt.Video_Send_Low_Package_Lost,$.packetsLost-re.packetsLost),re.bytes!=null&&$.bytes!=null&&it(Q,mt.Video_Send_Low_Bitrate,8*($.bytes-re.bytes)/fe)}}return Q}(y[0].ssrcId,t,0,r);break;case Te.LocalAudioTrack:c=v&&function(A,N,j,V,G,$){const Q=N.audioSend.find(re=>re.ssrc===A);if(!Q)return;const z={};if(G){z[mt.Audio_Send_Disabled]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const re=100*j._source.getAccurateVolumeLevel(),fe=Q.inputLevel;if(fe!=null){const Re=Math.ceil(50*Math.log10(100*fe+1));it(z,mt.Audio_Send_Level,Re)}it(z,mt.Audio_Capture_PCM_Level,re),it(z,mt.Audio_Send_AEC_Return_Loss,Q.aecReturnLoss),it(z,mt.Audio_Send_AEC_Return_Loss_Enhancement,Q.aecReturnLossEnhancement),it(z,mt.Audio_Send_Bytes_Retransmit,Q.retransmittedBytesSent),it(z,mt.Audio_Send_Packages_Retransmit,Q.retransmittedPacketsSent),z[mt.Audio_Send_Freeze]=0;const ve=G.audioSend.find(Re=>Re.ssrc===A);if(ve){let Re=Rh*mT;ve.timestamp&&Q.timestamp&&(Re=Q.timestamp-ve.timestamp),ve.bytes!=null&&Q.bytes!=null&&it(z,mt.Audio_Send_Bitrate,8*(Q.bytes-ve.bytes)/Re),ve.packets!=null&&Q.packets!=null&&it(z,mt.Audio_Send_Package_Rate,1e3*(Q.packets-ve.packets)/Re)}}return z}(y[0].ssrcId,t,v,0,r)}}),{high:l,low:p,audio:c}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],o=[];return s.forEach(c=>{let[l,p]=c;const m={peer:l.uid};if(p.has(Be.VIDEO)&&l.videoTrack){const E=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,v=l.videoTrack?function(y,D,A,N,j,V,G,$){const Q=D.videoRecv.find(ut=>ut.ssrc===y);if(!Q)return;const z={},{receivedFrame:re,outputFrame:fe,decodeFrameRate:ve}=Q;it(z,Ir.Video_Render_Frame_Rate_Decode,ve),Q.framesRateFirefox&&it(z,Ir.Video_Recv_Frame_Rate,Q.framesRateFirefox),re&&it(z,Ir.Video_Recv_Frame_Rate,re.frameRate),it(z,Ir.Video_Recv_Frame_Dropped,Q.framesDroppedCount),it(z,Ir.Video_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),it(z,Ir.Video_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),it(z,Ir.Video_Recv_Packages_Discarded,Q.packetsDiscarded),it(z,Ir.Video_Recv_Avg_Decode,Q.avgDecodeMs),it(z,Ir.Video_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs),it(z,Ir.Video_Recv_Avg_Assembly_Time,Q.avgFramesAssembledFromMultiplePacketsMs),it(z,Ir.Video_Recv_Avg_Inter_Frame_Delay,Q.avgInterFrameDelayMs),it(z,Ir.Video_Recv_Key_Frames_Decoded,Q.keyFramesDecoded);const Re=$&&$.videoRecv.find(ut=>ut.ssrc===y);if(Re){const ut=D.timestamp-$.timestamp||Rh;Q.packetsLost!=null&&Re.packetsLost!=null&&it(z,Ir.Video_Recv_Package_Lost,Q.packetsLost-Re.packetsLost),Re.bytes!=null&&Q.bytes!=null&&it(z,Ir.Video_Recv_Bitrate,8*(Q.bytes-Re.bytes)/ut),Re.packets!=null&&Q.packets!=null&&it(z,Ir.Video_Recv_Package_Rate,1e3*(Q.packets-Re.packets)/ut)}const Ct=V&&V.videoRecv.find(ut=>ut.ssrc===y);if(Ct&&(it(z,wa.Video_Recv_Qp_Sum,Q.qpSumPerFrame),z[wa.Video_Recv_Freeze]=N&&Yg.isRemoteVideoFreeze(A,Q,Ct)?1:0),G){var bt;const ut=G.videoRecv.find(Ht=>Ht.ssrc===y);re?(it(z,mt.Video_Recv_Height,re.height),it(z,mt.Video_Recv_Width,re.width)):A&&(it(z,mt.Video_Recv_Height,A._videoHeight||0),it(z,mt.Video_Recv_Width,A._videoWidth||0)),fe&&it(z,mt.Video_Recv_Frame_Rate_Output,fe.frameRate);const Yt=(bt=A._player)===null||bt===void 0?void 0:bt.rendFrameRate.toFixed(0);if(Yt&&it(z,mt.Video_Render_Frame_Rate_Render,+Yt),it(z,mt.Video_Recv_Jitter_Buffer,Q.jitterBufferMs),it(z,mt.Video_Recv_Current_Delay,Q.currentDelayMs),it(z,mt.Video_Recv_Firs,Q.firsCount),it(z,mt.Video_Recv_Nacks,Q.nacksCount),it(z,mt.Video_Recv_Plis,Q.plisCount),A){z[mt.Video_Recv_Disabled]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1;const Ht=A._player;if(Ht){const{freezeTimeCounterList:Hr,renderFreezeAccTime:Ee,renderFreezeAccTime2:Ne,videoElementStatus:He}=Ht;if(Hr&&Hr.length>0&&it(z,wa.Video_Render_Freeze_Time,Hr.splice(0,1)[0]),j&&Tc.visibility==="visible"&&He===Fr.PLAYING&&Ft().supportRequestVideoFrameCallback){const Se=Math.min(6e3,Ne);Ht.renderFreezeAccTime2=Math.max(0,Ne-Se),it(z,wa.Video_Render_Freeze_Time_Render2,Se);const b=Math.min(6e3,Ee);Ht.renderFreezeAccTime=Math.max(0,Ee-b),it(z,wa.Video_Render_Freeze_Time_Render,W("USE_NEW_RENDER_FREEZE_TIME")?Se:b)}if(typeof Q.totalFreezesDuration=="number"){const Se=ut&&ut.totalFreezesDuration?Q.totalFreezesDuration-ut.totalFreezesDuration:Q.totalFreezesDuration;it(z,mt.Video_Render_Freeze_Duration,1e3*Se)}}}if(z[mt.Video_Recv_Player_Status]=ab[A._player?A._player.videoElementStatus:"uninit"],ut&&Q.totalInterFrameDelay!==void 0&&Q.totalSquaredInterFrameDelay!==void 0&&ut.totalInterFrameDelay!==void 0&&ut.totalSquaredInterFrameDelay!==void 0){const Ht=Q.totalInterFrameDelay-ut.totalInterFrameDelay,Hr=Q.totalSquaredInterFrameDelay-ut.totalSquaredInterFrameDelay,Ee=Q.framesDecodeCount-ut.framesDecodeCount,Ne=Ht/Ee*1e3,He=Math.round(1e3*Math.sqrt((Hr-Math.pow(Ht,2)/Ee)/Ee));!isNaN(He)&&Ne+He>Math.max(3*Ne,Ne+150)&&(z[mt.Video_Recv_I_Frame_Delay]=He)}}return z}(l._videoSSRC,t,l.videoTrack,E===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;v&&(m.video=v)}if(p.has(Be.AUDIO)&&l.audioTrack){const E=l.audioTrack?function(v,y,D,A,N,j){const V=y.audioRecv.find(z=>z.ssrc===v);if(!V)return;const G={};it(G,Ir.Audio_Recv_Jitter,V.jitterMs),it(G,Ir.Audio_Recv_Bytes_Retransmit,V.retransmittedBytesReceived),it(G,Ir.Audio_Recv_Packages_Retransmit,V.retransmittedPacketsReceived),it(G,Ir.Audio_Recv_Packages_Discarded,V.packetsDiscarded),it(G,Ir.Audio_Recv_Avg_Processing_Delay,V.avgProcessingDelayMs);const $=j&&j.audioRecv.find(z=>z.ssrc===v);if($){const z=Rh;V.packets!=null&&$.packets!=null&&it(G,Ir.Audio_Recv_Package_Rate,1e3*(V.packets-$.packets)/z),V.packetsLost!=null&&$.packetsLost!=null&&it(G,Ir.Audio_Recv_Package_Lost,V.packetsLost-$.packetsLost)}if(A){const{receivedFrames:z,droppedFrames:re}=V;z!=null&&re!=null&&(G[wa.Audio_Recv_Freeze]=(Q=z)===0||100*re/Q>20?1:0)}var Q;if(N){const z=100*D._source.getAccurateVolumeLevel(),re=V.outputLevel;if(re!=null){const ve=Math.ceil(50*Math.log10(100*re+1));it(G,mt.Audio_Render_Level,ve)}it(G,mt.Audio_Recv_PCM_Level,z),D&&(G[mt.Audio_Recv_Disabled]=D._originMediaStreamTrack.enabled&&D._mediaStreamTrack.enabled?0:1),it(G,mt.Audio_Recv_Jitter_Buffer,V.jitterBufferMs),it(G,mt.Audio_Recv_Current_Delay,V.jitterBufferMs),G[mt.Audio_Recv_Player_Status]=ab[Oi.getPlayerState(D.getTrackId())];const fe=N.audioRecv.find(ve=>ve.ssrc===v);if(fe){fe.bytes!=null&&V.bytes!=null&&it(G,mt.Audio_Recv_Bitrate,8*(V.bytes-fe.bytes)/(Rh*qg));const ve=V.concealedSamples-fe.concealedSamples;ve>0&&it(G,mt.Audio_Recv_Concealed_Samples,ve);const Re=V.totalSamplesReceived-fe.totalSamplesReceived;Re>0&&it(G,mt.Audio_Recv_Total_Samples_Received,Re);const Ct=V.freezeSamples80-fe.freezeSamples80;Ct>0&&it(G,mt.Audio_Render_Freeze_Samples_80ms,Ct);const bt=V.freezeSamples200-fe.freezeSamples200;bt>0&&it(G,mt.Audio_Render_Freeze_Samples_200ms,bt);const ut=V.freezeMs80-fe.freezeMs80;it(G,mt.Audio_Render_Freeze_Time_80ms,ut<0?0:ut);const Yt=V.freezeMs200-fe.freezeMs200;it(G,mt.Audio_Render_Freeze_Time_200ms,Yt<0?0:Yt)}}return G}(l._audioSSRC,t,l.audioTrack,n,r,i):void 0;E&&(m.audio=E)}(m.video||m.audio)&&o.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof xg);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Ug.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(Be.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Be.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of s)!p.muted&&p.enabled&&(i=i.concat(await p.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,m]of o)m.has(Be.VIDEO)&&p.videoTrack&&(i=i.concat(await p.videoTrack.getProcessorUsage())),m.has(Be.AUDIO)&&p.audioTrack&&(i=i.concat(await p.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(p,m){const E={};for(const{id:A,value:N,level:j,direction:V}of p){var v;const G=(v=m.get(A))!==null&&v!==void 0?v:0,$=N===2?G+W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:G;var y,D;m.set(A,$),E[A]?(N===2&&(E[A].value=N),j>E[A].level&&(E[A].level=j),V==="remote"&&(E[A].remoteUidCount+=1),E[A].totalTs=(y=m.get(A))!==null&&y!==void 0?y:0):E[A]={value:N,level:j,remoteUidCount:V==="local"?0:1,totalTs:(D=m.get(A))!==null&&D!==void 0?D:0}}return Object.keys(E).map(A=>{const{level:N,value:j,totalTs:V}=E[A];return{id:A,level:N,value:j,totalTs:V}})}(i,t);const c=Date.now(),l=c>n?c:n+1;this.requestUpload&&this.requestUpload(Ug.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:l})},W("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Yz=W("ICE_RESTART_INTERVAL");let _T=new Map,Kf=new Map,Dd=[Wr.UDP_TCP_RELAY,Wr.TCP_RELAY,Wr.RELAY],sI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration;function h5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=_T.get(e.id);n&&(window.clearTimeout(n),_T.delete(e.id));const r=Kf.get(e.id);t&&r&&r.index===Dd.length-1&&(R.debug("[".concat(e.id,"] reset ICE restart policy")),Kf.delete(e.id))}function p5(e,t,n){if(_T.size===0&&Kf.size===0&&(Array.isArray(W("RESTART_SEQUENCE"))&&W("RESTART_SEQUENCE").length>0&&!function(c,l){if(c.length!==l.length)return!1;for(let p=0;p<c.length;p+=1){const m=c[p];if(c.filter(E=>E===m).length!==l.filter(E=>E===m).length)return!1}return!0}(Dd,W("RESTART_SEQUENCE"))&&(Dd=W("RESTART_SEQUENCE").filter(c=>{var l;if(Ae(l=Object.values(Wr)).call(l,c))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(Dd.join(" => ")))),sI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration),Dd.length===0)return void n();let r,{index:i=0,type:s}=Kf.get(e.id)||{};if(sI&&s===Wr.RELAY)return void n();let o=s&&i>=Dd.length-1;if(sI)s=Wr.RELAY;else{if(o)return void n();s?(i++,s=Dd[i]):(s=Dd[0],i=0)}R.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),Kf.set(e.id,{index:i,type:s}),r=window.setTimeout(()=>p5(e,t,n),Yz),_T.set(e.id,r)}var At;function f5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function wc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function m5(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=Sw,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new gT(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function gT(e){function t(n){if(Object(n)!==n)return je.reject(new TypeError(n+" is not an object."));var r=n.done;return je.resolve(n.value).then(function(i){return{value:i,done:r}})}return gT=function(n){this.s=n,this.n=n.next},gT.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?je.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?je.reject(n):t(r.apply(this.s,arguments))}},new gT(e)}let Xg=(At=class extends bn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(et.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",void 0),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"connection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"remoteDataChannelMap",new Map),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"pendingLocalDataChannels",[]),x(this,"pendingRemoteDataChannels",[]),x(this,"statsCollector",void 0),x(this,"shouldForwardP2PCreation",void 0),x(this,"iceFailedCount",0),x(this,"dtlsFailedCount",0),x(this,"mutex",void 0),x(this,"_state",Jt.Disconnected),x(this,"_pcStatsUploadType",W("NEW_ICE_RESTART")?fl.FIRST_CONNECTION:fl.OLD_FIRST_CONNECTION),x(this,"_isStartRestartIce",!1),x(this,"_restartTimer",void 0),x(this,"_isTryConnecting",!1),x(this,"_iceError",null),x(this,"_forceTurn",!1),x(this,"_isWaitPcToRePub",!1),x(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void r();const c=o.find(p=>p[0]==="videoLowTrack");if(c){const p=c[1];this.store.enableInstantMuteRestore?(p.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):p.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const l=this.createMuteMessage(o);await sn(this,et.RequestMuteLocal,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();const c=o.find(p=>p[0]==="videoLowTrack");if(c){const p=c[1];if(this.store.enableInstantMuteRestore)p.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(p.track._originMediaStreamTrack.stop(),!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}else{const m=iI(n,Ag(this,et.RequestLowStreamParameter));p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}await new je((m,E)=>{this.handleReplaceTrack(p.track,m,E,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const l=this.createUnmuteMessage(o);await sn(this,et.RequestUnmuteLocal,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let o;s||(o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==Jt.Connected)return void r();const{id:p,track:m}=l;await this.connection.updateSendParameters(p,m),await this.connection.updateEncoderConfig(p,m),this.emit(et.UpdateVideoEncoder,m),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}}),x(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Jt.Connected)return void r();const{id:c,track:l}=o;await this.connection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleReplaceMixingTrack",async(n,r,i,s)=>{if(!this.connection||this.state!==Jt.Connected)return void r();const o=nI([n]);let c;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),r()}catch(p){i(p)}finally{var l;(l=c)===null||l===void 0||l()}}),x(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.connection||!p||this.state!==Jt.Connected)return void r();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),this.isPlanB){const m=p[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],m)}if(p[0]===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const m=this.localTrackMap.get(Te.LocalVideoLowTrack);if(m){const E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new je((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}r()}catch(p){i(p)}finally{var l;(l=o)===null||l===void 0||l()}}),x(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new u5(this.store),this.bindStatsUploaderEvents(),this.mutex=new jr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ft().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dl(),this.shouldForwardP2PCreation=W("FORWARD_P2P_CREATION")&&Ft().supportPCSetConfiguration&&Lw(),this.shouldForwardP2PCreation&&(this.connection=pT(this.store),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Jt.New,this._forceTurn=o5(e),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=pT(this.store,e),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=W("NEW_ICE_RESTART")?fl.FIRST_CONNECTION:fl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Jt.Connected){if(this.connection instanceof no&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),qe.reportApiInvoke(this.store.sessionId,{name:xn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Tn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(et.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[o]=i;return Ae(s=[Te.LocalVideoLowTrack,Te.LocalVideoTrack]).call(s,o)}),n=t.map(i=>{let[,{id:s}]=i;return s}),r=t.map(i=>{let[s]=i;return s});if(this.connection instanceof no){if(qe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ae(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>Ae(e).call(e,s));i&&(this.store.codec=i,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof no&&this.connection.peerConnectionState!=="closed"&&Ae(e=[Jt.New,Jt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Jt.Connected){if(this.state===Jt.Disconnected)throw new pe(F.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;Ae(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var r=this;return Js(function*(){const i=yield jt(r.mutex.lock("From P2PChannel.publish"));try{var s;const o=r.connection&&Ae(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==Jt.Connected||o){if(r.state===Jt.Disconnected)throw new pe(F.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const l=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(l),void(o&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Gr.markPublishStart(r.store.clientId,r.store.pubId);const c=r.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));yield*ly(m5(r.doPublish(r.connection,c)))}finally{i()}})()}doPublish(e,t){var n=this;return Js(function*(){t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===Te.LocalAudioTrack?"audio":"video",A)}),n.bindLocalTrackEvents(t);const r=t.map(v=>{let{track:y}=v;return y}),i=yield jt(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield jt(i.next())).value,o=n.createGatewayPublishMessage(t,s);let c;try{c=yield o}catch(v){throw i.throw(v),v?.code===F.WS_ABORT&&t.forEach(y=>{let{track:D}=y;n.pendingLocalTracks.indexOf(D)===-1&&n.pendingLocalTracks.push(D)}),n.unbindLocalTrackEvents(t),v}const l=n.mapPubResToRemoteConfig(o,c,r),p=(yield jt(i.next(l))).value;if(n.state===Jt.Disconnected)throw new pe(F.UNEXPECTED_ERROR,"PeerConnection already disconnected.");W("ENABLE_VIDEO_SEI");const m=W("ENABLE_ENCODED_TRANSFORM"),E=W("ENABLE_AUDIO_METADATA");r.forEach(async v=>{const y=v.getRTCRtpTransceiver();if(!y||!m)return;const{interceptLocalVideoFrame:D,interceptLocalAudioFrame:A}=iT();v.trackMediaType===Be.VIDEO?await D(y.sender,v):v.trackMediaType===Be.AUDIO&&await A(y.sender,{metadata:E?()=>{const N=v.metadata.shift();return N&&N.value}:void 0})}),t.forEach(v=>{let{type:y}=v;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(t,p),n.statsUploader.startUploadOutboundStats(),t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===Te.LocalAudioTrack?"audio":"video",void 0,A)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof mn))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(s,o){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=Vb(s,o)),c.maxFramerate=s.framerate?as(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Te.LocalVideoLowTrack||!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return R.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,c){const l=o.canvas;c.width&&(l.width=as(c.width)),c.height&&(l.height=as(c.height)),c.framerate&&(l.stopCapture&&l.stopCapture(),l.stopCapture=lb(()=>{!l.startCapture&&l.stopCapture&&l.stopCapture(),l.startCapture&&l.startCapture()},as(c.framerate)))})(s,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),R.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return Js(function*(){if(!t.connection||t.state!==Jt.Connected)return;const n=yield jt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(Te.LocalVideoTrack);if(!i)throw new pe(F.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Te.LocalVideoLowTrack))throw new pe(F.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:Te.LocalVideoLowTrack}];if(yield*ly(m5(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var r;const o=(r=t.localTrackMap.get(Te.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield jt(t.connection.muteLocal([o])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Dr(this,et.RequestRePublish,this.pendingLocalTracks),this.emit(et.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Dr(this,et.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==Be.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Be.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Dr(this,et.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Be.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(et.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Jt.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Jt.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Jt.Connected)return;const e=this.localTrackMap.get(Te.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Te.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:s}]=r;return{type:i,track:s}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Jt.Connected)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:c,id:l}=o;return c.uid===e.uid&&l===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==Jt.Connected)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,c,l,p;const m=this.connection.getPreMedia(n);if(m)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),l=m.transceiver,o=m.track,c=m.mid,p=m.player,m.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:m.firstVideoRender});else if(i){const y=i.find(A=>{let{stream_type:N}=A;return N===t});if(!y)throw new pe(F.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const D=await this.connection.receive(t,y.ssrcs,String(e._uintid),y.attributes);this.connection instanceof no&&(l=D.transceiver),o=D.track,c=D.id}else{const y=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof no&&(l=y.transceiver),o=y.track,c=y.id}if(t===Be.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new Df(o,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new Pf(o,e.uid,e._uintid,this.store,p),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once($s.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once($s.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),p?e._videoTrack.once($s.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once($s.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack)),l&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:D}=iT();t==Be.VIDEO?await y(l.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(A=>{var N;return(N=e._videoTrack)===null||N===void 0?void 0:N._onSei(A)})}):t==Be.AUDIO&&await D(l.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:A=>{this.safeEmit(et.AudioMetadata,A)},onPts:A=>{this.safeEmit(et.AudioPts,A)}})}const E=this.remoteUserMap.get(e);E?E.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:D,kind:A}=y;return D.uid===e.uid&&t===A});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(et.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Jt.Connected)throw new pe(F.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var s;let{user:o,mediaType:c}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))});const t=[],n=new Map;e.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);if(s){const{track:o,mid:c,transceiver:l,player:p}=s;n.set(i.ssrcId,{track:o,id:c,transceiver:l,player:p})}else t.push(i)});const r=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:l}=i;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:l}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{n.set(i.ssrcId,r[s])});for(const{user:i,mediaType:s,ssrcId:o}of e){const c=n.get(o);if(!c)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(o));const{track:l,id:p,transceiver:m,player:E}=c;if(m&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:A}=iT();s==Be.VIDEO?await D(m.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(N=>{var j;return(j=i._videoTrack)===null||j===void 0?void 0:j._onSei(N)})}):s==Be.AUDIO&&await A(m.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:N=>{this.safeEmit(et.AudioMetadata,N)},onPts:N=>{this.safeEmit(et.AudioPts,N)}})}if(s===Be.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(l):(i._audioTrack=new Df(l,i.uid,i._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),m&&i._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(l):(i._videoTrack=new Pf(l,i.uid,i._uintid,this.store,E),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),m&&i._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._videoTrack)),W("ENABLE_VIDEO_SEI")&&m){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:A}=iT();s==Be.VIDEO?await D(m.receiver,{onSei:N=>{var j;(j=i._videoTrack)===null||j===void 0||j._onSei(N)}}):s==Be.AUDIO&&await A(m.receiver)}const v=this.remoteUserMap.get(i);v?v.set(s,p):this.remoteUserMap.set(i,new Map([[s,p]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(D=>{let{user:A,kind:N}=D;return A.uid===i.uid&&s===N});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(et.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:l}=o;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid});if(r.forEach(o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.connection&&this.state===Jt.Connected||n||r.forEach(o=>{let{kind:c}=o;var l;if(c===Be.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===Be.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Jt.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(o=>{let[,{id:c}]=o;return c}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[c,{kind:l}]=o;var p,m;if(l===Be.VIDEO&&c._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Be.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((m=c._videoTrack)===null||m===void 0||m._destroy(),c._videoTrack=void 0);else if(l===Be.AUDIO){var E;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((E=c._audioTrack)===null||E===void 0||E._destroy(),c._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(o=>o.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const o=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:p}=c;return s!==void 0?l.uid===i.uid&&s===p:l.uid===i.uid});o.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),t=t.concat(o)}if(!this.connection||this.state!==Jt.Connected)return void t.forEach(i=>{let{user:s,kind:o}=i;var c;if(o===Be.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===Be.VIDEO){var l;(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0}});const n=Ui(e).call(e,(i,s)=>{let{user:o,mediaType:c}=s;const l=this.filterTobeUnSubscribedTracks(o,c);return i.concat(l)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:s}]=i;return s}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[s,{kind:o}]=i;var c,l;if(o===Be.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Be.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0;else if(o===Be.AUDIO){var p;this.unbindRemoteTrackEvents(s._audioTrack),(p=s._audioTrack)===null||p===void 0||p._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==Jt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Be.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Te.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t?.track instanceof $n){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Te.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Te.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Te.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Te.LocalAudioTrack),c=r?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(l=>l instanceof Ln),c=r?(s=this.localTrackMap.get(Te.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof mn);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Be.VIDEO?n._videoSSRC:n._audioSSRC;i&&qe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Be.VIDEO,audio:r===Be.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Gr.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new jr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=pT(this.store),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e?.track instanceof $n){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Jt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof mn||t&&t.track instanceof Ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=nh(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=pT(this.store),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Te.LocalVideoTrack:Ae(t=r._hints).call(t,rn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Te.LocalAudioTrack:r instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Te.LocalVideoLowTrack:}}),this.emit(et.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(et.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Js(function*(){if(!t.connection||t.state!==Jt.Connected)return;const n=yield jt(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield jt(t.connection.restartICE(e));const s=yield jt(r.next());if(s.done)return;const o=s.value,c=yield o;switch(rI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Wr.UDP_TCP_RELAY:t._pcStatsUploadType=fl.UDP_TCP_RESTART;break;case Wr.TCP_RELAY:t._pcStatsUploadType=fl.TCP_RESTART;break;case Wr.RELAY:t._pcStatsUploadType=fl.RELAY_RESTART;break;default:t._pcStatsUploadType=fl.OLD_RESTART}t._isTryConnecting=!0,r.next(c)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalAudioTrack),r=e.videoSend.find(y=>y.ssrc===t?.ssrcs[0].ssrcId),i=e.audioSend.find(y=>y.ssrc===n?.ssrcs[0].ssrcId);if(!r||!i)return 1;const s=Ts(this,et.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,p=(l&&s?(l+s)/2:l||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t?.track;if(v&&v._encoderConfig&&v._hints.indexOf(rn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return tU[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===i),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const l=Ts(this,et.NeedSignalRTT),p=e.rtt,m=(p&&l?(p+l)/2:p||l)||0,E=o?o.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;E&&(y=.6*v*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new je((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Jt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const s=this.localTrackMap.get(Te.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new je((c,l)=>{this.handleReplaceTrack(s.track,c,l,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=Ef(e=e.filter(l=>i.indexOf(l)===-1));let s,o=!1;const c=this.localTrackMap.get(Te.LocalAudioTrack);for(const l of e){if(l instanceof mn&&(this.localTrackMap.has(Te.LocalVideoTrack)||o?new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Te.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(l,n);r.push({track:p,type:Te.LocalVideoLowTrack})}if(l instanceof Ln)if(c){const p=c.track;if(p instanceof $n)tI([l]),p.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0);else{const m=nI([p,l]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(p,m)}}else s instanceof $n?(tI([l]),s.addAudioTrack(l)):s||!l._useAudioElement&&Ft().webAudioMediaStreamDest&&!l._bypassWebAudio?s=nI(s?[l,s]:[l]):s=l}return s&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:Te.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Ef(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Ln){const i=this.localTrackMap.get(Te.LocalAudioTrack);if(!i)continue;i.track instanceof $n?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,i]),i.track.close())):t.push([Te.LocalAudioTrack,i])}if(r instanceof mn){const i=this.localTrackMap.get(Te.LocalVideoTrack);if(!i)continue;t.push([Te.LocalVideoTrack,i]);const s=this.localTrackMap.get(Te.LocalVideoLowTrack);s&&t.push([Te.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Ef(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ef(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.addListener(Ke.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ke.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof $n?e.trackList.forEach(n=>{n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ke.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.off(Ke.GET_STATS,this.handleGetLocalVideoStats),n.off(Ke.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof $n?e.trackList.forEach(t=>{t.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ke.GET_STATS,this.handleGetLocalAudioStats),t.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ke.GET_STATS,this.handleGetLocalAudioStats),e.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ke.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Pf&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Df&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ke.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Be.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Be.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,o,{track:c,type:l}=n;switch(l){case Te.LocalAudioTrack:s=Qt.Audio,o={dtx:c instanceof xg&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Te.LocalVideoTrack:s=Ae(i=c._hints).call(i,rn.SCREEN_TRACK)?Qt.Screen:Qt.High,o=wc(wc({},gU(c)),{},{codec:this.store.codec,svc_mode:$y()});break;case Te.LocalVideoLowTrack:s=Qt.Low,o=wc(wc({},gU(c)),{},{codec:this.store.codec,svc_mode:$y()})}return{stream_type:s,attributes:o,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(et.PeerConnectionStateChange,t),t==="connecting"&&e instanceof no&&!Nn()&&W("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},W("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof no&&h5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=fl.DISCONNECTED_OR_FAILED,Ts(this,et.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));qe.reportApiInvoke(this.store.sessionId,{name:xn.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:Tn.TRACER}).onSuccess(),this.republish()}if(W("NEW_ICE_RESTART")&&e instanceof no&&!Nn()&&!this._forceTurn){if(Ae(uU).call(uU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=i=>{rI(e)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Ts(this,et.QueryClientConnectionState)==="CONNECTED"&&this.emit(et.RequestRestartICE,i))},r=()=>{rI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{p5(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&W("ICE_RESTART")&&Ts(this,et.QueryClientConnectionState)==="CONNECTED"&&this.emit(et.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(et.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit($s.FIRST_FRAME_DECODED),qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===t);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(et.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return wc(wc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof no&&function(t){Kf.delete(t.id),h5(t)}(e),e.close(),this.emit(et.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive||t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===Te.LocalVideoTrack)){const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive&&t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===Te.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Be.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Be.VIDEO,ssrcId:r._videoSSRC}));case Be.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Be.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let s=t.get(r);i===Be.VIDEO?s|=ur.Video:s|=ur.Audio,t.set(r,s)}else i===Be.VIDEO?t.set(r,ur.Video):t.set(r,ur.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new je((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new je((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof no&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof no&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((r,i)=>{var s;let{stream_type:o}=r;const c=(s=t.find(l=>{let{stream_type:p}=l;return o===p}))===null||s===void 0?void 0:s.attributes;if(c&&W("DISABLE_SCREEN_SHARE_REMB")){const l=n[i]._hints;(Ae(l).call(l,rn.SCREEN_TRACK)||Ae(l).call(l,rn.SCREEN_LOW_TRACK))&&(c.remb=!1,R.debug("disable remb for screen share, hints:",l))}return c})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Ln){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(s=>{let[,{id:o}]=s;return o})));const i=this.createUnmuteMessage(r);return void await sn(this,et.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(et.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(et.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rr(Ww(this.dtlsFailedCount,qn)),this.emit(et.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Dr(this,et.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(et.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof mn).length>1)throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ln).length>1&&(e.some(t=>t instanceof Ln&&t._bypassWebAudio)||!Ft().webAudioMediaStreamDest))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof mn&&this.pendingLocalTracks.some(n=>n instanceof mn))throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ln&&this.pendingLocalTracks.some(n=>n instanceof Ln)&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ln&&n._bypassWebAudio)))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,i=wc(wc({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():iI(e,i);const o=on(8,"track-low-"),c=new mn(s,wc(wc({},r&&{scaleResolutionDownBy:Vb(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(mh.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,wf.LOW_STREAM)}),c._hints.push(rn.LOW_STREAM),Ae(n=e._hints).call(n,rn.SCREEN_TRACK)&&c._hints.push(rn.SCREEN_LOW_TRACK),e.on("sei-to-send",l=>{c.emit("sei-to-send",l)}),e.addListener(Ke.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof no){var i,s,o,c;const l=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:m,peerConnectionState:E}=this.connection,{local:v,remote:y}=await this.connection.getSelectedCandidatePair();qe.pcStats(this.store.sessionId,{startTime:l,eventElapse:e-l||0,iceconnectionsate:p,dtlsstate:m,connectionstate:E,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=v?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=v.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:(o=y.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=y.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(m=>m.userId===e.uid);if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:o,peerPublishDuration:c,peerPubStatusMs:l}=n;let{firstRender:p=0}=n;if(s&&(p||o)&&c&&l){n.isInternalUpload=!0;const{playEnd:m}=n;m&&(n.isExternalUpload=!0);const{firstPreRender:E=0}=n;p=E||p;const v=e.videoTrack,y={peer:e._uintid,width:v?._videoWidth||0,height:v?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:l,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:E||0,firstRender:m?Math.max(p,m):Math.max(p,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:BL(this.store)};qe.firstXLAPeerFirstVideoFrame(this.store.sessionId,y)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(l=>l.userId===s.uid&&l.type==="video");qe.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Te.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,wf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ye(At.prototype,"startP2PConnection",[si],Object.getOwnPropertyDescriptor(At.prototype,"startP2PConnection"),At.prototype),Ye(At.prototype,"connect",[si],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),Ye(At.prototype,"updateRemoteRTPCapabilities",[si],Object.getOwnPropertyDescriptor(At.prototype,"updateRemoteRTPCapabilities"),At.prototype),Ye(At.prototype,"publishDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"publishDataChannel"),At.prototype),Ye(At.prototype,"unpublish",[si],Object.getOwnPropertyDescriptor(At.prototype,"unpublish"),At.prototype),Ye(At.prototype,"unpublishDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"unpublishDataChannel"),At.prototype),Ye(At.prototype,"unpublishLowStream",[si],Object.getOwnPropertyDescriptor(At.prototype,"unpublishLowStream"),At.prototype),Ye(At.prototype,"subscribeDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"subscribeDataChannel"),At.prototype),Ye(At.prototype,"subscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"subscribe"),At.prototype),Ye(At.prototype,"massSubscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"massSubscribe"),At.prototype),Ye(At.prototype,"unsubscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribe"),At.prototype),Ye(At.prototype,"unsubscribeDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribeDataChannel"),At.prototype),Ye(At.prototype,"massUnsubscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"massUnsubscribe"),At.prototype),Ye(At.prototype,"muteRemote",[si],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),Ye(At.prototype,"unmuteRemote",[si],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),Ye(At.prototype,"hasRemoteMediaWithLock",[si],Object.getOwnPropertyDescriptor(At.prototype,"hasRemoteMediaWithLock"),At.prototype),Ye(At.prototype,"disconnectForReconnect",[si],Object.getOwnPropertyDescriptor(At.prototype,"disconnectForReconnect"),At.prototype),Ye(At.prototype,"updateBitrateLimit",[si],Object.getOwnPropertyDescriptor(At.prototype,"updateBitrateLimit"),At.prototype),Ye(At.prototype,"remoteMediaSsrcChanged",[si],Object.getOwnPropertyDescriptor(At.prototype,"remoteMediaSsrcChanged"),At.prototype),At);function si(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function _5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function g5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const qz=Date.now(),Xz=20,oI=new Map,ET=new Map;async function E5(e){const t=oI.get(e),n=Array.isArray(t)&&t[t.length-1],r=ET.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let c=n.mediaDelay+o;c<=0?(t.pop(),v5(n.context,i),c=0):c=Math.min(c,Xz),setTimeout(()=>t.length&&E5(e),c)}function v5(e,t){e.safeEmit(Nt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Jz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return v5(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=oI.get(r)||[],s=i.findIndex(p=>e.sendTs>=p.sendTs),o=g5(g5({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),oI.set(r,i);let c=!1;var l;ET.has(r)?c=!((l=ET.get(r))===null||l===void 0||!l.isSyncing):ET.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||E5(r)}const Qz=xt().name;function S5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function y5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const zf="websdk_ng_cache_parameter",Zz=W("MAX_PRELOAD_ASYNC_LENGTH"),$z=1e4,wh=new Map,bh=[];let aI=null,cI=0,lI=0;const vT=new Map,eY=function(e,t){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new je(async(l,p)=>{n.push(async()=>{try{const m=await e(...o);l(m)}catch(m){p(m)}}),r<t&&(r++,i())})}}(T5,Zz),dI=Ai.CancelToken.source();async function T5(e,t,n,r,i,s){try{if(!W("ENABLE_PRELOAD"))return;if(!Ft().supportWebCrypto)return void vd(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new pe(F.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Cr(n,"token",1,2047),Cr(e,"appid",1,2047),Yy(t),r&&qy(r);const o=ph();R.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:o,proxyServer:i};let l,p;typeof r=="string"?(c.stringUid=r,[p,l]=await je.all([Uz(r,{sid:o,appId:e},dI.token),qU(y5(y5({},c),{},{token:n||e,uid:0}),dI.token)]),c.uid=p.uid,l.gatewayInfo.uid=c.uid,l.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),l=await qU(c,dI.token));const m={sid:o,appId:e,cname:t,token:n||e,uid:c.stringUid||r,intUid:c.uid||l.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:p,ap:l};await async function(E){let v;try{E.uid&&R5({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});const y=A5(E),D=await async function(N,j){try{const V=await window.crypto.subtle.importKey("raw",fL(j),"AES-GCM",!1,["encrypt"]),G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},V,hh(window.btoa(JSON.stringify(N))));return Sd(new Uint8Array(G))}catch{return}}(E,E.token||E.appId);if(!D)return;v=I5(zf);const A=v?JSON.parse(v):[];A.push({[y]:D}),A.length>W("AP_CACHE_NUM")&&A.shift(),ST(zf,JSON.stringify(A))}catch(y){R.warn("Error caching server parameters:",y.message),ST(zf,"")}}(m),cI++}catch(o){throw lI++,function(c){aI||(aI=window.setTimeout(()=>{let p="";vT.forEach((m,E)=>{p+="".concat(E,": ").concat(m," ;")}),qe.reportApiInvoke(null,{name:xn.PRELOAD,options:{success:cI,failed:lI,err:p}}).onError(c),cI=0,lI=0,vT.clear(),aI=null},$z));const l=vT.get(c.code)||0;vT.set(c.code,l+1)}(o),o}}async function C5(e){try{if(W("AP_REQUEST_DETAIL")||W("ENABLE_ROLE_SELECT_EDGE"))return;const t=R5(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",fL(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,hh(r));return JSON.parse(window.atob(Sd(new Uint8Array(o))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<W("AP_CACHE_LIFETIME"))return n}catch(t){R.warn("Error get preloadInfo",t.message)}}function R5(e){let t;try{if(t=I5(zf),!t)return;const n=JSON.parse(t),r=A5(e),i=function(o,c){for(let l=o.length-1;l>=0;l--)if(c(o[l]))return l;return-1}(n,o=>r in o);if(i===-1)return;const s=n.splice(i,1)[0];return ST(zf,JSON.stringify(n)),s[r]}catch(n){R.warn("Error delete preload info: ".concat(t),n.message),ST(zf,"")}}function uI(e){if(e){let t=wh.get(e);t&&(window.clearTimeout(t),t=null,wh.delete(e)),Ae(bh).call(bh,e)||e.cloudProxyServer!=="disabled"||bh.push(e)}if(wh.size<W("AP_CACHE_NUM")&&bh.length>0){const t=bh.shift();wh.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:o,proxyServer:c}=t;try{await eY(n,r,i,o,c,s),wh.has(t)&&uI(t)}catch(l){R.warn("update preload failed",l.message),w5(t)}},W("AP_UPDATE_INTERVAL")))}}function w5(e){const t=bh.indexOf(e);t!==-1&&bh.splice(t,1);let n=wh.get(e);n&&(window.clearTimeout(n),n=null,wh.delete(e),uI())}function b5(e,t){const n=e.sua,r=e.ap;t&&n&&qe.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),qe.reportResourceTiming(e.ap.url,e.sid),qe.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[Hn.CHOOSE_SERVER,Hn.CLOUD_PROXY_FALLBACK].toString()}),qe.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function I5(e){return window.atob(window.localStorage.getItem(e)||"")}function ST(e,t){window.localStorage.setItem(e,window.btoa(t))}function A5(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),yL(t)}function tY(e){let t=function(){const n=iY.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(Kn(r,10),kd(r,i));let s=n.cid;s!==void 0&&(Kn(r,16),Kn(r,s));let o=n.cname;o!==void 0&&(Kn(r,26),kd(r,o));let c=n.deviceId;c!==void 0&&(Kn(r,34),kd(r,c));let l=n.elapse;l!==void 0&&(Kn(r,40),Ld(r,l));let p=n.fileSize;p!==void 0&&(Kn(r,48),Ld(r,Yf(p)));let m=n.height;m!==void 0&&(Kn(r,56),Ld(r,Yf(m)));let E=n.jpg;E!==void 0&&(Kn(r,66),Kn(r,E.length),N5(r,E));let v=n.networkType;v!==void 0&&(Kn(r,72),Ld(r,Yf(v)));let y=n.osType;y!==void 0&&(Kn(r,80),Ld(r,Yf(y)));let D=n.requestId;D!==void 0&&(Kn(r,90),kd(r,D));let A=n.sdkVersion;A!==void 0&&(Kn(r,98),kd(r,A));let N=n.sequence;N!==void 0&&(Kn(r,104),Ld(r,Yf(N)));let j=n.sid;j!==void 0&&(Kn(r,114),kd(r,j));let V=n.timestamp;V!==void 0&&(Kn(r,120),Ld(r,V));let G=n.uid;G!==void 0&&(Kn(r,128),Kn(r,G));let $=n.vid;$!==void 0&&(Kn(r,136),Kn(r,$));let Q=n.width;Q!==void 0&&(Kn(r,144),Ld(r,Yf(Q)));let z=n.service;z!==void 0&&(Kn(r,152),Kn(r,z));let re=n.callbackData;re!==void 0&&(Kn(r,162),Kn(r,re.length),N5(r,re));let fe=n.ticket;fe!==void 0&&(Kn(r,170),kd(r,fe));let ve=n.vendorConfigs;ve!==void 0&&(Kn(r,178),kd(r,ve))}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function nY(e){return function(n){let r={};e:for(;!sY(n);){let i=Jg(n);switch(i>>>3){case 0:break e;case 1:r.code=Jg(n);break;case 2:r.msg=P5(n,Jg(n));break;case 3:r.requestId=P5(n,Jg(n));break;case 4:r.timestamp=oY(n,!1);break;default:rY(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function rY(e,t){switch(t){case 0:for(;128&Wo(e););break;case 2:hI(e,Jg(e));break;case 5:hI(e,4);break;case 1:hI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Yf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let iY=[];function hI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function sY(e){return e.offset>=e.limit}function yT(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function O5(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function N5(e,t){let n=yT(e,t.length);e.bytes.set(t,n)}function P5(e,t){let n=O5(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,p,m,E,v=i[c+n];(128&v)==0?o+=r(v):(224&v)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&v)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&v)==224?c+2>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],(49344&(l|p<<8))!=32896?o+=s:(E=(15&v)<<12|(63&l)<<6|63&p,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&v)==240?c+3>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],m=i[c+n+3],(12632256&(l|p<<8|m<<16))!=8421504?o+=s:(E=(7&v)<<18|(63&l)<<12|(63&p)<<6|63&m,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function kd(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}Kn(e,r);let i=yT(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function Wo(e){return e.bytes[O5(e,1)]}function D5(e,t){let n=yT(e,1);e.bytes[n]=t}function Jg(e){let t,n=0,r=0;do t=Wo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Kn(e,t){for(t>>>=0;t>=128;)D5(e,127&t|128),t>>>=7;D5(e,t)}function oY(e,t){let n,r=0,i=0,s=0;return n=Wo(e),r=127&n,128&n&&(n=Wo(e),r|=(127&n)<<7,128&n&&(n=Wo(e),r|=(127&n)<<14,128&n&&(n=Wo(e),r|=(127&n)<<21,128&n&&(n=Wo(e),i=127&n,128&n&&(n=Wo(e),i|=(127&n)<<7,128&n&&(n=Wo(e),i|=(127&n)<<14,128&n&&(n=Wo(e),i|=(127&n)<<21,128&n&&(n=Wo(e),s=127&n,128&n&&(n=Wo(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function Ld(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=yT(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}const k5={},L5={},TT=4294967296,aY=TT*TT,x5=aY/2;U5(0,!0);const M5=U5(0),cY=Qg(0,-2147483648,!1),lY=Qg(-1,2147483647,!1);function U5(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=L5[e],r)?r:(n=Qg(e,0,!0),i&&(L5[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=k5[e],r)?r:(n=Qg(e,e<0?-1:0,!1),i&&(k5[e]=n),n)}function Qg(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function V5(e,t){if(isNaN(e))return M5;{if(e<=-x5)return cY;if(e+1>=x5)return lY}return e<0?M5:Qg(e%TT|0,e/TT|0,t)}function j5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class pI extends bn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Ta.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),x(this,"name","AgoraRTCImageModeration"),x(this,"_connectionState",to.CONNECTING),x(this,"_sequence",0),x(this,"_moderationStartTime",void 0),x(this,"_workerConnection",void 0),x(this,"_workerMessageLengthLimit",void 0),x(this,"_qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Ai.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"_moderationInterval",void 0),x(this,"_moderationTimer",null),x(this,"_moderationMode",1),x(this,"_quality",1),x(this,"_qualityTimer",null),x(this,"_ticket",void 0),x(this,"_moderationIntervalMinimum",void 0),x(this,"_uploadFailedNum",0),x(this,"_uploadNum",0),x(this,"_uploadTimer",null),x(this,"_extraInfo",void 0),x(this,"_vendor",""),x(this,"_encoder",new TextEncoder),x(this,"_moderationId",void 0),x(this,"inspectImage",()=>{if(this.connectionState!==to.CONNECTED)throw new ae(F.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===to.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=on(5,"image-moderation-"),this._workerMessageLengthLimit=W("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=W("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=W("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Fg("worker-"+this._moderationId,qn),this.on(Ta.STATE_CHANGE,(r,i)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Mf[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Ta.STATE_CHANGE,Mf.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new je((i,s)=>{this.on(Ta.CONNECTION_STATE_CHANGE,(o,c)=>{o===to.CONNECTED&&i()}),this.requestAP(t,r,n).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===to.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=W("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,p,m,E){let{appId:v,areaCode:y,cname:D,sid:A,token:N,uid:j}=p;Wf++;const V="moderation_plugin",G={service_name:V,json_body:JSON.stringify({appId:v,areaCode:y,cname:D,command:"allocateEdge",requestId:Wf,seq:Wf,sid:A,appToken:N,ts:Date.now(),uid:j+""})};let $,Q,z=l[0];return Ea(async()=>{$=Date.now();const re=await Ca(z,{data:G,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-$,re.code!==0){const Re=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+re.code,{retry:!0,responseTime:Q});throw R.error(Re.toString()),Re}const fe=JSON.parse(re.json_body);if(fe.code!==200){const Re=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(fe.code,", reason: ").concat(fe.reason),{code:fe.code,responseTime:Q});throw R.error(Re.toString()),Re}if(!fe.servers||!Array.isArray(fe.servers)||fe.servers.length===0){const Re=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:fe.code,responseTime:Q});throw R.error(Re.toString()),Re}if(!fe.servers.some(Re=>!!Re.wss)){const Re=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:fe.code,responseTime:Q});throw R.error(Re.toString()),Re}const ve=W("IMAGE_MODERATION_WORKER_HOST");return{addressList:fe.servers.map(Re=>{let{address:Ct,wss:bt}=Re;if(Ct&&bt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(ve,":").concat(bt,"/moderation")}).filter(Re=>!!Re),workerToken:fe.workerToken,vid:fe.vid,ticket:fe.appTicket,responseTime:Q}},(re,fe)=>(qe.apworkerEvent(A,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(re.addressList),firstSuccess:fe===0,responseTime:Q,serverIp:l[fe%l.length]}),!1),(re,fe)=>(qe.apworkerEvent(A,{success:!1,sc:re.data&&re.data.code||200,serviceName:V,responseTime:Q,serverIp:l[fe%l.length]}),!!(re.code!==F.OPERATION_ABORTED&&re.code!==F.UNEXPECTED_RESPONSE||re.data&&re.data.retry)&&(z=l[(fe+1)%l.length],!0)),E)}(i,t,n,r);this.emit(Ta.STATE_CHANGE,Mf.AP_CONNECTED);const{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(t){this.emit(Ta.STATE_CHANGE,Mf.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(vt.CONNECTED,async()=>{this.emit(Ta.STATE_CHANGE,Mf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=to.CONNECTED}),this._workerConnection.on(vt.CLOSED,()=>{this.connectionState=to.CLOSED}),this._workerConnection.on(vt.FAILED,()=>{this.connectionState=to.CLOSED}),this._workerConnection.on(vt.RECONNECTING,()=>{this.connectionState=this.connectionState===to.CONNECTED?to.RECONNECTING:to.CONNECTING}),this._workerConnection.on(vt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=nY(new Uint8Array(t.data));W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{qe.reportApiInvoke(this._connectInfo.sid||null,{name:xn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Tn.TRACER}).onError(new ae(F.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},W("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ts(this,Ta.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await dx(m,r,i),v=this._sequence+"-"+s+"-"+l+"-"+p+"-"+on(12,""),y={appId:r,cid:s,cname:i,deviceId:"",elapse:pI.intToLong(Number(p-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:V5(p),uid:l,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const D=tY(y);if(D.byteLength<this._workerMessageLengthLimit){if(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(N){for(var j=1;j<arguments.length;j++){var V=arguments[j]!=null?arguments[j]:{};j%2?j5(Object(V),!0).forEach(function(G){x(N,G,V[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(V)):j5(Object(V)).forEach(function(G){Object.defineProperty(N,G,Object.getOwnPropertyDescriptor(V,G))})}return N}({},y);delete A.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return D}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ai.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=to.CLOSED,this.emit(Ta.STATE_CHANGE,Mf.CLOSED)}}function F5(e){if(nn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ae(F.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ae(F.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const dY={name:"ImageModeration",create:function(e){let{config:t}=e;return F5(t),new pI(t)}};var B5,W5,G5,H5,K5,z5,Y5,q5,X5,J5,Q5,Z5,$5,eV,tV,nV,rV,iV,sV,oV,aV,cV,lV,dV,uV,hV,pV,fV,mV,_V,gV,EV,vV,SV,yV,TV,CV,RV,wV,bV,IV,Fe;function AV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Go(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AV(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}jr.setLogger(R);let uY=(B5=ot(),W5=ot({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Af))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),G5=ot({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==If.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),H5=ot({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),K5=ot({argsMap:(e,t,n)=>[t,n]}),z5=ot({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r?.uid,i]})}),Y5=ot({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),q5=ot({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r?.uid,mediaType:i}})}),X5=ot(),J5=ot(),Q5=ot(),Z5=ot(),$5=ot(),eV=ot(),tV=ot(),nV=ot(),rV=ot(),iV=ot(),sV=ot(),oV=ot(),aV=ot(),cV=ot(),lV=ot(),dV=ot({argsMap:(e,t)=>[t]}),uV=ot(),hV=ot(),pV=ot(),fV=ot(),mV=ot(),_V=ot(),gV=ot(),EV=ot(),vV=ot({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),SV=ot(),yV=ot(),TV=ot(),CV=ot(),RV=ot(),wV=ot(),bV=ot({reportResult:!0}),IV=ot(),Fe=class extends bn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),x(this,"store",void 0),x(this,"_uid",void 0),x(this,"_channelName",void 0),x(this,"_uintUid",void 0),x(this,"_users",[]),x(this,"_config",void 0),x(this,"_clientId",void 0),x(this,"_appId",void 0),x(this,"_sessionId",null),x(this,"_key",void 0),x(this,"_rtmConfig",{}),x(this,"_joinInfo",void 0),x(this,"_gateway",void 0),x(this,"_statsCollector",void 0),x(this,"_configDistribute",void 0),x(this,"_leaveMutex",void 0),x(this,"_publishMutex",void 0),x(this,"_renewTokenMutex",void 0),x(this,"_subscribeMutex",void 0),x(this,"_encryptionMode","none"),x(this,"_encryptionSecret",null),x(this,"_encryptionSalt",null),x(this,"_encryptDataStream",!1),x(this,"_encryptDataStreamKey",null),x(this,"_encryptDataStreamIv",null),x(this,"_proxyServer",void 0),x(this,"_turnServer",{servers:[],mode:"auto"}),x(this,"_cloudProxyServerMode","disabled"),x(this,"_isDualStreamEnabled",!1),x(this,"_defaultStreamFallbackType",void 0),x(this,"_lowStreamParameter",void 0),x(this,"_streamFallbackTypeCacheMap",new Map),x(this,"_remoteStreamTypeCacheMap",new Map),x(this,"_axiosCancelSource",Ai.CancelToken.source()),x(this,"_audioVolumeIndicationInterval",void 0),x(this,"_networkQualityInterval",void 0),x(this,"_userOfflineTimeout",void 0),x(this,"_streamRemovedTimeout",void 0),x(this,"_liveTranscodeStreamingClient",void 0),x(this,"_liveRawStreamingClient",void 0),x(this,"_channelMediaRelayClient",void 0),x(this,"_networkQualitySensitivity","normal"),x(this,"_p2pChannel",void 0),x(this,"_useLocalAccessPoint",!1),x(this,"_setLocalAPVersion",void 0),x(this,"_joinAndNotLeaveYet",!1),x(this,"_numberOfJoinCount",0),x(this,"_joinResponse",null),x(this,"_remoteDefaultVideoStreamType",void 0),x(this,"_inspect",void 0),x(this,"_moderation",void 0),x(this,"_license",void 0),x(this,"_pendingPublishedUsers",[]),x(this,"ntpAlignErrorCount",0),x(this,"remoteInboundOffset",0),x(this,"_peerConnectionState",void 0),x(this,"_handleLocalTrackEnable",(i,s,o)=>{this.publish(i,!1).then(s).catch(o)}),x(this,"_handleLocalTrackDisable",(i,s,o)=>{this.unpublish(i).then(s).catch(o)}),x(this,"_handleUserOnline",i=>{if(W("BLOCK_LOCAL_CLIENT")&&yh(i.uid,this.channelName))return void R.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(o=>o.uid===i.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Nt.USER_JOINED,s));else{const o=new Pd(i.uid,i.uint_id||i.uid);this._users.push(o),R.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.safeEmit(Nt.USER_JOINED,o)}}),x(this,"_handleUserOffline",i=>{if(W("BLOCK_LOCAL_CLIENT")&&yh(i.uid,this.channelName))return;const s=this._users.find(o=>o.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:Ty(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),R.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Nt.USER_LEAVED,s,i.reason))}),x(this,"_handleAddAudioOrVideoStream",(i,s,o,c,l,p,m,E)=>{if(W("BLOCK_LOCAL_CLIENT")&&yh(s,this.channelName))return;const v=this._users.find(D=>D.uid===s);if(!v)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(v.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(v.uid,{videoAddNotify:Date.now()});const y=i==="audio"?v.hasAudio:v.hasVideo;if(v._uintid||(v._uintid=p||s),i==="audio"?v._trust_audio_stream_added_state_=!0:v._trust_video_stream_added_state_=!0,i==="audio"?(v._audio_added_=!0,o!==void 0&&(v._audioSSRC=o),c!==void 0&&(v._cname=c),m&&(v._audioOrtc=m)):(v._video_added_=!0,o!==void 0&&(v._videoSSRC=o),c!==void 0&&(v._cname=c),E!==void 0&&(v._rtxSsrcId=E),m&&(v._videoOrtc=m)),(i==="audio"?v.hasAudio:v.hasVideo)&&!y&&(R.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,v,i)),i==="video"?qe.onGatewayStream(this._sessionId,sr.ON_ADD_VIDEO_STREAM,yn.ON_ADD_VIDEO_STREAM,{peer:p||s,ssrc:v._videoSSRC}):qe.onGatewayStream(this._sessionId,sr.ON_ADD_AUDIO_STREAM,yn.ON_ADD_AUDIO_STREAM,{peer:p||s,ssrc:v._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(v,i,o).then(D=>{if(D&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Xg))return this._p2pChannel.unsubscribe(v,i,!0).then(()=>this._subscribe(v,i,!0).catch(A=>{R.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(v,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after reconnect.")),this._subscribe(v,i,!0).catch(D=>{R.error("[".concat(this._clientId,"] resubscribe error"),D.toString())})),i==="video"&&!Nr()&&!qr()){const D=this._getEncodingName(l);D?.toLocaleLowerCase()==Dg.av1&&Mz().then(A=>{A||this._gateway.downgradeCodec(D)})}}),x(this,"_handleRemoveStream",i=>{if(W("BLOCK_LOCAL_CLIENT")&&yh(i.uid,this.channelName))return;const s=this._users.find(c=>c.uid===i.uid);if(!s)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let o=()=>{};s.hasAudio&&s.hasVideo?o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Xg&&this._p2pChannel.unsubscribe(s).then(c=>{if(c)return this._gateway.unsubscribe(c,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),qe.onGatewayStream(this._sessionId,sr.ON_REMOVE_STREAM,yn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),o()}),x(this,"_handleSetStreamLocalEnable",(i,s,o)=>{if(W("BLOCK_LOCAL_CLIENT")&&yh(s,this.channelName))return;const c=this._users.find(m=>m.uid===s);if(!c)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(o?"enabled":"disabled"," with uid ").concat(s));const l=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;const m=c._audio_enabled_;if(c._audio_enabled_=o,c._audio_enabled_===m)return;{const E=c._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}else{c._trust_video_enabled_state_=!0;const m=c._video_enabled_;if(c._video_enabled_=o,c._video_enabled_===m)return;{const E=c._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}const p=i==="audio"?c.hasAudio:c.hasVideo;return l!==p?!l&&p?(R.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(Nt.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),R.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(Nt.USER_UNPUBLISHED,c,i)):void 0}),x(this,"_handleMuteStream",(i,s,o)=>{if(W("BLOCK_LOCAL_CLIENT")&&yh(i,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),i,s,o);const c=this._users.find(m=>m.uid===i);if(!c)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const l=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;const m=c._audio_muted_;if(c._audio_muted_=o,c._audio_muted_===m)return;{const E=c._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}else{c._trust_video_mute_state_=!0;const m=c._video_muted_;if(c._video_muted_=o,c._video_muted_===m)return;{const E=c._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}const p=s==="audio"?c.hasAudio:c.hasVideo;if(l!==p){if(!l&&p)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(Nt.USER_PUBLISHED,c,s)):void R.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),R.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(Nt.USER_UNPUBLISHED,c,s)}}),x(this,"_handleP2PLost",async i=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),x(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),x(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),x(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Nt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Nt.NETWORK_QUALITY,i)}),x(this,"_handleP2PAddAudioOrVideoStream",(i,s,o,c)=>{const l=this._users.find(m=>m.uid===s);if(!l)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(l.uid,i,void 0,void 0,void 0,Date.now());const p=i==="audio"?l.hasAudio:l.hasVideo;i==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,i==="audio"?(l._audio_added_=!0,o!==void 0&&(l._audioSSRC=o),c!==void 0&&(l._audioMid=c)):(l._video_added_=!0,o!==void 0&&(l._videoSSRC=o),c!==void 0&&(l._videoMid=c)),(i==="audio"?l.hasAudio:l.hasVideo)&&!p&&(R.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,l,i)),this._p2pChannel.hasPendingRemoteMedia(l,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,i,!0).catch(m=>{R.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=t||on(5,"client-"),this.store=new class{constructor(i,s,o,c){pt(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:o,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:fh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=function(s,o){switch(o.type){case ft.SET_SESSION_ID:return we(we({},s),{},{sessionId:o.sessionId});case ft.SET_P2P_ID:return we(we({},s),{},{p2pId:o.p2pId});case ft.SET_UID:return we(we({},s),{},{uid:o.uid});case ft.SET_INT_UID:return we(we({},s),{},{intUid:o.intUid});case ft.SET_PUB_ID:return we(we({},s),{},{pubId:o.pubId});case ft.KEY_METRIC_CLIENT_CREATED:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{clientCreated:o.metric})});case ft.KEY_METRIC_JOIN_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinStart:o.metric})});case ft.KEY_METRIC_PRELOAD_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{preloadStart:o.metric})});case ft.KEY_METRIC_PRELOAD_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{preloadEnd:o.metric})});case ft.KEY_METRIC_JOIN_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinEnd:o.metric})});case ft.KEY_METRIC_REQUEST_AP_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestAPStart:o.metric})});case ft.KEY_METRIC_REQUEST_AP_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestAPEnd:o.metric})});case ft.KEY_METRIC_REQUEST_SUA_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestSUAEnd:o.metric})});case ft.KEY_METRIC_BEFORE_CONNECT:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{beforeConnect:o.metric})});case ft.KEY_METRIC_PEER_RECEIVER:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerReceiver:o.metric})});case ft.KEY_METRIC_SIGNAL_CONNECTED:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{signalConnected:o.metric})});case ft.KEY_METRIC_JOIN_REQ:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinReq:o.metric})});case ft.KEY_METRIC_JOIN_REP:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinRep:o.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinGatewayStart:o.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinGatewayEnd:o.metric})});case ft.KEY_METRIC_PEER_CONNECTION_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerConnectionStart:o.metric})});case ft.KEY_METRIC_PEER_CONNECTION_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerConnectionEnd:o.metric})});case ft.KEY_METRIC_DESCRIPTION_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{descriptionStart:o.metric})});case ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{signalChannelOpen:o.metric})});case ft.KEY_METRIC_ICE_CONNECTION_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{iceConnectionEnd:o.metric})});case ft.KEY_METRIC_PUBLISH:{const c=s.keyMetrics.publish,l=c.findIndex(p=>p.trackId===o.metric.trackId);return l!==-1?(c[l]=we(we({},c[l]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{publish:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,o.metric]})})}case ft.KEY_METRIC_SUBSCRIBE:{const c=s.keyMetrics.subscribe,l=c.findIndex(p=>p.userId===o.metric.userId&&p.type===o.metric.type);return l!==-1?(c[l]=we(we({},c[l]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{subscribe:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,o.metric]})})}case ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const c=s.keyMetrics.firstVideoFrameDecoded,l=c.findIndex(p=>p.userId===o.metric.userId);return l!==-1?(c[l]=we(we({},c[l]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,o.metric]})})}case ft.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case ft.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=o.mode,s;case ft.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,o.record]:(s.joinChannelServiceRecords[o.index]=we(we({},s.joinChannelServiceRecords[o.index]),o.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case ft.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case ft.SET_USE_P2P:return we(we({},s),{},{useP2P:o.val});case ft.SET_TRANSPORT_TYPE:return we(we({},s),{},{p2pTransport:o.val});default:return s}}(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:ft.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:ft.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:ft.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:ft.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:ft.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:ft.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:ft.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:ft.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:ft.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ft.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ft.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ft.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ft.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ft.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:we({userId:i},s)})}descriptionStart(){this.dispatch({type:ft.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,o,c){this.dispatch({type:ft.KEY_METRIC_PUBLISH,metric:we(we({trackId:i,type:s},o&&{publishStart:o}),c&&{publishEnd:c})})}subscribe(i,s,o,c,l,p,m){this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:we(we(we(we(we({userId:i,type:s},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),l&&{firstFrame:l}),p&&{streamAdded:p}),m&&{firstDecoded:m})})}massSubscribe(i,s,o,c){i.forEach(l=>{this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:we(we(we({userId:l.userId,type:l.type},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:we(we({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ft.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ft.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new jr("client-leave",this._clientId),this._publishMutex=new jr("client-publish",this._clientId),this._renewTokenMutex=new jr("client-renewtoken",this._clientId),this._subscribeMutex=new jr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Qs," build: ").concat(Zw,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{jw(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){R.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new Yg(this.store),this._statsCollector.onStatsException=(i,s,o)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(o)),i===Qb.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(c=>{c instanceof My&&W("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()}),this.safeEmit(Nt.EXCEPTION,{code:i,msg:s,uid:o})},this._statsCollector.onUploadPublishDuration=(i,s,o,c)=>{const l=this._users.find(p=>p.uid===i);l&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(l._uintid,{peerPublishDuration:o,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(l)),qe.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:o,peer:l._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(W("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const s=this.localTracks.find(o=>o instanceof mn);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?W("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Nz(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||qn,httpRetryConfig:e.httpRetryConfig||qn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Bz(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},ml("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Xg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];$t("JOIN_GATEWAY_USE_443PORT_ONLY",s),$t("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const c=this._gateway.signal.websocket;return c instanceof Mb&&(c.use443PortOnly=s,c.tryDoubleDomain=o),async function(l,p,m){gy.get(l)||gy.set(l,[]),Ey.get(l)||Ey.set(l,p),gc.get(l)||gc.set(l,0);const E=gy.get(l),v=Ey.get(l);if(!E||!v)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(gc.get(l)===v){const j=Cg();E.push(j),await j.promise}gc.set(l,gc.get(l)+1);for(var y=arguments.length,D=new Array(y>3?y-3:0),A=3;A<y;A++)D[A-3]=arguments[A];const N=await m(...D);return gc.set(l,gc.get(l)-1),gc.get(l)===v-1&&E.length>0&&(E[0].resolve(),E.shift()),gc.get(l)===0&&(gy.set(l,[]),Ey.set(l,0),gc.set(l,0)),N}("client.join",W("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(wy||wy||(wy=(window.location.protocol.split(":")[0]||"").toUpperCase(),wy))==="HTTPS",c=RL()?window.isSecureContext:"Browser Not Support";(!RL()&&!o||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let l;qe.setAppId(e);try{if(!n&&n!==null)throw new ae(F.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Cr(n,"token",1,2047),Cr(e,"appid",1,2047),Yy(t),r&&qy(r),i)if(typeof i=="string")Cr(i,"optionalInfo",1,256),l=i;else{if(typeof i!="object")throw new ae(F.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:N,enableInstantMuteRestore:j}=i;N&&(ga(N,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(N)),this.store.autoSubscribe=N),j&&(ga(j,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(j)),this.store.enableInstantMuteRestore=j)}}}catch(N){throw qe.reportApiInvoke(ph(),{name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}).onError(N),N}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const N=new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw qe.reportApiInvoke(ph(),{name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}).onError(N),N}this._gateway.state="CONNECTING",this.store.preloadStart();const p=await C5({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const m=p?.sid||ph();R.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);const E=qe.reportApiInvoke(m,{id:this._clientId,name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}),v=Go(Go(Go({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!p},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:W("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(v.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(v.stringUid=r,this._uintUid?(v.uid=this._uintUid,this._uintUid=void 0):v.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(v.aesmode=this._encryptionMode,v.aespassword=await(async N=>{const j=function(Q){const z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),re=new Uint8Array(new ArrayBuffer(z.length));for(let fe=0;fe<z.length;fe+=1)re[fe]=z.charCodeAt(fe);return re}(),V=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),G=Uw(N),$=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},V,G);return function(Q){let z="";for(let re=0;re<Q.length;re+=1)z+=String.fromCharCode(Q[re]);return window.btoa(z)}(new Uint8Array($))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(v.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const N=new TextEncoder,j=W("USE_PURE_ENCRYPTION_MASTER_KEY")?N.encode(v.appId+this._encryptionSecret+this._encryptionSecret):N.encode(v.appId+v.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(V,G,$){const Q=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=V==="aes-128-gcm2"?128:256,re=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:LL,hash:"SHA-256",salt:$},Q,z+oK);return new Uint8Array(re).subarray(z/8)}(this._encryptionMode,j,hh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(V,G,$){const Q=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=V==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:LL,hash:"SHA-256",salt:$},Q,{name:"AES-GCM",length:z},!0,["encrypt","decrypt"])}(this._encryptionMode,j,hh(this._encryptionSalt))}else c?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:v.stringUid});const y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&qe.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let N;const j=v.cloudProxyServer;if(Ae(D=["proxy3","proxy4","proxy5"]).call(D,j)){const z=W("PROXY_SERVER_TYPE3");Array.isArray(z)?v.proxyServer=z[0]:v.proxyServer=z}if(qe.setProxyServer(v.proxyServer),R.setProxyServer(v.proxyServer),this.store.requestAPStart(),p){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(v.stringUid?", ".concat(v.stringUid," => ").concat(p.intUid):""," ")),v.stringUid&&!v.uid&&(v.uid=p.intUid),N={gatewayInfo:p.ap.gatewayInfo},W("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&v.turnServer.mode==="auto")if(p.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const z=(await vU(p.ap.proxyInfo,p.ap.gatewayInfo.uid)).map(re=>({turnServerURL:re.address,tcpport:re.tcpport||kr.tcpport,udpport:re.udpport||kr.udpport,username:re.username||kr.username,password:re.password||kr.password,forceturn:!1,security:!0}));v.turnServer={mode:"manual",servers:z}}b5(p,v.stringUid)}else{if(v.stringUid&&!v.uid){let z;[z,N]=await je.all([YU(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store).finally(()=>{this.store.requestSUAEnd()}),zU(v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(v.stringUid," => ").concat(z)),v.uid=z,N.gatewayInfo.uid=z,N.gatewayInfo.res.uid=z}else N=await zU(v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(v,this._axiosCancelSource.token),this._configDistribute.on(Vg.UPDATE_BITRATE_LIMIT,z=>{this._p2pChannel.updateBitrateLimit(z)}),this._configDistribute.on(Vg.UPDATE_CLIENT_ROLE_OPTIONS,z=>{this._setClientRoleOptions(z)})},0),this._key=n||e;const V=N.gatewayInfo,G=v.uid?v.uid:V.uid;this._joinInfo=Go(Go({},v),{},{cid:V.cid,uid:G,vid:V.vid,apResponse:V.res,apGatewayAddress:V.apGatewayAddress,uni_lbs_ip:V.uni_lbs_ip,gatewayAddrs:V.gatewayAddrs}),this.store.intUid=G,this.store.cid=V.cid;const $=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess($),this._appId=e,this._channelName=v.cname,this._uid=$,this.store.uid=$,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Q=v.stringUid?"string uid: ".concat(v.stringUid,",uid: ").concat(v.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Q)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),A=this,Ae(Sh).call(Sh,A)||Sh.push(A),this._cloudProxyServerMode==="disabled"&&Ft().supportWebCrypto&&W("ENABLE_PRELOAD")&&uI(this._joinInfo),$}catch(N){const j=Array.isArray(N)?N[0]:N;throw j&&j.code===F.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),j):R.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),j),j.code!==F.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(j),j}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new ae(F.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!W("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Sh.indexOf(t);n!==-1&&Sh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Xt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Af))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ae(F.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new ae(F.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof Af))throw new ae(F.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new ae(F.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof mn&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),R.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw R.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new ae(F.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));nn(e.id,"id",0,65535,!0),ga(e.ordered,"ordered"),Cr(e.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new ae(F.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ae(F.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return UU(i,!1)}(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ae(F.CREATE_DATACHANNEL_ERROR);try{await je.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==F.DISCONNECT_P2P)throw i}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw R.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Af))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Vn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw R.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Pd)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new ae(F.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(ir(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ae(F.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Be.AUDIO,r=t===Be.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:c,cname:l,uint_id:p}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new ae(F.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(v=>v.uid===e);m||(m=new Pd(e,p||e),m._is_pre_created=!0,this._users.push(m)),l&&(m._cname=l),m._uintid||(m._uintid=p||e),n&&(m._audioSSRC=s,m._audio_pre_subscribed=!0,o&&(m._audioOrtc=o)),r&&(m._videoSSRC=s,m._video_pre_subscribed=!0,o&&(m._videoOrtc=o),c!=null&&(m._rtxSsrcId=c)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(m,t,s,c,o);const E=n?m._audioTrack:m._videoTrack;if(!E)throw new ae(F.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),r&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),E}catch(s){throw R.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var n;if(nn(t,"channelId",0,65535,!0),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ae(F.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ae(F.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(c=>c.id===t);if(!i)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(e,[i]);if(c&&Ae(c).call(c,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ae(F.CREATE_DATACHANNEL_ERROR);const l={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await i._waitTillOpen()}catch(l){if(l?.code!==F.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),l;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){const s=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new ae(F.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,o,c)}catch(o){throw o}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new ae(F.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new ae(F.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Be.AUDIO:Be.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const l=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==i&&(i=m,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Be.AUDIO:Be.VIDEO,ssrcId:i}),Gr.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,c,!0)}catch(E){if(E?.code!==F.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),E;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m?.code,e,t),m}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new ae(F.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),p}catch(p){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{l()}}async massSubscribe(e){if(ul(e,"subscribeList"),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(c=>{let{user:l,mediaType:p}=c;return"user: ".concat(l?.uid,", mediaType: ").concat(p)}).join("; ")));const i=(e=[...e]).map(c=>{let{user:l,mediaType:p}=c;return{user:l,mediaType:p}}),s=await this._p2pChannel.globalLock();try{var o;for(let l=e.length-1;l>=0;l--){const p=e[l],{user:m,mediaType:E}=p;if(ir(E,"mediaType",["audio","video"]),!m){const A=new ae(F.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===m)){const A=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),i[l].error=A,e.splice(l,1);continue}if(E==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||E==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const A=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(E,", remote user is not published")),i[l].error=A,e.splice(l,1);continue}const y=ur.Video|ur.LwoVideo,D=n.get(m);if(D){if(E==="video"?D&y:D&ur.Audio){e.splice(l,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(E," twice"));continue}n.set(m,D|(E==="video"?y:ur.Audio))}else n.set(m,E==="video"?y:ur.Audio)}for(let l=e.length-1;l>=0;l--){const p=e[l],{user:m,mediaType:E}=p,v=ur.Video|ur.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,E)){await this._p2pChannel.unmuteRemoteNoLock(m,E);const y=n.get(m);n.set(m,E==="video"?y^v:y^ur.Audio),e.splice(l,1)}}this.store.massSubscribe(e.map(l=>({userId:l.user.uid,type:l.mediaType})),t);let c=Ui(o=Array.from(n.entries())).call(o,(l,p)=>{let[m,E]=p;if(E===0)return l;const v={stream_id:m.uid,stream_type:E};return E&ur.Audio&&(v.audio_ssrc=m._audioSSRC),E&ur.Video&&(v.video_ssrc=m._videoSSRC),l.push(v),l},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(p=>{let{user:m,mediaType:E}=p;return{user:m,mediaType:E,ssrcId:E===Be.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:E===Be.VIDEO?m._rtxSsrcId:void 0}}));const l=new Map;if(c=c.filter(p=>p.video_ssrc&&!this._p2pChannel.isPreSubScribe(p.video_ssrc)||p.audio_ssrc&&!this._p2pChannel.isPreSubScribe(p.audio_ssrc)||!p.video_ssrc&&!p.audio_ssrc),c.length>0){const p=await this._gateway.subscribeAll(c,!0);(p?.users||[]).forEach(m=>{let{stream_id:E,video_error_code:v,audio_error_code:y,error_code:D}=m;(v||y||D)&&l.set(E,{video_error_code:v,audio_error_code:y,error_code:D})})}if(Array.from(l.entries()).length>0){const p=[];Array.from(l.entries()).forEach(m=>{let[E,v]=m;const y=this.remoteUsers.find(D=>D.uid===E);if(y){let D;v.error_code||v.video_error_code&&v.audio_error_code?D=void 0:v.video_error_code?D=Be.VIDEO:v.audio_error_code&&(D=Be.AUDIO),p.push({user:y,mediaType:D})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of i){const m=l.get(p.user.uid);if(m){const E=m.error_code||p.mediaType==="audio"&&m.audio_error_code||p.mediaType==="video"&&m.video_error_code;if(E){const v=jg(E);R.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(v.desc)),p.error=new ae(F.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(v.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(i.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),i.forEach(p=>{var m;qe.subscribe(this.store.sessionId,{succ:!!p.error,ec:((m=p.error)===null||m===void 0?void 0:m.code)||null,video:p.mediaType===Be.VIDEO,audio:p.mediaType===Be.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===Be.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(p.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(p=>{let{user:m,mediaType:E}=p;return"user: ".concat(m?.uid,", mediaType: ").concat(E)}).join("; "))),i}catch(l){throw await this._p2pChannel.massUnsubscribeNoLock(e),l}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Pd)){const s=this.remoteUsers.find(o=>o.uid===e);if(!s)throw new ae(F.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Ty(this._users,e),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===F.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&nn(t,"id",0,65535,!0),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(s=>s.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===F.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(ul(e,"unsubscribeList"),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const c=new ae(F.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(ir(i,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===r)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=ur.Video|ur.LwoVideo;if(t.has(r)){const c=t.get(r);let l;switch(i){case"video":l=c&o;break;case"audio":l=c&ur.Audio;break;default:l=c&(ur.Audio|o)}if(l){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,c|ur.Audio):i==="video"&&t.set(r,c|o):t.set(r,c|ur.Audio|o)}else i?i==="audio"?t.set(r,ur.Audio):i==="video"&&t.set(r,o):t.set(r,ur.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i?.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===F.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new pe(F.INVALID_PARAMS);Pn(n.width)||xw(n.width,"streamParameter.width"),Pn(n.height)||xw(n.height,"streamParameter.height"),Pn(n.framerate)||xw(n.framerate,"streamParameter.framerate"),Pn(n.bitrate)||nn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Te.LocalVideoLowTrack)}async enableDualStream(){if(!Ft().supportDualStream)throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ae(F.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ae(F.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Te.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){ir(r,"role",["audience","host"])}(e),t&&jw(t),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ae(F.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ae(F.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ae(F.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&W("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Pr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),R.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&jw(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Cr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ae(F.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,qe.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ae(F.INVALID_OPERATION,"You have already set the proxy")}if(Ig(e))return this._turnServer={servers:e,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>hL(n)),this._turnServer={servers:e,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"you should set license before join channel");if(Cr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ae(F.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,R.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ae(F.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ae(F.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ae(F.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Stop proxy server after leave channel");qe.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ae(F.INVALID_PARAMS,"accessPoints is required.");ul(e.accessPoints.serverList,"accessPoints.serverList"),Cr(e.accessPoints.domain,"accessPoints.domain");const t=(v,y)=>{nn(v,y,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ae(F.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");W("CLOSE_AFB_FOR_LOCAL_AP")&&($t("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),$t("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map(v=>r.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(i):v),o=s.map(v=>"".concat(v,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,$t("WEBCS_DOMAIN",o),$t("WEBCS_DOMAIN_BACKUP_LIST",o),$t("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ul(e.report.hostname,"report.hostname"),$t("EVENT_REPORT_DOMAIN",e.report.hostname[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):($t("EVENT_REPORT_DOMAIN",s[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),c=e.report.port),$t("STATS_COLLECTOR_PORT",c),e.report?$t("ENABLE_EVENT_REPORT",!0):$t("ENABLE_EVENT_REPORT",!1);let l="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ul(e.log.hostname,"log.hostname"),l=e.log.hostname[0]):l=s[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),$t("LOG_UPLOAD_SERVER","".concat(l,":").concat(p));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ul(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=s;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),$t("CDS_AP",m.map(v=>"".concat(v,":").concat(E))),e.cds?$t("ENABLE_CONFIG_DISTRIBUTE",!0):$t("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ul(e,"serverList"),Cr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ae(F.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,$t("WEBCS_DOMAIN",e),$t("WEBCS_DOMAIN_BACKUP_LIST",e),$t("GATEWAY_DOMAINS",[t]),$t("EVENT_REPORT_DOMAIN",e[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),$t("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(ir(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){ir(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){ir(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(s){ir(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Cr(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Ae(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new ae(F.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ae(F.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(ga(r,"encryptDataStream"),!Ae(i).call(i,e))throw new ae(F.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Sd(n))}async renewToken(e){if(Cr(e,"token",1,2047),!this._key||!this._joinInfo)throw new ae(F.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(W("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await Fz(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,R.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Nt.VOLUME_INDICATOR,e)},W("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ae(F.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ae(F.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ae(F.LIVE_STREAMING_TASK_CONFLICT);const n=t?hl.TRANSCODE:hl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(hl.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new ae(F.INVALID_PARAMS,"can not find live streaming url to stop");await je.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){$U(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){$U(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Xg&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ae(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,s,o){var c;const l=Ui(c=Array.from(o)).call(c,(A,N)=>A+N,0),p={serverTs:0,seq:aK++,length:o.length,checkSum:l},m=new Uint8Array(SL(l,2)),E=new ArrayBuffer(Tf),v=new DataView(E);v.setUint32(0,p.serverTs),v.setUint16(4,p.seq),v.setUint16(6,p.length),v.setUint16(8,p.checkSum);const y=16-o.length%16;o=mL(o,new Uint8Array(y));const D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:kL,additionalData:m},s,o);return mL(new Uint8Array(E),new Uint8Array(D))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ae(F.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(lt.DATA_STREAM,{payload:Sd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-qz},!n)}sendMetadata(e){if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ae(F.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(lt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Sd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(_K),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not send custom report, not joined");await qe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(W("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{Ae(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){ir(t.spatialLayer,"spatialLayer",[0,1,2,3]),ir(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(ga(t,"apRTM"),nn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Lf.indexOf(e);t!==-1&&Lf.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ai.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&w5(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&qe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new jr("client-publish",this._clientId),this._subscribeMutex=new jr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||ph();e?R.debug("[".concat(this._clientId,"] new Session ").concat(r)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,qe.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};qe.sessionInit(this._sessionId,Go({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ae(F.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Vn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==F.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof mn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(s=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===F.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==F.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===F.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ae(F.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ml("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{qe.reportApiInvoke(this._sessionId,{name:xn.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Tn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{qe.reportApiInvoke(this._sessionId,{name:xn.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Tn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_WARNING,i,s)},n.on(kb.REQUEST_WORKER_MANAGER_LIST,(i,s,o)=>{if(!this._joinInfo)return o(new ae(F.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,l,p,m){const E=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(v=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(v+"/api/v1?action=uap"):"https://".concat(v,"/api/v1?action=uap"));return await kz(E,c,l,p,m)})(i,this._joinInfo,this._axiosCancelSource.token,qn).then(s).catch(o)}),n};return e===hl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ae(F.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},ml("ChannelMediaRelay").create(e));r.on("state",i=>{i===Ki.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const s=[];this._users.forEach(o=>{o._dataChannels.forEach(c=>{n.every(l=>l.uid!==o._uintid||l.stream_id!==c.id)&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:o,stream_id:c,ordered:l,max_retrans_times:p,metadata:m}=s,E=this._users.find(v=>v._uintid===o);if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Ae(i).call(i,E)||i.push(E),E._uintid||(E._uintid=o),E._dataChannels.findIndex(v=>v.id===s.stream_id)===-1){const v={id:c,ordered:!!l,maxRetransmits:p,metadata:m},y=function(D){return UU(D,!0)}(v);E._dataChannels.push(y),R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(Nt.USER_PUBLISHED,E,"datachannel",v)}this._p2pChannel.hasPendingRemoteDataChannel(E,s.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,s.stream_id).catch(v=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),v.toString())}))}),t&&(this.safeEmit(Nt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:o,stream_id:c}=s,l=this._users.find(m=>m._uintid===o);if(!l)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=l._dataChannels.find(m=>m.id===s.stream_id);p&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(l,[p]).then(m=>{if(l._dataChannels=l._dataChannels.filter(E=>E!==p),m)return this._gateway.unsubscribeDataChannel(m,l.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(Nt.USER_UNPUBLISHED,l,"datachannel",p._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return i==null||(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Nt.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(_r.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{const{value:i,type:s,expires:o}=t[r];o&&o<=n||s||bb()||!Object.prototype.hasOwnProperty.call(Ay,r)||(va[r]=i,Sn[r]=i,R.debug("Update gateway parameters from config distribute",r,i))})}catch(t){R.error("Error update config from local cache",t.message)}})()}),this._gateway.on(_r.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(_r.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Xt.FALLBACK)return;const i=()=>{this.safeEmit(Nt.CONNECTION_STATE_CHANGE,e,t,n)};if(qe.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:xn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Tn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch(l=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),l)})}),this._remoteStreamTypeCacheMap.forEach((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch(l=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),l)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Be.AUDIO,!1)),o._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Be.VIDEO,!1)),o._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}i()}),this._gateway.on(_r.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ae(F.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await C5(Go(Go({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,b5(r),this._joinInfo.preload=!0):(n=await Xb(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s;const[c,l]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:c,port:l}):i.push({host:c,port:l})}),e(i)}catch(n){t(n)}}),this._gateway.on(_r.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Nt.NETWORK_QUALITY,e)}),this._gateway.on(_r.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Nt.STREAM_TYPE_CHANGED,e,t),qe.reportApiInvoke(this._sessionId,{name:xn.STREAM_TYPE_CHANGE,options:[e,t],tag:Tn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(_r.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(_r.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}}),this._gateway.on(_r.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const r=wU(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(_r.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:o}=this._joinInfo.apResponse,c="".concat(o,"_").concat(s);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=W("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(l){l.code&&l.code===F.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Pt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Pt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Pt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Pt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Pt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Be.AUDIO,!0)),this._gateway.signal.on(Pt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Be.AUDIO,!1)),this._gateway.signal.on(Pt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Be.VIDEO,!0)),this._gateway.signal.on(Pt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Be.VIDEO,!1)),this._gateway.signal.on(Pt.RECEIVE_METADATA,e=>{const t=hh(e.metadata);this.safeEmit(Nt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Pt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=hh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ae(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Tf)throw new ae(F.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Tf));n=await async function(s,o,c){const l=c.subarray(0,Tf),p=l.slice(8,Tf),m=(p[0]<<8)+p[1],E=(l[6]<<8)+l[7],v=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:kL,additionalData:new Uint8Array(SL(m,2))},o,c.subarray(Tf));return new Uint8Array(v).subarray(0,E)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(c=>c.uid===e.uid),o=i?.audioRecv.find(c=>c.ssrc===s?._audioSSRC);r=o?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),Jz(Go(Go({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Pt.ON_CRYPT_ERROR,()=>{vd(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Nt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xt.TOKEN_EXPIRE),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pt.ON_STREAM_FALLBACK_UPDATE,e=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Nt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Pt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Pt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ht.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case lt.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const s=i.some(l=>{let{stream_type:p}=l;return p===Qt.Audio}),o=i.some(l=>{let{stream_type:p}=l;return p!==Qt.Audio}),c=i.some(l=>{let{stream_type:p}=l;return p===Qt.Screen||p===Qt.ScreenLow});t.state==="offer"&&qe.publish(this._joinInfo.sid,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:F.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(n=i.find(l=>{let{stream_type:p}=l;return p===Qt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(r=i.find(l=>{let{stream_type:p}=l;return p!==Qt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case lt.SUBSCRIBE:t&&qe.subscribe(this._joinInfo.sid,{succ:!1,ec:F.TIMEOUT,audio:t.stream_type===Be.AUDIO,video:t.stream_type===Be.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Gr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Pt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Pt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;W("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!yh(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let i=this._users.find(m=>m._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Pd(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Nt.USER_JOINED,i)));const s=ur.Audio&r.stream_type,o=(ur.Video|ur.LwoVideo)&r.stream_type,c=(65280&r.stream_type)!=0,l=s&&i.hasAudio,p=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!l&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Nt.USER_PUBLISHED,i,"audio")),o&&!p&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Nt.USER_PUBLISHED,i,"video")),(s&&!l||o&&!p||c)&&t.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Nt.PUBLISHED_USER_LIST).length>0?W("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Nt.PUBLISHED_USER_LIST,t)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Pt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Xg&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return Ae(r=Object.keys(Dg)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Pt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Vn.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(i=>{const{kind:s,ssrcs:o,mid:c,isMuted:l}=i;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,c);const p=this._users.find(m=>m.uid===r);return p&&this.store.useP2P?this._p2pChannel.mockSubscribe(p,s,o[0].ssrcId,c).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,s,!!l)})}),this._gateway.signal.on(Vn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}}),this._gateway.signal.on(ht.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Vn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find(o=>o.uid===i);if(!s)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async o=>{let{stream_type:c}=o;const l=c===Qt.Audio?Be.AUDIO:Be.VIDEO;await this._p2pChannel.unsubscribe(s,l),this._handleMuteStream(i,l,!0)}),t()}catch(o){n(o)}}}),this._gateway.signal.on(Vn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case Rd.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Be.VIDEO,!0);break;case Rd.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Be.AUDIO,!0);break;case Rd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Be.VIDEO,!1);break;case Rd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Be.AUDIO,!1)}}),this._gateway.signal.on(Vn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==Ei.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Vn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(et.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Vn.RESTART_ICE,e,r===Ei.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(et.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Vn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(et.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Vn.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(et.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.StateChange,(e,t)=>{t===Jt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(et.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Nt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(et.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(et.RequestRePublishDataChannel,(e,t,n)=>{je.all(e.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==F.DISCONNECT_P2P)throw s}})).then(t).catch(n)}),this._p2pChannel.on(et.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===Be.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(et.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(et.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(et.MediaReconnectStart,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(et.MediaReconnectEnd,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(et.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(et.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(o){return void t.throw(o)}const{iceParameters:s}=function(o){const c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}}(i);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(et.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(et.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),o=wU(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(et.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(et.P2PLost,()=>{this.safeEmit(Nt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(et.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(et.ConnectionTypeChange,e=>{this.safeEmit(Nt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(et.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(et.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(et.AudioMetadata,e=>{this.safeEmit(Nt.AUDIO_METADATA,e)}),this._p2pChannel.on(et.AudioPts,e=>{this.safeEmit(Nt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},ml("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:o,uid:c,cid:l,vid:p}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:o,uid:c,cid:l,vid:p?Number(p):0},qn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(gr.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===jo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Nt.CONTENT_INSPECT_ERROR,new ae(F.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(gr.INSPECT_RESULT,(t,n)=>{var r;if(n?.code===F.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Nt.CONTENT_INSPECT_RESULT,t,n)}),e.on(gr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ga(e,"enabled"),e){if(!t)throw new ae(F.INVALID_PARAMS,"config is required");if(F5(t),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},ml("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:o,token:c,uid:l,cid:p,vid:m}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:l,cid:p,vid:m?Number(m):0},qn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Ta.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===to.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ae(F.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ta.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){ir(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ae(F.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ga(e,"enabled"),$t("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ye(Fe.prototype,"leave",[B5],Object.getOwnPropertyDescriptor(Fe.prototype,"leave"),Fe.prototype),Ye(Fe.prototype,"publish",[W5],Object.getOwnPropertyDescriptor(Fe.prototype,"publish"),Fe.prototype),Ye(Fe.prototype,"unpublish",[G5],Object.getOwnPropertyDescriptor(Fe.prototype,"unpublish"),Fe.prototype),Ye(Fe.prototype,"subscribe",[H5],Object.getOwnPropertyDescriptor(Fe.prototype,"subscribe"),Fe.prototype),Ye(Fe.prototype,"presubscribe",[K5],Object.getOwnPropertyDescriptor(Fe.prototype,"presubscribe"),Fe.prototype),Ye(Fe.prototype,"massSubscribe",[z5],Object.getOwnPropertyDescriptor(Fe.prototype,"massSubscribe"),Fe.prototype),Ye(Fe.prototype,"unsubscribe",[Y5],Object.getOwnPropertyDescriptor(Fe.prototype,"unsubscribe"),Fe.prototype),Ye(Fe.prototype,"massUnsubscribe",[q5],Object.getOwnPropertyDescriptor(Fe.prototype,"massUnsubscribe"),Fe.prototype),Ye(Fe.prototype,"setLowStreamParameter",[X5],Object.getOwnPropertyDescriptor(Fe.prototype,"setLowStreamParameter"),Fe.prototype),Ye(Fe.prototype,"enableDualStream",[J5],Object.getOwnPropertyDescriptor(Fe.prototype,"enableDualStream"),Fe.prototype),Ye(Fe.prototype,"disableDualStream",[Q5],Object.getOwnPropertyDescriptor(Fe.prototype,"disableDualStream"),Fe.prototype),Ye(Fe.prototype,"setClientRole",[Z5],Object.getOwnPropertyDescriptor(Fe.prototype,"setClientRole"),Fe.prototype),Ye(Fe.prototype,"_setClientRoleOptions",[$5],Object.getOwnPropertyDescriptor(Fe.prototype,"_setClientRoleOptions"),Fe.prototype),Ye(Fe.prototype,"setProxyServer",[eV],Object.getOwnPropertyDescriptor(Fe.prototype,"setProxyServer"),Fe.prototype),Ye(Fe.prototype,"setTurnServer",[tV],Object.getOwnPropertyDescriptor(Fe.prototype,"setTurnServer"),Fe.prototype),Ye(Fe.prototype,"setLicense",[nV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLicense"),Fe.prototype),Ye(Fe.prototype,"startProxyServer",[rV],Object.getOwnPropertyDescriptor(Fe.prototype,"startProxyServer"),Fe.prototype),Ye(Fe.prototype,"stopProxyServer",[iV],Object.getOwnPropertyDescriptor(Fe.prototype,"stopProxyServer"),Fe.prototype),Ye(Fe.prototype,"setLocalAccessPointsV2",[sV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLocalAccessPointsV2"),Fe.prototype),Ye(Fe.prototype,"setLocalAccessPoints",[oV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLocalAccessPoints"),Fe.prototype),Ye(Fe.prototype,"setRemoteDefaultVideoStreamType",[aV],Object.getOwnPropertyDescriptor(Fe.prototype,"setRemoteDefaultVideoStreamType"),Fe.prototype),Ye(Fe.prototype,"setRemoteVideoStreamType",[cV],Object.getOwnPropertyDescriptor(Fe.prototype,"setRemoteVideoStreamType"),Fe.prototype),Ye(Fe.prototype,"setStreamFallbackOption",[lV],Object.getOwnPropertyDescriptor(Fe.prototype,"setStreamFallbackOption"),Fe.prototype),Ye(Fe.prototype,"setEncryptionConfig",[dV],Object.getOwnPropertyDescriptor(Fe.prototype,"setEncryptionConfig"),Fe.prototype),Ye(Fe.prototype,"renewToken",[uV],Object.getOwnPropertyDescriptor(Fe.prototype,"renewToken"),Fe.prototype),Ye(Fe.prototype,"enableAudioVolumeIndicator",[hV],Object.getOwnPropertyDescriptor(Fe.prototype,"enableAudioVolumeIndicator"),Fe.prototype),Ye(Fe.prototype,"startLiveStreaming",[pV],Object.getOwnPropertyDescriptor(Fe.prototype,"startLiveStreaming"),Fe.prototype),Ye(Fe.prototype,"setLiveTranscoding",[fV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLiveTranscoding"),Fe.prototype),Ye(Fe.prototype,"stopLiveStreaming",[mV],Object.getOwnPropertyDescriptor(Fe.prototype,"stopLiveStreaming"),Fe.prototype),Ye(Fe.prototype,"startChannelMediaRelay",[_V],Object.getOwnPropertyDescriptor(Fe.prototype,"startChannelMediaRelay"),Fe.prototype),Ye(Fe.prototype,"updateChannelMediaRelay",[gV],Object.getOwnPropertyDescriptor(Fe.prototype,"updateChannelMediaRelay"),Fe.prototype),Ye(Fe.prototype,"stopChannelMediaRelay",[EV],Object.getOwnPropertyDescriptor(Fe.prototype,"stopChannelMediaRelay"),Fe.prototype),Ye(Fe.prototype,"sendCustomReportMessage",[vV],Object.getOwnPropertyDescriptor(Fe.prototype,"sendCustomReportMessage"),Fe.prototype),Ye(Fe.prototype,"pickSVCLayer",[SV],Object.getOwnPropertyDescriptor(Fe.prototype,"pickSVCLayer"),Fe.prototype),Ye(Fe.prototype,"setRTMConfig",[yV],Object.getOwnPropertyDescriptor(Fe.prototype,"setRTMConfig"),Fe.prototype),Ye(Fe.prototype,"enableContentInspect",[TV],Object.getOwnPropertyDescriptor(Fe.prototype,"enableContentInspect"),Fe.prototype),Ye(Fe.prototype,"disableContentInspect",[CV],Object.getOwnPropertyDescriptor(Fe.prototype,"disableContentInspect"),Fe.prototype),Ye(Fe.prototype,"setImageModeration",[RV],Object.getOwnPropertyDescriptor(Fe.prototype,"setImageModeration"),Fe.prototype),Ye(Fe.prototype,"setP2PTransport",[wV],Object.getOwnPropertyDescriptor(Fe.prototype,"setP2PTransport"),Fe.prototype),Ye(Fe.prototype,"getJoinChannelServiceRecords",[bV],Object.getOwnPropertyDescriptor(Fe.prototype,"getJoinChannelServiceRecords"),Fe.prototype),Ye(Fe.prototype,"setPublishAudioFilterEnabled",[IV],Object.getOwnPropertyDescriptor(Fe.prototype,"setPublishAudioFilterEnabled"),Fe.prototype),Fe);class Zg{constructor(t,n){x(this,"id",0),x(this,"element",void 0),x(this,"peerPair",void 0),x(this,"context",void 0),x(this,"audioPlayerElement",void 0),x(this,"audioTrack",void 0),Zg.count+=1,this.id=Zg.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new je(o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new ae(F.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new ae(F.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new ae(F.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var OV,CT;x(Zg,"count",0);const hY=window.AudioContext||window.webkitAudioContext,pY=new(OV=ot({report:qe}),Ye((CT=class{constructor(){x(this,"units",[]),x(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new hY);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Zg(e,this.context),this.units.push(t)),t.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return xt().name!==Wt.SAFARI}}).prototype,"processExternalMediaAEC",[OV],Object.getOwnPropertyDescriptor(CT.prototype,"processExternalMediaAEC"),CT.prototype),CT);function NV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function PV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NV(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const fI=window||document;function DV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!fI)return;const n=Xn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(Xn.onSecurityPolicyViolation||Xn.getListeners(Cc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;W("CSP_DETECTED_HOSTNAME_LIST").some(o=>Ae(s).call(s,o))&&(Xn.onSecurityPolicyViolation&&typeof Xn.onSecurityPolicyViolation=="function"&&Xn.onSecurityPolicyViolation(i),Xn.getListeners(Cc.SECURITY_POLICY_VIOLATION).length>0&&Xn.safeEmit(Cc.SECURITY_POLICY_VIOLATION,i))};n&&fI.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Xn.getListeners(Cc.SECURITY_POLICY_VIOLATION).length>0)&&fI.addEventListener("securitypolicyviolation",r),Xn._cspEventHandlerPointer=r}var fY=Y,mY=pk,kV=RegExp.prototype,_Y=function(e){return e===kV||fY(kV,e)?mY(e):e.flags},oi=S(_Y);function qf(e){let t=e.length;for(;--t>=0;)e[t]=0}const mI=256,LV=286,$g=30,eE=15,_I=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),RT=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),gY=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),xV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gl=new Array(576);qf(gl);const tE=new Array(60);qf(tE);const nE=new Array(512);qf(nE);const rE=new Array(256);qf(rE);const gI=new Array(29);qf(gI);const wT=new Array($g);function EI(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let MV,UV,VV;function vI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}qf(wT);const jV=e=>e<256?nE[e]:nE[256+(e>>>7)],iE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ds=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,iE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},bc=(e,t,n)=>{Ds(e,n[2*t],n[2*t+1])},FV=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},BV=(e,t,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=eE;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=t;s++){let c=e[2*s+1];c!==0&&(e[2*s]=FV(r[c]++,c))}},WV=e=>{let t;for(t=0;t<LV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<$g;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},GV=e=>{e.bi_valid>8?iE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},HV=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},SI=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&HV(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!HV(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},KV=(e,t,n)=>{let r,i,s,o,c=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+c++],r+=(255&e.pending_buf[e.sym_buf+c++])<<8,i=e.pending_buf[e.sym_buf+c++],r===0?bc(e,i,t):(s=rE[i],bc(e,s+mI+1,t),o=_I[s],o!==0&&(i-=gI[s],Ds(e,i,o)),r--,s=jV(r),bc(e,s,n),o=RT[s],o!==0&&(r-=wT[s],Ds(e,r,o)));while(c<e.sym_next);bc(e,256,t)},yI=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,c,l,p=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(e.heap[++e.heap_len]=p=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=p<2?++p:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=p,o=e.heap_len>>1;o>=1;o--)SI(e,n,o);l=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],SI(e,n,1),c=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=c,n[2*l]=n[2*o]+n[2*c],e.depth[l]=(e.depth[o]>=e.depth[c]?e.depth[o]:e.depth[c])+1,n[2*o+1]=n[2*c+1]=l,e.heap[1]=l++,SI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,E)=>{const v=E.dyn_tree,y=E.max_code,D=E.stat_desc.static_tree,A=E.stat_desc.has_stree,N=E.stat_desc.extra_bits,j=E.stat_desc.extra_base,V=E.stat_desc.max_length;let G,$,Q,z,re,fe,ve=0;for(z=0;z<=eE;z++)m.bl_count[z]=0;for(v[2*m.heap[m.heap_max]+1]=0,G=m.heap_max+1;G<573;G++)$=m.heap[G],z=v[2*v[2*$+1]+1]+1,z>V&&(z=V,ve++),v[2*$+1]=z,$>y||(m.bl_count[z]++,re=0,$>=j&&(re=N[$-j]),fe=v[2*$],m.opt_len+=fe*(z+re),A&&(m.static_len+=fe*(D[2*$+1]+re)));if(ve!==0){do{for(z=V-1;m.bl_count[z]===0;)z--;m.bl_count[z]--,m.bl_count[z+1]+=2,m.bl_count[V]--,ve-=2}while(ve>0);for(z=V;z!==0;z--)for($=m.bl_count[z];$!==0;)Q=m.heap[--G],Q>y||(v[2*Q+1]!==z&&(m.opt_len+=(z-v[2*Q+1])*v[2*Q],v[2*Q+1]=z),$--)}})(e,t),BV(n,p,e.bl_count)},zV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,p=4;for(o===0&&(l=138,p=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++c<l&&i===o||(c<p?e.bl_tree[2*i]+=c:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,s=i,o===0?(l=138,p=3):i===o?(l=6,p=3):(l=7,p=4))},YV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,p=4;for(o===0&&(l=138,p=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++c<l&&i===o)){if(c<p)do bc(e,i,e.bl_tree);while(--c!=0);else i!==0?(i!==s&&(bc(e,i,e.bl_tree),c--),bc(e,16,e.bl_tree),Ds(e,c-3,2)):c<=10?(bc(e,17,e.bl_tree),Ds(e,c-3,3)):(bc(e,18,e.bl_tree),Ds(e,c-11,7));c=0,s=i,o===0?(l=138,p=3):i===o?(l=6,p=3):(l=7,p=4)}};let qV=!1;const XV=(e,t,n,r)=>{Ds(e,0+(r?1:0),3),GV(e),iE(e,n),iE(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var EY=e=>{qV||((()=>{let t,n,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(gI[i]=r,t=0;t<1<<_I[i];t++)rE[r++]=i;for(rE[r-1]=i,s=0,i=0;i<16;i++)for(wT[i]=s,t=0;t<1<<RT[i];t++)nE[s++]=i;for(s>>=7;i<$g;i++)for(wT[i]=s<<7,t=0;t<1<<RT[i]-7;t++)nE[256+s++]=i;for(n=0;n<=eE;n++)o[n]=0;for(t=0;t<=143;)gl[2*t+1]=8,t++,o[8]++;for(;t<=255;)gl[2*t+1]=9,t++,o[9]++;for(;t<=279;)gl[2*t+1]=7,t++,o[7]++;for(;t<=287;)gl[2*t+1]=8,t++,o[8]++;for(BV(gl,287,o),t=0;t<$g;t++)tE[2*t+1]=5,tE[2*t]=FV(t,5);MV=new EI(gl,_I,257,LV,eE),UV=new EI(tE,RT,0,$g,eE),VV=new EI(new Array(0),gY,0,19,7)})(),qV=!0),e.l_desc=new vI(e.dyn_ltree,MV),e.d_desc=new vI(e.dyn_dtree,UV),e.bl_desc=new vI(e.bl_tree,VV),e.bi_buf=0,e.bi_valid=0,WV(e)},vY=(e,t,n,r)=>{let i,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(c=>{let l,p=4093624447;for(l=0;l<=31;l++,p>>>=1)if(1&p&&c.dyn_ltree[2*l]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(l=32;l<mI;l++)if(c.dyn_ltree[2*l]!==0)return 1;return 0})(e)),yI(e,e.l_desc),yI(e,e.d_desc),o=(c=>{let l;for(zV(c,c.dyn_ltree,c.l_desc.max_code),zV(c,c.dyn_dtree,c.d_desc.max_code),yI(c,c.bl_desc),l=18;l>=3&&c.bl_tree[2*xV[l]+1]===0;l--);return c.opt_len+=3*(l+1)+5+5+4,l})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&t!==-1?XV(e,t,n,r):e.strategy===4||s===i?(Ds(e,2+(r?1:0),3),KV(e,gl,tE)):(Ds(e,4+(r?1:0),3),((c,l,p,m)=>{let E;for(Ds(c,l-257,5),Ds(c,p-1,5),Ds(c,m-4,4),E=0;E<m;E++)Ds(c,c.bl_tree[2*xV[E]+1],3);YV(c,c.dyn_ltree,l-1),YV(c,c.dyn_dtree,p-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),KV(e,e.dyn_ltree,e.dyn_dtree)),WV(e),r&&GV(e)},SY=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(rE[n]+mI+1)]++,e.dyn_dtree[2*jV(t)]++),e.sym_next===e.sym_end),yY=e=>{Ds(e,2,3),bc(e,256,gl),(t=>{t.bi_valid===16?(iE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},TY={_tr_init:EY,_tr_stored_block:XV,_tr_flush_block:vY,_tr_tally:SY,_tr_align:yY},sE=(e,t,n,r)=>{let i=65535&e|0,s=e>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const CY=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Si=(e,t,n,r)=>{const i=CY,s=r+n;e^=-1;for(let o=r;o<s;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Ih={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},bT={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:RY,_tr_stored_block:TI,_tr_flush_block:wY,_tr_tally:xd,_tr_align:bY}=TY,{Z_NO_FLUSH:Md,Z_PARTIAL_FLUSH:IY,Z_FULL_FLUSH:AY,Z_FINISH:Ho,Z_BLOCK:JV,Z_OK:Di,Z_STREAM_END:QV,Z_STREAM_ERROR:Ic,Z_DATA_ERROR:OY,Z_BUF_ERROR:CI,Z_DEFAULT_COMPRESSION:NY,Z_FILTERED:PY,Z_HUFFMAN_ONLY:IT,Z_RLE:DY,Z_FIXED:kY,Z_DEFAULT_STRATEGY:LY,Z_UNKNOWN:xY,Z_DEFLATED:AT}=bT,RI=286,MY=30,UY=19,VY=2*RI+1,jY=15,Ah=258,Ac=262,Xf=42,Oh=113,oE=666,Nh=(e,t)=>(e.msg=Ih[t],t),ZV=e=>2*e-(e>4?9:0),Ud=e=>{let t=e.length;for(;--t>=0;)e[t]=0},FY=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let Vd=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ro=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},io=(e,t)=>{wY(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ro(e.strm)},Mn=(e,t)=>{e.pending_buf[e.pending++]=t},aE=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},wI=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=sE(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Si(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},$V=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,c=e.nice_match;const l=e.strstart>e.w_size-Ac?e.strstart-(e.w_size-Ac):0,p=e.window,m=e.w_mask,E=e.prev,v=e.strstart+Ah;let y=p[s+o-1],D=p[s+o];e.prev_length>=e.good_match&&(i>>=2),c>e.lookahead&&(c=e.lookahead);do if(n=t,p[n+o]===D&&p[n+o-1]===y&&p[n]===p[s]&&p[++n]===p[s+1]){s+=2,n++;do;while(p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&s<v);if(r=Ah-(v-s),s=v-Ah,r>o){if(e.match_start=t,o=r,r>=c)break;y=p[s+o-1],D=p[s+o]}}while((t=E[t&m])>l&&--i!=0);return o<=e.lookahead?o:e.lookahead},Jf=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ac)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),FY(e),r+=t),e.strm.avail_in===0)break;if(n=wI(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Vd(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Vd(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ac&&e.strm.avail_in!==0)},e6=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,c=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&t!==Ho||t===Md||n!==r+e.strm.avail_in)))break;o=t===Ho&&n===r+e.strm.avail_in?1:0,TI(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ro(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(wI(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return c-=e.strm.avail_in,c&&(c>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=c&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-c,e.strm.next_in),e.strstart),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Md&&t!==Ho&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(wI(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===Ho)&&t!==Md&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,o=t===Ho&&e.strm.avail_in===0&&n===r?1:0,TI(e,e.block_start,n,o),e.block_start+=n,ro(e.strm)),o?3:1)},bI=(e,t)=>{let n,r;for(;;){if(e.lookahead<Ac){if(Jf(e),e.lookahead<Ac&&t===Md)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Ac&&(e.match_length=$V(e,n)),e.match_length>=3)if(r=xd(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+1]);else r=xd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(io(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ho?(io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(io(e,!1),e.strm.avail_out===0)?1:2},Qf=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Ac){if(Jf(e),e.lookahead<Ac&&t===Md)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ac&&(e.match_length=$V(e,n),e.match_length<=5&&(e.strategy===PY||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=xd(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(io(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=xd(e,0,e.window[e.strstart-1]),r&&io(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=xd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ho?(io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(io(e,!1),e.strm.avail_out===0)?1:2};function Oc(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const cE=[new Oc(0,0,0,0,e6),new Oc(4,4,8,4,bI),new Oc(4,5,16,8,bI),new Oc(4,6,32,32,bI),new Oc(4,4,16,16,Qf),new Oc(8,16,32,32,Qf),new Oc(8,16,128,128,Qf),new Oc(8,32,128,256,Qf),new Oc(32,128,258,1024,Qf),new Oc(32,258,258,4096,Qf)];function BY(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=AT,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*VY),this.dyn_dtree=new Uint16Array(2*(2*MY+1)),this.bl_tree=new Uint16Array(2*(2*UY+1)),Ud(this.dyn_ltree),Ud(this.dyn_dtree),Ud(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(jY+1),this.heap=new Uint16Array(2*RI+1),Ud(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*RI+1),Ud(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const lE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Xf&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Oh&&t.status!==oE?1:0},t6=e=>{if(lE(e))return Nh(e,Ic);e.total_in=e.total_out=0,e.data_type=xY;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Xf:Oh,e.adler=t.wrap===2?0:1,t.last_flush=-2,RY(t),Di},n6=e=>{const t=t6(e);return t===Di&&(n=>{n.window_size=2*n.w_size,Ud(n.head),n.max_lazy_match=cE[n.level].max_lazy,n.good_match=cE[n.level].good_length,n.nice_match=cE[n.level].nice_length,n.max_chain_length=cE[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},r6=(e,t,n,r,i,s)=>{if(!e)return Ic;let o=1;if(t===NY&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==AT||r<8||r>15||t<0||t>9||s<0||s>kY||r===8&&o!==1)return Nh(e,Ic);r===8&&(r=9);const c=new BY;return e.state=c,c.strm=e,c.status=Xf,c.wrap=o,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=s,c.method=n,n6(e)};var WY=(e,t)=>{if(lE(e)||t>JV||t<0)return e?Nh(e,Ic):Ic;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===oE&&t!==Ho)return Nh(e,e.avail_out===0?CI:Ic);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ro(e),e.avail_out===0)return n.last_flush=-1,Di}else if(e.avail_in===0&&ZV(t)<=ZV(r)&&t!==Ho)return Nh(e,CI);if(n.status===oE&&e.avail_in!==0)return Nh(e,CI);if(n.status===Xf&&n.wrap===0&&(n.status=Oh),n.status===Xf){let i=AT+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=IT||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,aE(n,i),n.strstart!==0&&(aE(n,e.adler>>>16),aE(n,65535&e.adler)),e.adler=1,n.status=Oh,ro(e),n.pending!==0)return n.last_flush=-1,Di}if(n.status===57){if(e.adler=0,Mn(n,31),Mn(n,139),Mn(n,8),n.gzhead)Mn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Mn(n,255&n.gzhead.time),Mn(n,n.gzhead.time>>8&255),Mn(n,n.gzhead.time>>16&255),Mn(n,n.gzhead.time>>24&255),Mn(n,n.level===9?2:n.strategy>=IT||n.level<2?4:0),Mn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Mn(n,255&n.gzhead.extra.length),Mn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Si(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,n.level===9?2:n.strategy>=IT||n.level<2?4:0),Mn(n,3),n.status=Oh,ro(e),n.pending!==0)return n.last_flush=-1,Di}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let c=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=Si(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=c,ro(e),n.pending!==0)return n.last_flush=-1,Di;i=0,s-=c}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(e.adler=Si(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s)),ro(e),n.pending!==0)return n.last_flush=-1,Di;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Mn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s)),ro(e),n.pending!==0)return n.last_flush=-1,Di;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Mn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ro(e),n.pending!==0))return n.last_flush=-1,Di;Mn(n,255&e.adler),Mn(n,e.adler>>8&255),e.adler=0}if(n.status=Oh,ro(e),n.pending!==0)return n.last_flush=-1,Di}if(e.avail_in!==0||n.lookahead!==0||t!==Md&&n.status!==oE){let i=n.level===0?e6(n,t):n.strategy===IT?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(Jf(s),s.lookahead===0)){if(o===Md)return 1;break}if(s.match_length=0,c=xd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Ho?(io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(io(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===DY?((s,o)=>{let c,l,p,m;const E=s.window;for(;;){if(s.lookahead<=Ah){if(Jf(s),s.lookahead<=Ah&&o===Md)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(p=s.strstart-1,l=E[p],l===E[++p]&&l===E[++p]&&l===E[++p])){m=s.strstart+Ah;do;while(l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&p<m);s.match_length=Ah-(m-p),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=xd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=xd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Ho?(io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(io(s,!1),s.strm.avail_out===0)?1:2})(n,t):cE[n.level].func(n,t);if(i!==3&&i!==4||(n.status=oE),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Di;if(i===2&&(t===IY?bY(n):t!==JV&&(TI(n,0,0,!1),t===AY&&(Ud(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ro(e),e.avail_out===0))return n.last_flush=-1,Di}return t!==Ho?Di:n.wrap<=0?QV:(n.wrap===2?(Mn(n,255&e.adler),Mn(n,e.adler>>8&255),Mn(n,e.adler>>16&255),Mn(n,e.adler>>24&255),Mn(n,255&e.total_in),Mn(n,e.total_in>>8&255),Mn(n,e.total_in>>16&255),Mn(n,e.total_in>>24&255)):(aE(n,e.adler>>>16),aE(n,65535&e.adler)),ro(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Di:QV)},GY=(e,t)=>{let n=t.length;if(lE(e))return Ic;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==Xf||r.lookahead)return Ic;if(i===1&&(e.adler=sE(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Ud(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(t.subarray(n-r.w_size,n),0),t=l,n=r.w_size}const s=e.avail_in,o=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Jf(r);r.lookahead>=3;){let l=r.strstart,p=r.lookahead-2;do r.ins_h=Vd(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--p);r.strstart=l,r.lookahead=2,Jf(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=c,e.avail_in=s,r.wrap=i,Di},dE={deflateInit:(e,t)=>r6(e,t,AT,15,8,LY),deflateInit2:r6,deflateReset:n6,deflateResetKeep:t6,deflateSetHeader:(e,t)=>lE(e)||e.state.wrap!==2?Ic:(e.state.gzhead=t,Di),deflate:WY,deflateEnd:e=>{if(lE(e))return Ic;const t=e.state.status;return e.state=null,t===Oh?Nh(e,OY):Di},deflateSetDictionary:GY,deflateInfo:"pako deflate (from Nodeca project)"};const HY=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var OT={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)HY(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let o=e[r];n.set(o,i),i+=o.length}return n}};let i6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i6=!1}const uE=new Uint8Array(256);for(let e=0;e<256;e++)uE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;uE[254]=uE[254]=1;var hE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,s,o=e.length,c=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(c),s=0,i=0;s<c;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let o=e[r++];if(o<128){s[i++]=o;continue}let c=uE[o];if(c>4)s[i++]=65533,r+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&r<n;)o=o<<6|63&e[r++],c--;c>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&i6)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let l="";for(let p=0;p<c;p++)l+=String.fromCharCode(o[p]);return l})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+uE[e[n]]>t?n:t}},s6=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const o6=Object.prototype.toString,{Z_NO_FLUSH:KY,Z_SYNC_FLUSH:zY,Z_FULL_FLUSH:YY,Z_FINISH:qY,Z_OK:NT,Z_STREAM_END:XY,Z_DEFAULT_COMPRESSION:JY,Z_DEFAULT_STRATEGY:QY,Z_DEFLATED:ZY}=bT;function PT(e){this.options=OT.assign({level:JY,method:ZY,chunkSize:16384,windowBits:15,memLevel:8,strategy:QY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s6,this.strm.avail_out=0;let n=dE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==NT)throw new Error(Ih[n]);if(t.header&&dE.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?hE.string2buf(t.dictionary):o6.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=dE.deflateSetDictionary(this.strm,r),n!==NT)throw new Error(Ih[n]);this._dict_set=!0}}function $Y(e,t){const n=new PT(t);if(n.push(e,!0),n.err)throw n.msg||Ih[n.err];return n.result}PT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?qY:KY,typeof e=="string"?n.input=hE.string2buf(e):o6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===zY||s===YY)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=dE.deflate(n,s),i===XY)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=dE.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===NT;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},PT.prototype.onData=function(e){this.chunks.push(e)},PT.prototype.onEnd=function(e){e===NT&&(this.result=OT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var eq={deflate:$Y};const DT=16209;var tq=function(e,t){let n,r,i,s,o,c,l,p,m,E,v,y,D,A,N,j,V,G,$,Q,z,re,fe,ve;const Re=e.state;n=e.next_in,fe=e.input,r=n+(e.avail_in-5),i=e.next_out,ve=e.output,s=i-(t-e.avail_out),o=i+(e.avail_out-257),c=Re.dmax,l=Re.wsize,p=Re.whave,m=Re.wnext,E=Re.window,v=Re.hold,y=Re.bits,D=Re.lencode,A=Re.distcode,N=(1<<Re.lenbits)-1,j=(1<<Re.distbits)-1;e:do{y<15&&(v+=fe[n++]<<y,y+=8,v+=fe[n++]<<y,y+=8),V=D[v&N];t:for(;;){if(G=V>>>24,v>>>=G,y-=G,G=V>>>16&255,G===0)ve[i++]=65535&V;else{if(!(16&G)){if((64&G)==0){V=D[(65535&V)+(v&(1<<G)-1)];continue t}if(32&G){Re.mode=16191;break e}e.msg="invalid literal/length code",Re.mode=DT;break e}$=65535&V,G&=15,G&&(y<G&&(v+=fe[n++]<<y,y+=8),$+=v&(1<<G)-1,v>>>=G,y-=G),y<15&&(v+=fe[n++]<<y,y+=8,v+=fe[n++]<<y,y+=8),V=A[v&j];n:for(;;){if(G=V>>>24,v>>>=G,y-=G,G=V>>>16&255,!(16&G)){if((64&G)==0){V=A[(65535&V)+(v&(1<<G)-1)];continue n}e.msg="invalid distance code",Re.mode=DT;break e}if(Q=65535&V,G&=15,y<G&&(v+=fe[n++]<<y,y+=8,y<G&&(v+=fe[n++]<<y,y+=8)),Q+=v&(1<<G)-1,Q>c){e.msg="invalid distance too far back",Re.mode=DT;break e}if(v>>>=G,y-=G,G=i-s,Q>G){if(G=Q-G,G>p&&Re.sane){e.msg="invalid distance too far back",Re.mode=DT;break e}if(z=0,re=E,m===0){if(z+=l-G,G<$){$-=G;do ve[i++]=E[z++];while(--G);z=i-Q,re=ve}}else if(m<G){if(z+=l+m-G,G-=m,G<$){$-=G;do ve[i++]=E[z++];while(--G);if(z=0,m<$){G=m,$-=G;do ve[i++]=E[z++];while(--G);z=i-Q,re=ve}}}else if(z+=m-G,G<$){$-=G;do ve[i++]=E[z++];while(--G);z=i-Q,re=ve}for(;$>2;)ve[i++]=re[z++],ve[i++]=re[z++],ve[i++]=re[z++],$-=3;$&&(ve[i++]=re[z++],$>1&&(ve[i++]=re[z++]))}else{z=i-Q;do ve[i++]=ve[z++],ve[i++]=ve[z++],ve[i++]=ve[z++],$-=3;while($>2);$&&(ve[i++]=ve[z++],$>1&&(ve[i++]=ve[z++]))}break}}break}}while(n<r&&i<o);$=y>>3,n-=$,y-=$<<3,v&=(1<<y)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),Re.hold=v,Re.bits=y};const kT=15,nq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),rq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),iq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),sq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pE=(e,t,n,r,i,s,o,c)=>{const l=c.bits;let p,m,E,v,y,D,A=0,N=0,j=0,V=0,G=0,$=0,Q=0,z=0,re=0,fe=0,ve=null;const Re=new Uint16Array(16),Ct=new Uint16Array(16);let bt,ut,Yt,Ht=null;for(A=0;A<=kT;A++)Re[A]=0;for(N=0;N<r;N++)Re[t[n+N]]++;for(G=l,V=kT;V>=1&&Re[V]===0;V--);if(G>V&&(G=V),V===0)return i[s++]=20971520,i[s++]=20971520,c.bits=1,0;for(j=1;j<V&&Re[j]===0;j++);for(G<j&&(G=j),z=1,A=1;A<=kT;A++)if(z<<=1,z-=Re[A],z<0)return-1;if(z>0&&(e===0||V!==1))return-1;for(Ct[1]=0,A=1;A<kT;A++)Ct[A+1]=Ct[A]+Re[A];for(N=0;N<r;N++)t[n+N]!==0&&(o[Ct[t[n+N]]++]=N);if(e===0?(ve=Ht=o,D=20):e===1?(ve=nq,Ht=rq,D=257):(ve=iq,Ht=sq,D=0),fe=0,N=0,A=j,y=s,$=G,Q=0,E=-1,re=1<<G,v=re-1,e===1&&re>852||e===2&&re>592)return 1;for(;;){bt=A-Q,o[N]+1<D?(ut=0,Yt=o[N]):o[N]>=D?(ut=Ht[o[N]-D],Yt=ve[o[N]-D]):(ut=96,Yt=0),p=1<<A-Q,m=1<<$,j=m;do m-=p,i[y+(fe>>Q)+m]=bt<<24|ut<<16|Yt|0;while(m!==0);for(p=1<<A-1;fe&p;)p>>=1;if(p!==0?(fe&=p-1,fe+=p):fe=0,N++,--Re[A]==0){if(A===V)break;A=t[n+o[N]]}if(A>G&&(fe&v)!==E){for(Q===0&&(Q=G),y+=j,$=A-Q,z=1<<$;$+Q<V&&(z-=Re[$+Q],!(z<=0));)$++,z<<=1;if(re+=1<<$,e===1&&re>852||e===2&&re>592)return 1;E=fe&v,i[E]=G<<24|$<<16|y-s|0}}return fe!==0&&(i[y+fe]=A-Q<<24|64<<16|0),c.bits=G,0};const{Z_FINISH:a6,Z_BLOCK:oq,Z_TREES:LT,Z_OK:Ph,Z_STREAM_END:aq,Z_NEED_DICT:cq,Z_STREAM_ERROR:Ko,Z_DATA_ERROR:c6,Z_MEM_ERROR:l6,Z_BUF_ERROR:lq,Z_DEFLATED:d6}=bT,xT=16180,MT=16190,El=16191,II=16192,AI=16194,UT=16199,VT=16200,OI=16206,Er=16209,u6=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function dq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Dh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<xT||t.mode>16211?1:0},h6=e=>{if(Dh(e))return Ko;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=xT,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ph},p6=e=>{if(Dh(e))return Ko;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,h6(e)},f6=(e,t)=>{let n;if(Dh(e))return Ko;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ko:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,p6(e))},m6=(e,t)=>{if(!e)return Ko;const n=new dq;e.state=n,n.strm=e,n.window=null,n.mode=xT;const r=f6(e,t);return r!==Ph&&(e.state=null),r};let NI,PI,_6=!0;const uq=e=>{if(_6){NI=new Int32Array(512),PI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pE(1,e.lens,0,288,NI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pE(2,e.lens,0,32,PI,0,e.work,{bits:5}),_6=!1}e.lencode=NI,e.lenbits=9,e.distcode=PI,e.distbits=5},g6=(e,t,n,r)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var hq=(e,t)=>{let n,r,i,s,o,c,l,p,m,E,v,y,D,A,N,j,V,G,$,Q,z,re,fe=0;const ve=new Uint8Array(4);let Re,Ct;const bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Dh(e)||!e.output||!e.input&&e.avail_in!==0)return Ko;n=e.state,n.mode===El&&(n.mode=II),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,p=n.hold,m=n.bits,E=c,v=l,re=Ph;e:for(;;)switch(n.mode){case xT:if(n.wrap===0){n.mode=II;break}for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0),p=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){e.msg="incorrect header check",n.mode=Er;break}if((15&p)!==d6){e.msg="unknown compression method",n.mode=Er;break}if(p>>>=4,m-=4,z=8+(15&p),n.wbits===0&&(n.wbits=z),z>15||z>n.wbits){e.msg="invalid window size",n.mode=Er;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&p?16189:El,p=0,m=0;break;case 16181:for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(n.flags=p,(255&oi(n))!==d6){e.msg="unknown compression method",n.mode=Er;break}if(57344&oi(n)){e.msg="unknown header flags set",n.mode=Er;break}n.head&&(n.head.text=p>>8&1),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0)),p=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.head&&(n.head.time=p),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,ve[2]=p>>>16&255,ve[3]=p>>>24&255,n.check=Si(n.check,ve,4,0)),p=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0)),p=0,m=0,n.mode=16184;case 16184:if(1024&oi(n)){for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.length=p,n.head&&(n.head.extra_len=p),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0)),p=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&oi(n)&&(y=n.length,y>c&&(y=c),y&&(n.head&&(z=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+y),z)),512&oi(n)&&4&n.wrap&&(n.check=Si(n.check,r,y,s)),c-=y,s+=y,n.length-=y),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&oi(n)){if(c===0)break e;y=0;do z=r[s+y++],n.head&&z&&n.length<65536&&(n.head.name+=String.fromCharCode(z));while(z&&y<c);if(512&oi(n)&&4&n.wrap&&(n.check=Si(n.check,r,y,s)),c-=y,s+=y,z)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&oi(n)){if(c===0)break e;y=0;do z=r[s+y++],n.head&&z&&n.length<65536&&(n.head.comment+=String.fromCharCode(z));while(z&&y<c);if(512&oi(n)&&4&n.wrap&&(n.check=Si(n.check,r,y,s)),c-=y,s+=y,z)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&oi(n)){for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(4&n.wrap&&p!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Er;break}p=0,m=0}n.head&&(n.head.hcrc=oi(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=El;break;case 16189:for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}e.adler=n.check=u6(p),p=0,m=0,n.mode=MT;case MT:if(n.havedict===0)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,cq;e.adler=n.check=1,n.mode=El;case El:if(t===oq||t===LT)break e;case II:if(n.last){p>>>=7&m,m-=7&m,n.mode=OI;break}for(;m<3;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}switch(n.last=1&p,p>>>=1,m-=1,3&p){case 0:n.mode=16193;break;case 1:if(uq(n),n.mode=UT,t===LT){p>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Er}p>>>=2,m-=2;break;case 16193:for(p>>>=7&m,m-=7&m;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if((65535&p)!=(p>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Er;break}if(n.length=65535&p,p=0,m=0,n.mode=AI,t===LT)break e;case AI:n.mode=16195;case 16195:if(y=n.length,y){if(y>c&&(y=c),y>l&&(y=l),y===0)break e;i.set(r.subarray(s,s+y),o),c-=y,s+=y,l-=y,o+=y,n.length-=y;break}n.mode=El;break;case 16196:for(;m<14;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(n.nlen=257+(31&p),p>>>=5,m-=5,n.ndist=1+(31&p),p>>>=5,m-=5,n.ncode=4+(15&p),p>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Er;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.lens[bt[n.have++]]=7&p,p>>>=3,m-=3}for(;n.have<19;)n.lens[bt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Re={bits:n.lenbits},re=pE(0,n.lens,0,19,n.lencode,0,n.work,Re),n.lenbits=Re.bits,re){e.msg="invalid code lengths set",n.mode=Er;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;fe=n.lencode[p&(1<<n.lenbits)-1],N=fe>>>24,j=fe>>>16&255,V=65535&fe,!(N<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(V<16)p>>>=N,m-=N,n.lens[n.have++]=V;else{if(V===16){for(Ct=N+2;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(p>>>=N,m-=N,n.have===0){e.msg="invalid bit length repeat",n.mode=Er;break}z=n.lens[n.have-1],y=3+(3&p),p>>>=2,m-=2}else if(V===17){for(Ct=N+3;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=N,m-=N,z=0,y=3+(7&p),p>>>=3,m-=3}else{for(Ct=N+7;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=N,m-=N,z=0,y=11+(127&p),p>>>=7,m-=7}if(n.have+y>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Er;break}for(;y--;)n.lens[n.have++]=z}}if(n.mode===Er)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Er;break}if(n.lenbits=9,Re={bits:n.lenbits},re=pE(1,n.lens,0,n.nlen,n.lencode,0,n.work,Re),n.lenbits=Re.bits,re){e.msg="invalid literal/lengths set",n.mode=Er;break}if(n.distbits=6,n.distcode=n.distdyn,Re={bits:n.distbits},re=pE(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Re),n.distbits=Re.bits,re){e.msg="invalid distances set",n.mode=Er;break}if(n.mode=UT,t===LT)break e;case UT:n.mode=VT;case VT:if(c>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,tq(e,v),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,p=n.hold,m=n.bits,n.mode===El&&(n.back=-1);break}for(n.back=0;fe=n.lencode[p&(1<<n.lenbits)-1],N=fe>>>24,j=fe>>>16&255,V=65535&fe,!(N<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(j&&(240&j)==0){for(G=N,$=j,Q=V;fe=n.lencode[Q+((p&(1<<G+$)-1)>>G)],N=fe>>>24,j=fe>>>16&255,V=65535&fe,!(G+N<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=N,m-=N,n.back+=N,n.length=V,j===0){n.mode=16205;break}if(32&j){n.back=-1,n.mode=El;break}if(64&j){e.msg="invalid literal/length code",n.mode=Er;break}n.extra=15&j,n.mode=16201;case 16201:if(n.extra){for(Ct=n.extra;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;fe=n.distcode[p&(1<<n.distbits)-1],N=fe>>>24,j=fe>>>16&255,V=65535&fe,!(N<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if((240&j)==0){for(G=N,$=j,Q=V;fe=n.distcode[Q+((p&(1<<G+$)-1)>>G)],N=fe>>>24,j=fe>>>16&255,V=65535&fe,!(G+N<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=N,m-=N,n.back+=N,64&j){e.msg="invalid distance code",n.mode=Er;break}n.offset=V,n.extra=15&j,n.mode=16203;case 16203:if(n.extra){for(Ct=n.extra;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Er;break}n.mode=16204;case 16204:if(l===0)break e;if(y=v-l,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Er;break}y>n.wnext?(y-=n.wnext,D=n.wsize-y):D=n.wnext-y,y>n.length&&(y=n.length),A=n.window}else A=i,D=o-n.offset,y=n.length;y>l&&(y=l),l-=y,n.length-=y;do i[o++]=A[D++];while(--y);n.length===0&&(n.mode=VT);break;case 16205:if(l===0)break e;i[o++]=n.length,l--,n.mode=VT;break;case OI:if(n.wrap){for(;m<32;){if(c===0)break e;c--,p|=r[s++]<<m,m+=8}if(v-=l,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=oi(n)?Si(n.check,i,v,o-v):sE(n.check,i,v,o-v)),v=l,4&n.wrap&&(oi(n)?p:u6(p))!==n.check){e.msg="incorrect data check",n.mode=Er;break}p=0,m=0}n.mode=16207;case 16207:if(n.wrap&&oi(n)){for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(4&n.wrap&&p!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Er;break}p=0,m=0}n.mode=16208;case 16208:re=aq;break e;case Er:re=c6;break e;case 16210:return l6;default:return Ko}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,(n.wsize||v!==e.avail_out&&n.mode<Er&&(n.mode<OI||t!==a6))&&g6(e,e.output,e.next_out,v-e.avail_out),E-=e.avail_in,v-=e.avail_out,e.total_in+=E,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=oi(n)?Si(n.check,i,v,e.next_out-v):sE(n.check,i,v,e.next_out-v)),e.data_type=n.bits+(n.last?64:0)+(n.mode===El?128:0)+(n.mode===UT||n.mode===AI?256:0),(E===0&&v===0||t===a6)&&re===Ph&&(re=lq),re},vl={inflateReset:p6,inflateReset2:f6,inflateResetKeep:h6,inflateInit:e=>m6(e,15),inflateInit2:m6,inflate:hq,inflateEnd:e=>{if(Dh(e))return Ko;let t=e.state;return t.window&&(t.window=null),e.state=null,Ph},inflateGetHeader:(e,t)=>{if(Dh(e))return Ko;const n=e.state;return(2&n.wrap)==0?Ko:(n.head=t,t.done=!1,Ph)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return Dh(e)?Ko:(r=e.state,r.wrap!==0&&r.mode!==MT?Ko:r.mode===MT&&(i=1,i=sE(i,t,n,0),i!==r.check)?c6:(s=g6(e,t,n,n),s?(r.mode=16210,l6):(r.havedict=1,Ph)))},inflateInfo:"pako inflate (from Nodeca project)"},pq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const E6=Object.prototype.toString,{Z_NO_FLUSH:fq,Z_FINISH:mq,Z_OK:fE,Z_STREAM_END:DI,Z_NEED_DICT:kI,Z_STREAM_ERROR:_q,Z_DATA_ERROR:v6,Z_MEM_ERROR:gq}=bT;function jT(e){this.options=OT.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s6,this.strm.avail_out=0;let n=vl.inflateInit2(this.strm,t.windowBits);if(n!==fE)throw new Error(Ih[n]);if(this.header=new pq,vl.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=hE.string2buf(t.dictionary):E6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=vl.inflateSetDictionary(this.strm,t.dictionary),n!==fE)))throw new Error(Ih[n])}function Eq(e,t){const n=new jT(t);if(n.push(e),n.err)throw n.msg||Ih[n.err];return n.result}jT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,c;if(this.ended)return!1;for(o=t===~~t?t:t===!0?mq:fq,E6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=vl.inflate(n,o),s===kI&&i&&(s=vl.inflateSetDictionary(n,i),s===fE?s=vl.inflate(n,o):s===v6&&(s=kI));n.avail_in>0&&s===DI&&n.state.wrap>0&&e[n.next_in]!==0;)vl.inflateReset(n),s=vl.inflate(n,o);switch(s){case _q:case v6:case kI:case gq:return this.onEnd(s),this.ended=!0,!1}if(c=n.avail_out,n.next_out&&(n.avail_out===0||s===DI))if(this.options.to==="string"){let l=hE.utf8border(n.output,n.next_out),p=n.next_out-l,m=hE.buf2string(n.output,l);n.next_out=p,n.avail_out=r-p,p&&n.output.set(n.output.subarray(l,l+p),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==fE||c!==0){if(s===DI)return s=vl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},jT.prototype.onData=function(e){this.chunks.push(e)},jT.prototype.onEnd=function(e){e===fE&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=OT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var vq={inflate:Eq};const{deflate:Sq}=eq,{inflate:yq}=vq;var Tq=Sq,Cq=yq,S6=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(S6||{});class Rq{constructor(){x(this,"_sequence",0),x(this,"_startTime",Date.now()),x(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const l={id:0,length:4,data:c.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;W("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const c=this.serializeExtension(n.extension);i.set(new Uint8Array(c),o),o+=c.byteLength}if(i.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let o,c;if(r+=4,W("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){c=this.deserializeExtension(t.slice(r)),r+=2+c.length,o=t.slice(r);let l=!1;if(c.datas.length>0){const p=c.datas.find(m=>m.id===0);p&&(l=(1&new DataView(p.data).getUint32(0,!0))==1)}o=l?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:n,length:r,datas:i}=t,s=new ArrayBuffer(r+2),o=new Uint8Array(s),c=new DataView(s);let l=0;if(c.setUint8(l++,n),c.setUint8(l++,r),i.forEach(p=>{n?(c.setUint8(l++,p.id),c.setUint8(l++,p.length),o.set(new Uint8Array(p.data),l),l+=p.data.byteLength):(c.setUint8(l++,p.id|p.length<<4),o.set(new Uint8Array(p.data),l),l+=p.data.byteLength)}),l!==r+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(r+2));return s}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const o=i===S6.TWO_BYTE,c=[],l=new DataView(t,2);let p=0;for(;p<s;){let m=0,E=0,v=new ArrayBuffer(0);o?(m=l.getUint8(p),p++,E=l.getUint8(p),p++):(m=15&l.getUint8(p),E=l.getUint8(p)>>4,p++),E>0&&(v=l.buffer.slice(p+2,p+2+E),p+=v.byteLength),c.push({id:m,length:E,data:v})}if(p!==s)throw Error("parse error");return{profile:i,length:s,datas:c}}decompress(t){return Cq(new Uint8Array(t))}compress(t){return Tq(new Uint8Array(t))}}const wq={name:"DataStream",create:(e,t)=>{const n=t?new kK(e):new LK(e);return n.useDataStream(new Rq),n}};class bq extends bn{constructor(t,n,r){super(),x(this,"ws",void 0),x(this,"requestId",1),x(this,"heartBeatTimer",void 0),x(this,"joinInfo",void 0),x(this,"clientId",void 0),x(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),x(this,"onClose",i=>{this.emit("close"),this.dispose()}),x(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=n,this.ws=new Fg("cross-channel-".concat(this.clientId),r),this.ws.on(vt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(vt.CONNECTED,this.onOpen),this.ws.on(vt.ON_MESSAGE,this.onMessage),this.ws.on(vt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new je((n,r)=>{const i=window.setTimeout(()=>{r(new ae(F.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new ae(F.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new ae(F.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ae(F.WS_DISCONNECT);const n=()=>new je((o,c)=>{this.ws.once(vt.CLOSED,()=>c(new ae(F.WS_ABORT))),this.ws.once(vt.CONNECTED,o)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new je((o,c)=>{const l=()=>{c(new ae(F.WS_ABORT))};this.ws.once(vt.RECONNECTING,l),this.ws.once(vt.CLOSED,l),this.once("req_".concat(r),o),Rr(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(vt.RECONNECTING,l),this.ws.off(vt.CLOSED,l),c(new ae(F.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new ae(F.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(vt.REQUEST_NEW_URLS),this.ws.on(vt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Iq extends bn{set state(t){t!==this._state&&(t!==Ki.RELAY_STATE_FAILURE&&(this.errorCode=xf.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,s){super(),x(this,"joinInfo",void 0),x(this,"sid",void 0),x(this,"clientId",void 0),x(this,"cancelToken",Ai.CancelToken.source()),x(this,"workerToken",void 0),x(this,"requestId",0),x(this,"signal",void 0),x(this,"prevChannelMediaConfig",void 0),x(this,"httpRetryConfig",void 0),x(this,"_resolution",void 0),x(this,"_state",Ki.RELAY_STATE_IDLE),x(this,"errorCode",xf.RELAY_OK),x(this,"onStatus",o=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",pl.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",pl.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=xf.SRC_TOKEN_EXPIRED,this.state=Ki.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=xf.DEST_TOKEN_EXPIRED,this.state=Ki.RELAY_STATE_FAILURE))}),x(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",pl.NETWORK_DISCONNECTED),this.state=Ki.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==Ki.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",o.toString()),this.errorCode=xf.SERVER_CONNECTION_LOST,this.state=Ki.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=ph(),this.signal=new bq(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==Ki.RELAY_STATE_IDLE)throw new ae(F.INVALID_OPERATION);this.state=Ki.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new ae(F.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new ae(F.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new ae(F.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ki.RELAY_STATE_RUNNING)throw new ae(F.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ki.RELAY_STATE_RUNNING)throw new ae(F.INVALID_OPERATION);const n=this.genMessage(vi.SetVideoProfile);await this.signal.request(n),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ki.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ai.CancelToken.source(),this.state=Ki.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await jz(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",pl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(vi.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(vi.SetSdkProfile,t);await this.signal.request(r),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(vi.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",pl.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(vi.SetSourceUserId,t);await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(vi.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",pl.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(vi.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",pl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ki.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(vi.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",pl.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(vi.StopPacketTransfer);await this.signal.request(t),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Qs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.24.0"&&(o.sdkVersion="0.0.1");let c=null,l=null;switch(t){case vi.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case vi.SetSourceChannel:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new ae(F.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},o;case vi.SetSourceUserId:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new ae(F.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:l.uid+""},o;case vi.SetDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new ae(F.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},o;case vi.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case vi.Reconnect:return o.clientRequest={command:"Reconnect"},o;case vi.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case vi.UpdateDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new ae(F.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},o;case vi.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const Aq={name:"ChannelMediaRelay",create:function(e){return new Iq(e.joinInfo,e.clientId,e.websocketRetryConfig||qn,e.httpRetryConfig||qn,e.resolution)}};function y6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function mE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Oq extends bn{constructor(t,n,r,i){super(),x(this,"spec",void 0),x(this,"token",void 0),x(this,"websocket",void 0),x(this,"pingpongTimer",void 0),x(this,"reconnectMode","retry"),x(this,"serviceMode",void 0),x(this,"reqId",0),x(this,"commandReqId",0),x(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),x(this,"handleWebSocketMessage",s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(qe.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===hl.TRANSCODE?1:2}),this.emit(Cd.PUBLISH_STREAM_STATUS,o))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new Fg("live-streaming",r),this.websocket.on(vt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(vt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(vt.REQUEST_NEW_URLS,(s,o)=>{Dr(this,Cd.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on(vt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new ae(F.UNEXPECTED_ERROR);const c=mE({command:t,sdkVersion:Qs==="4.24.0"?"0.0.1":Qs,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new ae(F.WS_DISCONNECT);const l=()=>new je((v,y)=>{this.websocket.once(vt.CLOSED,()=>y(new ae(F.WS_ABORT))),this.websocket.once(vt.CONNECTED,v)});this.websocket.state!=="connected"&&await l(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const p=new je((v,y)=>{const D=()=>{y(new ae(F.WS_ABORT))};this.websocket.once(vt.RECONNECTING,D),this.websocket.once(vt.CLOSED,D),this.once("@".concat(o,"-").concat(this.spec.sid),A=>{v(A)})});i&&qe.workerEvent(this.spec.sid,mE(mE({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(c);let E=null;try{E=await p}catch(v){if(this.websocket.state==="closed")throw v;return await l(),await this.request(t,n,r)}return i&&qe.workerEvent(this.spec.sid,mE(mE({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-m})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Qs==="4.24.0"?"0.0.1":Qs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case er.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case er.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case er.LIVE_STREAM_RESPONSE_BAD_STREAM:case er.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ae(F.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case er.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ae(F.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new ae(F.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new ae(F.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case er.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ae(F.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new ae(F.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case er.LIVE_STREAM_RESPONSE_WORKER_LOST:case er.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case er.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ae(F.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Ry)},6e3)}}function T6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function zi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Nq extends bn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qn;super(),x(this,"onLiveStreamWarning",void 0),x(this,"onLiveStreamError",void 0),x(this,"spec",void 0),x(this,"retryTimeout",1e4),x(this,"connection",void 0),x(this,"httpRetryConfig",void 0),x(this,"wsRetryConfig",void 0),x(this,"streamingTasks",new Map),x(this,"isStartingStreamingTask",!1),x(this,"taskMutex",new jr("live-streaming")),x(this,"cancelToken",Ai.CancelToken.source()),x(this,"transcodingConfig",void 0),x(this,"uapResponse",void 0),x(this,"lastTaskId",1),x(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=zi(zi({},gz),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(o=>zi(zi(zi({},_z),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){Pn(o.width)||nn(o.width,"config.width",0,1e4),Pn(o.height)||nn(o.height,"config.height",0,1e4),Pn(o.videoBitrate)||nn(o.videoBitrate,"config.videoBitrate",1,1e6),Pn(o.videoFrameRate)||nn(o.videoFrameRate,"config.videoFrameRate"),Pn(o.lowLatency)||ga(o.lowLatency,"config.lowLatency"),Pn(o.audioSampleRate)||ir(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Pn(o.audioBitrate)||nn(o.audioBitrate,"config.audioBitrate",1,128),Pn(o.audioChannels)||ir(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Pn(o.videoGop)||nn(o.videoGop,"config.videoGop"),Pn(o.videoCodecProfile)||ir(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Pn(o.userCount)||nn(o.userCount,"config.userCount",0,17),Pn(o.backgroundColor)||nn(o.backgroundColor,"config.backgroundColor",0,16777215),Pn(o.userConfigExtraInfo)||Cr(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Pn(o.transcodingUsers)&&(ul(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((c,l)=>{qy(c.uid),Pn(c.x)||nn(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),Pn(c.y)||nn(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),Pn(c.width)||nn(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),Pn(c.height)||nn(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),Pn(c.zOrder)||nn(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),Pn(c.alpha)||nn(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),Pn(o.watermark)||Db(o.watermark,"watermark"),Pn(o.backgroundImage)||Db(o.backgroundImage,"backgroundImage"),o.images&&!Pn(o.images)&&(ul(o.images,"config.images"),o.images.forEach((c,l)=>{Db(c,"images[".concat(l,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(o=>zi(zi(zi({},Pb),o),{},{zOrder:255}))),n.backgroundImage&&(r.push(zi(zi(zi({},Pb),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(zi(zi(zi({},Pb),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(o=>zi({},o)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(o=>typeof o.uid=="number"?je.resolve(o.uid):YU(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await je.all(i)).forEach((o,c)=>{n.userConfigs&&n.userConfigs[c]&&(n.userConfigs[c].uid=o)}),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(rs(s=this.streamingTasks).call(s)).map(c=>c.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(l=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})})}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===hl.TRANSCODE)throw new ae(F.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new ae(F.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(c){throw s(),c}switch(n){case hl.TRANSCODE:i.transcodingConfig=zi({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const c=new je((p,m)=>{Rr(this.retryTimeout).then(()=>{if(r)return m(r);const E=this.statusError.get(t);return E?(this.statusError.delete(t),m(E)):void 0})}),l=await je.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===hl.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||r)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,c)):await this.startLiveStreamingTask(t,n,c)}}stopLiveStreamingTask(t){return new je((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new ae(F.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===hl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;const n=Array.from(rs(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ai.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ae(F.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Dr(this,kb.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new Oq(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Cd.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Cd.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Cd.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new ae(F.UNEXPECTED_ERROR,"can not get new live streaming address list"));Dr(this,kb.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new ae(F.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return R.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new ae(F.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case er.LIVE_STREAM_RESPONSE_WORKER_LOST:case er.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(rs(s=this.streamingTasks).call(s));for(const c of o)c.abortTask?c.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(l=>{R.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Pq={name:"LiveStreaming",create:function(e){return new Nq(e.joinInfo,e.websocketRetryConfig||qn,e.httpRetryConfig||qn)}};function Dq(e){let t=w6();return function(n,r){let i=n.appId;i!==void 0&&(Zt(r,10),Nc(r,i));let s=n.cid;s!==void 0&&(Zt(r,16),Zt(r,s));let o=n.cname;o!==void 0&&(Zt(r,26),Nc(r,o));let c=n.deviceId;c!==void 0&&(Zt(r,34),Nc(r,c));let l=n.elapse;l!==void 0&&(Zt(r,40),jd(r,l));let p=n.fileSize;p!==void 0&&(Zt(r,48),jd(r,Zf(p)));let m=n.height;m!==void 0&&(Zt(r,56),jd(r,Zf(m)));let E=n.jpg;E!==void 0&&(Zt(r,66),Zt(r,E.length),function(Hr,Ee){let Ne=$f(Hr,Ee.length);Hr.bytes.set(Ee,Ne)}(r,E));let v=n.networkType;v!==void 0&&(Zt(r,72),jd(r,Zf(v)));let y=n.osType;y!==void 0&&(Zt(r,80),jd(r,Zf(y)));let D=n.requestId;D!==void 0&&(Zt(r,90),Nc(r,D));let A=n.sdkVersion;A!==void 0&&(Zt(r,98),Nc(r,A));let N=n.sequence;N!==void 0&&(Zt(r,104),jd(r,Zf(N)));let j=n.sid;j!==void 0&&(Zt(r,114),Nc(r,j));let V=n.timestamp;V!==void 0&&(Zt(r,120),jd(r,V));let G=n.uid;G!==void 0&&(Zt(r,128),Zt(r,G));let $=n.vid;$!==void 0&&(Zt(r,136),Zt(r,$));let Q=n.width;Q!==void 0&&(Zt(r,144),jd(r,Zf(Q)));let z=n.service;z!==void 0&&(Zt(r,152),Zt(r,z));let re=n.callbackData;re!==void 0&&(Zt(r,162),Nc(r,re));let fe=n.jpgEncryption;fe!==void 0&&(Zt(r,168),Zt(r,fe));let ve=n.requestType;ve!==void 0&&(Zt(r,176),Zt(r,ve));let Re=n.scorePorn;Re!==void 0&&(Zt(r,185),VI(r,Re));let Ct=n.scoreSexy;Ct!==void 0&&(Zt(r,193),VI(r,Ct));let bt=n.scoreNeutral;bt!==void 0&&(Zt(r,201),VI(r,bt));let ut=n.scene;ut!==void 0&&(Zt(r,208),Zt(r,ut));let Yt=n.ossFilePrefix;Yt!==void 0&&(Zt(r,218),Nc(r,Yt));let Ht=n.serviceVendor;if(Ht!==void 0)for(let Hr of Ht){Zt(r,226);let Ee=w6();xq(Hr,Ee),Zt(r,Ee.limit),jq(r,Ee),Vq(Ee)}}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function kq(e){return function(n){let r={};e:for(;!b6(n);){let i=Pc(n);switch(i>>>3){case 0:break e;case 1:r.code=Pc(n);break;case 2:r.msg=I6(n,Pc(n));break;case 3:{let s=Mq(n);r.data=Lq(n),n.limit=s;break}default:C6(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function Lq(e){let t={};e:for(;!b6(e);){let n=Pc(e);switch(n>>>3){case 0:break e;case 1:t.requestId=I6(e,Pc(e));break;case 2:t.requestType=Pc(e)>>>0;break;case 3:t.scorePorn=UI(e);break;case 4:t.scoreSexy=UI(e);break;case 5:t.scoreNeutral=UI(e);break;case 6:t.requestScene=Pc(e)>>>0;break;case 7:t.scene=Pc(e)>>>0;break;default:C6(e,7&n)}}return t}function xq(e,t){let n=e.service;n!==void 0&&(Zt(t,8),Zt(t,n));let r=e.vendor;r!==void 0&&(Zt(t,16),Zt(t,r));let i=e.token;i!==void 0&&(Zt(t,26),Nc(t,i));let s=e.callbackUrl;s!==void 0&&(Zt(t,34),Nc(t,s))}function Mq(e){let t=Pc(e),n=e.limit;return e.limit=e.offset+t,n}function C6(e,t){switch(t){case 0:for(;128&A6(e););break;case 2:xI(e,Pc(e));break;case 5:xI(e,4);break;case 1:xI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Uq=new Float32Array(1);new Uint8Array(Uq.buffer);let LI=new Float64Array(1),Yi=new Uint8Array(LI.buffer);function Zf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let R6=[];function w6(){const e=R6.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Vq(e){R6.push(e)}function xI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function b6(e){return e.offset>=e.limit}function $f(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function MI(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function I6(e,t){let n=MI(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,p,m,E,v=i[c+n];(128&v)==0?o+=r(v):(224&v)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&v)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&v)==224?c+2>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],(49344&(l|p<<8))!=32896?o+=s:(E=(15&v)<<12|(63&l)<<6|63&p,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&v)==240?c+3>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],m=i[c+n+3],(12632256&(l|p<<8|m<<16))!=8421504?o+=s:(E=(7&v)<<18|(63&l)<<12|(63&p)<<6|63&m,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function Nc(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}Zt(e,r);let i=$f(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function jq(e,t){let n=$f(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,o=t.limit;s<o;s++)r[s+n]=i[s]}function A6(e){return e.bytes[MI(e,1)]}function O6(e,t){let n=$f(e,1);e.bytes[n]=t}function UI(e){let t=MI(e,8),n=e.bytes;return Yi[0]=n[t++],Yi[1]=n[t++],Yi[2]=n[t++],Yi[3]=n[t++],Yi[4]=n[t++],Yi[5]=n[t++],Yi[6]=n[t++],Yi[7]=n[t++],LI[0]}function VI(e,t){let n=$f(e,8),r=e.bytes;LI[0]=t,r[n++]=Yi[0],r[n++]=Yi[1],r[n++]=Yi[2],r[n++]=Yi[3],r[n++]=Yi[4],r[n++]=Yi[5],r[n++]=Yi[6],r[n++]=Yi[7]}function Pc(e){let t,n=0,r=0;do t=A6(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Zt(e,t){for(t>>>=0;t>=128;)O6(e,127&t|128),t>>>=7;O6(e,t)}function jd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=$f(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}function N6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const Fq=new Map([["moderation",1],["supervise",2]]);class Bq extends bn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(gr.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Ui(n=t.map(r=>Fq.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),x(this,"name","AgoraRTCVideoContentInspect"),x(this,"_connectionState",jo.CONNECTING),x(this,"_innerConnectionState",void 0),x(this,"sequence",0),x(this,"inspectStartTime",void 0),x(this,"workerManagerConnection",void 0),x(this,"workerConnection",void 0),x(this,"workerMessageLengthLimit",void 0),x(this,"inspectIntervalMinimum",void 0),x(this,"qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Ai.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"wmSequence",0),x(this,"inspectInterval",void 0),x(this,"inspectTimer",null),x(this,"ossFilePrefix",void 0),x(this,"extraInfo",void 0),x(this,"_inspectType",void 0),x(this,"_inspectMode",void 0),x(this,"_quality",1),x(this,"qualityTimer",null),x(this,"_inspectId",void 0),x(this,"_needWorkUrlOnly",!1),x(this,"inspectImage",()=>{if(this.connectionState!==jo.CONNECTED)throw new ae(F.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===jo.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=on(5,"inspect-"),this.workerMessageLengthLimit=W("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=W("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=W("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Fg("worker-manager-"+this._inspectId,qn),this.on(gr.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Fo[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Fg("worker-"+this._inspectId,qn),this.handleWorkerEvents()}async init(t,n){this.emit(gr.STATE_CHANGE,Fo.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new je((i,s)=>{this.on(gr.CONNECTION_STATE_CHANGE,(o,c)=>{c===jo.CONNECTED&&i()}),this.requestAP(t,r,n).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(t,n,r){const i=W("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),s=await function(c,l,p,m){let{appId:E,areaCode:v,cname:y,sid:D,token:A,uid:N}=l;Wf++;const j="image_moderation_api",V={service_name:j,json_body:JSON.stringify({appId:E,areaCode:v,cname:y,command:"allocateEdge",requestId:Wf,seq:Wf,sid:D,token:A,ts:Date.now(),uid:N+""})};let G,$,Q=c[0];return Ea(async()=>{G=Date.now();const z=await Ca(Q,{data:V,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-G,z.code!==0){const Re=new ae(F.UNEXPECTED_RESPONSE,"image inspect ap error, code"+z.code,{retry:!0,responseTime:$});throw R.error(Re.toString()),Re}const re=JSON.parse(z.json_body);if(re.code!==200){const Re=new ae(F.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(re.code,", reason: ").concat(re.reason),{code:re.code,responseTime:$});throw R.error(Re.toString()),Re}if(!re.servers||!Array.isArray(re.servers)||re.servers.length===0){const Re=new ae(F.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:re.code,responseTime:$});throw R.error(Re.toString()),Re}const fe=W("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ve=W("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:re.servers.map(Re=>{let{address:Ct,wss:bt}=Re;if(Ct&&bt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(fe,":").concat(ve||bt)}).filter(Re=>!!Re),workerToken:re.workerToken,vid:re.vid,responseTime:$}},(z,re)=>(qe.apworkerEvent(D,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify(z.addressList),firstSuccess:re===0,responseTime:$,serverIp:c[re%c.length]}),!1),(z,re)=>(qe.apworkerEvent(D,{success:!1,sc:z.data&&z.data.code||200,serviceName:j,responseTime:$,serverIp:c[re%c.length]}),!!(z.code!==F.OPERATION_ABORTED&&z.code!==F.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(Q=c[(re+1)%c.length],!0)),m)}(i,t,n,r);this.emit(gr.STATE_CHANGE,Fo.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(gr.STATE_CHANGE,Fo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(vt.CONNECTED,async()=>{this.emit(gr.STATE_CHANGE,Fo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(vt.CLOSED,()=>{this._innerConnectionState<Fo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(vt.FAILED,()=>{this._innerConnectionState<Fo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(vt.RECONNECTING,()=>{this._innerConnectionState<Fo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(vt.ON_MESSAGE,async t=>{this.emit(gr.STATE_CHANGE,Fo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new ae(F.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new ae(F.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=W("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(gr.STATE_CHANGE,Fo.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(gr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(vt.CONNECTED,async()=>{this.emit(gr.STATE_CHANGE,Fo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=jo.CONNECTED}),this.workerConnection.on(vt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=kq(new Uint8Array(t.data));if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(gr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Ui(n=Object.keys(i)).call(n,(c,l)=>i[c]>i[l]?c:l,"porn"),o=Object.keys(i).find(c=>c===s);this.emit(gr.INSPECT_RESULT,o)}else this.emit(gr.INSPECT_RESULT,void 0,new ae(F.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(gr.INSPECT_RESULT,void 0,new ae(F.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(gr.INSPECT_RESULT,void 0,new ae(F.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(vt.CLOSED,()=>{this.connectionState=jo.CLOSED}),this.workerConnection.on(vt.FAILED,()=>{this.connectionState=jo.CLOSED}),this.workerConnection.on(vt.RECONNECTING,()=>{this.connectionState=this.connectionState===jo.CONNECTED?jo.RECONNECTING:jo.CONNECTING}),this.workerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(gr.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const t=Ts(this,gr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(gr.INSPECT_RESULT,void 0,new ae(F.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(gr.INSPECT_RESULT,void 0,new ae(F.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await dx(m,r,i),v=this.sequence+"-"+s+"-"+l+"-"+p+"-"+on(12,""),y={appId:r,cid:s,cname:i,deviceId:"",elapse:(D=Number(p-this.inspectStartTime),{low:D|=0,high:D>>31,unsigned:D>=0}),fileSize:E.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:V5(p),uid:l,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var D;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const A=Dq(y);if(A.byteLength<this.workerMessageLengthLimit){if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const N=function(j){for(var V=1;V<arguments.length;V++){var G=arguments[V]!=null?arguments[V]:{};V%2?N6(Object(G),!0).forEach(function($){x(j,$,G[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(G)):N6(Object(G)).forEach(function($){Object.defineProperty(j,$,Object.getOwnPropertyDescriptor(G,$))})}return j}({},y);delete N.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return A}{const N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ai.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=jo.CLOSED,this.emit(gr.STATE_CHANGE,Fo.CLOSED)}}const Wq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new ae(F.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new ae(F.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var s;if(!Ae(s=["supervise","moderation"]).call(s,i))throw new ae(F.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new ae(F.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Bq(t)}};var P6=S(Qr.Object.getOwnPropertySymbols),Gq=qt,Hq=Zh.indexOf,Kq=Eu,jI=Ve([].indexOf),D6=!!jI&&1/jI([1],1,-0)<0;Gq({target:"Array",proto:!0,forced:D6||!Kq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return D6?jI(this,e,t)||0:Hq(this,e,t)}});var zq=Qi("Array","indexOf"),Yq=Y,qq=zq,FI=Array.prototype,Xq=function(e){var t=e.indexOf;return e===FI||Yq(FI,e)&&t===FI.indexOf?qq:t},k6=S(Xq);function Jq(e,t){if(e==null)return{};var n,r,i=function(o,c){if(o==null)return{};var l={};for(var p in o)if({}.hasOwnProperty.call(o,p)){if(k6(c).call(c,p)!==-1)continue;l[p]=o[p]}return l}(e,t);if(P6){var s=P6(e);for(r=0;r<s.length;r++)n=s[r],k6(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let L6=class{get localCapabilities(){return Cn(this._localCapabilities)}get rtpCapabilities(){return Cn(this._rtpCapabilities)}get candidates(){return Cn(this._candidates)}get iceParameters(){return Cn(this._iceParameters)}get dtlsParameters(){return Cn(this._dtlsParameters)}constructor(e){x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_iceParameters",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname","o/i14u9pJrxRKAsu"),x(this,"firefoxSsrcMidMap",new Map),e=Cn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:c,videoCodec:l,audioCodec:p}=e;let m;this.setup=c,m=o===Ei.RECEIVE_ONLY?Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const E=o===Ei.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=o===Ei.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=o===Ei.RECEIVE_ONLY?i.send.videoCodecs:Hg(Be.VIDEO,E,v,l),D=o===Ei.RECEIVE_ONLY?i.send.audioCodecs:Hg(Be.AUDIO,E,v,p);for(const A of m.mediaDescriptions)A.attributes.iceUfrag=t.iceUfrag,A.attributes.icePwd=t.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=r,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=y.map(N=>N.payloadType.toString(10)),A.attributes.payloads=y,A.attributes.extmaps=E.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=D.map(N=>N.payloadType.toString(10)),A.attributes.payloads=D,A.attributes.extmaps=E.audioExtensions,Bf(A));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return yd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=Gg(t,this.cname,W("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(s);if(c){if(Nn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(e,s,r);let p;return l===-1?(p=this.createOrRecycleSendMedia(e,s,o,"sendonly",r,i),this.updateBundleMids()):(p=Cn(this.sessionDesc.mediaDescriptions[l]),p.attributes.direction="sendonly",p.attributes.ssrcs=s,p.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(p,i)),Nn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let c,l=!1;o===-1?(l=!0,c=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(c=Cn(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),r.push({mid:c.attributes.mid,needCreateTransceiver:l})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:o,relatedPort:c,priority:l}=new RTCIceCandidate(e),p={foundation:t??"",componentId:"1",transport:n??"",priority:l?l+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some(m=>m.priority===p.priority&&m.connectionAddress===p.connectionAddress&&m.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=Hg(s,o,this.localCapabilities.send,s===Be.AUDIO?i:r),l=s===Be.VIDEO?o.videoExtensions:o.audioExtensions,p="".concat(++this.currentMidIndex);let m={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungRecvMediaDsec(m,e);const E=this.findFirstClosedMedia(s);if(E){const v=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ae(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ae(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Nn()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Cn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,s){const o=this.rtpCapabilities.send,c=e===Be.VIDEO?o.videoCodecs:o.audioCodecs,l=e===Be.VIDEO?o.videoExtensions:o.audioExtensions;Nn()&&(i="".concat(++this.currentMidIndex));let p={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};p=this.mungSendMediaDesc(p,s);const m=this.findFirstClosedMedia(e);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(e,t,n){const r=Cn(e);return jb(r),Ff(r,t),Fb(r,t),IU(r),nT(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Cn(e);return nT(n,t,this.localCapabilities.recv),Bf(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Nn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Qq=["sdp"];var _n;function x6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let M6=(_n=class nm extends lU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),x(this,"direction",void 0),x(this,"name",void 0),x(this,"store",void 0),x(this,"spec",void 0),x(this,"peerConnection",void 0),x(this,"initialOffer",void 0),x(this,"transport",void 0),x(this,"statsFilter",void 0),x(this,"localCandidateCount",0),x(this,"_isInRestartIce",!1),x(this,"mutex",void 0),x(this,"onLocalCandidate",void 0),x(this,"remoteSDP",void 0),x(this,"pendingCandidates",[]),x(this,"localCapabilities",void 0),x(this,"isReady",!1),x(this,"restartCnt",0),x(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(nm.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Ei.SEND_ONLY,this.name=this.direction===Ei.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=qw(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await OU();if(this.localCapabilities=rT(n),t){const{sdp:r}=t,i=Jq(t,Qq),s=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Wg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(E,m,"videoExtensions",v,y,D),Bo(E,m,"videoCodecs",v,y,D),Bo(E,m,"audioExtensions",v,y,D),Bo(E,m,"audioCodecs",v,y,D),W("RAISE_H264_BASELINE_PRIORITY")){const A=D.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]==="42001f");if(A!==-1){const N=D.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(N<A){R.debug("raising H264 baseline profile priority");const j=D.videoCodecs[A];D.videoCodecs.splice(A,1),D.videoCodecs.splice(N,0,j)}N!==-1&&W("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(j=>!(j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:y,sendrecv:D}}({},{},r);this.remoteSDP=new L6({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=Id(o.sdp);await this.peerConnection.setLocalDescription(o);const l=await NU({},{},o.sdp);this.localCapabilities=rT(l);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),Fd(Fd({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Id(r.sdp);return this.initialOffer=r,Fd(Fd({},i),{},{sdp:r.sdp})}}catch(n){throw new pe(F.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,s=await NU({},{},n);this.remoteSDP=new L6({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new pe(F.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return Js(function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=i.remoteSDP.receive(t,n,r);t.forEach((N,j)=>{if(c[j].needCreateTransceiver){const V=i.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});o.push(V),N._updateRtpTransceiver(V)}else{const V=i.peerConnection.getTransceivers().find(G=>G.mid===c[j].mid);if(!V)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[j].mid));o.push(V),N._updateRtpTransceiver(V)}}),Nn()&&W("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=c.map(N=>N.mid),p=yield jt(i.peerConnection.createOffer()),m=i.mungSendOfferSDP(p.sdp,t,l),E=Gi(m),v=l.map(N=>{const j=E.mediaDescriptions.find(V=>V.attributes.mid===N);if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return RU(j,W("USE_PUB_RTX"))}),y=o.map((N,j)=>{const V=l[j];return{localSSRC:v[j],id:V}});yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(N){const j=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:j})),yield jt(i.stopSending(l,!0)),N}yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t));const D=i.remoteSDP.toString(),A=i.logSDPExchange(m,"offer","local","send");return A?.(D),yield jt(i.setRemoteDescription({type:"answer",sdp:D})),o.map((N,j)=>{const V=l[j];return{localSSRC:v[j],id:V}})}catch(o){throw o instanceof pe?o:new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(l=>{var p;l.direction="inactive",(p=l.stop)===null||p===void 0||p.call(l)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,s,t);p?.(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const c=this.remoteSDP.toString(),l=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,t);l?.(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===fh.Auto&&(this.store.p2pTransport=fh.SdRtn,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(nm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(nm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Id(n.sdp);return this.store.descriptionStart(),this.direction===Ei.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ei.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Id(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new pe(F.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Fd(Fd({},vc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Fd(Fd({},vc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Ae(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ig(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...nm.turnServerConfigToIceServers(t.turnServer.servers,n,r)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...nm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Ae(s=[fh.Relay,fh.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter(c=>c.tcpport);R.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(n){case fh.SdRtn:const c=t.filter(p=>{var m;return Ae(m=p.username).call(m,"glb:")&&p.turnServerURL==p.turnServerURL}),l=c.length>r?c[r]:c[0];l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(wd(l.turnServerURL),":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(wd(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;case fh.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(wd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(wd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t?.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){const s=r.address+":"+r.port,o=i.address+":"+i.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Th(s)),", remote ").concat(JSON.stringify(Th(o))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:m,frameRate:E,scaleResolutionDownBy:v}=t._encoderConfig;m&&(s.maxBitrate=1e3*m),Ae(o=t._hints).call(o,rn.LOW_STREAM)&&(E&&(s.maxFramerate=as(E)),v&&v>=1&&(s.scaleResolutionDownBy=v))}if(W("DSCP_TYPE")&&dl()){var c;const m=W("DSCP_TYPE");Ae(c=["very-low","low","medium","high"]).call(c,m)&&(s.networkPriority=m)}const l=n.getParameters(),p=(r=l.encodings)===null||r===void 0?void 0:r[0];Nn()&&!p&&(i.encodings=[s]),p&&Object.assign(p,s),Object.assign(l,i),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof mn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Gi(t);return n.forEach((s,o)=>{const c=r[o],l=i.mediaDescriptions.find(p=>p.attributes.mid===c);l&&(Ff(l,s),AU(l,s,this.store.codec))}),yd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const p=t[l],m=n[l];if(m instanceof mn&&!Ae(r=m._hints).call(r,rn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,n){if(!Nn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof mn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof mn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ae(n=t._hints).call(n,rn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async o=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const s=(i=Gi(n).mediaDescriptions.find(o=>o.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return s?.[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Ae(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=Gi(t),s=i.mediaDescriptions.find(o=>o.attributes.mid===n);return s&&r===Be.AUDIO&&s.media.mediaType==="audio"&&Bf(s),yd(i)}},Ye(_n.prototype,"establish",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"establish"),_n.prototype),Ye(_n.prototype,"connect",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"connect"),_n.prototype),Ye(_n.prototype,"receive",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"receive"),_n.prototype),Ye(_n.prototype,"mockReceive",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"mockReceive"),_n.prototype),Ye(_n.prototype,"stopReceiving",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"stopReceiving"),_n.prototype),Ye(_n.prototype,"restartICE",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"restartICE"),_n.prototype),Ye(_n.prototype,"close",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"close"),_n.prototype),Ye(_n.prototype,"updateEncoderConfig",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"updateEncoderConfig"),_n.prototype),Ye(_n.prototype,"updateSendParameters",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"updateSendParameters"),_n.prototype),Ye(_n.prototype,"replaceTrack",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"replaceTrack"),_n.prototype),Ye(_n.prototype,"muteLocal",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"muteLocal"),_n.prototype),Ye(_n.prototype,"unmuteLocal",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"unmuteLocal"),_n.prototype),_n);function zo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}let ba=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var U6,V6,j6,F6,B6,W6,G6,H6,K6,z6,Y6,Rn;function q6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function FT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?q6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Zq=(U6=Ia(ba.SEND_ONLY),V6=Ia(ba.SEND_ONLY),j6=Ia(),F6=Ia(ba.RECEIVE_ONLY),B6=Ia(ba.RECEIVE_ONLY),W6=Ia(ba.RECEIVE_ONLY),G6=Ia(ba.RECEIVE_ONLY),H6=Ia(ba.RECEIVE_ONLY),K6=Ia(ba.RECEIVE_ONLY),z6=Ia(),Y6=Ia(ba.RECEIVE_ONLY),Rn=class extends bn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(et.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",!1),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"sendConnection",void 0),x(this,"recvConnection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"statsCollector",void 0),x(this,"dtlsFailedCount",0),x(this,"sendMutex",void 0),x(this,"recvMutex",void 0),x(this,"_state",Jt.Disconnected),x(this,"_restartStates",["disconnected","failed"]),x(this,"reconnectInterval",void 0),x(this,"uploadUnplinkStarted",!1),x(this,"uploadDownlinkStarted",!1),x(this,"uplinkStateUploadInterval",void 0),x(this,"downlinkStatsUploadInterval",void 0),x(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void r();const p=l.find(y=>y[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(l.map(y=>{let[,{id:D}]=y;return D}));let m=!1;var o,c;n.trackMediaType==="video"?m=!((o=this.localTrackMap.get(Te.LocalAudioTrack))===null||o===void 0||!o.track._muted):m=((c=this.localTrackMap.get(Te.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const E=this.createMuteMessage(l);await sn(this,et.RequestMuteLocal,E);const v=n.trackMediaType==="video"?Rd.MUTE_LOCAL_VIDEO:Rd.MUTE_LOCAL_AUDIO;await sn(this,et.RequestP2PMuteLocal,{action:v,message:E,isMuteAll:m}),r()}catch(l){i(l)}finally{s()}}),x(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const c=this.createUnmuteMessage(o),l=n.trackMediaType==="video"?Rd.UNMUTE_LOCAL_VIDEO:Rd.UNMUTE_LOCAL_AUDIO;await sn(this,et.RequestP2PMuteLocal,{action:l,message:c}),r()}catch(o){i(o)}finally{s()}}),x(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let o;typeof s=="boolean"&&s||(o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==Jt.Connected)return void r();const{id:p,track:m}=l;p&&(await this.sendConnection.updateSendParameters(p,m),await this.sendConnection.updateEncoderConfig(p,m),this.emit(et.UpdateVideoEncoder,m)),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}}),x(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Jt.Connected)return void r();const{id:c,track:l}=o;c&&await this.sendConnection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==Jt.Connected)return void r();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),p[0]===Te.LocalVideoTrack&&Ft().supportDualStreamEncoding){const m=this.localTrackMap.get(Te.LocalVideoLowTrack);if(m){const E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new je((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}r()}catch(p){i(p)}finally{var l;(l=o)===null||l===void 0||l()}}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new u5(e),this.bindStatsUploaderEvents(),this.sendMutex=new jr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new jr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},W("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new M6(e,this.store,Ei.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Jt.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new M6(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected}async addRemoteCandidate(e,t){if(t===Ei.RECEIVE_ONLY){if(!this.sendConnection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return Js(function*(){const i=yield jt(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Jt.Connected){r.throwIfTrackTypeNotMatch(e);const p=e.filter(m=>r.pendingLocalTracks.indexOf(m)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(p))}r.store.pubId=r.store.pubId+1,Gr.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));s.forEach(p=>{let{track:m,type:E}=p;const v=Date.now();r.store.publish(m.getTrackId(),E===Te.LocalAudioTrack?"audio":"video",v)}),r.bindLocalTrackEvents(s);const o=yield jt(r.sendConnection.send(s.map(p=>{let{track:m}=p;return m}),r.store.codec,r.store.audioCodec)),c=(yield jt(o.next())).value,l=r.createGatewayPublishMessage(s,c);try{yield l}catch(p){throw o.throw(p),p?.code===F.WS_ABORT&&s.forEach(m=>{let{track:E}=m;r.pendingLocalTracks.indexOf(E)===-1&&r.pendingLocalTracks.push(E)}),r.unbindLocalTrackEvents(s),p}yield jt(o.next()),s.forEach(p=>{let{type:m}=p;r.statsCollector.addLocalStats(m)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,c),s.forEach(p=>{let{track:m,type:E}=p;const v=Date.now();r.store.publish(m.getTrackId(),E===Te.LocalAudioTrack?"audio":"video",void 0,v)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Jt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Ae(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Jt.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s,ssrcs:o}]=r;const c={stream_type:Hz(s,i),ssrcs:o};s._muted||!s._enabled?t.push(c):n.push(c)}),t.length>0&&t.forEach(r=>{sn(this,et.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{sn(this,et.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Js(function*(){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Dr(this,et.RequestRePublish,this.pendingLocalTracks),this.emit(et.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===Be.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Df(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Pf(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:v}=m;return E.uid===e.uid&&t===v});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(et.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:c}=s;return t!==void 0?o.uid===e.uid&&t===c:o.uid===e.uid});if(r.forEach(s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||n||r.forEach(s=>{let{kind:o}=s;var c;if(o===Be.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(o===Be.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[o,{kind:c}]=s;var l,p;if(c===Be.VIDEO&&o._videoSSRC&&((l=this.recvConnection)===null||l===void 0||l.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===Be.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((p=o._videoTrack)===null||p===void 0||p._destroy(),o._videoTrack=void 0);else if(c===Be.AUDIO){var m;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((m=o._audioTrack)===null||m===void 0||m._destroy(),o._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:o}]=s;sn(this,et.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Be.VIDEO,Be.AUDIO].forEach(r=>{n.has(r)?sn(this,et.RequestP2PUnmuteRemote,r):sn(this,et.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Be.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t?.track instanceof $n){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Te.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Te.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Te.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Te.LocalAudioTrack),c=r?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(l=>l instanceof Ln),c=r?(s=this.localTrackMap.get(Te.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof mn);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Be.VIDEO?n._videoSSRC:n._audioSSRC;i&&qe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Be.VIDEO,audio:r===Be.AUDIO,peerid:n.uid,subscribeRequestid:r===Be.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Gr.measureFromSubscribeStart(this.store.clientId,i)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new jr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new jr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e?.track instanceof $n){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Jt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof mn||t&&t.track instanceof Ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=nh(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Te.LocalVideoTrack:Ae(t=r._hints).call(t,rn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Te.LocalAudioTrack:r instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Te.LocalVideoLowTrack:}}),this.emit(et.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(et.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Ei.SEND_ONLY){if(!this.sendConnection)throw new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await Dr(this,et.RequestP2PRestartICE,{direction:Ei.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalAudioTrack),r=e.videoSend.find(y=>{var D;return y.ssrc===(t==null||(D=t.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),i=e.audioSend.find(y=>{var D;return y.ssrc===(n==null||(D=n.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!r||!i)return 1;const s=Ts(this,et.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,p=(l&&s?(l+s)/2:l||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t?.track;if(v&&v._encoderConfig&&v._hints.indexOf(rn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return tU[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===i),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const l=Ts(this,et.NeedSignalRTT),p=e.rtt,m=(p&&l?(p+l)/2:p||l)||0,E=o?o.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;E&&(y=.6*v*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new je((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=Ft(),s=this.getAllTracks();e=Ef(e=e.filter(l=>s.indexOf(l)===-1));let o=!1,c=!1;for(const l of e){if(l instanceof mn&&(this.localTrackMap.has(Te.LocalVideoTrack)||o?new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Te.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(l,n);r.push({track:p,type:Te.LocalVideoLowTrack})}if(l instanceof Ln){const p=this.localTrackMap.get(Te.LocalAudioTrack);if(p){if(!(p.track instanceof $n))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0)}else if(c){const m=r.find(E=>{let{type:v}=E;return v===Te.LocalAudioTrack});if(!(m.track instanceof $n))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(l)}else{if(!i.webAudioMediaStreamDest||l instanceof $n||l._bypassWebAudio)r.push({track:l,type:Te.LocalAudioTrack});else{const m=new $n;m.addAudioTrack(l),r.push({track:m,type:Te.LocalAudioTrack})}c=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Ef(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Ln){const i=this.localTrackMap.get(Te.LocalAudioTrack);if(!i)continue;i.track instanceof $n?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,i]),i.track.close())):t.push([Te.LocalAudioTrack,i])}if(r instanceof mn){const i=this.localTrackMap.get(Te.LocalVideoTrack);if(!i)continue;t.push([Te.LocalVideoTrack,i]);const s=this.localTrackMap.get(Te.LocalVideoLowTrack);s&&t.push([Te.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.addListener(Ke.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof $n?e.trackList.forEach(n=>{n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.off(Ke.GET_STATS,this.handleGetLocalVideoStats),n.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof $n?e.trackList.forEach(t=>{t.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ke.GET_STATS,this.handleGetLocalAudioStats),t.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ke.GET_STATS,this.handleGetLocalAudioStats),e.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Pf&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Df&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ke.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Be.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Be.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,{track:o,type:c}=n;switch(c){case Te.LocalAudioTrack:s=Qt.Audio;break;case Te.LocalVideoTrack:s=Ae(i=o._hints).call(i,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:s=Qt.Low}return{kind:c===Te.LocalAudioTrack?Be.AUDIO:Be.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(et.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ae(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Rr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(et.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit($s.FIRST_FRAME_DECODED),qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(et.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(et.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ei.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ei.SEND_ONLY?this.restartICE(e):Dr(this,et.RequestP2PRestartICE,{direction:Ei.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive||t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===Te.LocalVideoTrack)){const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive&&t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===Te.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Be.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Be.VIDEO,ssrcId:r._videoSSRC}));case Be.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Be.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new je((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new je((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Ln){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await sn(this,et.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(et.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(et.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rr(Ww(this.dtlsFailedCount,qn)),this.emit(et.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof mn).length>1)throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ln).length>1&&(e.some(t=>t instanceof Ln&&t._bypassWebAudio)||!Ft().webAudioMediaStreamDest))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof mn&&this.pendingLocalTracks.some(n=>n instanceof mn))throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ln&&this.pendingLocalTracks.some(n=>n instanceof Ln)&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ln&&n._bypassWebAudio)))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,r=FT(FT({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():iI(e,r);const s=on(8,"track-low-"),o=new mn(i,FT(FT({},n&&{scaleResolutionDownBy:Vb(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(mh.TRANSCEIVER_UPDATED,c=>{e._updateRtpTransceiver(c,wf.LOW_STREAM)}),o._hints.push(rn.LOW_STREAM),e.addListener(Ke.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(l=>l.userId===s.uid&&l.type==="video");qe.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new pe(F.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new pe(F.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}async preConnect(e){throw new pe(F.NOT_SUPPORTED)}getEstablishParams(){throw new pe(F.NOT_SUPPORTED)}async reSubscribe(e){throw new pe(F.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new pe(F.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Te.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,wf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ye(Rn.prototype,"p2pConnect",[U6],Object.getOwnPropertyDescriptor(Rn.prototype,"p2pConnect"),Rn.prototype),Ye(Rn.prototype,"unpublish",[V6],Object.getOwnPropertyDescriptor(Rn.prototype,"unpublish"),Rn.prototype),Ye(Rn.prototype,"unpublishLowStream",[j6],Object.getOwnPropertyDescriptor(Rn.prototype,"unpublishLowStream"),Rn.prototype),Ye(Rn.prototype,"subscribe",[F6],Object.getOwnPropertyDescriptor(Rn.prototype,"subscribe"),Rn.prototype),Ye(Rn.prototype,"mockSubscribe",[B6],Object.getOwnPropertyDescriptor(Rn.prototype,"mockSubscribe"),Rn.prototype),Ye(Rn.prototype,"unsubscribe",[W6],Object.getOwnPropertyDescriptor(Rn.prototype,"unsubscribe"),Rn.prototype),Ye(Rn.prototype,"muteRemote",[G6],Object.getOwnPropertyDescriptor(Rn.prototype,"muteRemote"),Rn.prototype),Ye(Rn.prototype,"unmuteRemote",[H6],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteRemote"),Rn.prototype),Ye(Rn.prototype,"hasRemoteMediaWithLock",[K6],Object.getOwnPropertyDescriptor(Rn.prototype,"hasRemoteMediaWithLock"),Rn.prototype),Ye(Rn.prototype,"disconnectForReconnect",[z6],Object.getOwnPropertyDescriptor(Rn.prototype,"disconnectForReconnect"),Rn.prototype),Ye(Rn.prototype,"remoteMediaSsrcChanged",[Y6],Object.getOwnPropertyDescriptor(Rn.prototype,"remoteMediaSsrcChanged"),Rn.prototype),Rn);function Ia(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(e){case ba.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}case ba.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l(),p()}}}},r}}class kh extends bn{constructor(t,n){super(),x(this,"signal",void 0),x(this,"token",void 0),x(this,"tokenTimeout",void 0),x(this,"tokenInterval",void 0),x(this,"_sequence",0),x(this,"userMap",new Map),x(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===hn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*W("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,s){var o;if(this.userMap.size===0)return;const c=Array.from(rs(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??on(6,""),s=s??this._sequence++;const l={_id:i,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(c)};W("SHOW_P2P_LOG")&&R.debug("send message",l,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(l)).forEach(m=>{this.signal.request(lt.DATA_STREAM,{payload:Sd(this.encoder.encode(m))})});const p=new je((m,E)=>{const v=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),A),this.off(Uf.ABORT,D),R.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?E(new pe(F.INVALID_REMOTE_USER)):E(new pe(F.TIMEOUT))},W("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{v&&window.clearTimeout(v),this.off(Uf.ABORT,D),r&&m()},D=()=>{v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),A),E(new pe(F.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Uf.ABORT,D),this.once("res-@".concat(i,"_ack"),y);const A=(j,V)=>{N=!0,v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off(Uf.ABORT,D),j==="success"?m(V):E(new pe(F.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let N=!1;r||(this.once("res-@".concat(i),A),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{N||R.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(l))}))});try{return await p}catch(m){if(m.code===F.TIMEOUT)return await this.send(t,n,r,i,s);throw m}}onMessage(t){var n;const{_uid:r}=t;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Vn.CHECK)return;const{token:p}=t;i=new Map,s={uid:r,isStart:!0,token:p,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Pt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:p,total:m}=t,E=(o=i.get(p))!==null&&o!==void 0?o:[];if(E.push(t),i.has(p)||i.set(p,E),E.length!==m)return;{const v=nh(E).call(E,(y,D)=>y.index-D.index).map(y=>y.payload).join("");i.delete(p),(t=JSON.parse(v))._uid=r}}const{_type:c,token:l}=t;if(Ae(n=[Vn.ACK,Vn.CHECK]).call(n,c))return c===Vn.CHECK&&this.handleCheckToken(s,l),void this.receiveMessage(t);l==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):R.debug('Receive unexpected message", '.concat(l,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:on(6,""),token:this.token,_type:Vn.CHECK};W("SHOW_P2P_LOG")&&R.debug("send message",t),this.signal.request(lt.DATA_STREAM,{payload:Sd(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Vn.ACK,token:this.token};W("SHOW_P2P_LOG")&&R.debug("send message",n),this.signal.request(lt.DATA_STREAM,{payload:Sd(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Vn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:E}=p;for(;m.has(E);){const v=m.get(E);m.delete(E),this.receiveMessage(v),p.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:i}=t,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:l}=s;if(i<l)return this.ack(t._id),void R.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));o.set(i,t),c&&i===l&&(this.receiveMessage(t),o.delete(l),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:s}=t;if(W("SHOW_P2P_LOG")&&R.debug("receive message",t),n){let o;switch(t._type!==Vn.ACK&&(i&&(o=JSON.parse(i)),this.ack(t._id)),t._type){case Vn.CANDIDATE:case Vn.CONTROL:this.signal.emit(r,o,s);break;case Vn.PUBLISH:case Vn.UNPUBLISH:case Vn.RESTART_ICE:case Vn.CALL:o.uid=s,Dr(this.signal,r,o).then(c=>{this.response(t._id,c)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Vn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Vn.RESPONSE:{const{success:c,message:l}=o;this.emit("res-@".concat(n),c?"success":"failed",l);break}}}}splitMessage(t){if(t.length<kh.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=on(6,"");let s=0,o=800;const c=Math.ceil(t.length/o);for(;t.length>0;){s++;const l={id:i,index:s,total:c,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(l).length>kh.MAX_MESSAGE_SIZE?o-=50:(n.push(l),t=t.slice(o))}return n.map(l=>JSON.stringify(l))}handleCheckToken(t,n){return t.token!==n?(R.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(n)),this.reset(t.uid)},W("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Dr(this.signal,Vn.CALL,void 0),n=await this.send(Vn.CALL,t);this.signal.emit(ht.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(Uf.ABORT),this.signal.emit(Pt.ON_USER_OFFLINE,{uid:r.uid,reason:Ez.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(R.debug("change local token from ".concat(n," to ").concat(n)),this.token=on(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Uf.ABORT)}}x(kh,"MAX_SIZE",1),x(kh,"MAX_MESSAGE_SIZE",1024);class $q extends bn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===hn.CONNECTED?this.emit(ht.WS_CONNECTED):t===hn.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===hn.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",hn.CLOSED),x(this,"reconnectToken",void 0),x(this,"p2pToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new CL(5)),x(this,"pingpongTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"_external_signal",void 0),x(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Pt.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Pt.MUTE_AUDIO:case Pt.MUTE_VIDEO:case Pt.ON_P2P_LOST:case Pt.ON_USER_ONLINE:return;case Pt.ON_USER_OFFLINE:const{uid:s}=i._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Xt.UID_BANNED);break;case 15:this.close(Xt.IP_BANNED);break;case 16:this.close(Xt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case rt.ERR_LICENSE_MISSING:this.close(Xt.LICENSE_MISSING);break;case rt.ERR_LICENSE_EXPIRED:this.close(Xt.LICENSE_EXPIRED);break;case rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xt.LICENSE_MINUTES_EXCEEDED);break;case rt.ERR_LICENSE_PERIOD_INVALID:this.close(Xt.LICENSE_PERIOD_INVALID);break;case rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xt.LICENSE_MULTIPLE_SDK_SERVICE);break;case rt.ERR_LICENSE_ILLEGAL:this.close(Xt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Mb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hn.CONNECTED&&this.reconnect("retry",Pr.OFFLINE)}),this.p2pToken=on(6,""),this._external_signal=new kh(this,this.p2pToken)}async request(t,n,r,i){const s=on(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new je((D,A)=>{if(this.connectionState===hn.CONNECTED)return D();const N=()=>{this.off(ht.WS_CLOSED,j),D()},j=()=>{this.off(ht.WS_CONNECTED,N),A(new pe(F.WS_ABORT))};this.once(ht.WS_CONNECTED,N),this.once(ht.WS_CLOSED,j)});if(this.connectionState!==hn.CONNECTING&&this.connectionState!==hn.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const p=new je((D,A)=>{let N=!1;const j=(G,$)=>{N=!0,D({isSuccess:G==="success",message:$||{}}),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.emit(ht.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),j);const V=()=>{A(new pe(F.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.off("res-@".concat(s),j)};this.once(ht.WS_CLOSED,V),this.once(ht.WS_RECONNECTING,V),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||N||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===hn.CLOSED||t===lt.LEAVE)throw new pe(F.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?D.throw():t===lt.JOIN||t===lt.REJOIN?null:(await l(),await this.request(t,n))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=jg(E),y=new pe(F.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:v.desc});return v.action==="success"?m.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===rt.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pr.MULTI_IP)):this.reconnect(v.action,Pr.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new je(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ug.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new je((n,r)=>{this.once(ht.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ht.WS_CLOSED,()=>r(this.initError||new pe(F.WS_ABORT))),this.connectionState=hn.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Xt.LEAVE,this.connectionState=hn.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=on(6,""),this._external_signal.clear(),this._external_signal=new kh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await Dr(this,ht.REQUEST_JOIN_INFO),n=await this.request(lt.JOIN,t);if(!n)return this.emit(ht.REPORT_JOIN_GATEWAY,F.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const r=hh(t.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||Ae(n=Object.values(Vn)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Pt.ON_DATA_STREAM,t)}catch{this.emit(Pt.ON_DATA_STREAM,t)}}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=jg(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xt.UID_BANNED),void this.close()):void this.reconnect(n.action,Pr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pr.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),W("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(vt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(vt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(vt.CLOSED,()=>{this.connectionState=hn.CLOSED}),this.websocket.on(vt.FAILED,()=>{this._disconnectedReason=Xt.NETWORK_ERROR,this.connectionState=hn.CLOSED}),this.websocket.on(vt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===hn.CONNECTED?this.connectionState=hn.RECONNECTING:this.connectionState=hn.CONNECTING}),this.websocket.on(vt.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(vt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof pe&&t.code===F.UNEXPECTED_RESPONSE&&t.data.code===rt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Pr.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(vt.REQUEST_NEW_URLS,(t,n)=>{Dr(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const eX={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Zq(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new $q(n,t)}};function X6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function J6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class tX{constructor(t){x(this,"sessionDesc",void 0),x(this,"localCapabilities",void 0),x(this,"rtpCapabilities",void 0),x(this,"candidates",void 0),x(this,"_originCandidates",void 0),x(this,"iceParameters",void 0),x(this,"dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),t=Cn(t);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:c,sdkCodec:l,cname:p}=t,m=Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=Cn(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=o,this.localCapabilities=c,this.cname=p;for(let E=0;E<m.mediaDescriptions.length;E++){const v=m.mediaDescriptions[E];if(v.attributes.iceUfrag=n.iceUfrag,v.attributes.icePwd=n.icePwd,v.attributes.fingerprints=r.fingerprints,v.attributes.candidates=i,v.attributes.setup=o,v.media.mediaType==="video"){v.media.fmts=s.videoCodecs.map(A=>A.payloadType.toString(10));const y=s.videoCodecs.filter(A=>{var N,j;return(N=A.rtpMap)===null||N===void 0?void 0:Ae(j=N.encodingName.toLowerCase()).call(j,l)}),D=s.videoCodecs.filter(A=>!Ae(y).call(y,A));v.attributes.payloads=[...y,...D],v.attributes.extmaps=s.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=s.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=s.audioCodecs,v.attributes.extmaps=s.audioExtensions),m.mediaDescriptions[E]=this.mungMediaDesc(v)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return yd(this.sessionDesc)}send(t,n,r){const{ssrcs:i,ssrcGroups:s}=Gg(n,this.cname),o=this.sessionDesc.mediaDescriptions.find(p=>t===Be.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio"),c=i[0].attributes.label,l=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(s),{id:c,mslabel:l}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],i=[],s=[];n.attributes.ssrcs.forEach(o=>{Ae(t).call(t,o.attributes.label||"")?s.push(o):r.push(o)}),n.attributes.ssrcGroups.forEach(o=>{var c;Ae(c=s.map(l=>l.ssrcId)).call(c,o.ssrcIds[0])||i.push(o)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((i,s)=>{const o=i._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===o.kind),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],i);this.sessionDesc.mediaDescriptions[c]=l})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(n.forEach(i=>{r.push(J6(J6({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),n.length!==0){switch(t){case Wr.TCP_RELAY:this.candidates=r;break;case Wr.UDP_TCP_RELAY:case Wr.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Cn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Cn(t);return Ff(r,n),Fb(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const i=this.sessionDesc.mediaDescriptions.find(o=>t===Be.VIDEO?o.attributes.mid==="video":o.attributes.mid==="audio");if(i){const o=i.attributes.ssrcs.find(c=>c.attributes.label===n);var s;o&&(o.attributes.label=r,(s=o.attributes.msid)===null||s===void 0||s.replace(n,r))}}mungMediaDesc(t){const n=Cn(t);return jb(n),function(r){const i=r.attributes.extmaps.find(s=>tT(s.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(s=>{const o=s.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");o!==-1&&s.rtcpFeedbacks.splice(o,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var an;function Q6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function BT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Q6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let nX=(an=class CE extends dU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ae(n=Object.keys(Dg)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"statsFilter",void 0),x(this,"useRTX",!1),x(this,"localCapabilities",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"establishPromise",void 0),x(this,"mutex",void 0),this.store=n,this.mutex=new jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(CE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=qw(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Id(t.sdp),r=Wg(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,BT(BT({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new pe(F.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new tX(BT(BT({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new pe(F.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return Js(function*(){const i=yield jt(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map(v=>r.peerConnection.addTrack(v._mediaStreamTrack)),o=yield jt(r.peerConnection.createOffer()),c=Gi(o.sdp),l=t.map(v=>{const y=v._mediaStreamTrack,D=c.mediaDescriptions.find(A=>A.attributes.mid===y.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,N,j){const V=A.attributes.ssrcs.filter($=>$.attributes.label===N),G=A.attributes.ssrcGroups;if(V.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(G&&V.length>1){const $=G.find(Q=>Q.ssrcIds.indexOf(V[0].ssrcId)!==-1);return $?[{ssrcId:$.ssrcIds[0],rtx:j?$.ssrcIds[1]:void 0}]:[{ssrcId:V[0].ssrcId}]}return[{ssrcId:V[0].ssrcId}]}(D,y.id,r.useRTX)});let p;try{p=yield l}catch(v){throw s.forEach(y=>{Nr()&&y.replaceTrack(null),r.peerConnection.removeTrack(y)}),v}const m=r.mungSendOfferSDP(o.sdp,t);r.remoteSDP.receive(t,n,p);const E=r.remoteSDP.toString();return yield jt(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(r.applySendEncodings(s,t)),yield jt(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((v,y)=>{const D=v._mediaStreamTrack.id;return{localSSRC:l[y],id:D}})}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{Nr()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,n,i),c=new je((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(s)))},1e4),y=D=>{const A=xt();if((A.name==="Safari"&&Number(A.version)===11||qr())&&D.track.id!==s&&D.streams[0].id===o){var N;const j=D.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(t,s,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(j)}if(D.track.id===s)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(D.track)};this.peerConnection.addEventListener("track",y)}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await c,id:s}}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Nr()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(s=>s.active=!1),r.setParameters(i)}})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(Nr()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach(c=>c.active=!0),await s.setParameters(o)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Js(function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration;if(t===Wr.RELAY&&!i)return;if(i){const p=n.peerConnection.getConfiguration(),m=t===Wr.RELAY?"relay":"all";p.iceTransportPolicy!==m&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(m,"]")),p.iceTransportPolicy=m,n.peerConnection.setConfiguration(p))}t!==Wr.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Id(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString();yield jt(n.peerConnection.setLocalDescription(s)),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new pe(F.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new pe(F.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new pe(F.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ig(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...CE.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...CE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(p=>{var m;return((m=p.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ft().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof mn)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(W("DSCP_TYPE")&&dl()){var o;const p=W("DSCP_TYPE");Ae(o=["very-low","low","medium","high"]).call(o,p)&&(s.networkPriority=p)}const c=n.getParameters(),l=(r=c.encodings)===null||r===void 0?void 0:r[0];l&&Object.assign(l,s),Object.assign(c,i),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await n.setParameters(c)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=Gi(t);return n.forEach((i,s)=>{const o=i._mediaStreamTrack,c=r.mediaDescriptions.find(l=>l.attributes.mid===o.kind);c&&Ff(c,i)}),yd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((s,o)=>{let{id:c,mslabel:l}=s;const{kind:p}=t[o];return new je((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),y=D=>{const A=xt();if(A.name==="Safari"&&Number(A.version)===11&&D.track.id!==c&&D.streams[0].id===l){var N;const j=D.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(p,c,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:j,id:c})}if(D.track.id===c)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:D.track,id:c})};this.peerConnection.addEventListener("track",y)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await je.all(n)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=CE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ye(an.prototype,"connect",[so],Object.getOwnPropertyDescriptor(an.prototype,"connect"),an.prototype),Ye(an.prototype,"stopSending",[so],Object.getOwnPropertyDescriptor(an.prototype,"stopSending"),an.prototype),Ye(an.prototype,"receive",[so],Object.getOwnPropertyDescriptor(an.prototype,"receive"),an.prototype),Ye(an.prototype,"stopReceiving",[so],Object.getOwnPropertyDescriptor(an.prototype,"stopReceiving"),an.prototype),Ye(an.prototype,"muteRemote",[so],Object.getOwnPropertyDescriptor(an.prototype,"muteRemote"),an.prototype),Ye(an.prototype,"unmuteRemote",[so],Object.getOwnPropertyDescriptor(an.prototype,"unmuteRemote"),an.prototype),Ye(an.prototype,"muteLocal",[so],Object.getOwnPropertyDescriptor(an.prototype,"muteLocal"),an.prototype),Ye(an.prototype,"unmuteLocal",[so],Object.getOwnPropertyDescriptor(an.prototype,"unmuteLocal"),an.prototype),Ye(an.prototype,"close",[so],Object.getOwnPropertyDescriptor(an.prototype,"close"),an.prototype),Ye(an.prototype,"updateEncoderConfig",[so],Object.getOwnPropertyDescriptor(an.prototype,"updateEncoderConfig"),an.prototype),Ye(an.prototype,"updateSendParameters",[so],Object.getOwnPropertyDescriptor(an.prototype,"updateSendParameters"),an.prototype),Ye(an.prototype,"replaceTrack",[so],Object.getOwnPropertyDescriptor(an.prototype,"replaceTrack"),an.prototype),Ye(an.prototype,"getRemoteSSRC",[so],Object.getOwnPropertyDescriptor(an.prototype,"getRemoteSSRC"),an.prototype),an);function so(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}const rX={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new nX(n,t)}},iX={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(Vy.has(e)||!e.track)return;const n={track:e.track};if(ll()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=t.metadata&&t.metadata();l?function(p,m){const{chunk:E,controller:v}=m,y=Td.METADATA;E.data=function(D,A,N){const j=N.byteLength,V=j+vb+YM,G=gb+Eb+V,$=new ArrayBuffer(D.byteLength+G),Q=new DataView($);Q.setUint8(0,zM),Q.setUint16(1,V),Q.setUint8(3,A),Q.setUint16(4,j);for(let re=0;re<j;re++)Q.setUint8(6+re,N[re]);const z=new Uint8Array(Q.buffer);return z.set(new Uint8Array(D),G),z.buffer}(E.data,y,p),v.enqueue(E)}(l,{chunk:o,controller:c}):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;if(c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id)R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(c.data.getMetadata){const p=t.metadata&&t.metadata();p&&s.port1.postMessage({metadata:p})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Vy.get(e);if(i){Vy.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){R.warning(c&&c.message)}}}Vy.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(Hy.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ll()&&!qr()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");Aw(Wt.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(l,p,m){var E;const v=Sb(new DataView(p.data));if(!v)return m.enqueue(p);const y=l.track.id;jK.set(y,l.track);const D=(E=v.tlv.find($=>$.tag===Td.AUDIO_LEVEL))===null||E===void 0?void 0:E.value;let A=0;typeof D=="number"&&(A=127-D);const N=Math.round(Math.pow(10,A/60)-1),{selected:j,speaker:V}=function($,Q){let z=kf.get($);if(z||(z=function(re){const fe=new XM;return kf.set(re,fe),Sa||(Sa=new UK(W("TOPN_SILENCE_THRESHOLD")||500),Sa.on("ActiveSpeakerChanged",ve=>{ve!=null&&(By=ve)})),Sa.addSpeakers([fe]),fe}($)),kf.size<=JM)return{selected:!0,speaker:z};if(!Sa)throw new Error("no active speaker detector");return Sa.levelChanged(z.id,Q),vh=Sa.loudest.map(re=>re.id),By&&!Ae(vh).call(vh,By)&&vh.length>=JM&&vh.pop(),{selected:Ae(vh).call(vh,z.id)||z.id===By,speaker:z}}(l,N),G=function($,Q,z){const re=ya.get($)||new VK($,Q);return re.score=z,ya.set($,re),function(fe){if(Wy.set(fe,!0),!Gy)return void(Gy=Date.now());const ve=Date.now();ve-Gy>1e3&&(Wy.get(fe)?Wy.set(fe,!1):(QM(fe),Wy.delete(fe)),Gy=ve)}($),re}(y,l.track,V.energyScore);G.addSample(j),G.active&&(p.data=v.frame.buffer,m.enqueue(p))}(e,o,c):t.enableMetadata||t.enablePts?function(l,p,m,E){const v=new DataView(l.data),y=v.getUint8(0);let D;if((128&y)!=0&&y!==71){const j=function(V){if(V.byteLength<=0)return[];const G=[];let $=0;for(;$<V.byteLength;){const z=(128&V.getUint8($))>>7,re=127&V.getUint8($);if(!(z&&$+4<=V.byteLength)){$++;break}{const fe=V.getUint32($,!1),ve=(16776192&fe)>>10,Re=1023&fe;G.push({pt:re,ts_offset:ve,length:Re,data:new Uint8Array}),$+=4}}let Q=V.byteLength-$;for(const z of G){if(z.length>Q)return console.warn("Broken red payload"),[];z.length>0&&(z.data=new Uint8Array(V.buffer,V.byteOffset+$,z.length),$+=z.length,Q-=z.length)}if(Q>0){const z={pt:G.length>0?G[G.length-1].pt:0,ts_offset:0,length:Q,data:new Uint8Array(V.buffer,V.byteOffset+$,Q)};G.push(z)}return G}(v);if(j.length>0){const V=function(G){let $=0;for(let re=0;re<G.length;re++)$+=re<G.length-1?4:1,$+=G[re].length;const Q=new Uint8Array($);let z=0;for(let re=0;re<G.length;re++)if(re<G.length-1){const fe=(2147483648|(127&G[re].pt)<<24|(262143&G[re].ts_offset)<<10|1023&G[re].length)>>>0;Q[z++]=fe>>24&255,Q[z++]=fe>>16&255,Q[z++]=fe>>8&255,Q[z++]=255&fe}else Q[z++]=127&G[re].pt;for(const re of G)Q.set(re.data,z),z+=re.length;return Q}(j.map(G=>{const $=new Uint8Array(G.length);$.set(G.data);const Q=Sb(new DataView($.buffer));return Q!=null&&Q.frame&&(G.data=Q?.frame),D=Q,G}));l.data=V.buffer}}else D=Sb(v),D&&(l.data=D.frame.buffer);if(p.enqueue(l),!D)return;const A=D.tlv.find(j=>j.tag===Td.METADATA);A&&m&&A.value instanceof Uint8Array&&m(A.value);const N=D.tlv.find(j=>j.tag===Td.AUDIO_64_BIT_PTS);N&&E&&N.value instanceof Uint8Array&&N.value.length==8&&E(new DataView(N.value.buffer).getBigUint64(0,!0))}(o,c,t.onMetadata,t.onPts):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.metadata&&n.onMetadata?n.onMetadata(c.data.metadata):c.data.pts&&n.onPts&&n.onPts(c.data.pts)},n.worker=i}function r(){e.track.removeEventListener("ended",r),function(i){const s=Hy.get(i);if(s){(function(l){const p=kf.get(l);p&&(kf.delete(l),Sa&&(Sa.removeSpeakers([p]),kf.size===0&&(Sa.destroy(),Sa=null)))})(i),QM(i.track.id),Hy.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){R.warning(l&&l.message)}}}(e)}Hy.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(Ky.has(e)||!e.track)return;const n={track:e.track};if(ll()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(c){return void R.error("create video-encoded-streams error",c&&c.message)}const s=[];t.on("sei-to-send",c=>{s.push(c)});const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const p=eU(new Uint8Array(c.data)),m=s.shift();if(m){const E=function(v,y,D){switch(D){case Rb:return function(A,N){const j=$M(N),V=j.length,G=Math.floor(V/255),$=V%255,Q=new Uint8Array(6+G+1+V+A.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=6,Q[5]=101;let z=0;for(;z<G;)Q[6+z]=255,z++;return Q[6+z]=$,z++,Q.set(j,6+z),Q.set(new Uint8Array(A),6+z+V),Q.buffer}(v,y);case wb:return function(A,N){const j=$M(N),V=j.length,G=Math.floor(V/255),$=V%255,Q=new Uint8Array(7+G+1+V+1+A.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=78,Q[5]=1,Q[6]=101;let z=0;for(;z<G;)Q[7+z]=255,z++;return Q[7+z]=$,z++,Q.set(j,7+z),z+=V,Q[7+z]=128,z++,Q.set(new Uint8Array(A),7+z),Q.buffer}(v,y);default:return null}}(c.data,m,p);E&&(c.data=E)}l.enqueue(c)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!Nr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),t.on("sei-to-send",c=>{s.port1.postMessage({sei:c})}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Ky.get(e);if(i){Ky.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){R.warning(c&&c.message)}}}Ky.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!e.track)return;if(Mg.has(e)){const i=Mg.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ll()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create video-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=function(p,m){switch(m){case Rb:return function(E){const v=new DataView(E.data);let y=0;for(;y+4<E.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===6){let D=y+6,A=0,N=0;for(;(N=v.getUint8(D++))===255;)A+=255;A+=N;const j=ZM(E.data,D,A);return new Uint8Array(j)}y++}return null}(p);case wb:return function(E){const v=new DataView(E.data);let y=0;for(;y+5<E.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===78&&v.getUint8(y+5)===1&&v.getUint8(y+6)===101){let D=y+7,A=0,N=0;for(;(N=v.getUint8(D++))===255;)A+=255;A+=N;const j=ZM(E.data,D,A);return new Uint8Array(j)}y++}return null}(p);default:return null}}(o,eU(new Uint8Array(o.data)));l&&n.onSei&&n.onSei(l),c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.sei&&n.onSei&&n.onSei(c.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const s=Mg.get(i);if(s){Mg.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){R.warning(l&&l.message)}}})(e)}Mg.set(e,n),e.track.addEventListener("ended",r)}},sX={name:"InterceptFrame",create:()=>iX};Xw(),$t("PROCESS_ID","process-".concat(on(8,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();R.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Sn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;va[r]=i,Sn[r]=i}})}catch(t){R.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(va.AREAS)&&va.AREAS.length>0&&Hb(va.AREAS,!0);const Z6=(e,t,n)=>{R.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),$t(e,t,n)};Nd(Aq,!1),Nd(Pq,!1),Nd(dY,!1),Nd(Wq,!1),Nd(wq,!1),Nd(eX,!1),Nd(rX,!1),Nd(sX,!1);const Xn=function(e){const t=new bn,n=e,r={getListeners:t.getListeners.bind(t),on:(i,s)=>(function(o,c){o===Cc.SECURITY_POLICY_VIOLATION&&DV(c,!0)}(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return PV(PV({},n),r)}({__TRACK_LIST__:Rf,VERSION:Qs,BUILD:Zw,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Z6,getParameter:W,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let i;return Ft().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!n)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(t){throw new ae(F.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=qe.reportApiInvoke(null,{name:xn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Tn.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(s&&o&&c),t&&Lw()&&Zk(75)&&new s().close()}catch(s){return R.error("check system requirement failed: ",s),!1}let n=!1;const r=xt();r.name===Wt.CHROME&&Number(r.version)>=58&&(_a.engine.name!=="WebKit"||function(){const s=xt();if(Sy()){if(s.os===dr.MAC_OS)return!0;if(s.os===dr.IOS){const o=_a.os.version&&_a.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Wt.FIREFOX&&Number(r.version)>=56||r.name===Wt.OPERA&&Number(r.version)>=45||r.name===Wt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(qr()||Lo())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||iL()||xt().name===Wt.QQ)&&(n=!0),R.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return As.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return As.getRecordingDevices(e)},getCameras:function(e){return As.getCamerasDevices(e)},getElectronScreenSources:ZL,getPlaybackDevices:function(e){return As.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=on(5,"client-"),r=qe.reportApiInvoke(null,{id:n,name:xn.CREATE_CLIENT,options:[t],tag:Tn.TRACER});try{(function(i){ir(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ir(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&ir(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Cr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&hL(i.turnServer),i.httpRetryConfig!==void 0&&uL(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&uL(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(tL(16,0)||Pw(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",R.debug("browser not support vp9, force use vp8")),$t("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new uY(Go(Go({forceWaitGatewayResponse:!0},t),{},{role:Ae(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=W("CAMERA_CAPTURE_CONFIG"),n=on(8,"track-cam-"),r=qe.reportApiInvoke(null,{id:n,tag:Tn.TRACER,name:xn.CREATE_CAM_VIDEO_TRACK,options:[un({},e),t]});t&&(e.encoderConfig=t);const i=xy(e);let s=null;R.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await Is({video:i},n)).getVideoTracks()[0]||null}catch(c){throw r.onError(c),c}if(!s){const c=new pe(F.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(c),c.throw(R)}if(e.optimizationMode&&_b(n,s,e,Uo(e.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const c=Uo(e.encoderConfig);e.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}const o=new My(s,e,i,e.scalabiltyMode?Py(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(o.getTrackId()),R.info("create camera video success, trackId:",n),o},createCustomVideoTrack:function(e){const t=on(8,"track-cus-"),n=qe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});W("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new mn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Py(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[rn.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),R.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(v){return cx(v)}(t):void 0;n&&(t="auto");const r=on(8,"track-scr-v-"),i=qe.reportApiInvoke(null,{id:r,tag:Tn.TRACER,name:xn.CREATE_SCREEN_VIDEO_TRACK,options:[un({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=function(v){const y={};v.screenSourceType&&(y.mediaSource=v.screenSourceType),v.extensionId&&ll()&&(y.extensionId=v.extensionId);const{displaySurface:D,selfBrowserSurface:A,surfaceSwitching:N,systemAudio:j,preferCurrentTab:V}=v;(mf(107)||Ow(107)||Dw(93))&&(D&&(ir(D,"displaySurface",["browser","window","monitor"]),y.displaySurface=D),A?(ir(A,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=A):y.selfBrowserSurface="include",N&&(ir(N,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=N)),(mf(105)||Ow(105)||Dw(91))&&j&&(ir(j,"systemAudio",["exclude","include"]),y.systemAudio=j),(mf(94)||Ow(94)||Dw(80))&&V&&(y.preferCurrentTab=!0),v.electronScreenSourceId&&(y.sourceId=v.electronScreenSourceId);const G=v.encoderConfig?ib(v.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:G?G.width:void 0,maxHeight:G?G.height:void 0},G&&(G.frameRate&&(typeof G.frameRate=="number"?(y.mandatory.maxFrameRate=G.frameRate,y.mandatory.minFrameRate=G.frameRate):(y.mandatory.maxFrameRate=G.frameRate.max||G.frameRate.ideal||G.frameRate.exact||void 0,y.mandatory.minFrameRate=G.frameRate.min||G.frameRate.ideal||G.frameRate.exact||void 0),y.frameRate=G.frameRate),G.width&&(y.width=G.width),G.height&&(y.height=G.height)),y}(e);let o=null,c=null;const l=Ft();if(!l.supportShareAudio&&t==="enable"){const v=new pe(F.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(v),v.throw(R)}R.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const p=l.supportShareAudio&&t!=="disable";try{const v=await Is({screen:s,screenAudio:p?n||!0:void 0},r);o=v.getVideoTracks()[0]||null,c=v.getAudioTracks()[0]||null}catch(v){throw i.onError(v),v}if(!o){const v=new pe(F.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(v),v.throw(R)}if(!c&&t==="enable"){o&&o.stop();const v=new pe(F.SHARE_AUDIO_NOT_ALLOWED);return i.onError(v),v.throw(R)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(_b(r,o,e,e.encoderConfig&&ib(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const m=new mn(o,e.encoderConfig?ib(e.encoderConfig):{},e.scalabiltyMode?Py(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[rn.SCREEN_TRACK]);if(!c)return i.onSuccess(m.getTrackId()),R.info("create screen video track success","video:",m.getTrackId()),m;const E=new Ln(c,void 0,on(8,"track-scr-a-"),!1);return i.onSuccess([m.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",m.getTrackId(),"audio:",E.getTrackId()),[m,E]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=W("CAMERA_CAPTURE_CONFIG"),r=on(8,"track-mic-"),i=on(8,"track-cam-"),s=qe.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:Tn.TRACER,name:xn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const o=xy(t),c=lx(e);let l=null,p=null;R.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const v=await Is({audio:c,video:o},"".concat(r,"-").concat(i));l=v.getAudioTracks()[0],p=v.getVideoTracks()[0]}catch(v){throw s.onError(v),v}if(!l||!p){const v=new pe(F.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(v),v.throw(R)}if(t.optimizationMode&&_b(i,p,t,Uo(t.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const v=Uo(t.encoderConfig);t.encoderConfig=v,delete v.bitrateMax,delete v.bitrateMin}const m=new xg(l,e,c,r),E=new My(p,t,o,t.scalabiltyMode?Py(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([m.getTrackId(),E.getTrackId()]),R.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[m,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=on(8,"track-mic-"),n=qe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=lx(e);let i=null;R.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Is({audio:r},t)).getAudioTracks()[0]||null}catch(o){throw n.onError(o),o}if(!i){const o=new pe(F.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(o),o.throw(R)}const s=new xg(i,e,r,t);return n.onSuccess(s.getTrackId()),R.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=on(8,"track-cus-"),n=qe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Ln(e.mediaStreamTrack,e.encoderConfig?Dy(e.encoderConfig):{},t,!1);return R.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},o=on(8,"track-buf-"),c=qe.reportApiInvoke(null,{id:o,tag:Tn.TRACER,name:xn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(W("DISABLE_WEBAUDIO"))throw new pe(F.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);const l=i;if(!(i instanceof AudioBuffer))try{i=await async function(E,v){let y=null;if(typeof E=="string"){const A=Xx.get(E);if(A)return R.debug("use cached audio resource: ",E),A;try{y=(await Ea(()=>Ai.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(N){throw new pe(F.FETCH_AUDIO_FILE_FAILED,N.toString())}}else y=await new je((N,j)=>{const V=new FileReader;V.onload=G=>{G.target?N(G.target.result):j(new pe(F.READ_LOCAL_AUDIO_FILE_ERROR))},V.onerror=()=>{j(new pe(F.READ_LOCAL_AUDIO_FILE_ERROR))},V.readAsArrayBuffer(E)});const D=await function(A){const N=Of();return new je((j,V)=>{N.decodeAudioData(A,G=>{j(G)},G=>{V(new pe(F.DECODE_AUDIO_FILE_FAILED,G.toString()))})})}(y);return typeof E=="string"&&v&&Xx.set(E,D),D}(i,n)}catch(E){return c.onError(E),E.throw(R)}const p=new DK(i),m=new PK(l,p,r?Dy(r):{},o);return R.info("create buffer source audio track success, trackId:",o),c.onSuccess(m.getTrackId()),m},setAppType:function(e){if(R.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw R.debug("Invalid appType"),new ae(F.INVALID_PARAMS,"invalid app type",e);$t("APP_TYPE",Math.floor(e))},setLogLevel:function(e){R.setLogLevel(e)},enableLogUpload:function(){W("USE_NEW_LOG")?$t("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){W("USE_NEW_LOG")?$t("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ZU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ln||e instanceof Df)){const l=new ae(F.INVALID_TRACK,"the parameter is not a audio track");return n.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Ln?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,o=i;const c=Date.now();return new je(l=>{const p=setInterval(()=>{const m=e.getVolumeLevel();s=m>s?m:s,o=m<o?m:o;const E=s-o>1e-4,v=Date.now()-c;if(E||v>t){clearInterval(p);const y=E,D={duration:v,deviceLabel:r,maxVolumeLevel:s,result:y};R.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),n.onSuccess(D),l(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof mn||e instanceof Pf)){const E=new ae(F.INVALID_TRACK,"the parameter is not a video track");return n.onError(E),E.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof mn?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Nr()||Sy())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let c=0,l=0;try{const E=Date.now();c=await function(v,y,D,A){let N,j=0,V=null;return new je((G,$)=>{function Q(){j>A&&N&&(N(),G(j));const z=D.getContext("2d");if(!z){const ve=new ae(F.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(ve.toString()),void $(ve)}z.drawImage(v,0,0,160,120);const re=z.getImageData(0,0,D.width,D.height),fe=Math.floor(re.data.length/3);if(V){for(let ve=0;ve<fe;ve+=3)if(re.data[ve]!==V[ve])return j+=1,void(V=re.data);V=re.data}else V=re.data}setTimeout(()=>{N&&(N(),G(j))},y),N=lb(()=>{Q()},30)})}(s,t,o,4),l=Date.now()-E}catch(E){throw n.onError(E),E}Qz===Wt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const p=c>4,m={duration:l,changedPicNum:c,deviceLabel:r,result:p};return R.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),p},setArea:Hb,audioElementPlayCenter:Oi,resumeAudioContext:function(){Oi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){pY.processExternalMediaAEC(e)},registerExtensions:function(e){const t=W("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Ae(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=R.extLog,r.reporter.hookApiInvoke=qe.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=W(i)})}),Z6("PLUGIN_INFO",t)},ChannelMediaRelayError:xf,ChannelMediaRelayEvent:pl,ChannelMediaRelayState:Ki,RemoteStreamFallbackType:RK,RemoteStreamType:CK,ConnectionDisconnectedReason:Xt,AudienceLatencyLevelType:eK,AREAS:zt,preload:async function(e,t,n,r){return T5(e,t,n,r)}});return Object.defineProperties(Xn,{onAudioAutoplayFailed:{get:()=>Os.onAudioAutoplayFailed,set:e=>{Os.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Os.onAutoplayFailed,set:e=>{Os.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Xn._onSecurityPolicyViolation,set(e){Xn._onSecurityPolicyViolation=e,DV(e)}},__CLIENT_LIST__:{get:()=>W("SHOW_GLOBAL_CLIENT_LIST")?Sh:[]}}),As.on(_h.CAMERA_DEVICE_CHANGED,e=>{R.info("camera device changed",JSON.stringify(e)),Xn.onCameraChanged&&Xn.onCameraChanged(e),Xn.safeEmit(Cc.CAMERA_CHANGED,e)}),As.on(_h.RECORDING_DEVICE_CHANGED,e=>{R.info("microphone device changed",JSON.stringify(e)),Xn.onMicrophoneChanged&&Xn.onMicrophoneChanged(e),Xn.safeEmit(Cc.MICROPHONE_CHANGED,e)}),As.on(_h.PLAYOUT_DEVICE_CHANGED,e=>{R.debug("playout device changed",JSON.stringify(e)),Xn.onPlaybackDeviceChanged&&Xn.onPlaybackDeviceChanged(e),Xn.safeEmit(Cc.PLAYBACK_DEVICE_CHANGED,e)}),Oi.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Os.onAudioAutoplayFailed&&Os.onAudioAutoplayFailed()},en.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Os.onAudioAutoplayFailed&&Os.onAudioAutoplayFailed(),Xn.safeEmit(Cc.AUTOPLAY_FAILED)}),en.on(br.STATE_CHANGE,(e,t)=>{R.info("audio context state changed: ".concat(t," => ").concat(e)),Xn.onAudioContextStateChanged&&Xn.onAudioContextStateChanged(e,t),Xn.safeEmit(Cc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Gn.on(gf.NETWORK_STATE_CHANGE,(e,t)=>{R.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Xn),Xn})}(l0)),l0.exports}var lne=cne();const yE=g0(lne);class dne{client=null;callState={isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}};callbacks={};currentChannelInfo=null;isJoining=!1;inactivityTimer=null;lastActivityTime=Date.now();INACTIVITY_TIMEOUT=300*1e3;isRenewingToken=!1;microphoneRetryCount=0;MAX_MICROPHONE_RETRY=2;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=3;isReconnecting=!1;constructor(){yE.setLogLevel(4);try{yE.enableLogUpload(!1)}catch{}try{yE.setLogLevel(2)}catch{}}setCallbacks(h){this.callbacks={...this.callbacks,...h}}getCallState(){return{...this.callState}}async joinChannel(h){if(!this.isJoining)try{this.isJoining=!0,(this.callState.isConnecting||this.callState.isConnected||this.client)&&(await this.forceLeaveChannel(),await new Promise(f=>setTimeout(f,200))),this.callState.isConnecting=!0,this.currentChannelInfo=h,this.client&&(this.client=null),this.client=yE.createClient({mode:"rtc",codec:"vp8"});try{this.client.enableDualStream}catch{}this.setupEventListeners(),await this.createLocalAudioTrack(),await this.client.join(h.appId,h.channelName,h.token,h.uid),this.callState.localAudioTrack?await this.client.publish([this.callState.localAudioTrack]):console.error("       "),this.callState.isConnected=!0,this.callState.isConnecting=!1,this.callbacks.onCallStarted?.(),this.startInactivityTimer(),this.isJoining=!1}catch(f){throw console.error(" Agora   :",f),this.callState.isConnecting=!1,this.isJoining=!1,this.callbacks.onError?.(f),f}}async forceLeaveChannel(){try{if(this.callState.localAudioTrack){try{this.client&&await this.client.unpublish([this.callState.localAudioTrack])}catch{}try{this.callState.localAudioTrack.stop(),this.callState.localAudioTrack.close()}catch{}this.callState.localAudioTrack=null}if(this.client){try{try{typeof this.client.enableLogUpload=="function"&&this.client.enableLogUpload(!1)}catch{}const h=this.client.leave(),f=new Promise((g,S)=>setTimeout(()=>S(new Error("Leave timeout")),3e3));await Promise.race([h,f])}catch{}this.client=null}this.stopInactivityTimer(),this.callState.isConnected=!1,this.callState.isConnecting=!1,this.callState.connectionState="DISCONNECTED",this.callState.remoteAudioTrack=null,this.currentChannelInfo=null,this.isJoining=!1,await new Promise(h=>setTimeout(h,100))}catch(h){console.error("    :",h),this.stopInactivityTimer(),this.callState.isConnected=!1,this.callState.isConnecting=!1,this.callState.connectionState="DISCONNECTED",this.callState.localAudioTrack=null,this.callState.remoteAudioTrack=null,this.currentChannelInfo=null,this.client=null,this.isJoining=!1}}startInactivityTimer(){this.stopInactivityTimer(),this.lastActivityTime=Date.now(),this.inactivityTimer=setInterval(()=>{Date.now()-this.lastActivityTime>=this.INACTIVITY_TIMEOUT&&(console.warn(" 5      ( )"),this.handleInactivityTimeout())},3e4)}stopInactivityTimer(){this.inactivityTimer&&(clearInterval(this.inactivityTimer),this.inactivityTimer=null)}updateActivity(){this.lastActivityTime=Date.now()}async handleInactivityTimeout(){try{console.warn("   -   "),this.callbacks.onError?.(new Error("     .")),await this.leaveChannel()}catch(h){console.error("   :",h)}}async leaveChannel(){try{if(this.stopInactivityTimer(),this.callState.localAudioTrack&&this.client){try{await this.client.unpublish([this.callState.localAudioTrack])}catch(h){console.error("      :",h)}this.callState.localAudioTrack.stop(),this.callState.localAudioTrack.close(),this.callState.localAudioTrack=null}if(this.callState.remoteAudioTrack&&(this.callState.remoteAudioTrack.stop(),this.callState.remoteAudioTrack=null),this.client){try{try{typeof this.client.enableLogUpload=="function"&&this.client.enableLogUpload(!1)}catch{}await this.client.leave()}catch(h){console.error("   :",h)}this.client=null}this.callState={isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},this.isJoining=!1,this.currentChannelInfo=null,this.callbacks.onCallEnded?.()}catch(h){throw console.error("Agora   :",h),this.callbacks.onError?.(h),h}}async toggleMute(){try{if(!this.callState.localAudioTrack)throw new Error("   .");const h=!this.callState.isMuted;return await this.callState.localAudioTrack.setMuted(h),this.callState.isMuted=h,h}catch(h){throw console.error("  :",h),this.callbacks.onError?.(h),h}}async setMuted(h){try{if(!this.callState.localAudioTrack)throw new Error("   .");await this.callState.localAudioTrack.setMuted(h),this.callState.isMuted=h}catch(f){throw console.error("   :",f),this.callbacks.onError?.(f),f}}async toggleSpeaker(){try{const h=!this.callState.isSpeakerOn;return this.callState.remoteAudioTrack&&await this.callState.remoteAudioTrack.setVolume(h?100:0),this.callState.isSpeakerOn=h,h}catch(h){throw console.error("  :",h),this.callbacks.onError?.(h),h}}async setVolume(h){try{if(h<0||h>100)throw new Error(" 0-100   .");this.callState.volume=h,this.callState.remoteAudioTrack&&await this.callState.remoteAudioTrack.setVolume(h)}catch(f){throw console.error("  :",f),this.callbacks.onError?.(f),f}}async createLocalAudioTrack(){try{this.callState.localAudioTrack=await yE.createMicrophoneAudioTrack({encoderConfig:"music_standard",AEC:!0,ANS:!0,AGC:!0}),this.microphoneRetryCount=0}catch(h){if(console.error("    :",h),h instanceof Error&&(h.message.includes("Permission denied")||h.message.includes("NotAllowedError")||h.message.includes("PERMISSION_DENIED"))&&(console.error("   "),this.callbacks.onMicrophonePermissionDenied?.(),this.microphoneRetryCount<this.MAX_MICROPHONE_RETRY))return this.microphoneRetryCount++,console.warn(`    ... (${this.microphoneRetryCount}/${this.MAX_MICROPHONE_RETRY})`),await new Promise(f=>setTimeout(f,3e3)),this.createLocalAudioTrack();throw h}}setupEventListeners(){this.client&&(this.client.on("connection-state-change",(h,f,g)=>{this.callState.connectionState=h,this.callbacks.onConnectionStateChange?.(h),h==="DISCONNECTED"&&(this.callState.isConnected=!1,g==="LEAVE"?(this.reconnectAttempts=0,this.isReconnecting=!1):(console.error("    :",g),this.handleUnexpectedDisconnection(g)))}),this.client.on("user-joined",h=>{this.callbacks.onUserJoined?.(h.uid.toString())}),this.client.on("user-left",(h,f)=>{this.callbacks.onUserLeft?.(h.uid.toString())}),this.client.on("user-published",async(h,f)=>{if(f==="audio"){await this.client.subscribe(h,f);const g=h.audioTrack;g&&(g.play(),this.updateActivity())}}),this.client.on("user-unpublished",(h,f)=>{f==="audio"&&this.callbacks.onAudioTrackUnsubscribed?.(h.uid.toString())}),this.client.on("user-audio-track-subscribed",(h,f)=>{this.callState.remoteAudioTrack=f,this.callbacks.onAudioTrackSubscribed?.(h.uid.toString(),f),this.updateActivity()}),this.client.on("token-privilege-will-expire",()=>{console.warn(" Agora RTC  30   -  "),!this.isRenewingToken&&(this.isRenewingToken=!0,this.callbacks.onTokenPrivilegeWillExpire?.())}),this.client.on("token-privilege-did-expire",()=>{console.error(" Agora RTC   -   "),this.callbacks.onTokenPrivilegeDidExpire?.()}),this.client.on("network-quality",h=>{const f={uplinkNetworkQuality:h.uplinkNetworkQuality,downlinkNetworkQuality:h.downlinkNetworkQuality};this.callState.networkQuality=f,this.callbacks.onNetworkQualityChange?.(f)}),this.client.on("exception",h=>{console.error(" Agora SDK  :",h);const f=String(h.code||"");f==="FRAMERATE_INPUT_TOO_LOW"||f==="FRAMERATE_SENT_TOO_LOW"||f==="SEND_VIDEO_BITRATE_TOO_LOW"||f==="RECV_VIDEO_DECODE_FAILED"||this.callbacks.onException?.({code:f,msg:String(h.msg||""),uid:String(h.uid||"unknown")})}))}getNetworkQualityLabel(h){return{0:"",1:"",2:"",3:"",4:"",5:"",6:""}[h]}async handleUnexpectedDisconnection(h){if(!this.isReconnecting){if(this.reconnectAttempts>=this.MAX_RECONNECT_ATTEMPTS){console.error(`    (${this.MAX_RECONNECT_ATTEMPTS}) `),this.callbacks.onError?.(new Error("    .  ."));return}this.isReconnecting=!0,this.reconnectAttempts++,console.warn(`   ... (${this.reconnectAttempts}/${this.MAX_RECONNECT_ATTEMPTS})`);try{await new Promise(f=>setTimeout(f,2e3)),this.currentChannelInfo&&this.client&&(await this.client.join(this.currentChannelInfo.appId,this.currentChannelInfo.channelName,this.currentChannelInfo.token,this.currentChannelInfo.uid),this.callState.localAudioTrack&&await this.client.publish([this.callState.localAudioTrack]),this.callState.isConnected=!0,this.isReconnecting=!1,console.log("  "))}catch(f){console.error("  :",f),this.isReconnecting=!1,this.reconnectAttempts<this.MAX_RECONNECT_ATTEMPTS?(console.warn(" 3   ..."),setTimeout(()=>{this.handleUnexpectedDisconnection(h)},3e3)):this.callbacks.onError?.(new Error("  .    ."))}}}async getCallStatistics(){try{if(!this.client)return console.warn(" Agora     "),null;const h=await this.client.getRTCStats();let f=null;if(this.callState.localAudioTrack)try{f=this.callState.localAudioTrack.getStats()}catch{}let g=null;if(this.callState.remoteAudioTrack)try{g=this.callState.remoteAudioTrack.getStats()}catch{}return{duration:h.Duration||0,sendBytes:h.SendBytes,receiveBytes:h.RecvBytes,sendBitrate:h.SendBitrate,receiveBitrate:h.RecvBitrate,audioSendBytes:f?.sendBytes,audioReceiveBytes:g?.receiveBytes,audioSendBitrate:f?.sendBitrate,audioReceiveBitrate:g?.receiveBitrate,sendPacketsLost:f?.sendPacketsLost,receivePacketsLost:g?.receivePacketsLost,userCount:h.UserCount,lastNetworkQuality:{...this.callState.networkQuality}}}catch(h){return console.error("    :",h),null}}async renewToken(h){try{if(!this.client)throw new Error("Agora   .");await this.client.renewToken(h),this.currentChannelInfo&&(this.currentChannelInfo.token=h),this.isRenewingToken=!1}catch(f){throw this.isRenewingToken=!1,console.error(" Agora RTC   :",f),f}}getCurrentChannelInfo(){return this.currentChannelInfo?{...this.currentChannelInfo}:null}async destroy(){try{await this.leaveChannel(),this.callbacks={}}catch(h){console.error("Agora   :",h)}}}let iA=null;const une=()=>(iA||(iA=new dne),iA),ZA=()=>{const{callId:u,matchingId:h,partner:f,agoraChannelInfo:g,isInCall:S,isConnecting:C,callStartTime:w,agoraState:P,error:k,startCall:M,endCall:U,updateConnectingState:B,updateAgoraState:Y,setError:H,clearPartner:ie}=aj(),X=ee.useRef(new Set),te=3600*1e3,ce=ee.useRef(null);ee.useEffect(()=>{},[f]);const Z=une(),le=M0(),ne=UE(),de=ee.useCallback(async()=>{try{if(!u){console.error(" callId    ");return}const{getStoredToken:Xe}=await s0(async()=>{const{getStoredToken:De}=await Promise.resolve().then(()=>QT);return{getStoredToken:De}},void 0),We=Xe();We&&ne.setToken(We);const Ie=await ne.renewRtcToken(u);await Z.renewToken(Ie.rtcToken)}catch(Xe){console.error(" RTC   :",Xe),H("   .      .")}},[u,ne,Z,H]),Pe=ee.useCallback(async()=>{console.error(" RTC   -   "),H("    .");try{await Z.leaveChannel(),U()}catch(Xe){console.error("     :",Xe)}},[H,Z,U]),ue=ee.useCallback(()=>{ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{console.warn("   (60)  -   ( )"),H("  (60)    ."),Ve()},te)},[H]),he=ee.useCallback(()=>{ce.current&&(clearTimeout(ce.current),ce.current=null)},[]),ye=ee.useCallback(async Xe=>{try{if(Xe.callId&&X.current.has(Xe.callId)||S||C)return;Xe.callId&&X.current.add(Xe.callId),M(Xe),B(!0);const We={onConnectionStateChange:De=>{Y(Z.getCallState())},onUserJoined:De=>{},onTokenPrivilegeWillExpire:()=>{de()},onTokenPrivilegeDidExpire:()=>{console.error(" RTC   -  "),Pe()},onNetworkQualityChange:De=>{Y(Z.getCallState()),De.uplinkNetworkQuality>=5||De.downlinkNetworkQuality>=5},onException:De=>{console.error(" Agora SDK :",De),(De.code==="DEVICE_NOT_FOUND"||De.code==="UNEXPECTED_ERROR")&&H(`   : ${De.msg}`)},onMicrophonePermissionDenied:()=>{console.error("   "),H("  .     .")},onUserLeft:De=>{const ze=aj.getState();if(ze.partner?.id&&String(De)===String(ze.partner.id)){if(ze.callId&&ze.partner.id)try{le.sendCallEndNotification(ze.callId,ze.partner.id)}catch(_e){console.error("   WebSocket   :",_e)}Z.leaveChannel().catch(_e=>{console.error("Agora   :",_e)}),U()}},onAudioTrackSubscribed:(De,ze)=>{Y(Z.getCallState())},onAudioTrackUnsubscribed:De=>{Y(Z.getCallState())},onCallStarted:()=>{B(!1),Y(Z.getCallState()),ue()},onCallEnded:()=>{U()},onError:De=>{console.error("Agora :",De),H(De.message)}};Z.setCallbacks(We);const Ie={appId:"27a8d306ea82463f81a2fbc033c7570c",channelName:Xe.channelName,token:Xe.rtcToken,uid:String(Xe.agoraUid)};try{await Z.joinChannel(Ie)}catch(De){throw console.error(" Agora   :",De),De}}catch(We){console.error("  :",We),H(We instanceof Error?We.message:"  ."),B(!1)}},[Z,M,B,Y,U,H,S,C,ue,de,Pe]),Ve=ee.useCallback(async()=>{try{if(!u)return;const Xe=f;let We=null;try{We=await Z.getCallStatistics()}catch(Ie){console.error("     ():",Ie)}if(await Z.leaveChannel(),We)try{const{getStoredToken:Ie}=await s0(async()=>{const{getStoredToken:yt}=await Promise.resolve().then(()=>QT);return{getStoredToken:yt}},void 0),De=Ie();De&&ne.setToken(De);const ze=We.lastNetworkQuality?.uplinkNetworkQuality||0,_e=We.lastNetworkQuality?.downlinkNetworkQuality||0,ke=yt=>yt===0?"":yt<=2?"":yt===3?"":yt===4?"":"",ct=`: ${ke(ze)}, : ${ke(_e)}`,at=(We.sendBytes||0)+(We.receiveBytes||0),Ot=Number((at/(1024*1024)).toFixed(2)),Gt=Number(((ze+_e)/2).toFixed(1));await ne.sendCallStatistics(u,{duration:We.duration||0,sendBytes:We.sendBytes||0,receiveBytes:We.receiveBytes||0,sendBitrate:We.sendBitrate||0,receiveBitrate:We.receiveBitrate||0,audioSendBytes:We.audioSendBytes||0,audioReceiveBytes:We.audioReceiveBytes||0,uplinkNetworkQuality:ze,downlinkNetworkQuality:_e,networkQualityDescription:ct,totalDataUsageMB:Ot,averageNetworkQuality:Gt})}catch{}try{const{getStoredToken:Ie}=await s0(async()=>{const{getStoredToken:ze}=await Promise.resolve().then(()=>QT);return{getStoredToken:ze}},void 0),De=Ie();De&&ne.setToken(De),await ne.leaveChannel(u)}catch(Ie){console.error(" 4.   API  :",Ie)}try{const{getStoredToken:Ie}=await s0(async()=>{const{getStoredToken:ze}=await Promise.resolve().then(()=>QT);return{getStoredToken:ze}},void 0),De=Ie();De&&ne.setToken(De),await ne.endCall(u)}catch(Ie){Ie instanceof Error&&Ie.message.includes("  ")||console.error(" 5.   API  :",Ie)}if(Xe?.id)if(!le.getConnectionState().isConnected)console.error(" WebSocket   -   ");else try{le.sendCallEndNotification(u,Xe.id)}catch(De){console.error("   WebSocket   :",De)}he(),Z.setCallbacks({}),U(),await new Promise(Ie=>setTimeout(Ie,100))}catch(Xe){console.error("  :",Xe),H(Xe instanceof Error?Xe.message:"  .")}},[Z,U,H,u,ne,f,le,he]),Je=ee.useCallback(async()=>{try{await Z.toggleMute(),Y(Z.getCallState())}catch(Xe){console.error("  :",Xe),H(Xe instanceof Error?Xe.message:"  .")}},[Z,Y,H]),Ue=ee.useCallback(async()=>{try{await Z.toggleSpeaker(),Y(Z.getCallState())}catch(Xe){console.error("  :",Xe),H(Xe instanceof Error?Xe.message:"  .")}},[Z,Y,H]),xe=ee.useCallback(async Xe=>{try{await Z.setVolume(Xe),Y(Z.getCallState())}catch(We){console.error("  :",We),H(We instanceof Error?We.message:"  .")}},[Z,Y,H]),Ge=ee.useCallback(()=>w?Math.floor((Date.now()-w.getTime())/1e3):0,[w]),dt=ee.useCallback(Xe=>{Xe.type==="call_end"&&Xe.callId===u&&(he(),Z.leaveChannel().catch(We=>{}),U())},[u,Z,U,he]);return ee.useEffect(()=>(le.onCallEndNotificationCallback(dt),()=>{}),[le,dt]),ee.useEffect(()=>()=>{he()},[he]),{callId:u,matchingId:h,partner:f,agoraChannelInfo:g,isInCall:S,isConnecting:C,agoraState:P,error:k,callDuration:Ge(),handleCallStart:ye,handleEndCall:Ve,toggleMute:Je,toggleSpeaker:Ue,setVolume:xe,setError:H,clearPartner:ie}};function yF({selectedCategory:u,onCancel:h,onConnected:f}){const[g,S]=ee.useState(""),{queuePosition:C}=QA(),{isInCall:w,isConnecting:P,error:k,handleCallStart:M}=ZA(),U=M0(),B=ee.useRef(new Set),Y=30*1e3,H=ee.useRef(null);ee.useEffect(()=>{const te=setInterval(()=>{S(ce=>ce==="..."?"":ce+".")},500);return()=>clearInterval(te)},[]),ee.useEffect(()=>{w&&!P&&f()},[w,P,f]);const ie=ee.useCallback(te=>{te.callId&&B.current.has(te.callId)||w||P||(te.callId&&B.current.add(te.callId),M(te))},[M,w,P]),X=ee.useCallback(te=>{},[]);return ee.useEffect(()=>(U.onCallStartNotificationCallback(ie),U.onMatchingNotificationCallback(X),()=>{}),[U,ie,X]),ee.useEffect(()=>(P&&!w?H.current=setTimeout(()=>{console.warn("   (30) -   ( )"),alert("   .  ."),h()},Y):H.current&&(clearTimeout(H.current),H.current=null),()=>{H.current&&(clearTimeout(H.current),H.current=null)}),[P,w,h]),ee.useEffect(()=>{k&&console.error("  :",k)},[k]),O.jsxs("div",{className:"min-h-screen flex flex-col relative safe-area-page pt-6",style:{background:`linear-gradient(0deg, rgba(120, 90, 0, 0.20) 0%, rgba(120, 90, 0, 0.20) 100%), 
                    radial-gradient(138.99% 139.71% at 10.56% -25.76%, rgba(235, 161, 0, 0.80) 0%, rgba(245, 69, 53, 0.80) 100%)`},children:[O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"bg-white px-4 py-2 rounded",children:O.jsxs("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:[" : ",EF(u)]})})}),O.jsx("div",{className:"flex justify-center mt-16",children:O.jsx("h1",{className:"text-white font-pretendard text-4xl font-medium",children:"  "})}),O.jsx("div",{className:"flex justify-center mt-20",children:O.jsx("div",{className:"relative",children:O.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 65 65",fill:"none",className:"animate-spin",style:{transform:"rotate(-90deg)"},children:[O.jsx("mask",{id:"path-1-inside-1_6652_403",fill:"white",children:O.jsx("path",{d:"M32.0187 0.000213623C49.7021 0.000213623 64.0374 14.3355 64.0374 32.0189C64.0374 49.7023 49.7021 64.0376 32.0187 64.0376C14.3353 64.0376 0 49.7023 0 32.0189C0 14.3355 14.3353 0.000213623 32.0187 0.000213623Z"})}),O.jsx("path",{d:"M32.0187 0.000213623L32.0187 9.339C44.5445 9.339 54.6986 19.4931 54.6986 32.0189L64.0374 32.0189H73.3762C73.3762 9.1778 54.8598 -9.33857 32.0187 -9.33857V0.000213623ZM64.0374 32.0189L54.6986 32.0189C54.6986 44.5447 44.5445 54.6988 32.0187 54.6988V64.0376V73.3764C54.8598 73.3764 73.3762 54.86 73.3762 32.0189H64.0374ZM32.0187 64.0376V54.6988C19.4929 54.6988 9.33879 44.5447 9.33879 32.0189H0H-9.33879C-9.33879 54.86 9.17759 73.3764 32.0187 73.3764V64.0376ZM0 32.0189H9.33879C9.33879 19.4931 19.4929 9.339 32.0187 9.339L32.0187 0.000213623V-9.33857C9.17759 -9.33857 -9.33879 9.1778 -9.33879 32.0189H0Z",fill:"url(#gradient)",mask:"url(#path-1-inside-1_6652_403)"}),O.jsx("defs",{children:O.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[O.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0)"}),O.jsx("stop",{offset:"100%",stopColor:"rgba(255,255,255,1)"})]})})]})})}),O.jsx("div",{className:"flex-1 flex items-center justify-center px-5",children:O.jsx("div",{className:"text-center",children:O.jsxs("p",{className:"text-white font-crimson text-2xl md:text-3xl font-bold leading-9",children:["   ",O.jsx("br",{})," ",g]})})}),O.jsx("div",{className:"px-5 pb-8 md:pb-12",children:O.jsx("div",{className:"h-20 md:h-24 relative",children:O.jsx("button",{onClick:h,className:"w-full h-14 md:h-16 bg-white rounded-lg font-crimson text-xl md:text-2xl font-bold text-orange-500 hover:bg-gray-50 transition-colors",children:""})})})]})}function TF({selectedCategory:u,onEndCall:h}){const[f,g]=ee.useState(0),{partner:S,agoraState:C,callDuration:w,isInCall:P,handleEndCall:k,toggleSpeaker:M,setError:U,error:B}=ZA();ee.useEffect(()=>{},[S]),ee.useEffect(()=>{!P&&S&&setTimeout(()=>{h()},100)},[P,S,h]),ee.useEffect(()=>{const te=Z=>{if(P)return Z.preventDefault(),Z.returnValue="  .   ?",Z.returnValue},ce=()=>{P&&k().catch(Z=>{console.error("     :",Z)})};return window.addEventListener("beforeunload",te),window.addEventListener("unload",ce),()=>{window.removeEventListener("beforeunload",te),window.removeEventListener("unload",ce)}},[P,k]);const Y=te=>{const ce=Math.floor(te/60),Z=te%60;return`${ce.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`},H=async()=>{try{await k(),h()}catch(te){console.error("  :",te),te instanceof Error&&te.message.includes("  ")?h():U("  .")}};ee.useEffect(()=>{const te=setInterval(()=>{g(ce=>(ce+1)%5)},200);return()=>clearInterval(te)},[]);const X=(te=>te===0?{color:"text-gray-400",bars:0,label:""}:te===1||te===2?{color:"text-green-400",bars:3,label:""}:te===3?{color:"text-yellow-400",bars:2,label:""}:te===4?{color:"text-orange-400",bars:1,label:""}:{color:"text-red-400",bars:1,label:""})(C.networkQuality?.downlinkNetworkQuality||0);return O.jsxs("div",{className:"min-h-screen flex flex-col relative safe-area-page pt-6",style:{background:`linear-gradient(0deg, rgba(120, 90, 0, 0.20) 0%, rgba(120, 90, 0, 0.20) 100%), 
                    radial-gradient(138.99% 139.71% at 10.56% -25.76%, rgba(235, 161, 0, 0.80) 0%, rgba(245, 69, 53, 0.80) 100%)`},children:[O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"bg-white px-4 py-2 rounded",children:O.jsxs("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:[" : ",EF(u)]})})}),O.jsx("div",{className:"absolute top-20 right-8",children:O.jsxs("div",{className:"flex items-center gap-2 bg-black bg-opacity-30 px-3 py-2 rounded-full",children:[O.jsxs("div",{className:"flex items-end gap-0.5 h-4",children:[O.jsx("div",{className:`w-1 h-2 rounded-sm ${X.bars>=1?X.color:"bg-gray-600"}`}),O.jsx("div",{className:`w-1 h-3 rounded-sm ${X.bars>=2?X.color:"bg-gray-600"}`}),O.jsx("div",{className:`w-1 h-4 rounded-sm ${X.bars>=3?X.color:"bg-gray-600"}`})]}),(C.networkQuality?.downlinkNetworkQuality||0)>=4&&O.jsx("span",{className:`text-xs font-pretendard ${X.color}`,children:X.label})]})}),O.jsxs("div",{className:"flex flex-col items-center justify-center mt-8 gap-1",children:[O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("span",{className:"text-white font-crimson text-3xl font-bold",children:S?.nickname||""}),O.jsx("span",{className:"text-white font-pretendard text-3xl font-normal",children:""})]}),O.jsx("span",{className:"text-white font-pretendard text-4xl font-normal",children:""})]}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"w-32 h-32 rounded-3xl bg-orange-100 flex items-center justify-center",children:O.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",children:[O.jsx("path",{d:"M40.294 41.162C46.589 41.162 51.696 36.055 51.696 29.76C51.696 23.465 46.589 18.358 40.294 18.358C34 18.358 28.893 23.465 28.893 29.76C28.893 36.055 34 41.162 40.294 41.162Z",fill:"#EE9049"}),O.jsx("path",{d:"M40.2927 44.504C25.6233 44.504 19.9185 54.507 19.9185 59.1582C19.9185 63.8094 32.0641 65.0489 40.2927 65.0489C48.5213 65.0489 60.6669 63.8094 60.6669 59.1582C60.6669 54.507 54.9621 44.504 40.2927 44.504Z",fill:"#EE9049"})]})})}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("span",{className:"text-white font-crimson text-2xl font-normal",children:Y(w)})}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"flex items-center justify-center gap-2",children:[0,1,2,3,4].map(te=>O.jsx("div",{className:`w-2 h-2 bg-white rounded-full transition-opacity duration-200 ${f===te?"opacity-100":"opacity-40"}`},te))})}),B&&O.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50",children:O.jsx("div",{className:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg max-w-md",children:O.jsx("p",{className:"text-center font-pretendard",children:B})})}),O.jsx("div",{className:"flex-1 flex items-end justify-center pb-16",children:O.jsxs("div",{className:"flex items-center justify-between w-80",children:[O.jsxs("div",{className:"flex flex-col items-center gap-4",children:[O.jsx("button",{onClick:M,className:`w-20 h-20 rounded-full flex items-center justify-center transition-colors ${C.isSpeakerOn?"bg-white bg-opacity-20":"bg-red-500 bg-opacity-50"}`,children:O.jsx("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",children:O.jsx("path",{d:"M23.1549 16.3334C22.4369 16.3334 21.8549 15.7513 21.8549 15.0334C21.8549 14.3154 22.4369 13.7334 23.1549 13.7334H26.7C27.418 13.7334 28 14.3154 28 15.0334C28 15.7513 27.418 16.3334 26.7 16.3334H23.1549ZM24.5798 26.9517C24.1486 27.5287 23.3292 27.6426 22.757 27.205L19.8968 25.0174C19.3336 24.5866 19.2219 23.7829 19.6464 23.2149C20.0776 22.638 20.8968 22.5242 21.4689 22.9617L24.3293 25.1491C24.8925 25.5798 25.0042 26.3836 24.5798 26.9517ZM21.4037 7.03847C20.8315 7.47612 20.0121 7.36225 19.5809 6.78516C19.1564 6.21715 19.2681 5.41337 19.8313 4.9826L22.6915 2.79506C23.2637 2.35741 24.0832 2.47128 24.5144 3.04838C24.9388 3.61639 24.8271 4.42017 24.2639 4.85093L21.4037 7.03847ZM3 19.3667C1.89543 19.3667 1 18.4713 1 17.3667V12.7C1 11.5955 1.89543 10.7 3 10.7H7.3087L12.8842 5.01477C13.5113 4.37534 14.5982 4.81934 14.5982 5.71495V24.3518C14.5982 25.2474 13.5113 25.6914 12.8842 25.052L7.3087 19.3667H3Z",fill:"white"})})}),O.jsx("span",{className:"text-white font-crimson text-lg font-bold",children:""})]}),O.jsxs("div",{className:"flex flex-col items-center gap-4",children:[O.jsx("button",{onClick:H,className:"w-20 h-20 rounded-full bg-red-500 flex items-center justify-center",children:O.jsx("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",children:O.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.8823 14.9998L24.2533 7.62879C24.7727 7.10936 24.7727 6.26593 24.2533 5.7465C23.7339 5.22708 22.8904 5.22708 22.371 5.7465L15 13.1175L7.629 5.7465C7.10958 5.22708 6.26615 5.22708 5.74672 5.7465C5.22729 6.26593 5.22729 7.10936 5.74672 7.62879L13.1177 14.9998L5.74672 22.3708C5.22729 22.8902 5.22729 23.7336 5.74672 24.2531C6.26615 24.7725 7.10958 24.7725 7.629 24.2531L15 16.8821L22.371 24.2531C22.8904 24.7725 23.7339 24.7725 24.2533 24.2531C24.7727 23.7336 24.7727 22.8902 24.2533 22.3708L16.8823 14.9998Z",fill:"white"})})}),O.jsx("span",{className:"text-white font-crimson text-lg font-bold",children:" "})]})]})})]})}function CF({selectedCategory:u,onCallAgain:h,onSelectInterests:f,onGoHome:g}){const[S,C]=ee.useState(null),[w,P]=ee.useState(!1),[k,M]=ee.useState(!1),{partner:U,clearPartner:B,callId:Y}=ZA(),H=UE();ee.useEffect(()=>{},[U,Y]);const ie=async()=>{if(!S||!Y){console.error("   callId .");return}P(!0);try{const X={call_id:parseInt(Y),feedback_type:S==="good"?"POSITIVE":"NEGATIVE",negative:S==="bad",positive:S==="good"},te=uo();if(te)H.setToken(te);else throw new Error("  .  .");await H.submitEvaluation(X),M(!0),B(),setTimeout(()=>{M(!1),g()},2e3)}catch(X){console.error("   :",X),alert("  .  .")}finally{P(!1)}};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col relative safe-area-page",children:[k&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:O.jsxs("div",{className:"bg-white rounded-2xl p-8 mx-4 max-w-sm w-full text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",className:"text-green-600",children:O.jsx("path",{d:"M26.6667 8L11.3333 23.3333L5.33334 17.3333",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:" !"}),O.jsxs("p",{className:"text-gray-600",children:[S==="good"?"":""," ."]})]})}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("h1",{className:"text-orange-500 font-crimson text-2xl font-bold",children:" "})}),O.jsxs("div",{className:"flex flex-col items-center justify-center mt-8 gap-3",children:[O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("span",{className:"text-gray-900 font-crimson text-4xl font-bold",children:U?.nickname||""}),O.jsx("span",{className:"text-gray-900 font-pretendard text-4xl font-normal",children:""})]}),O.jsx("span",{className:"text-gray-900 font-pretendard text-4xl font-normal",children:" ?"})]}),O.jsxs("div",{className:"flex gap-4 px-5 mt-12",children:[O.jsxs("button",{onClick:()=>C("bad"),className:`flex-1 h-36 rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all ${S==="bad"?"border-orange-400 bg-orange-50":"border-gray-300 bg-gray-100"}`,children:[O.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",fill:"none",children:[O.jsx("path",{d:"M7.5 40C6.16667 40 5 39.5 4 38.5C3 37.5 2.5 36.3333 2.5 35V30C2.5 29.7083 2.53125 29.3958 2.59375 29.0625C2.65625 28.7292 2.75 28.4167 2.875 28.125L10.375 10.5C10.75 9.66667 11.375 8.95833 12.25 8.375C13.125 7.79167 14.0417 7.5 15 7.5H35C36.375 7.5 37.5521 7.98958 38.5312 8.96875C39.5104 9.94792 40 11.125 40 12.5V37.9375C40 38.6042 39.8646 39.2396 39.5938 39.8438C39.3229 40.4479 38.9583 40.9792 38.5 41.4375L24.9375 54.9375C24.3125 55.5208 23.5729 55.875 22.7188 56C21.8646 56.125 21.0417 55.9792 20.25 55.5625C19.4583 55.1458 18.8854 54.5625 18.5312 53.8125C18.1771 53.0625 18.1042 52.2917 18.3125 51.5L21.125 40H7.5ZM50 7.5C51.375 7.5 52.5521 7.98958 53.5312 8.96875C54.5104 9.94792 55 11.125 55 12.5V35C55 36.375 54.5104 37.5521 53.5312 38.5313C52.5521 39.5104 51.375 40 50 40C48.625 40 47.4479 39.5104 46.4688 38.5313C45.4896 37.5521 45 36.375 45 35V12.5C45 11.125 45.4896 9.94792 46.4688 8.96875C47.4479 7.98958 48.625 7.5 50 7.5Z",fill:"url(#paint0_radial_bad)"}),O.jsx("defs",{children:O.jsxs("radialGradient",{id:"paint0_radial_bad",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(36 -44 104.92 102.906 15.5 59.5)",gradientUnits:"userSpaceOnUse",children:[O.jsx("stop",{stopColor:"#5D5D5D"}),O.jsx("stop",{offset:"1",stopColor:"#9E9B9B"})]})})]}),O.jsx("span",{className:"text-gray-900 font-crimson text-2xl font-bold",children:""})]}),O.jsxs("button",{onClick:()=>C("good"),className:`flex-1 h-36 rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all ${S==="good"?"border-orange-400 bg-orange-50":"border-gray-300 bg-gray-100"}`,children:[O.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",fill:"none",children:[O.jsx("path",{d:"M27.3539 51.2033C28.9615 52.2656 31.037 52.2656 32.6446 51.2033C37.7481 47.8307 48.8704 39.7751 53.6589 30.7582C59.9748 18.8635 52.558 7 42.7566 7C37.1687 7 33.8065 9.91945 31.9478 12.4288C30.9687 13.7511 29.0328 13.7511 28.0522 12.4288C26.1935 9.91945 22.8313 7 17.2434 7C7.44202 7 0.0252047 18.8635 6.34108 30.7582C11.1281 39.7736 22.2504 47.8307 27.3539 51.2033Z",fill:"url(#paint0_radial_good)"}),O.jsx("defs",{children:O.jsxs("radialGradient",{id:"paint0_radial_good",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(-18.5 26.5 -68.601 -50.7338 45.5 16.5)",gradientUnits:"userSpaceOnUse",children:[O.jsx("stop",{stopColor:"#E35241"}),O.jsx("stop",{offset:"1",stopColor:"#FF8B76"})]})})]}),O.jsx("span",{className:"text-gray-900 font-crimson text-2xl font-bold",children:""})]})]}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("p",{className:"text-gray-500 font-crimson text-xl",children:"   "})}),O.jsx("div",{className:"flex justify-center mt-6 px-5",children:O.jsx("button",{onClick:ie,disabled:!S||w,className:`w-full max-w-sm h-14 rounded-lg font-crimson text-xl font-bold transition-all ${S&&!w?"bg-gradient-to-r from-yellow-300 to-red-gradient text-white hover:opacity-90":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:w?" ...":" "})}),O.jsx("div",{className:"flex-1 flex items-end pb-8",children:O.jsx("div",{className:"w-full px-5",children:O.jsxs("div",{className:"flex gap-2",children:[O.jsx("button",{onClick:()=>{B(),h()},className:"flex-1 h-14 border border-orange-500 rounded-lg flex items-center justify-center bg-white",children:O.jsx("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:" "})}),O.jsx("button",{onClick:()=>{B(),f()},className:"flex-1 h-14 bg-orange-500 rounded-lg flex items-center justify-center",children:O.jsx("span",{className:"text-white font-crimson text-xl font-bold",children:" "})})]})})})]})}function RF({onBack:u,onNavigateToActivity:h,onNavigateToProfileEdit:f,onNavigateToComingSoon:g,onNavigateToSupport:S,onLogout:C}){const w=[{id:"subscription",title:" ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 13.9L13.5 15.05C13.6833 15.2 13.8833 15.2042 14.1 15.0625C14.3167 14.9208 14.3833 14.7333 14.3 14.5L13.7 12.6L15.375 11.3C15.5583 11.15 15.6083 10.9625 15.525 10.7375C15.4417 10.5125 15.2833 10.4 15.05 10.4H13.1L12.475 8.475C12.3917 8.24167 12.2333 8.125 12 8.125C11.7667 8.125 11.6083 8.24167 11.525 8.475L10.9 10.4H8.925C8.69167 10.4 8.5375 10.5125 8.4625 10.7375C8.3875 10.9625 8.44167 11.15 8.625 11.3L10.25 12.6L9.65 14.525C9.56667 14.7583 9.625 14.9458 9.825 15.0875C10.025 15.2292 10.225 15.225 10.425 15.075L12 13.9ZM4 20C3.45 20 2.97917 19.8042 2.5875 19.4125C2.19583 19.0208 2 18.55 2 18V14.625C2 14.4417 2.05833 14.2833 2.175 14.15C2.29167 14.0167 2.44167 13.9333 2.625 13.9C3.025 13.7667 3.35417 13.525 3.6125 13.175C3.87083 12.825 4 12.4333 4 12C4 11.5667 3.87083 11.175 3.6125 10.825C3.35417 10.475 3.025 10.2333 2.625 10.1C2.44167 10.0667 2.29167 9.98333 2.175 9.85C2.05833 9.71667 2 9.55833 2 9.375V6C2 5.45 2.19583 4.97917 2.5875 4.5875C2.97917 4.19583 3.45 4 4 4H20C20.55 4 21.0208 4.19583 21.4125 4.5875C21.8042 4.97917 22 5.45 22 6V9.375C22 9.55833 21.9417 9.71667 21.825 9.85C21.7083 9.98333 21.5583 10.0667 21.375 10.1C20.975 10.2333 20.6458 10.475 20.3875 10.825C20.1292 11.175 20 11.5667 20 12C20 12.4333 20.1292 12.825 20.3875 13.175C20.6458 13.525 20.975 13.7667 21.375 13.9C21.5583 13.9333 21.7083 14.0167 21.825 14.15C21.9417 14.2833 22 14.4417 22 14.625V18C22 18.55 21.8042 19.0208 21.4125 19.4125C21.0208 19.8042 20.55 20 20 20H4Z",fill:"#EA8C4B"})})},{id:"activity",title:"  ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M6 22C5.16667 22 4.45833 21.7083 3.875 21.125C3.29167 20.5417 3 19.8333 3 19V18C3 17.45 3.19583 16.9792 3.5875 16.5875C3.97917 16.1958 4.45 16 5 16H6V4C6 3.45 6.19583 2.97917 6.5875 2.5875C6.97917 2.19583 7.45 2 8 2H19C19.55 2 20.0208 2.19583 20.4125 2.5875C20.8042 2.97917 21 3.45 21 4V19C21 19.8333 20.7083 20.5417 20.125 21.125C19.5417 21.7083 18.8333 22 18 22H6ZM18 20C18.2833 20 18.5208 19.9042 18.7125 19.7125C18.9042 19.5208 19 19.2833 19 19V4H8V16H15C15.55 16 16.0208 16.1958 16.4125 16.5875C16.8042 16.9792 17 17.45 17 18V19C17 19.2833 17.0958 19.5208 17.2875 19.7125C17.4792 19.9042 17.7167 20 18 20ZM10 9C9.71667 9 9.47917 8.90417 9.2875 8.7125C9.09583 8.52083 9 8.28333 9 8C9 7.71667 9.09583 7.47917 9.2875 7.2875C9.47917 7.09583 9.71667 7 10 7H17C17.2833 7 17.5208 7.09583 17.7125 7.2875C17.9042 7.47917 18 7.71667 18 8C18 8.28333 17.9042 8.52083 17.7125 8.7125C17.5208 8.90417 17.2833 9 17 9H10ZM10 12C9.71667 12 9.47917 11.9042 9.2875 11.7125C9.09583 11.5208 9 11.2833 9 11C9 10.7167 9.09583 10.4792 9.2875 10.2875C9.47917 10.0958 9.71667 10 10 10H17C17.2833 10 17.5208 10.0958 17.7125 10.2875C17.9042 10.4792 18 10.7167 18 11C18 11.2833 17.9042 11.5208 17.7125 11.7125C17.5208 11.9042 17.2833 12 17 12H10Z",fill:"#EA8C4B"})})},{id:"notifications",title:" ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M13 12.5999V8.9999C13 8.71657 12.9042 8.47907 12.7125 8.2874C12.5209 8.09574 12.2834 7.9999 12 7.9999C11.7167 7.9999 11.4792 8.09574 11.2875 8.2874C11.0959 8.47907 11 8.71657 11 8.9999V12.9749C11 13.1082 11.025 13.2374 11.075 13.3624C11.125 13.4874 11.2 13.5999 11.3 13.6999L14.1 16.4999C14.2834 16.6832 14.5167 16.7749 14.8 16.7749C15.0834 16.7749 15.3167 16.6832 15.5 16.4999C15.6834 16.3166 15.775 16.0832 15.775 15.7999C15.775 15.5166 15.6834 15.2832 15.5 15.0999L13 12.5999ZM12 21.9999C10.75 21.9999 9.57919 21.7624 8.48752 21.2874C7.39586 20.8124 6.44586 20.1707 5.63752 19.3624C4.82919 18.5541 4.18752 17.6041 3.71252 16.5124C3.23752 15.4207 3.00002 14.2499 3.00002 12.9999C3.00002 11.7499 3.23752 10.5791 3.71252 9.4874C4.18752 8.39574 4.82919 7.44574 5.63752 6.6374C6.44586 5.82907 7.39586 5.1874 8.48752 4.7124C9.57919 4.2374 10.75 3.9999 12 3.9999C13.25 3.9999 14.4209 4.2374 15.5125 4.7124C16.6042 5.1874 17.5542 5.82907 18.3625 6.6374C19.1709 7.44574 19.8125 8.39574 20.2875 9.4874C20.7625 10.5791 21 11.7499 21 12.9999C21 14.2499 20.7625 15.4207 20.2875 16.5124C19.8125 17.6041 19.1709 18.5541 18.3625 19.3624C17.5542 20.1707 16.6042 20.8124 15.5125 21.2874C14.4209 21.7624 13.25 21.9999 12 21.9999ZM2.05002 7.2999C1.86669 7.11657 1.77502 6.88324 1.77502 6.5999C1.77502 6.31657 1.86669 6.08324 2.05002 5.8999L4.90002 3.0499C5.08336 2.86657 5.31669 2.7749 5.60002 2.7749C5.88336 2.7749 6.11669 2.86657 6.30002 3.0499C6.48336 3.23324 6.57502 3.46657 6.57502 3.7499C6.57502 4.03324 6.48336 4.26657 6.30002 4.4499L3.45002 7.2999C3.26669 7.48324 3.03336 7.5749 2.75002 7.5749C2.46669 7.5749 2.23336 7.48324 2.05002 7.2999ZM21.95 7.2999C21.7667 7.48324 21.5334 7.5749 21.25 7.5749C20.9667 7.5749 20.7334 7.48324 20.55 7.2999L17.7 4.4499C17.5167 4.26657 17.425 4.03324 17.425 3.7499C17.425 3.46657 17.5167 3.23324 17.7 3.0499C17.8834 2.86657 18.1167 2.7749 18.4 2.7749C18.6834 2.7749 18.9167 2.86657 19.1 3.0499L21.95 5.8999C22.1334 6.08324 22.225 6.31657 22.225 6.5999C22.225 6.88324 22.1334 7.11657 21.95 7.2999Z",fill:"#EA8C4B"})})},{id:"support",title:"",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M11.75 19H11.5C9.13333 19 7.125 18.175 5.475 16.525C3.825 14.875 3 12.8667 3 10.5C3 8.13333 3.825 6.125 5.475 4.475C7.125 2.825 9.13333 2 11.5 2C12.6833 2 13.7875 2.22083 14.8125 2.6625C15.8375 3.10417 16.7375 3.7125 17.5125 4.4875C18.2875 5.2625 18.8958 6.1625 19.3375 7.1875C19.7792 8.2125 20 9.31667 20 10.5C20 12.7333 19.3708 14.8083 18.1125 16.725C16.8542 18.6417 15.2667 20.1417 13.35 21.225C13.1833 21.3083 13.0167 21.3542 12.85 21.3625C12.6833 21.3708 12.5333 21.3333 12.4 21.25C12.2667 21.1667 12.15 21.0583 12.05 20.925C11.95 20.7917 11.8917 20.6333 11.875 20.45L11.75 19ZM11.475 15.975C11.7583 15.975 12 15.875 12.2 15.675C12.4 15.475 12.5 15.2333 12.5 14.95C12.5 14.6667 12.4 14.425 12.2 14.225C12 14.025 11.7583 13.925 11.475 13.925C11.1917 13.925 10.95 14.025 10.75 14.225C10.55 14.425 10.45 14.6667 10.45 14.95C10.45 15.2333 10.55 15.475 10.75 15.675C10.95 15.875 11.1917 15.975 11.475 15.975ZM9.3 8.375C9.48333 8.45833 9.66667 8.4625 9.85 8.3875C10.0333 8.3125 10.1833 8.19167 10.3 8.025C10.45 7.825 10.625 7.67083 10.825 7.5625C11.025 7.45417 11.25 7.4 11.5 7.4C11.9 7.4 12.225 7.5125 12.475 7.7375C12.725 7.9625 12.85 8.25 12.85 8.6C12.85 8.81667 12.7875 9.03333 12.6625 9.25C12.5375 9.46667 12.3167 9.73333 12 10.05C11.5833 10.4167 11.275 10.7625 11.075 11.0875C10.875 11.4125 10.775 11.7417 10.775 12.075C10.775 12.275 10.8458 12.4458 10.9875 12.5875C11.1292 12.7292 11.3 12.8 11.5 12.8C11.7 12.8 11.8667 12.725 12 12.575C12.1333 12.425 12.2333 12.25 12.3 12.05C12.3833 11.7667 12.5333 11.5083 12.75 11.275C12.9667 11.0417 13.1667 10.8333 13.35 10.65C13.7 10.3 13.9625 9.95 14.1375 9.6C14.3125 9.25 14.4 8.9 14.4 8.55C14.4 7.78333 14.1375 7.16667 13.6125 6.7C13.0875 6.23333 12.3833 6 11.5 6C10.9667 6 10.475 6.12917 10.025 6.3875C9.575 6.64583 9.20833 7 8.925 7.45C8.825 7.63333 8.8125 7.8125 8.8875 7.9875C8.9625 8.1625 9.1 8.29167 9.3 8.375Z",fill:"#EA8C4B"})})},{id:"profile-edit",title:" ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"#EA8C4B"})})}],P=k=>{k==="activity"?h():k==="profile-edit"?f():k==="subscription"?g(" "):k==="notifications"?g(" "):k==="support"&&S()};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5",children:[O.jsx("div",{className:"flex flex-col gap-4",children:w.map(k=>O.jsxs("button",{onClick:()=>P(k.id),className:"flex items-center justify-between p-6 border border-gray-200 rounded-2xl bg-white hover:bg-gray-50 transition-colors",children:[O.jsxs("div",{className:"flex flex-col items-start gap-2",children:[k.icon,O.jsx("span",{className:"text-gray-800 font-crimson text-2xl font-semibold",children:k.title})]}),O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M8 5L15 12L8 19",stroke:"#BFC2C0",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]},k.id))}),O.jsx("div",{className:"mt-8",children:O.jsxs("button",{onClick:C,className:"w-full flex items-center justify-center gap-2 p-4 border border-red-200 rounded-2xl bg-red-50 hover:bg-red-100 transition-colors",children:[O.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[O.jsx("path",{d:"M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),O.jsx("path",{d:"M16 17L21 12L16 7",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),O.jsx("path",{d:"M21 12H9",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),O.jsx("span",{className:"text-red-600 font-crimson text-lg font-semibold",children:""})]})})]})]})}function wF({onBack:u}){const[h,f]=ee.useState(null),[g,S]=ee.useState(!0),[C,w]=ee.useState(null);ee.useEffect(()=>{(async()=>{try{S(!0),w(null);const B=UE(),Y=uo();if(!Y)throw new Error(" .");B.setToken(Y);const H=await B.getActivityStats();f(H)}catch(B){console.error("   :",B),w(B instanceof Error?B.message:"    .")}finally{S(!1)}})()},[]);const P=U=>{if(U===0)return"1 ";const B=Math.floor(U/60),Y=U%60;return B===0?`${Y}`:Y===0?`${B}`:`${B} ${Y}`},M=(()=>{if(!h)return{level:"NEW",displayName:""};const{callCount:U,totalDurationMinutes:B}=h.weeklyStats;return U>=3||B>=90?{level:"EXCELLENT",displayName:""}:U>=1?{level:"GOOD",displayName:""}:{level:"NEW",displayName:""}})();return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:"  "}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5",children:[g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 font-pretendard",children:"   ..."})]})}),C&&!g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-red-500 font-pretendard mb-4",children:C}),O.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-orange-500 text-white rounded-lg font-pretendard",children:" "})]})}),!g&&!C&&h&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"text-center mb-8",children:O.jsx("h2",{className:"text-gray-800 font-pretendard text-3xl font-medium",children:" ?"})}),O.jsx("div",{className:"flex justify-center mb-16",children:O.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 px-10 py-3 rounded-xl border-2 border-white/50",style:{background:M.level==="EXCELLENT"?"linear-gradient(93deg, #F4BC41 0.31%, #E26155 100.05%)":M.level==="GOOD"?"linear-gradient(93deg, #4B9FE1 0.31%, #6CC4A1 100.05%)":"linear-gradient(93deg, #FCD34D 0.31%, #F59E0B 100.05%)"},children:[O.jsx("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",children:O.jsx("path",{d:"M9.33333 14.4V9.33333H6.66667V10.6667C6.66667 11.5111 6.91111 12.2722 7.4 12.95C7.88889 13.6278 8.53333 14.1111 9.33333 14.4ZM22.6667 14.4C23.4667 14.1111 24.1111 13.6278 24.6 12.95C25.0889 12.2722 25.3333 11.5111 25.3333 10.6667V9.33333H22.6667V14.4ZM14.6667 25.3333V21.2C13.5778 20.9556 12.6056 20.4944 11.75 19.8167C10.8944 19.1389 10.2667 18.2889 9.86667 17.2667C8.2 17.0667 6.80556 16.3389 5.68333 15.0833C4.56111 13.8278 4 12.3556 4 10.6667V9.33333C4 8.6 4.26111 7.97222 4.78333 7.45C5.30556 6.92778 5.93333 6.66667 6.66667 6.66667H9.33333C9.33333 5.93333 9.59444 5.30556 10.1167 4.78333C10.6389 4.26111 11.2667 4 12 4H20C20.7333 4 21.3611 4.26111 21.8833 4.78333C22.4056 5.30556 22.6667 5.93333 22.6667 6.66667H25.3333C26.0667 6.66667 26.6944 6.92778 27.2167 7.45C27.7389 7.97222 28 8.6 28 9.33333V10.6667C28 12.3556 27.4389 13.8278 26.3167 15.0833C25.1944 16.3389 23.8 17.0667 22.1333 17.2667C21.7333 18.2889 21.1056 19.1389 20.25 19.8167C19.3944 20.4944 18.4222 20.9556 17.3333 21.2V25.3333H21.3333C21.7111 25.3333 22.0278 25.4611 22.2833 25.7167C22.5389 25.9722 22.6667 26.2889 22.6667 26.6667C22.6667 27.0444 22.5389 27.3611 22.2833 27.6167C22.0278 27.8722 21.7111 28 21.3333 28H10.6667C10.2889 28 9.97222 27.8722 9.71667 27.6167C9.46111 27.3611 9.33333 27.0444 9.33333 26.6667C9.33333 26.2889 9.46111 25.9722 9.71667 25.7167C9.97222 25.4611 10.2889 25.3333 10.6667 25.3333H14.6667Z",fill:"white"})}),O.jsx("span",{className:"text-white font-crimson text-xl font-bold",children:M.displayName})]})}),O.jsxs("div",{className:"mb-8",children:[O.jsx("h3",{className:"text-orange-500 font-crimson text-2xl font-bold mb-4",children:"  "}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M19.95 21C17.8667 21 15.8083 20.5458 13.775 19.6375C11.7417 18.7292 9.89167 17.4417 8.225 15.775C6.55833 14.1083 5.27083 12.2583 4.3625 10.225C3.45417 8.19167 3 6.13333 3 4.05C3 3.75 3.1 3.5 3.3 3.3C3.5 3.1 3.75 3 4.05 3H8.1C8.33333 3 8.54167 3.07917 8.725 3.2375C8.90833 3.39583 9.01667 3.58333 9.05 3.8L9.7 7.3C9.73333 7.56667 9.725 7.79167 9.675 7.975C9.625 8.15833 9.53333 8.31667 9.4 8.45L6.975 10.9C7.30833 11.5167 7.70417 12.1125 8.1625 12.6875C8.62083 13.2625 9.125 13.8167 9.675 14.35C10.1917 14.8667 10.7333 15.3458 11.3 15.7875C11.8667 16.2292 12.4667 16.6333 13.1 17L15.45 14.65C15.6 14.5 15.7958 14.3875 16.0375 14.3125C16.2792 14.2375 16.5167 14.2167 16.75 14.25L20.2 14.95C20.4333 15.0167 20.625 15.1375 20.775 15.3125C20.925 15.4875 21 15.6833 21 15.9V19.95C21 20.25 20.9 20.5 20.7 20.7C20.5 20.9 20.25 21 19.95 21Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsxs("span",{className:"text-gray-800 font-crimson text-xl",children:[h.weeklyStats.callCount,""]})]}),O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M13 11.6V8C13 7.71667 12.9042 7.47917 12.7125 7.2875C12.5208 7.09583 12.2833 7 12 7C11.7167 7 11.4792 7.09583 11.2875 7.2875C11.0958 7.47917 11 7.71667 11 8V11.975C11 12.1083 11.025 12.2375 11.075 12.3625C11.125 12.4875 11.2 12.6 11.3 12.7L14.6 16C14.7833 16.1833 15.0167 16.275 15.3 16.275C15.5833 16.275 15.8167 16.1833 16 16C16.1833 15.8167 16.275 15.5833 16.275 15.3C16.275 15.0167 16.1833 14.7833 16 14.6L13 11.6ZM12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C13.3833 2 14.6833 2.2625 15.9 2.7875C17.1167 3.3125 18.175 4.025 19.075 4.925C19.975 5.825 20.6875 6.88333 21.2125 8.1C21.7375 9.31667 22 10.6167 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl",children:P(h.weeklyStats.totalDurationMinutes)})]})]})]}),O.jsxs("div",{children:[O.jsx("h3",{className:"text-orange-500 font-crimson text-2xl font-bold mb-4",children:"  "}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M19.95 21C17.8667 21 15.8083 20.5458 13.775 19.6375C11.7417 18.7292 9.89167 17.4417 8.225 15.775C6.55833 14.1083 5.27083 12.2583 4.3625 10.225C3.45417 8.19167 3 6.13333 3 4.05C3 3.75 3.1 3.5 3.3 3.3C3.5 3.1 3.75 3 4.05 3H8.1C8.33333 3 8.54167 3.07917 8.725 3.2375C8.90833 3.39583 9.01667 3.58333 9.05 3.8L9.7 7.3C9.73333 7.56667 9.725 7.79167 9.675 7.975C9.625 8.15833 9.53333 8.31667 9.4 8.45L6.975 10.9C7.30833 11.5167 7.70417 12.1125 8.1625 12.6875C8.62083 13.2625 9.125 13.8167 9.675 14.35C10.1917 14.8667 10.7333 15.3458 11.3 15.7875C11.8667 16.2292 12.4667 16.6333 13.1 17L15.45 14.65C15.6 14.5 15.7958 14.3875 16.0375 14.3125C16.2792 14.2375 16.5167 14.2167 16.75 14.25L20.2 14.95C20.4333 15.0167 20.625 15.1375 20.775 15.3125C20.925 15.4875 21 15.6833 21 15.9V19.95C21 20.25 20.9 20.5 20.7 20.7C20.5 20.9 20.25 21 19.95 21Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsxs("span",{className:"text-gray-800 font-crimson text-xl",children:[h.quarterlyStats.callCount,""]})]}),O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M13 11.6V8C13 7.71667 12.9042 7.47917 12.7125 7.2875C12.5208 7.09583 12.2833 7 12 7C11.7167 7 11.4792 7.09583 11.2875 7.2875C11.0958 7.47917 11 7.71667 11 8V11.975C11 12.1083 11.025 12.2375 11.075 12.3625C11.125 12.4875 11.2 12.6 11.3 12.7L14.6 16C14.7833 16.1833 15.0167 16.275 15.3 16.275C15.5833 16.275 15.8167 16.1833 16 16C16.1833 15.8167 16.275 15.5833 16.275 15.3C16.275 15.0167 16.1833 14.7833 16 14.6L13 11.6ZM12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C13.3833 2 14.6833 2.2625 15.9 2.7875C17.1167 3.3125 18.175 4.025 19.075 4.925C19.975 5.825 20.6875 6.88333 21.2125 8.1C21.7375 9.31667 22 10.6167 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl",children:P(h.quarterlyStats.totalDurationMinutes)})]})]})]}),O.jsx("div",{className:"mt-8 flex justify-center",children:O.jsx("button",{onClick:u,className:"w-full max-w-sm h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:""})})]})]})]})}function bF({onBack:u}){const[h,f]=ee.useState([]),[g,S]=ee.useState(!0),[C,w]=ee.useState(null),[P,k]=ee.useState(1),[M,U]=ee.useState(1),[B,Y]=ee.useState(!1),H=async(ce=1)=>{try{S(!0),w(null);const Z=UE(),le=uo();if(!le)throw new Error(" .");Z.setToken(le);const ne=await Z.getCallHistory({page:ce,limit:20,period:"all"});f(ne.calls),k(ne.pagination.currentPage),U(ne.pagination.totalPages),Y(ne.pagination.hasNext)}catch(Z){console.error("   :",Z),w(Z instanceof Error?Z.message:"    .")}finally{S(!1)}};ee.useEffect(()=>{H(1)},[]);const ie=ce=>{const Z=new Date(ce),le=Z.getMonth()+1,ne=Z.getDate(),de=Z.getHours().toString().padStart(2,"0"),Pe=Z.getMinutes().toString().padStart(2,"0");return`${le}/${ne} ${de}:${Pe}`},X=ce=>{if(ce===0)return"1 ";const Z=Math.floor(ce/60),le=ce%60;return Z===0?`${le}`:le===0?`${Z}`:`${Z} ${le}`},te=ce=>{ce<1||ce>M||(H(ce),window.scrollTo({top:0,behavior:"smooth"}))};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:" "}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5",children:[g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 font-pretendard",children:"   ..."})]})}),C&&!g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-red-500 font-pretendard mb-4",children:C}),O.jsx("button",{onClick:()=>H(P),className:"px-4 py-2 bg-orange-500 text-white rounded-lg font-pretendard",children:" "})]})}),!g&&!C&&O.jsx(O.Fragment,{children:h.length===0?O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-gray-500 font-pretendard text-lg",children:"   "}),O.jsx("p",{className:"text-gray-400 font-pretendard text-sm mt-2",children:"  !"})]})}):O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"space-y-3",children:h.map(ce=>O.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-100 hover:bg-gray-100 transition-colors",children:[O.jsxs("div",{className:"flex items-center justify-between mb-2",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:O.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"#EE9049"})})}),O.jsxs("div",{className:"ml-1",children:[O.jsx("p",{className:"text-gray-800 font-crimson text-lg font-semibold",children:ce.partnerNickname}),O.jsx("p",{className:"text-gray-500 font-pretendard text-xs",children:ie(ce.startedAt)})]})]}),O.jsx("div",{className:"text-right",children:O.jsx("p",{className:"text-orange-500 font-crimson text-base font-semibold",children:X(ce.durationMinutes)})})]}),O.jsx("div",{className:"flex items-center gap-2 ml-[52px]",children:O.jsx("div",{className:"px-3 py-1 bg-white rounded-full border border-orange-200",children:O.jsx("span",{className:"text-orange-500 font-pretendard text-sm",children:ce.categoryName})})})]},ce.callId))}),M>1&&O.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8",children:[O.jsx("button",{onClick:()=>te(P-1),disabled:P===1,className:`px-4 py-2 rounded-lg font-pretendard ${P===1?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600"}`,children:""}),O.jsxs("span",{className:"text-gray-700 font-pretendard",children:[P," / ",M]}),O.jsx("button",{onClick:()=>te(P+1),disabled:!B,className:`px-4 py-2 rounded-lg font-pretendard ${B?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:""})]})]})})]})]})}function IF({featureName:u,onBack:h}){const f=Qd(),g=D0(),C=new URLSearchParams(g.search).get("feature"),w=u||C||" ",P=()=>{h?h():f(-1)};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:P,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:w}),O.jsx("div",{className:"w-6"})]}),O.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"mb-8",children:O.jsx("div",{className:"w-32 h-32 mx-auto bg-orange-100 rounded-full flex items-center justify-center",children:O.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z",fill:"#EA8C4B"})})})}),O.jsx("h2",{className:"text-gray-900 font-crimson text-3xl font-bold mb-4",children:" "}),O.jsxs("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-2",children:[w,"()   ."]}),O.jsx("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-8",children:"    ."}),O.jsx("div",{className:"bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-8",children:O.jsxs("p",{className:"text-orange-600 font-pretendard text-base leading-relaxed",children:["    ",O.jsx("br",{}),"  . "]})}),O.jsx("button",{onClick:P,className:"w-full max-w-sm h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:""})]})})]})}function AF({onBack:u}){const h="chingoohaja@gmail.com",f=()=>{navigator.clipboard.writeText(h),alert("  !")},g=()=>{window.location.href=`mailto:${h}`};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),O.jsx("div",{className:"w-6"})]}),O.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:O.jsxs("div",{className:"text-center w-full max-w-md",children:[O.jsx("div",{className:"mb-8",children:O.jsx("div",{className:"w-32 h-32 mx-auto bg-orange-100 rounded-full flex items-center justify-center",children:O.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z",fill:"#EA8C4B"})})})}),O.jsx("h2",{className:"text-gray-900 font-crimson text-3xl font-bold mb-4",children:""}),O.jsxs("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-8",children:["    ?",O.jsx("br",{}),"  ."]}),O.jsxs("div",{className:"bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-6",children:[O.jsx("p",{className:"text-gray-700 font-pretendard text-sm mb-3",children:" "}),O.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[O.jsx("p",{className:"text-orange-600 font-crimson text-xl font-bold",children:h}),O.jsx("button",{onClick:f,className:"p-2 hover:bg-orange-100 rounded-lg transition-colors",title:"",children:O.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#EA8C4B",strokeWidth:"2",children:[O.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),O.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})})]}),O.jsx("p",{className:"text-gray-500 font-pretendard text-sm",children:"  . "})]}),O.jsxs("div",{className:"space-y-3",children:[O.jsx("button",{onClick:g,className:"w-full h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:" "}),O.jsx("button",{onClick:u,className:"w-full h-14 bg-white border-2 border-gray-200 text-gray-700 font-crimson text-xl font-semibold rounded-lg hover:bg-gray-50 transition-colors",children:""})]}),O.jsx("div",{className:"mt-8",children:O.jsxs("p",{className:"text-gray-500 font-pretendard text-sm leading-relaxed",children:["   :  09:00 - 18:00",O.jsx("br",{}),"(   )"]})})]})})]})}function hne(){const[u,h]=ee.useState(!1),[f,g]=ee.useState(!0),[S,C]=ee.useState("home"),[w,P]=ee.useState(null),[k,M]=ee.useState(!1),[U,B]=ee.useState(!1),[Y,H]=ee.useState(!1),[ie,X]=ee.useState(!1),[te,ce]=ee.useState(!1),[Z,le]=ee.useState(""),ne=Qd();ee.useEffect(()=>{(()=>{try{const Ot=zA(),Gt=DE();if(h(Ot),Ot&&Gt)if(Gt.is_new_user||!Gt.is_profile_complete){ne("/profile-setup",{replace:!0});return}else return}catch(Ot){console.error("Error checking auth status:",Ot),h(!1)}finally{g(!1)}})()},[ne]),ee.useEffect(()=>{!f&&!u&&ne("/login",{replace:!0})},[f,u,ne]);const de=async()=>{try{await rF(),h(!1),C("home"),P(null),M(!1),B(!1),ne("/login",{replace:!0})}catch(at){console.error("   :",at),h(!1),C("home"),P(null),M(!1),B(!1),ne("/login",{replace:!0})}},Pe=at=>{P(at),C("connecting")},ue=()=>{C("home"),P(null)},he=()=>{C("inCall")},ye=()=>{C("evaluation")},Ve=()=>{C("connecting")},Je=()=>{C("home"),P(null)},Ue=()=>{C("home"),P(null)},xe=()=>{M(!0)},Ge=()=>{M(!1)},dt=()=>{B(!0)},Xe=()=>{H(!0)},We=()=>{M(!1),ne("/profile-setup")},Ie=()=>{B(!1)},De=()=>{H(!1)},ze=at=>{le(at),X(!0),M(!1)},_e=()=>{X(!1),M(!0)},ke=()=>{ce(!0),M(!1)},ct=()=>{ce(!1),M(!0)};return f?O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx("div",{className:"min-h-screen bg-grey-50 flex items-center justify-center safe-area-page",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-orange-accent border-t-transparent rounded-full mx-auto mb-4"}),O.jsx("p",{className:"text-grey-900 font-crimson text-lg",children:" ..."})]})})}):O.jsx("div",{className:"max-w-md mx-auto",children:u?te?O.jsx(AF,{onBack:ct}):ie?O.jsx(IF,{featureName:Z,onBack:_e}):Y?O.jsx(bF,{onBack:De}):U?O.jsx(wF,{onBack:Ie}):k?O.jsx(RF,{onBack:Ge,onNavigateToActivity:dt,onNavigateToProfileEdit:We,onNavigateToComingSoon:ze,onNavigateToSupport:ke,onLogout:de}):S==="connecting"?O.jsx(yF,{selectedCategory:w,onCancel:ue,onConnected:he}):S==="inCall"?O.jsx(TF,{selectedCategory:w,onEndCall:ye}):S==="evaluation"?O.jsx(CF,{selectedCategory:w,onCallAgain:Ve,onSelectInterests:Je,onGoHome:Ue}):O.jsx(ine,{onStartCall:Pe,onOpenSettings:xe,onOpenCallHistory:Xe}):null})}const pne=()=>{const u=D0();return ee.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",u.pathname)},[u.pathname]),O.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 safe-area-page",children:O.jsxs("div",{className:"text-center",children:[O.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),O.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),O.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};function fne({onLogin:u,onSignUp:h}){const[f,g]=ee.useState(""),[S,C]=ee.useState(""),[w,P]=ee.useState(!1),[k,M]=ee.useState(!1),U=async()=>{if(!f.trim()){alert(" .");return}if(!S.trim()){alert(" .");return}P(!0);try{const Y={email:f.trim(),password:S};await Q8(Y),u()}catch(Y){console.error(" :",Y);const H=Y instanceof Error?Y.message:"   .  .";alert(H)}finally{P(!1)}},B=async Y=>{try{await $8(Y)}catch(H){tt.error("   :",H),alert("  .  .")}};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center safe-area-page",children:[O.jsx("div",{className:"mt-4 md:mt-16 mb-8 md:mb-12",children:O.jsxs("svg",{width:"103",height:"32",viewBox:"0 0 103 32",fill:"none",children:[O.jsx("path",{d:"M77.7015 8.50968V5.22002H91.1165V8.50968H86.4656V10.9904C86.4656 12.1229 86.358 13.1206 86.143 14.0374C87.3527 15.6822 90.1218 18.2439 92.1111 19.2955L90.5519 22.666C88.7776 21.7492 86.3043 19.5921 84.7719 17.4619C84.4493 18.0012 84.0998 18.5135 83.7234 19.0528C82.7019 20.5089 80.4168 22.666 78.8844 23.448L76.6799 20.3471C77.5671 19.8887 79.0995 18.6753 80.1748 17.4619C81.8954 15.5474 82.5406 13.7408 82.5406 11.1252V8.50968H77.7015ZM93.6435 4.06055H97.5416V12.3386H101.117V16.0328H97.5416V27.223H93.6435V4.06055Z",fill:"black"}),O.jsx("path",{d:"M59.194 12.0688C63.0115 12.0688 65.7805 14.4956 65.7805 18.1358C65.7805 21.776 63.0115 24.1759 59.194 24.1759C55.3496 24.1759 52.6344 21.803 52.6344 18.1358C52.6344 14.4956 55.3496 12.0688 59.194 12.0688ZM68.3613 27.2229V4.06039H72.2595V12.5542H75.835V16.2483H72.2595V27.2229H68.3613ZM51.5859 7.40398H57.3659L56.9627 3.97949H61.6135L61.2103 7.40398H66.7752V10.6667H51.5859V7.40398ZM59.194 15.0889C57.4197 15.0889 56.2099 16.2214 56.2099 18.1358C56.2099 20.0773 57.4197 21.1559 59.194 21.1559C60.9683 21.1559 62.1781 20.0503 62.1781 18.1358C62.1781 16.2214 60.9683 15.0889 59.194 15.0889Z",fill:"black"}),O.jsx("path",{d:"M26.5189 16.491H41.1436C41.4393 15.2776 41.7351 13.3631 41.9233 11.4486C42.0308 10.3431 42.0846 8.99485 42.1114 7.75448H29.2611V4.41089H46.1709C46.1978 6.97251 46.1171 9.02181 45.902 11.152C45.6601 13.1474 45.1762 15.2506 44.7729 16.491H49.2894V19.8346H39.9339V28.2205H35.7669V19.8346H26.5189V16.491Z",fill:"black"}),O.jsx("path",{d:"M7.0167 3.35938H11.56L11.2643 6.13672H15.8614V9.39942H11.2374V10.0196C11.2374 10.6667 11.1299 11.2869 10.9417 11.8801C12.5816 13.0935 15.0011 14.253 16.3991 14.6575L15.4582 18.028C13.7107 17.6236 11.103 16.1405 9.38246 14.6036C9.05985 15.008 8.68348 15.3855 8.30711 15.763C6.88228 17.1382 4.78535 18.3786 3.0648 18.8639L1.80127 15.4664C2.82285 15.0889 4.3821 14.3609 5.43056 13.498C6.77474 12.3925 7.3393 11.3678 7.3393 10.0196V9.39942H2.47336V6.13672H7.28553L7.0167 3.35938ZM9.62441 19.565V24.5534H22.7974V27.9779H5.67251V19.565H9.62441ZM18.5767 4.06045H22.4748V20.8593H18.5767V4.06045Z",fill:"black"})]})}),O.jsxs("div",{className:"w-full max-w-sm md:max-w-md lg:max-w-lg xl:max-w-xl px-5 space-y-4 md:space-y-6",children:[O.jsx("div",{className:"relative",children:O.jsx("input",{type:"email",value:f,onChange:Y=>g(Y.target.value),placeholder:" .",className:"w-full h-12 md:h-14 px-4 border border-border-gray rounded-lg font-noto text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent",disabled:w})}),O.jsxs("div",{className:"relative",children:[O.jsx("input",{type:k?"text":"password",value:S,onChange:Y=>C(Y.target.value),placeholder:" .",className:"w-full h-12 md:h-14 px-4 pr-12 border border-border-gray rounded-lg font-noto text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent",disabled:w,onKeyPress:Y=>{Y.key==="Enter"&&!w&&U()}}),O.jsx("button",{type:"button",onClick:()=>M(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none",disabled:w,children:k?O.jsx(Bj,{className:"w-5 h-5 md:w-6 md:h-6"}):O.jsx(Wj,{className:"w-5 h-5 md:w-6 md:h-6"})})]}),O.jsx("div",{className:"pt-4",children:O.jsx("button",{onClick:U,disabled:w,className:`w-full h-14 md:h-16 bg-login-button text-white font-noto text-xl md:text-2xl font-bold rounded-lg hover:bg-opacity-90 transition-colors ${w?"opacity-50 cursor-not-allowed":""}`,children:w?" ...":""})}),O.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4",children:[O.jsx("button",{onClick:h,className:"text-text-gray font-pretendard text-lg md:text-xl underline hover:text-gray-600",children:""}),O.jsx("div",{className:"w-px h-4 bg-divider"}),O.jsx("button",{className:"text-text-gray font-pretendard text-lg md:text-xl underline hover:text-gray-600",children:" "})]}),O.jsxs("div",{className:"flex items-center justify-center pt-8 pb-4",children:[O.jsx("div",{className:"flex-1 h-px bg-border-gray"}),O.jsx("span",{className:"px-4 text-text-gray font-noto text-base md:text-lg",children:" "}),O.jsx("div",{className:"flex-1 h-px bg-border-gray"})]}),O.jsxs("div",{className:"space-y-3",children:[O.jsxs("button",{onClick:()=>B("kakao"),className:"w-full h-12 md:h-14 bg-kakao border border-border-gray rounded-lg flex items-center justify-center gap-2 hover:bg-opacity-90 transition-colors",children:[O.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4c65144d6cea6e4262f91c38a6a5875303193496?width=48",alt:"Kakao",className:"w-6 h-6"}),O.jsx("span",{className:"text-gray-800 font-noto text-base md:text-lg font-bold",children:" "})]}),O.jsxs("button",{onClick:()=>B("google"),className:"w-full h-12 md:h-14 bg-white border border-border-gray rounded-lg flex items-center justify-center gap-2 hover:bg-gray-50 transition-colors",children:[O.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[O.jsx("path",{d:"M11.9977 10.3621V13.8467H16.8402C16.6276 14.9674 15.9895 15.9163 15.0324 16.5543L17.9527 18.8202C19.6541 17.2497 20.6357 14.9429 20.6357 12.2026C20.6357 11.5646 20.5785 10.9511 20.4721 10.3622L11.9977 10.3621Z",fill:"#4285F4"}),O.jsx("path",{d:"M6.95517 13.7107L6.29655 14.2149L3.96521 16.0308C5.44578 18.9674 8.48034 20.9961 11.9977 20.9961C14.4271 20.9961 16.4639 20.1944 17.9527 18.8202L15.0324 16.5543C14.2308 17.0942 13.2083 17.4214 11.9977 17.4214C9.65824 17.4214 7.67056 15.8427 6.95885 13.7159L6.95517 13.7107Z",fill:"#34A853"}),O.jsx("path",{d:"M3.96517 7.96533C3.3517 9.17592 3 10.542 3 11.998C3 13.454 3.3517 14.8201 3.96517 16.0307C3.96517 16.0388 6.9591 13.7076 6.9591 13.7076C6.77914 13.1677 6.67277 12.5951 6.67277 11.9979C6.67277 11.4007 6.77914 10.8281 6.9591 10.2883L3.96517 7.96533Z",fill:"#FBBC05"}),O.jsx("path",{d:"M11.9979 6.58283C13.3231 6.58283 14.501 7.0409 15.4417 7.92435L18.0183 5.34769C16.4559 3.89167 14.4274 3 11.9979 3C8.48052 3 5.44578 5.02045 3.96521 7.96526L6.95905 10.2884C7.67066 8.16156 9.65842 6.58283 11.9979 6.58283Z",fill:"#EA4335"})]}),O.jsx("span",{className:"text-gray-800 font-noto text-base md:text-lg font-bold",children:" "})]})]})]})]})}function mne({onBack:u}){const h=Qd(),[f,g]=ee.useState(""),[S,C]=ee.useState(""),[w,P]=ee.useState(""),[k,M]=ee.useState(!1),[U,B]=ee.useState({}),[Y,H]=ee.useState(""),[ie,X]=ee.useState(!1),[te,ce]=ee.useState({hasMinLength:!1,hasMaxLength:!1,hasLetter:!1,hasNumber:!1,hasSpecialChar:!1}),Z=ue=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ue),le=ue=>{if(ue.length<8||ue.length>20)return!1;const he=/[a-zA-Z]/.test(ue),ye=/[0-9]/.test(ue),Ve=/[^a-zA-Z0-9]/.test(ue);return he&&ye&&Ve},ne=ue=>{ce({hasMinLength:ue.length>=8,hasMaxLength:ue.length<=20,hasLetter:/[a-zA-Z]/.test(ue),hasNumber:/[0-9]/.test(ue),hasSpecialChar:/[^a-zA-Z0-9]/.test(ue)})},de=()=>{const ue={};return f.trim()?Z(f)||(ue.email="   ."):ue.email=" .",S?le(S)||(ue.password=" 8-20, //  ."):ue.password=" .",w.trim()||(ue.realName="  ."),B(ue),Object.keys(ue).length===0},Pe=async()=>{if(de()){M(!0),B({}),H("");try{const ue={email:f.trim(),password:S,real_name:w.trim()};await J8(ue),h("/profile-setup",{replace:!0})}catch(ue){console.error(" :",ue);const he=ue instanceof Error?ue.message:"   .  .";H(he)}finally{M(!1)}}};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5 overflow-y-auto",children:[O.jsx("div",{className:"mb-8",children:O.jsxs("h2",{className:"text-black font-crimson text-2xl font-bold leading-8",children:["  ",O.jsx("br",{})," "]})}),O.jsxs("div",{className:"space-y-6",children:[O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:""}),O.jsx("div",{className:"relative",children:O.jsx("input",{type:"email",value:f,onChange:ue=>{g(ue.target.value),U.email&&B({...U,email:""})},placeholder:" ",className:`w-full h-14 px-4 border rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent ${U.email?"border-red-500":"border-gray-200"}`,disabled:k})}),U.email&&O.jsx("p",{className:"text-red-500 text-sm font-pretendard",children:U.email})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:""}),O.jsxs("div",{className:"relative",children:[O.jsx("input",{type:ie?"text":"password",value:S,onChange:ue=>{const he=ue.target.value;C(he),ne(he),U.password&&B({...U,password:""})},onBlur:()=>{S&&!le(S)&&B({...U,password:" 8-20, //  ."})},placeholder:"  ",className:`w-full h-14 px-4 pr-12 border rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent ${U.password?"border-red-500":"border-gray-200"}`,disabled:k}),O.jsx("button",{type:"button",onClick:()=>X(!ie),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none",disabled:k,children:ie?O.jsx(Bj,{className:"w-5 h-5"}):O.jsx(Wj,{className:"w-5 h-5"})})]}),U.password&&O.jsx("p",{className:"text-red-500 text-sm font-pretendard",children:U.password}),S&&O.jsxs("div",{className:"space-y-1 mt-2",children:[O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasMinLength?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasMinLength?"":""}),O.jsx("span",{children:"8 "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasMaxLength?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasMaxLength?"":""}),O.jsx("span",{children:"20 "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasLetter?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasLetter?"":""}),O.jsx("span",{children:" "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasNumber?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasNumber?"":""}),O.jsx("span",{children:" "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasSpecialChar?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasSpecialChar?"":""}),O.jsx("span",{children:" "})]})]}),!S&&O.jsx("p",{className:"text-gray-500 text-sm font-pretendard",children:"8-20, // "})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:" "}),O.jsx("div",{className:"relative",children:O.jsx("input",{type:"text",value:w,onChange:ue=>{P(ue.target.value),U.realName&&B({...U,realName:""})},placeholder:"  ",className:`w-full h-14 px-4 border rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent ${U.realName?"border-red-500":"border-gray-200"}`,disabled:k})}),U.realName&&O.jsx("p",{className:"text-red-500 text-sm font-pretendard",children:U.realName})]})]})]}),Y&&O.jsx("div",{className:"px-5 pb-4",children:O.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:O.jsx("p",{className:"text-red-600 text-sm font-pretendard",children:Y})})}),O.jsx("div",{className:"px-5 pb-8",children:O.jsx("button",{onClick:Pe,disabled:k,className:`w-full h-14 bg-orange-500 text-white font-crimson text-xl font-bold rounded-lg transition-colors ${k?"opacity-50 cursor-not-allowed":"hover:bg-orange-600"}`,children:k?" ...":""})})]})}function _ne(){const[u,h]=ee.useState("loading"),[f,g]=ee.useState(""),[S,C]=ee.useState(null),w=Qd(),P=ee.useRef(!1);return ee.useEffect(()=>{if(P.current){console.log(" OAuth    .   .");return}return P.current=!0,console.log(" OAuth   "),(async()=>{try{const M=await eF();M?(console.log(" OAuth   "),h("success"),C(M.data.user_info),M.data.user_info.is_new_user||!M.data.user_info.is_profile_complete?setTimeout(()=>{w("/profile-setup")},2e3):setTimeout(()=>{w("/")},2e3)):(console.log(" OAuth   ,  "),w("/"))}catch(M){console.error(" OAuth   :",M),h("error"),g(M instanceof Error?M.message:"    ."),setTimeout(()=>{w("/login")},3e3)}})(),()=>{console.log(" OAuth   cleanup")}},[]),u==="loading"?O.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button mx-auto mb-4"}),O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:"  ..."}),O.jsx("p",{className:"text-gray-600",children:" ."})]})}):u==="success"?O.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:" !"}),O.jsx("p",{className:"text-gray-600 mb-4",children:"!  ."}),O.jsx("p",{className:"text-sm text-gray-500",children:S?.is_new_user||!S?.is_profile_complete?"   ...":"  ..."})]})}):u==="error"?O.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:" "}),O.jsx("p",{className:"text-gray-600 mb-4",children:f}),O.jsx("p",{className:"text-sm text-gray-500",children:"  ..."})]})}):null}function gne(){const[u,h]=ee.useState(null),[f,g]=ee.useState(""),[S,C]=ee.useState(""),[w,P]=ee.useState(""),[k,M]=ee.useState(""),[U,B]=ee.useState(""),[Y,H]=ee.useState(!1),[ie,X]=ee.useState(!1),[te,ce]=ee.useState(!1),[Z,le]=ee.useState(!1),ne=Qd(),de=()=>{X(!0),setTimeout(()=>{ne("/",{replace:!0})},2e3)},Pe=()=>{if(!u)return;const ye={id:u.id,is_profile_complete:!0,is_new_user:!1};localStorage.setItem("user_info",JSON.stringify(ye))};ee.useEffect(()=>{(async()=>{try{const Ve=DE(),Ue=(await YA()).data;h(Ue),g(Ue.nickname||"");const xe=Ue.is_new_user??Ve?.is_new_user??!1;if(!xe&&(Ue.gender&&C(Ue.gender),Ue.birth)){const[Ge,dt,Xe]=Ue.birth.split("-");P(Ge),M(dt),B(Xe)}xe&&ce(!0)}catch(Ve){if(console.error("   :",Ve),Ve instanceof Error&&Ve.message.includes(" ")){alert(" .  ."),ne("/login");return}const Je=DE();if(!Je){ne("/login");return}const Ue={id:Je.id,email:"",nickname:"",is_new_user:Je.is_new_user,is_profile_complete:Je.is_profile_complete};h(Ue),g(""),Ue.is_new_user&&ce(!0)}})()},[ne]);const ue=()=>{le(!0),ce(!1)},he=async()=>{if(!f.trim()){alert(" .");return}if(!S){alert(" .");return}if(!w||!k||!U){alert("  .");return}const ye=parseInt(w),Ve=parseInt(k),Je=parseInt(U),Ue=new Date().getFullYear();if(ye<1900||ye>Ue){alert("  .");return}if(Ve<1||Ve>12){alert("  .");return}if(Je<1||Je>31){alert("  .");return}const xe=`${w}-${k.padStart(2,"0")}-${U.padStart(2,"0")}`,Ge=u&&f!==u.nickname,dt=u&&S!==u.gender,Xe=u&&xe!==u.birth,We={};if(Ge&&(We.nickname=f),dt&&(We.gender=S),Xe&&(We.birth=xe),Object.keys(We).length===0){Pe(),de();return}H(!0);try{await iF(We),Pe(),de()}catch(Ie){if(console.error("  :",Ie),Ie instanceof Error&&Ie.message.includes(" ")){alert(" .  ."),ne("/login");return}alert("  .  .")}finally{H(!1)}};return u?O.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center relative safe-area-page","aria-busy":ie,children:[te&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4",role:"dialog","aria-modal":"true","aria-labelledby":"consent-title",children:O.jsxs("div",{className:"bg-white rounded-2xl p-6 md:p-8 max-w-md w-full max-h-[80vh] overflow-y-auto",children:[O.jsx("h2",{id:"consent-title",className:"text-xl md:text-2xl font-crimson font-bold text-gray-900 mb-4",children:"    "}),O.jsxs("div",{className:"space-y-4 mb-6 text-gray-700",children:[O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"1.   "}),O.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[O.jsx("li",{children:" : , , , "}),O.jsx("li",{children:" :   ,  "})]})]}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"2.     "}),O.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[O.jsx("li",{children:"    "}),O.jsx("li",{children:"    "}),O.jsx("li",{children:"   "}),O.jsx("li",{children:"  "})]})]}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"3.     "}),O.jsx("p",{className:"text-sm",children:"   ,    . ,          ."})]})]}),O.jsx("div",{className:"pt-2",children:O.jsx("button",{onClick:ue,className:"w-full h-14 bg-login-button text-white font-crimson text-lg font-bold rounded-lg hover:bg-opacity-90 transition-colors",children:""})})]})}),ie&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"profile-save-title","aria-describedby":"profile-save-desc",children:O.jsxs("div",{className:"bg-white rounded-lg p-6 mx-4 text-center",children:[O.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),O.jsx("h3",{id:"profile-save-title",className:"text-lg font-semibold text-gray-900 mb-2",children:" !"}),O.jsx("p",{id:"profile-save-desc",className:"text-gray-600",children:"    ..."})]})}),O.jsx("div",{className:"w-full max-w-sm md:max-w-md px-5 pt-4 pb-6",children:O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsx("button",{onClick:()=>{u.is_new_user?ne("/"):ne("/settings")},className:"p-2 -ml-2",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-lg font-crimson font-bold text-gray-900",children:" "}),O.jsx("div",{className:"w-10"})]})}),O.jsxs("div",{className:"w-full max-w-sm md:max-w-md px-5 space-y-6",children:[O.jsxs("div",{className:"text-center py-4",children:[O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:u.is_new_user?"!":" "}),O.jsx("p",{className:"text-gray-600",children:u.is_new_user?"    .":"  ."})]}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),O.jsx("p",{className:"text-gray-900",children:u.email})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),O.jsx("input",{type:"text",value:f,onChange:ye=>g(ye.target.value),placeholder:" ",disabled:u?.is_new_user&&!Z,className:"w-full h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),O.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[O.jsx("button",{type:"button",onClick:()=>C("MALE"),disabled:u?.is_new_user&&!Z,className:`h-12 md:h-14 px-4 border rounded-lg font-crimson text-lg md:text-xl transition-all ${S==="MALE"?"border-login-button bg-login-button/10 text-login-button":"border-border-gray text-gray-700 hover:border-login-button/50"} disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50`,children:""}),O.jsx("button",{type:"button",onClick:()=>C("FEMALE"),disabled:u?.is_new_user&&!Z,className:`h-12 md:h-14 px-4 border rounded-lg font-crimson text-lg md:text-xl transition-all ${S==="FEMALE"?"border-login-button bg-login-button/10 text-login-button":"border-border-gray text-gray-700 hover:border-login-button/50"} disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50`,children:""})]})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),O.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[O.jsx("input",{type:"number",value:w,onChange:ye=>P(ye.target.value),placeholder:"(4)",min:"1900",max:new Date().getFullYear(),disabled:u?.is_new_user&&!Z,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"}),O.jsx("input",{type:"number",value:k,onChange:ye=>M(ye.target.value),placeholder:"",min:"1",max:"12",disabled:u?.is_new_user&&!Z,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"}),O.jsx("input",{type:"number",value:U,onChange:ye=>B(ye.target.value),placeholder:"",min:"1",max:"31",disabled:u?.is_new_user&&!Z,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]}),O.jsx("div",{className:"pt-4",children:O.jsx("button",{onClick:he,disabled:Y||!f.trim()||!S||!w||!k||!U||ie,className:"w-full h-14 md:h-16 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl md:text-2xl font-bold rounded-lg hover:opacity-90 transition-opacity disabled:bg-gray-300 disabled:bg-none disabled:cursor-not-allowed",children:Y?" ...":" "})})]})]}):O.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center safe-area-page",children:O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button"})})}function Cl({children:u,requireProfileComplete:h=!1}){const[f,g]=ee.useState(!0),[S,C]=ee.useState(null),w=Qd();return ee.useEffect(()=>{(()=>{try{const k=zA(),M=DE();if(!k||!M){w("/login");return}if(C(M),h&&(!M.is_profile_complete||M.is_new_user)){w("/profile-setup");return}g(!1)}catch(k){console.error("  :",k),w("/login")}})()},[w,h]),f?O.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600",children:"  ..."})]})}):O.jsx(O.Fragment,{children:u})}const Ene=new K$,vne=()=>{const u=Qd(),{categoryId:h,cancelMatching:f,resetMatching:g,status:S,matchingId:C}=QA(),w=ee.useRef(null),[P,k]=ee.useState(!1);ee.useEffect(()=>{(async()=>{await sF(),k(!0)})()},[]),ee.useEffect(()=>{const he=w.current;he!==null&&he!==S&&(S==="matched"&&C?u("/call-connected"):(S==="cancelled"||S==="timeout")&&u("/")),w.current=S},[S,C,u]);const M=he=>{if(!he)return null;const ye=Object.values(_0).find(Ve=>Ve.id===he);return ye?ye.name:null},U=async()=>{try{await f()}catch(he){console.error("  :",he)}finally{u("/")}},B=()=>{u("/call-connected")},Y=()=>{u("/call-evaluation")},H=()=>{u("/")},ie=()=>{u("/")},X=()=>{u("/")},te=()=>{u("/my-activity")},ce=()=>{u("/signup")},Z=()=>{u("/login")},le=()=>{u("/profile-setup")},ne=he=>{u(`/coming-soon?feature=${encodeURIComponent(he)}`)},de=()=>{u("/support")},Pe=async()=>{u("/login")},ue=()=>{u("/")};return P?O.jsx("div",{className:"w-full min-h-screen max-w-md mx-auto bg-white relative overflow-x-hidden",children:O.jsxs(jee,{children:[O.jsx(cs,{path:"/",element:O.jsx(hne,{})}),O.jsx(cs,{path:"/login",element:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(fne,{onLogin:ue,onSignUp:ce})})}),O.jsx(cs,{path:"/signup",element:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(mne,{onBack:Z})})}),O.jsx(cs,{path:"/oauth/callback",element:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(_ne,{})})}),O.jsx(cs,{path:"/profile-setup",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(gne,{})})})}),O.jsx(cs,{path:"/connecting-call",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(yF,{selectedCategory:M(h),onCancel:U,onConnected:B})})})}),O.jsx(cs,{path:"/call-connected",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(TF,{selectedCategory:M(h),onEndCall:Y})})})}),O.jsx(cs,{path:"/call-evaluation",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(CF,{selectedCategory:M(h),onCallAgain:H,onSelectInterests:ie,onGoHome:ue})})})}),O.jsx(cs,{path:"/my-activity",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(wF,{onBack:X})})})}),O.jsx(cs,{path:"/call-history",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(bF,{onBack:X})})})}),O.jsx(cs,{path:"/settings",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(RF,{onBack:X,onNavigateToActivity:te,onNavigateToProfileEdit:le,onNavigateToComingSoon:ne,onNavigateToSupport:de,onLogout:Pe})})})}),O.jsx(cs,{path:"/coming-soon",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(IF,{})})})}),O.jsx(cs,{path:"/support",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(AF,{onBack:X})})})}),O.jsx(cs,{path:"*",element:O.jsx(pne,{})})]})}):O.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600",children:" ..."})]})})},Sne=()=>O.jsx(Y$,{client:Ene,children:O.jsxs(y$,{children:[O.jsx(nQ,{}),O.jsx(MQ,{}),O.jsx(Wee,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:O.jsx(vne,{})})]})});iQ.createRoot(document.getElementById("root")).render(O.jsx(Sne,{}));
