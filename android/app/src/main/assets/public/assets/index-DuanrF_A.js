function tX(u,h){for(var f=0;f<h.length;f++){const g=h[f];if(typeof g!="string"&&!Array.isArray(g)){for(const S in g)if(S!=="default"&&!(S in u)){const C=Object.getOwnPropertyDescriptor(g,S);C&&Object.defineProperty(u,S,C.get?C:{enumerable:!0,get:()=>g[S]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))g(S);new MutationObserver(S=>{for(const C of S)if(C.type==="childList")for(const I of C.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&g(I)}).observe(document,{childList:!0,subtree:!0});function f(S){const C={};return S.integrity&&(C.integrity=S.integrity),S.referrerPolicy&&(C.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?C.credentials="include":S.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function g(S){if(S.ep)return;S.ep=!0;const C=f(S);fetch(S.href,C)}})();function g0(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var FI={exports:{}},gE={},BI={exports:{}},En={},Q6;function nX(){if(Q6)return En;Q6=1;/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u=Symbol.for("react.element"),h=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),I=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),M=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),B=Symbol.iterator;function q(me){return me===null||typeof me!="object"?null:(me=B&&me[B]||me["@@iterator"],typeof me=="function"?me:null)}var K={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,X={};function te(me,ke,at){this.props=me,this.context=ke,this.refs=X,this.updater=at||K}te.prototype.isReactComponent={},te.prototype.setState=function(me,ke){if(typeof me!="object"&&typeof me!="function"&&me!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,me,ke,"setState")},te.prototype.forceUpdate=function(me){this.updater.enqueueForceUpdate(this,me,"forceUpdate")};function ce(){}ce.prototype=te.prototype;function $(me,ke,at){this.props=me,this.context=ke,this.refs=X,this.updater=at||K}var le=$.prototype=new ce;le.constructor=$,ie(le,te.prototype),le.isPureReactComponent=!0;var ne=Array.isArray,de=Object.prototype.hasOwnProperty,be={current:null},Se={key:!0,ref:!0,__self:!0,__source:!0};function fe(me,ke,at){var ot,Ot={},Gt=null,yt=null;if(ke!=null)for(ot in ke.ref!==void 0&&(yt=ke.ref),ke.key!==void 0&&(Gt=""+ke.key),ke)de.call(ke,ot)&&!Se.hasOwnProperty(ot)&&(Ot[ot]=ke[ot]);var pn=arguments.length-2;if(pn===1)Ot.children=at;else if(1<pn){for(var vn=Array(pn),or=0;or<pn;or++)vn[or]=arguments[or+2];Ot.children=vn}if(me&&me.defaultProps)for(ot in pn=me.defaultProps,pn)Ot[ot]===void 0&&(Ot[ot]=pn[ot]);return{$$typeof:u,type:me,key:Gt,ref:yt,props:Ot,_owner:be.current}}function ye(me,ke){return{$$typeof:u,type:me.type,key:ke,ref:me.ref,props:me.props,_owner:me._owner}}function je(me){return typeof me=="object"&&me!==null&&me.$$typeof===u}function Je(me){var ke={"=":"=0",":":"=2"};return"$"+me.replace(/[=:]/g,function(at){return ke[at]})}var Ue=/\/+/g;function xe(me,ke){return typeof me=="object"&&me!==null&&me.key!=null?Je(""+me.key):ke.toString(36)}function Ge(me,ke,at,ot,Ot){var Gt=typeof me;(Gt==="undefined"||Gt==="boolean")&&(me=null);var yt=!1;if(me===null)yt=!0;else switch(Gt){case"string":case"number":yt=!0;break;case"object":switch(me.$$typeof){case u:case h:yt=!0}}if(yt)return yt=me,Ot=Ot(yt),me=ot===""?"."+xe(yt,0):ot,ne(Ot)?(at="",me!=null&&(at=me.replace(Ue,"$&/")+"/"),Ge(Ot,ke,at,"",function(or){return or})):Ot!=null&&(je(Ot)&&(Ot=ye(Ot,at+(!Ot.key||yt&&yt.key===Ot.key?"":(""+Ot.key).replace(Ue,"$&/")+"/")+me)),ke.push(Ot)),1;if(yt=0,ot=ot===""?".":ot+":",ne(me))for(var pn=0;pn<me.length;pn++){Gt=me[pn];var vn=ot+xe(Gt,pn);yt+=Ge(Gt,ke,at,vn,Ot)}else if(vn=q(me),typeof vn=="function")for(me=vn.call(me),pn=0;!(Gt=me.next()).done;)Gt=Gt.value,vn=ot+xe(Gt,pn++),yt+=Ge(Gt,ke,at,vn,Ot);else if(Gt==="object")throw ke=String(me),Error("Objects are not valid as a React child (found: "+(ke==="[object Object]"?"object with keys {"+Object.keys(me).join(", ")+"}":ke)+"). If you meant to render a collection of children, use an array instead.");return yt}function dt(me,ke,at){if(me==null)return me;var ot=[],Ot=0;return Ge(me,ot,"","",function(Gt){return ke.call(at,Gt,Ot++)}),ot}function Xe(me){if(me._status===-1){var ke=me._result;ke=ke(),ke.then(function(at){(me._status===0||me._status===-1)&&(me._status=1,me._result=at)},function(at){(me._status===0||me._status===-1)&&(me._status=2,me._result=at)}),me._status===-1&&(me._status=0,me._result=ke)}if(me._status===1)return me._result.default;throw me._result}var We={current:null},Ae={transition:null},De={ReactCurrentDispatcher:We,ReactCurrentBatchConfig:Ae,ReactCurrentOwner:be};function ze(){throw Error("act(...) is not supported in production builds of React.")}return En.Children={map:dt,forEach:function(me,ke,at){dt(me,function(){ke.apply(this,arguments)},at)},count:function(me){var ke=0;return dt(me,function(){ke++}),ke},toArray:function(me){return dt(me,function(ke){return ke})||[]},only:function(me){if(!je(me))throw Error("React.Children.only expected to receive a single React element child.");return me}},En.Component=te,En.Fragment=f,En.Profiler=S,En.PureComponent=$,En.StrictMode=g,En.Suspense=k,En.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=De,En.act=ze,En.cloneElement=function(me,ke,at){if(me==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+me+".");var ot=ie({},me.props),Ot=me.key,Gt=me.ref,yt=me._owner;if(ke!=null){if(ke.ref!==void 0&&(Gt=ke.ref,yt=be.current),ke.key!==void 0&&(Ot=""+ke.key),me.type&&me.type.defaultProps)var pn=me.type.defaultProps;for(vn in ke)de.call(ke,vn)&&!Se.hasOwnProperty(vn)&&(ot[vn]=ke[vn]===void 0&&pn!==void 0?pn[vn]:ke[vn])}var vn=arguments.length-2;if(vn===1)ot.children=at;else if(1<vn){pn=Array(vn);for(var or=0;or<vn;or++)pn[or]=arguments[or+2];ot.children=pn}return{$$typeof:u,type:me.type,key:Ot,ref:Gt,props:ot,_owner:yt}},En.createContext=function(me){return me={$$typeof:I,_currentValue:me,_currentValue2:me,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},me.Provider={$$typeof:C,_context:me},me.Consumer=me},En.createElement=fe,En.createFactory=function(me){var ke=fe.bind(null,me);return ke.type=me,ke},En.createRef=function(){return{current:null}},En.forwardRef=function(me){return{$$typeof:N,render:me}},En.isValidElement=je,En.lazy=function(me){return{$$typeof:F,_payload:{_status:-1,_result:me},_init:Xe}},En.memo=function(me,ke){return{$$typeof:M,type:me,compare:ke===void 0?null:ke}},En.startTransition=function(me){var ke=Ae.transition;Ae.transition={};try{me()}finally{Ae.transition=ke}},En.unstable_act=ze,En.useCallback=function(me,ke){return We.current.useCallback(me,ke)},En.useContext=function(me){return We.current.useContext(me)},En.useDebugValue=function(){},En.useDeferredValue=function(me){return We.current.useDeferredValue(me)},En.useEffect=function(me,ke){return We.current.useEffect(me,ke)},En.useId=function(){return We.current.useId()},En.useImperativeHandle=function(me,ke,at){return We.current.useImperativeHandle(me,ke,at)},En.useInsertionEffect=function(me,ke){return We.current.useInsertionEffect(me,ke)},En.useLayoutEffect=function(me,ke){return We.current.useLayoutEffect(me,ke)},En.useMemo=function(me,ke){return We.current.useMemo(me,ke)},En.useReducer=function(me,ke,at){return We.current.useReducer(me,ke,at)},En.useRef=function(me){return We.current.useRef(me)},En.useState=function(me){return We.current.useState(me)},En.useSyncExternalStore=function(me,ke,at){return We.current.useSyncExternalStore(me,ke,at)},En.useTransition=function(){return We.current.useTransition()},En.version="18.3.1",En}var Z6;function T1(){return Z6||(Z6=1,BI.exports=nX()),BI.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $6;function rX(){if($6)return gE;$6=1;var u=T1(),h=Symbol.for("react.element"),f=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,S=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C={key:!0,ref:!0,__self:!0,__source:!0};function I(N,k,M){var F,B={},q=null,K=null;M!==void 0&&(q=""+M),k.key!==void 0&&(q=""+k.key),k.ref!==void 0&&(K=k.ref);for(F in k)g.call(k,F)&&!C.hasOwnProperty(F)&&(B[F]=k[F]);if(N&&N.defaultProps)for(F in k=N.defaultProps,k)B[F]===void 0&&(B[F]=k[F]);return{$$typeof:h,type:N,key:q,ref:K,props:B,_owner:S.current}}return gE.Fragment=f,gE.jsx=I,gE.jsxs=I,gE}var e4;function iX(){return e4||(e4=1,FI.exports=rX()),FI.exports}var P=iX(),ee=T1();const it=g0(ee),aj=tX({__proto__:null,default:it},[ee]),sX=1,oX=1e6;let WI=0;function aX(){return WI=(WI+1)%Number.MAX_SAFE_INTEGER,WI.toString()}const GI=new Map,t4=u=>{if(GI.has(u))return;const h=setTimeout(()=>{GI.delete(u),RE({type:"REMOVE_TOAST",toastId:u})},oX);GI.set(u,h)},cX=(u,h)=>{switch(h.type){case"ADD_TOAST":return{...u,toasts:[h.toast,...u.toasts].slice(0,sX)};case"UPDATE_TOAST":return{...u,toasts:u.toasts.map(f=>f.id===h.toast.id?{...f,...h.toast}:f)};case"DISMISS_TOAST":{const{toastId:f}=h;return f?t4(f):u.toasts.forEach(g=>{t4(g.id)}),{...u,toasts:u.toasts.map(g=>g.id===f||f===void 0?{...g,open:!1}:g)}}case"REMOVE_TOAST":return h.toastId===void 0?{...u,toasts:[]}:{...u,toasts:u.toasts.filter(f=>f.id!==h.toastId)}}},o0=[];let a0={toasts:[]};function RE(u){a0=cX(a0,u),o0.forEach(h=>{h(a0)})}function lX({...u}){const h=aX(),f=S=>RE({type:"UPDATE_TOAST",toast:{...S,id:h}}),g=()=>RE({type:"DISMISS_TOAST",toastId:h});return RE({type:"ADD_TOAST",toast:{...u,id:h,open:!0,onOpenChange:S=>{S||g()}}}),{id:h,dismiss:g,update:f}}function dX(){const[u,h]=ee.useState(a0);return ee.useEffect(()=>(o0.push(h),()=>{const f=o0.indexOf(h);f>-1&&o0.splice(f,1)}),[u]),{...u,toast:lX,dismiss:f=>RE({type:"DISMISS_TOAST",toastId:f})}}var HI={exports:{}},ks={},KI={exports:{}},zI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n4;function uX(){return n4||(n4=1,function(u){function h(Ae,De){var ze=Ae.length;Ae.push(De);e:for(;0<ze;){var me=ze-1>>>1,ke=Ae[me];if(0<S(ke,De))Ae[me]=De,Ae[ze]=ke,ze=me;else break e}}function f(Ae){return Ae.length===0?null:Ae[0]}function g(Ae){if(Ae.length===0)return null;var De=Ae[0],ze=Ae.pop();if(ze!==De){Ae[0]=ze;e:for(var me=0,ke=Ae.length,at=ke>>>1;me<at;){var ot=2*(me+1)-1,Ot=Ae[ot],Gt=ot+1,yt=Ae[Gt];if(0>S(Ot,ze))Gt<ke&&0>S(yt,Ot)?(Ae[me]=yt,Ae[Gt]=ze,me=Gt):(Ae[me]=Ot,Ae[ot]=ze,me=ot);else if(Gt<ke&&0>S(yt,ze))Ae[me]=yt,Ae[Gt]=ze,me=Gt;else break e}}return De}function S(Ae,De){var ze=Ae.sortIndex-De.sortIndex;return ze!==0?ze:Ae.id-De.id}if(typeof performance=="object"&&typeof performance.now=="function"){var C=performance;u.unstable_now=function(){return C.now()}}else{var I=Date,N=I.now();u.unstable_now=function(){return I.now()-N}}var k=[],M=[],F=1,B=null,q=3,K=!1,ie=!1,X=!1,te=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(Ae){for(var De=f(M);De!==null;){if(De.callback===null)g(M);else if(De.startTime<=Ae)g(M),De.sortIndex=De.expirationTime,h(k,De);else break;De=f(M)}}function ne(Ae){if(X=!1,le(Ae),!ie)if(f(k)!==null)ie=!0,Xe(de);else{var De=f(M);De!==null&&We(ne,De.startTime-Ae)}}function de(Ae,De){ie=!1,X&&(X=!1,ce(fe),fe=-1),K=!0;var ze=q;try{for(le(De),B=f(k);B!==null&&(!(B.expirationTime>De)||Ae&&!Je());){var me=B.callback;if(typeof me=="function"){B.callback=null,q=B.priorityLevel;var ke=me(B.expirationTime<=De);De=u.unstable_now(),typeof ke=="function"?B.callback=ke:B===f(k)&&g(k),le(De)}else g(k);B=f(k)}if(B!==null)var at=!0;else{var ot=f(M);ot!==null&&We(ne,ot.startTime-De),at=!1}return at}finally{B=null,q=ze,K=!1}}var be=!1,Se=null,fe=-1,ye=5,je=-1;function Je(){return!(u.unstable_now()-je<ye)}function Ue(){if(Se!==null){var Ae=u.unstable_now();je=Ae;var De=!0;try{De=Se(!0,Ae)}finally{De?xe():(be=!1,Se=null)}}else be=!1}var xe;if(typeof $=="function")xe=function(){$(Ue)};else if(typeof MessageChannel<"u"){var Ge=new MessageChannel,dt=Ge.port2;Ge.port1.onmessage=Ue,xe=function(){dt.postMessage(null)}}else xe=function(){te(Ue,0)};function Xe(Ae){Se=Ae,be||(be=!0,xe())}function We(Ae,De){fe=te(function(){Ae(u.unstable_now())},De)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Ae){Ae.callback=null},u.unstable_continueExecution=function(){ie||K||(ie=!0,Xe(de))},u.unstable_forceFrameRate=function(Ae){0>Ae||125<Ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ye=0<Ae?Math.floor(1e3/Ae):5},u.unstable_getCurrentPriorityLevel=function(){return q},u.unstable_getFirstCallbackNode=function(){return f(k)},u.unstable_next=function(Ae){switch(q){case 1:case 2:case 3:var De=3;break;default:De=q}var ze=q;q=De;try{return Ae()}finally{q=ze}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(Ae,De){switch(Ae){case 1:case 2:case 3:case 4:case 5:break;default:Ae=3}var ze=q;q=Ae;try{return De()}finally{q=ze}},u.unstable_scheduleCallback=function(Ae,De,ze){var me=u.unstable_now();switch(typeof ze=="object"&&ze!==null?(ze=ze.delay,ze=typeof ze=="number"&&0<ze?me+ze:me):ze=me,Ae){case 1:var ke=-1;break;case 2:ke=250;break;case 5:ke=1073741823;break;case 4:ke=1e4;break;default:ke=5e3}return ke=ze+ke,Ae={id:F++,callback:De,priorityLevel:Ae,startTime:ze,expirationTime:ke,sortIndex:-1},ze>me?(Ae.sortIndex=ze,h(M,Ae),f(k)===null&&Ae===f(M)&&(X?(ce(fe),fe=-1):X=!0,We(ne,ze-me))):(Ae.sortIndex=ke,h(k,Ae),ie||K||(ie=!0,Xe(de))),Ae},u.unstable_shouldYield=Je,u.unstable_wrapCallback=function(Ae){var De=q;return function(){var ze=q;q=De;try{return Ae.apply(this,arguments)}finally{q=ze}}}}(zI)),zI}var r4;function hX(){return r4||(r4=1,KI.exports=uX()),KI.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i4;function pX(){if(i4)return ks;i4=1;var u=T1(),h=hX();function f(a){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+a,_=1;_<arguments.length;_++)d+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+a+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g=new Set,S={};function C(a,d){I(a,d),I(a+"Capture",d)}function I(a,d){for(S[a]=d,a=0;a<d.length;a++)g.add(d[a])}var N=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),k=Object.prototype.hasOwnProperty,M=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,F={},B={};function q(a){return k.call(B,a)?!0:k.call(F,a)?!1:M.test(a)?B[a]=!0:(F[a]=!0,!1)}function K(a,d,_,T){if(_!==null&&_.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return T?!1:_!==null?!_.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function ie(a,d,_,T){if(d===null||typeof d>"u"||K(a,d,_,T))return!0;if(T)return!1;if(_!==null)switch(_.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function X(a,d,_,T,b,L,Y){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=T,this.attributeNamespace=b,this.mustUseProperty=_,this.propertyName=a,this.type=d,this.sanitizeURL=L,this.removeEmptyString=Y}var te={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){te[a]=new X(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var d=a[0];te[d]=new X(d,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){te[a]=new X(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){te[a]=new X(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){te[a]=new X(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){te[a]=new X(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){te[a]=new X(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){te[a]=new X(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){te[a]=new X(a,5,!1,a.toLowerCase(),null,!1,!1)});var ce=/[\-:]([a-z])/g;function $(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var d=a.replace(ce,$);te[d]=new X(d,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var d=a.replace(ce,$);te[d]=new X(d,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var d=a.replace(ce,$);te[d]=new X(d,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){te[a]=new X(a,1,!1,a.toLowerCase(),null,!1,!1)}),te.xlinkHref=new X("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){te[a]=new X(a,1,!1,a.toLowerCase(),null,!0,!0)});function le(a,d,_,T){var b=te.hasOwnProperty(d)?te[d]:null;(b!==null?b.type!==0:T||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(ie(d,_,b,T)&&(_=null),T||b===null?q(d)&&(_===null?a.removeAttribute(d):a.setAttribute(d,""+_)):b.mustUseProperty?a[b.propertyName]=_===null?b.type===3?!1:"":_:(d=b.attributeName,T=b.attributeNamespace,_===null?a.removeAttribute(d):(b=b.type,_=b===3||b===4&&_===!0?"":""+_,T?a.setAttributeNS(T,d,_):a.setAttribute(d,_))))}var ne=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,de=Symbol.for("react.element"),be=Symbol.for("react.portal"),Se=Symbol.for("react.fragment"),fe=Symbol.for("react.strict_mode"),ye=Symbol.for("react.profiler"),je=Symbol.for("react.provider"),Je=Symbol.for("react.context"),Ue=Symbol.for("react.forward_ref"),xe=Symbol.for("react.suspense"),Ge=Symbol.for("react.suspense_list"),dt=Symbol.for("react.memo"),Xe=Symbol.for("react.lazy"),We=Symbol.for("react.offscreen"),Ae=Symbol.iterator;function De(a){return a===null||typeof a!="object"?null:(a=Ae&&a[Ae]||a["@@iterator"],typeof a=="function"?a:null)}var ze=Object.assign,me;function ke(a){if(me===void 0)try{throw Error()}catch(_){var d=_.stack.trim().match(/\n( *(at )?)/);me=d&&d[1]||""}return`
`+me+a}var at=!1;function ot(a,d){if(!a||at)return"";at=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(Le){var T=Le}Reflect.construct(a,[],d)}else{try{d.call()}catch(Le){T=Le}a.call(d.prototype)}else{try{throw Error()}catch(Le){T=Le}a()}}catch(Le){if(Le&&T&&typeof Le.stack=="string"){for(var b=Le.stack.split(`
`),L=T.stack.split(`
`),Y=b.length-1,oe=L.length-1;1<=Y&&0<=oe&&b[Y]!==L[oe];)oe--;for(;1<=Y&&0<=oe;Y--,oe--)if(b[Y]!==L[oe]){if(Y!==1||oe!==1)do if(Y--,oe--,0>oe||b[Y]!==L[oe]){var pe=`
`+b[Y].replace(" at new "," at ");return a.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",a.displayName)),pe}while(1<=Y&&0<=oe);break}}}finally{at=!1,Error.prepareStackTrace=_}return(a=a?a.displayName||a.name:"")?ke(a):""}function Ot(a){switch(a.tag){case 5:return ke(a.type);case 16:return ke("Lazy");case 13:return ke("Suspense");case 19:return ke("SuspenseList");case 0:case 2:case 15:return a=ot(a.type,!1),a;case 11:return a=ot(a.type.render,!1),a;case 1:return a=ot(a.type,!0),a;default:return""}}function Gt(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case Se:return"Fragment";case be:return"Portal";case ye:return"Profiler";case fe:return"StrictMode";case xe:return"Suspense";case Ge:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case Je:return(a.displayName||"Context")+".Consumer";case je:return(a._context.displayName||"Context")+".Provider";case Ue:var d=a.render;return a=a.displayName,a||(a=d.displayName||d.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case dt:return d=a.displayName||null,d!==null?d:Gt(a.type)||"Memo";case Xe:d=a._payload,a=a._init;try{return Gt(a(d))}catch{}}return null}function yt(a){var d=a.type;switch(a.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=d.render,a=a.displayName||a.name||"",d.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gt(d);case 8:return d===fe?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function pn(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function vn(a){var d=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function or(a){var d=vn(a)?"checked":"value",_=Object.getOwnPropertyDescriptor(a.constructor.prototype,d),T=""+a[d];if(!a.hasOwnProperty(d)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var b=_.get,L=_.set;return Object.defineProperty(a,d,{configurable:!0,get:function(){return b.call(this)},set:function(Y){T=""+Y,L.call(this,Y)}}),Object.defineProperty(a,d,{enumerable:_.enumerable}),{getValue:function(){return T},setValue:function(Y){T=""+Y},stopTracking:function(){a._valueTracker=null,delete a[d]}}}}function hs(a){a._valueTracker||(a._valueTracker=or(a))}function Ma(a){if(!a)return!1;var d=a._valueTracker;if(!d)return!0;var _=d.getValue(),T="";return a&&(T=vn(a)?a.checked?"true":"false":a.value),a=T,a!==_?(d.setValue(a),!0):!1}function Kr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Zd(a,d){var _=d.checked;return ze({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??a._wrapperState.initialChecked})}function Fh(a,d){var _=d.defaultValue==null?"":d.defaultValue,T=d.checked!=null?d.checked:d.defaultChecked;_=pn(d.value!=null?d.value:_),a._wrapperState={initialChecked:T,initialValue:_,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function ps(a,d){d=d.checked,d!=null&&le(a,"checked",d,!1)}function $d(a,d){ps(a,d);var _=pn(d.value),T=d.type;if(_!=null)T==="number"?(_===0&&a.value===""||a.value!=_)&&(a.value=""+_):a.value!==""+_&&(a.value=""+_);else if(T==="submit"||T==="reset"){a.removeAttribute("value");return}d.hasOwnProperty("value")?Jr(a,d.type,_):d.hasOwnProperty("defaultValue")&&Jr(a,d.type,pn(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(a.defaultChecked=!!d.defaultChecked)}function pr(a,d,_){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var T=d.type;if(!(T!=="submit"&&T!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+a._wrapperState.initialValue,_||d===a.value||(a.value=d),a.defaultValue=d}_=a.name,_!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,_!==""&&(a.name=_)}function Jr(a,d,_){(d!=="number"||Kr(a.ownerDocument)!==a)&&(_==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+_&&(a.defaultValue=""+_))}var po=Array.isArray;function ki(a,d,_,T){if(a=a.options,d){d={};for(var b=0;b<_.length;b++)d["$"+_[b]]=!0;for(_=0;_<a.length;_++)b=d.hasOwnProperty("$"+a[_].value),a[_].selected!==b&&(a[_].selected=b),b&&T&&(a[_].defaultSelected=!0)}else{for(_=""+pn(_),d=null,b=0;b<a.length;b++){if(a[b].value===_){a[b].selected=!0,T&&(a[b].defaultSelected=!0);return}d!==null||a[b].disabled||(d=a[b])}d!==null&&(d.selected=!0)}}function bl(a,d){if(d.dangerouslySetInnerHTML!=null)throw Error(f(91));return ze({},d,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Ms(a,d){var _=d.value;if(_==null){if(_=d.children,d=d.defaultValue,_!=null){if(d!=null)throw Error(f(92));if(po(_)){if(1<_.length)throw Error(f(93));_=_[0]}d=_}d==null&&(d=""),_=d}a._wrapperState={initialValue:pn(_)}}function Ar(a,d){var _=pn(d.value),T=pn(d.defaultValue);_!=null&&(_=""+_,_!==a.value&&(a.value=_),d.defaultValue==null&&a.defaultValue!==_&&(a.defaultValue=_)),T!=null&&(a.defaultValue=""+T)}function eu(a){var d=a.textContent;d===a._wrapperState.initialValue&&d!==""&&d!==null&&(a.value=d)}function ci(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zr(a,d){return a==null||a==="http://www.w3.org/1999/xhtml"?ci(d):a==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Mc,Il=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,_,T,b){MSApp.execUnsafeLocalFunction(function(){return a(d,_,T,b)})}:a}(function(a,d){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=d;else{for(Mc=Mc||document.createElement("div"),Mc.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Mc.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}});function Us(a,d){if(d){var _=a.firstChild;if(_&&_===a.lastChild&&_.nodeType===3){_.nodeValue=d;return}}a.textContent=d}var Ua={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tu=["Webkit","ms","Moz","O"];Object.keys(Ua).forEach(function(a){tu.forEach(function(d){d=d+a.charAt(0).toUpperCase()+a.substring(1),Ua[d]=Ua[a]})});function Uc(a,d,_){return d==null||typeof d=="boolean"||d===""?"":_||typeof d!="number"||d===0||Ua.hasOwnProperty(a)&&Ua[a]?(""+d).trim():d+"px"}function Ti(a,d){a=a.style;for(var _ in d)if(d.hasOwnProperty(_)){var T=_.indexOf("--")===0,b=Uc(_,d[_],T);_==="float"&&(_="cssFloat"),T?a.setProperty(_,b):a[_]=b}}var nu=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fo(a,d){if(d){if(nu[a]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(f(137,a));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(f(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(f(61))}if(d.style!=null&&typeof d.style!="object")throw Error(f(62))}}function ru(a,d){if(a.indexOf("-")===-1)return typeof d.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mo=null;function Vc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Al=null,Va=null,_o=null;function Vs(a){if(a=wu(a)){if(typeof Al!="function")throw Error(f(280));var d=a.stateNode;d&&(d=ap(d),Al(a.stateNode,a.type,d))}}function ja(a){Va?_o?_o.push(a):_o=[a]:Va=a}function Kt(){if(Va){var a=Va,d=_o;if(_o=Va=null,Vs(a),d)for(a=0;a<d.length;a++)Vs(d[a])}}function fn(a,d){return a(d)}function Fn(){}var Ci=!1;function Li(a,d,_){if(Ci)return a(d,_);Ci=!0;try{return fn(a,d,_)}finally{Ci=!1,(Va!==null||_o!==null)&&(Fn(),Kt())}}function Bn(a,d){var _=a.stateNode;if(_===null)return null;var T=ap(_);if(T===null)return null;_=T[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(T=!T.disabled)||(a=a.type,T=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!T;break e;default:a=!1}if(a)return null;if(_&&typeof _!="function")throw Error(f(231,d,typeof _));return _}var js=!1;if(N)try{var Qr={};Object.defineProperty(Qr,"passive",{get:function(){js=!0}}),window.addEventListener("test",Qr,Qr),window.removeEventListener("test",Qr,Qr)}catch{js=!1}function Xi(a,d,_,T,b,L,Y,oe,pe){var Le=Array.prototype.slice.call(arguments,3);try{d.apply(_,Le)}catch(Ze){this.onError(Ze)}}var Ol=!1,iu=null,su=!1,mm=null,BE={onError:function(a){Ol=!0,iu=a}};function WE(a,d,_,T,b,L,Y,oe,pe){Ol=!1,iu=null,Xi.apply(BE,arguments)}function M0(a,d,_,T,b,L,Y,oe,pe){if(WE.apply(this,arguments),Ol){if(Ol){var Le=iu;Ol=!1,iu=null}else throw Error(f(198));su||(su=!0,mm=Le)}}function jc(a){var d=a,_=a;if(a.alternate)for(;d.return;)d=d.return;else{a=d;do d=a,(d.flags&4098)!==0&&(_=d.return),a=d.return;while(a)}return d.tag===3?_:null}function GE(a){if(a.tag===13){var d=a.memoizedState;if(d===null&&(a=a.alternate,a!==null&&(d=a.memoizedState)),d!==null)return d.dehydrated}return null}function _m(a){if(jc(a)!==a)throw Error(f(188))}function HE(a){var d=a.alternate;if(!d){if(d=jc(a),d===null)throw Error(f(188));return d!==a?null:a}for(var _=a,T=d;;){var b=_.return;if(b===null)break;var L=b.alternate;if(L===null){if(T=b.return,T!==null){_=T;continue}break}if(b.child===L.child){for(L=b.child;L;){if(L===_)return _m(b),a;if(L===T)return _m(b),d;L=L.sibling}throw Error(f(188))}if(_.return!==T.return)_=b,T=L;else{for(var Y=!1,oe=b.child;oe;){if(oe===_){Y=!0,_=b,T=L;break}if(oe===T){Y=!0,T=b,_=L;break}oe=oe.sibling}if(!Y){for(oe=L.child;oe;){if(oe===_){Y=!0,_=L,T=b;break}if(oe===T){Y=!0,T=L,_=b;break}oe=oe.sibling}if(!Y)throw Error(f(189))}}if(_.alternate!==T)throw Error(f(190))}if(_.tag!==3)throw Error(f(188));return _.stateNode.current===_?a:d}function Bh(a){return a=HE(a),a!==null?gm(a):null}function gm(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var d=gm(a);if(d!==null)return d;a=a.sibling}return null}var Fc=h.unstable_scheduleCallback,KE=h.unstable_cancelCallback,U0=h.unstable_shouldYield,go=h.unstable_requestPaint,vr=h.unstable_now,V0=h.unstable_getCurrentPriorityLevel,fr=h.unstable_ImmediatePriority,zE=h.unstable_UserBlockingPriority,Wh=h.unstable_NormalPriority,j0=h.unstable_LowPriority,YE=h.unstable_IdlePriority,Nl=null,Eo=null;function qE(a){if(Eo&&typeof Eo.onCommitFiberRoot=="function")try{Eo.onCommitFiberRoot(Nl,a,void 0,(a.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:Pl,F0=Math.log,B0=Math.LN2;function Pl(a){return a>>>=0,a===0?32:31-(F0(a)/B0|0)|0}var Dl=64,Gh=4194304;function An(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Hh(a,d){var _=a.pendingLanes;if(_===0)return 0;var T=0,b=a.suspendedLanes,L=a.pingedLanes,Y=_&268435455;if(Y!==0){var oe=Y&~b;oe!==0?T=An(oe):(L&=Y,L!==0&&(T=An(L)))}else Y=_&~b,Y!==0?T=An(Y):L!==0&&(T=An(L));if(T===0)return 0;if(d!==0&&d!==T&&(d&b)===0&&(b=T&-T,L=d&-d,b>=L||b===16&&(L&4194240)!==0))return d;if((T&4)!==0&&(T|=_&16),d=a.entangledLanes,d!==0)for(a=a.entanglements,d&=T;0<d;)_=31-Fs(d),b=1<<_,T|=a[_],d&=~b;return T}function XE(a,d){switch(a){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JE(a,d){for(var _=a.suspendedLanes,T=a.pingedLanes,b=a.expirationTimes,L=a.pendingLanes;0<L;){var Y=31-Fs(L),oe=1<<Y,pe=b[Y];pe===-1?((oe&_)===0||(oe&T)!==0)&&(b[Y]=XE(oe,d)):pe<=d&&(a.expiredLanes|=oe),L&=~oe}}function Em(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function QE(){var a=Dl;return Dl<<=1,(Dl&4194240)===0&&(Dl=64),a}function vm(a){for(var d=[],_=0;31>_;_++)d.push(a);return d}function ou(a,d,_){a.pendingLanes|=d,d!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,d=31-Fs(d),a[d]=_}function W0(a,d){var _=a.pendingLanes&~d;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=d,a.mutableReadLanes&=d,a.entangledLanes&=d,d=a.entanglements;var T=a.eventTimes;for(a=a.expirationTimes;0<_;){var b=31-Fs(_),L=1<<b;d[b]=0,T[b]=-1,a[b]=-1,_&=~L}}function Sm(a,d){var _=a.entangledLanes|=d;for(a=a.entanglements;_;){var T=31-Fs(_),b=1<<T;b&d|a[T]&d&&(a[T]|=d),_&=~b}}var On=0;function ym(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var Kh,Tm,zh,ZE,Cm,Rm=!1,Yh=[],Fa=null,Ba=null,Wa=null,au=new Map,cu=new Map,Ga=[],$E="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ev(a,d){switch(a){case"focusin":case"focusout":Fa=null;break;case"dragenter":case"dragleave":Ba=null;break;case"mouseover":case"mouseout":Wa=null;break;case"pointerover":case"pointerout":au.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":cu.delete(d.pointerId)}}function lu(a,d,_,T,b,L){return a===null||a.nativeEvent!==L?(a={blockedOn:d,domEventName:_,eventSystemFlags:T,nativeEvent:L,targetContainers:[b]},d!==null&&(d=wu(d),d!==null&&Tm(d)),a):(a.eventSystemFlags|=T,d=a.targetContainers,b!==null&&d.indexOf(b)===-1&&d.push(b),a)}function G0(a,d,_,T,b){switch(d){case"focusin":return Fa=lu(Fa,a,d,_,T,b),!0;case"dragenter":return Ba=lu(Ba,a,d,_,T,b),!0;case"mouseover":return Wa=lu(Wa,a,d,_,T,b),!0;case"pointerover":var L=b.pointerId;return au.set(L,lu(au.get(L)||null,a,d,_,T,b)),!0;case"gotpointercapture":return L=b.pointerId,cu.set(L,lu(cu.get(L)||null,a,d,_,T,b)),!0}return!1}function kl(a){var d=Gc(a.target);if(d!==null){var _=jc(d);if(_!==null){if(d=_.tag,d===13){if(d=GE(_),d!==null){a.blockedOn=d,Cm(a.priority,function(){zh(_)});return}}else if(d===3&&_.stateNode.current.memoizedState.isDehydrated){a.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}a.blockedOn=null}function qh(a){if(a.blockedOn!==null)return!1;for(var d=a.targetContainers;0<d.length;){var _=wm(a.domEventName,a.eventSystemFlags,d[0],a.nativeEvent);if(_===null){_=a.nativeEvent;var T=new _.constructor(_.type,_);mo=T,_.target.dispatchEvent(T),mo=null}else return d=wu(_),d!==null&&Tm(d),a.blockedOn=_,!1;d.shift()}return!0}function tv(a,d,_){qh(a)&&_.delete(d)}function H0(){Rm=!1,Fa!==null&&qh(Fa)&&(Fa=null),Ba!==null&&qh(Ba)&&(Ba=null),Wa!==null&&qh(Wa)&&(Wa=null),au.forEach(tv),cu.forEach(tv)}function du(a,d){a.blockedOn===d&&(a.blockedOn=null,Rm||(Rm=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,H0)))}function Ll(a){function d(b){return du(b,a)}if(0<Yh.length){du(Yh[0],a);for(var _=1;_<Yh.length;_++){var T=Yh[_];T.blockedOn===a&&(T.blockedOn=null)}}for(Fa!==null&&du(Fa,a),Ba!==null&&du(Ba,a),Wa!==null&&du(Wa,a),au.forEach(d),cu.forEach(d),_=0;_<Ga.length;_++)T=Ga[_],T.blockedOn===a&&(T.blockedOn=null);for(;0<Ga.length&&(_=Ga[0],_.blockedOn===null);)kl(_),_.blockedOn===null&&Ga.shift()}var xl=ne.ReactCurrentBatchConfig,Xh=!0;function K0(a,d,_,T){var b=On,L=xl.transition;xl.transition=null;try{On=1,xi(a,d,_,T)}finally{On=b,xl.transition=L}}function Ha(a,d,_,T){var b=On,L=xl.transition;xl.transition=null;try{On=4,xi(a,d,_,T)}finally{On=b,xl.transition=L}}function xi(a,d,_,T){if(Xh){var b=wm(a,d,_,T);if(b===null)Km(a,d,T,uu,_),ev(a,T);else if(G0(b,a,d,_,T))T.stopPropagation();else if(ev(a,T),d&4&&-1<$E.indexOf(a)){for(;b!==null;){var L=wu(b);if(L!==null&&Kh(L),L=wm(a,d,_,T),L===null&&Km(a,d,T,uu,_),L===b)break;b=L}b!==null&&T.stopPropagation()}else Km(a,d,T,null,_)}}var uu=null;function wm(a,d,_,T){if(uu=null,a=Vc(T),a=Gc(a),a!==null)if(d=jc(a),d===null)a=null;else if(_=d.tag,_===13){if(a=GE(d),a!==null)return a;a=null}else if(_===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;a=null}else d!==a&&(a=null);return uu=a,null}function nv(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(V0()){case fr:return 1;case zE:return 4;case Wh:case j0:return 16;case YE:return 536870912;default:return 16}default:return 16}}var Ka=null,Zr=null,Jh=null;function rv(){if(Jh)return Jh;var a,d=Zr,_=d.length,T,b="value"in Ka?Ka.value:Ka.textContent,L=b.length;for(a=0;a<_&&d[a]===b[a];a++);var Y=_-a;for(T=1;T<=Y&&d[_-T]===b[L-T];T++);return Jh=b.slice(a,1<T?1-T:void 0)}function Qh(a){var d=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&d===13&&(a=13)):a=d,a===10&&(a=13),32<=a||a===13?a:0}function Bc(){return!0}function bm(){return!1}function Ji(a){function d(_,T,b,L,Y){this._reactName=_,this._targetInst=b,this.type=T,this.nativeEvent=L,this.target=Y,this.currentTarget=null;for(var oe in a)a.hasOwnProperty(oe)&&(_=a[oe],this[oe]=_?_(L):L[oe]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Bc:bm,this.isPropagationStopped=bm,this}return ze(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=Bc)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=Bc)},persist:function(){},isPersistent:Bc}),d}var za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Im=Ji(za),Wc=ze({},za,{view:0,detail:0}),Am=Ji(Wc),hu,Om,pu,vo=ze({},Wc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pm,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==pu&&(pu&&a.type==="mousemove"?(hu=a.screenX-pu.screenX,Om=a.screenY-pu.screenY):Om=hu=0,pu=a),hu)},movementY:function(a){return"movementY"in a?a.movementY:Om}}),Ml=Ji(vo),z0=ze({},vo,{dataTransfer:0}),Y0=Ji(z0),q0=ze({},Wc,{relatedTarget:0}),Nm=Ji(q0),X0=ze({},za,{animationName:0,elapsedTime:0,pseudoElement:0}),Ul=Ji(X0),J0=ze({},za,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Vl=Ji(J0),iv=ze({},za,{data:0}),sv=Ji(iv),qt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Q0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Z0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $0(a){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(a):(a=Z0[a])?!!d[a]:!1}function Pm(){return $0}var Dm=ze({},Wc,{key:function(a){if(a.key){var d=qt[a.key]||a.key;if(d!=="Unidentified")return d}return a.type==="keypress"?(a=Qh(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Q0[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pm,charCode:function(a){return a.type==="keypress"?Qh(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Qh(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),eC=Ji(Dm),tC=ze({},vo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ov=Ji(tC),km=ze({},Wc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pm}),nC=Ji(km),rC=ze({},za,{propertyName:0,elapsedTime:0,pseudoElement:0}),av=Ji(rC),iC=ze({},vo,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Ya=Ji(iC),sC=[9,13,27,32],Lm=N&&"CompositionEvent"in window,fu=null;N&&"documentMode"in document&&(fu=document.documentMode);var cv=N&&"TextEvent"in window&&!fu,Zh=N&&(!Lm||fu&&8<fu&&11>=fu),lv=" ",dv=!1;function uv(a,d){switch(a){case"keyup":return sC.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qi(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var jl=!1;function oC(a,d){switch(a){case"compositionend":return Qi(d);case"keypress":return d.which!==32?null:(dv=!0,lv);case"textInput":return a=d.data,a===lv&&dv?null:a;default:return null}}function aC(a,d){if(jl)return a==="compositionend"||!Lm&&uv(a,d)?(a=rv(),Jh=Zr=Ka=null,jl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Zh&&d.locale!=="ko"?null:d.data;default:return null}}var cC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xm(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d==="input"?!!cC[a.type]:d==="textarea"}function hv(a,d,_,T){ja(T),d=yu(d,"onChange"),0<d.length&&(_=new Im("onChange","change",null,_,T),a.push({event:_,listeners:d}))}var mu=null,Fl=null;function Mm(a){Cv(a,0)}function $h(a){var d=Yl(a);if(Ma(d))return a}function lC(a,d){if(a==="change")return d}var _u=!1;if(N){var Um;if(N){var Vm="oninput"in document;if(!Vm){var pv=document.createElement("div");pv.setAttribute("oninput","return;"),Vm=typeof pv.oninput=="function"}Um=Vm}else Um=!1;_u=Um&&(!document.documentMode||9<document.documentMode)}function Xo(){mu&&(mu.detachEvent("onpropertychange",fv),Fl=mu=null)}function fv(a){if(a.propertyName==="value"&&$h(Fl)){var d=[];hv(d,Fl,a,Vc(a)),Li(Mm,d)}}function dC(a,d,_){a==="focusin"?(Xo(),mu=d,Fl=_,mu.attachEvent("onpropertychange",fv)):a==="focusout"&&Xo()}function Mi(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return $h(Fl)}function uC(a,d){if(a==="click")return $h(d)}function hC(a,d){if(a==="input"||a==="change")return $h(d)}function pC(a,d){return a===d&&(a!==0||1/a===1/d)||a!==a&&d!==d}var Bs=typeof Object.is=="function"?Object.is:pC;function Bl(a,d){if(Bs(a,d))return!0;if(typeof a!="object"||a===null||typeof d!="object"||d===null)return!1;var _=Object.keys(a),T=Object.keys(d);if(_.length!==T.length)return!1;for(T=0;T<_.length;T++){var b=_[T];if(!k.call(d,b)||!Bs(a[b],d[b]))return!1}return!0}function mv(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function _v(a,d){var _=mv(a);a=0;for(var T;_;){if(_.nodeType===3){if(T=a+_.textContent.length,a<=d&&T>=d)return{node:_,offset:d-a};a=T}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=mv(_)}}function gv(a,d){return a&&d?a===d?!0:a&&a.nodeType===3?!1:d&&d.nodeType===3?gv(a,d.parentNode):"contains"in a?a.contains(d):a.compareDocumentPosition?!!(a.compareDocumentPosition(d)&16):!1:!1}function jm(){for(var a=window,d=Kr();d instanceof a.HTMLIFrameElement;){try{var _=typeof d.contentWindow.location.href=="string"}catch{_=!1}if(_)a=d.contentWindow;else break;d=Kr(a.document)}return d}function Fm(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d&&(d==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||d==="textarea"||a.contentEditable==="true")}function fC(a){var d=jm(),_=a.focusedElem,T=a.selectionRange;if(d!==_&&_&&_.ownerDocument&&gv(_.ownerDocument.documentElement,_)){if(T!==null&&Fm(_)){if(d=T.start,a=T.end,a===void 0&&(a=d),"selectionStart"in _)_.selectionStart=d,_.selectionEnd=Math.min(a,_.value.length);else if(a=(d=_.ownerDocument||document)&&d.defaultView||window,a.getSelection){a=a.getSelection();var b=_.textContent.length,L=Math.min(T.start,b);T=T.end===void 0?L:Math.min(T.end,b),!a.extend&&L>T&&(b=T,T=L,L=b),b=_v(_,L);var Y=_v(_,T);b&&Y&&(a.rangeCount!==1||a.anchorNode!==b.node||a.anchorOffset!==b.offset||a.focusNode!==Y.node||a.focusOffset!==Y.offset)&&(d=d.createRange(),d.setStart(b.node,b.offset),a.removeAllRanges(),L>T?(a.addRange(d),a.extend(Y.node,Y.offset)):(d.setEnd(Y.node,Y.offset),a.addRange(d)))}}for(d=[],a=_;a=a.parentNode;)a.nodeType===1&&d.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<d.length;_++)a=d[_],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Bm=N&&"documentMode"in document&&11>=document.documentMode,qa=null,Wm=null,Oe=null,Gm=!1;function Ev(a,d,_){var T=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Gm||qa==null||qa!==Kr(T)||(T=qa,"selectionStart"in T&&Fm(T)?T={start:T.selectionStart,end:T.selectionEnd}:(T=(T.ownerDocument&&T.ownerDocument.defaultView||window).getSelection(),T={anchorNode:T.anchorNode,anchorOffset:T.anchorOffset,focusNode:T.focusNode,focusOffset:T.focusOffset}),Oe&&Bl(Oe,T)||(Oe=T,T=yu(Wm,"onSelect"),0<T.length&&(d=new Im("onSelect","select",null,d,_),a.push({event:d,listeners:T}),d.target=qa)))}function ep(a,d){var _={};return _[a.toLowerCase()]=d.toLowerCase(),_["Webkit"+a]="webkit"+d,_["Moz"+a]="moz"+d,_}var Wl={animationend:ep("Animation","AnimationEnd"),animationiteration:ep("Animation","AnimationIteration"),animationstart:ep("Animation","AnimationStart"),transitionend:ep("Transition","TransitionEnd")},tp={},Hm={};N&&(Hm=document.createElement("div").style,"AnimationEvent"in window||(delete Wl.animationend.animation,delete Wl.animationiteration.animation,delete Wl.animationstart.animation),"TransitionEvent"in window||delete Wl.transitionend.transition);function np(a){if(tp[a])return tp[a];if(!Wl[a])return a;var d=Wl[a],_;for(_ in d)if(d.hasOwnProperty(_)&&_ in Hm)return tp[a]=d[_];return a}var vv=np("animationend"),Sv=np("animationiteration"),gu=np("animationstart"),Gl=np("transitionend"),yv=new Map,Tv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ws(a,d){yv.set(a,d),C(d,[a])}for(var Eu=0;Eu<Tv.length;Eu++){var Hl=Tv[Eu],mC=Hl.toLowerCase(),_C=Hl[0].toUpperCase()+Hl.slice(1);Ws(mC,"on"+_C)}Ws(vv,"onAnimationEnd"),Ws(Sv,"onAnimationIteration"),Ws(gu,"onAnimationStart"),Ws("dblclick","onDoubleClick"),Ws("focusin","onFocus"),Ws("focusout","onBlur"),Ws(Gl,"onTransitionEnd"),I("onMouseEnter",["mouseout","mouseover"]),I("onMouseLeave",["mouseout","mouseover"]),I("onPointerEnter",["pointerout","pointerover"]),I("onPointerLeave",["pointerout","pointerover"]),C("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),C("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),C("onBeforeInput",["compositionend","keypress","textInput","paste"]),C("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),C("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),C("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gC=new Set("cancel close invalid load scroll toggle".split(" ").concat(vu));function rp(a,d,_){var T=a.type||"unknown-event";a.currentTarget=_,M0(T,d,void 0,a),a.currentTarget=null}function Cv(a,d){d=(d&4)!==0;for(var _=0;_<a.length;_++){var T=a[_],b=T.event;T=T.listeners;e:{var L=void 0;if(d)for(var Y=T.length-1;0<=Y;Y--){var oe=T[Y],pe=oe.instance,Le=oe.currentTarget;if(oe=oe.listener,pe!==L&&b.isPropagationStopped())break e;rp(b,oe,Le),L=pe}else for(Y=0;Y<T.length;Y++){if(oe=T[Y],pe=oe.instance,Le=oe.currentTarget,oe=oe.listener,pe!==L&&b.isPropagationStopped())break e;rp(b,oe,Le),L=pe}}}if(su)throw a=mm,su=!1,mm=null,a}function zn(a,d){var _=d[Xm];_===void 0&&(_=d[Xm]=new Set);var T=a+"__bubble";_.has(T)||(Rv(d,a,2,!1),_.add(T))}function Ui(a,d,_){var T=0;d&&(T|=4),Rv(_,a,T,d)}var ip="_reactListening"+Math.random().toString(36).slice(2);function Jo(a){if(!a[ip]){a[ip]=!0,g.forEach(function(_){_!=="selectionchange"&&(gC.has(_)||Ui(_,!1,a),Ui(_,!0,a))});var d=a.nodeType===9?a:a.ownerDocument;d===null||d[ip]||(d[ip]=!0,Ui("selectionchange",!1,d))}}function Rv(a,d,_,T){switch(nv(d)){case 1:var b=K0;break;case 4:b=Ha;break;default:b=xi}_=b.bind(null,d,_,a),b=void 0,!js||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(b=!0),T?b!==void 0?a.addEventListener(d,_,{capture:!0,passive:b}):a.addEventListener(d,_,!0):b!==void 0?a.addEventListener(d,_,{passive:b}):a.addEventListener(d,_,!1)}function Km(a,d,_,T,b){var L=T;if((d&1)===0&&(d&2)===0&&T!==null)e:for(;;){if(T===null)return;var Y=T.tag;if(Y===3||Y===4){var oe=T.stateNode.containerInfo;if(oe===b||oe.nodeType===8&&oe.parentNode===b)break;if(Y===4)for(Y=T.return;Y!==null;){var pe=Y.tag;if((pe===3||pe===4)&&(pe=Y.stateNode.containerInfo,pe===b||pe.nodeType===8&&pe.parentNode===b))return;Y=Y.return}for(;oe!==null;){if(Y=Gc(oe),Y===null)return;if(pe=Y.tag,pe===5||pe===6){T=L=Y;continue e}oe=oe.parentNode}}T=T.return}Li(function(){var Le=L,Ze=Vc(_),$e=[];e:{var Qe=yv.get(a);if(Qe!==void 0){var _t=Im,Tt=a;switch(a){case"keypress":if(Qh(_)===0)break e;case"keydown":case"keyup":_t=eC;break;case"focusin":Tt="focus",_t=Nm;break;case"focusout":Tt="blur",_t=Nm;break;case"beforeblur":case"afterblur":_t=Nm;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_t=Ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_t=Y0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_t=nC;break;case vv:case Sv:case gu:_t=Ul;break;case Gl:_t=av;break;case"scroll":_t=Am;break;case"wheel":_t=Ya;break;case"copy":case"cut":case"paste":_t=Vl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_t=ov}var Rt=(d&4)!==0,lr=!Rt&&a==="scroll",Ce=Rt?Qe!==null?Qe+"Capture":null:Qe;Rt=[];for(var _e=Le,Ne;_e!==null;){Ne=_e;var tt=Ne.stateNode;if(Ne.tag===5&&tt!==null&&(Ne=tt,Ce!==null&&(tt=Bn(_e,Ce),tt!=null&&Rt.push(Su(_e,tt,Ne)))),lr)break;_e=_e.return}0<Rt.length&&(Qe=new _t(Qe,Tt,null,_,Ze),$e.push({event:Qe,listeners:Rt}))}}if((d&7)===0){e:{if(Qe=a==="mouseover"||a==="pointerover",_t=a==="mouseout"||a==="pointerout",Qe&&_!==mo&&(Tt=_.relatedTarget||_.fromElement)&&(Gc(Tt)||Tt[Qo]))break e;if((_t||Qe)&&(Qe=Ze.window===Ze?Ze:(Qe=Ze.ownerDocument)?Qe.defaultView||Qe.parentWindow:window,_t?(Tt=_.relatedTarget||_.toElement,_t=Le,Tt=Tt?Gc(Tt):null,Tt!==null&&(lr=jc(Tt),Tt!==lr||Tt.tag!==5&&Tt.tag!==6)&&(Tt=null)):(_t=null,Tt=Le),_t!==Tt)){if(Rt=Ml,tt="onMouseLeave",Ce="onMouseEnter",_e="mouse",(a==="pointerout"||a==="pointerover")&&(Rt=ov,tt="onPointerLeave",Ce="onPointerEnter",_e="pointer"),lr=_t==null?Qe:Yl(_t),Ne=Tt==null?Qe:Yl(Tt),Qe=new Rt(tt,_e+"leave",_t,_,Ze),Qe.target=lr,Qe.relatedTarget=Ne,tt=null,Gc(Ze)===Le&&(Rt=new Rt(Ce,_e+"enter",Tt,_,Ze),Rt.target=Ne,Rt.relatedTarget=lr,tt=Rt),lr=tt,_t&&Tt)t:{for(Rt=_t,Ce=Tt,_e=0,Ne=Rt;Ne;Ne=Kl(Ne))_e++;for(Ne=0,tt=Ce;tt;tt=Kl(tt))Ne++;for(;0<_e-Ne;)Rt=Kl(Rt),_e--;for(;0<Ne-_e;)Ce=Kl(Ce),Ne--;for(;_e--;){if(Rt===Ce||Ce!==null&&Rt===Ce.alternate)break t;Rt=Kl(Rt),Ce=Kl(Ce)}Rt=null}else Rt=null;_t!==null&&wv($e,Qe,_t,Rt,!1),Tt!==null&&lr!==null&&wv($e,lr,Tt,Rt,!0)}}e:{if(Qe=Le?Yl(Le):window,_t=Qe.nodeName&&Qe.nodeName.toLowerCase(),_t==="select"||_t==="input"&&Qe.type==="file")var wt=lC;else if(xm(Qe))if(_u)wt=hC;else{wt=Mi;var Dt=dC}else(_t=Qe.nodeName)&&_t.toLowerCase()==="input"&&(Qe.type==="checkbox"||Qe.type==="radio")&&(wt=uC);if(wt&&(wt=wt(a,Le))){hv($e,wt,_,Ze);break e}Dt&&Dt(a,Qe,Le),a==="focusout"&&(Dt=Qe._wrapperState)&&Dt.controlled&&Qe.type==="number"&&Jr(Qe,"number",Qe.value)}switch(Dt=Le?Yl(Le):window,a){case"focusin":(xm(Dt)||Dt.contentEditable==="true")&&(qa=Dt,Wm=Le,Oe=null);break;case"focusout":Oe=Wm=qa=null;break;case"mousedown":Gm=!0;break;case"contextmenu":case"mouseup":case"dragend":Gm=!1,Ev($e,_,Ze);break;case"selectionchange":if(Bm)break;case"keydown":case"keyup":Ev($e,_,Ze)}var kt;if(Lm)e:{switch(a){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else jl?uv(a,_)&&(Vt="onCompositionEnd"):a==="keydown"&&_.keyCode===229&&(Vt="onCompositionStart");Vt&&(Zh&&_.locale!=="ko"&&(jl||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&jl&&(kt=rv()):(Ka=Ze,Zr="value"in Ka?Ka.value:Ka.textContent,jl=!0)),Dt=yu(Le,Vt),0<Dt.length&&(Vt=new sv(Vt,a,null,_,Ze),$e.push({event:Vt,listeners:Dt}),kt?Vt.data=kt:(kt=Qi(_),kt!==null&&(Vt.data=kt)))),(kt=cv?oC(a,_):aC(a,_))&&(Le=yu(Le,"onBeforeInput"),0<Le.length&&(Ze=new sv("onBeforeInput","beforeinput",null,_,Ze),$e.push({event:Ze,listeners:Le}),Ze.data=kt))}Cv($e,d)})}function Su(a,d,_){return{instance:a,listener:d,currentTarget:_}}function yu(a,d){for(var _=d+"Capture",T=[];a!==null;){var b=a,L=b.stateNode;b.tag===5&&L!==null&&(b=L,L=Bn(a,_),L!=null&&T.unshift(Su(a,L,b)),L=Bn(a,d),L!=null&&T.push(Su(a,L,b))),a=a.return}return T}function Kl(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function wv(a,d,_,T,b){for(var L=d._reactName,Y=[];_!==null&&_!==T;){var oe=_,pe=oe.alternate,Le=oe.stateNode;if(pe!==null&&pe===T)break;oe.tag===5&&Le!==null&&(oe=Le,b?(pe=Bn(_,L),pe!=null&&Y.unshift(Su(_,pe,oe))):b||(pe=Bn(_,L),pe!=null&&Y.push(Su(_,pe,oe)))),_=_.return}Y.length!==0&&a.push({event:d,listeners:Y})}var EC=/\r\n?/g,zm=/\u0000|\uFFFD/g;function bv(a){return(typeof a=="string"?a:""+a).replace(EC,`
`).replace(zm,"")}function Tu(a,d,_){if(d=bv(d),bv(a)!==d&&_)throw Error(f(425))}function Cu(){}var Ym=null,sp=null;function zl(a,d){return a==="textarea"||a==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var qm=typeof setTimeout=="function"?setTimeout:void 0,vC=typeof clearTimeout=="function"?clearTimeout:void 0,Iv=typeof Promise=="function"?Promise:void 0,SC=typeof queueMicrotask=="function"?queueMicrotask:typeof Iv<"u"?function(a){return Iv.resolve(null).then(a).catch(yC)}:qm;function yC(a){setTimeout(function(){throw a})}function op(a,d){var _=d,T=0;do{var b=_.nextSibling;if(a.removeChild(_),b&&b.nodeType===8)if(_=b.data,_==="/$"){if(T===0){a.removeChild(b),Ll(d);return}T--}else _!=="$"&&_!=="$?"&&_!=="$!"||T++;_=b}while(_);Ll(d)}function So(a){for(;a!=null;a=a.nextSibling){var d=a.nodeType;if(d===1||d===3)break;if(d===8){if(d=a.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return a}function Av(a){a=a.previousSibling;for(var d=0;a;){if(a.nodeType===8){var _=a.data;if(_==="$"||_==="$!"||_==="$?"){if(d===0)return a;d--}else _==="/$"&&d++}a=a.previousSibling}return null}var Xa=Math.random().toString(36).slice(2),yo="__reactFiber$"+Xa,Ru="__reactProps$"+Xa,Qo="__reactContainer$"+Xa,Xm="__reactEvents$"+Xa,TC="__reactListeners$"+Xa,CC="__reactHandles$"+Xa;function Gc(a){var d=a[yo];if(d)return d;for(var _=a.parentNode;_;){if(d=_[Qo]||_[yo]){if(_=d.alternate,d.child!==null||_!==null&&_.child!==null)for(a=Av(a);a!==null;){if(_=a[yo])return _;a=Av(a)}return d}a=_,_=a.parentNode}return null}function wu(a){return a=a[yo]||a[Qo],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Yl(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(f(33))}function ap(a){return a[Ru]||null}var Jm=[],Zo=-1;function Gs(a){return{current:a}}function Wn(a){0>Zo||(a.current=Jm[Zo],Jm[Zo]=null,Zo--)}function Yn(a,d){Zo++,Jm[Zo]=a.current,a.current=d}var Ja={},li=Gs(Ja),Ri=Gs(!1),Qa=Ja;function Za(a,d){var _=a.type.contextTypes;if(!_)return Ja;var T=a.stateNode;if(T&&T.__reactInternalMemoizedUnmaskedChildContext===d)return T.__reactInternalMemoizedMaskedChildContext;var b={},L;for(L in _)b[L]=d[L];return T&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=d,a.__reactInternalMemoizedMaskedChildContext=b),b}function Vi(a){return a=a.childContextTypes,a!=null}function cp(){Wn(Ri),Wn(li)}function ql(a,d,_){if(li.current!==Ja)throw Error(f(168));Yn(li,d),Yn(Ri,_)}function Ov(a,d,_){var T=a.stateNode;if(d=d.childContextTypes,typeof T.getChildContext!="function")return _;T=T.getChildContext();for(var b in T)if(!(b in d))throw Error(f(108,yt(a)||"Unknown",b));return ze({},_,T)}function lp(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ja,Qa=li.current,Yn(li,a),Yn(Ri,Ri.current),!0}function Nv(a,d,_){var T=a.stateNode;if(!T)throw Error(f(169));_?(a=Ov(a,d,Qa),T.__reactInternalMemoizedMergedChildContext=a,Wn(Ri),Wn(li),Yn(li,a)):Wn(Ri),Yn(Ri,_)}var $o=null,dp=!1,Qm=!1;function Zm(a){$o===null?$o=[a]:$o.push(a)}function RC(a){dp=!0,Zm(a)}function $a(){if(!Qm&&$o!==null){Qm=!0;var a=0,d=On;try{var _=$o;for(On=1;a<_.length;a++){var T=_[a];do T=T(!0);while(T!==null)}$o=null,dp=!1}catch(b){throw $o!==null&&($o=$o.slice(a+1)),Fc(fr,$a),b}finally{On=d,Qm=!1}}return null}var Xl=[],ec=0,up=null,hp=0,wi=[],fs=0,Hc=null,ea=1,ta="";function Kc(a,d){Xl[ec++]=hp,Xl[ec++]=up,up=a,hp=d}function Pv(a,d,_){wi[fs++]=ea,wi[fs++]=ta,wi[fs++]=Hc,Hc=a;var T=ea;a=ta;var b=32-Fs(T)-1;T&=~(1<<b),_+=1;var L=32-Fs(d)+b;if(30<L){var Y=b-b%5;L=(T&(1<<Y)-1).toString(32),T>>=Y,b-=Y,ea=1<<32-Fs(d)+b|_<<b|T,ta=L+a}else ea=1<<L|_<<b|T,ta=a}function Jl(a){a.return!==null&&(Kc(a,1),Pv(a,1,0))}function pp(a){for(;a===up;)up=Xl[--ec],Xl[ec]=null,hp=Xl[--ec],Xl[ec]=null;for(;a===Hc;)Hc=wi[--fs],wi[fs]=null,ta=wi[--fs],wi[fs]=null,ea=wi[--fs],wi[fs]=null}var Zi=null,$i=null,Zn=!1,Hs=null;function Dv(a,d){var _=vs(5,null,null,0);_.elementType="DELETED",_.stateNode=d,_.return=a,d=a.deletions,d===null?(a.deletions=[_],a.flags|=16):d.push(_)}function kv(a,d){switch(a.tag){case 5:var _=a.type;return d=d.nodeType!==1||_.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(a.stateNode=d,Zi=a,$i=So(d.firstChild),!0):!1;case 6:return d=a.pendingProps===""||d.nodeType!==3?null:d,d!==null?(a.stateNode=d,Zi=a,$i=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(_=Hc!==null?{id:ea,overflow:ta}:null,a.memoizedState={dehydrated:d,treeContext:_,retryLane:1073741824},_=vs(18,null,null,0),_.stateNode=d,_.return=a,a.child=_,Zi=a,$i=null,!0):!1;default:return!1}}function bu(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Iu(a){if(Zn){var d=$i;if(d){var _=d;if(!kv(a,d)){if(bu(a))throw Error(f(418));d=So(_.nextSibling);var T=Zi;d&&kv(a,d)?Dv(T,_):(a.flags=a.flags&-4097|2,Zn=!1,Zi=a)}}else{if(bu(a))throw Error(f(418));a.flags=a.flags&-4097|2,Zn=!1,Zi=a}}}function $m(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Zi=a}function Ql(a){if(a!==Zi)return!1;if(!Zn)return $m(a),Zn=!0,!1;var d;if((d=a.tag!==3)&&!(d=a.tag!==5)&&(d=a.type,d=d!=="head"&&d!=="body"&&!zl(a.type,a.memoizedProps)),d&&(d=$i)){if(bu(a))throw e_(),Error(f(418));for(;d;)Dv(a,d),d=So(d.nextSibling)}if($m(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(f(317));e:{for(a=a.nextSibling,d=0;a;){if(a.nodeType===8){var _=a.data;if(_==="/$"){if(d===0){$i=So(a.nextSibling);break e}d--}else _!=="$"&&_!=="$!"&&_!=="$?"||d++}a=a.nextSibling}$i=null}}else $i=Zi?So(a.stateNode.nextSibling):null;return!0}function e_(){for(var a=$i;a;)a=So(a.nextSibling)}function zc(){$i=Zi=null,Zn=!1}function Zl(a){Hs===null?Hs=[a]:Hs.push(a)}var Au=ne.ReactCurrentBatchConfig;function Ou(a,d,_){if(a=_.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(f(309));var T=_.stateNode}if(!T)throw Error(f(147,a));var b=T,L=""+a;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===L?d.ref:(d=function(Y){var oe=b.refs;Y===null?delete oe[L]:oe[L]=Y},d._stringRef=L,d)}if(typeof a!="string")throw Error(f(284));if(!_._owner)throw Error(f(290,a))}return a}function fp(a,d){throw a=Object.prototype.toString.call(d),Error(f(31,a==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":a))}function t_(a){var d=a._init;return d(a._payload)}function Lv(a){function d(Ce,_e){if(a){var Ne=Ce.deletions;Ne===null?(Ce.deletions=[_e],Ce.flags|=16):Ne.push(_e)}}function _(Ce,_e){if(!a)return null;for(;_e!==null;)d(Ce,_e),_e=_e.sibling;return null}function T(Ce,_e){for(Ce=new Map;_e!==null;)_e.key!==null?Ce.set(_e.key,_e):Ce.set(_e.index,_e),_e=_e.sibling;return Ce}function b(Ce,_e){return Ce=hc(Ce,_e),Ce.index=0,Ce.sibling=null,Ce}function L(Ce,_e,Ne){return Ce.index=Ne,a?(Ne=Ce.alternate,Ne!==null?(Ne=Ne.index,Ne<_e?(Ce.flags|=2,_e):Ne):(Ce.flags|=2,_e)):(Ce.flags|=1048576,_e)}function Y(Ce){return a&&Ce.alternate===null&&(Ce.flags|=2),Ce}function oe(Ce,_e,Ne,tt){return _e===null||_e.tag!==6?(_e=Hp(Ne,Ce.mode,tt),_e.return=Ce,_e):(_e=b(_e,Ne),_e.return=Ce,_e)}function pe(Ce,_e,Ne,tt){var wt=Ne.type;return wt===Se?Ze(Ce,_e,Ne.props.children,tt,Ne.key):_e!==null&&(_e.elementType===wt||typeof wt=="object"&&wt!==null&&wt.$$typeof===Xe&&t_(wt)===_e.type)?(tt=b(_e,Ne.props),tt.ref=Ou(Ce,_e,Ne),tt.return=Ce,tt):(tt=dd(Ne.type,Ne.key,Ne.props,null,Ce.mode,tt),tt.ref=Ou(Ce,_e,Ne),tt.return=Ce,tt)}function Le(Ce,_e,Ne,tt){return _e===null||_e.tag!==4||_e.stateNode.containerInfo!==Ne.containerInfo||_e.stateNode.implementation!==Ne.implementation?(_e=ud(Ne,Ce.mode,tt),_e.return=Ce,_e):(_e=b(_e,Ne.children||[]),_e.return=Ce,_e)}function Ze(Ce,_e,Ne,tt,wt){return _e===null||_e.tag!==7?(_e=pc(Ne,Ce.mode,tt,wt),_e.return=Ce,_e):(_e=b(_e,Ne),_e.return=Ce,_e)}function $e(Ce,_e,Ne){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return _e=Hp(""+_e,Ce.mode,Ne),_e.return=Ce,_e;if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case de:return Ne=dd(_e.type,_e.key,_e.props,null,Ce.mode,Ne),Ne.ref=Ou(Ce,null,_e),Ne.return=Ce,Ne;case be:return _e=ud(_e,Ce.mode,Ne),_e.return=Ce,_e;case Xe:var tt=_e._init;return $e(Ce,tt(_e._payload),Ne)}if(po(_e)||De(_e))return _e=pc(_e,Ce.mode,Ne,null),_e.return=Ce,_e;fp(Ce,_e)}return null}function Qe(Ce,_e,Ne,tt){var wt=_e!==null?_e.key:null;if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return wt!==null?null:oe(Ce,_e,""+Ne,tt);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case de:return Ne.key===wt?pe(Ce,_e,Ne,tt):null;case be:return Ne.key===wt?Le(Ce,_e,Ne,tt):null;case Xe:return wt=Ne._init,Qe(Ce,_e,wt(Ne._payload),tt)}if(po(Ne)||De(Ne))return wt!==null?null:Ze(Ce,_e,Ne,tt,null);fp(Ce,Ne)}return null}function _t(Ce,_e,Ne,tt,wt){if(typeof tt=="string"&&tt!==""||typeof tt=="number")return Ce=Ce.get(Ne)||null,oe(_e,Ce,""+tt,wt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case de:return Ce=Ce.get(tt.key===null?Ne:tt.key)||null,pe(_e,Ce,tt,wt);case be:return Ce=Ce.get(tt.key===null?Ne:tt.key)||null,Le(_e,Ce,tt,wt);case Xe:var Dt=tt._init;return _t(Ce,_e,Ne,Dt(tt._payload),wt)}if(po(tt)||De(tt))return Ce=Ce.get(Ne)||null,Ze(_e,Ce,tt,wt,null);fp(_e,tt)}return null}function Tt(Ce,_e,Ne,tt){for(var wt=null,Dt=null,kt=_e,Vt=_e=0,Vr=null;kt!==null&&Vt<Ne.length;Vt++){kt.index>Vt?(Vr=kt,kt=null):Vr=kt.sibling;var wn=Qe(Ce,kt,Ne[Vt],tt);if(wn===null){kt===null&&(kt=Vr);break}a&&kt&&wn.alternate===null&&d(Ce,kt),_e=L(wn,_e,Vt),Dt===null?wt=wn:Dt.sibling=wn,Dt=wn,kt=Vr}if(Vt===Ne.length)return _(Ce,kt),Zn&&Kc(Ce,Vt),wt;if(kt===null){for(;Vt<Ne.length;Vt++)kt=$e(Ce,Ne[Vt],tt),kt!==null&&(_e=L(kt,_e,Vt),Dt===null?wt=kt:Dt.sibling=kt,Dt=kt);return Zn&&Kc(Ce,Vt),wt}for(kt=T(Ce,kt);Vt<Ne.length;Vt++)Vr=_t(kt,Ce,Vt,Ne[Vt],tt),Vr!==null&&(a&&Vr.alternate!==null&&kt.delete(Vr.key===null?Vt:Vr.key),_e=L(Vr,_e,Vt),Dt===null?wt=Vr:Dt.sibling=Vr,Dt=Vr);return a&&kt.forEach(function(Io){return d(Ce,Io)}),Zn&&Kc(Ce,Vt),wt}function Rt(Ce,_e,Ne,tt){var wt=De(Ne);if(typeof wt!="function")throw Error(f(150));if(Ne=wt.call(Ne),Ne==null)throw Error(f(151));for(var Dt=wt=null,kt=_e,Vt=_e=0,Vr=null,wn=Ne.next();kt!==null&&!wn.done;Vt++,wn=Ne.next()){kt.index>Vt?(Vr=kt,kt=null):Vr=kt.sibling;var Io=Qe(Ce,kt,wn.value,tt);if(Io===null){kt===null&&(kt=Vr);break}a&&kt&&Io.alternate===null&&d(Ce,kt),_e=L(Io,_e,Vt),Dt===null?wt=Io:Dt.sibling=Io,Dt=Io,kt=Vr}if(wn.done)return _(Ce,kt),Zn&&Kc(Ce,Vt),wt;if(kt===null){for(;!wn.done;Vt++,wn=Ne.next())wn=$e(Ce,wn.value,tt),wn!==null&&(_e=L(wn,_e,Vt),Dt===null?wt=wn:Dt.sibling=wn,Dt=wn);return Zn&&Kc(Ce,Vt),wt}for(kt=T(Ce,kt);!wn.done;Vt++,wn=Ne.next())wn=_t(kt,Ce,Vt,wn.value,tt),wn!==null&&(a&&wn.alternate!==null&&kt.delete(wn.key===null?Vt:wn.key),_e=L(wn,_e,Vt),Dt===null?wt=wn:Dt.sibling=wn,Dt=wn);return a&&kt.forEach(function(BC){return d(Ce,BC)}),Zn&&Kc(Ce,Vt),wt}function lr(Ce,_e,Ne,tt){if(typeof Ne=="object"&&Ne!==null&&Ne.type===Se&&Ne.key===null&&(Ne=Ne.props.children),typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case de:e:{for(var wt=Ne.key,Dt=_e;Dt!==null;){if(Dt.key===wt){if(wt=Ne.type,wt===Se){if(Dt.tag===7){_(Ce,Dt.sibling),_e=b(Dt,Ne.props.children),_e.return=Ce,Ce=_e;break e}}else if(Dt.elementType===wt||typeof wt=="object"&&wt!==null&&wt.$$typeof===Xe&&t_(wt)===Dt.type){_(Ce,Dt.sibling),_e=b(Dt,Ne.props),_e.ref=Ou(Ce,Dt,Ne),_e.return=Ce,Ce=_e;break e}_(Ce,Dt);break}else d(Ce,Dt);Dt=Dt.sibling}Ne.type===Se?(_e=pc(Ne.props.children,Ce.mode,tt,Ne.key),_e.return=Ce,Ce=_e):(tt=dd(Ne.type,Ne.key,Ne.props,null,Ce.mode,tt),tt.ref=Ou(Ce,_e,Ne),tt.return=Ce,Ce=tt)}return Y(Ce);case be:e:{for(Dt=Ne.key;_e!==null;){if(_e.key===Dt)if(_e.tag===4&&_e.stateNode.containerInfo===Ne.containerInfo&&_e.stateNode.implementation===Ne.implementation){_(Ce,_e.sibling),_e=b(_e,Ne.children||[]),_e.return=Ce,Ce=_e;break e}else{_(Ce,_e);break}else d(Ce,_e);_e=_e.sibling}_e=ud(Ne,Ce.mode,tt),_e.return=Ce,Ce=_e}return Y(Ce);case Xe:return Dt=Ne._init,lr(Ce,_e,Dt(Ne._payload),tt)}if(po(Ne))return Tt(Ce,_e,Ne,tt);if(De(Ne))return Rt(Ce,_e,Ne,tt);fp(Ce,Ne)}return typeof Ne=="string"&&Ne!==""||typeof Ne=="number"?(Ne=""+Ne,_e!==null&&_e.tag===6?(_(Ce,_e.sibling),_e=b(_e,Ne),_e.return=Ce,Ce=_e):(_(Ce,_e),_e=Hp(Ne,Ce.mode,tt),_e.return=Ce,Ce=_e),Y(Ce)):_(Ce,_e)}return lr}var $l=Lv(!0),n_=Lv(!1),mp=Gs(null),_p=null,ed=null,r_=null;function i_(){r_=ed=_p=null}function s_(a){var d=mp.current;Wn(mp),a._currentValue=d}function gp(a,d,_){for(;a!==null;){var T=a.alternate;if((a.childLanes&d)!==d?(a.childLanes|=d,T!==null&&(T.childLanes|=d)):T!==null&&(T.childLanes&d)!==d&&(T.childLanes|=d),a===_)break;a=a.return}}function Ks(a,d){_p=a,r_=ed=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&d)!==0&&(Fi=!0),a.firstContext=null)}function ms(a){var d=a._currentValue;if(r_!==a)if(a={context:a,memoizedValue:d,next:null},ed===null){if(_p===null)throw Error(f(308));ed=a,_p.dependencies={lanes:0,firstContext:a}}else ed=ed.next=a;return d}var Yc=null;function o_(a){Yc===null?Yc=[a]:Yc.push(a)}function a_(a,d,_,T){var b=d.interleaved;return b===null?(_.next=_,o_(d)):(_.next=b.next,b.next=_),d.interleaved=_,na(a,T)}function na(a,d){a.lanes|=d;var _=a.alternate;for(_!==null&&(_.lanes|=d),_=a,a=a.return;a!==null;)a.childLanes|=d,_=a.alternate,_!==null&&(_.childLanes|=d),_=a,a=a.return;return _.tag===3?_.stateNode:null}var ra=!1;function c_(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xv(a,d){a=a.updateQueue,d.updateQueue===a&&(d.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function ia(a,d){return{eventTime:a,lane:d,tag:0,payload:null,callback:null,next:null}}function zs(a,d,_){var T=a.updateQueue;if(T===null)return null;if(T=T.shared,(ln&2)!==0){var b=T.pending;return b===null?d.next=d:(d.next=b.next,b.next=d),T.pending=d,na(a,_)}return b=T.interleaved,b===null?(d.next=d,o_(T)):(d.next=b.next,b.next=d),T.interleaved=d,na(a,_)}function Ep(a,d,_){if(d=d.updateQueue,d!==null&&(d=d.shared,(_&4194240)!==0)){var T=d.lanes;T&=a.pendingLanes,_|=T,d.lanes=_,Sm(a,_)}}function Mv(a,d){var _=a.updateQueue,T=a.alternate;if(T!==null&&(T=T.updateQueue,_===T)){var b=null,L=null;if(_=_.firstBaseUpdate,_!==null){do{var Y={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};L===null?b=L=Y:L=L.next=Y,_=_.next}while(_!==null);L===null?b=L=d:L=L.next=d}else b=L=d;_={baseState:T.baseState,firstBaseUpdate:b,lastBaseUpdate:L,shared:T.shared,effects:T.effects},a.updateQueue=_;return}a=_.lastBaseUpdate,a===null?_.firstBaseUpdate=d:a.next=d,_.lastBaseUpdate=d}function vp(a,d,_,T){var b=a.updateQueue;ra=!1;var L=b.firstBaseUpdate,Y=b.lastBaseUpdate,oe=b.shared.pending;if(oe!==null){b.shared.pending=null;var pe=oe,Le=pe.next;pe.next=null,Y===null?L=Le:Y.next=Le,Y=pe;var Ze=a.alternate;Ze!==null&&(Ze=Ze.updateQueue,oe=Ze.lastBaseUpdate,oe!==Y&&(oe===null?Ze.firstBaseUpdate=Le:oe.next=Le,Ze.lastBaseUpdate=pe))}if(L!==null){var $e=b.baseState;Y=0,Ze=Le=pe=null,oe=L;do{var Qe=oe.lane,_t=oe.eventTime;if((T&Qe)===Qe){Ze!==null&&(Ze=Ze.next={eventTime:_t,lane:0,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null});e:{var Tt=a,Rt=oe;switch(Qe=d,_t=_,Rt.tag){case 1:if(Tt=Rt.payload,typeof Tt=="function"){$e=Tt.call(_t,$e,Qe);break e}$e=Tt;break e;case 3:Tt.flags=Tt.flags&-65537|128;case 0:if(Tt=Rt.payload,Qe=typeof Tt=="function"?Tt.call(_t,$e,Qe):Tt,Qe==null)break e;$e=ze({},$e,Qe);break e;case 2:ra=!0}}oe.callback!==null&&oe.lane!==0&&(a.flags|=64,Qe=b.effects,Qe===null?b.effects=[oe]:Qe.push(oe))}else _t={eventTime:_t,lane:Qe,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},Ze===null?(Le=Ze=_t,pe=$e):Ze=Ze.next=_t,Y|=Qe;if(oe=oe.next,oe===null){if(oe=b.shared.pending,oe===null)break;Qe=oe,oe=Qe.next,Qe.next=null,b.lastBaseUpdate=Qe,b.shared.pending=null}}while(!0);if(Ze===null&&(pe=$e),b.baseState=pe,b.firstBaseUpdate=Le,b.lastBaseUpdate=Ze,d=b.shared.interleaved,d!==null){b=d;do Y|=b.lane,b=b.next;while(b!==d)}else L===null&&(b.shared.lanes=0);tl|=Y,a.lanes=Y,a.memoizedState=$e}}function Uv(a,d,_){if(a=d.effects,d.effects=null,a!==null)for(d=0;d<a.length;d++){var T=a[d],b=T.callback;if(b!==null){if(T.callback=null,T=_,typeof b!="function")throw Error(f(191,b));b.call(T)}}}var Nu={},To=Gs(Nu),qc=Gs(Nu),Pu=Gs(Nu);function tc(a){if(a===Nu)throw Error(f(174));return a}function l_(a,d){switch(Yn(Pu,d),Yn(qc,a),Yn(To,Nu),a=d.nodeType,a){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:zr(null,"");break;default:a=a===8?d.parentNode:d,d=a.namespaceURI||null,a=a.tagName,d=zr(d,a)}Wn(To),Yn(To,d)}function Xc(){Wn(To),Wn(qc),Wn(Pu)}function Vv(a){tc(Pu.current);var d=tc(To.current),_=zr(d,a.type);d!==_&&(Yn(qc,a),Yn(To,_))}function d_(a){qc.current===a&&(Wn(To),Wn(qc))}var ar=Gs(0);function Sp(a){for(var d=a;d!==null;){if(d.tag===13){var _=d.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var u_=[];function h_(){for(var a=0;a<u_.length;a++)u_[a]._workInProgressVersionPrimary=null;u_.length=0}var Du=ne.ReactCurrentDispatcher,p_=ne.ReactCurrentBatchConfig,Jc=0,rr=null,xr=null,Sr=null,ku=!1,sa=!1,Lu=0,wC=0;function di(){throw Error(f(321))}function f_(a,d){if(d===null)return!1;for(var _=0;_<d.length&&_<a.length;_++)if(!Bs(a[_],d[_]))return!1;return!0}function td(a,d,_,T,b,L){if(Jc=L,rr=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Du.current=a===null||a.memoizedState===null?IC:Yv,a=_(T,b),sa){L=0;do{if(sa=!1,Lu=0,25<=L)throw Error(f(301));L+=1,Sr=xr=null,d.updateQueue=null,Du.current=AC,a=_(T,b)}while(sa)}if(Du.current=rd,d=xr!==null&&xr.next!==null,Jc=0,Sr=xr=rr=null,ku=!1,d)throw Error(f(300));return a}function m_(){var a=Lu!==0;return Lu=0,a}function Ys(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Sr===null?rr.memoizedState=Sr=a:Sr=Sr.next=a,Sr}function ji(){if(xr===null){var a=rr.alternate;a=a!==null?a.memoizedState:null}else a=xr.next;var d=Sr===null?rr.memoizedState:Sr.next;if(d!==null)Sr=d,xr=a;else{if(a===null)throw Error(f(310));xr=a,a={memoizedState:xr.memoizedState,baseState:xr.baseState,baseQueue:xr.baseQueue,queue:xr.queue,next:null},Sr===null?rr.memoizedState=Sr=a:Sr=Sr.next=a}return Sr}function Qc(a,d){return typeof d=="function"?d(a):d}function __(a){var d=ji(),_=d.queue;if(_===null)throw Error(f(311));_.lastRenderedReducer=a;var T=xr,b=T.baseQueue,L=_.pending;if(L!==null){if(b!==null){var Y=b.next;b.next=L.next,L.next=Y}T.baseQueue=b=L,_.pending=null}if(b!==null){L=b.next,T=T.baseState;var oe=Y=null,pe=null,Le=L;do{var Ze=Le.lane;if((Jc&Ze)===Ze)pe!==null&&(pe=pe.next={lane:0,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null}),T=Le.hasEagerState?Le.eagerState:a(T,Le.action);else{var $e={lane:Ze,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null};pe===null?(oe=pe=$e,Y=T):pe=pe.next=$e,rr.lanes|=Ze,tl|=Ze}Le=Le.next}while(Le!==null&&Le!==L);pe===null?Y=T:pe.next=oe,Bs(T,d.memoizedState)||(Fi=!0),d.memoizedState=T,d.baseState=Y,d.baseQueue=pe,_.lastRenderedState=T}if(a=_.interleaved,a!==null){b=a;do L=b.lane,rr.lanes|=L,tl|=L,b=b.next;while(b!==a)}else b===null&&(_.lanes=0);return[d.memoizedState,_.dispatch]}function g_(a){var d=ji(),_=d.queue;if(_===null)throw Error(f(311));_.lastRenderedReducer=a;var T=_.dispatch,b=_.pending,L=d.memoizedState;if(b!==null){_.pending=null;var Y=b=b.next;do L=a(L,Y.action),Y=Y.next;while(Y!==b);Bs(L,d.memoizedState)||(Fi=!0),d.memoizedState=L,d.baseQueue===null&&(d.baseState=L),_.lastRenderedState=L}return[L,T]}function jv(){}function Fv(a,d){var _=rr,T=ji(),b=d(),L=!Bs(T.memoizedState,b);if(L&&(T.memoizedState=b,Fi=!0),T=T.queue,Cp(Wv.bind(null,_,T,a),[a]),T.getSnapshot!==d||L||Sr!==null&&Sr.memoizedState.tag&1){if(_.flags|=2048,oa(9,xu.bind(null,_,T,b,d),void 0,null),Mr===null)throw Error(f(349));(Jc&30)!==0||Bv(_,d,b)}return b}function Bv(a,d,_){a.flags|=16384,a={getSnapshot:d,value:_},d=rr.updateQueue,d===null?(d={lastEffect:null,stores:null},rr.updateQueue=d,d.stores=[a]):(_=d.stores,_===null?d.stores=[a]:_.push(a))}function xu(a,d,_,T){d.value=_,d.getSnapshot=T,Zc(d)&&yp(a)}function Wv(a,d,_){return _(function(){Zc(d)&&yp(a)})}function Zc(a){var d=a.getSnapshot;a=a.value;try{var _=d();return!Bs(a,_)}catch{return!0}}function yp(a){var d=na(a,1);d!==null&&ns(d,a,1,-1)}function Mu(a){var d=Ys();return typeof a=="function"&&(a=a()),d.memoizedState=d.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qc,lastRenderedState:a},d.queue=a,a=a.dispatch=$c.bind(null,rr,a),[d.memoizedState,a]}function oa(a,d,_,T){return a={tag:a,create:d,destroy:_,deps:T,next:null},d=rr.updateQueue,d===null?(d={lastEffect:null,stores:null},rr.updateQueue=d,d.lastEffect=a.next=a):(_=d.lastEffect,_===null?d.lastEffect=a.next=a:(T=_.next,_.next=a,a.next=T,d.lastEffect=a)),a}function Uu(){return ji().memoizedState}function Tp(a,d,_,T){var b=Ys();rr.flags|=a,b.memoizedState=oa(1|d,_,void 0,T===void 0?null:T)}function Vu(a,d,_,T){var b=ji();T=T===void 0?null:T;var L=void 0;if(xr!==null){var Y=xr.memoizedState;if(L=Y.destroy,T!==null&&f_(T,Y.deps)){b.memoizedState=oa(d,_,L,T);return}}rr.flags|=a,b.memoizedState=oa(1|d,_,L,T)}function Gv(a,d){return Tp(8390656,8,a,d)}function Cp(a,d){return Vu(2048,8,a,d)}function Hv(a,d){return Vu(4,2,a,d)}function Kv(a,d){return Vu(4,4,a,d)}function Rp(a,d){if(typeof d=="function")return a=a(),d(a),function(){d(null)};if(d!=null)return a=a(),d.current=a,function(){d.current=null}}function wp(a,d,_){return _=_!=null?_.concat([a]):null,Vu(4,4,Rp.bind(null,d,a),_)}function E_(){}function zv(a,d){var _=ji();d=d===void 0?null:d;var T=_.memoizedState;return T!==null&&d!==null&&f_(d,T[1])?T[0]:(_.memoizedState=[a,d],a)}function v_(a,d){var _=ji();d=d===void 0?null:d;var T=_.memoizedState;return T!==null&&d!==null&&f_(d,T[1])?T[0]:(a=a(),_.memoizedState=[a,d],a)}function bp(a,d,_){return(Jc&21)===0?(a.baseState&&(a.baseState=!1,Fi=!0),a.memoizedState=_):(Bs(_,d)||(_=QE(),rr.lanes|=_,tl|=_,a.baseState=!0),d)}function bC(a,d){var _=On;On=_!==0&&4>_?_:4,a(!0);var T=p_.transition;p_.transition={};try{a(!1),d()}finally{On=_,p_.transition=T}}function qs(){return ji().memoizedState}function nd(a,d,_){var T=cc(a);if(_={lane:T,action:_,hasEagerState:!1,eagerState:null,next:null},S_(a))y_(d,_);else if(_=a_(a,d,_,T),_!==null){var b=Ii();ns(_,a,T,b),nc(_,d,T)}}function $c(a,d,_){var T=cc(a),b={lane:T,action:_,hasEagerState:!1,eagerState:null,next:null};if(S_(a))y_(d,b);else{var L=a.alternate;if(a.lanes===0&&(L===null||L.lanes===0)&&(L=d.lastRenderedReducer,L!==null))try{var Y=d.lastRenderedState,oe=L(Y,_);if(b.hasEagerState=!0,b.eagerState=oe,Bs(oe,Y)){var pe=d.interleaved;pe===null?(b.next=b,o_(d)):(b.next=pe.next,pe.next=b),d.interleaved=b;return}}catch{}finally{}_=a_(a,d,b,T),_!==null&&(b=Ii(),ns(_,a,T,b),nc(_,d,T))}}function S_(a){var d=a.alternate;return a===rr||d!==null&&d===rr}function y_(a,d){sa=ku=!0;var _=a.pending;_===null?d.next=d:(d.next=_.next,_.next=d),a.pending=d}function nc(a,d,_){if((_&4194240)!==0){var T=d.lanes;T&=a.pendingLanes,_|=T,d.lanes=_,Sm(a,_)}}var rd={readContext:ms,useCallback:di,useContext:di,useEffect:di,useImperativeHandle:di,useInsertionEffect:di,useLayoutEffect:di,useMemo:di,useReducer:di,useRef:di,useState:di,useDebugValue:di,useDeferredValue:di,useTransition:di,useMutableSource:di,useSyncExternalStore:di,useId:di,unstable_isNewReconciler:!1},IC={readContext:ms,useCallback:function(a,d){return Ys().memoizedState=[a,d===void 0?null:d],a},useContext:ms,useEffect:Gv,useImperativeHandle:function(a,d,_){return _=_!=null?_.concat([a]):null,Tp(4194308,4,Rp.bind(null,d,a),_)},useLayoutEffect:function(a,d){return Tp(4194308,4,a,d)},useInsertionEffect:function(a,d){return Tp(4,2,a,d)},useMemo:function(a,d){var _=Ys();return d=d===void 0?null:d,a=a(),_.memoizedState=[a,d],a},useReducer:function(a,d,_){var T=Ys();return d=_!==void 0?_(d):d,T.memoizedState=T.baseState=d,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:d},T.queue=a,a=a.dispatch=nd.bind(null,rr,a),[T.memoizedState,a]},useRef:function(a){var d=Ys();return a={current:a},d.memoizedState=a},useState:Mu,useDebugValue:E_,useDeferredValue:function(a){return Ys().memoizedState=a},useTransition:function(){var a=Mu(!1),d=a[0];return a=bC.bind(null,a[1]),Ys().memoizedState=a,[d,a]},useMutableSource:function(){},useSyncExternalStore:function(a,d,_){var T=rr,b=Ys();if(Zn){if(_===void 0)throw Error(f(407));_=_()}else{if(_=d(),Mr===null)throw Error(f(349));(Jc&30)!==0||Bv(T,d,_)}b.memoizedState=_;var L={value:_,getSnapshot:d};return b.queue=L,Gv(Wv.bind(null,T,L,a),[a]),T.flags|=2048,oa(9,xu.bind(null,T,L,_,d),void 0,null),_},useId:function(){var a=Ys(),d=Mr.identifierPrefix;if(Zn){var _=ta,T=ea;_=(T&~(1<<32-Fs(T)-1)).toString(32)+_,d=":"+d+"R"+_,_=Lu++,0<_&&(d+="H"+_.toString(32)),d+=":"}else _=wC++,d=":"+d+"r"+_.toString(32)+":";return a.memoizedState=d},unstable_isNewReconciler:!1},Yv={readContext:ms,useCallback:zv,useContext:ms,useEffect:Cp,useImperativeHandle:wp,useInsertionEffect:Hv,useLayoutEffect:Kv,useMemo:v_,useReducer:__,useRef:Uu,useState:function(){return __(Qc)},useDebugValue:E_,useDeferredValue:function(a){var d=ji();return bp(d,xr.memoizedState,a)},useTransition:function(){var a=__(Qc)[0],d=ji().memoizedState;return[a,d]},useMutableSource:jv,useSyncExternalStore:Fv,useId:qs,unstable_isNewReconciler:!1},AC={readContext:ms,useCallback:zv,useContext:ms,useEffect:Cp,useImperativeHandle:wp,useInsertionEffect:Hv,useLayoutEffect:Kv,useMemo:v_,useReducer:g_,useRef:Uu,useState:function(){return g_(Qc)},useDebugValue:E_,useDeferredValue:function(a){var d=ji();return xr===null?d.memoizedState=a:bp(d,xr.memoizedState,a)},useTransition:function(){var a=g_(Qc)[0],d=ji().memoizedState;return[a,d]},useMutableSource:jv,useSyncExternalStore:Fv,useId:qs,unstable_isNewReconciler:!1};function _s(a,d){if(a&&a.defaultProps){d=ze({},d),a=a.defaultProps;for(var _ in a)d[_]===void 0&&(d[_]=a[_]);return d}return d}function Ip(a,d,_,T){d=a.memoizedState,_=_(T,d),_=_==null?d:ze({},d,_),a.memoizedState=_,a.lanes===0&&(a.updateQueue.baseState=_)}var Ap={isMounted:function(a){return(a=a._reactInternals)?jc(a)===a:!1},enqueueSetState:function(a,d,_){a=a._reactInternals;var T=Ii(),b=cc(a),L=ia(T,b);L.payload=d,_!=null&&(L.callback=_),d=zs(a,L,b),d!==null&&(ns(d,a,b,T),Ep(d,a,b))},enqueueReplaceState:function(a,d,_){a=a._reactInternals;var T=Ii(),b=cc(a),L=ia(T,b);L.tag=1,L.payload=d,_!=null&&(L.callback=_),d=zs(a,L,b),d!==null&&(ns(d,a,b,T),Ep(d,a,b))},enqueueForceUpdate:function(a,d){a=a._reactInternals;var _=Ii(),T=cc(a),b=ia(_,T);b.tag=2,d!=null&&(b.callback=d),d=zs(a,b,T),d!==null&&(ns(d,a,T,_),Ep(d,a,T))}};function aa(a,d,_,T,b,L,Y){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(T,L,Y):d.prototype&&d.prototype.isPureReactComponent?!Bl(_,T)||!Bl(b,L):!0}function qv(a,d,_){var T=!1,b=Ja,L=d.contextType;return typeof L=="object"&&L!==null?L=ms(L):(b=Vi(d)?Qa:li.current,T=d.contextTypes,L=(T=T!=null)?Za(a,b):Ja),d=new d(_,L),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ap,a.stateNode=d,d._reactInternals=a,T&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=L),d}function Xv(a,d,_,T){a=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(_,T),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(_,T),d.state!==a&&Ap.enqueueReplaceState(d,d.state,null)}function T_(a,d,_,T){var b=a.stateNode;b.props=_,b.state=a.memoizedState,b.refs={},c_(a);var L=d.contextType;typeof L=="object"&&L!==null?b.context=ms(L):(L=Vi(d)?Qa:li.current,b.context=Za(a,L)),b.state=a.memoizedState,L=d.getDerivedStateFromProps,typeof L=="function"&&(Ip(a,d,L,_),b.state=a.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(d=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),d!==b.state&&Ap.enqueueReplaceState(b,b.state,null),vp(a,_,b,T),b.state=a.memoizedState),typeof b.componentDidMount=="function"&&(a.flags|=4194308)}function id(a,d){try{var _="",T=d;do _+=Ot(T),T=T.return;while(T);var b=_}catch(L){b=`
Error generating stack: `+L.message+`
`+L.stack}return{value:a,source:d,stack:b,digest:null}}function Op(a,d,_){return{value:a,source:null,stack:_??null,digest:d??null}}function C_(a,d){try{console.error(d.value)}catch(_){setTimeout(function(){throw _})}}var R_=typeof WeakMap=="function"?WeakMap:Map;function w_(a,d,_){_=ia(-1,_),_.tag=3,_.payload={element:null};var T=d.value;return _.callback=function(){hi||(hi=!0,H_=T),C_(a,d)},_}function Jv(a,d,_){_=ia(-1,_),_.tag=3;var T=a.type.getDerivedStateFromError;if(typeof T=="function"){var b=d.value;_.payload=function(){return T(b)},_.callback=function(){C_(a,d)}}var L=a.stateNode;return L!==null&&typeof L.componentDidCatch=="function"&&(_.callback=function(){C_(a,d),typeof T!="function"&&(oc===null?oc=new Set([this]):oc.add(this));var Y=d.stack;this.componentDidCatch(d.value,{componentStack:Y!==null?Y:""})}),_}function b_(a,d,_){var T=a.pingCache;if(T===null){T=a.pingCache=new R_;var b=new Set;T.set(d,b)}else b=T.get(d),b===void 0&&(b=new Set,T.set(d,b));b.has(_)||(b.add(_),a=fS.bind(null,a,d,_),d.then(a,a))}function Qv(a){do{var d;if((d=a.tag===13)&&(d=a.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return a;a=a.return}while(a!==null);return null}function Zv(a,d,_,T,b){return(a.mode&1)===0?(a===d?a.flags|=65536:(a.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:(d=ia(-1,1),d.tag=2,zs(_,d,1))),_.lanes|=1),a):(a.flags|=65536,a.lanes=b,a)}var OC=ne.ReactCurrentOwner,Fi=!1;function bi(a,d,_,T){d.child=a===null?n_(d,null,_,T):$l(d,a.child,_,T)}function $v(a,d,_,T,b){_=_.render;var L=d.ref;return Ks(d,b),T=td(a,d,_,T,L,b),_=m_(),a!==null&&!Fi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~b,ca(a,d,b)):(Zn&&_&&Jl(d),d.flags|=1,bi(a,d,T,b),d.child)}function eS(a,d,_,T,b){if(a===null){var L=_.type;return typeof L=="function"&&!eg(L)&&L.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?(d.tag=15,d.type=L,I_(a,d,L,T,b)):(a=dd(_.type,null,T,d,d.mode,b),a.ref=d.ref,a.return=d,d.child=a)}if(L=a.child,(a.lanes&b)===0){var Y=L.memoizedProps;if(_=_.compare,_=_!==null?_:Bl,_(Y,T)&&a.ref===d.ref)return ca(a,d,b)}return d.flags|=1,a=hc(L,T),a.ref=d.ref,a.return=d,d.child=a}function I_(a,d,_,T,b){if(a!==null){var L=a.memoizedProps;if(Bl(L,T)&&a.ref===d.ref)if(Fi=!1,d.pendingProps=T=L,(a.lanes&b)!==0)(a.flags&131072)!==0&&(Fi=!0);else return d.lanes=a.lanes,ca(a,d,b)}return A_(a,d,_,T,b)}function Co(a,d,_){var T=d.pendingProps,b=T.children,L=a!==null?a.memoizedState:null;if(T.mode==="hidden")if((d.mode&1)===0)d.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yn(sd,ts),ts|=_;else{if((_&1073741824)===0)return a=L!==null?L.baseLanes|_:_,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:a,cachePool:null,transitions:null},d.updateQueue=null,Yn(sd,ts),ts|=a,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},T=L!==null?L.baseLanes:_,Yn(sd,ts),ts|=T}else L!==null?(T=L.baseLanes|_,d.memoizedState=null):T=_,Yn(sd,ts),ts|=T;return bi(a,d,b,_),d.child}function tS(a,d){var _=d.ref;(a===null&&_!==null||a!==null&&a.ref!==_)&&(d.flags|=512,d.flags|=2097152)}function A_(a,d,_,T,b){var L=Vi(_)?Qa:li.current;return L=Za(d,L),Ks(d,b),_=td(a,d,_,T,L,b),T=m_(),a!==null&&!Fi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~b,ca(a,d,b)):(Zn&&T&&Jl(d),d.flags|=1,bi(a,d,_,b),d.child)}function nS(a,d,_,T,b){if(Vi(_)){var L=!0;lp(d)}else L=!1;if(Ks(d,b),d.stateNode===null)Dp(a,d),qv(d,_,T),T_(d,_,T,b),T=!0;else if(a===null){var Y=d.stateNode,oe=d.memoizedProps;Y.props=oe;var pe=Y.context,Le=_.contextType;typeof Le=="object"&&Le!==null?Le=ms(Le):(Le=Vi(_)?Qa:li.current,Le=Za(d,Le));var Ze=_.getDerivedStateFromProps,$e=typeof Ze=="function"||typeof Y.getSnapshotBeforeUpdate=="function";$e||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(oe!==T||pe!==Le)&&Xv(d,Y,T,Le),ra=!1;var Qe=d.memoizedState;Y.state=Qe,vp(d,T,Y,b),pe=d.memoizedState,oe!==T||Qe!==pe||Ri.current||ra?(typeof Ze=="function"&&(Ip(d,_,Ze,T),pe=d.memoizedState),(oe=ra||aa(d,_,oe,T,Qe,pe,Le))?($e||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount()),typeof Y.componentDidMount=="function"&&(d.flags|=4194308)):(typeof Y.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=T,d.memoizedState=pe),Y.props=T,Y.state=pe,Y.context=Le,T=oe):(typeof Y.componentDidMount=="function"&&(d.flags|=4194308),T=!1)}else{Y=d.stateNode,xv(a,d),oe=d.memoizedProps,Le=d.type===d.elementType?oe:_s(d.type,oe),Y.props=Le,$e=d.pendingProps,Qe=Y.context,pe=_.contextType,typeof pe=="object"&&pe!==null?pe=ms(pe):(pe=Vi(_)?Qa:li.current,pe=Za(d,pe));var _t=_.getDerivedStateFromProps;(Ze=typeof _t=="function"||typeof Y.getSnapshotBeforeUpdate=="function")||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(oe!==$e||Qe!==pe)&&Xv(d,Y,T,pe),ra=!1,Qe=d.memoizedState,Y.state=Qe,vp(d,T,Y,b);var Tt=d.memoizedState;oe!==$e||Qe!==Tt||Ri.current||ra?(typeof _t=="function"&&(Ip(d,_,_t,T),Tt=d.memoizedState),(Le=ra||aa(d,_,Le,T,Qe,Tt,pe)||!1)?(Ze||typeof Y.UNSAFE_componentWillUpdate!="function"&&typeof Y.componentWillUpdate!="function"||(typeof Y.componentWillUpdate=="function"&&Y.componentWillUpdate(T,Tt,pe),typeof Y.UNSAFE_componentWillUpdate=="function"&&Y.UNSAFE_componentWillUpdate(T,Tt,pe)),typeof Y.componentDidUpdate=="function"&&(d.flags|=4),typeof Y.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof Y.componentDidUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=1024),d.memoizedProps=T,d.memoizedState=Tt),Y.props=T,Y.state=Tt,Y.context=pe,T=Le):(typeof Y.componentDidUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||oe===a.memoizedProps&&Qe===a.memoizedState||(d.flags|=1024),T=!1)}return O_(a,d,_,T,L,b)}function O_(a,d,_,T,b,L){tS(a,d);var Y=(d.flags&128)!==0;if(!T&&!Y)return b&&Nv(d,_,!1),ca(a,d,L);T=d.stateNode,OC.current=d;var oe=Y&&typeof _.getDerivedStateFromError!="function"?null:T.render();return d.flags|=1,a!==null&&Y?(d.child=$l(d,a.child,null,L),d.child=$l(d,null,oe,L)):bi(a,d,oe,L),d.memoizedState=T.state,b&&Nv(d,_,!0),d.child}function rS(a){var d=a.stateNode;d.pendingContext?ql(a,d.pendingContext,d.pendingContext!==d.context):d.context&&ql(a,d.context,!1),l_(a,d.containerInfo)}function iS(a,d,_,T,b){return zc(),Zl(b),d.flags|=256,bi(a,d,_,T),d.child}var ju={dehydrated:null,treeContext:null,retryLane:0};function N_(a){return{baseLanes:a,cachePool:null,transitions:null}}function sS(a,d,_){var T=d.pendingProps,b=ar.current,L=!1,Y=(d.flags&128)!==0,oe;if((oe=Y)||(oe=a!==null&&a.memoizedState===null?!1:(b&2)!==0),oe?(L=!0,d.flags&=-129):(a===null||a.memoizedState!==null)&&(b|=1),Yn(ar,b&1),a===null)return Iu(d),a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((d.mode&1)===0?d.lanes=1:a.data==="$!"?d.lanes=8:d.lanes=1073741824,null):(Y=T.children,a=T.fallback,L?(T=d.mode,L=d.child,Y={mode:"hidden",children:Y},(T&1)===0&&L!==null?(L.childLanes=0,L.pendingProps=Y):L=Ju(Y,T,0,null),a=pc(a,T,_,null),L.return=d,a.return=d,L.sibling=a,d.child=L,d.child.memoizedState=N_(_),d.memoizedState=ju,a):P_(d,Y));if(b=a.memoizedState,b!==null&&(oe=b.dehydrated,oe!==null))return NC(a,d,Y,T,oe,b,_);if(L){L=T.fallback,Y=d.mode,b=a.child,oe=b.sibling;var pe={mode:"hidden",children:T.children};return(Y&1)===0&&d.child!==b?(T=d.child,T.childLanes=0,T.pendingProps=pe,d.deletions=null):(T=hc(b,pe),T.subtreeFlags=b.subtreeFlags&14680064),oe!==null?L=hc(oe,L):(L=pc(L,Y,_,null),L.flags|=2),L.return=d,T.return=d,T.sibling=L,d.child=T,T=L,L=d.child,Y=a.child.memoizedState,Y=Y===null?N_(_):{baseLanes:Y.baseLanes|_,cachePool:null,transitions:Y.transitions},L.memoizedState=Y,L.childLanes=a.childLanes&~_,d.memoizedState=ju,T}return L=a.child,a=L.sibling,T=hc(L,{mode:"visible",children:T.children}),(d.mode&1)===0&&(T.lanes=_),T.return=d,T.sibling=null,a!==null&&(_=d.deletions,_===null?(d.deletions=[a],d.flags|=16):_.push(a)),d.child=T,d.memoizedState=null,T}function P_(a,d){return d=Ju({mode:"visible",children:d},a.mode,0,null),d.return=a,a.child=d}function Np(a,d,_,T){return T!==null&&Zl(T),$l(d,a.child,null,_),a=P_(d,d.pendingProps.children),a.flags|=2,d.memoizedState=null,a}function NC(a,d,_,T,b,L,Y){if(_)return d.flags&256?(d.flags&=-257,T=Op(Error(f(422))),Np(a,d,Y,T)):d.memoizedState!==null?(d.child=a.child,d.flags|=128,null):(L=T.fallback,b=d.mode,T=Ju({mode:"visible",children:T.children},b,0,null),L=pc(L,b,Y,null),L.flags|=2,T.return=d,L.return=d,T.sibling=L,d.child=T,(d.mode&1)!==0&&$l(d,a.child,null,Y),d.child.memoizedState=N_(Y),d.memoizedState=ju,L);if((d.mode&1)===0)return Np(a,d,Y,null);if(b.data==="$!"){if(T=b.nextSibling&&b.nextSibling.dataset,T)var oe=T.dgst;return T=oe,L=Error(f(419)),T=Op(L,T,void 0),Np(a,d,Y,T)}if(oe=(Y&a.childLanes)!==0,Fi||oe){if(T=Mr,T!==null){switch(Y&-Y){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=(b&(T.suspendedLanes|Y))!==0?0:b,b!==0&&b!==L.retryLane&&(L.retryLane=b,na(a,b),ns(T,a,b,-1))}return cd(),T=Op(Error(f(421))),Np(a,d,Y,T)}return b.data==="$?"?(d.flags|=128,d.child=a.child,d=VC.bind(null,a),b._reactRetry=d,null):(a=L.treeContext,$i=So(b.nextSibling),Zi=d,Zn=!0,Hs=null,a!==null&&(wi[fs++]=ea,wi[fs++]=ta,wi[fs++]=Hc,ea=a.id,ta=a.overflow,Hc=d),d=P_(d,T.children),d.flags|=4096,d)}function oS(a,d,_){a.lanes|=d;var T=a.alternate;T!==null&&(T.lanes|=d),gp(a.return,d,_)}function Pp(a,d,_,T,b){var L=a.memoizedState;L===null?a.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:T,tail:_,tailMode:b}:(L.isBackwards=d,L.rendering=null,L.renderingStartTime=0,L.last=T,L.tail=_,L.tailMode=b)}function D_(a,d,_){var T=d.pendingProps,b=T.revealOrder,L=T.tail;if(bi(a,d,T.children,_),T=ar.current,(T&2)!==0)T=T&1|2,d.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=d.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&oS(a,_,d);else if(a.tag===19)oS(a,_,d);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===d)break e;for(;a.sibling===null;){if(a.return===null||a.return===d)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}T&=1}if(Yn(ar,T),(d.mode&1)===0)d.memoizedState=null;else switch(b){case"forwards":for(_=d.child,b=null;_!==null;)a=_.alternate,a!==null&&Sp(a)===null&&(b=_),_=_.sibling;_=b,_===null?(b=d.child,d.child=null):(b=_.sibling,_.sibling=null),Pp(d,!1,b,_,L);break;case"backwards":for(_=null,b=d.child,d.child=null;b!==null;){if(a=b.alternate,a!==null&&Sp(a)===null){d.child=b;break}a=b.sibling,b.sibling=_,_=b,b=a}Pp(d,!0,_,null,L);break;case"together":Pp(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Dp(a,d){(d.mode&1)===0&&a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2)}function ca(a,d,_){if(a!==null&&(d.dependencies=a.dependencies),tl|=d.lanes,(_&d.childLanes)===0)return null;if(a!==null&&d.child!==a.child)throw Error(f(153));if(d.child!==null){for(a=d.child,_=hc(a,a.pendingProps),d.child=_,_.return=d;a.sibling!==null;)a=a.sibling,_=_.sibling=hc(a,a.pendingProps),_.return=d;_.sibling=null}return d.child}function kp(a,d,_){switch(d.tag){case 3:rS(d),zc();break;case 5:Vv(d);break;case 1:Vi(d.type)&&lp(d);break;case 4:l_(d,d.stateNode.containerInfo);break;case 10:var T=d.type._context,b=d.memoizedProps.value;Yn(mp,T._currentValue),T._currentValue=b;break;case 13:if(T=d.memoizedState,T!==null)return T.dehydrated!==null?(Yn(ar,ar.current&1),d.flags|=128,null):(_&d.child.childLanes)!==0?sS(a,d,_):(Yn(ar,ar.current&1),a=ca(a,d,_),a!==null?a.sibling:null);Yn(ar,ar.current&1);break;case 19:if(T=(_&d.childLanes)!==0,(a.flags&128)!==0){if(T)return D_(a,d,_);d.flags|=128}if(b=d.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Yn(ar,ar.current),T)break;return null;case 22:case 23:return d.lanes=0,Co(a,d,_)}return ca(a,d,_)}var Lp,xp,Fu,k_;Lp=function(a,d){for(var _=d.child;_!==null;){if(_.tag===5||_.tag===6)a.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===d)break;for(;_.sibling===null;){if(_.return===null||_.return===d)return;_=_.return}_.sibling.return=_.return,_=_.sibling}},xp=function(){},Fu=function(a,d,_,T){var b=a.memoizedProps;if(b!==T){a=d.stateNode,tc(To.current);var L=null;switch(_){case"input":b=Zd(a,b),T=Zd(a,T),L=[];break;case"select":b=ze({},b,{value:void 0}),T=ze({},T,{value:void 0}),L=[];break;case"textarea":b=bl(a,b),T=bl(a,T),L=[];break;default:typeof b.onClick!="function"&&typeof T.onClick=="function"&&(a.onclick=Cu)}fo(_,T);var Y;_=null;for(Le in b)if(!T.hasOwnProperty(Le)&&b.hasOwnProperty(Le)&&b[Le]!=null)if(Le==="style"){var oe=b[Le];for(Y in oe)oe.hasOwnProperty(Y)&&(_||(_={}),_[Y]="")}else Le!=="dangerouslySetInnerHTML"&&Le!=="children"&&Le!=="suppressContentEditableWarning"&&Le!=="suppressHydrationWarning"&&Le!=="autoFocus"&&(S.hasOwnProperty(Le)?L||(L=[]):(L=L||[]).push(Le,null));for(Le in T){var pe=T[Le];if(oe=b?.[Le],T.hasOwnProperty(Le)&&pe!==oe&&(pe!=null||oe!=null))if(Le==="style")if(oe){for(Y in oe)!oe.hasOwnProperty(Y)||pe&&pe.hasOwnProperty(Y)||(_||(_={}),_[Y]="");for(Y in pe)pe.hasOwnProperty(Y)&&oe[Y]!==pe[Y]&&(_||(_={}),_[Y]=pe[Y])}else _||(L||(L=[]),L.push(Le,_)),_=pe;else Le==="dangerouslySetInnerHTML"?(pe=pe?pe.__html:void 0,oe=oe?oe.__html:void 0,pe!=null&&oe!==pe&&(L=L||[]).push(Le,pe)):Le==="children"?typeof pe!="string"&&typeof pe!="number"||(L=L||[]).push(Le,""+pe):Le!=="suppressContentEditableWarning"&&Le!=="suppressHydrationWarning"&&(S.hasOwnProperty(Le)?(pe!=null&&Le==="onScroll"&&zn("scroll",a),L||oe===pe||(L=[])):(L=L||[]).push(Le,pe))}_&&(L=L||[]).push("style",_);var Le=L;(d.updateQueue=Le)&&(d.flags|=4)}},k_=function(a,d,_,T){_!==T&&(d.flags|=4)};function Bu(a,d){if(!Zn)switch(a.tailMode){case"hidden":d=a.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?a.tail=null:_.sibling=null;break;case"collapsed":_=a.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?d||a.tail===null?a.tail=null:a.tail.sibling=null:T.sibling=null}}function $r(a){var d=a.alternate!==null&&a.alternate.child===a.child,_=0,T=0;if(d)for(var b=a.child;b!==null;)_|=b.lanes|b.childLanes,T|=b.subtreeFlags&14680064,T|=b.flags&14680064,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)_|=b.lanes|b.childLanes,T|=b.subtreeFlags,T|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=T,a.childLanes=_,d}function Mp(a,d,_){var T=d.pendingProps;switch(pp(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $r(d),null;case 1:return Vi(d.type)&&cp(),$r(d),null;case 3:return T=d.stateNode,Xc(),Wn(Ri),Wn(li),h_(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(a===null||a.child===null)&&(Ql(d)?d.flags|=4:a===null||a.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Hs!==null&&(z_(Hs),Hs=null))),xp(a,d),$r(d),null;case 5:d_(d);var b=tc(Pu.current);if(_=d.type,a!==null&&d.stateNode!=null)Fu(a,d,_,T,b),a.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!T){if(d.stateNode===null)throw Error(f(166));return $r(d),null}if(a=tc(To.current),Ql(d)){T=d.stateNode,_=d.type;var L=d.memoizedProps;switch(T[yo]=d,T[Ru]=L,a=(d.mode&1)!==0,_){case"dialog":zn("cancel",T),zn("close",T);break;case"iframe":case"object":case"embed":zn("load",T);break;case"video":case"audio":for(b=0;b<vu.length;b++)zn(vu[b],T);break;case"source":zn("error",T);break;case"img":case"image":case"link":zn("error",T),zn("load",T);break;case"details":zn("toggle",T);break;case"input":Fh(T,L),zn("invalid",T);break;case"select":T._wrapperState={wasMultiple:!!L.multiple},zn("invalid",T);break;case"textarea":Ms(T,L),zn("invalid",T)}fo(_,L),b=null;for(var Y in L)if(L.hasOwnProperty(Y)){var oe=L[Y];Y==="children"?typeof oe=="string"?T.textContent!==oe&&(L.suppressHydrationWarning!==!0&&Tu(T.textContent,oe,a),b=["children",oe]):typeof oe=="number"&&T.textContent!==""+oe&&(L.suppressHydrationWarning!==!0&&Tu(T.textContent,oe,a),b=["children",""+oe]):S.hasOwnProperty(Y)&&oe!=null&&Y==="onScroll"&&zn("scroll",T)}switch(_){case"input":hs(T),pr(T,L,!0);break;case"textarea":hs(T),eu(T);break;case"select":case"option":break;default:typeof L.onClick=="function"&&(T.onclick=Cu)}T=b,d.updateQueue=T,T!==null&&(d.flags|=4)}else{Y=b.nodeType===9?b:b.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=ci(_)),a==="http://www.w3.org/1999/xhtml"?_==="script"?(a=Y.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof T.is=="string"?a=Y.createElement(_,{is:T.is}):(a=Y.createElement(_),_==="select"&&(Y=a,T.multiple?Y.multiple=!0:T.size&&(Y.size=T.size))):a=Y.createElementNS(a,_),a[yo]=d,a[Ru]=T,Lp(a,d,!1,!1),d.stateNode=a;e:{switch(Y=ru(_,T),_){case"dialog":zn("cancel",a),zn("close",a),b=T;break;case"iframe":case"object":case"embed":zn("load",a),b=T;break;case"video":case"audio":for(b=0;b<vu.length;b++)zn(vu[b],a);b=T;break;case"source":zn("error",a),b=T;break;case"img":case"image":case"link":zn("error",a),zn("load",a),b=T;break;case"details":zn("toggle",a),b=T;break;case"input":Fh(a,T),b=Zd(a,T),zn("invalid",a);break;case"option":b=T;break;case"select":a._wrapperState={wasMultiple:!!T.multiple},b=ze({},T,{value:void 0}),zn("invalid",a);break;case"textarea":Ms(a,T),b=bl(a,T),zn("invalid",a);break;default:b=T}fo(_,b),oe=b;for(L in oe)if(oe.hasOwnProperty(L)){var pe=oe[L];L==="style"?Ti(a,pe):L==="dangerouslySetInnerHTML"?(pe=pe?pe.__html:void 0,pe!=null&&Il(a,pe)):L==="children"?typeof pe=="string"?(_!=="textarea"||pe!=="")&&Us(a,pe):typeof pe=="number"&&Us(a,""+pe):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(S.hasOwnProperty(L)?pe!=null&&L==="onScroll"&&zn("scroll",a):pe!=null&&le(a,L,pe,Y))}switch(_){case"input":hs(a),pr(a,T,!1);break;case"textarea":hs(a),eu(a);break;case"option":T.value!=null&&a.setAttribute("value",""+pn(T.value));break;case"select":a.multiple=!!T.multiple,L=T.value,L!=null?ki(a,!!T.multiple,L,!1):T.defaultValue!=null&&ki(a,!!T.multiple,T.defaultValue,!0);break;default:typeof b.onClick=="function"&&(a.onclick=Cu)}switch(_){case"button":case"input":case"select":case"textarea":T=!!T.autoFocus;break e;case"img":T=!0;break e;default:T=!1}}T&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return $r(d),null;case 6:if(a&&d.stateNode!=null)k_(a,d,a.memoizedProps,T);else{if(typeof T!="string"&&d.stateNode===null)throw Error(f(166));if(_=tc(Pu.current),tc(To.current),Ql(d)){if(T=d.stateNode,_=d.memoizedProps,T[yo]=d,(L=T.nodeValue!==_)&&(a=Zi,a!==null))switch(a.tag){case 3:Tu(T.nodeValue,_,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Tu(T.nodeValue,_,(a.mode&1)!==0)}L&&(d.flags|=4)}else T=(_.nodeType===9?_:_.ownerDocument).createTextNode(T),T[yo]=d,d.stateNode=T}return $r(d),null;case 13:if(Wn(ar),T=d.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(Zn&&$i!==null&&(d.mode&1)!==0&&(d.flags&128)===0)e_(),zc(),d.flags|=98560,L=!1;else if(L=Ql(d),T!==null&&T.dehydrated!==null){if(a===null){if(!L)throw Error(f(318));if(L=d.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(f(317));L[yo]=d}else zc(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;$r(d),L=!1}else Hs!==null&&(z_(Hs),Hs=null),L=!0;if(!L)return d.flags&65536?d:null}return(d.flags&128)!==0?(d.lanes=_,d):(T=T!==null,T!==(a!==null&&a.memoizedState!==null)&&T&&(d.child.flags|=8192,(d.mode&1)!==0&&(a===null||(ar.current&1)!==0?Ur===0&&(Ur=3):cd())),d.updateQueue!==null&&(d.flags|=4),$r(d),null);case 4:return Xc(),xp(a,d),a===null&&Jo(d.stateNode.containerInfo),$r(d),null;case 10:return s_(d.type._context),$r(d),null;case 17:return Vi(d.type)&&cp(),$r(d),null;case 19:if(Wn(ar),L=d.memoizedState,L===null)return $r(d),null;if(T=(d.flags&128)!==0,Y=L.rendering,Y===null)if(T)Bu(L,!1);else{if(Ur!==0||a!==null&&(a.flags&128)!==0)for(a=d.child;a!==null;){if(Y=Sp(a),Y!==null){for(d.flags|=128,Bu(L,!1),T=Y.updateQueue,T!==null&&(d.updateQueue=T,d.flags|=4),d.subtreeFlags=0,T=_,_=d.child;_!==null;)L=_,a=T,L.flags&=14680066,Y=L.alternate,Y===null?(L.childLanes=0,L.lanes=a,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=Y.childLanes,L.lanes=Y.lanes,L.child=Y.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=Y.memoizedProps,L.memoizedState=Y.memoizedState,L.updateQueue=Y.updateQueue,L.type=Y.type,a=Y.dependencies,L.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),_=_.sibling;return Yn(ar,ar.current&1|2),d.child}a=a.sibling}L.tail!==null&&vr()>gs&&(d.flags|=128,T=!0,Bu(L,!1),d.lanes=4194304)}else{if(!T)if(a=Sp(Y),a!==null){if(d.flags|=128,T=!0,_=a.updateQueue,_!==null&&(d.updateQueue=_,d.flags|=4),Bu(L,!0),L.tail===null&&L.tailMode==="hidden"&&!Y.alternate&&!Zn)return $r(d),null}else 2*vr()-L.renderingStartTime>gs&&_!==1073741824&&(d.flags|=128,T=!0,Bu(L,!1),d.lanes=4194304);L.isBackwards?(Y.sibling=d.child,d.child=Y):(_=L.last,_!==null?_.sibling=Y:d.child=Y,L.last=Y)}return L.tail!==null?(d=L.tail,L.rendering=d,L.tail=d.sibling,L.renderingStartTime=vr(),d.sibling=null,_=ar.current,Yn(ar,T?_&1|2:_&1),d):($r(d),null);case 22:case 23:return qu(),T=d.memoizedState!==null,a!==null&&a.memoizedState!==null!==T&&(d.flags|=8192),T&&(d.mode&1)!==0?(ts&1073741824)!==0&&($r(d),d.subtreeFlags&6&&(d.flags|=8192)):$r(d),null;case 24:return null;case 25:return null}throw Error(f(156,d.tag))}function PC(a,d){switch(pp(d),d.tag){case 1:return Vi(d.type)&&cp(),a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 3:return Xc(),Wn(Ri),Wn(li),h_(),a=d.flags,(a&65536)!==0&&(a&128)===0?(d.flags=a&-65537|128,d):null;case 5:return d_(d),null;case 13:if(Wn(ar),a=d.memoizedState,a!==null&&a.dehydrated!==null){if(d.alternate===null)throw Error(f(340));zc()}return a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 19:return Wn(ar),null;case 4:return Xc(),null;case 10:return s_(d.type._context),null;case 22:case 23:return qu(),null;case 24:return null;default:return null}}var Wu=!1,ei=!1,DC=typeof WeakSet=="function"?WeakSet:Set,Et=null;function el(a,d){var _=a.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(T){cr(a,d,T)}else _.current=null}function L_(a,d,_){try{_()}catch(T){cr(a,d,T)}}var aS=!1;function kC(a,d){if(Ym=Xh,a=jm(),Fm(a)){if("selectionStart"in a)var _={start:a.selectionStart,end:a.selectionEnd};else e:{_=(_=a.ownerDocument)&&_.defaultView||window;var T=_.getSelection&&_.getSelection();if(T&&T.rangeCount!==0){_=T.anchorNode;var b=T.anchorOffset,L=T.focusNode;T=T.focusOffset;try{_.nodeType,L.nodeType}catch{_=null;break e}var Y=0,oe=-1,pe=-1,Le=0,Ze=0,$e=a,Qe=null;t:for(;;){for(var _t;$e!==_||b!==0&&$e.nodeType!==3||(oe=Y+b),$e!==L||T!==0&&$e.nodeType!==3||(pe=Y+T),$e.nodeType===3&&(Y+=$e.nodeValue.length),(_t=$e.firstChild)!==null;)Qe=$e,$e=_t;for(;;){if($e===a)break t;if(Qe===_&&++Le===b&&(oe=Y),Qe===L&&++Ze===T&&(pe=Y),(_t=$e.nextSibling)!==null)break;$e=Qe,Qe=$e.parentNode}$e=_t}_=oe===-1||pe===-1?null:{start:oe,end:pe}}else _=null}_=_||{start:0,end:0}}else _=null;for(sp={focusedElem:a,selectionRange:_},Xh=!1,Et=d;Et!==null;)if(d=Et,a=d.child,(d.subtreeFlags&1028)!==0&&a!==null)a.return=d,Et=a;else for(;Et!==null;){d=Et;try{var Tt=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if(Tt!==null){var Rt=Tt.memoizedProps,lr=Tt.memoizedState,Ce=d.stateNode,_e=Ce.getSnapshotBeforeUpdate(d.elementType===d.type?Rt:_s(d.type,Rt),lr);Ce.__reactInternalSnapshotBeforeUpdate=_e}break;case 3:var Ne=d.stateNode.containerInfo;Ne.nodeType===1?Ne.textContent="":Ne.nodeType===9&&Ne.documentElement&&Ne.removeChild(Ne.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(f(163))}}catch(tt){cr(d,d.return,tt)}if(a=d.sibling,a!==null){a.return=d.return,Et=a;break}Et=d.return}return Tt=aS,aS=!1,Tt}function rc(a,d,_){var T=d.updateQueue;if(T=T!==null?T.lastEffect:null,T!==null){var b=T=T.next;do{if((b.tag&a)===a){var L=b.destroy;b.destroy=void 0,L!==void 0&&L_(d,_,L)}b=b.next}while(b!==T)}}function Up(a,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var _=d=d.next;do{if((_.tag&a)===a){var T=_.create;_.destroy=T()}_=_.next}while(_!==d)}}function x_(a){var d=a.ref;if(d!==null){var _=a.stateNode;switch(a.tag){case 5:a=_;break;default:a=_}typeof d=="function"?d(a):d.current=a}}function cS(a){var d=a.alternate;d!==null&&(a.alternate=null,cS(d)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(d=a.stateNode,d!==null&&(delete d[yo],delete d[Ru],delete d[Xm],delete d[TC],delete d[CC])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function M_(a){return a.tag===5||a.tag===3||a.tag===4}function lS(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||M_(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function U_(a,d,_){var T=a.tag;if(T===5||T===6)a=a.stateNode,d?_.nodeType===8?_.parentNode.insertBefore(a,d):_.insertBefore(a,d):(_.nodeType===8?(d=_.parentNode,d.insertBefore(a,_)):(d=_,d.appendChild(a)),_=_._reactRootContainer,_!=null||d.onclick!==null||(d.onclick=Cu));else if(T!==4&&(a=a.child,a!==null))for(U_(a,d,_),a=a.sibling;a!==null;)U_(a,d,_),a=a.sibling}function Gu(a,d,_){var T=a.tag;if(T===5||T===6)a=a.stateNode,d?_.insertBefore(a,d):_.appendChild(a);else if(T!==4&&(a=a.child,a!==null))for(Gu(a,d,_),a=a.sibling;a!==null;)Gu(a,d,_),a=a.sibling}var ti=null,es=!1;function ic(a,d,_){for(_=_.child;_!==null;)V_(a,d,_),_=_.sibling}function V_(a,d,_){if(Eo&&typeof Eo.onCommitFiberUnmount=="function")try{Eo.onCommitFiberUnmount(Nl,_)}catch{}switch(_.tag){case 5:ei||el(_,d);case 6:var T=ti,b=es;ti=null,ic(a,d,_),ti=T,es=b,ti!==null&&(es?(a=ti,_=_.stateNode,a.nodeType===8?a.parentNode.removeChild(_):a.removeChild(_)):ti.removeChild(_.stateNode));break;case 18:ti!==null&&(es?(a=ti,_=_.stateNode,a.nodeType===8?op(a.parentNode,_):a.nodeType===1&&op(a,_),Ll(a)):op(ti,_.stateNode));break;case 4:T=ti,b=es,ti=_.stateNode.containerInfo,es=!0,ic(a,d,_),ti=T,es=b;break;case 0:case 11:case 14:case 15:if(!ei&&(T=_.updateQueue,T!==null&&(T=T.lastEffect,T!==null))){b=T=T.next;do{var L=b,Y=L.destroy;L=L.tag,Y!==void 0&&((L&2)!==0||(L&4)!==0)&&L_(_,d,Y),b=b.next}while(b!==T)}ic(a,d,_);break;case 1:if(!ei&&(el(_,d),T=_.stateNode,typeof T.componentWillUnmount=="function"))try{T.props=_.memoizedProps,T.state=_.memoizedState,T.componentWillUnmount()}catch(oe){cr(_,d,oe)}ic(a,d,_);break;case 21:ic(a,d,_);break;case 22:_.mode&1?(ei=(T=ei)||_.memoizedState!==null,ic(a,d,_),ei=T):ic(a,d,_);break;default:ic(a,d,_)}}function dS(a){var d=a.updateQueue;if(d!==null){a.updateQueue=null;var _=a.stateNode;_===null&&(_=a.stateNode=new DC),d.forEach(function(T){var b=ld.bind(null,a,T);_.has(T)||(_.add(T),T.then(b,b))})}}function Xs(a,d){var _=d.deletions;if(_!==null)for(var T=0;T<_.length;T++){var b=_[T];try{var L=a,Y=d,oe=Y;e:for(;oe!==null;){switch(oe.tag){case 5:ti=oe.stateNode,es=!1;break e;case 3:ti=oe.stateNode.containerInfo,es=!0;break e;case 4:ti=oe.stateNode.containerInfo,es=!0;break e}oe=oe.return}if(ti===null)throw Error(f(160));V_(L,Y,b),ti=null,es=!1;var pe=b.alternate;pe!==null&&(pe.return=null),b.return=null}catch(Le){cr(b,d,Le)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)j_(d,a),d=d.sibling}function j_(a,d){var _=a.alternate,T=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Xs(d,a),Ro(a),T&4){try{rc(3,a,a.return),Up(3,a)}catch(Rt){cr(a,a.return,Rt)}try{rc(5,a,a.return)}catch(Rt){cr(a,a.return,Rt)}}break;case 1:Xs(d,a),Ro(a),T&512&&_!==null&&el(_,_.return);break;case 5:if(Xs(d,a),Ro(a),T&512&&_!==null&&el(_,_.return),a.flags&32){var b=a.stateNode;try{Us(b,"")}catch(Rt){cr(a,a.return,Rt)}}if(T&4&&(b=a.stateNode,b!=null)){var L=a.memoizedProps,Y=_!==null?_.memoizedProps:L,oe=a.type,pe=a.updateQueue;if(a.updateQueue=null,pe!==null)try{oe==="input"&&L.type==="radio"&&L.name!=null&&ps(b,L),ru(oe,Y);var Le=ru(oe,L);for(Y=0;Y<pe.length;Y+=2){var Ze=pe[Y],$e=pe[Y+1];Ze==="style"?Ti(b,$e):Ze==="dangerouslySetInnerHTML"?Il(b,$e):Ze==="children"?Us(b,$e):le(b,Ze,$e,Le)}switch(oe){case"input":$d(b,L);break;case"textarea":Ar(b,L);break;case"select":var Qe=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!L.multiple;var _t=L.value;_t!=null?ki(b,!!L.multiple,_t,!1):Qe!==!!L.multiple&&(L.defaultValue!=null?ki(b,!!L.multiple,L.defaultValue,!0):ki(b,!!L.multiple,L.multiple?[]:"",!1))}b[Ru]=L}catch(Rt){cr(a,a.return,Rt)}}break;case 6:if(Xs(d,a),Ro(a),T&4){if(a.stateNode===null)throw Error(f(162));b=a.stateNode,L=a.memoizedProps;try{b.nodeValue=L}catch(Rt){cr(a,a.return,Rt)}}break;case 3:if(Xs(d,a),Ro(a),T&4&&_!==null&&_.memoizedState.isDehydrated)try{Ll(d.containerInfo)}catch(Rt){cr(a,a.return,Rt)}break;case 4:Xs(d,a),Ro(a);break;case 13:Xs(d,a),Ro(a),b=a.child,b.flags&8192&&(L=b.memoizedState!==null,b.stateNode.isHidden=L,!L||b.alternate!==null&&b.alternate.memoizedState!==null||(G_=vr())),T&4&&dS(a);break;case 22:if(Ze=_!==null&&_.memoizedState!==null,a.mode&1?(ei=(Le=ei)||Ze,Xs(d,a),ei=Le):Xs(d,a),Ro(a),T&8192){if(Le=a.memoizedState!==null,(a.stateNode.isHidden=Le)&&!Ze&&(a.mode&1)!==0)for(Et=a,Ze=a.child;Ze!==null;){for($e=Et=Ze;Et!==null;){switch(Qe=Et,_t=Qe.child,Qe.tag){case 0:case 11:case 14:case 15:rc(4,Qe,Qe.return);break;case 1:el(Qe,Qe.return);var Tt=Qe.stateNode;if(typeof Tt.componentWillUnmount=="function"){T=Qe,_=Qe.return;try{d=T,Tt.props=d.memoizedProps,Tt.state=d.memoizedState,Tt.componentWillUnmount()}catch(Rt){cr(T,_,Rt)}}break;case 5:el(Qe,Qe.return);break;case 22:if(Qe.memoizedState!==null){Vp($e);continue}}_t!==null?(_t.return=Qe,Et=_t):Vp($e)}Ze=Ze.sibling}e:for(Ze=null,$e=a;;){if($e.tag===5){if(Ze===null){Ze=$e;try{b=$e.stateNode,Le?(L=b.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none"):(oe=$e.stateNode,pe=$e.memoizedProps.style,Y=pe!=null&&pe.hasOwnProperty("display")?pe.display:null,oe.style.display=Uc("display",Y))}catch(Rt){cr(a,a.return,Rt)}}}else if($e.tag===6){if(Ze===null)try{$e.stateNode.nodeValue=Le?"":$e.memoizedProps}catch(Rt){cr(a,a.return,Rt)}}else if(($e.tag!==22&&$e.tag!==23||$e.memoizedState===null||$e===a)&&$e.child!==null){$e.child.return=$e,$e=$e.child;continue}if($e===a)break e;for(;$e.sibling===null;){if($e.return===null||$e.return===a)break e;Ze===$e&&(Ze=null),$e=$e.return}Ze===$e&&(Ze=null),$e.sibling.return=$e.return,$e=$e.sibling}}break;case 19:Xs(d,a),Ro(a),T&4&&dS(a);break;case 21:break;default:Xs(d,a),Ro(a)}}function Ro(a){var d=a.flags;if(d&2){try{e:{for(var _=a.return;_!==null;){if(M_(_)){var T=_;break e}_=_.return}throw Error(f(160))}switch(T.tag){case 5:var b=T.stateNode;T.flags&32&&(Us(b,""),T.flags&=-33);var L=lS(a);Gu(a,L,b);break;case 3:case 4:var Y=T.stateNode.containerInfo,oe=lS(a);U_(a,oe,Y);break;default:throw Error(f(161))}}catch(pe){cr(a,a.return,pe)}a.flags&=-3}d&4096&&(a.flags&=-4097)}function LC(a,d,_){Et=a,F_(a)}function F_(a,d,_){for(var T=(a.mode&1)!==0;Et!==null;){var b=Et,L=b.child;if(b.tag===22&&T){var Y=b.memoizedState!==null||Wu;if(!Y){var oe=b.alternate,pe=oe!==null&&oe.memoizedState!==null||ei;oe=Wu;var Le=ei;if(Wu=Y,(ei=pe)&&!Le)for(Et=b;Et!==null;)Y=Et,pe=Y.child,Y.tag===22&&Y.memoizedState!==null?uS(b):pe!==null?(pe.return=Y,Et=pe):uS(b);for(;L!==null;)Et=L,F_(L),L=L.sibling;Et=b,Wu=oe,ei=Le}B_(a)}else(b.subtreeFlags&8772)!==0&&L!==null?(L.return=b,Et=L):B_(a)}}function B_(a){for(;Et!==null;){var d=Et;if((d.flags&8772)!==0){var _=d.alternate;try{if((d.flags&8772)!==0)switch(d.tag){case 0:case 11:case 15:ei||Up(5,d);break;case 1:var T=d.stateNode;if(d.flags&4&&!ei)if(_===null)T.componentDidMount();else{var b=d.elementType===d.type?_.memoizedProps:_s(d.type,_.memoizedProps);T.componentDidUpdate(b,_.memoizedState,T.__reactInternalSnapshotBeforeUpdate)}var L=d.updateQueue;L!==null&&Uv(d,L,T);break;case 3:var Y=d.updateQueue;if(Y!==null){if(_=null,d.child!==null)switch(d.child.tag){case 5:_=d.child.stateNode;break;case 1:_=d.child.stateNode}Uv(d,Y,_)}break;case 5:var oe=d.stateNode;if(_===null&&d.flags&4){_=oe;var pe=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":pe.autoFocus&&_.focus();break;case"img":pe.src&&(_.src=pe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var Le=d.alternate;if(Le!==null){var Ze=Le.memoizedState;if(Ze!==null){var $e=Ze.dehydrated;$e!==null&&Ll($e)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(f(163))}ei||d.flags&512&&x_(d)}catch(Qe){cr(d,d.return,Qe)}}if(d===a){Et=null;break}if(_=d.sibling,_!==null){_.return=d.return,Et=_;break}Et=d.return}}function Vp(a){for(;Et!==null;){var d=Et;if(d===a){Et=null;break}var _=d.sibling;if(_!==null){_.return=d.return,Et=_;break}Et=d.return}}function uS(a){for(;Et!==null;){var d=Et;try{switch(d.tag){case 0:case 11:case 15:var _=d.return;try{Up(4,d)}catch(pe){cr(d,_,pe)}break;case 1:var T=d.stateNode;if(typeof T.componentDidMount=="function"){var b=d.return;try{T.componentDidMount()}catch(pe){cr(d,b,pe)}}var L=d.return;try{x_(d)}catch(pe){cr(d,L,pe)}break;case 5:var Y=d.return;try{x_(d)}catch(pe){cr(d,Y,pe)}}}catch(pe){cr(d,d.return,pe)}if(d===a){Et=null;break}var oe=d.sibling;if(oe!==null){oe.return=d.return,Et=oe;break}Et=d.return}}var xC=Math.ceil,sc=ne.ReactCurrentDispatcher,jp=ne.ReactCurrentOwner,ui=ne.ReactCurrentBatchConfig,ln=0,Mr=null,mr=null,Or=0,ts=0,sd=Gs(0),Ur=0,od=null,tl=0,Fp=0,W_=0,nl=null,yr=null,G_=0,gs=1/0,wo=null,hi=!1,H_=null,oc=null,Hu=!1,ac=null,Ku=0,ad=0,K_=null,zu=-1,Bp=0;function Ii(){return(ln&6)!==0?vr():zu!==-1?zu:zu=vr()}function cc(a){return(a.mode&1)===0?1:(ln&2)!==0&&Or!==0?Or&-Or:Au.transition!==null?(Bp===0&&(Bp=QE()),Bp):(a=On,a!==0||(a=window.event,a=a===void 0?16:nv(a.type)),a)}function ns(a,d,_,T){if(50<ad)throw ad=0,K_=null,Error(f(185));ou(a,_,T),((ln&2)===0||a!==Mr)&&(a===Mr&&((ln&2)===0&&(Fp|=_),Ur===4&&lc(a,Or)),pi(a,T),_===1&&ln===0&&(d.mode&1)===0&&(gs=vr()+500,dp&&$a()))}function pi(a,d){var _=a.callbackNode;JE(a,d);var T=Hh(a,a===Mr?Or:0);if(T===0)_!==null&&KE(_),a.callbackNode=null,a.callbackPriority=0;else if(d=T&-T,a.callbackPriority!==d){if(_!=null&&KE(_),d===1)a.tag===0?RC(Wp.bind(null,a)):Zm(Wp.bind(null,a)),SC(function(){(ln&6)===0&&$a()}),_=null;else{switch(ym(T)){case 1:_=fr;break;case 4:_=zE;break;case 16:_=Wh;break;case 536870912:_=YE;break;default:_=Wh}_=Z_(_,hS.bind(null,a))}a.callbackPriority=d,a.callbackNode=_}}function hS(a,d){if(zu=-1,Bp=0,(ln&6)!==0)throw Error(f(327));var _=a.callbackNode;if(uc()&&a.callbackNode!==_)return null;var T=Hh(a,a===Mr?Or:0);if(T===0)return null;if((T&30)!==0||(T&a.expiredLanes)!==0||d)d=Xu(a,T);else{d=T;var b=ln;ln|=2;var L=q_();(Mr!==a||Or!==d)&&(wo=null,gs=vr()+500,la(a,d));do try{UC();break}catch(oe){Y_(a,oe)}while(!0);i_(),sc.current=L,ln=b,mr!==null?d=0:(Mr=null,Or=0,d=Ur)}if(d!==0){if(d===2&&(b=Em(a),b!==0&&(T=b,d=Yu(a,b))),d===1)throw _=od,la(a,0),lc(a,T),pi(a,vr()),_;if(d===6)lc(a,T);else{if(b=a.current.alternate,(T&30)===0&&!pS(b)&&(d=Xu(a,T),d===2&&(L=Em(a),L!==0&&(T=L,d=Yu(a,L))),d===1))throw _=od,la(a,0),lc(a,T),pi(a,vr()),_;switch(a.finishedWork=b,a.finishedLanes=T,d){case 0:case 1:throw Error(f(345));case 2:Es(a,yr,wo);break;case 3:if(lc(a,T),(T&130023424)===T&&(d=G_+500-vr(),10<d)){if(Hh(a,0)!==0)break;if(b=a.suspendedLanes,(b&T)!==T){Ii(),a.pingedLanes|=a.suspendedLanes&b;break}a.timeoutHandle=qm(Es.bind(null,a,yr,wo),d);break}Es(a,yr,wo);break;case 4:if(lc(a,T),(T&4194240)===T)break;for(d=a.eventTimes,b=-1;0<T;){var Y=31-Fs(T);L=1<<Y,Y=d[Y],Y>b&&(b=Y),T&=~L}if(T=b,T=vr()-T,T=(120>T?120:480>T?480:1080>T?1080:1920>T?1920:3e3>T?3e3:4320>T?4320:1960*xC(T/1960))-T,10<T){a.timeoutHandle=qm(Es.bind(null,a,yr,wo),T);break}Es(a,yr,wo);break;case 5:Es(a,yr,wo);break;default:throw Error(f(329))}}}return pi(a,vr()),a.callbackNode===_?hS.bind(null,a):null}function Yu(a,d){var _=nl;return a.current.memoizedState.isDehydrated&&(la(a,d).flags|=256),a=Xu(a,d),a!==2&&(d=yr,yr=_,d!==null&&z_(d)),a}function z_(a){yr===null?yr=a:yr.push.apply(yr,a)}function pS(a){for(var d=a;;){if(d.flags&16384){var _=d.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var T=0;T<_.length;T++){var b=_[T],L=b.getSnapshot;b=b.value;try{if(!Bs(L(),b))return!1}catch{return!1}}}if(_=d.child,d.subtreeFlags&16384&&_!==null)_.return=d,d=_;else{if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function lc(a,d){for(d&=~W_,d&=~Fp,a.suspendedLanes|=d,a.pingedLanes&=~d,a=a.expirationTimes;0<d;){var _=31-Fs(d),T=1<<_;a[_]=-1,d&=~T}}function Wp(a){if((ln&6)!==0)throw Error(f(327));uc();var d=Hh(a,0);if((d&1)===0)return pi(a,vr()),null;var _=Xu(a,d);if(a.tag!==0&&_===2){var T=Em(a);T!==0&&(d=T,_=Yu(a,T))}if(_===1)throw _=od,la(a,0),lc(a,d),pi(a,vr()),_;if(_===6)throw Error(f(345));return a.finishedWork=a.current.alternate,a.finishedLanes=d,Es(a,yr,wo),pi(a,vr()),null}function rl(a,d){var _=ln;ln|=1;try{return a(d)}finally{ln=_,ln===0&&(gs=vr()+500,dp&&$a())}}function dc(a){ac!==null&&ac.tag===0&&(ln&6)===0&&uc();var d=ln;ln|=1;var _=ui.transition,T=On;try{if(ui.transition=null,On=1,a)return a()}finally{On=T,ui.transition=_,ln=d,(ln&6)===0&&$a()}}function qu(){ts=sd.current,Wn(sd)}function la(a,d){a.finishedWork=null,a.finishedLanes=0;var _=a.timeoutHandle;if(_!==-1&&(a.timeoutHandle=-1,vC(_)),mr!==null)for(_=mr.return;_!==null;){var T=_;switch(pp(T),T.tag){case 1:T=T.type.childContextTypes,T!=null&&cp();break;case 3:Xc(),Wn(Ri),Wn(li),h_();break;case 5:d_(T);break;case 4:Xc();break;case 13:Wn(ar);break;case 19:Wn(ar);break;case 10:s_(T.type._context);break;case 22:case 23:qu()}_=_.return}if(Mr=a,mr=a=hc(a.current,null),Or=ts=d,Ur=0,od=null,W_=Fp=tl=0,yr=nl=null,Yc!==null){for(d=0;d<Yc.length;d++)if(_=Yc[d],T=_.interleaved,T!==null){_.interleaved=null;var b=T.next,L=_.pending;if(L!==null){var Y=L.next;L.next=b,T.next=Y}_.pending=T}Yc=null}return a}function Y_(a,d){do{var _=mr;try{if(i_(),Du.current=rd,ku){for(var T=rr.memoizedState;T!==null;){var b=T.queue;b!==null&&(b.pending=null),T=T.next}ku=!1}if(Jc=0,Sr=xr=rr=null,sa=!1,Lu=0,jp.current=null,_===null||_.return===null){Ur=1,od=d,mr=null;break}e:{var L=a,Y=_.return,oe=_,pe=d;if(d=Or,oe.flags|=32768,pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var Le=pe,Ze=oe,$e=Ze.tag;if((Ze.mode&1)===0&&($e===0||$e===11||$e===15)){var Qe=Ze.alternate;Qe?(Ze.updateQueue=Qe.updateQueue,Ze.memoizedState=Qe.memoizedState,Ze.lanes=Qe.lanes):(Ze.updateQueue=null,Ze.memoizedState=null)}var _t=Qv(Y);if(_t!==null){_t.flags&=-257,Zv(_t,Y,oe,L,d),_t.mode&1&&b_(L,Le,d),d=_t,pe=Le;var Tt=d.updateQueue;if(Tt===null){var Rt=new Set;Rt.add(pe),d.updateQueue=Rt}else Tt.add(pe);break e}else{if((d&1)===0){b_(L,Le,d),cd();break e}pe=Error(f(426))}}else if(Zn&&oe.mode&1){var lr=Qv(Y);if(lr!==null){(lr.flags&65536)===0&&(lr.flags|=256),Zv(lr,Y,oe,L,d),Zl(id(pe,oe));break e}}L=pe=id(pe,oe),Ur!==4&&(Ur=2),nl===null?nl=[L]:nl.push(L),L=Y;do{switch(L.tag){case 3:L.flags|=65536,d&=-d,L.lanes|=d;var Ce=w_(L,pe,d);Mv(L,Ce);break e;case 1:oe=pe;var _e=L.type,Ne=L.stateNode;if((L.flags&128)===0&&(typeof _e.getDerivedStateFromError=="function"||Ne!==null&&typeof Ne.componentDidCatch=="function"&&(oc===null||!oc.has(Ne)))){L.flags|=65536,d&=-d,L.lanes|=d;var tt=Jv(L,oe,d);Mv(L,tt);break e}}L=L.return}while(L!==null)}J_(_)}catch(wt){d=wt,mr===_&&_!==null&&(mr=_=_.return);continue}break}while(!0)}function q_(){var a=sc.current;return sc.current=rd,a===null?rd:a}function cd(){(Ur===0||Ur===3||Ur===2)&&(Ur=4),Mr===null||(tl&268435455)===0&&(Fp&268435455)===0||lc(Mr,Or)}function Xu(a,d){var _=ln;ln|=2;var T=q_();(Mr!==a||Or!==d)&&(wo=null,la(a,d));do try{MC();break}catch(b){Y_(a,b)}while(!0);if(i_(),ln=_,sc.current=T,mr!==null)throw Error(f(261));return Mr=null,Or=0,Ur}function MC(){for(;mr!==null;)X_(mr)}function UC(){for(;mr!==null&&!U0();)X_(mr)}function X_(a){var d=_S(a.alternate,a,ts);a.memoizedProps=a.pendingProps,d===null?J_(a):mr=d,jp.current=null}function J_(a){var d=a;do{var _=d.alternate;if(a=d.return,(d.flags&32768)===0){if(_=Mp(_,d,ts),_!==null){mr=_;return}}else{if(_=PC(_,d),_!==null){_.flags&=32767,mr=_;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Ur=6,mr=null;return}}if(d=d.sibling,d!==null){mr=d;return}mr=d=a}while(d!==null);Ur===0&&(Ur=5)}function Es(a,d,_){var T=On,b=ui.transition;try{ui.transition=null,On=1,Q_(a,d,_,T)}finally{ui.transition=b,On=T}return null}function Q_(a,d,_,T){do uc();while(ac!==null);if((ln&6)!==0)throw Error(f(327));_=a.finishedWork;var b=a.finishedLanes;if(_===null)return null;if(a.finishedWork=null,a.finishedLanes=0,_===a.current)throw Error(f(177));a.callbackNode=null,a.callbackPriority=0;var L=_.lanes|_.childLanes;if(W0(a,L),a===Mr&&(mr=Mr=null,Or=0),(_.subtreeFlags&2064)===0&&(_.flags&2064)===0||Hu||(Hu=!0,Z_(Wh,function(){return uc(),null})),L=(_.flags&15990)!==0,(_.subtreeFlags&15990)!==0||L){L=ui.transition,ui.transition=null;var Y=On;On=1;var oe=ln;ln|=4,jp.current=null,kC(a,_),j_(_,a),fC(sp),Xh=!!Ym,sp=Ym=null,a.current=_,LC(_),go(),ln=oe,On=Y,ui.transition=L}else a.current=_;if(Hu&&(Hu=!1,ac=a,Ku=b),L=a.pendingLanes,L===0&&(oc=null),qE(_.stateNode),pi(a,vr()),d!==null)for(T=a.onRecoverableError,_=0;_<d.length;_++)b=d[_],T(b.value,{componentStack:b.stack,digest:b.digest});if(hi)throw hi=!1,a=H_,H_=null,a;return(Ku&1)!==0&&a.tag!==0&&uc(),L=a.pendingLanes,(L&1)!==0?a===K_?ad++:(ad=0,K_=a):ad=0,$a(),null}function uc(){if(ac!==null){var a=ym(Ku),d=ui.transition,_=On;try{if(ui.transition=null,On=16>a?16:a,ac===null)var T=!1;else{if(a=ac,ac=null,Ku=0,(ln&6)!==0)throw Error(f(331));var b=ln;for(ln|=4,Et=a.current;Et!==null;){var L=Et,Y=L.child;if((Et.flags&16)!==0){var oe=L.deletions;if(oe!==null){for(var pe=0;pe<oe.length;pe++){var Le=oe[pe];for(Et=Le;Et!==null;){var Ze=Et;switch(Ze.tag){case 0:case 11:case 15:rc(8,Ze,L)}var $e=Ze.child;if($e!==null)$e.return=Ze,Et=$e;else for(;Et!==null;){Ze=Et;var Qe=Ze.sibling,_t=Ze.return;if(cS(Ze),Ze===Le){Et=null;break}if(Qe!==null){Qe.return=_t,Et=Qe;break}Et=_t}}}var Tt=L.alternate;if(Tt!==null){var Rt=Tt.child;if(Rt!==null){Tt.child=null;do{var lr=Rt.sibling;Rt.sibling=null,Rt=lr}while(Rt!==null)}}Et=L}}if((L.subtreeFlags&2064)!==0&&Y!==null)Y.return=L,Et=Y;else e:for(;Et!==null;){if(L=Et,(L.flags&2048)!==0)switch(L.tag){case 0:case 11:case 15:rc(9,L,L.return)}var Ce=L.sibling;if(Ce!==null){Ce.return=L.return,Et=Ce;break e}Et=L.return}}var _e=a.current;for(Et=_e;Et!==null;){Y=Et;var Ne=Y.child;if((Y.subtreeFlags&2064)!==0&&Ne!==null)Ne.return=Y,Et=Ne;else e:for(Y=_e;Et!==null;){if(oe=Et,(oe.flags&2048)!==0)try{switch(oe.tag){case 0:case 11:case 15:Up(9,oe)}}catch(wt){cr(oe,oe.return,wt)}if(oe===Y){Et=null;break e}var tt=oe.sibling;if(tt!==null){tt.return=oe.return,Et=tt;break e}Et=oe.return}}if(ln=b,$a(),Eo&&typeof Eo.onPostCommitFiberRoot=="function")try{Eo.onPostCommitFiberRoot(Nl,a)}catch{}T=!0}return T}finally{On=_,ui.transition=d}}return!1}function Gp(a,d,_){d=id(_,d),d=w_(a,d,1),a=zs(a,d,1),d=Ii(),a!==null&&(ou(a,1,d),pi(a,d))}function cr(a,d,_){if(a.tag===3)Gp(a,a,_);else for(;d!==null;){if(d.tag===3){Gp(d,a,_);break}else if(d.tag===1){var T=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(oc===null||!oc.has(T))){a=id(_,a),a=Jv(d,a,1),d=zs(d,a,1),a=Ii(),d!==null&&(ou(d,1,a),pi(d,a));break}}d=d.return}}function fS(a,d,_){var T=a.pingCache;T!==null&&T.delete(d),d=Ii(),a.pingedLanes|=a.suspendedLanes&_,Mr===a&&(Or&_)===_&&(Ur===4||Ur===3&&(Or&130023424)===Or&&500>vr()-G_?la(a,0):W_|=_),pi(a,d)}function mS(a,d){d===0&&((a.mode&1)===0?d=1:(d=Gh,Gh<<=1,(Gh&130023424)===0&&(Gh=4194304)));var _=Ii();a=na(a,d),a!==null&&(ou(a,d,_),pi(a,_))}function VC(a){var d=a.memoizedState,_=0;d!==null&&(_=d.retryLane),mS(a,_)}function ld(a,d){var _=0;switch(a.tag){case 13:var T=a.stateNode,b=a.memoizedState;b!==null&&(_=b.retryLane);break;case 19:T=a.stateNode;break;default:throw Error(f(314))}T!==null&&T.delete(d),mS(a,_)}var _S;_S=function(a,d,_){if(a!==null)if(a.memoizedProps!==d.pendingProps||Ri.current)Fi=!0;else{if((a.lanes&_)===0&&(d.flags&128)===0)return Fi=!1,kp(a,d,_);Fi=(a.flags&131072)!==0}else Fi=!1,Zn&&(d.flags&1048576)!==0&&Pv(d,hp,d.index);switch(d.lanes=0,d.tag){case 2:var T=d.type;Dp(a,d),a=d.pendingProps;var b=Za(d,li.current);Ks(d,_),b=td(null,d,T,a,b,_);var L=m_();return d.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,Vi(T)?(L=!0,lp(d)):L=!1,d.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,c_(d),b.updater=Ap,d.stateNode=b,b._reactInternals=d,T_(d,T,a,_),d=O_(null,d,T,!0,L,_)):(d.tag=0,Zn&&L&&Jl(d),bi(null,d,b,_),d=d.child),d;case 16:T=d.elementType;e:{switch(Dp(a,d),a=d.pendingProps,b=T._init,T=b(T._payload),d.type=T,b=d.tag=jC(T),a=_s(T,a),b){case 0:d=A_(null,d,T,a,_);break e;case 1:d=nS(null,d,T,a,_);break e;case 11:d=$v(null,d,T,a,_);break e;case 14:d=eS(null,d,T,_s(T.type,a),_);break e}throw Error(f(306,T,""))}return d;case 0:return T=d.type,b=d.pendingProps,b=d.elementType===T?b:_s(T,b),A_(a,d,T,b,_);case 1:return T=d.type,b=d.pendingProps,b=d.elementType===T?b:_s(T,b),nS(a,d,T,b,_);case 3:e:{if(rS(d),a===null)throw Error(f(387));T=d.pendingProps,L=d.memoizedState,b=L.element,xv(a,d),vp(d,T,null,_);var Y=d.memoizedState;if(T=Y.element,L.isDehydrated)if(L={element:T,isDehydrated:!1,cache:Y.cache,pendingSuspenseBoundaries:Y.pendingSuspenseBoundaries,transitions:Y.transitions},d.updateQueue.baseState=L,d.memoizedState=L,d.flags&256){b=id(Error(f(423)),d),d=iS(a,d,T,_,b);break e}else if(T!==b){b=id(Error(f(424)),d),d=iS(a,d,T,_,b);break e}else for($i=So(d.stateNode.containerInfo.firstChild),Zi=d,Zn=!0,Hs=null,_=n_(d,null,T,_),d.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(zc(),T===b){d=ca(a,d,_);break e}bi(a,d,T,_)}d=d.child}return d;case 5:return Vv(d),a===null&&Iu(d),T=d.type,b=d.pendingProps,L=a!==null?a.memoizedProps:null,Y=b.children,zl(T,b)?Y=null:L!==null&&zl(T,L)&&(d.flags|=32),tS(a,d),bi(a,d,Y,_),d.child;case 6:return a===null&&Iu(d),null;case 13:return sS(a,d,_);case 4:return l_(d,d.stateNode.containerInfo),T=d.pendingProps,a===null?d.child=$l(d,null,T,_):bi(a,d,T,_),d.child;case 11:return T=d.type,b=d.pendingProps,b=d.elementType===T?b:_s(T,b),$v(a,d,T,b,_);case 7:return bi(a,d,d.pendingProps,_),d.child;case 8:return bi(a,d,d.pendingProps.children,_),d.child;case 12:return bi(a,d,d.pendingProps.children,_),d.child;case 10:e:{if(T=d.type._context,b=d.pendingProps,L=d.memoizedProps,Y=b.value,Yn(mp,T._currentValue),T._currentValue=Y,L!==null)if(Bs(L.value,Y)){if(L.children===b.children&&!Ri.current){d=ca(a,d,_);break e}}else for(L=d.child,L!==null&&(L.return=d);L!==null;){var oe=L.dependencies;if(oe!==null){Y=L.child;for(var pe=oe.firstContext;pe!==null;){if(pe.context===T){if(L.tag===1){pe=ia(-1,_&-_),pe.tag=2;var Le=L.updateQueue;if(Le!==null){Le=Le.shared;var Ze=Le.pending;Ze===null?pe.next=pe:(pe.next=Ze.next,Ze.next=pe),Le.pending=pe}}L.lanes|=_,pe=L.alternate,pe!==null&&(pe.lanes|=_),gp(L.return,_,d),oe.lanes|=_;break}pe=pe.next}}else if(L.tag===10)Y=L.type===d.type?null:L.child;else if(L.tag===18){if(Y=L.return,Y===null)throw Error(f(341));Y.lanes|=_,oe=Y.alternate,oe!==null&&(oe.lanes|=_),gp(Y,_,d),Y=L.sibling}else Y=L.child;if(Y!==null)Y.return=L;else for(Y=L;Y!==null;){if(Y===d){Y=null;break}if(L=Y.sibling,L!==null){L.return=Y.return,Y=L;break}Y=Y.return}L=Y}bi(a,d,b.children,_),d=d.child}return d;case 9:return b=d.type,T=d.pendingProps.children,Ks(d,_),b=ms(b),T=T(b),d.flags|=1,bi(a,d,T,_),d.child;case 14:return T=d.type,b=_s(T,d.pendingProps),b=_s(T.type,b),eS(a,d,T,b,_);case 15:return I_(a,d,d.type,d.pendingProps,_);case 17:return T=d.type,b=d.pendingProps,b=d.elementType===T?b:_s(T,b),Dp(a,d),d.tag=1,Vi(T)?(a=!0,lp(d)):a=!1,Ks(d,_),qv(d,T,b),T_(d,T,b,_),O_(null,d,T,!0,a,_);case 19:return D_(a,d,_);case 22:return Co(a,d,_)}throw Error(f(156,d.tag))};function Z_(a,d){return Fc(a,d)}function $_(a,d,_,T){this.tag=a,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(a,d,_,T){return new $_(a,d,_,T)}function eg(a){return a=a.prototype,!(!a||!a.isReactComponent)}function jC(a){if(typeof a=="function")return eg(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Ue)return 11;if(a===dt)return 14}return 2}function hc(a,d){var _=a.alternate;return _===null?(_=vs(a.tag,d,a.key,a.mode),_.elementType=a.elementType,_.type=a.type,_.stateNode=a.stateNode,_.alternate=a,a.alternate=_):(_.pendingProps=d,_.type=a.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=a.flags&14680064,_.childLanes=a.childLanes,_.lanes=a.lanes,_.child=a.child,_.memoizedProps=a.memoizedProps,_.memoizedState=a.memoizedState,_.updateQueue=a.updateQueue,d=a.dependencies,_.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},_.sibling=a.sibling,_.index=a.index,_.ref=a.ref,_}function dd(a,d,_,T,b,L){var Y=2;if(T=a,typeof a=="function")eg(a)&&(Y=1);else if(typeof a=="string")Y=5;else e:switch(a){case Se:return pc(_.children,b,L,d);case fe:Y=8,b|=8;break;case ye:return a=vs(12,_,d,b|2),a.elementType=ye,a.lanes=L,a;case xe:return a=vs(13,_,d,b),a.elementType=xe,a.lanes=L,a;case Ge:return a=vs(19,_,d,b),a.elementType=Ge,a.lanes=L,a;case We:return Ju(_,b,L,d);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case je:Y=10;break e;case Je:Y=9;break e;case Ue:Y=11;break e;case dt:Y=14;break e;case Xe:Y=16,T=null;break e}throw Error(f(130,a==null?a:typeof a,""))}return d=vs(Y,_,d,b),d.elementType=a,d.type=T,d.lanes=L,d}function pc(a,d,_,T){return a=vs(7,a,T,d),a.lanes=_,a}function Ju(a,d,_,T){return a=vs(22,a,T,d),a.elementType=We,a.lanes=_,a.stateNode={isHidden:!1},a}function Hp(a,d,_){return a=vs(6,a,null,d),a.lanes=_,a}function ud(a,d,_){return d=vs(4,a.children!==null?a.children:[],a.key,d),d.lanes=_,d.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},d}function tg(a,d,_,T,b){this.tag=d,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vm(0),this.expirationTimes=vm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vm(0),this.identifierPrefix=T,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function hd(a,d,_,T,b,L,Y,oe,pe){return a=new tg(a,d,_,oe,pe),d===1?(d=1,L===!0&&(d|=8)):d=0,L=vs(3,null,null,d),a.current=L,L.stateNode=a,L.memoizedState={element:T,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},c_(L),a}function Kp(a,d,_){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:be,key:T==null?null:""+T,children:a,containerInfo:d,implementation:_}}function ng(a){if(!a)return Ja;a=a._reactInternals;e:{if(jc(a)!==a||a.tag!==1)throw Error(f(170));var d=a;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(Vi(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(f(171))}if(a.tag===1){var _=a.type;if(Vi(_))return Ov(a,_,d)}return d}function il(a,d,_,T,b,L,Y,oe,pe){return a=hd(_,T,!0,a,b,L,Y,oe,pe),a.context=ng(null),_=a.current,T=Ii(),b=cc(_),L=ia(T,b),L.callback=d??null,zs(_,L,b),a.current.lanes=b,ou(a,b,T),pi(a,T),a}function bo(a,d,_,T){var b=d.current,L=Ii(),Y=cc(b);return _=ng(_),d.context===null?d.context=_:d.pendingContext=_,d=ia(L,Y),d.payload={element:a},T=T===void 0?null:T,T!==null&&(d.callback=T),a=zs(b,d,Y),a!==null&&(ns(a,b,Y,L),Ep(a,b,Y)),Y}function zp(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function pd(a,d){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var _=a.retryLane;a.retryLane=_!==0&&_<d?_:d}}function rg(a,d){pd(a,d),(a=a.alternate)&&pd(a,d)}function FC(){return null}var gS=typeof reportError=="function"?reportError:function(a){console.error(a)};function ig(a){this._internalRoot=a}Qu.prototype.render=ig.prototype.render=function(a){var d=this._internalRoot;if(d===null)throw Error(f(409));bo(a,d,null,null)},Qu.prototype.unmount=ig.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var d=a.containerInfo;dc(function(){bo(null,a,null,null)}),d[Qo]=null}};function Qu(a){this._internalRoot=a}Qu.prototype.unstable_scheduleHydration=function(a){if(a){var d=ZE();a={blockedOn:null,target:a,priority:d};for(var _=0;_<Ga.length&&d!==0&&d<Ga[_].priority;_++);Ga.splice(_,0,a),_===0&&kl(a)}};function Zu(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function $u(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function ES(){}function vS(a,d,_,T,b){if(b){if(typeof T=="function"){var L=T;T=function(){var Le=zp(Y);L.call(Le)}}var Y=il(d,T,a,0,null,!1,!1,"",ES);return a._reactRootContainer=Y,a[Qo]=Y.current,Jo(a.nodeType===8?a.parentNode:a),dc(),Y}for(;b=a.lastChild;)a.removeChild(b);if(typeof T=="function"){var oe=T;T=function(){var Le=zp(pe);oe.call(Le)}}var pe=hd(a,0,!1,null,null,!1,!1,"",ES);return a._reactRootContainer=pe,a[Qo]=pe.current,Jo(a.nodeType===8?a.parentNode:a),dc(function(){bo(d,pe,_,T)}),pe}function Yp(a,d,_,T,b){var L=_._reactRootContainer;if(L){var Y=L;if(typeof b=="function"){var oe=b;b=function(){var pe=zp(Y);oe.call(pe)}}bo(d,Y,a,b)}else Y=vS(_,d,a,b,T);return zp(Y)}Kh=function(a){switch(a.tag){case 3:var d=a.stateNode;if(d.current.memoizedState.isDehydrated){var _=An(d.pendingLanes);_!==0&&(Sm(d,_|1),pi(d,vr()),(ln&6)===0&&(gs=vr()+500,$a()))}break;case 13:dc(function(){var T=na(a,1);if(T!==null){var b=Ii();ns(T,a,1,b)}}),rg(a,1)}},Tm=function(a){if(a.tag===13){var d=na(a,134217728);if(d!==null){var _=Ii();ns(d,a,134217728,_)}rg(a,134217728)}},zh=function(a){if(a.tag===13){var d=cc(a),_=na(a,d);if(_!==null){var T=Ii();ns(_,a,d,T)}rg(a,d)}},ZE=function(){return On},Cm=function(a,d){var _=On;try{return On=a,d()}finally{On=_}},Al=function(a,d,_){switch(d){case"input":if($d(a,_),d=_.name,_.type==="radio"&&d!=null){for(_=a;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<_.length;d++){var T=_[d];if(T!==a&&T.form===a.form){var b=ap(T);if(!b)throw Error(f(90));Ma(T),$d(T,b)}}}break;case"textarea":Ar(a,_);break;case"select":d=_.value,d!=null&&ki(a,!!_.multiple,d,!1)}},fn=rl,Fn=dc;var eh={usingClientEntryPoint:!1,Events:[wu,Yl,ap,ja,Kt,rl]},Bi={findFiberByHostInstance:Gc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},SS={bundleType:Bi.bundleType,version:Bi.version,rendererPackageName:Bi.rendererPackageName,rendererConfig:Bi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ne.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Bh(a),a===null?null:a.stateNode},findFiberByHostInstance:Bi.findFiberByHostInstance||FC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qp.isDisabled&&qp.supportsFiber)try{Nl=qp.inject(SS),Eo=qp}catch{}}return ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eh,ks.createPortal=function(a,d){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zu(d))throw Error(f(200));return Kp(a,d,null,_)},ks.createRoot=function(a,d){if(!Zu(a))throw Error(f(299));var _=!1,T="",b=gS;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(T=d.identifierPrefix),d.onRecoverableError!==void 0&&(b=d.onRecoverableError)),d=hd(a,1,!1,null,null,_,!1,T,b),a[Qo]=d.current,Jo(a.nodeType===8?a.parentNode:a),new ig(d)},ks.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var d=a._reactInternals;if(d===void 0)throw typeof a.render=="function"?Error(f(188)):(a=Object.keys(a).join(","),Error(f(268,a)));return a=Bh(d),a=a===null?null:a.stateNode,a},ks.flushSync=function(a){return dc(a)},ks.hydrate=function(a,d,_){if(!$u(d))throw Error(f(200));return Yp(null,a,d,!0,_)},ks.hydrateRoot=function(a,d,_){if(!Zu(a))throw Error(f(405));var T=_!=null&&_.hydratedSources||null,b=!1,L="",Y=gS;if(_!=null&&(_.unstable_strictMode===!0&&(b=!0),_.identifierPrefix!==void 0&&(L=_.identifierPrefix),_.onRecoverableError!==void 0&&(Y=_.onRecoverableError)),d=il(d,null,a,1,_??null,b,!1,L,Y),a[Qo]=d.current,Jo(a),T)for(a=0;a<T.length;a++)_=T[a],b=_._getVersion,b=b(_._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[_,b]:d.mutableSourceEagerHydrationData.push(_,b);return new Qu(d)},ks.render=function(a,d,_){if(!$u(d))throw Error(f(200));return Yp(null,a,d,!1,_)},ks.unmountComponentAtNode=function(a){if(!$u(a))throw Error(f(40));return a._reactRootContainer?(dc(function(){Yp(null,null,a,!1,function(){a._reactRootContainer=null,a[Qo]=null})}),!0):!1},ks.unstable_batchedUpdates=rl,ks.unstable_renderSubtreeIntoContainer=function(a,d,_,T){if(!$u(_))throw Error(f(200));if(a==null||a._reactInternals===void 0)throw Error(f(38));return Yp(a,d,_,!1,T)},ks.version="18.3.1-next-f1338f8080-20240426",ks}var s4;function cj(){if(s4)return HI.exports;s4=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(h){console.error(h)}}return u(),HI.exports=pX(),HI.exports}var E0=cj();const lj=g0(E0);function oi(u,h,{checkForDefaultPrevented:f=!0}={}){return function(S){if(u?.(S),f===!1||!S.defaultPrevented)return h?.(S)}}function o4(u,h){if(typeof u=="function")return u(h);u!=null&&(u.current=h)}function dj(...u){return h=>{let f=!1;const g=u.map(S=>{const C=o4(S,h);return!f&&typeof C=="function"&&(f=!0),C});if(f)return()=>{for(let S=0;S<g.length;S++){const C=g[S];typeof C=="function"?C():o4(u[S],null)}}}}function ka(...u){return ee.useCallback(dj(...u),u)}function v0(u,h=[]){let f=[];function g(C,I){const N=ee.createContext(I),k=f.length;f=[...f,I];const M=B=>{const{scope:q,children:K,...ie}=B,X=q?.[u]?.[k]||N,te=ee.useMemo(()=>ie,Object.values(ie));return P.jsx(X.Provider,{value:te,children:K})};M.displayName=C+"Provider";function F(B,q){const K=q?.[u]?.[k]||N,ie=ee.useContext(K);if(ie)return ie;if(I!==void 0)return I;throw new Error(`\`${B}\` must be used within \`${C}\``)}return[M,F]}const S=()=>{const C=f.map(I=>ee.createContext(I));return function(N){const k=N?.[u]||C;return ee.useMemo(()=>({[`__scope${u}`]:{...N,[u]:k}}),[N,k])}};return S.scopeName=u,[g,fX(S,...h)]}function fX(...u){const h=u[0];if(u.length===1)return h;const f=()=>{const g=u.map(S=>({useScope:S(),scopeName:S.scopeName}));return function(C){const I=g.reduce((N,{useScope:k,scopeName:M})=>{const B=k(C)[`__scope${M}`];return{...N,...B}},{});return ee.useMemo(()=>({[`__scope${h.scopeName}`]:I}),[I])}};return f.scopeName=h.scopeName,f}function i1(u){const h=mX(u),f=ee.forwardRef((g,S)=>{const{children:C,...I}=g,N=ee.Children.toArray(C),k=N.find(gX);if(k){const M=k.props.children,F=N.map(B=>B===k?ee.Children.count(M)>1?ee.Children.only(null):ee.isValidElement(M)?M.props.children:null:B);return P.jsx(h,{...I,ref:S,children:ee.isValidElement(M)?ee.cloneElement(M,void 0,F):null})}return P.jsx(h,{...I,ref:S,children:C})});return f.displayName=`${u}.Slot`,f}function mX(u){const h=ee.forwardRef((f,g)=>{const{children:S,...C}=f;if(ee.isValidElement(S)){const I=vX(S),N=EX(C,S.props);return S.type!==ee.Fragment&&(N.ref=g?dj(g,I):I),ee.cloneElement(S,N)}return ee.Children.count(S)>1?ee.Children.only(null):null});return h.displayName=`${u}.SlotClone`,h}var uj=Symbol("radix.slottable");function _X(u){const h=({children:f})=>P.jsx(P.Fragment,{children:f});return h.displayName=`${u}.Slottable`,h.__radixId=uj,h}function gX(u){return ee.isValidElement(u)&&typeof u.type=="function"&&"__radixId"in u.type&&u.type.__radixId===uj}function EX(u,h){const f={...h};for(const g in h){const S=u[g],C=h[g];/^on[A-Z]/.test(g)?S&&C?f[g]=(...N)=>{const k=C(...N);return S(...N),k}:S&&(f[g]=S):g==="style"?f[g]={...S,...C}:g==="className"&&(f[g]=[S,C].filter(Boolean).join(" "))}return{...u,...f}}function vX(u){let h=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning;return f?u.ref:(h=Object.getOwnPropertyDescriptor(u,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning,f?u.props.ref:u.props.ref||u.ref)}function SX(u){const h=u+"CollectionProvider",[f,g]=v0(h),[S,C]=f(h,{collectionRef:{current:null},itemMap:new Map}),I=X=>{const{scope:te,children:ce}=X,$=it.useRef(null),le=it.useRef(new Map).current;return P.jsx(S,{scope:te,itemMap:le,collectionRef:$,children:ce})};I.displayName=h;const N=u+"CollectionSlot",k=i1(N),M=it.forwardRef((X,te)=>{const{scope:ce,children:$}=X,le=C(N,ce),ne=ka(te,le.collectionRef);return P.jsx(k,{ref:ne,children:$})});M.displayName=N;const F=u+"CollectionItemSlot",B="data-radix-collection-item",q=i1(F),K=it.forwardRef((X,te)=>{const{scope:ce,children:$,...le}=X,ne=it.useRef(null),de=ka(te,ne),be=C(F,ce);return it.useEffect(()=>(be.itemMap.set(ne,{ref:ne,...le}),()=>void be.itemMap.delete(ne))),P.jsx(q,{[B]:"",ref:de,children:$})});K.displayName=F;function ie(X){const te=C(u+"CollectionConsumer",X);return it.useCallback(()=>{const $=te.collectionRef.current;if(!$)return[];const le=Array.from($.querySelectorAll(`[${B}]`));return Array.from(te.itemMap.values()).sort((be,Se)=>le.indexOf(be.ref.current)-le.indexOf(Se.ref.current))},[te.collectionRef,te.itemMap])}return[{Provider:I,Slot:M,ItemSlot:K},ie,g]}var yX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xs=yX.reduce((u,h)=>{const f=i1(`Primitive.${h}`),g=ee.forwardRef((S,C)=>{const{asChild:I,...N}=S,k=I?f:h;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),P.jsx(k,{...N,ref:C})});return g.displayName=`Primitive.${h}`,{...u,[h]:g}},{});function hj(u,h){u&&E0.flushSync(()=>u.dispatchEvent(h))}function Yd(u){const h=ee.useRef(u);return ee.useEffect(()=>{h.current=u}),ee.useMemo(()=>(...f)=>h.current?.(...f),[])}function TX(u,h=globalThis?.document){const f=Yd(u);ee.useEffect(()=>{const g=S=>{S.key==="Escape"&&f(S)};return h.addEventListener("keydown",g,{capture:!0}),()=>h.removeEventListener("keydown",g,{capture:!0})},[f,h])}var CX="DismissableLayer",s1="dismissableLayer.update",RX="dismissableLayer.pointerDownOutside",wX="dismissableLayer.focusOutside",a4,pj=ee.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),C1=ee.forwardRef((u,h)=>{const{disableOutsidePointerEvents:f=!1,onEscapeKeyDown:g,onPointerDownOutside:S,onFocusOutside:C,onInteractOutside:I,onDismiss:N,...k}=u,M=ee.useContext(pj),[F,B]=ee.useState(null),q=F?.ownerDocument??globalThis?.document,[,K]=ee.useState({}),ie=ka(h,Se=>B(Se)),X=Array.from(M.layers),[te]=[...M.layersWithOutsidePointerEventsDisabled].slice(-1),ce=X.indexOf(te),$=F?X.indexOf(F):-1,le=M.layersWithOutsidePointerEventsDisabled.size>0,ne=$>=ce,de=IX(Se=>{const fe=Se.target,ye=[...M.branches].some(je=>je.contains(fe));!ne||ye||(S?.(Se),I?.(Se),Se.defaultPrevented||N?.())},q),be=AX(Se=>{const fe=Se.target;[...M.branches].some(je=>je.contains(fe))||(C?.(Se),I?.(Se),Se.defaultPrevented||N?.())},q);return TX(Se=>{$===M.layers.size-1&&(g?.(Se),!Se.defaultPrevented&&N&&(Se.preventDefault(),N()))},q),ee.useEffect(()=>{if(F)return f&&(M.layersWithOutsidePointerEventsDisabled.size===0&&(a4=q.body.style.pointerEvents,q.body.style.pointerEvents="none"),M.layersWithOutsidePointerEventsDisabled.add(F)),M.layers.add(F),c4(),()=>{f&&M.layersWithOutsidePointerEventsDisabled.size===1&&(q.body.style.pointerEvents=a4)}},[F,q,f,M]),ee.useEffect(()=>()=>{F&&(M.layers.delete(F),M.layersWithOutsidePointerEventsDisabled.delete(F),c4())},[F,M]),ee.useEffect(()=>{const Se=()=>K({});return document.addEventListener(s1,Se),()=>document.removeEventListener(s1,Se)},[]),P.jsx(xs.div,{...k,ref:ie,style:{pointerEvents:le?ne?"auto":"none":void 0,...u.style},onFocusCapture:oi(u.onFocusCapture,be.onFocusCapture),onBlurCapture:oi(u.onBlurCapture,be.onBlurCapture),onPointerDownCapture:oi(u.onPointerDownCapture,de.onPointerDownCapture)})});C1.displayName=CX;var bX="DismissableLayerBranch",fj=ee.forwardRef((u,h)=>{const f=ee.useContext(pj),g=ee.useRef(null),S=ka(h,g);return ee.useEffect(()=>{const C=g.current;if(C)return f.branches.add(C),()=>{f.branches.delete(C)}},[f.branches]),P.jsx(xs.div,{...u,ref:S})});fj.displayName=bX;function IX(u,h=globalThis?.document){const f=Yd(u),g=ee.useRef(!1),S=ee.useRef(()=>{});return ee.useEffect(()=>{const C=N=>{if(N.target&&!g.current){let k=function(){mj(RX,f,M,{discrete:!0})};const M={originalEvent:N};N.pointerType==="touch"?(h.removeEventListener("click",S.current),S.current=k,h.addEventListener("click",S.current,{once:!0})):k()}else h.removeEventListener("click",S.current);g.current=!1},I=window.setTimeout(()=>{h.addEventListener("pointerdown",C)},0);return()=>{window.clearTimeout(I),h.removeEventListener("pointerdown",C),h.removeEventListener("click",S.current)}},[h,f]),{onPointerDownCapture:()=>g.current=!0}}function AX(u,h=globalThis?.document){const f=Yd(u),g=ee.useRef(!1);return ee.useEffect(()=>{const S=C=>{C.target&&!g.current&&mj(wX,f,{originalEvent:C},{discrete:!1})};return h.addEventListener("focusin",S),()=>h.removeEventListener("focusin",S)},[h,f]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function c4(){const u=new CustomEvent(s1);document.dispatchEvent(u)}function mj(u,h,f,{discrete:g}){const S=f.originalEvent.target,C=new CustomEvent(u,{bubbles:!1,cancelable:!0,detail:f});h&&S.addEventListener(u,h,{once:!0}),g?hj(S,C):S.dispatchEvent(C)}var OX=C1,NX=fj,qd=globalThis?.document?ee.useLayoutEffect:()=>{},PX="Portal",_j=ee.forwardRef((u,h)=>{const{container:f,...g}=u,[S,C]=ee.useState(!1);qd(()=>C(!0),[]);const I=f||S&&globalThis?.document?.body;return I?lj.createPortal(P.jsx(xs.div,{...g,ref:h}),I):null});_j.displayName=PX;function DX(u,h){return ee.useReducer((f,g)=>h[f][g]??f,u)}var R1=u=>{const{present:h,children:f}=u,g=kX(h),S=typeof f=="function"?f({present:g.isPresent}):ee.Children.only(f),C=ka(g.ref,LX(S));return typeof f=="function"||g.isPresent?ee.cloneElement(S,{ref:C}):null};R1.displayName="Presence";function kX(u){const[h,f]=ee.useState(),g=ee.useRef(null),S=ee.useRef(u),C=ee.useRef("none"),I=u?"mounted":"unmounted",[N,k]=DX(I,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ee.useEffect(()=>{const M=KT(g.current);C.current=N==="mounted"?M:"none"},[N]),qd(()=>{const M=g.current,F=S.current;if(F!==u){const q=C.current,K=KT(M);u?k("MOUNT"):K==="none"||M?.display==="none"?k("UNMOUNT"):k(F&&q!==K?"ANIMATION_OUT":"UNMOUNT"),S.current=u}},[u,k]),qd(()=>{if(h){let M;const F=h.ownerDocument.defaultView??window,B=K=>{const X=KT(g.current).includes(K.animationName);if(K.target===h&&X&&(k("ANIMATION_END"),!S.current)){const te=h.style.animationFillMode;h.style.animationFillMode="forwards",M=F.setTimeout(()=>{h.style.animationFillMode==="forwards"&&(h.style.animationFillMode=te)})}},q=K=>{K.target===h&&(C.current=KT(g.current))};return h.addEventListener("animationstart",q),h.addEventListener("animationcancel",B),h.addEventListener("animationend",B),()=>{F.clearTimeout(M),h.removeEventListener("animationstart",q),h.removeEventListener("animationcancel",B),h.removeEventListener("animationend",B)}}else k("ANIMATION_END")},[h,k]),{isPresent:["mounted","unmountSuspended"].includes(N),ref:ee.useCallback(M=>{g.current=M?getComputedStyle(M):null,f(M)},[])}}function KT(u){return u?.animationName||"none"}function LX(u){let h=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning;return f?u.ref:(h=Object.getOwnPropertyDescriptor(u,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning,f?u.props.ref:u.props.ref||u.ref)}var xX=aj[" useInsertionEffect ".trim().toString()]||qd;function MX({prop:u,defaultProp:h,onChange:f=()=>{},caller:g}){const[S,C,I]=UX({defaultProp:h,onChange:f}),N=u!==void 0,k=N?u:S;{const F=ee.useRef(u!==void 0);ee.useEffect(()=>{const B=F.current;B!==N&&console.warn(`${g} is changing from ${B?"controlled":"uncontrolled"} to ${N?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),F.current=N},[N,g])}const M=ee.useCallback(F=>{if(N){const B=VX(F)?F(u):F;B!==u&&I.current?.(B)}else C(F)},[N,u,C,I]);return[k,M]}function UX({defaultProp:u,onChange:h}){const[f,g]=ee.useState(u),S=ee.useRef(f),C=ee.useRef(h);return xX(()=>{C.current=h},[h]),ee.useEffect(()=>{S.current!==f&&(C.current?.(f),S.current=f)},[f,S]),[f,g,C]}function VX(u){return typeof u=="function"}var jX=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),FX="VisuallyHidden",S0=ee.forwardRef((u,h)=>P.jsx(xs.span,{...u,ref:h,style:{...jX,...u.style}}));S0.displayName=FX;var BX=S0,w1="ToastProvider",[b1,WX,GX]=SX("Toast"),[gj,mne]=v0("Toast",[GX]),[HX,y0]=gj(w1),Ej=u=>{const{__scopeToast:h,label:f="Notification",duration:g=5e3,swipeDirection:S="right",swipeThreshold:C=50,children:I}=u,[N,k]=ee.useState(null),[M,F]=ee.useState(0),B=ee.useRef(!1),q=ee.useRef(!1);return f.trim()||console.error(`Invalid prop \`label\` supplied to \`${w1}\`. Expected non-empty \`string\`.`),P.jsx(b1.Provider,{scope:h,children:P.jsx(HX,{scope:h,label:f,duration:g,swipeDirection:S,swipeThreshold:C,toastCount:M,viewport:N,onViewportChange:k,onToastAdd:ee.useCallback(()=>F(K=>K+1),[]),onToastRemove:ee.useCallback(()=>F(K=>K-1),[]),isFocusedToastEscapeKeyDownRef:B,isClosePausedRef:q,children:I})})};Ej.displayName=w1;var vj="ToastViewport",KX=["F8"],o1="toast.viewportPause",a1="toast.viewportResume",Sj=ee.forwardRef((u,h)=>{const{__scopeToast:f,hotkey:g=KX,label:S="Notifications ({hotkey})",...C}=u,I=y0(vj,f),N=WX(f),k=ee.useRef(null),M=ee.useRef(null),F=ee.useRef(null),B=ee.useRef(null),q=ka(h,B,I.onViewportChange),K=g.join("+").replace(/Key/g,"").replace(/Digit/g,""),ie=I.toastCount>0;ee.useEffect(()=>{const te=ce=>{g.length!==0&&g.every(le=>ce[le]||ce.code===le)&&B.current?.focus()};return document.addEventListener("keydown",te),()=>document.removeEventListener("keydown",te)},[g]),ee.useEffect(()=>{const te=k.current,ce=B.current;if(ie&&te&&ce){const $=()=>{if(!I.isClosePausedRef.current){const be=new CustomEvent(o1);ce.dispatchEvent(be),I.isClosePausedRef.current=!0}},le=()=>{if(I.isClosePausedRef.current){const be=new CustomEvent(a1);ce.dispatchEvent(be),I.isClosePausedRef.current=!1}},ne=be=>{!te.contains(be.relatedTarget)&&le()},de=()=>{te.contains(document.activeElement)||le()};return te.addEventListener("focusin",$),te.addEventListener("focusout",ne),te.addEventListener("pointermove",$),te.addEventListener("pointerleave",de),window.addEventListener("blur",$),window.addEventListener("focus",le),()=>{te.removeEventListener("focusin",$),te.removeEventListener("focusout",ne),te.removeEventListener("pointermove",$),te.removeEventListener("pointerleave",de),window.removeEventListener("blur",$),window.removeEventListener("focus",le)}}},[ie,I.isClosePausedRef]);const X=ee.useCallback(({tabbingDirection:te})=>{const $=N().map(le=>{const ne=le.ref.current,de=[ne,...iJ(ne)];return te==="forwards"?de:de.reverse()});return(te==="forwards"?$.reverse():$).flat()},[N]);return ee.useEffect(()=>{const te=B.current;if(te){const ce=$=>{const le=$.altKey||$.ctrlKey||$.metaKey;if($.key==="Tab"&&!le){const de=document.activeElement,be=$.shiftKey;if($.target===te&&be){M.current?.focus();return}const ye=X({tabbingDirection:be?"backwards":"forwards"}),je=ye.findIndex(Je=>Je===de);YI(ye.slice(je+1))?$.preventDefault():be?M.current?.focus():F.current?.focus()}};return te.addEventListener("keydown",ce),()=>te.removeEventListener("keydown",ce)}},[N,X]),P.jsxs(NX,{ref:k,role:"region","aria-label":S.replace("{hotkey}",K),tabIndex:-1,style:{pointerEvents:ie?void 0:"none"},children:[ie&&P.jsx(c1,{ref:M,onFocusFromOutsideViewport:()=>{const te=X({tabbingDirection:"forwards"});YI(te)}}),P.jsx(b1.Slot,{scope:f,children:P.jsx(xs.ol,{tabIndex:-1,...C,ref:q})}),ie&&P.jsx(c1,{ref:F,onFocusFromOutsideViewport:()=>{const te=X({tabbingDirection:"backwards"});YI(te)}})]})});Sj.displayName=vj;var yj="ToastFocusProxy",c1=ee.forwardRef((u,h)=>{const{__scopeToast:f,onFocusFromOutsideViewport:g,...S}=u,C=y0(yj,f);return P.jsx(S0,{"aria-hidden":!0,tabIndex:0,...S,ref:h,style:{position:"fixed"},onFocus:I=>{const N=I.relatedTarget;!C.viewport?.contains(N)&&g()}})});c1.displayName=yj;var xE="Toast",zX="toast.swipeStart",YX="toast.swipeMove",qX="toast.swipeCancel",XX="toast.swipeEnd",Tj=ee.forwardRef((u,h)=>{const{forceMount:f,open:g,defaultOpen:S,onOpenChange:C,...I}=u,[N,k]=MX({prop:g,defaultProp:S??!0,onChange:C,caller:xE});return P.jsx(R1,{present:f||N,children:P.jsx(ZX,{open:N,...I,ref:h,onClose:()=>k(!1),onPause:Yd(u.onPause),onResume:Yd(u.onResume),onSwipeStart:oi(u.onSwipeStart,M=>{M.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:oi(u.onSwipeMove,M=>{const{x:F,y:B}=M.detail.delta;M.currentTarget.setAttribute("data-swipe","move"),M.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${F}px`),M.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${B}px`)}),onSwipeCancel:oi(u.onSwipeCancel,M=>{M.currentTarget.setAttribute("data-swipe","cancel"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),M.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),M.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:oi(u.onSwipeEnd,M=>{const{x:F,y:B}=M.detail.delta;M.currentTarget.setAttribute("data-swipe","end"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),M.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),M.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${F}px`),M.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${B}px`),k(!1)})})})});Tj.displayName=xE;var[JX,QX]=gj(xE,{onClose(){}}),ZX=ee.forwardRef((u,h)=>{const{__scopeToast:f,type:g="foreground",duration:S,open:C,onClose:I,onEscapeKeyDown:N,onPause:k,onResume:M,onSwipeStart:F,onSwipeMove:B,onSwipeCancel:q,onSwipeEnd:K,...ie}=u,X=y0(xE,f),[te,ce]=ee.useState(null),$=ka(h,Ge=>ce(Ge)),le=ee.useRef(null),ne=ee.useRef(null),de=S||X.duration,be=ee.useRef(0),Se=ee.useRef(de),fe=ee.useRef(0),{onToastAdd:ye,onToastRemove:je}=X,Je=Yd(()=>{te?.contains(document.activeElement)&&X.viewport?.focus(),I()}),Ue=ee.useCallback(Ge=>{!Ge||Ge===1/0||(window.clearTimeout(fe.current),be.current=new Date().getTime(),fe.current=window.setTimeout(Je,Ge))},[Je]);ee.useEffect(()=>{const Ge=X.viewport;if(Ge){const dt=()=>{Ue(Se.current),M?.()},Xe=()=>{const We=new Date().getTime()-be.current;Se.current=Se.current-We,window.clearTimeout(fe.current),k?.()};return Ge.addEventListener(o1,Xe),Ge.addEventListener(a1,dt),()=>{Ge.removeEventListener(o1,Xe),Ge.removeEventListener(a1,dt)}}},[X.viewport,de,k,M,Ue]),ee.useEffect(()=>{C&&!X.isClosePausedRef.current&&Ue(de)},[C,de,X.isClosePausedRef,Ue]),ee.useEffect(()=>(ye(),()=>je()),[ye,je]);const xe=ee.useMemo(()=>te?Oj(te):null,[te]);return X.viewport?P.jsxs(P.Fragment,{children:[xe&&P.jsx($X,{__scopeToast:f,role:"status","aria-live":g==="foreground"?"assertive":"polite","aria-atomic":!0,children:xe}),P.jsx(JX,{scope:f,onClose:Je,children:E0.createPortal(P.jsx(b1.ItemSlot,{scope:f,children:P.jsx(OX,{asChild:!0,onEscapeKeyDown:oi(N,()=>{X.isFocusedToastEscapeKeyDownRef.current||Je(),X.isFocusedToastEscapeKeyDownRef.current=!1}),children:P.jsx(xs.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":C?"open":"closed","data-swipe-direction":X.swipeDirection,...ie,ref:$,style:{userSelect:"none",touchAction:"none",...u.style},onKeyDown:oi(u.onKeyDown,Ge=>{Ge.key==="Escape"&&(N?.(Ge.nativeEvent),Ge.nativeEvent.defaultPrevented||(X.isFocusedToastEscapeKeyDownRef.current=!0,Je()))}),onPointerDown:oi(u.onPointerDown,Ge=>{Ge.button===0&&(le.current={x:Ge.clientX,y:Ge.clientY})}),onPointerMove:oi(u.onPointerMove,Ge=>{if(!le.current)return;const dt=Ge.clientX-le.current.x,Xe=Ge.clientY-le.current.y,We=!!ne.current,Ae=["left","right"].includes(X.swipeDirection),De=["left","up"].includes(X.swipeDirection)?Math.min:Math.max,ze=Ae?De(0,dt):0,me=Ae?0:De(0,Xe),ke=Ge.pointerType==="touch"?10:2,at={x:ze,y:me},ot={originalEvent:Ge,delta:at};We?(ne.current=at,zT(YX,B,ot,{discrete:!1})):l4(at,X.swipeDirection,ke)?(ne.current=at,zT(zX,F,ot,{discrete:!1}),Ge.target.setPointerCapture(Ge.pointerId)):(Math.abs(dt)>ke||Math.abs(Xe)>ke)&&(le.current=null)}),onPointerUp:oi(u.onPointerUp,Ge=>{const dt=ne.current,Xe=Ge.target;if(Xe.hasPointerCapture(Ge.pointerId)&&Xe.releasePointerCapture(Ge.pointerId),ne.current=null,le.current=null,dt){const We=Ge.currentTarget,Ae={originalEvent:Ge,delta:dt};l4(dt,X.swipeDirection,X.swipeThreshold)?zT(XX,K,Ae,{discrete:!0}):zT(qX,q,Ae,{discrete:!0}),We.addEventListener("click",De=>De.preventDefault(),{once:!0})}})})})}),X.viewport)})]}):null}),$X=u=>{const{__scopeToast:h,children:f,...g}=u,S=y0(xE,h),[C,I]=ee.useState(!1),[N,k]=ee.useState(!1);return nJ(()=>I(!0)),ee.useEffect(()=>{const M=window.setTimeout(()=>k(!0),1e3);return()=>window.clearTimeout(M)},[]),N?null:P.jsx(_j,{asChild:!0,children:P.jsx(S0,{...g,children:C&&P.jsxs(P.Fragment,{children:[S.label," ",f]})})})},eJ="ToastTitle",Cj=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u;return P.jsx(xs.div,{...g,ref:h})});Cj.displayName=eJ;var tJ="ToastDescription",Rj=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u;return P.jsx(xs.div,{...g,ref:h})});Rj.displayName=tJ;var wj="ToastAction",bj=ee.forwardRef((u,h)=>{const{altText:f,...g}=u;return f.trim()?P.jsx(Aj,{altText:f,asChild:!0,children:P.jsx(I1,{...g,ref:h})}):(console.error(`Invalid prop \`altText\` supplied to \`${wj}\`. Expected non-empty \`string\`.`),null)});bj.displayName=wj;var Ij="ToastClose",I1=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u,S=QX(Ij,f);return P.jsx(Aj,{asChild:!0,children:P.jsx(xs.button,{type:"button",...g,ref:h,onClick:oi(u.onClick,S.onClose)})})});I1.displayName=Ij;var Aj=ee.forwardRef((u,h)=>{const{__scopeToast:f,altText:g,...S}=u;return P.jsx(xs.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":g||void 0,...S,ref:h})});function Oj(u){const h=[];return Array.from(u.childNodes).forEach(g=>{if(g.nodeType===g.TEXT_NODE&&g.textContent&&h.push(g.textContent),rJ(g)){const S=g.ariaHidden||g.hidden||g.style.display==="none",C=g.dataset.radixToastAnnounceExclude==="";if(!S)if(C){const I=g.dataset.radixToastAnnounceAlt;I&&h.push(I)}else h.push(...Oj(g))}}),h}function zT(u,h,f,{discrete:g}){const S=f.originalEvent.currentTarget,C=new CustomEvent(u,{bubbles:!0,cancelable:!0,detail:f});h&&S.addEventListener(u,h,{once:!0}),g?hj(S,C):S.dispatchEvent(C)}var l4=(u,h,f=0)=>{const g=Math.abs(u.x),S=Math.abs(u.y),C=g>S;return h==="left"||h==="right"?C&&g>f:!C&&S>f};function nJ(u=()=>{}){const h=Yd(u);qd(()=>{let f=0,g=0;return f=window.requestAnimationFrame(()=>g=window.requestAnimationFrame(h)),()=>{window.cancelAnimationFrame(f),window.cancelAnimationFrame(g)}},[h])}function rJ(u){return u.nodeType===u.ELEMENT_NODE}function iJ(u){const h=[],f=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const S=g.tagName==="INPUT"&&g.type==="hidden";return g.disabled||g.hidden||S?NodeFilter.FILTER_SKIP:g.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;f.nextNode();)h.push(f.currentNode);return h}function YI(u){const h=document.activeElement;return u.some(f=>f===h?!0:(f.focus(),document.activeElement!==h))}var sJ=Ej,Nj=Sj,Pj=Tj,Dj=Cj,kj=Rj,Lj=bj,xj=I1;function Mj(u){var h,f,g="";if(typeof u=="string"||typeof u=="number")g+=u;else if(typeof u=="object")if(Array.isArray(u)){var S=u.length;for(h=0;h<S;h++)u[h]&&(f=Mj(u[h]))&&(g&&(g+=" "),g+=f)}else for(f in u)u[f]&&(g&&(g+=" "),g+=f);return g}function Uj(){for(var u,h,f=0,g="",S=arguments.length;f<S;f++)(u=arguments[f])&&(h=Mj(u))&&(g&&(g+=" "),g+=h);return g}const d4=u=>typeof u=="boolean"?`${u}`:u===0?"0":u,u4=Uj,oJ=(u,h)=>f=>{var g;if(h?.variants==null)return u4(u,f?.class,f?.className);const{variants:S,defaultVariants:C}=h,I=Object.keys(S).map(M=>{const F=f?.[M],B=C?.[M];if(F===null)return null;const q=d4(F)||d4(B);return S[M][q]}),N=f&&Object.entries(f).reduce((M,F)=>{let[B,q]=F;return q===void 0||(M[B]=q),M},{}),k=h==null||(g=h.compoundVariants)===null||g===void 0?void 0:g.reduce((M,F)=>{let{class:B,className:q,...K}=F;return Object.entries(K).every(ie=>{let[X,te]=ie;return Array.isArray(te)?te.includes({...C,...N}[X]):{...C,...N}[X]===te})?[...M,B,q]:M},[]);return u4(u,I,k,f?.class,f?.className)};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aJ=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),cJ=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(h,f,g)=>g?g.toUpperCase():f.toLowerCase()),h4=u=>{const h=cJ(u);return h.charAt(0).toUpperCase()+h.slice(1)},Vj=(...u)=>u.filter((h,f,g)=>!!h&&h.trim()!==""&&g.indexOf(h)===f).join(" ").trim(),lJ=u=>{for(const h in u)if(h.startsWith("aria-")||h==="role"||h==="title")return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var dJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uJ=ee.forwardRef(({color:u="currentColor",size:h=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:S="",children:C,iconNode:I,...N},k)=>ee.createElement("svg",{ref:k,...dJ,width:h,height:h,stroke:u,strokeWidth:g?Number(f)*24/Number(h):f,className:Vj("lucide",S),...!C&&!lJ(N)&&{"aria-hidden":"true"},...N},[...I.map(([M,F])=>ee.createElement(M,F)),...Array.isArray(C)?C:[C]]));/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hJ=(u,h)=>{const f=ee.forwardRef(({className:g,...S},C)=>ee.createElement(uJ,{ref:C,iconNode:h,className:Vj(`lucide-${aJ(h4(u))}`,`lucide-${u}`,g),...S}));return f.displayName=h4(u),f};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pJ=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],fJ=hJ("x",pJ),A1="-",mJ=u=>{const h=gJ(u),{conflictingClassGroups:f,conflictingClassGroupModifiers:g}=u;return{getClassGroupId:I=>{const N=I.split(A1);return N[0]===""&&N.length!==1&&N.shift(),jj(N,h)||_J(I)},getConflictingClassGroupIds:(I,N)=>{const k=f[I]||[];return N&&g[I]?[...k,...g[I]]:k}}},jj=(u,h)=>{if(u.length===0)return h.classGroupId;const f=u[0],g=h.nextPart.get(f),S=g?jj(u.slice(1),g):void 0;if(S)return S;if(h.validators.length===0)return;const C=u.join(A1);return h.validators.find(({validator:I})=>I(C))?.classGroupId},p4=/^\[(.+)\]$/,_J=u=>{if(p4.test(u)){const h=p4.exec(u)[1],f=h?.substring(0,h.indexOf(":"));if(f)return"arbitrary.."+f}},gJ=u=>{const{theme:h,prefix:f}=u,g={nextPart:new Map,validators:[]};return vJ(Object.entries(u.classGroups),f).forEach(([C,I])=>{l1(I,g,C,h)}),g},l1=(u,h,f,g)=>{u.forEach(S=>{if(typeof S=="string"){const C=S===""?h:f4(h,S);C.classGroupId=f;return}if(typeof S=="function"){if(EJ(S)){l1(S(g),h,f,g);return}h.validators.push({validator:S,classGroupId:f});return}Object.entries(S).forEach(([C,I])=>{l1(I,f4(h,C),f,g)})})},f4=(u,h)=>{let f=u;return h.split(A1).forEach(g=>{f.nextPart.has(g)||f.nextPart.set(g,{nextPart:new Map,validators:[]}),f=f.nextPart.get(g)}),f},EJ=u=>u.isThemeGetter,vJ=(u,h)=>h?u.map(([f,g])=>{const S=g.map(C=>typeof C=="string"?h+C:typeof C=="object"?Object.fromEntries(Object.entries(C).map(([I,N])=>[h+I,N])):C);return[f,S]}):u,SJ=u=>{if(u<1)return{get:()=>{},set:()=>{}};let h=0,f=new Map,g=new Map;const S=(C,I)=>{f.set(C,I),h++,h>u&&(h=0,g=f,f=new Map)};return{get(C){let I=f.get(C);if(I!==void 0)return I;if((I=g.get(C))!==void 0)return S(C,I),I},set(C,I){f.has(C)?f.set(C,I):S(C,I)}}},Fj="!",yJ=u=>{const{separator:h,experimentalParseClassName:f}=u,g=h.length===1,S=h[0],C=h.length,I=N=>{const k=[];let M=0,F=0,B;for(let te=0;te<N.length;te++){let ce=N[te];if(M===0){if(ce===S&&(g||N.slice(te,te+C)===h)){k.push(N.slice(F,te)),F=te+C;continue}if(ce==="/"){B=te;continue}}ce==="["?M++:ce==="]"&&M--}const q=k.length===0?N:N.substring(F),K=q.startsWith(Fj),ie=K?q.substring(1):q,X=B&&B>F?B-F:void 0;return{modifiers:k,hasImportantModifier:K,baseClassName:ie,maybePostfixModifierPosition:X}};return f?N=>f({className:N,parseClassName:I}):I},TJ=u=>{if(u.length<=1)return u;const h=[];let f=[];return u.forEach(g=>{g[0]==="["?(h.push(...f.sort(),g),f=[]):f.push(g)}),h.push(...f.sort()),h},CJ=u=>({cache:SJ(u.cacheSize),parseClassName:yJ(u),...mJ(u)}),RJ=/\s+/,wJ=(u,h)=>{const{parseClassName:f,getClassGroupId:g,getConflictingClassGroupIds:S}=h,C=[],I=u.trim().split(RJ);let N="";for(let k=I.length-1;k>=0;k-=1){const M=I[k],{modifiers:F,hasImportantModifier:B,baseClassName:q,maybePostfixModifierPosition:K}=f(M);let ie=!!K,X=g(ie?q.substring(0,K):q);if(!X){if(!ie){N=M+(N.length>0?" "+N:N);continue}if(X=g(q),!X){N=M+(N.length>0?" "+N:N);continue}ie=!1}const te=TJ(F).join(":"),ce=B?te+Fj:te,$=ce+X;if(C.includes($))continue;C.push($);const le=S(X,ie);for(let ne=0;ne<le.length;++ne){const de=le[ne];C.push(ce+de)}N=M+(N.length>0?" "+N:N)}return N};function bJ(){let u=0,h,f,g="";for(;u<arguments.length;)(h=arguments[u++])&&(f=Bj(h))&&(g&&(g+=" "),g+=f);return g}const Bj=u=>{if(typeof u=="string")return u;let h,f="";for(let g=0;g<u.length;g++)u[g]&&(h=Bj(u[g]))&&(f&&(f+=" "),f+=h);return f};function IJ(u,...h){let f,g,S,C=I;function I(k){const M=h.reduce((F,B)=>B(F),u());return f=CJ(M),g=f.cache.get,S=f.cache.set,C=N,N(k)}function N(k){const M=g(k);if(M)return M;const F=wJ(k,f);return S(k,F),F}return function(){return C(bJ.apply(null,arguments))}}const hr=u=>{const h=f=>f[u]||[];return h.isThemeGetter=!0,h},Wj=/^\[(?:([a-z-]+):)?(.+)\]$/i,AJ=/^\d+\/\d+$/,OJ=new Set(["px","full","screen"]),NJ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,PJ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,DJ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,kJ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,LJ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,yl=u=>rm(u)||OJ.has(u)||AJ.test(u),Bd=u=>cm(u,"length",WJ),rm=u=>!!u&&!Number.isNaN(Number(u)),qI=u=>cm(u,"number",rm),EE=u=>!!u&&Number.isInteger(Number(u)),xJ=u=>u.endsWith("%")&&rm(u.slice(0,-1)),cn=u=>Wj.test(u),Wd=u=>NJ.test(u),MJ=new Set(["length","size","percentage"]),UJ=u=>cm(u,MJ,Gj),VJ=u=>cm(u,"position",Gj),jJ=new Set(["image","url"]),FJ=u=>cm(u,jJ,HJ),BJ=u=>cm(u,"",GJ),vE=()=>!0,cm=(u,h,f)=>{const g=Wj.exec(u);return g?g[1]?typeof h=="string"?g[1]===h:h.has(g[1]):f(g[2]):!1},WJ=u=>PJ.test(u)&&!DJ.test(u),Gj=()=>!1,GJ=u=>kJ.test(u),HJ=u=>LJ.test(u),KJ=()=>{const u=hr("colors"),h=hr("spacing"),f=hr("blur"),g=hr("brightness"),S=hr("borderColor"),C=hr("borderRadius"),I=hr("borderSpacing"),N=hr("borderWidth"),k=hr("contrast"),M=hr("grayscale"),F=hr("hueRotate"),B=hr("invert"),q=hr("gap"),K=hr("gradientColorStops"),ie=hr("gradientColorStopPositions"),X=hr("inset"),te=hr("margin"),ce=hr("opacity"),$=hr("padding"),le=hr("saturate"),ne=hr("scale"),de=hr("sepia"),be=hr("skew"),Se=hr("space"),fe=hr("translate"),ye=()=>["auto","contain","none"],je=()=>["auto","hidden","clip","visible","scroll"],Je=()=>["auto",cn,h],Ue=()=>[cn,h],xe=()=>["",yl,Bd],Ge=()=>["auto",rm,cn],dt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Xe=()=>["solid","dashed","dotted","double","none"],We=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ae=()=>["start","end","center","between","around","evenly","stretch"],De=()=>["","0",cn],ze=()=>["auto","avoid","all","avoid-page","page","left","right","column"],me=()=>[rm,cn];return{cacheSize:500,separator:":",theme:{colors:[vE],spacing:[yl,Bd],blur:["none","",Wd,cn],brightness:me(),borderColor:[u],borderRadius:["none","","full",Wd,cn],borderSpacing:Ue(),borderWidth:xe(),contrast:me(),grayscale:De(),hueRotate:me(),invert:De(),gap:Ue(),gradientColorStops:[u],gradientColorStopPositions:[xJ,Bd],inset:Je(),margin:Je(),opacity:me(),padding:Ue(),saturate:me(),scale:me(),sepia:De(),skew:me(),space:Ue(),translate:Ue()},classGroups:{aspect:[{aspect:["auto","square","video",cn]}],container:["container"],columns:[{columns:[Wd]}],"break-after":[{"break-after":ze()}],"break-before":[{"break-before":ze()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...dt(),cn]}],overflow:[{overflow:je()}],"overflow-x":[{"overflow-x":je()}],"overflow-y":[{"overflow-y":je()}],overscroll:[{overscroll:ye()}],"overscroll-x":[{"overscroll-x":ye()}],"overscroll-y":[{"overscroll-y":ye()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[X]}],"inset-x":[{"inset-x":[X]}],"inset-y":[{"inset-y":[X]}],start:[{start:[X]}],end:[{end:[X]}],top:[{top:[X]}],right:[{right:[X]}],bottom:[{bottom:[X]}],left:[{left:[X]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",EE,cn]}],basis:[{basis:Je()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",cn]}],grow:[{grow:De()}],shrink:[{shrink:De()}],order:[{order:["first","last","none",EE,cn]}],"grid-cols":[{"grid-cols":[vE]}],"col-start-end":[{col:["auto",{span:["full",EE,cn]},cn]}],"col-start":[{"col-start":Ge()}],"col-end":[{"col-end":Ge()}],"grid-rows":[{"grid-rows":[vE]}],"row-start-end":[{row:["auto",{span:[EE,cn]},cn]}],"row-start":[{"row-start":Ge()}],"row-end":[{"row-end":Ge()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",cn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",cn]}],gap:[{gap:[q]}],"gap-x":[{"gap-x":[q]}],"gap-y":[{"gap-y":[q]}],"justify-content":[{justify:["normal",...Ae()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ae(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ae(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[$]}],px:[{px:[$]}],py:[{py:[$]}],ps:[{ps:[$]}],pe:[{pe:[$]}],pt:[{pt:[$]}],pr:[{pr:[$]}],pb:[{pb:[$]}],pl:[{pl:[$]}],m:[{m:[te]}],mx:[{mx:[te]}],my:[{my:[te]}],ms:[{ms:[te]}],me:[{me:[te]}],mt:[{mt:[te]}],mr:[{mr:[te]}],mb:[{mb:[te]}],ml:[{ml:[te]}],"space-x":[{"space-x":[Se]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Se]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",cn,h]}],"min-w":[{"min-w":[cn,h,"min","max","fit"]}],"max-w":[{"max-w":[cn,h,"none","full","min","max","fit","prose",{screen:[Wd]},Wd]}],h:[{h:[cn,h,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[cn,h,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[cn,h,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[cn,h,"auto","min","max","fit"]}],"font-size":[{text:["base",Wd,Bd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",qI]}],"font-family":[{font:[vE]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",cn]}],"line-clamp":[{"line-clamp":["none",rm,qI]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",yl,cn]}],"list-image":[{"list-image":["none",cn]}],"list-style-type":[{list:["none","disc","decimal",cn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[u]}],"placeholder-opacity":[{"placeholder-opacity":[ce]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[u]}],"text-opacity":[{"text-opacity":[ce]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",yl,Bd]}],"underline-offset":[{"underline-offset":["auto",yl,cn]}],"text-decoration-color":[{decoration:[u]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ue()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",cn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",cn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ce]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...dt(),VJ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",UJ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},FJ]}],"bg-color":[{bg:[u]}],"gradient-from-pos":[{from:[ie]}],"gradient-via-pos":[{via:[ie]}],"gradient-to-pos":[{to:[ie]}],"gradient-from":[{from:[K]}],"gradient-via":[{via:[K]}],"gradient-to":[{to:[K]}],rounded:[{rounded:[C]}],"rounded-s":[{"rounded-s":[C]}],"rounded-e":[{"rounded-e":[C]}],"rounded-t":[{"rounded-t":[C]}],"rounded-r":[{"rounded-r":[C]}],"rounded-b":[{"rounded-b":[C]}],"rounded-l":[{"rounded-l":[C]}],"rounded-ss":[{"rounded-ss":[C]}],"rounded-se":[{"rounded-se":[C]}],"rounded-ee":[{"rounded-ee":[C]}],"rounded-es":[{"rounded-es":[C]}],"rounded-tl":[{"rounded-tl":[C]}],"rounded-tr":[{"rounded-tr":[C]}],"rounded-br":[{"rounded-br":[C]}],"rounded-bl":[{"rounded-bl":[C]}],"border-w":[{border:[N]}],"border-w-x":[{"border-x":[N]}],"border-w-y":[{"border-y":[N]}],"border-w-s":[{"border-s":[N]}],"border-w-e":[{"border-e":[N]}],"border-w-t":[{"border-t":[N]}],"border-w-r":[{"border-r":[N]}],"border-w-b":[{"border-b":[N]}],"border-w-l":[{"border-l":[N]}],"border-opacity":[{"border-opacity":[ce]}],"border-style":[{border:[...Xe(),"hidden"]}],"divide-x":[{"divide-x":[N]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[N]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ce]}],"divide-style":[{divide:Xe()}],"border-color":[{border:[S]}],"border-color-x":[{"border-x":[S]}],"border-color-y":[{"border-y":[S]}],"border-color-s":[{"border-s":[S]}],"border-color-e":[{"border-e":[S]}],"border-color-t":[{"border-t":[S]}],"border-color-r":[{"border-r":[S]}],"border-color-b":[{"border-b":[S]}],"border-color-l":[{"border-l":[S]}],"divide-color":[{divide:[S]}],"outline-style":[{outline:["",...Xe()]}],"outline-offset":[{"outline-offset":[yl,cn]}],"outline-w":[{outline:[yl,Bd]}],"outline-color":[{outline:[u]}],"ring-w":[{ring:xe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[u]}],"ring-opacity":[{"ring-opacity":[ce]}],"ring-offset-w":[{"ring-offset":[yl,Bd]}],"ring-offset-color":[{"ring-offset":[u]}],shadow:[{shadow:["","inner","none",Wd,BJ]}],"shadow-color":[{shadow:[vE]}],opacity:[{opacity:[ce]}],"mix-blend":[{"mix-blend":[...We(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":We()}],filter:[{filter:["","none"]}],blur:[{blur:[f]}],brightness:[{brightness:[g]}],contrast:[{contrast:[k]}],"drop-shadow":[{"drop-shadow":["","none",Wd,cn]}],grayscale:[{grayscale:[M]}],"hue-rotate":[{"hue-rotate":[F]}],invert:[{invert:[B]}],saturate:[{saturate:[le]}],sepia:[{sepia:[de]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[f]}],"backdrop-brightness":[{"backdrop-brightness":[g]}],"backdrop-contrast":[{"backdrop-contrast":[k]}],"backdrop-grayscale":[{"backdrop-grayscale":[M]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[F]}],"backdrop-invert":[{"backdrop-invert":[B]}],"backdrop-opacity":[{"backdrop-opacity":[ce]}],"backdrop-saturate":[{"backdrop-saturate":[le]}],"backdrop-sepia":[{"backdrop-sepia":[de]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[I]}],"border-spacing-x":[{"border-spacing-x":[I]}],"border-spacing-y":[{"border-spacing-y":[I]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",cn]}],duration:[{duration:me()}],ease:[{ease:["linear","in","out","in-out",cn]}],delay:[{delay:me()}],animate:[{animate:["none","spin","ping","pulse","bounce",cn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ne]}],"scale-x":[{"scale-x":[ne]}],"scale-y":[{"scale-y":[ne]}],rotate:[{rotate:[EE,cn]}],"translate-x":[{"translate-x":[fe]}],"translate-y":[{"translate-y":[fe]}],"skew-x":[{"skew-x":[be]}],"skew-y":[{"skew-y":[be]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",cn]}],accent:[{accent:["auto",u]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",cn]}],"caret-color":[{caret:[u]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ue()}],"scroll-mx":[{"scroll-mx":Ue()}],"scroll-my":[{"scroll-my":Ue()}],"scroll-ms":[{"scroll-ms":Ue()}],"scroll-me":[{"scroll-me":Ue()}],"scroll-mt":[{"scroll-mt":Ue()}],"scroll-mr":[{"scroll-mr":Ue()}],"scroll-mb":[{"scroll-mb":Ue()}],"scroll-ml":[{"scroll-ml":Ue()}],"scroll-p":[{"scroll-p":Ue()}],"scroll-px":[{"scroll-px":Ue()}],"scroll-py":[{"scroll-py":Ue()}],"scroll-ps":[{"scroll-ps":Ue()}],"scroll-pe":[{"scroll-pe":Ue()}],"scroll-pt":[{"scroll-pt":Ue()}],"scroll-pr":[{"scroll-pr":Ue()}],"scroll-pb":[{"scroll-pb":Ue()}],"scroll-pl":[{"scroll-pl":Ue()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",cn]}],fill:[{fill:[u,"none"]}],"stroke-w":[{stroke:[yl,Bd,qI]}],stroke:[{stroke:[u,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},zJ=IJ(KJ);function Vh(...u){return zJ(Uj(u))}const YJ=sJ,Hj=ee.forwardRef(({className:u,...h},f)=>P.jsx(Nj,{ref:f,className:Vh("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",u),...h}));Hj.displayName=Nj.displayName;const qJ=oJ("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Kj=ee.forwardRef(({className:u,variant:h,...f},g)=>P.jsx(Pj,{ref:g,className:Vh(qJ({variant:h}),u),...f}));Kj.displayName=Pj.displayName;const XJ=ee.forwardRef(({className:u,...h},f)=>P.jsx(Lj,{ref:f,className:Vh("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",u),...h}));XJ.displayName=Lj.displayName;const zj=ee.forwardRef(({className:u,...h},f)=>P.jsx(xj,{ref:f,className:Vh("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",u),"toast-close":"",...h,children:P.jsx(fJ,{className:"h-4 w-4"})}));zj.displayName=xj.displayName;const Yj=ee.forwardRef(({className:u,...h},f)=>P.jsx(Dj,{ref:f,className:Vh("text-sm font-semibold",u),...h}));Yj.displayName=Dj.displayName;const qj=ee.forwardRef(({className:u,...h},f)=>P.jsx(kj,{ref:f,className:Vh("text-sm opacity-90",u),...h}));qj.displayName=kj.displayName;function JJ(){const{toasts:u}=dX();return P.jsxs(YJ,{children:[u.map(function({id:h,title:f,description:g,action:S,...C}){return P.jsxs(Kj,{...C,children:[P.jsxs("div",{className:"grid gap-1",children:[f&&P.jsx(Yj,{children:f}),g&&P.jsx(qj,{children:g})]}),S,P.jsx(zj,{})]},h)}),P.jsx(Hj,{})]})}var YT={},m4;function QJ(){if(m4)return YT;m4=1;var u=cj();return YT.createRoot=u.createRoot,YT.hydrateRoot=u.hydrateRoot,YT}var ZJ=QJ(),$J=(u,h,f,g,S,C,I,N)=>{let k=document.documentElement,M=["light","dark"];function F(K){(Array.isArray(u)?u:[u]).forEach(ie=>{let X=ie==="class",te=X&&C?S.map(ce=>C[ce]||ce):S;X?(k.classList.remove(...te),k.classList.add(C&&C[K]?C[K]:K)):k.setAttribute(ie,K)}),B(K)}function B(K){N&&M.includes(K)&&(k.style.colorScheme=K)}function q(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(g)F(g);else try{let K=localStorage.getItem(h)||f,ie=I&&K==="system"?q():K;F(ie)}catch{}},eQ=ee.createContext(void 0),tQ={setTheme:u=>{},themes:[]},nQ=()=>{var u;return(u=ee.useContext(eQ))!=null?u:tQ};ee.memo(({forcedTheme:u,storageKey:h,attribute:f,enableSystem:g,enableColorScheme:S,defaultTheme:C,value:I,themes:N,nonce:k,scriptProps:M})=>{let F=JSON.stringify([f,h,C,u,N,I,g,S]).slice(1,-1);return ee.createElement("script",{...M,suppressHydrationWarning:!0,nonce:typeof window>"u"?k:"",dangerouslySetInnerHTML:{__html:`(${$J.toString()})(${F})`}})});var rQ=u=>{switch(u){case"success":return oQ;case"info":return cQ;case"warning":return aQ;case"error":return lQ;default:return null}},iQ=Array(12).fill(0),sQ=({visible:u,className:h})=>it.createElement("div",{className:["sonner-loading-wrapper",h].filter(Boolean).join(" "),"data-visible":u},it.createElement("div",{className:"sonner-spinner"},iQ.map((f,g)=>it.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${g}`})))),oQ=it.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},it.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),aQ=it.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},it.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),cQ=it.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},it.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),lQ=it.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},it.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),dQ=it.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},it.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),it.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),uQ=()=>{let[u,h]=it.useState(document.hidden);return it.useEffect(()=>{let f=()=>{h(document.hidden)};return document.addEventListener("visibilitychange",f),()=>window.removeEventListener("visibilitychange",f)},[]),u},d1=1,hQ=class{constructor(){this.subscribe=u=>(this.subscribers.push(u),()=>{let h=this.subscribers.indexOf(u);this.subscribers.splice(h,1)}),this.publish=u=>{this.subscribers.forEach(h=>h(u))},this.addToast=u=>{this.publish(u),this.toasts=[...this.toasts,u]},this.create=u=>{var h;let{message:f,...g}=u,S=typeof u?.id=="number"||((h=u.id)==null?void 0:h.length)>0?u.id:d1++,C=this.toasts.find(N=>N.id===S),I=u.dismissible===void 0?!0:u.dismissible;return this.dismissedToasts.has(S)&&this.dismissedToasts.delete(S),C?this.toasts=this.toasts.map(N=>N.id===S?(this.publish({...N,...u,id:S,title:f}),{...N,...u,id:S,dismissible:I,title:f}):N):this.addToast({title:f,...g,dismissible:I,id:S}),S},this.dismiss=u=>(this.dismissedToasts.add(u),u||this.toasts.forEach(h=>{this.subscribers.forEach(f=>f({id:h.id,dismiss:!0}))}),this.subscribers.forEach(h=>h({id:u,dismiss:!0})),u),this.message=(u,h)=>this.create({...h,message:u}),this.error=(u,h)=>this.create({...h,message:u,type:"error"}),this.success=(u,h)=>this.create({...h,type:"success",message:u}),this.info=(u,h)=>this.create({...h,type:"info",message:u}),this.warning=(u,h)=>this.create({...h,type:"warning",message:u}),this.loading=(u,h)=>this.create({...h,type:"loading",message:u}),this.promise=(u,h)=>{if(!h)return;let f;h.loading!==void 0&&(f=this.create({...h,promise:u,type:"loading",message:h.loading,description:typeof h.description!="function"?h.description:void 0}));let g=u instanceof Promise?u:u(),S=f!==void 0,C,I=g.then(async k=>{if(C=["resolve",k],it.isValidElement(k))S=!1,this.create({id:f,type:"default",message:k});else if(fQ(k)&&!k.ok){S=!1;let M=typeof h.error=="function"?await h.error(`HTTP error! status: ${k.status}`):h.error,F=typeof h.description=="function"?await h.description(`HTTP error! status: ${k.status}`):h.description;this.create({id:f,type:"error",message:M,description:F})}else if(h.success!==void 0){S=!1;let M=typeof h.success=="function"?await h.success(k):h.success,F=typeof h.description=="function"?await h.description(k):h.description;this.create({id:f,type:"success",message:M,description:F})}}).catch(async k=>{if(C=["reject",k],h.error!==void 0){S=!1;let M=typeof h.error=="function"?await h.error(k):h.error,F=typeof h.description=="function"?await h.description(k):h.description;this.create({id:f,type:"error",message:M,description:F})}}).finally(()=>{var k;S&&(this.dismiss(f),f=void 0),(k=h.finally)==null||k.call(h)}),N=()=>new Promise((k,M)=>I.then(()=>C[0]==="reject"?M(C[1]):k(C[1])).catch(M));return typeof f!="string"&&typeof f!="number"?{unwrap:N}:Object.assign(f,{unwrap:N})},this.custom=(u,h)=>{let f=h?.id||d1++;return this.create({jsx:u(f),id:f,...h}),f},this.getActiveToasts=()=>this.toasts.filter(u=>!this.dismissedToasts.has(u.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Ls=new hQ,pQ=(u,h)=>{let f=h?.id||d1++;return Ls.addToast({title:u,...h,id:f}),f},fQ=u=>u&&typeof u=="object"&&"ok"in u&&typeof u.ok=="boolean"&&"status"in u&&typeof u.status=="number",mQ=pQ,_Q=()=>Ls.toasts,gQ=()=>Ls.getActiveToasts();Object.assign(mQ,{success:Ls.success,info:Ls.info,warning:Ls.warning,error:Ls.error,custom:Ls.custom,message:Ls.message,promise:Ls.promise,dismiss:Ls.dismiss,loading:Ls.loading},{getHistory:_Q,getToasts:gQ});function EQ(u,{insertAt:h}={}){if(typeof document>"u")return;let f=document.head||document.getElementsByTagName("head")[0],g=document.createElement("style");g.type="text/css",h==="top"&&f.firstChild?f.insertBefore(g,f.firstChild):f.appendChild(g),g.styleSheet?g.styleSheet.cssText=u:g.appendChild(document.createTextNode(u))}EQ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function qT(u){return u.label!==void 0}var vQ=3,SQ="32px",yQ="16px",_4=4e3,TQ=356,CQ=14,RQ=20,wQ=200;function Na(...u){return u.filter(Boolean).join(" ")}function bQ(u){let[h,f]=u.split("-"),g=[];return h&&g.push(h),f&&g.push(f),g}var IQ=u=>{var h,f,g,S,C,I,N,k,M,F,B;let{invert:q,toast:K,unstyled:ie,interacting:X,setHeights:te,visibleToasts:ce,heights:$,index:le,toasts:ne,expanded:de,removeToast:be,defaultRichColors:Se,closeButton:fe,style:ye,cancelButtonStyle:je,actionButtonStyle:Je,className:Ue="",descriptionClassName:xe="",duration:Ge,position:dt,gap:Xe,loadingIcon:We,expandByDefault:Ae,classNames:De,icons:ze,closeButtonAriaLabel:me="Close toast",pauseWhenPageIsHidden:ke}=u,[at,ot]=it.useState(null),[Ot,Gt]=it.useState(null),[yt,pn]=it.useState(!1),[vn,or]=it.useState(!1),[hs,Ma]=it.useState(!1),[Kr,Zd]=it.useState(!1),[Fh,ps]=it.useState(!1),[$d,pr]=it.useState(0),[Jr,po]=it.useState(0),ki=it.useRef(K.duration||Ge||_4),bl=it.useRef(null),Ms=it.useRef(null),Ar=le===0,eu=le+1<=ce,ci=K.type,zr=K.dismissible!==!1,Mc=K.className||"",Il=K.descriptionClassName||"",Us=it.useMemo(()=>$.findIndex(Kt=>Kt.toastId===K.id)||0,[$,K.id]),Ua=it.useMemo(()=>{var Kt;return(Kt=K.closeButton)!=null?Kt:fe},[K.closeButton,fe]),tu=it.useMemo(()=>K.duration||Ge||_4,[K.duration,Ge]),Uc=it.useRef(0),Ti=it.useRef(0),nu=it.useRef(0),fo=it.useRef(null),[ru,mo]=dt.split("-"),Vc=it.useMemo(()=>$.reduce((Kt,fn,Fn)=>Fn>=Us?Kt:Kt+fn.height,0),[$,Us]),Al=uQ(),Va=K.invert||q,_o=ci==="loading";Ti.current=it.useMemo(()=>Us*Xe+Vc,[Us,Vc]),it.useEffect(()=>{ki.current=tu},[tu]),it.useEffect(()=>{pn(!0)},[]),it.useEffect(()=>{let Kt=Ms.current;if(Kt){let fn=Kt.getBoundingClientRect().height;return po(fn),te(Fn=>[{toastId:K.id,height:fn,position:K.position},...Fn]),()=>te(Fn=>Fn.filter(Ci=>Ci.toastId!==K.id))}},[te,K.id]),it.useLayoutEffect(()=>{if(!yt)return;let Kt=Ms.current,fn=Kt.style.height;Kt.style.height="auto";let Fn=Kt.getBoundingClientRect().height;Kt.style.height=fn,po(Fn),te(Ci=>Ci.find(Li=>Li.toastId===K.id)?Ci.map(Li=>Li.toastId===K.id?{...Li,height:Fn}:Li):[{toastId:K.id,height:Fn,position:K.position},...Ci])},[yt,K.title,K.description,te,K.id]);let Vs=it.useCallback(()=>{or(!0),pr(Ti.current),te(Kt=>Kt.filter(fn=>fn.toastId!==K.id)),setTimeout(()=>{be(K)},wQ)},[K,be,te,Ti]);it.useEffect(()=>{if(K.promise&&ci==="loading"||K.duration===1/0||K.type==="loading")return;let Kt;return de||X||ke&&Al?(()=>{if(nu.current<Uc.current){let fn=new Date().getTime()-Uc.current;ki.current=ki.current-fn}nu.current=new Date().getTime()})():ki.current!==1/0&&(Uc.current=new Date().getTime(),Kt=setTimeout(()=>{var fn;(fn=K.onAutoClose)==null||fn.call(K,K),Vs()},ki.current)),()=>clearTimeout(Kt)},[de,X,K,ci,ke,Al,Vs]),it.useEffect(()=>{K.delete&&Vs()},[Vs,K.delete]);function ja(){var Kt,fn,Fn;return ze!=null&&ze.loading?it.createElement("div",{className:Na(De?.loader,(Kt=K?.classNames)==null?void 0:Kt.loader,"sonner-loader"),"data-visible":ci==="loading"},ze.loading):We?it.createElement("div",{className:Na(De?.loader,(fn=K?.classNames)==null?void 0:fn.loader,"sonner-loader"),"data-visible":ci==="loading"},We):it.createElement(sQ,{className:Na(De?.loader,(Fn=K?.classNames)==null?void 0:Fn.loader),visible:ci==="loading"})}return it.createElement("li",{tabIndex:0,ref:Ms,className:Na(Ue,Mc,De?.toast,(h=K?.classNames)==null?void 0:h.toast,De?.default,De?.[ci],(f=K?.classNames)==null?void 0:f[ci]),"data-sonner-toast":"","data-rich-colors":(g=K.richColors)!=null?g:Se,"data-styled":!(K.jsx||K.unstyled||ie),"data-mounted":yt,"data-promise":!!K.promise,"data-swiped":Fh,"data-removed":vn,"data-visible":eu,"data-y-position":ru,"data-x-position":mo,"data-index":le,"data-front":Ar,"data-swiping":hs,"data-dismissible":zr,"data-type":ci,"data-invert":Va,"data-swipe-out":Kr,"data-swipe-direction":Ot,"data-expanded":!!(de||Ae&&yt),style:{"--index":le,"--toasts-before":le,"--z-index":ne.length-le,"--offset":`${vn?$d:Ti.current}px`,"--initial-height":Ae?"auto":`${Jr}px`,...ye,...K.style},onDragEnd:()=>{Ma(!1),ot(null),fo.current=null},onPointerDown:Kt=>{_o||!zr||(bl.current=new Date,pr(Ti.current),Kt.target.setPointerCapture(Kt.pointerId),Kt.target.tagName!=="BUTTON"&&(Ma(!0),fo.current={x:Kt.clientX,y:Kt.clientY}))},onPointerUp:()=>{var Kt,fn,Fn,Ci;if(Kr||!zr)return;fo.current=null;let Li=Number(((Kt=Ms.current)==null?void 0:Kt.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Bn=Number(((fn=Ms.current)==null?void 0:fn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),js=new Date().getTime()-((Fn=bl.current)==null?void 0:Fn.getTime()),Qr=at==="x"?Li:Bn,Xi=Math.abs(Qr)/js;if(Math.abs(Qr)>=RQ||Xi>.11){pr(Ti.current),(Ci=K.onDismiss)==null||Ci.call(K,K),Gt(at==="x"?Li>0?"right":"left":Bn>0?"down":"up"),Vs(),Zd(!0),ps(!1);return}Ma(!1),ot(null)},onPointerMove:Kt=>{var fn,Fn,Ci,Li;if(!fo.current||!zr||((fn=window.getSelection())==null?void 0:fn.toString().length)>0)return;let Bn=Kt.clientY-fo.current.y,js=Kt.clientX-fo.current.x,Qr=(Fn=u.swipeDirections)!=null?Fn:bQ(dt);!at&&(Math.abs(js)>1||Math.abs(Bn)>1)&&ot(Math.abs(js)>Math.abs(Bn)?"x":"y");let Xi={x:0,y:0};at==="y"?(Qr.includes("top")||Qr.includes("bottom"))&&(Qr.includes("top")&&Bn<0||Qr.includes("bottom")&&Bn>0)&&(Xi.y=Bn):at==="x"&&(Qr.includes("left")||Qr.includes("right"))&&(Qr.includes("left")&&js<0||Qr.includes("right")&&js>0)&&(Xi.x=js),(Math.abs(Xi.x)>0||Math.abs(Xi.y)>0)&&ps(!0),(Ci=Ms.current)==null||Ci.style.setProperty("--swipe-amount-x",`${Xi.x}px`),(Li=Ms.current)==null||Li.style.setProperty("--swipe-amount-y",`${Xi.y}px`)}},Ua&&!K.jsx?it.createElement("button",{"aria-label":me,"data-disabled":_o,"data-close-button":!0,onClick:_o||!zr?()=>{}:()=>{var Kt;Vs(),(Kt=K.onDismiss)==null||Kt.call(K,K)},className:Na(De?.closeButton,(S=K?.classNames)==null?void 0:S.closeButton)},(C=ze?.close)!=null?C:dQ):null,K.jsx||ee.isValidElement(K.title)?K.jsx?K.jsx:typeof K.title=="function"?K.title():K.title:it.createElement(it.Fragment,null,ci||K.icon||K.promise?it.createElement("div",{"data-icon":"",className:Na(De?.icon,(I=K?.classNames)==null?void 0:I.icon)},K.promise||K.type==="loading"&&!K.icon?K.icon||ja():null,K.type!=="loading"?K.icon||ze?.[ci]||rQ(ci):null):null,it.createElement("div",{"data-content":"",className:Na(De?.content,(N=K?.classNames)==null?void 0:N.content)},it.createElement("div",{"data-title":"",className:Na(De?.title,(k=K?.classNames)==null?void 0:k.title)},typeof K.title=="function"?K.title():K.title),K.description?it.createElement("div",{"data-description":"",className:Na(xe,Il,De?.description,(M=K?.classNames)==null?void 0:M.description)},typeof K.description=="function"?K.description():K.description):null),ee.isValidElement(K.cancel)?K.cancel:K.cancel&&qT(K.cancel)?it.createElement("button",{"data-button":!0,"data-cancel":!0,style:K.cancelButtonStyle||je,onClick:Kt=>{var fn,Fn;qT(K.cancel)&&zr&&((Fn=(fn=K.cancel).onClick)==null||Fn.call(fn,Kt),Vs())},className:Na(De?.cancelButton,(F=K?.classNames)==null?void 0:F.cancelButton)},K.cancel.label):null,ee.isValidElement(K.action)?K.action:K.action&&qT(K.action)?it.createElement("button",{"data-button":!0,"data-action":!0,style:K.actionButtonStyle||Je,onClick:Kt=>{var fn,Fn;qT(K.action)&&((Fn=(fn=K.action).onClick)==null||Fn.call(fn,Kt),!Kt.defaultPrevented&&Vs())},className:Na(De?.actionButton,(B=K?.classNames)==null?void 0:B.actionButton)},K.action.label):null))};function g4(){if(typeof window>"u"||typeof document>"u")return"ltr";let u=document.documentElement.getAttribute("dir");return u==="auto"||!u?window.getComputedStyle(document.documentElement).direction:u}function AQ(u,h){let f={};return[u,h].forEach((g,S)=>{let C=S===1,I=C?"--mobile-offset":"--offset",N=C?yQ:SQ;function k(M){["top","right","bottom","left"].forEach(F=>{f[`${I}-${F}`]=typeof M=="number"?`${M}px`:M})}typeof g=="number"||typeof g=="string"?k(g):typeof g=="object"?["top","right","bottom","left"].forEach(M=>{g[M]===void 0?f[`${I}-${M}`]=N:f[`${I}-${M}`]=typeof g[M]=="number"?`${g[M]}px`:g[M]}):k(N)}),f}var OQ=ee.forwardRef(function(u,h){let{invert:f,position:g="bottom-right",hotkey:S=["altKey","KeyT"],expand:C,closeButton:I,className:N,offset:k,mobileOffset:M,theme:F="light",richColors:B,duration:q,style:K,visibleToasts:ie=vQ,toastOptions:X,dir:te=g4(),gap:ce=CQ,loadingIcon:$,icons:le,containerAriaLabel:ne="Notifications",pauseWhenPageIsHidden:de}=u,[be,Se]=it.useState([]),fe=it.useMemo(()=>Array.from(new Set([g].concat(be.filter(ke=>ke.position).map(ke=>ke.position)))),[be,g]),[ye,je]=it.useState([]),[Je,Ue]=it.useState(!1),[xe,Ge]=it.useState(!1),[dt,Xe]=it.useState(F!=="system"?F:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),We=it.useRef(null),Ae=S.join("+").replace(/Key/g,"").replace(/Digit/g,""),De=it.useRef(null),ze=it.useRef(!1),me=it.useCallback(ke=>{Se(at=>{var ot;return(ot=at.find(Ot=>Ot.id===ke.id))!=null&&ot.delete||Ls.dismiss(ke.id),at.filter(({id:Ot})=>Ot!==ke.id)})},[]);return it.useEffect(()=>Ls.subscribe(ke=>{if(ke.dismiss){Se(at=>at.map(ot=>ot.id===ke.id?{...ot,delete:!0}:ot));return}setTimeout(()=>{lj.flushSync(()=>{Se(at=>{let ot=at.findIndex(Ot=>Ot.id===ke.id);return ot!==-1?[...at.slice(0,ot),{...at[ot],...ke},...at.slice(ot+1)]:[ke,...at]})})})}),[]),it.useEffect(()=>{if(F!=="system"){Xe(F);return}if(F==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Xe("dark"):Xe("light")),typeof window>"u")return;let ke=window.matchMedia("(prefers-color-scheme: dark)");try{ke.addEventListener("change",({matches:at})=>{Xe(at?"dark":"light")})}catch{ke.addListener(({matches:ot})=>{try{Xe(ot?"dark":"light")}catch(Ot){console.error(Ot)}})}},[F]),it.useEffect(()=>{be.length<=1&&Ue(!1)},[be]),it.useEffect(()=>{let ke=at=>{var ot,Ot;S.every(Gt=>at[Gt]||at.code===Gt)&&(Ue(!0),(ot=We.current)==null||ot.focus()),at.code==="Escape"&&(document.activeElement===We.current||(Ot=We.current)!=null&&Ot.contains(document.activeElement))&&Ue(!1)};return document.addEventListener("keydown",ke),()=>document.removeEventListener("keydown",ke)},[S]),it.useEffect(()=>{if(We.current)return()=>{De.current&&(De.current.focus({preventScroll:!0}),De.current=null,ze.current=!1)}},[We.current]),it.createElement("section",{ref:h,"aria-label":`${ne} ${Ae}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},fe.map((ke,at)=>{var ot;let[Ot,Gt]=ke.split("-");return be.length?it.createElement("ol",{key:ke,dir:te==="auto"?g4():te,tabIndex:-1,ref:We,className:N,"data-sonner-toaster":!0,"data-theme":dt,"data-y-position":Ot,"data-lifted":Je&&be.length>1&&!C,"data-x-position":Gt,style:{"--front-toast-height":`${((ot=ye[0])==null?void 0:ot.height)||0}px`,"--width":`${TQ}px`,"--gap":`${ce}px`,...K,...AQ(k,M)},onBlur:yt=>{ze.current&&!yt.currentTarget.contains(yt.relatedTarget)&&(ze.current=!1,De.current&&(De.current.focus({preventScroll:!0}),De.current=null))},onFocus:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||ze.current||(ze.current=!0,De.current=yt.relatedTarget)},onMouseEnter:()=>Ue(!0),onMouseMove:()=>Ue(!0),onMouseLeave:()=>{xe||Ue(!1)},onDragEnd:()=>Ue(!1),onPointerDown:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||Ge(!0)},onPointerUp:()=>Ge(!1)},be.filter(yt=>!yt.position&&at===0||yt.position===ke).map((yt,pn)=>{var vn,or;return it.createElement(IQ,{key:yt.id,icons:le,index:pn,toast:yt,defaultRichColors:B,duration:(vn=X?.duration)!=null?vn:q,className:X?.className,descriptionClassName:X?.descriptionClassName,invert:f,visibleToasts:ie,closeButton:(or=X?.closeButton)!=null?or:I,interacting:xe,position:ke,style:X?.style,unstyled:X?.unstyled,classNames:X?.classNames,cancelButtonStyle:X?.cancelButtonStyle,actionButtonStyle:X?.actionButtonStyle,removeToast:me,toasts:be.filter(hs=>hs.position==yt.position),heights:ye.filter(hs=>hs.position==yt.position),setHeights:je,expandByDefault:C,gap:ce,loadingIcon:$,expanded:Je,pauseWhenPageIsHidden:de,swipeDirections:u.swipeDirections})})):null}))});const NQ=({...u})=>{const{theme:h="system"}=nQ();return P.jsx(OQ,{theme:h,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...u})},PQ=["top","right","bottom","left"],Xd=Math.min,lo=Math.max,d0=Math.round,XT=Math.floor,kc=u=>({x:u,y:u}),DQ={left:"right",right:"left",bottom:"top",top:"bottom"},kQ={start:"end",end:"start"};function u1(u,h,f){return lo(u,Xd(h,f))}function Cl(u,h){return typeof u=="function"?u(h):u}function Rl(u){return u.split("-")[0]}function lm(u){return u.split("-")[1]}function O1(u){return u==="x"?"y":"x"}function N1(u){return u==="y"?"height":"width"}const LQ=new Set(["top","bottom"]);function Dc(u){return LQ.has(Rl(u))?"y":"x"}function P1(u){return O1(Dc(u))}function xQ(u,h,f){f===void 0&&(f=!1);const g=lm(u),S=P1(u),C=N1(S);let I=S==="x"?g===(f?"end":"start")?"right":"left":g==="start"?"bottom":"top";return h.reference[C]>h.floating[C]&&(I=u0(I)),[I,u0(I)]}function MQ(u){const h=u0(u);return[h1(u),h,h1(h)]}function h1(u){return u.replace(/start|end/g,h=>kQ[h])}const E4=["left","right"],v4=["right","left"],UQ=["top","bottom"],VQ=["bottom","top"];function jQ(u,h,f){switch(u){case"top":case"bottom":return f?h?v4:E4:h?E4:v4;case"left":case"right":return h?UQ:VQ;default:return[]}}function FQ(u,h,f,g){const S=lm(u);let C=jQ(Rl(u),f==="start",g);return S&&(C=C.map(I=>I+"-"+S),h&&(C=C.concat(C.map(h1)))),C}function u0(u){return u.replace(/left|right|bottom|top/g,h=>DQ[h])}function BQ(u){return{top:0,right:0,bottom:0,left:0,...u}}function Xj(u){return typeof u!="number"?BQ(u):{top:u,right:u,bottom:u,left:u}}function h0(u){const{x:h,y:f,width:g,height:S}=u;return{width:g,height:S,top:f,left:h,right:h+g,bottom:f+S,x:h,y:f}}function S4(u,h,f){let{reference:g,floating:S}=u;const C=Dc(h),I=P1(h),N=N1(I),k=Rl(h),M=C==="y",F=g.x+g.width/2-S.width/2,B=g.y+g.height/2-S.height/2,q=g[N]/2-S[N]/2;let K;switch(k){case"top":K={x:F,y:g.y-S.height};break;case"bottom":K={x:F,y:g.y+g.height};break;case"right":K={x:g.x+g.width,y:B};break;case"left":K={x:g.x-S.width,y:B};break;default:K={x:g.x,y:g.y}}switch(lm(h)){case"start":K[I]-=q*(f&&M?-1:1);break;case"end":K[I]+=q*(f&&M?-1:1);break}return K}const WQ=async(u,h,f)=>{const{placement:g="bottom",strategy:S="absolute",middleware:C=[],platform:I}=f,N=C.filter(Boolean),k=await(I.isRTL==null?void 0:I.isRTL(h));let M=await I.getElementRects({reference:u,floating:h,strategy:S}),{x:F,y:B}=S4(M,g,k),q=g,K={},ie=0;for(let X=0;X<N.length;X++){const{name:te,fn:ce}=N[X],{x:$,y:le,data:ne,reset:de}=await ce({x:F,y:B,initialPlacement:g,placement:q,strategy:S,middlewareData:K,rects:M,platform:I,elements:{reference:u,floating:h}});F=$??F,B=le??B,K={...K,[te]:{...K[te],...ne}},de&&ie<=50&&(ie++,typeof de=="object"&&(de.placement&&(q=de.placement),de.rects&&(M=de.rects===!0?await I.getElementRects({reference:u,floating:h,strategy:S}):de.rects),{x:F,y:B}=S4(M,q,k)),X=-1)}return{x:F,y:B,placement:q,strategy:S,middlewareData:K}};async function wE(u,h){var f;h===void 0&&(h={});const{x:g,y:S,platform:C,rects:I,elements:N,strategy:k}=u,{boundary:M="clippingAncestors",rootBoundary:F="viewport",elementContext:B="floating",altBoundary:q=!1,padding:K=0}=Cl(h,u),ie=Xj(K),te=N[q?B==="floating"?"reference":"floating":B],ce=h0(await C.getClippingRect({element:(f=await(C.isElement==null?void 0:C.isElement(te)))==null||f?te:te.contextElement||await(C.getDocumentElement==null?void 0:C.getDocumentElement(N.floating)),boundary:M,rootBoundary:F,strategy:k})),$=B==="floating"?{x:g,y:S,width:I.floating.width,height:I.floating.height}:I.reference,le=await(C.getOffsetParent==null?void 0:C.getOffsetParent(N.floating)),ne=await(C.isElement==null?void 0:C.isElement(le))?await(C.getScale==null?void 0:C.getScale(le))||{x:1,y:1}:{x:1,y:1},de=h0(C.convertOffsetParentRelativeRectToViewportRelativeRect?await C.convertOffsetParentRelativeRectToViewportRelativeRect({elements:N,rect:$,offsetParent:le,strategy:k}):$);return{top:(ce.top-de.top+ie.top)/ne.y,bottom:(de.bottom-ce.bottom+ie.bottom)/ne.y,left:(ce.left-de.left+ie.left)/ne.x,right:(de.right-ce.right+ie.right)/ne.x}}const GQ=u=>({name:"arrow",options:u,async fn(h){const{x:f,y:g,placement:S,rects:C,platform:I,elements:N,middlewareData:k}=h,{element:M,padding:F=0}=Cl(u,h)||{};if(M==null)return{};const B=Xj(F),q={x:f,y:g},K=P1(S),ie=N1(K),X=await I.getDimensions(M),te=K==="y",ce=te?"top":"left",$=te?"bottom":"right",le=te?"clientHeight":"clientWidth",ne=C.reference[ie]+C.reference[K]-q[K]-C.floating[ie],de=q[K]-C.reference[K],be=await(I.getOffsetParent==null?void 0:I.getOffsetParent(M));let Se=be?be[le]:0;(!Se||!await(I.isElement==null?void 0:I.isElement(be)))&&(Se=N.floating[le]||C.floating[ie]);const fe=ne/2-de/2,ye=Se/2-X[ie]/2-1,je=Xd(B[ce],ye),Je=Xd(B[$],ye),Ue=je,xe=Se-X[ie]-Je,Ge=Se/2-X[ie]/2+fe,dt=u1(Ue,Ge,xe),Xe=!k.arrow&&lm(S)!=null&&Ge!==dt&&C.reference[ie]/2-(Ge<Ue?je:Je)-X[ie]/2<0,We=Xe?Ge<Ue?Ge-Ue:Ge-xe:0;return{[K]:q[K]+We,data:{[K]:dt,centerOffset:Ge-dt-We,...Xe&&{alignmentOffset:We}},reset:Xe}}}),HQ=function(u){return u===void 0&&(u={}),{name:"flip",options:u,async fn(h){var f,g;const{placement:S,middlewareData:C,rects:I,initialPlacement:N,platform:k,elements:M}=h,{mainAxis:F=!0,crossAxis:B=!0,fallbackPlacements:q,fallbackStrategy:K="bestFit",fallbackAxisSideDirection:ie="none",flipAlignment:X=!0,...te}=Cl(u,h);if((f=C.arrow)!=null&&f.alignmentOffset)return{};const ce=Rl(S),$=Dc(N),le=Rl(N)===N,ne=await(k.isRTL==null?void 0:k.isRTL(M.floating)),de=q||(le||!X?[u0(N)]:MQ(N)),be=ie!=="none";!q&&be&&de.push(...FQ(N,X,ie,ne));const Se=[N,...de],fe=await wE(h,te),ye=[];let je=((g=C.flip)==null?void 0:g.overflows)||[];if(F&&ye.push(fe[ce]),B){const Ge=xQ(S,I,ne);ye.push(fe[Ge[0]],fe[Ge[1]])}if(je=[...je,{placement:S,overflows:ye}],!ye.every(Ge=>Ge<=0)){var Je,Ue;const Ge=(((Je=C.flip)==null?void 0:Je.index)||0)+1,dt=Se[Ge];if(dt&&(!(B==="alignment"?$!==Dc(dt):!1)||je.every(Ae=>Dc(Ae.placement)===$?Ae.overflows[0]>0:!0)))return{data:{index:Ge,overflows:je},reset:{placement:dt}};let Xe=(Ue=je.filter(We=>We.overflows[0]<=0).sort((We,Ae)=>We.overflows[1]-Ae.overflows[1])[0])==null?void 0:Ue.placement;if(!Xe)switch(K){case"bestFit":{var xe;const We=(xe=je.filter(Ae=>{if(be){const De=Dc(Ae.placement);return De===$||De==="y"}return!0}).map(Ae=>[Ae.placement,Ae.overflows.filter(De=>De>0).reduce((De,ze)=>De+ze,0)]).sort((Ae,De)=>Ae[1]-De[1])[0])==null?void 0:xe[0];We&&(Xe=We);break}case"initialPlacement":Xe=N;break}if(S!==Xe)return{reset:{placement:Xe}}}return{}}}};function y4(u,h){return{top:u.top-h.height,right:u.right-h.width,bottom:u.bottom-h.height,left:u.left-h.width}}function T4(u){return PQ.some(h=>u[h]>=0)}const KQ=function(u){return u===void 0&&(u={}),{name:"hide",options:u,async fn(h){const{rects:f}=h,{strategy:g="referenceHidden",...S}=Cl(u,h);switch(g){case"referenceHidden":{const C=await wE(h,{...S,elementContext:"reference"}),I=y4(C,f.reference);return{data:{referenceHiddenOffsets:I,referenceHidden:T4(I)}}}case"escaped":{const C=await wE(h,{...S,altBoundary:!0}),I=y4(C,f.floating);return{data:{escapedOffsets:I,escaped:T4(I)}}}default:return{}}}}},Jj=new Set(["left","top"]);async function zQ(u,h){const{placement:f,platform:g,elements:S}=u,C=await(g.isRTL==null?void 0:g.isRTL(S.floating)),I=Rl(f),N=lm(f),k=Dc(f)==="y",M=Jj.has(I)?-1:1,F=C&&k?-1:1,B=Cl(h,u);let{mainAxis:q,crossAxis:K,alignmentAxis:ie}=typeof B=="number"?{mainAxis:B,crossAxis:0,alignmentAxis:null}:{mainAxis:B.mainAxis||0,crossAxis:B.crossAxis||0,alignmentAxis:B.alignmentAxis};return N&&typeof ie=="number"&&(K=N==="end"?ie*-1:ie),k?{x:K*F,y:q*M}:{x:q*M,y:K*F}}const YQ=function(u){return u===void 0&&(u=0),{name:"offset",options:u,async fn(h){var f,g;const{x:S,y:C,placement:I,middlewareData:N}=h,k=await zQ(h,u);return I===((f=N.offset)==null?void 0:f.placement)&&(g=N.arrow)!=null&&g.alignmentOffset?{}:{x:S+k.x,y:C+k.y,data:{...k,placement:I}}}}},qQ=function(u){return u===void 0&&(u={}),{name:"shift",options:u,async fn(h){const{x:f,y:g,placement:S}=h,{mainAxis:C=!0,crossAxis:I=!1,limiter:N={fn:te=>{let{x:ce,y:$}=te;return{x:ce,y:$}}},...k}=Cl(u,h),M={x:f,y:g},F=await wE(h,k),B=Dc(Rl(S)),q=O1(B);let K=M[q],ie=M[B];if(C){const te=q==="y"?"top":"left",ce=q==="y"?"bottom":"right",$=K+F[te],le=K-F[ce];K=u1($,K,le)}if(I){const te=B==="y"?"top":"left",ce=B==="y"?"bottom":"right",$=ie+F[te],le=ie-F[ce];ie=u1($,ie,le)}const X=N.fn({...h,[q]:K,[B]:ie});return{...X,data:{x:X.x-f,y:X.y-g,enabled:{[q]:C,[B]:I}}}}}},XQ=function(u){return u===void 0&&(u={}),{options:u,fn(h){const{x:f,y:g,placement:S,rects:C,middlewareData:I}=h,{offset:N=0,mainAxis:k=!0,crossAxis:M=!0}=Cl(u,h),F={x:f,y:g},B=Dc(S),q=O1(B);let K=F[q],ie=F[B];const X=Cl(N,h),te=typeof X=="number"?{mainAxis:X,crossAxis:0}:{mainAxis:0,crossAxis:0,...X};if(k){const le=q==="y"?"height":"width",ne=C.reference[q]-C.floating[le]+te.mainAxis,de=C.reference[q]+C.reference[le]-te.mainAxis;K<ne?K=ne:K>de&&(K=de)}if(M){var ce,$;const le=q==="y"?"width":"height",ne=Jj.has(Rl(S)),de=C.reference[B]-C.floating[le]+(ne&&((ce=I.offset)==null?void 0:ce[B])||0)+(ne?0:te.crossAxis),be=C.reference[B]+C.reference[le]+(ne?0:(($=I.offset)==null?void 0:$[B])||0)-(ne?te.crossAxis:0);ie<de?ie=de:ie>be&&(ie=be)}return{[q]:K,[B]:ie}}}},JQ=function(u){return u===void 0&&(u={}),{name:"size",options:u,async fn(h){var f,g;const{placement:S,rects:C,platform:I,elements:N}=h,{apply:k=()=>{},...M}=Cl(u,h),F=await wE(h,M),B=Rl(S),q=lm(S),K=Dc(S)==="y",{width:ie,height:X}=C.floating;let te,ce;B==="top"||B==="bottom"?(te=B,ce=q===(await(I.isRTL==null?void 0:I.isRTL(N.floating))?"start":"end")?"left":"right"):(ce=B,te=q==="end"?"top":"bottom");const $=X-F.top-F.bottom,le=ie-F.left-F.right,ne=Xd(X-F[te],$),de=Xd(ie-F[ce],le),be=!h.middlewareData.shift;let Se=ne,fe=de;if((f=h.middlewareData.shift)!=null&&f.enabled.x&&(fe=le),(g=h.middlewareData.shift)!=null&&g.enabled.y&&(Se=$),be&&!q){const je=lo(F.left,0),Je=lo(F.right,0),Ue=lo(F.top,0),xe=lo(F.bottom,0);K?fe=ie-2*(je!==0||Je!==0?je+Je:lo(F.left,F.right)):Se=X-2*(Ue!==0||xe!==0?Ue+xe:lo(F.top,F.bottom))}await k({...h,availableWidth:fe,availableHeight:Se});const ye=await I.getDimensions(N.floating);return ie!==ye.width||X!==ye.height?{reset:{rects:!0}}:{}}}};function T0(){return typeof window<"u"}function dm(u){return Qj(u)?(u.nodeName||"").toLowerCase():"#document"}function ho(u){var h;return(u==null||(h=u.ownerDocument)==null?void 0:h.defaultView)||window}function xc(u){var h;return(h=(Qj(u)?u.ownerDocument:u.document)||window.document)==null?void 0:h.documentElement}function Qj(u){return T0()?u instanceof Node||u instanceof ho(u).Node:!1}function La(u){return T0()?u instanceof Element||u instanceof ho(u).Element:!1}function Lc(u){return T0()?u instanceof HTMLElement||u instanceof ho(u).HTMLElement:!1}function C4(u){return!T0()||typeof ShadowRoot>"u"?!1:u instanceof ShadowRoot||u instanceof ho(u).ShadowRoot}const QQ=new Set(["inline","contents"]);function ME(u){const{overflow:h,overflowX:f,overflowY:g,display:S}=xa(u);return/auto|scroll|overlay|hidden|clip/.test(h+g+f)&&!QQ.has(S)}const ZQ=new Set(["table","td","th"]);function $Q(u){return ZQ.has(dm(u))}const eZ=[":popover-open",":modal"];function C0(u){return eZ.some(h=>{try{return u.matches(h)}catch{return!1}})}const tZ=["transform","translate","scale","rotate","perspective"],nZ=["transform","translate","scale","rotate","perspective","filter"],rZ=["paint","layout","strict","content"];function D1(u){const h=k1(),f=La(u)?xa(u):u;return tZ.some(g=>f[g]?f[g]!=="none":!1)||(f.containerType?f.containerType!=="normal":!1)||!h&&(f.backdropFilter?f.backdropFilter!=="none":!1)||!h&&(f.filter?f.filter!=="none":!1)||nZ.some(g=>(f.willChange||"").includes(g))||rZ.some(g=>(f.contain||"").includes(g))}function iZ(u){let h=Jd(u);for(;Lc(h)&&!sm(h);){if(D1(h))return h;if(C0(h))return null;h=Jd(h)}return null}function k1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const sZ=new Set(["html","body","#document"]);function sm(u){return sZ.has(dm(u))}function xa(u){return ho(u).getComputedStyle(u)}function R0(u){return La(u)?{scrollLeft:u.scrollLeft,scrollTop:u.scrollTop}:{scrollLeft:u.scrollX,scrollTop:u.scrollY}}function Jd(u){if(dm(u)==="html")return u;const h=u.assignedSlot||u.parentNode||C4(u)&&u.host||xc(u);return C4(h)?h.host:h}function Zj(u){const h=Jd(u);return sm(h)?u.ownerDocument?u.ownerDocument.body:u.body:Lc(h)&&ME(h)?h:Zj(h)}function bE(u,h,f){var g;h===void 0&&(h=[]),f===void 0&&(f=!0);const S=Zj(u),C=S===((g=u.ownerDocument)==null?void 0:g.body),I=ho(S);if(C){const N=p1(I);return h.concat(I,I.visualViewport||[],ME(S)?S:[],N&&f?bE(N):[])}return h.concat(S,bE(S,[],f))}function p1(u){return u.parent&&Object.getPrototypeOf(u.parent)?u.frameElement:null}function $j(u){const h=xa(u);let f=parseFloat(h.width)||0,g=parseFloat(h.height)||0;const S=Lc(u),C=S?u.offsetWidth:f,I=S?u.offsetHeight:g,N=d0(f)!==C||d0(g)!==I;return N&&(f=C,g=I),{width:f,height:g,$:N}}function L1(u){return La(u)?u:u.contextElement}function im(u){const h=L1(u);if(!Lc(h))return kc(1);const f=h.getBoundingClientRect(),{width:g,height:S,$:C}=$j(h);let I=(C?d0(f.width):f.width)/g,N=(C?d0(f.height):f.height)/S;return(!I||!Number.isFinite(I))&&(I=1),(!N||!Number.isFinite(N))&&(N=1),{x:I,y:N}}const oZ=kc(0);function e8(u){const h=ho(u);return!k1()||!h.visualViewport?oZ:{x:h.visualViewport.offsetLeft,y:h.visualViewport.offsetTop}}function aZ(u,h,f){return h===void 0&&(h=!1),!f||h&&f!==ho(u)?!1:h}function Uh(u,h,f,g){h===void 0&&(h=!1),f===void 0&&(f=!1);const S=u.getBoundingClientRect(),C=L1(u);let I=kc(1);h&&(g?La(g)&&(I=im(g)):I=im(u));const N=aZ(C,f,g)?e8(C):kc(0);let k=(S.left+N.x)/I.x,M=(S.top+N.y)/I.y,F=S.width/I.x,B=S.height/I.y;if(C){const q=ho(C),K=g&&La(g)?ho(g):g;let ie=q,X=p1(ie);for(;X&&g&&K!==ie;){const te=im(X),ce=X.getBoundingClientRect(),$=xa(X),le=ce.left+(X.clientLeft+parseFloat($.paddingLeft))*te.x,ne=ce.top+(X.clientTop+parseFloat($.paddingTop))*te.y;k*=te.x,M*=te.y,F*=te.x,B*=te.y,k+=le,M+=ne,ie=ho(X),X=p1(ie)}}return h0({width:F,height:B,x:k,y:M})}function x1(u,h){const f=R0(u).scrollLeft;return h?h.left+f:Uh(xc(u)).left+f}function t8(u,h,f){f===void 0&&(f=!1);const g=u.getBoundingClientRect(),S=g.left+h.scrollLeft-(f?0:x1(u,g)),C=g.top+h.scrollTop;return{x:S,y:C}}function cZ(u){let{elements:h,rect:f,offsetParent:g,strategy:S}=u;const C=S==="fixed",I=xc(g),N=h?C0(h.floating):!1;if(g===I||N&&C)return f;let k={scrollLeft:0,scrollTop:0},M=kc(1);const F=kc(0),B=Lc(g);if((B||!B&&!C)&&((dm(g)!=="body"||ME(I))&&(k=R0(g)),Lc(g))){const K=Uh(g);M=im(g),F.x=K.x+g.clientLeft,F.y=K.y+g.clientTop}const q=I&&!B&&!C?t8(I,k,!0):kc(0);return{width:f.width*M.x,height:f.height*M.y,x:f.x*M.x-k.scrollLeft*M.x+F.x+q.x,y:f.y*M.y-k.scrollTop*M.y+F.y+q.y}}function lZ(u){return Array.from(u.getClientRects())}function dZ(u){const h=xc(u),f=R0(u),g=u.ownerDocument.body,S=lo(h.scrollWidth,h.clientWidth,g.scrollWidth,g.clientWidth),C=lo(h.scrollHeight,h.clientHeight,g.scrollHeight,g.clientHeight);let I=-f.scrollLeft+x1(u);const N=-f.scrollTop;return xa(g).direction==="rtl"&&(I+=lo(h.clientWidth,g.clientWidth)-S),{width:S,height:C,x:I,y:N}}function uZ(u,h){const f=ho(u),g=xc(u),S=f.visualViewport;let C=g.clientWidth,I=g.clientHeight,N=0,k=0;if(S){C=S.width,I=S.height;const M=k1();(!M||M&&h==="fixed")&&(N=S.offsetLeft,k=S.offsetTop)}return{width:C,height:I,x:N,y:k}}const hZ=new Set(["absolute","fixed"]);function pZ(u,h){const f=Uh(u,!0,h==="fixed"),g=f.top+u.clientTop,S=f.left+u.clientLeft,C=Lc(u)?im(u):kc(1),I=u.clientWidth*C.x,N=u.clientHeight*C.y,k=S*C.x,M=g*C.y;return{width:I,height:N,x:k,y:M}}function R4(u,h,f){let g;if(h==="viewport")g=uZ(u,f);else if(h==="document")g=dZ(xc(u));else if(La(h))g=pZ(h,f);else{const S=e8(u);g={x:h.x-S.x,y:h.y-S.y,width:h.width,height:h.height}}return h0(g)}function n8(u,h){const f=Jd(u);return f===h||!La(f)||sm(f)?!1:xa(f).position==="fixed"||n8(f,h)}function fZ(u,h){const f=h.get(u);if(f)return f;let g=bE(u,[],!1).filter(N=>La(N)&&dm(N)!=="body"),S=null;const C=xa(u).position==="fixed";let I=C?Jd(u):u;for(;La(I)&&!sm(I);){const N=xa(I),k=D1(I);!k&&N.position==="fixed"&&(S=null),(C?!k&&!S:!k&&N.position==="static"&&!!S&&hZ.has(S.position)||ME(I)&&!k&&n8(u,I))?g=g.filter(F=>F!==I):S=N,I=Jd(I)}return h.set(u,g),g}function mZ(u){let{element:h,boundary:f,rootBoundary:g,strategy:S}=u;const I=[...f==="clippingAncestors"?C0(h)?[]:fZ(h,this._c):[].concat(f),g],N=I[0],k=I.reduce((M,F)=>{const B=R4(h,F,S);return M.top=lo(B.top,M.top),M.right=Xd(B.right,M.right),M.bottom=Xd(B.bottom,M.bottom),M.left=lo(B.left,M.left),M},R4(h,N,S));return{width:k.right-k.left,height:k.bottom-k.top,x:k.left,y:k.top}}function _Z(u){const{width:h,height:f}=$j(u);return{width:h,height:f}}function gZ(u,h,f){const g=Lc(h),S=xc(h),C=f==="fixed",I=Uh(u,!0,C,h);let N={scrollLeft:0,scrollTop:0};const k=kc(0);function M(){k.x=x1(S)}if(g||!g&&!C)if((dm(h)!=="body"||ME(S))&&(N=R0(h)),g){const K=Uh(h,!0,C,h);k.x=K.x+h.clientLeft,k.y=K.y+h.clientTop}else S&&M();C&&!g&&S&&M();const F=S&&!g&&!C?t8(S,N):kc(0),B=I.left+N.scrollLeft-k.x-F.x,q=I.top+N.scrollTop-k.y-F.y;return{x:B,y:q,width:I.width,height:I.height}}function XI(u){return xa(u).position==="static"}function w4(u,h){if(!Lc(u)||xa(u).position==="fixed")return null;if(h)return h(u);let f=u.offsetParent;return xc(u)===f&&(f=f.ownerDocument.body),f}function r8(u,h){const f=ho(u);if(C0(u))return f;if(!Lc(u)){let S=Jd(u);for(;S&&!sm(S);){if(La(S)&&!XI(S))return S;S=Jd(S)}return f}let g=w4(u,h);for(;g&&$Q(g)&&XI(g);)g=w4(g,h);return g&&sm(g)&&XI(g)&&!D1(g)?f:g||iZ(u)||f}const EZ=async function(u){const h=this.getOffsetParent||r8,f=this.getDimensions,g=await f(u.floating);return{reference:gZ(u.reference,await h(u.floating),u.strategy),floating:{x:0,y:0,width:g.width,height:g.height}}};function vZ(u){return xa(u).direction==="rtl"}const SZ={convertOffsetParentRelativeRectToViewportRelativeRect:cZ,getDocumentElement:xc,getClippingRect:mZ,getOffsetParent:r8,getElementRects:EZ,getClientRects:lZ,getDimensions:_Z,getScale:im,isElement:La,isRTL:vZ};function i8(u,h){return u.x===h.x&&u.y===h.y&&u.width===h.width&&u.height===h.height}function yZ(u,h){let f=null,g;const S=xc(u);function C(){var N;clearTimeout(g),(N=f)==null||N.disconnect(),f=null}function I(N,k){N===void 0&&(N=!1),k===void 0&&(k=1),C();const M=u.getBoundingClientRect(),{left:F,top:B,width:q,height:K}=M;if(N||h(),!q||!K)return;const ie=XT(B),X=XT(S.clientWidth-(F+q)),te=XT(S.clientHeight-(B+K)),ce=XT(F),le={rootMargin:-ie+"px "+-X+"px "+-te+"px "+-ce+"px",threshold:lo(0,Xd(1,k))||1};let ne=!0;function de(be){const Se=be[0].intersectionRatio;if(Se!==k){if(!ne)return I();Se?I(!1,Se):g=setTimeout(()=>{I(!1,1e-7)},1e3)}Se===1&&!i8(M,u.getBoundingClientRect())&&I(),ne=!1}try{f=new IntersectionObserver(de,{...le,root:S.ownerDocument})}catch{f=new IntersectionObserver(de,le)}f.observe(u)}return I(!0),C}function TZ(u,h,f,g){g===void 0&&(g={});const{ancestorScroll:S=!0,ancestorResize:C=!0,elementResize:I=typeof ResizeObserver=="function",layoutShift:N=typeof IntersectionObserver=="function",animationFrame:k=!1}=g,M=L1(u),F=S||C?[...M?bE(M):[],...bE(h)]:[];F.forEach(ce=>{S&&ce.addEventListener("scroll",f,{passive:!0}),C&&ce.addEventListener("resize",f)});const B=M&&N?yZ(M,f):null;let q=-1,K=null;I&&(K=new ResizeObserver(ce=>{let[$]=ce;$&&$.target===M&&K&&(K.unobserve(h),cancelAnimationFrame(q),q=requestAnimationFrame(()=>{var le;(le=K)==null||le.observe(h)})),f()}),M&&!k&&K.observe(M),K.observe(h));let ie,X=k?Uh(u):null;k&&te();function te(){const ce=Uh(u);X&&!i8(X,ce)&&f(),X=ce,ie=requestAnimationFrame(te)}return f(),()=>{var ce;F.forEach($=>{S&&$.removeEventListener("scroll",f),C&&$.removeEventListener("resize",f)}),B?.(),(ce=K)==null||ce.disconnect(),K=null,k&&cancelAnimationFrame(ie)}}const CZ=YQ,RZ=qQ,wZ=HQ,bZ=JQ,IZ=KQ,b4=GQ,AZ=XQ,OZ=(u,h,f)=>{const g=new Map,S={platform:SZ,...f},C={...S.platform,_c:g};return WQ(u,h,{...S,platform:C})};var NZ=typeof document<"u",PZ=function(){},c0=NZ?ee.useLayoutEffect:PZ;function p0(u,h){if(u===h)return!0;if(typeof u!=typeof h)return!1;if(typeof u=="function"&&u.toString()===h.toString())return!0;let f,g,S;if(u&&h&&typeof u=="object"){if(Array.isArray(u)){if(f=u.length,f!==h.length)return!1;for(g=f;g--!==0;)if(!p0(u[g],h[g]))return!1;return!0}if(S=Object.keys(u),f=S.length,f!==Object.keys(h).length)return!1;for(g=f;g--!==0;)if(!{}.hasOwnProperty.call(h,S[g]))return!1;for(g=f;g--!==0;){const C=S[g];if(!(C==="_owner"&&u.$$typeof)&&!p0(u[C],h[C]))return!1}return!0}return u!==u&&h!==h}function s8(u){return typeof window>"u"?1:(u.ownerDocument.defaultView||window).devicePixelRatio||1}function I4(u,h){const f=s8(u);return Math.round(h*f)/f}function JI(u){const h=ee.useRef(u);return c0(()=>{h.current=u}),h}function DZ(u){u===void 0&&(u={});const{placement:h="bottom",strategy:f="absolute",middleware:g=[],platform:S,elements:{reference:C,floating:I}={},transform:N=!0,whileElementsMounted:k,open:M}=u,[F,B]=ee.useState({x:0,y:0,strategy:f,placement:h,middlewareData:{},isPositioned:!1}),[q,K]=ee.useState(g);p0(q,g)||K(g);const[ie,X]=ee.useState(null),[te,ce]=ee.useState(null),$=ee.useCallback(Ae=>{Ae!==be.current&&(be.current=Ae,X(Ae))},[]),le=ee.useCallback(Ae=>{Ae!==Se.current&&(Se.current=Ae,ce(Ae))},[]),ne=C||ie,de=I||te,be=ee.useRef(null),Se=ee.useRef(null),fe=ee.useRef(F),ye=k!=null,je=JI(k),Je=JI(S),Ue=JI(M),xe=ee.useCallback(()=>{if(!be.current||!Se.current)return;const Ae={placement:h,strategy:f,middleware:q};Je.current&&(Ae.platform=Je.current),OZ(be.current,Se.current,Ae).then(De=>{const ze={...De,isPositioned:Ue.current!==!1};Ge.current&&!p0(fe.current,ze)&&(fe.current=ze,E0.flushSync(()=>{B(ze)}))})},[q,h,f,Je,Ue]);c0(()=>{M===!1&&fe.current.isPositioned&&(fe.current.isPositioned=!1,B(Ae=>({...Ae,isPositioned:!1})))},[M]);const Ge=ee.useRef(!1);c0(()=>(Ge.current=!0,()=>{Ge.current=!1}),[]),c0(()=>{if(ne&&(be.current=ne),de&&(Se.current=de),ne&&de){if(je.current)return je.current(ne,de,xe);xe()}},[ne,de,xe,je,ye]);const dt=ee.useMemo(()=>({reference:be,floating:Se,setReference:$,setFloating:le}),[$,le]),Xe=ee.useMemo(()=>({reference:ne,floating:de}),[ne,de]),We=ee.useMemo(()=>{const Ae={position:f,left:0,top:0};if(!Xe.floating)return Ae;const De=I4(Xe.floating,F.x),ze=I4(Xe.floating,F.y);return N?{...Ae,transform:"translate("+De+"px, "+ze+"px)",...s8(Xe.floating)>=1.5&&{willChange:"transform"}}:{position:f,left:De,top:ze}},[f,N,Xe.floating,F.x,F.y]);return ee.useMemo(()=>({...F,update:xe,refs:dt,elements:Xe,floatingStyles:We}),[F,xe,dt,Xe,We])}const kZ=u=>{function h(f){return{}.hasOwnProperty.call(f,"current")}return{name:"arrow",options:u,fn(f){const{element:g,padding:S}=typeof u=="function"?u(f):u;return g&&h(g)?g.current!=null?b4({element:g.current,padding:S}).fn(f):{}:g?b4({element:g,padding:S}).fn(f):{}}}},LZ=(u,h)=>({...CZ(u),options:[u,h]}),xZ=(u,h)=>({...RZ(u),options:[u,h]}),MZ=(u,h)=>({...AZ(u),options:[u,h]}),UZ=(u,h)=>({...wZ(u),options:[u,h]}),VZ=(u,h)=>({...bZ(u),options:[u,h]}),jZ=(u,h)=>({...IZ(u),options:[u,h]}),FZ=(u,h)=>({...kZ(u),options:[u,h]});var BZ="Arrow",o8=ee.forwardRef((u,h)=>{const{children:f,width:g=10,height:S=5,...C}=u;return P.jsx(xs.svg,{...C,ref:h,width:g,height:S,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:u.asChild?f:P.jsx("polygon",{points:"0,0 30,0 15,10"})})});o8.displayName=BZ;var WZ=o8;function GZ(u){const[h,f]=ee.useState(void 0);return qd(()=>{if(u){f({width:u.offsetWidth,height:u.offsetHeight});const g=new ResizeObserver(S=>{if(!Array.isArray(S)||!S.length)return;const C=S[0];let I,N;if("borderBoxSize"in C){const k=C.borderBoxSize,M=Array.isArray(k)?k[0]:k;I=M.inlineSize,N=M.blockSize}else I=u.offsetWidth,N=u.offsetHeight;f({width:I,height:N})});return g.observe(u,{box:"border-box"}),()=>g.unobserve(u)}else f(void 0)},[u]),h}var a8="Popper",[c8,l8]=v0(a8),[_ne,d8]=c8(a8),u8="PopperAnchor",h8=ee.forwardRef((u,h)=>{const{__scopePopper:f,virtualRef:g,...S}=u,C=d8(u8,f),I=ee.useRef(null),N=ka(h,I);return ee.useEffect(()=>{C.onAnchorChange(g?.current||I.current)}),g?null:P.jsx(xs.div,{...S,ref:N})});h8.displayName=u8;var M1="PopperContent",[HZ,KZ]=c8(M1),p8=ee.forwardRef((u,h)=>{const{__scopePopper:f,side:g="bottom",sideOffset:S=0,align:C="center",alignOffset:I=0,arrowPadding:N=0,avoidCollisions:k=!0,collisionBoundary:M=[],collisionPadding:F=0,sticky:B="partial",hideWhenDetached:q=!1,updatePositionStrategy:K="optimized",onPlaced:ie,...X}=u,te=d8(M1,f),[ce,$]=ee.useState(null),le=ka(h,yt=>$(yt)),[ne,de]=ee.useState(null),be=GZ(ne),Se=be?.width??0,fe=be?.height??0,ye=g+(C!=="center"?"-"+C:""),je=typeof F=="number"?F:{top:0,right:0,bottom:0,left:0,...F},Je=Array.isArray(M)?M:[M],Ue=Je.length>0,xe={padding:je,boundary:Je.filter(YZ),altBoundary:Ue},{refs:Ge,floatingStyles:dt,placement:Xe,isPositioned:We,middlewareData:Ae}=DZ({strategy:"fixed",placement:ye,whileElementsMounted:(...yt)=>TZ(...yt,{animationFrame:K==="always"}),elements:{reference:te.anchor},middleware:[LZ({mainAxis:S+fe,alignmentAxis:I}),k&&xZ({mainAxis:!0,crossAxis:!1,limiter:B==="partial"?MZ():void 0,...xe}),k&&UZ({...xe}),VZ({...xe,apply:({elements:yt,rects:pn,availableWidth:vn,availableHeight:or})=>{const{width:hs,height:Ma}=pn.reference,Kr=yt.floating.style;Kr.setProperty("--radix-popper-available-width",`${vn}px`),Kr.setProperty("--radix-popper-available-height",`${or}px`),Kr.setProperty("--radix-popper-anchor-width",`${hs}px`),Kr.setProperty("--radix-popper-anchor-height",`${Ma}px`)}}),ne&&FZ({element:ne,padding:N}),qZ({arrowWidth:Se,arrowHeight:fe}),q&&jZ({strategy:"referenceHidden",...xe})]}),[De,ze]=_8(Xe),me=Yd(ie);qd(()=>{We&&me?.()},[We,me]);const ke=Ae.arrow?.x,at=Ae.arrow?.y,ot=Ae.arrow?.centerOffset!==0,[Ot,Gt]=ee.useState();return qd(()=>{ce&&Gt(window.getComputedStyle(ce).zIndex)},[ce]),P.jsx("div",{ref:Ge.setFloating,"data-radix-popper-content-wrapper":"",style:{...dt,transform:We?dt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ot,"--radix-popper-transform-origin":[Ae.transformOrigin?.x,Ae.transformOrigin?.y].join(" "),...Ae.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:u.dir,children:P.jsx(HZ,{scope:f,placedSide:De,onArrowChange:de,arrowX:ke,arrowY:at,shouldHideArrow:ot,children:P.jsx(xs.div,{"data-side":De,"data-align":ze,...X,ref:le,style:{...X.style,animation:We?void 0:"none"}})})})});p8.displayName=M1;var f8="PopperArrow",zZ={top:"bottom",right:"left",bottom:"top",left:"right"},m8=ee.forwardRef(function(h,f){const{__scopePopper:g,...S}=h,C=KZ(f8,g),I=zZ[C.placedSide];return P.jsx("span",{ref:C.onArrowChange,style:{position:"absolute",left:C.arrowX,top:C.arrowY,[I]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[C.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[C.placedSide],visibility:C.shouldHideArrow?"hidden":void 0},children:P.jsx(WZ,{...S,ref:f,style:{...S.style,display:"block"}})})});m8.displayName=f8;function YZ(u){return u!==null}var qZ=u=>({name:"transformOrigin",options:u,fn(h){const{placement:f,rects:g,middlewareData:S}=h,I=S.arrow?.centerOffset!==0,N=I?0:u.arrowWidth,k=I?0:u.arrowHeight,[M,F]=_8(f),B={start:"0%",center:"50%",end:"100%"}[F],q=(S.arrow?.x??0)+N/2,K=(S.arrow?.y??0)+k/2;let ie="",X="";return M==="bottom"?(ie=I?B:`${q}px`,X=`${-k}px`):M==="top"?(ie=I?B:`${q}px`,X=`${g.floating.height+k}px`):M==="right"?(ie=`${-k}px`,X=I?B:`${K}px`):M==="left"&&(ie=`${g.floating.width+k}px`,X=I?B:`${K}px`),{data:{x:ie,y:X}}}});function _8(u){const[h,f="center"]=u.split("-");return[h,f]}var XZ=h8,JZ=p8,QZ=m8,[w0,gne]=v0("Tooltip",[l8]),U1=l8(),g8="TooltipProvider",ZZ=700,A4="tooltip.open",[$Z,E8]=w0(g8),v8=u=>{const{__scopeTooltip:h,delayDuration:f=ZZ,skipDelayDuration:g=300,disableHoverableContent:S=!1,children:C}=u,I=ee.useRef(!0),N=ee.useRef(!1),k=ee.useRef(0);return ee.useEffect(()=>{const M=k.current;return()=>window.clearTimeout(M)},[]),P.jsx($Z,{scope:h,isOpenDelayedRef:I,delayDuration:f,onOpen:ee.useCallback(()=>{window.clearTimeout(k.current),I.current=!1},[]),onClose:ee.useCallback(()=>{window.clearTimeout(k.current),k.current=window.setTimeout(()=>I.current=!0,g)},[g]),isPointerInTransitRef:N,onPointerInTransitChange:ee.useCallback(M=>{N.current=M},[]),disableHoverableContent:S,children:C})};v8.displayName=g8;var S8="Tooltip",[Ene,b0]=w0(S8),f1="TooltipTrigger",e$=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,...g}=u,S=b0(f1,f),C=E8(f1,f),I=U1(f),N=ee.useRef(null),k=ka(h,N,S.onTriggerChange),M=ee.useRef(!1),F=ee.useRef(!1),B=ee.useCallback(()=>M.current=!1,[]);return ee.useEffect(()=>()=>document.removeEventListener("pointerup",B),[B]),P.jsx(XZ,{asChild:!0,...I,children:P.jsx(xs.button,{"aria-describedby":S.open?S.contentId:void 0,"data-state":S.stateAttribute,...g,ref:k,onPointerMove:oi(u.onPointerMove,q=>{q.pointerType!=="touch"&&!F.current&&!C.isPointerInTransitRef.current&&(S.onTriggerEnter(),F.current=!0)}),onPointerLeave:oi(u.onPointerLeave,()=>{S.onTriggerLeave(),F.current=!1}),onPointerDown:oi(u.onPointerDown,()=>{S.open&&S.onClose(),M.current=!0,document.addEventListener("pointerup",B,{once:!0})}),onFocus:oi(u.onFocus,()=>{M.current||S.onOpen()}),onBlur:oi(u.onBlur,S.onClose),onClick:oi(u.onClick,S.onClose)})})});e$.displayName=f1;var t$="TooltipPortal",[vne,n$]=w0(t$,{forceMount:void 0}),om="TooltipContent",y8=ee.forwardRef((u,h)=>{const f=n$(om,u.__scopeTooltip),{forceMount:g=f.forceMount,side:S="top",...C}=u,I=b0(om,u.__scopeTooltip);return P.jsx(R1,{present:g||I.open,children:I.disableHoverableContent?P.jsx(T8,{side:S,...C,ref:h}):P.jsx(r$,{side:S,...C,ref:h})})}),r$=ee.forwardRef((u,h)=>{const f=b0(om,u.__scopeTooltip),g=E8(om,u.__scopeTooltip),S=ee.useRef(null),C=ka(h,S),[I,N]=ee.useState(null),{trigger:k,onClose:M}=f,F=S.current,{onPointerInTransitChange:B}=g,q=ee.useCallback(()=>{N(null),B(!1)},[B]),K=ee.useCallback((ie,X)=>{const te=ie.currentTarget,ce={x:ie.clientX,y:ie.clientY},$=c$(ce,te.getBoundingClientRect()),le=l$(ce,$),ne=d$(X.getBoundingClientRect()),de=h$([...le,...ne]);N(de),B(!0)},[B]);return ee.useEffect(()=>()=>q(),[q]),ee.useEffect(()=>{if(k&&F){const ie=te=>K(te,F),X=te=>K(te,k);return k.addEventListener("pointerleave",ie),F.addEventListener("pointerleave",X),()=>{k.removeEventListener("pointerleave",ie),F.removeEventListener("pointerleave",X)}}},[k,F,K,q]),ee.useEffect(()=>{if(I){const ie=X=>{const te=X.target,ce={x:X.clientX,y:X.clientY},$=k?.contains(te)||F?.contains(te),le=!u$(ce,I);$?q():le&&(q(),M())};return document.addEventListener("pointermove",ie),()=>document.removeEventListener("pointermove",ie)}},[k,F,I,M,q]),P.jsx(T8,{...u,ref:C})}),[i$,s$]=w0(S8,{isInside:!1}),o$=_X("TooltipContent"),T8=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,children:g,"aria-label":S,onEscapeKeyDown:C,onPointerDownOutside:I,...N}=u,k=b0(om,f),M=U1(f),{onClose:F}=k;return ee.useEffect(()=>(document.addEventListener(A4,F),()=>document.removeEventListener(A4,F)),[F]),ee.useEffect(()=>{if(k.trigger){const B=q=>{q.target?.contains(k.trigger)&&F()};return window.addEventListener("scroll",B,{capture:!0}),()=>window.removeEventListener("scroll",B,{capture:!0})}},[k.trigger,F]),P.jsx(C1,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:C,onPointerDownOutside:I,onFocusOutside:B=>B.preventDefault(),onDismiss:F,children:P.jsxs(JZ,{"data-state":k.stateAttribute,...M,...N,ref:h,style:{...N.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[P.jsx(o$,{children:g}),P.jsx(i$,{scope:f,isInside:!0,children:P.jsx(BX,{id:k.contentId,role:"tooltip",children:S||g})})]})})});y8.displayName=om;var C8="TooltipArrow",a$=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,...g}=u,S=U1(f);return s$(C8,f).isInside?null:P.jsx(QZ,{...S,...g,ref:h})});a$.displayName=C8;function c$(u,h){const f=Math.abs(h.top-u.y),g=Math.abs(h.bottom-u.y),S=Math.abs(h.right-u.x),C=Math.abs(h.left-u.x);switch(Math.min(f,g,S,C)){case C:return"left";case S:return"right";case f:return"top";case g:return"bottom";default:throw new Error("unreachable")}}function l$(u,h,f=5){const g=[];switch(h){case"top":g.push({x:u.x-f,y:u.y+f},{x:u.x+f,y:u.y+f});break;case"bottom":g.push({x:u.x-f,y:u.y-f},{x:u.x+f,y:u.y-f});break;case"left":g.push({x:u.x+f,y:u.y-f},{x:u.x+f,y:u.y+f});break;case"right":g.push({x:u.x-f,y:u.y-f},{x:u.x-f,y:u.y+f});break}return g}function d$(u){const{top:h,right:f,bottom:g,left:S}=u;return[{x:S,y:h},{x:f,y:h},{x:f,y:g},{x:S,y:g}]}function u$(u,h){const{x:f,y:g}=u;let S=!1;for(let C=0,I=h.length-1;C<h.length;I=C++){const N=h[C],k=h[I],M=N.x,F=N.y,B=k.x,q=k.y;F>g!=q>g&&f<(B-M)*(g-F)/(q-F)+M&&(S=!S)}return S}function h$(u){const h=u.slice();return h.sort((f,g)=>f.x<g.x?-1:f.x>g.x?1:f.y<g.y?-1:f.y>g.y?1:0),p$(h)}function p$(u){if(u.length<=1)return u.slice();const h=[];for(let g=0;g<u.length;g++){const S=u[g];for(;h.length>=2;){const C=h[h.length-1],I=h[h.length-2];if((C.x-I.x)*(S.y-I.y)>=(C.y-I.y)*(S.x-I.x))h.pop();else break}h.push(S)}h.pop();const f=[];for(let g=u.length-1;g>=0;g--){const S=u[g];for(;f.length>=2;){const C=f[f.length-1],I=f[f.length-2];if((C.x-I.x)*(S.y-I.y)>=(C.y-I.y)*(S.x-I.x))f.pop();else break}f.push(S)}return f.pop(),h.length===1&&f.length===1&&h[0].x===f[0].x&&h[0].y===f[0].y?h:h.concat(f)}var f$=v8,R8=y8;const m$=f$,_$=ee.forwardRef(({className:u,sideOffset:h=4,...f},g)=>P.jsx(R8,{ref:g,sideOffset:h,className:Vh("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",u),...f}));_$.displayName=R8.displayName;var I0=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(u){return this.listeners.add(u),this.onSubscribe(),()=>{this.listeners.delete(u),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},A0=typeof window>"u"||"Deno"in globalThis;function Da(){}function g$(u,h){return typeof u=="function"?u(h):u}function E$(u){return typeof u=="number"&&u>=0&&u!==1/0}function v$(u,h){return Math.max(u+(h||0)-Date.now(),0)}function m1(u,h){return typeof u=="function"?u(h):u}function S$(u,h){return typeof u=="function"?u(h):u}function O4(u,h){const{type:f="all",exact:g,fetchStatus:S,predicate:C,queryKey:I,stale:N}=u;if(I){if(g){if(h.queryHash!==V1(I,h.options))return!1}else if(!AE(h.queryKey,I))return!1}if(f!=="all"){const k=h.isActive();if(f==="active"&&!k||f==="inactive"&&k)return!1}return!(typeof N=="boolean"&&h.isStale()!==N||S&&S!==h.state.fetchStatus||C&&!C(h))}function N4(u,h){const{exact:f,status:g,predicate:S,mutationKey:C}=u;if(C){if(!h.options.mutationKey)return!1;if(f){if(IE(h.options.mutationKey)!==IE(C))return!1}else if(!AE(h.options.mutationKey,C))return!1}return!(g&&h.state.status!==g||S&&!S(h))}function V1(u,h){return(h?.queryKeyHashFn||IE)(u)}function IE(u){return JSON.stringify(u,(h,f)=>_1(f)?Object.keys(f).sort().reduce((g,S)=>(g[S]=f[S],g),{}):f)}function AE(u,h){return u===h?!0:typeof u!=typeof h?!1:u&&h&&typeof u=="object"&&typeof h=="object"?Object.keys(h).every(f=>AE(u[f],h[f])):!1}function w8(u,h){if(u===h)return u;const f=P4(u)&&P4(h);if(f||_1(u)&&_1(h)){const g=f?u:Object.keys(u),S=g.length,C=f?h:Object.keys(h),I=C.length,N=f?[]:{},k=new Set(g);let M=0;for(let F=0;F<I;F++){const B=f?F:C[F];(!f&&k.has(B)||f)&&u[B]===void 0&&h[B]===void 0?(N[B]=void 0,M++):(N[B]=w8(u[B],h[B]),N[B]===u[B]&&u[B]!==void 0&&M++)}return S===I&&M===S?u:N}return h}function P4(u){return Array.isArray(u)&&u.length===Object.keys(u).length}function _1(u){if(!D4(u))return!1;const h=u.constructor;if(h===void 0)return!0;const f=h.prototype;return!(!D4(f)||!f.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(u)!==Object.prototype)}function D4(u){return Object.prototype.toString.call(u)==="[object Object]"}function y$(u){return new Promise(h=>{setTimeout(h,u)})}function T$(u,h,f){return typeof f.structuralSharing=="function"?f.structuralSharing(u,h):f.structuralSharing!==!1?w8(u,h):h}function C$(u,h,f=0){const g=[...u,h];return f&&g.length>f?g.slice(1):g}function R$(u,h,f=0){const g=[h,...u];return f&&g.length>f?g.slice(0,-1):g}var j1=Symbol();function b8(u,h){return!u.queryFn&&h?.initialPromise?()=>h.initialPromise:!u.queryFn||u.queryFn===j1?()=>Promise.reject(new Error(`Missing queryFn: '${u.queryHash}'`)):u.queryFn}var w$=class extends I0{#e;#t;#n;constructor(){super(),this.#n=u=>{if(!A0&&window.addEventListener){const h=()=>u();return window.addEventListener("visibilitychange",h,!1),()=>{window.removeEventListener("visibilitychange",h)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(h=>{typeof h=="boolean"?this.setFocused(h):this.onFocus()})}setFocused(u){this.#e!==u&&(this.#e=u,this.onFocus())}onFocus(){const u=this.isFocused();this.listeners.forEach(h=>{h(u)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},I8=new w$,b$=class extends I0{#e=!0;#t;#n;constructor(){super(),this.#n=u=>{if(!A0&&window.addEventListener){const h=()=>u(!0),f=()=>u(!1);return window.addEventListener("online",h,!1),window.addEventListener("offline",f,!1),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",f)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(this.setOnline.bind(this))}setOnline(u){this.#e!==u&&(this.#e=u,this.listeners.forEach(f=>{f(u)}))}isOnline(){return this.#e}},f0=new b$;function I$(){let u,h;const f=new Promise((S,C)=>{u=S,h=C});f.status="pending",f.catch(()=>{});function g(S){Object.assign(f,S),delete f.resolve,delete f.reject}return f.resolve=S=>{g({status:"fulfilled",value:S}),u(S)},f.reject=S=>{g({status:"rejected",reason:S}),h(S)},f}function A$(u){return Math.min(1e3*2**u,3e4)}function A8(u){return(u??"online")==="online"?f0.isOnline():!0}var O8=class extends Error{constructor(u){super("CancelledError"),this.revert=u?.revert,this.silent=u?.silent}};function QI(u){return u instanceof O8}function N8(u){let h=!1,f=0,g=!1,S;const C=I$(),I=X=>{g||(q(new O8(X)),u.abort?.())},N=()=>{h=!0},k=()=>{h=!1},M=()=>I8.isFocused()&&(u.networkMode==="always"||f0.isOnline())&&u.canRun(),F=()=>A8(u.networkMode)&&u.canRun(),B=X=>{g||(g=!0,u.onSuccess?.(X),S?.(),C.resolve(X))},q=X=>{g||(g=!0,u.onError?.(X),S?.(),C.reject(X))},K=()=>new Promise(X=>{S=te=>{(g||M())&&X(te)},u.onPause?.()}).then(()=>{S=void 0,g||u.onContinue?.()}),ie=()=>{if(g)return;let X;const te=f===0?u.initialPromise:void 0;try{X=te??u.fn()}catch(ce){X=Promise.reject(ce)}Promise.resolve(X).then(B).catch(ce=>{if(g)return;const $=u.retry??(A0?0:3),le=u.retryDelay??A$,ne=typeof le=="function"?le(f,ce):le,de=$===!0||typeof $=="number"&&f<$||typeof $=="function"&&$(f,ce);if(h||!de){q(ce);return}f++,u.onFail?.(f,ce),y$(ne).then(()=>M()?void 0:K()).then(()=>{h?q(ce):ie()})})};return{promise:C,cancel:I,continue:()=>(S?.(),C),cancelRetry:N,continueRetry:k,canStart:F,start:()=>(F()?ie():K().then(ie),C)}}var O$=u=>setTimeout(u,0);function N$(){let u=[],h=0,f=N=>{N()},g=N=>{N()},S=O$;const C=N=>{h?u.push(N):S(()=>{f(N)})},I=()=>{const N=u;u=[],N.length&&S(()=>{g(()=>{N.forEach(k=>{f(k)})})})};return{batch:N=>{let k;h++;try{k=N()}finally{h--,h||I()}return k},batchCalls:N=>(...k)=>{C(()=>{N(...k)})},schedule:C,setNotifyFunction:N=>{f=N},setBatchNotifyFunction:N=>{g=N},setScheduler:N=>{S=N}}}var ls=N$(),P8=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),E$(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(u){this.gcTime=Math.max(this.gcTime||0,u??(A0?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},P$=class extends P8{#e;#t;#n;#i;#r;#o;#a;constructor(u){super(),this.#a=!1,this.#o=u.defaultOptions,this.setOptions(u.options),this.observers=[],this.#i=u.client,this.#n=this.#i.getQueryCache(),this.queryKey=u.queryKey,this.queryHash=u.queryHash,this.#e=k$(this.options),this.state=u.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(u){this.options={...this.#o,...u},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(u,h){const f=T$(this.state.data,u,this.options);return this.#s({data:f,type:"success",dataUpdatedAt:h?.updatedAt,manual:h?.manual}),f}setState(u,h){this.#s({type:"setState",state:u,setStateOptions:h})}cancel(u){const h=this.#r?.promise;return this.#r?.cancel(u),h?h.then(Da).catch(Da):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(u=>S$(u.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===j1||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(u=>m1(u.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(u=>u.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(u=0){return this.state.data===void 0?!0:u==="static"?!1:this.state.isInvalidated?!0:!v$(this.state.dataUpdatedAt,u)}onFocus(){this.observers.find(h=>h.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(h=>h.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(u){this.observers.includes(u)||(this.observers.push(u),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:u}))}removeObserver(u){this.observers.includes(u)&&(this.observers=this.observers.filter(h=>h!==u),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:u}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}fetch(u,h){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&h?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(u&&this.setOptions(u),!this.options.queryFn){const k=this.observers.find(M=>M.options.queryFn);k&&this.setOptions(k.options)}const f=new AbortController,g=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(this.#a=!0,f.signal)})},S=()=>{const k=b8(this.options,h),F=(()=>{const B={client:this.#i,queryKey:this.queryKey,meta:this.meta};return g(B),B})();return this.#a=!1,this.options.persister?this.options.persister(k,F,this):k(F)},I=(()=>{const k={fetchOptions:h,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:S};return g(k),k})();this.options.behavior?.onFetch(I,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==I.fetchOptions?.meta)&&this.#s({type:"fetch",meta:I.fetchOptions?.meta});const N=k=>{QI(k)&&k.silent||this.#s({type:"error",error:k}),QI(k)||(this.#n.config.onError?.(k,this),this.#n.config.onSettled?.(this.state.data,k,this)),this.scheduleGc()};return this.#r=N8({initialPromise:h?.initialPromise,fn:I.fetchFn,abort:f.abort.bind(f),onSuccess:k=>{if(k===void 0){N(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(k)}catch(M){N(M);return}this.#n.config.onSuccess?.(k,this),this.#n.config.onSettled?.(k,this.state.error,this),this.scheduleGc()},onError:N,onFail:(k,M)=>{this.#s({type:"failed",failureCount:k,error:M})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:I.options.retry,retryDelay:I.options.retryDelay,networkMode:I.options.networkMode,canRun:()=>!0}),this.#r.start()}#s(u){const h=f=>{switch(u.type){case"failed":return{...f,fetchFailureCount:u.failureCount,fetchFailureReason:u.error};case"pause":return{...f,fetchStatus:"paused"};case"continue":return{...f,fetchStatus:"fetching"};case"fetch":return{...f,...D$(f.data,this.options),fetchMeta:u.meta??null};case"success":return this.#t=void 0,{...f,data:u.data,dataUpdateCount:f.dataUpdateCount+1,dataUpdatedAt:u.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!u.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const g=u.error;return QI(g)&&g.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...f,error:g,errorUpdateCount:f.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:f.fetchFailureCount+1,fetchFailureReason:g,fetchStatus:"idle",status:"error"};case"invalidate":return{...f,isInvalidated:!0};case"setState":return{...f,...u.state}}};this.state=h(this.state),ls.batch(()=>{this.observers.forEach(f=>{f.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:u})})}};function D$(u,h){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:A8(h.networkMode)?"fetching":"paused",...u===void 0&&{error:null,status:"pending"}}}function k$(u){const h=typeof u.initialData=="function"?u.initialData():u.initialData,f=h!==void 0,g=f?typeof u.initialDataUpdatedAt=="function"?u.initialDataUpdatedAt():u.initialDataUpdatedAt:0;return{data:h,dataUpdateCount:0,dataUpdatedAt:f?g??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:f?"success":"pending",fetchStatus:"idle"}}var L$=class extends I0{constructor(u={}){super(),this.config=u,this.#e=new Map}#e;build(u,h,f){const g=h.queryKey,S=h.queryHash??V1(g,h);let C=this.get(S);return C||(C=new P$({client:u,queryKey:g,queryHash:S,options:u.defaultQueryOptions(h),state:f,defaultOptions:u.getQueryDefaults(g)}),this.add(C)),C}add(u){this.#e.has(u.queryHash)||(this.#e.set(u.queryHash,u),this.notify({type:"added",query:u}))}remove(u){const h=this.#e.get(u.queryHash);h&&(u.destroy(),h===u&&this.#e.delete(u.queryHash),this.notify({type:"removed",query:u}))}clear(){ls.batch(()=>{this.getAll().forEach(u=>{this.remove(u)})})}get(u){return this.#e.get(u)}getAll(){return[...this.#e.values()]}find(u){const h={exact:!0,...u};return this.getAll().find(f=>O4(h,f))}findAll(u={}){const h=this.getAll();return Object.keys(u).length>0?h.filter(f=>O4(u,f)):h}notify(u){ls.batch(()=>{this.listeners.forEach(h=>{h(u)})})}onFocus(){ls.batch(()=>{this.getAll().forEach(u=>{u.onFocus()})})}onOnline(){ls.batch(()=>{this.getAll().forEach(u=>{u.onOnline()})})}},x$=class extends P8{#e;#t;#n;constructor(u){super(),this.mutationId=u.mutationId,this.#t=u.mutationCache,this.#e=[],this.state=u.state||M$(),this.setOptions(u.options),this.scheduleGc()}setOptions(u){this.options=u,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(u){this.#e.includes(u)||(this.#e.push(u),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:u}))}removeObserver(u){this.#e=this.#e.filter(h=>h!==u),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:u})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(u){const h=()=>{this.#i({type:"continue"})};this.#n=N8({fn:()=>this.options.mutationFn?this.options.mutationFn(u):Promise.reject(new Error("No mutationFn found")),onFail:(S,C)=>{this.#i({type:"failed",failureCount:S,error:C})},onPause:()=>{this.#i({type:"pause"})},onContinue:h,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const f=this.state.status==="pending",g=!this.#n.canStart();try{if(f)h();else{this.#i({type:"pending",variables:u,isPaused:g}),await this.#t.config.onMutate?.(u,this);const C=await this.options.onMutate?.(u);C!==this.state.context&&this.#i({type:"pending",context:C,variables:u,isPaused:g})}const S=await this.#n.start();return await this.#t.config.onSuccess?.(S,u,this.state.context,this),await this.options.onSuccess?.(S,u,this.state.context),await this.#t.config.onSettled?.(S,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(S,null,u,this.state.context),this.#i({type:"success",data:S}),S}catch(S){try{throw await this.#t.config.onError?.(S,u,this.state.context,this),await this.options.onError?.(S,u,this.state.context),await this.#t.config.onSettled?.(void 0,S,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,S,u,this.state.context),S}finally{this.#i({type:"error",error:S})}}finally{this.#t.runNext(this)}}#i(u){const h=f=>{switch(u.type){case"failed":return{...f,failureCount:u.failureCount,failureReason:u.error};case"pause":return{...f,isPaused:!0};case"continue":return{...f,isPaused:!1};case"pending":return{...f,context:u.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:u.isPaused,status:"pending",variables:u.variables,submittedAt:Date.now()};case"success":return{...f,data:u.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...f,data:void 0,error:u.error,failureCount:f.failureCount+1,failureReason:u.error,isPaused:!1,status:"error"}}};this.state=h(this.state),ls.batch(()=>{this.#e.forEach(f=>{f.onMutationUpdate(u)}),this.#t.notify({mutation:this,type:"updated",action:u})})}};function M$(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var U$=class extends I0{constructor(u={}){super(),this.config=u,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(u,h,f){const g=new x$({mutationCache:this,mutationId:++this.#n,options:u.defaultMutationOptions(h),state:f});return this.add(g),g}add(u){this.#e.add(u);const h=JT(u);if(typeof h=="string"){const f=this.#t.get(h);f?f.push(u):this.#t.set(h,[u])}this.notify({type:"added",mutation:u})}remove(u){if(this.#e.delete(u)){const h=JT(u);if(typeof h=="string"){const f=this.#t.get(h);if(f)if(f.length>1){const g=f.indexOf(u);g!==-1&&f.splice(g,1)}else f[0]===u&&this.#t.delete(h)}}this.notify({type:"removed",mutation:u})}canRun(u){const h=JT(u);if(typeof h=="string"){const g=this.#t.get(h)?.find(S=>S.state.status==="pending");return!g||g===u}else return!0}runNext(u){const h=JT(u);return typeof h=="string"?this.#t.get(h)?.find(g=>g!==u&&g.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ls.batch(()=>{this.#e.forEach(u=>{this.notify({type:"removed",mutation:u})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(u){const h={exact:!0,...u};return this.getAll().find(f=>N4(h,f))}findAll(u={}){return this.getAll().filter(h=>N4(u,h))}notify(u){ls.batch(()=>{this.listeners.forEach(h=>{h(u)})})}resumePausedMutations(){const u=this.getAll().filter(h=>h.state.isPaused);return ls.batch(()=>Promise.all(u.map(h=>h.continue().catch(Da))))}};function JT(u){return u.options.scope?.id}function k4(u){return{onFetch:(h,f)=>{const g=h.options,S=h.fetchOptions?.meta?.fetchMore?.direction,C=h.state.data?.pages||[],I=h.state.data?.pageParams||[];let N={pages:[],pageParams:[]},k=0;const M=async()=>{let F=!1;const B=ie=>{Object.defineProperty(ie,"signal",{enumerable:!0,get:()=>(h.signal.aborted?F=!0:h.signal.addEventListener("abort",()=>{F=!0}),h.signal)})},q=b8(h.options,h.fetchOptions),K=async(ie,X,te)=>{if(F)return Promise.reject();if(X==null&&ie.pages.length)return Promise.resolve(ie);const $=(()=>{const be={client:h.client,queryKey:h.queryKey,pageParam:X,direction:te?"backward":"forward",meta:h.options.meta};return B(be),be})(),le=await q($),{maxPages:ne}=h.options,de=te?R$:C$;return{pages:de(ie.pages,le,ne),pageParams:de(ie.pageParams,X,ne)}};if(S&&C.length){const ie=S==="backward",X=ie?V$:L4,te={pages:C,pageParams:I},ce=X(g,te);N=await K(te,ce,ie)}else{const ie=u??C.length;do{const X=k===0?I[0]??g.initialPageParam:L4(g,N);if(k>0&&X==null)break;N=await K(N,X),k++}while(k<ie)}return N};h.options.persister?h.fetchFn=()=>h.options.persister?.(M,{client:h.client,queryKey:h.queryKey,meta:h.options.meta,signal:h.signal},f):h.fetchFn=M}}}function L4(u,{pages:h,pageParams:f}){const g=h.length-1;return h.length>0?u.getNextPageParam(h[g],h,f[g],f):void 0}function V$(u,{pages:h,pageParams:f}){return h.length>0?u.getPreviousPageParam?.(h[0],h,f[0],f):void 0}var j$=class{#e;#t;#n;#i;#r;#o;#a;#s;constructor(u={}){this.#e=u.queryCache||new L$,this.#t=u.mutationCache||new U$,this.#n=u.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=I8.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=f0.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(u){return this.#e.findAll({...u,fetchStatus:"fetching"}).length}isMutating(u){return this.#t.findAll({...u,status:"pending"}).length}getQueryData(u){const h=this.defaultQueryOptions({queryKey:u});return this.#e.get(h.queryHash)?.state.data}ensureQueryData(u){const h=this.defaultQueryOptions(u),f=this.#e.build(this,h),g=f.state.data;return g===void 0?this.fetchQuery(u):(u.revalidateIfStale&&f.isStaleByTime(m1(h.staleTime,f))&&this.prefetchQuery(h),Promise.resolve(g))}getQueriesData(u){return this.#e.findAll(u).map(({queryKey:h,state:f})=>{const g=f.data;return[h,g]})}setQueryData(u,h,f){const g=this.defaultQueryOptions({queryKey:u}),C=this.#e.get(g.queryHash)?.state.data,I=g$(h,C);if(I!==void 0)return this.#e.build(this,g).setData(I,{...f,manual:!0})}setQueriesData(u,h,f){return ls.batch(()=>this.#e.findAll(u).map(({queryKey:g})=>[g,this.setQueryData(g,h,f)]))}getQueryState(u){const h=this.defaultQueryOptions({queryKey:u});return this.#e.get(h.queryHash)?.state}removeQueries(u){const h=this.#e;ls.batch(()=>{h.findAll(u).forEach(f=>{h.remove(f)})})}resetQueries(u,h){const f=this.#e;return ls.batch(()=>(f.findAll(u).forEach(g=>{g.reset()}),this.refetchQueries({type:"active",...u},h)))}cancelQueries(u,h={}){const f={revert:!0,...h},g=ls.batch(()=>this.#e.findAll(u).map(S=>S.cancel(f)));return Promise.all(g).then(Da).catch(Da)}invalidateQueries(u,h={}){return ls.batch(()=>(this.#e.findAll(u).forEach(f=>{f.invalidate()}),u?.refetchType==="none"?Promise.resolve():this.refetchQueries({...u,type:u?.refetchType??u?.type??"active"},h)))}refetchQueries(u,h={}){const f={...h,cancelRefetch:h.cancelRefetch??!0},g=ls.batch(()=>this.#e.findAll(u).filter(S=>!S.isDisabled()&&!S.isStatic()).map(S=>{let C=S.fetch(void 0,f);return f.throwOnError||(C=C.catch(Da)),S.state.fetchStatus==="paused"?Promise.resolve():C}));return Promise.all(g).then(Da)}fetchQuery(u){const h=this.defaultQueryOptions(u);h.retry===void 0&&(h.retry=!1);const f=this.#e.build(this,h);return f.isStaleByTime(m1(h.staleTime,f))?f.fetch(h):Promise.resolve(f.state.data)}prefetchQuery(u){return this.fetchQuery(u).then(Da).catch(Da)}fetchInfiniteQuery(u){return u.behavior=k4(u.pages),this.fetchQuery(u)}prefetchInfiniteQuery(u){return this.fetchInfiniteQuery(u).then(Da).catch(Da)}ensureInfiniteQueryData(u){return u.behavior=k4(u.pages),this.ensureQueryData(u)}resumePausedMutations(){return f0.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(u){this.#n=u}setQueryDefaults(u,h){this.#i.set(IE(u),{queryKey:u,defaultOptions:h})}getQueryDefaults(u){const h=[...this.#i.values()],f={};return h.forEach(g=>{AE(u,g.queryKey)&&Object.assign(f,g.defaultOptions)}),f}setMutationDefaults(u,h){this.#r.set(IE(u),{mutationKey:u,defaultOptions:h})}getMutationDefaults(u){const h=[...this.#r.values()],f={};return h.forEach(g=>{AE(u,g.mutationKey)&&Object.assign(f,g.defaultOptions)}),f}defaultQueryOptions(u){if(u._defaulted)return u;const h={...this.#n.queries,...this.getQueryDefaults(u.queryKey),...u,_defaulted:!0};return h.queryHash||(h.queryHash=V1(h.queryKey,h)),h.refetchOnReconnect===void 0&&(h.refetchOnReconnect=h.networkMode!=="always"),h.throwOnError===void 0&&(h.throwOnError=!!h.suspense),!h.networkMode&&h.persister&&(h.networkMode="offlineFirst"),h.queryFn===j1&&(h.enabled=!1),h}defaultMutationOptions(u){return u?._defaulted?u:{...this.#n.mutations,...u?.mutationKey&&this.getMutationDefaults(u.mutationKey),...u,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},F$=ee.createContext(void 0),B$=({client:u,children:h})=>(ee.useEffect(()=>(u.mount(),()=>{u.unmount()}),[u]),P.jsx(F$.Provider,{value:u,children:h}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function OE(){return OE=Object.assign?Object.assign.bind():function(u){for(var h=1;h<arguments.length;h++){var f=arguments[h];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])}return u},OE.apply(this,arguments)}var zd;(function(u){u.Pop="POP",u.Push="PUSH",u.Replace="REPLACE"})(zd||(zd={}));const x4="popstate";function W$(u){u===void 0&&(u={});function h(g,S){let{pathname:C,search:I,hash:N}=g.location;return g1("",{pathname:C,search:I,hash:N},S.state&&S.state.usr||null,S.state&&S.state.key||"default")}function f(g,S){return typeof S=="string"?S:k8(S)}return H$(h,f,null,u)}function ai(u,h){if(u===!1||u===null||typeof u>"u")throw new Error(h)}function D8(u,h){if(!u){typeof console<"u"&&console.warn(h);try{throw new Error(h)}catch{}}}function G$(){return Math.random().toString(36).substr(2,8)}function M4(u,h){return{usr:u.state,key:u.key,idx:h}}function g1(u,h,f,g){return f===void 0&&(f=null),OE({pathname:typeof u=="string"?u:u.pathname,search:"",hash:""},typeof h=="string"?um(h):h,{state:f,key:h&&h.key||g||G$()})}function k8(u){let{pathname:h="/",search:f="",hash:g=""}=u;return f&&f!=="?"&&(h+=f.charAt(0)==="?"?f:"?"+f),g&&g!=="#"&&(h+=g.charAt(0)==="#"?g:"#"+g),h}function um(u){let h={};if(u){let f=u.indexOf("#");f>=0&&(h.hash=u.substr(f),u=u.substr(0,f));let g=u.indexOf("?");g>=0&&(h.search=u.substr(g),u=u.substr(0,g)),u&&(h.pathname=u)}return h}function H$(u,h,f,g){g===void 0&&(g={});let{window:S=document.defaultView,v5Compat:C=!1}=g,I=S.history,N=zd.Pop,k=null,M=F();M==null&&(M=0,I.replaceState(OE({},I.state,{idx:M}),""));function F(){return(I.state||{idx:null}).idx}function B(){N=zd.Pop;let te=F(),ce=te==null?null:te-M;M=te,k&&k({action:N,location:X.location,delta:ce})}function q(te,ce){N=zd.Push;let $=g1(X.location,te,ce);M=F()+1;let le=M4($,M),ne=X.createHref($);try{I.pushState(le,"",ne)}catch(de){if(de instanceof DOMException&&de.name==="DataCloneError")throw de;S.location.assign(ne)}C&&k&&k({action:N,location:X.location,delta:1})}function K(te,ce){N=zd.Replace;let $=g1(X.location,te,ce);M=F();let le=M4($,M),ne=X.createHref($);I.replaceState(le,"",ne),C&&k&&k({action:N,location:X.location,delta:0})}function ie(te){let ce=S.location.origin!=="null"?S.location.origin:S.location.href,$=typeof te=="string"?te:k8(te);return $=$.replace(/ $/,"%20"),ai(ce,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,ce)}let X={get action(){return N},get location(){return u(S,I)},listen(te){if(k)throw new Error("A history only accepts one active listener");return S.addEventListener(x4,B),k=te,()=>{S.removeEventListener(x4,B),k=null}},createHref(te){return h(S,te)},createURL:ie,encodeLocation(te){let ce=ie(te);return{pathname:ce.pathname,search:ce.search,hash:ce.hash}},push:q,replace:K,go(te){return I.go(te)}};return X}var U4;(function(u){u.data="data",u.deferred="deferred",u.redirect="redirect",u.error="error"})(U4||(U4={}));function K$(u,h,f){return f===void 0&&(f="/"),z$(u,h,f)}function z$(u,h,f,g){let S=typeof h=="string"?um(h):h,C=M8(S.pathname||"/",f);if(C==null)return null;let I=L8(u);Y$(I);let N=null;for(let k=0;N==null&&k<I.length;++k){let M=see(C);N=nee(I[k],M)}return N}function L8(u,h,f,g){h===void 0&&(h=[]),f===void 0&&(f=[]),g===void 0&&(g="");let S=(C,I,N)=>{let k={relativePath:N===void 0?C.path||"":N,caseSensitive:C.caseSensitive===!0,childrenIndex:I,route:C};k.relativePath.startsWith("/")&&(ai(k.relativePath.startsWith(g),'Absolute route path "'+k.relativePath+'" nested under path '+('"'+g+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),k.relativePath=k.relativePath.slice(g.length));let M=Mh([g,k.relativePath]),F=f.concat(k);C.children&&C.children.length>0&&(ai(C.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+M+'".')),L8(C.children,h,F,M)),!(C.path==null&&!C.index)&&h.push({path:M,score:eee(M,C.index),routesMeta:F})};return u.forEach((C,I)=>{var N;if(C.path===""||!((N=C.path)!=null&&N.includes("?")))S(C,I);else for(let k of x8(C.path))S(C,I,k)}),h}function x8(u){let h=u.split("/");if(h.length===0)return[];let[f,...g]=h,S=f.endsWith("?"),C=f.replace(/\?$/,"");if(g.length===0)return S?[C,""]:[C];let I=x8(g.join("/")),N=[];return N.push(...I.map(k=>k===""?C:[C,k].join("/"))),S&&N.push(...I),N.map(k=>u.startsWith("/")&&k===""?"/":k)}function Y$(u){u.sort((h,f)=>h.score!==f.score?f.score-h.score:tee(h.routesMeta.map(g=>g.childrenIndex),f.routesMeta.map(g=>g.childrenIndex)))}const q$=/^:[\w-]+$/,X$=3,J$=2,Q$=1,Z$=10,$$=-2,V4=u=>u==="*";function eee(u,h){let f=u.split("/"),g=f.length;return f.some(V4)&&(g+=$$),h&&(g+=J$),f.filter(S=>!V4(S)).reduce((S,C)=>S+(q$.test(C)?X$:C===""?Q$:Z$),g)}function tee(u,h){return u.length===h.length&&u.slice(0,-1).every((g,S)=>g===h[S])?u[u.length-1]-h[h.length-1]:0}function nee(u,h,f){let{routesMeta:g}=u,S={},C="/",I=[];for(let N=0;N<g.length;++N){let k=g[N],M=N===g.length-1,F=C==="/"?h:h.slice(C.length)||"/",B=ree({path:k.relativePath,caseSensitive:k.caseSensitive,end:M},F),q=k.route;if(!B)return null;Object.assign(S,B.params),I.push({params:S,pathname:Mh([C,B.pathname]),pathnameBase:uee(Mh([C,B.pathnameBase])),route:q}),B.pathnameBase!=="/"&&(C=Mh([C,B.pathnameBase]))}return I}function ree(u,h){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[f,g]=iee(u.path,u.caseSensitive,u.end),S=h.match(f);if(!S)return null;let C=S[0],I=C.replace(/(.)\/+$/,"$1"),N=S.slice(1);return{params:g.reduce((M,F,B)=>{let{paramName:q,isOptional:K}=F;if(q==="*"){let X=N[B]||"";I=C.slice(0,C.length-X.length).replace(/(.)\/+$/,"$1")}const ie=N[B];return K&&!ie?M[q]=void 0:M[q]=(ie||"").replace(/%2F/g,"/"),M},{}),pathname:C,pathnameBase:I,pattern:u}}function iee(u,h,f){h===void 0&&(h=!1),f===void 0&&(f=!0),D8(u==="*"||!u.endsWith("*")||u.endsWith("/*"),'Route path "'+u+'" will be treated as if it were '+('"'+u.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+u.replace(/\*$/,"/*")+'".'));let g=[],S="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(I,N,k)=>(g.push({paramName:N,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return u.endsWith("*")?(g.push({paramName:"*"}),S+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):f?S+="\\/*$":u!==""&&u!=="/"&&(S+="(?:(?=\\/|$))"),[new RegExp(S,h?void 0:"i"),g]}function see(u){try{return u.split("/").map(h=>decodeURIComponent(h).replace(/\//g,"%2F")).join("/")}catch(h){return D8(!1,'The URL path "'+u+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+h+").")),u}}function M8(u,h){if(h==="/")return u;if(!u.toLowerCase().startsWith(h.toLowerCase()))return null;let f=h.endsWith("/")?h.length-1:h.length,g=u.charAt(f);return g&&g!=="/"?null:u.slice(f)||"/"}function oee(u,h){h===void 0&&(h="/");let{pathname:f,search:g="",hash:S=""}=typeof u=="string"?um(u):u;return{pathname:f?f.startsWith("/")?f:aee(f,h):h,search:hee(g),hash:pee(S)}}function aee(u,h){let f=h.replace(/\/+$/,"").split("/");return u.split("/").forEach(S=>{S===".."?f.length>1&&f.pop():S!=="."&&f.push(S)}),f.length>1?f.join("/"):"/"}function ZI(u,h,f,g){return"Cannot include a '"+u+"' character in a manually specified "+("`to."+h+"` field ["+JSON.stringify(g)+"].  Please separate it out to the ")+("`to."+f+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function cee(u){return u.filter((h,f)=>f===0||h.route.path&&h.route.path.length>0)}function lee(u,h){let f=cee(u);return h?f.map((g,S)=>S===f.length-1?g.pathname:g.pathnameBase):f.map(g=>g.pathnameBase)}function dee(u,h,f,g){g===void 0&&(g=!1);let S;typeof u=="string"?S=um(u):(S=OE({},u),ai(!S.pathname||!S.pathname.includes("?"),ZI("?","pathname","search",S)),ai(!S.pathname||!S.pathname.includes("#"),ZI("#","pathname","hash",S)),ai(!S.search||!S.search.includes("#"),ZI("#","search","hash",S)));let C=u===""||S.pathname==="",I=C?"/":S.pathname,N;if(I==null)N=f;else{let B=h.length-1;if(!g&&I.startsWith("..")){let q=I.split("/");for(;q[0]==="..";)q.shift(),B-=1;S.pathname=q.join("/")}N=B>=0?h[B]:"/"}let k=oee(S,N),M=I&&I!=="/"&&I.endsWith("/"),F=(C||I===".")&&f.endsWith("/");return!k.pathname.endsWith("/")&&(M||F)&&(k.pathname+="/"),k}const Mh=u=>u.join("/").replace(/\/\/+/g,"/"),uee=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),hee=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,pee=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function fee(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}const U8=["post","put","patch","delete"];new Set(U8);const mee=["get",...U8];new Set(mee);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function NE(){return NE=Object.assign?Object.assign.bind():function(u){for(var h=1;h<arguments.length;h++){var f=arguments[h];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])}return u},NE.apply(this,arguments)}const F1=ee.createContext(null),_ee=ee.createContext(null),O0=ee.createContext(null),N0=ee.createContext(null),hm=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),V8=ee.createContext(null);function P0(){return ee.useContext(N0)!=null}function D0(){return P0()||ai(!1),ee.useContext(N0).location}function j8(u){ee.useContext(O0).static||ee.useLayoutEffect(u)}function jh(){let{isDataRoute:u}=ee.useContext(hm);return u?Oee():gee()}function gee(){P0()||ai(!1);let u=ee.useContext(F1),{basename:h,future:f,navigator:g}=ee.useContext(O0),{matches:S}=ee.useContext(hm),{pathname:C}=D0(),I=JSON.stringify(lee(S,f.v7_relativeSplatPath)),N=ee.useRef(!1);return j8(()=>{N.current=!0}),ee.useCallback(function(M,F){if(F===void 0&&(F={}),!N.current)return;if(typeof M=="number"){g.go(M);return}let B=dee(M,JSON.parse(I),C,F.relative==="path");u==null&&h!=="/"&&(B.pathname=B.pathname==="/"?h:Mh([h,B.pathname])),(F.replace?g.replace:g.push)(B,F.state,F)},[h,g,I,C,u])}function Eee(u,h){return vee(u,h)}function vee(u,h,f,g){P0()||ai(!1);let{navigator:S}=ee.useContext(O0),{matches:C}=ee.useContext(hm),I=C[C.length-1],N=I?I.params:{};I&&I.pathname;let k=I?I.pathnameBase:"/";I&&I.route;let M=D0(),F;if(h){var B;let te=typeof h=="string"?um(h):h;k==="/"||(B=te.pathname)!=null&&B.startsWith(k)||ai(!1),F=te}else F=M;let q=F.pathname||"/",K=q;if(k!=="/"){let te=k.replace(/^\//,"").split("/");K="/"+q.replace(/^\//,"").split("/").slice(te.length).join("/")}let ie=K$(u,{pathname:K}),X=Ree(ie&&ie.map(te=>Object.assign({},te,{params:Object.assign({},N,te.params),pathname:Mh([k,S.encodeLocation?S.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?k:Mh([k,S.encodeLocation?S.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),C,f,g);return h&&X?ee.createElement(N0.Provider,{value:{location:NE({pathname:"/",search:"",hash:"",state:null,key:"default"},F),navigationType:zd.Pop}},X):X}function See(){let u=Aee(),h=fee(u)?u.status+" "+u.statusText:u instanceof Error?u.message:JSON.stringify(u),f=u instanceof Error?u.stack:null,S={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},h),f?ee.createElement("pre",{style:S},f):null,null)}const yee=ee.createElement(See,null);class Tee extends ee.Component{constructor(h){super(h),this.state={location:h.location,revalidation:h.revalidation,error:h.error}}static getDerivedStateFromError(h){return{error:h}}static getDerivedStateFromProps(h,f){return f.location!==h.location||f.revalidation!=="idle"&&h.revalidation==="idle"?{error:h.error,location:h.location,revalidation:h.revalidation}:{error:h.error!==void 0?h.error:f.error,location:f.location,revalidation:h.revalidation||f.revalidation}}componentDidCatch(h,f){console.error("React Router caught the following error during render",h,f)}render(){return this.state.error!==void 0?ee.createElement(hm.Provider,{value:this.props.routeContext},ee.createElement(V8.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Cee(u){let{routeContext:h,match:f,children:g}=u,S=ee.useContext(F1);return S&&S.static&&S.staticContext&&(f.route.errorElement||f.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=f.route.id),ee.createElement(hm.Provider,{value:h},g)}function Ree(u,h,f,g){var S;if(h===void 0&&(h=[]),f===void 0&&(f=null),g===void 0&&(g=null),u==null){var C;if(!f)return null;if(f.errors)u=f.matches;else if((C=g)!=null&&C.v7_partialHydration&&h.length===0&&!f.initialized&&f.matches.length>0)u=f.matches;else return null}let I=u,N=(S=f)==null?void 0:S.errors;if(N!=null){let F=I.findIndex(B=>B.route.id&&N?.[B.route.id]!==void 0);F>=0||ai(!1),I=I.slice(0,Math.min(I.length,F+1))}let k=!1,M=-1;if(f&&g&&g.v7_partialHydration)for(let F=0;F<I.length;F++){let B=I[F];if((B.route.HydrateFallback||B.route.hydrateFallbackElement)&&(M=F),B.route.id){let{loaderData:q,errors:K}=f,ie=B.route.loader&&q[B.route.id]===void 0&&(!K||K[B.route.id]===void 0);if(B.route.lazy||ie){k=!0,M>=0?I=I.slice(0,M+1):I=[I[0]];break}}}return I.reduceRight((F,B,q)=>{let K,ie=!1,X=null,te=null;f&&(K=N&&B.route.id?N[B.route.id]:void 0,X=B.route.errorElement||yee,k&&(M<0&&q===0?(Nee("route-fallback"),ie=!0,te=null):M===q&&(ie=!0,te=B.route.hydrateFallbackElement||null)));let ce=h.concat(I.slice(0,q+1)),$=()=>{let le;return K?le=X:ie?le=te:B.route.Component?le=ee.createElement(B.route.Component,null):B.route.element?le=B.route.element:le=F,ee.createElement(Cee,{match:B,routeContext:{outlet:F,matches:ce,isDataRoute:f!=null},children:le})};return f&&(B.route.ErrorBoundary||B.route.errorElement||q===0)?ee.createElement(Tee,{location:f.location,revalidation:f.revalidation,component:X,error:K,children:$(),routeContext:{outlet:null,matches:ce,isDataRoute:!0}}):$()},null)}var F8=function(u){return u.UseBlocker="useBlocker",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u}(F8||{}),B8=function(u){return u.UseBlocker="useBlocker",u.UseLoaderData="useLoaderData",u.UseActionData="useActionData",u.UseRouteError="useRouteError",u.UseNavigation="useNavigation",u.UseRouteLoaderData="useRouteLoaderData",u.UseMatches="useMatches",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u.UseRouteId="useRouteId",u}(B8||{});function wee(u){let h=ee.useContext(F1);return h||ai(!1),h}function bee(u){let h=ee.useContext(_ee);return h||ai(!1),h}function Iee(u){let h=ee.useContext(hm);return h||ai(!1),h}function W8(u){let h=Iee(),f=h.matches[h.matches.length-1];return f.route.id||ai(!1),f.route.id}function Aee(){var u;let h=ee.useContext(V8),f=bee(),g=W8();return h!==void 0?h:(u=f.errors)==null?void 0:u[g]}function Oee(){let{router:u}=wee(F8.UseNavigateStable),h=W8(B8.UseNavigateStable),f=ee.useRef(!1);return j8(()=>{f.current=!0}),ee.useCallback(function(S,C){C===void 0&&(C={}),f.current&&(typeof S=="number"?u.navigate(S):u.navigate(S,NE({fromRouteId:h},C)))},[u,h])}const j4={};function Nee(u,h,f){j4[u]||(j4[u]=!0)}function Pee(u,h){u?.v7_startTransition,u?.v7_relativeSplatPath}function cs(u){ai(!1)}function Dee(u){let{basename:h="/",children:f=null,location:g,navigationType:S=zd.Pop,navigator:C,static:I=!1,future:N}=u;P0()&&ai(!1);let k=h.replace(/^\/*/,"/"),M=ee.useMemo(()=>({basename:k,navigator:C,static:I,future:NE({v7_relativeSplatPath:!1},N)}),[k,N,C,I]);typeof g=="string"&&(g=um(g));let{pathname:F="/",search:B="",hash:q="",state:K=null,key:ie="default"}=g,X=ee.useMemo(()=>{let te=M8(F,k);return te==null?null:{location:{pathname:te,search:B,hash:q,state:K,key:ie},navigationType:S}},[k,F,B,q,K,ie,S]);return X==null?null:ee.createElement(O0.Provider,{value:M},ee.createElement(N0.Provider,{children:f,value:X}))}function kee(u){let{children:h,location:f}=u;return Eee(E1(h),f)}new Promise(()=>{});function E1(u,h){h===void 0&&(h=[]);let f=[];return ee.Children.forEach(u,(g,S)=>{if(!ee.isValidElement(g))return;let C=[...h,S];if(g.type===ee.Fragment){f.push.apply(f,E1(g.props.children,C));return}g.type!==cs&&ai(!1),!g.props.index||!g.props.children||ai(!1);let I={id:g.props.id||C.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:g.props.ErrorBoundary!=null||g.props.errorElement!=null,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(I.children=E1(g.props.children,C)),f.push(I)}),f}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Lee="6";try{window.__reactRouterVersion=Lee}catch{}const xee="startTransition",F4=aj[xee];function Mee(u){let{basename:h,children:f,future:g,window:S}=u,C=ee.useRef();C.current==null&&(C.current=W$({window:S,v5Compat:!0}));let I=C.current,[N,k]=ee.useState({action:I.action,location:I.location}),{v7_startTransition:M}=g||{},F=ee.useCallback(B=>{M&&F4?F4(()=>k(B)):k(B)},[k,M]);return ee.useLayoutEffect(()=>I.listen(F),[I,F]),ee.useEffect(()=>Pee(g),[g]),ee.createElement(Dee,{basename:h,children:f,location:N.location,navigationType:N.action,navigator:I,future:g})}var B4;(function(u){u.UseScrollRestoration="useScrollRestoration",u.UseSubmit="useSubmit",u.UseSubmitFetcher="useSubmitFetcher",u.UseFetcher="useFetcher",u.useViewTransitionState="useViewTransitionState"})(B4||(B4={}));var W4;(function(u){u.UseFetcher="useFetcher",u.UseFetchers="useFetchers",u.UseScrollRestoration="useScrollRestoration"})(W4||(W4={}));/*! Capacitor: https://capacitorjs.com/ - MIT License */var am;(function(u){u.Unimplemented="UNIMPLEMENTED",u.Unavailable="UNAVAILABLE"})(am||(am={}));class $I extends Error{constructor(h,f,g){super(h),this.message=h,this.code=f,this.data=g}}const Uee=u=>{var h,f;return u?.androidBridge?"android":!((f=(h=u?.webkit)===null||h===void 0?void 0:h.messageHandlers)===null||f===void 0)&&f.bridge?"ios":"web"},Vee=u=>{const h=u.CapacitorCustomPlatform||null,f=u.Capacitor||{},g=f.Plugins=f.Plugins||{},S=()=>h!==null?h.name:Uee(u),C=()=>S()!=="web",I=B=>{const q=M.get(B);return!!(q?.platforms.has(S())||N(B))},N=B=>{var q;return(q=f.PluginHeaders)===null||q===void 0?void 0:q.find(K=>K.name===B)},k=B=>u.console.error(B),M=new Map,F=(B,q={})=>{const K=M.get(B);if(K)return console.warn(`Capacitor plugin "${B}" already registered. Cannot register plugins twice.`),K.proxy;const ie=S(),X=N(B);let te;const ce=async()=>(!te&&ie in q?te=typeof q[ie]=="function"?te=await q[ie]():te=q[ie]:h!==null&&!te&&"web"in q&&(te=typeof q.web=="function"?te=await q.web():te=q.web),te),$=(fe,ye)=>{var je,Je;if(X){const Ue=X?.methods.find(xe=>ye===xe.name);if(Ue)return Ue.rtype==="promise"?xe=>f.nativePromise(B,ye.toString(),xe):(xe,Ge)=>f.nativeCallback(B,ye.toString(),xe,Ge);if(fe)return(je=fe[ye])===null||je===void 0?void 0:je.bind(fe)}else{if(fe)return(Je=fe[ye])===null||Je===void 0?void 0:Je.bind(fe);throw new $I(`"${B}" plugin is not implemented on ${ie}`,am.Unimplemented)}},le=fe=>{let ye;const je=(...Je)=>{const Ue=ce().then(xe=>{const Ge=$(xe,fe);if(Ge){const dt=Ge(...Je);return ye=dt?.remove,dt}else throw new $I(`"${B}.${fe}()" is not implemented on ${ie}`,am.Unimplemented)});return fe==="addListener"&&(Ue.remove=async()=>ye()),Ue};return je.toString=()=>`${fe.toString()}() { [capacitor code] }`,Object.defineProperty(je,"name",{value:fe,writable:!1,configurable:!1}),je},ne=le("addListener"),de=le("removeListener"),be=(fe,ye)=>{const je=ne({eventName:fe},ye),Je=async()=>{const xe=await je;de({eventName:fe,callbackId:xe},ye)},Ue=new Promise(xe=>je.then(()=>xe({remove:Je})));return Ue.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Je()},Ue},Se=new Proxy({},{get(fe,ye){switch(ye){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return X?be:ne;case"removeListener":return de;default:return le(ye)}}});return g[B]=Se,M.set(B,{name:B,proxy:Se,platforms:new Set([...Object.keys(q),...X?[ie]:[]])}),Se};return f.convertFileSrc||(f.convertFileSrc=B=>B),f.getPlatform=S,f.handleError=k,f.isNativePlatform=C,f.isPluginAvailable=I,f.registerPlugin=F,f.Exception=$I,f.DEBUG=!!f.DEBUG,f.isLoggingEnabled=!!f.isLoggingEnabled,f},jee=u=>u.Capacitor=Vee(u),PE=jee(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}),G8=PE.registerPlugin;class H8{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(h,f){let g=!1;this.listeners[h]||(this.listeners[h]=[],g=!0),this.listeners[h].push(f);const C=this.windowListeners[h];C&&!C.registered&&this.addWindowListener(C),g&&this.sendRetainedArgumentsForEvent(h);const I=async()=>this.removeListener(h,f);return Promise.resolve({remove:I})}async removeAllListeners(){this.listeners={};for(const h in this.windowListeners)this.removeWindowListener(this.windowListeners[h]);this.windowListeners={}}notifyListeners(h,f,g){const S=this.listeners[h];if(!S){if(g){let C=this.retainedEventArguments[h];C||(C=[]),C.push(f),this.retainedEventArguments[h]=C}return}S.forEach(C=>C(f))}hasListeners(h){var f;return!!(!((f=this.listeners[h])===null||f===void 0)&&f.length)}registerWindowListener(h,f){this.windowListeners[f]={registered:!1,windowEventName:h,pluginEventName:f,handler:g=>{this.notifyListeners(f,g)}}}unimplemented(h="not implemented"){return new PE.Exception(h,am.Unimplemented)}unavailable(h="not available"){return new PE.Exception(h,am.Unavailable)}async removeListener(h,f){const g=this.listeners[h];if(!g)return;const S=g.indexOf(f);this.listeners[h].splice(S,1),this.listeners[h].length||this.removeWindowListener(this.windowListeners[h])}addWindowListener(h){window.addEventListener(h.windowEventName,h.handler),h.registered=!0}removeWindowListener(h){h&&(window.removeEventListener(h.windowEventName,h.handler),h.registered=!1)}sendRetainedArgumentsForEvent(h){const f=this.retainedEventArguments[h];f&&(delete this.retainedEventArguments[h],f.forEach(g=>{this.notifyListeners(h,g)}))}}const G4=u=>encodeURIComponent(u).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),H4=u=>u.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Fee extends H8{async getCookies(){const h=document.cookie,f={};return h.split(";").forEach(g=>{if(g.length<=0)return;let[S,C]=g.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");S=H4(S).trim(),C=H4(C).trim(),f[S]=C}),f}async setCookie(h){try{const f=G4(h.key),g=G4(h.value),S=`; expires=${(h.expires||"").replace("expires=","")}`,C=(h.path||"/").replace("path=",""),I=h.url!=null&&h.url.length>0?`domain=${h.url}`:"";document.cookie=`${f}=${g||""}${S}; path=${C}; ${I};`}catch(f){return Promise.reject(f)}}async deleteCookie(h){try{document.cookie=`${h.key}=; Max-Age=0`}catch(f){return Promise.reject(f)}}async clearCookies(){try{const h=document.cookie.split(";")||[];for(const f of h)document.cookie=f.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(h){return Promise.reject(h)}}async clearAllCookies(){try{await this.clearCookies()}catch(h){return Promise.reject(h)}}}G8("CapacitorCookies",{web:()=>new Fee});const Bee=async u=>new Promise((h,f)=>{const g=new FileReader;g.onload=()=>{const S=g.result;h(S.indexOf(",")>=0?S.split(",")[1]:S)},g.onerror=S=>f(S),g.readAsDataURL(u)}),Wee=(u={})=>{const h=Object.keys(u);return Object.keys(u).map(S=>S.toLocaleLowerCase()).reduce((S,C,I)=>(S[C]=u[h[I]],S),{})},Gee=(u,h=!0)=>u?Object.entries(u).reduce((g,S)=>{const[C,I]=S;let N,k;return Array.isArray(I)?(k="",I.forEach(M=>{N=h?encodeURIComponent(M):M,k+=`${C}=${N}&`}),k.slice(0,-1)):(N=h?encodeURIComponent(I):I,k=`${C}=${N}`),`${g}&${k}`},"").substr(1):null,Hee=(u,h={})=>{const f=Object.assign({method:u.method||"GET",headers:u.headers},h),S=Wee(u.headers)["content-type"]||"";if(typeof u.data=="string")f.body=u.data;else if(S.includes("application/x-www-form-urlencoded")){const C=new URLSearchParams;for(const[I,N]of Object.entries(u.data||{}))C.set(I,N);f.body=C.toString()}else if(S.includes("multipart/form-data")||u.data instanceof FormData){const C=new FormData;if(u.data instanceof FormData)u.data.forEach((N,k)=>{C.append(k,N)});else for(const N of Object.keys(u.data))C.append(N,u.data[N]);f.body=C;const I=new Headers(f.headers);I.delete("content-type"),f.headers=I}else(S.includes("application/json")||typeof u.data=="object")&&(f.body=JSON.stringify(u.data));return f};class Kee extends H8{async request(h){const f=Hee(h,h.webFetchExtra),g=Gee(h.params,h.shouldEncodeUrlParams),S=g?`${h.url}?${g}`:h.url,C=await fetch(S,f),I=C.headers.get("content-type")||"";let{responseType:N="text"}=C.ok?h:{};I.includes("application/json")&&(N="json");let k,M;switch(N){case"arraybuffer":case"blob":M=await C.blob(),k=await Bee(M);break;case"json":k=await C.json();break;case"document":case"text":default:k=await C.text()}const F={};return C.headers.forEach((B,q)=>{F[q]=B}),{data:k,headers:F,status:C.status,url:C.url}}async get(h){return this.request(Object.assign(Object.assign({},h),{method:"GET"}))}async post(h){return this.request(Object.assign(Object.assign({},h),{method:"POST"}))}async put(h){return this.request(Object.assign(Object.assign({},h),{method:"PUT"}))}async patch(h){return this.request(Object.assign(Object.assign({},h),{method:"PATCH"}))}async delete(h){return this.request(Object.assign(Object.assign({},h),{method:"DELETE"}))}}G8("CapacitorHttp",{web:()=>new Kee});const zee=u=>"<URL>",Yee=u=>u?"<TOKEN>":"<EMPTY>",K8=u=>{if(!u)return"Unknown error";let h=u instanceof Error?u.message:String(u);return h=h.replace(/https?:\/\/[^\s'"]+/g,"<URL>"),h},B1=u=>{if(!u||typeof u!="object")return u;const h={...u},f=["url","authorization_url","token","access_token","refresh_token","code","state","code_verifier","code_challenge"];for(const g of f)g in h&&(g.includes("url")?h[g]="<URL>":h[g]="<REDACTED>");return h},qee=(...u)=>{const h=u.map(f=>typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?B1(f):f);console.log(...h)},Xee=(...u)=>{const h=u.map(f=>f instanceof Error?K8(f):typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?B1(f):f);console.error(...h)},Jee=(...u)=>{const h=u.map(f=>typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?B1(f):f);console.warn(...h)},Qee=(u,h,f)=>{},Zee=(u,h,f,g)=>{},$ee=(u,h)=>{},lt={log:qee,error:Xee,warn:Jee,apiRequest:Qee,apiResponse:Zee,debugGroup:$ee,maskUrl:zee,maskToken:Yee,maskErrorMessage:K8},wl=()=>{if(console.log("  URL:",window.location.href),console.log("  Origin:",window.location.origin),console.log(" Capacitor Native:",PE.isNativePlatform()),PE.isNativePlatform())return console.log("   -   "),"https://silverld.site/api";const u="http://localhost:8080/api";return console.log("  -  :",u),String(u).replace(/\/$/,"")};let W1=null,SE=!1,v1=[];const yi={STATE:"oauth_state",CODE_VERIFIER:"oauth_code_verifier",PROVIDER:"oauth_provider",USER_INFO:"user_info"},z8=(u,h)=>{W1=u,lt.log(" Access token   ")},G1=()=>W1,S1=()=>{W1=null,lt.log("  access token  ")},ete=u=>{v1.push(u)},eA=u=>{v1.forEach(h=>h(u)),v1=[]},Y8=async u=>{try{const h=`${wl()}/v1/auth/oauth/${u}/config`;lt.apiRequest("GET",`/v1/auth/oauth/${u}/config`);const f=new AbortController,g=setTimeout(()=>f.abort(),3e4);let S;try{S=await fetch(h,{signal:f.signal})}finally{clearTimeout(g)}if(!S.ok){const C=S.headers.get("content-type");if(C&&C.includes("application/json")){const I=await S.json();throw new Error(I.message||"OAuth   .")}else{const I=await S.text();throw lt.error("  :",I),new Error(`    . (${S.status})`)}}return await S.json()}catch(h){throw lt.error("OAuth   :",h),h}},q8=async u=>{try{const h=await Y8(u);sessionStorage.setItem(yi.STATE,h.data.state),sessionStorage.setItem(yi.CODE_VERIFIER,h.data.code_verifier),sessionStorage.setItem(yi.PROVIDER,u),lt.log("   :",u),window.location.href=h.data.authorization_url}catch(h){throw lt.error("   :",h),h}},X8=async()=>{const u=new URLSearchParams(window.location.search),h=u.get("code"),f=u.get("state"),g=u.get("error");if(lt.log("OAuth  :",{code_length:h?.length??0,state_length:f?.length??0,has_error:!!g}),g)throw lt.error("OAuth :",g),new Error(`OAuth    : ${g}`);if(!h||!f)return null;const S=sessionStorage.getItem(yi.STATE),C=sessionStorage.getItem(yi.CODE_VERIFIER),I=sessionStorage.getItem(yi.PROVIDER),N=["google","kakao","naver"].find(k=>k===I);if(!N)throw sessionStorage.removeItem(yi.STATE),sessionStorage.removeItem(yi.CODE_VERIFIER),sessionStorage.removeItem(yi.PROVIDER),new Error("  OAuth .  .");if(!S||!C||!N)throw new Error("OAuth   .  .");if(f!==S)throw new Error("OAuth state  .   .");return await J8(N,h,f,C)},J8=async(u,h,f,g)=>{try{const S={code:h,state:f,code_verifier:g,device_info:`${navigator.platform} - ${navigator.userAgent.split(" ")[0]}`};lt.log("  :",{provider:u,code_length:h?.length||0,state_length:f?.length||0,code_verifier_length:g?.length||0,device_info_length:S.device_info?.length||0});const C=new AbortController,I=setTimeout(()=>{lt.error(" OAuth   (60 )"),C.abort()},6e4),N=Date.now();lt.apiRequest("POST",`/v1/auth/oauth/${u}`);let k;try{k=await fetch(`${wl()}/v1/auth/oauth/${u}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S),credentials:"include",signal:C.signal});const B=Date.now()-N;lt.log(` OAuth   : ${B}ms`)}catch(B){const q=Date.now()-N;throw lt.error(` OAuth   : ${q}ms`,B),B}finally{clearTimeout(I)}if(!k.ok){lt.error("OAuth   :",{status:k.status,statusText:k.statusText});const B=k.headers.get("content-type");if(B&&B.includes("application/json")){const q=await k.json();throw lt.error("   :",q),lt.debugGroup("  ",{provider:u,error_code:q.code,error_message:q.message,timestamp:q.timestamp,status:k.status,errors:q.errors||[]}),new Error(q.message||" .")}else{const q=await k.text();throw lt.error("   :",q),new Error(` : ${k.status} ${k.statusText}`)}}const M=await k.json();z8(M.data.access_token,M.data.expires_in);const F={id:M.data.user_info.id,is_new_user:M.data.user_info.is_new_user,is_profile_complete:M.data.user_info.is_profile_complete};return localStorage.setItem(yi.USER_INFO,JSON.stringify(F)),sessionStorage.removeItem(yi.STATE),sessionStorage.removeItem(yi.CODE_VERIFIER),sessionStorage.removeItem(yi.PROVIDER),M}catch(S){throw lt.error("   :",S),S}},uo=(u="access_token")=>u==="access_token"?G1():null,DE=()=>{const u=localStorage.getItem(yi.USER_INFO);if(!u)return null;try{return JSON.parse(u)}catch(h){return lt.error("   :",h),null}},Q8=async()=>{try{const u=uo("access_token"),h={"Content-Type":"application/json"};u&&(h.Authorization=`Bearer ${u}`);const f={logout_all:!0};lt.apiRequest("POST","/v1/auth/logout",f);const g=new AbortController,S=setTimeout(()=>g.abort(),1e4);let C;try{C=await fetch(`${wl()}/v1/auth/logout`,{method:"POST",headers:h,body:JSON.stringify(f),credentials:"include",signal:g.signal})}finally{clearTimeout(S)}if(!C.ok)if((C.headers.get("content-type")||"").includes("application/json")){const k=await C.json();throw lt.error(" API :",k),new Error(` : ${k.message||C.statusText}`)}else{const k=await C.text();throw lt.error(" API ():",k),new Error(` : ${C.status} ${C.statusText}`)}const I=await C.json();lt.apiResponse("POST","/v1/auth/logout",C.status,I)}catch(u){throw lt.error("    :",u),u}},Z8=async()=>{try{await Q8()}catch(u){lt.error("  ,   :",u)}finally{try{S1(),localStorage.removeItem(yi.USER_INFO),sessionStorage.removeItem(yi.STATE),sessionStorage.removeItem(yi.CODE_VERIFIER),sessionStorage.removeItem(yi.PROVIDER),lt.log("  ")}catch(u){lt.error("    :",u)}}},H1=()=>G1()?(lt.log(" :  "),!0):(lt.log(" :  "),!1),K1=async()=>{try{const u=uo("access_token");if(!u)throw new Error("  .");lt.apiRequest("GET","/v1/auth/me");const h=new AbortController,f=setTimeout(()=>h.abort(),1e4);let g=await fetch(`${wl()}/v1/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},credentials:"include",signal:h.signal});if(clearTimeout(f),g.status===401){lt.log("   401  ,    ...");const C=await Si();if(C){lt.log("   ,    ...");const I=new AbortController,N=setTimeout(()=>I.abort(),1e4);g=await fetch(`${wl()}/v1/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/json"},credentials:"include",signal:I.signal}),clearTimeout(N),lt.log(`     : ${g.status}`)}else throw lt.error("   "),new Error(" .  .")}if(!g.ok)if((g.headers.get("content-type")||"").includes("application/json")){const I=await g.json();throw lt.error("  API :",I),new Error(`  : ${I.message||g.statusText}`)}else{const I=await g.text();throw lt.error("  API ():",I),new Error(`  : ${g.status} ${g.statusText}`)}const S=await g.json();return lt.apiResponse("GET","/v1/auth/me",g.status,S),S}catch(u){throw lt.error("     :",u),u}},$8=async u=>{try{const h=uo("access_token");if(!h)throw new Error("  .");const f=u;lt.apiRequest("PUT","/v1/users/profile",f);const g=new AbortController,S=setTimeout(()=>g.abort(),1e4);let C=await fetch(`${wl()}/v1/users/profile`,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(f),credentials:"include",signal:g.signal});if(clearTimeout(S),C.status===401){lt.log("   401  ,    ...");const N=await Si();if(N){lt.log("   ,    ...");const k=new AbortController,M=setTimeout(()=>k.abort(),1e4);C=await fetch(`${wl()}/v1/users/profile`,{method:"PUT",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify(f),credentials:"include",signal:k.signal}),clearTimeout(M),lt.log(`     : ${C.status}`)}else throw lt.error("   "),new Error(" .  .")}if(!C.ok)if((C.headers.get("content-type")||"").includes("application/json")){const k=await C.json();throw lt.error("  API :",k),new Error(`  : ${k.message||C.statusText}`)}else{const k=await C.text();throw lt.error("  API ():",k),new Error(`  : ${C.status} ${C.statusText}`)}const I=await C.json();return lt.apiResponse("PUT","/v1/users/profile",C.status,I),I}catch(h){throw lt.error("    :",h),h}},eF=async()=>{try{return lt.log("  :   ..."),G1()?(lt.log("     -  "),!0):await Si()?(lt.log("   :   "),!0):(lt.log("  :  refresh token  ( )"),!1)}catch(u){return lt.error("   :",u),!1}},Si=async()=>{if(SE)return lt.log("     - ..."),new Promise(u=>{ete(h=>{u(h)})});try{SE=!0,lt.log("   ...");const u=new AbortController,h=setTimeout(()=>u.abort(),1e4);let f;try{lt.apiRequest("POST","/v1/auth/refresh"),f=await fetch(`${wl()}/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:""}),credentials:"include",signal:u.signal}),lt.log(`   API  : ${f.status}`)}finally{clearTimeout(h)}if(!f.ok){if(f.status===401)return lt.warn("   ."),S1(),SE=!1,eA(""),null;throw lt.error(`   : ${f.status} ${f.statusText}`),new Error(`  : ${f.status}`)}const g=await f.json();return lt.log("    :",g),z8(g.data.access_token,g.data.expires_in),lt.log("  access_token   "),lt.log("   "),SE=!1,eA(g.data.access_token),g.data.access_token}catch(u){return SE=!1,eA(""),u instanceof Error&&u.name==="AbortError"?lt.error("   :",u):lt.error("   :",u),S1(),null}},QT=Object.freeze(Object.defineProperty({__proto__:null,getApiUrl:wl,getOAuthConfig:Y8,getStoredToken:uo,getStoredUserInfo:DE,getUserProfile:K1,initializeAuth:eF,isAuthenticated:H1,logout:Z8,logoutFromServer:Q8,processOAuthCallback:X8,processSocialLogin:J8,refreshToken:Si,startSocialLogin:q8,updateUserProfile:$8},Symbol.toStringTag,{value:"Module"})),K4=u=>{let h;const f=new Set,g=(M,F)=>{const B=typeof M=="function"?M(h):M;if(!Object.is(B,h)){const q=h;h=F??(typeof B!="object"||B===null)?B:Object.assign({},h,B),f.forEach(K=>K(h,q))}},S=()=>h,N={setState:g,getState:S,getInitialState:()=>k,subscribe:M=>(f.add(M),()=>f.delete(M))},k=h=u(g,S,N);return N},tte=u=>u?K4(u):K4,nte=u=>u;function rte(u,h=nte){const f=it.useSyncExternalStore(u.subscribe,it.useCallback(()=>h(u.getState()),[u,h]),it.useCallback(()=>h(u.getInitialState()),[u,h]));return it.useDebugValue(f),f}const z4=u=>{const h=tte(u),f=g=>rte(h,g);return Object.assign(f,h),f},tF=u=>u?z4(u):z4,Y4={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"27a8d306ea82463f81a2fbc033c7570c",VITE_API_BASE_URL:"http://localhost:8080/api",VITE_API_BASE_URL_MOBILE:"https://silverld.site/api",VITE_API_BASE_URL_WEB:"http://localhost:8080/api",VITE_CAPACITOR_NAVIGATION_DOMAINS:"https://silverld.site/*,https://kauth.kakao.com/*,https://accounts.google.com/*,https://nid.naver.com/*,http://localhost:8080/*,http://127.0.0.1:8080/*",VITE_DOMAIN_MOBILE:"https://silverld.site",VITE_DOMAIN_WEB:"http://localhost:8080",VITE_KAKAO_NATIVE_APP_KEY:"aa1e70c80567cbfe9b5dfa111ca97ab5",VITE_OAUTH_CALLBACK_MOBILE:"https://silverld.site/oauth/callback?mobile=true",VITE_OAUTH_CALLBACK_WEB:"http://localhost:8080/oauth/callback",VITE_PUBLIC_BUILDER_KEY:"__BUILDER_PUBLIC_KEY__",VITE_WS_BASE_URL:"http://localhost:8080/ws",VITE_WS_BASE_URL_MOBILE:"https://silverld.site/ws",VITE_WS_BASE_URL_WEB:"http://localhost:8080/ws"},kE=new Map,ZT=u=>{const h=kE.get(u);return h?Object.fromEntries(Object.entries(h.stores).map(([f,g])=>[f,g.getState()])):{}},ite=(u,h,f)=>{if(u===void 0)return{type:"untracked",connection:h.connect(f)};const g=kE.get(f.name);if(g)return{type:"tracked",store:u,...g};const S={connection:h.connect(f),stores:{}};return kE.set(f.name,S),{type:"tracked",store:u,...S}},ste=(u,h)=>{if(h===void 0)return;const f=kE.get(u);f&&(delete f.stores[h],Object.keys(f.stores).length===0&&kE.delete(u))},ote=u=>{var h,f;if(!u)return;const g=u.split(`
`),S=g.findIndex(I=>I.includes("api.setState"));if(S<0)return;const C=((h=g[S+1])==null?void 0:h.trim())||"";return(f=/.+ (.+) .+/.exec(C))==null?void 0:f[1]},ate=(u,h={})=>(f,g,S)=>{const{enabled:C,anonymousActionType:I,store:N,...k}=h;let M;try{M=(C??(Y4?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!M)return u(f,g,S);const{connection:F,...B}=ite(N,M,k);let q=!0;S.setState=(X,te,ce)=>{const $=f(X,te);if(!q)return $;const le=ce===void 0?{type:I||ote(new Error().stack)||"anonymous"}:typeof ce=="string"?{type:ce}:ce;return N===void 0?(F?.send(le,g()),$):(F?.send({...le,type:`${N}/${le.type}`},{...ZT(k.name),[N]:S.getState()}),$)},S.devtools={cleanup:()=>{F&&typeof F.unsubscribe=="function"&&F.unsubscribe(),ste(k.name,N)}};const K=(...X)=>{const te=q;q=!1,f(...X),q=te},ie=u(S.setState,g,S);if(B.type==="untracked"?F?.init(ie):(B.stores[B.store]=S,F?.init(Object.fromEntries(Object.entries(B.stores).map(([X,te])=>[X,X===B.store?ie:te.getState()])))),S.dispatchFromDevtools&&typeof S.dispatch=="function"){let X=!1;const te=S.dispatch;S.dispatch=(...ce)=>{(Y4?"production":void 0)!=="production"&&ce[0].type==="__setState"&&!X&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),X=!0),te(...ce)}}return F.subscribe(X=>{var te;switch(X.type){case"ACTION":if(typeof X.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return tA(X.payload,ce=>{if(ce.type==="__setState"){if(N===void 0){K(ce.state);return}Object.keys(ce.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const $=ce.state[N];if($==null)return;JSON.stringify(S.getState())!==JSON.stringify($)&&K($);return}S.dispatchFromDevtools&&typeof S.dispatch=="function"&&S.dispatch(ce)});case"DISPATCH":switch(X.payload.type){case"RESET":return K(ie),N===void 0?F?.init(S.getState()):F?.init(ZT(k.name));case"COMMIT":if(N===void 0){F?.init(S.getState());return}return F?.init(ZT(k.name));case"ROLLBACK":return tA(X.state,ce=>{if(N===void 0){K(ce),F?.init(S.getState());return}K(ce[N]),F?.init(ZT(k.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return tA(X.state,ce=>{if(N===void 0){K(ce);return}JSON.stringify(S.getState())!==JSON.stringify(ce[N])&&K(ce[N])});case"IMPORT_STATE":{const{nextLiftedState:ce}=X.payload,$=(te=ce.computedStates.slice(-1)[0])==null?void 0:te.state;if(!$)return;K(N===void 0?$:$[N]),F?.send(null,ce);return}case"PAUSE_RECORDING":return q=!q}return}}),ie},cte=ate,tA=(u,h)=>{let f;try{f=JSON.parse(u)}catch(g){console.error("[zustand devtools middleware] Could not parse the received json",g)}f!==void 0&&h(f)};function lte(u,h){let f;try{f=u()}catch{return}return{getItem:S=>{var C;const I=k=>k===null?null:JSON.parse(k,void 0),N=(C=f.getItem(S))!=null?C:null;return N instanceof Promise?N.then(I):I(N)},setItem:(S,C)=>f.setItem(S,JSON.stringify(C,void 0)),removeItem:S=>f.removeItem(S)}}const y1=u=>h=>{try{const f=u(h);return f instanceof Promise?f:{then(g){return y1(g)(f)},catch(g){return this}}}catch(f){return{then(g){return this},catch(g){return y1(g)(f)}}}},dte=(u,h)=>(f,g,S)=>{let C={storage:lte(()=>localStorage),partialize:X=>X,version:0,merge:(X,te)=>({...te,...X}),...h},I=!1;const N=new Set,k=new Set;let M=C.storage;if(!M)return u((...X)=>{console.warn(`[zustand persist middleware] Unable to update item '${C.name}', the given storage is currently unavailable.`),f(...X)},g,S);const F=()=>{const X=C.partialize({...g()});return M.setItem(C.name,{state:X,version:C.version})},B=S.setState;S.setState=(X,te)=>(B(X,te),F());const q=u((...X)=>(f(...X),F()),g,S);S.getInitialState=()=>q;let K;const ie=()=>{var X,te;if(!M)return;I=!1,N.forEach($=>{var le;return $((le=g())!=null?le:q)});const ce=((te=C.onRehydrateStorage)==null?void 0:te.call(C,(X=g())!=null?X:q))||void 0;return y1(M.getItem.bind(M))(C.name).then($=>{if($)if(typeof $.version=="number"&&$.version!==C.version){if(C.migrate){const le=C.migrate($.state,$.version);return le instanceof Promise?le.then(ne=>[!0,ne]):[!0,le]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,$.state];return[!1,void 0]}).then($=>{var le;const[ne,de]=$;if(K=C.merge(de,(le=g())!=null?le:q),f(K,!0),ne)return F()}).then(()=>{ce?.(K,void 0),K=g(),I=!0,k.forEach($=>$(K))}).catch($=>{ce?.(void 0,$)})};return S.persist={setOptions:X=>{C={...C,...X},X.storage&&(M=X.storage)},clearStorage:()=>{M?.removeItem(C.name)},getOptions:()=>C,rehydrate:()=>ie(),hasHydrated:()=>I,onHydrate:X=>(N.add(X),()=>{N.delete(X)}),onFinishHydration:X=>(k.add(X),()=>{k.delete(X)})},C.skipHydration||ie(),K||q},ute=dte,hte="http://localhost:8080/api".replace(/\/$/,""),Qn=u=>{const h={"Content-Type":"application/json"};return u&&(h.Authorization=`Bearer ${u}`),h},co=async u=>{if(!u.ok){lt.error(` API  : ${u.status} ${u.statusText}`);const h=await u.json().catch(f=>(lt.error(" JSON  :",f),{message:"    ."}));throw lt.error("   :",h),new Error(h.message||`HTTP ${u.status}: ${u.statusText}`)}return u.json()};class pte{baseUrl;token;constructor(h=hte){this.baseUrl=h}setToken(h){this.token=h}clearToken(){this.token=void 0}async joinMatching(h){if(!this.token)throw new Error("  .");const f=`${this.baseUrl}/v1/calls/match`;try{let g=await fetch(f,{method:"POST",headers:Qn(this.token),body:JSON.stringify(h)});if(g.status===401){const C=await Si();if(C)this.token=C,g=await fetch(f,{method:"POST",headers:Qn(C),body:JSON.stringify(h)});else throw new Error(" .  .")}const S=await co(g);if(!S.data)throw new Error(S.message||"  .");return S.data}catch(g){throw console.error("  :",g),g instanceof Error?g:new Error("    .")}}async getMatchingStatus(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/status`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await Si();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/status`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async cancelMatching(h){if(!this.token)throw new Error("  .");try{let f=await fetch(`${this.baseUrl}/v1/calls/match`,{method:"DELETE",headers:Qn(this.token),body:JSON.stringify({queue_id:h})});if(f.status===401){const g=await Si();if(g)this.token=g,f=await fetch(`${this.baseUrl}/v1/calls/match`,{method:"DELETE",headers:Qn(g),body:JSON.stringify({queue_id:h})});else throw new Error(" .  .")}}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async getActiveCategories(){try{let h=await fetch(`${this.baseUrl}/v1/categories/active`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await Si();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/categories/active`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data.categories}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async getCategory(h){try{let f=await fetch(`${this.baseUrl}/v1/categories/${h}`,{method:"GET",headers:Qn(this.token)});if(f.status===401){const S=await Si();if(S)this.token=S,f=await fetch(`${this.baseUrl}/v1/categories/${h}`,{method:"GET",headers:Qn(S)});else throw new Error(" .  .")}const g=await co(f);if(!g.success||!g.data)throw new Error(g.message||"   .");return g.data}catch(f){throw console.error("   :",f),f instanceof Error?f:new Error("     .")}}async getQueuePosition(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/queue/position`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await Si();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/queue/position`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async sendCallStatistics(h,f){if(!this.token)throw new Error("  .");try{const g=`${this.baseUrl}/v1/calls/${h}/statistics`;lt.apiRequest("POST",`/v1/calls/${h}/statistics`,f);let S=await fetch(g,{method:"POST",headers:Qn(this.token),credentials:"include",body:JSON.stringify(f)});if(S.status===401){const I=await Si();if(I)this.token=I,S=await fetch(g,{method:"POST",headers:Qn(I),credentials:"include",body:JSON.stringify(f)});else throw new Error(" .  .")}if(S.status===204||S.ok)return;const C=await co(S)}catch(g){lt.error("     ():",g)}}async renewRtcToken(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/renew-token`;lt.apiRequest("POST",`/v1/calls/${h}/renew-token`,{});let g=await fetch(f,{method:"POST",headers:Qn(this.token),credentials:"include"});if(g.status===401){const C=await Si();if(C)this.token=C,g=await fetch(f,{method:"POST",headers:Qn(C),credentials:"include"});else throw new Error(" .  .")}const S=await co(g);if(!S.data||!S.data.rtcToken)throw new Error(S.message||"RTC   .");return S.data}catch(f){throw lt.error("RTC   :",f),f instanceof Error?f:new Error("RTC   .")}}async getActivityStats(h){if(!this.token)throw new Error("  .");try{const f=h?`?period=${h}`:"",g=`${this.baseUrl}/v1/users/me/activity-stats${f}`;lt.apiRequest("GET",`/v1/users/me/activity-stats${f}`,{});let S=await fetch(g,{method:"GET",headers:Qn(this.token),credentials:"include"});if(S.status===401){const N=await Si();if(N)this.token=N,S=await fetch(g,{method:"GET",headers:Qn(N),credentials:"include"});else throw new Error(" .  .")}const C=await co(S);return{weeklyStats:{callCount:C.data.weekly_stats.call_count,totalDurationMinutes:C.data.weekly_stats.total_duration_minutes,startDate:C.data.weekly_stats.start_date,endDate:C.data.weekly_stats.end_date},quarterlyStats:{callCount:C.data.quarterly_stats.call_count,totalDurationMinutes:C.data.quarterly_stats.total_duration_minutes,startDate:C.data.quarterly_stats.start_date,endDate:C.data.quarterly_stats.end_date,quarter:C.data.quarterly_stats.quarter},additionalStats:{averageCallDurationMinutes:C.data.additional_stats.average_call_duration_minutes,mostUsedCategory:C.data.additional_stats.most_used_category,totalDataUsageMb:C.data.additional_stats.total_data_usage_mb,averageNetworkQuality:C.data.additional_stats.average_network_quality}}}catch(f){throw lt.error("   :",f),f instanceof Error?f:new Error("   .")}}async getCallHistory(h){if(!this.token)throw new Error("  .");try{const f=new URLSearchParams;h?.page&&f.append("page",String(h.page)),h?.limit&&f.append("limit",String(h.limit)),h?.period&&f.append("period",h.period);const g=f.toString(),S=`${this.baseUrl}/v1/users/me/call-history${g?`?${g}`:""}`;lt.apiRequest("GET",`/v1/users/me/call-history?${g}`,{});let C=await fetch(S,{method:"GET",headers:Qn(this.token),credentials:"include"});if(C.status===401){const k=await Si();if(k)this.token=k,C=await fetch(S,{method:"GET",headers:Qn(k),credentials:"include"});else throw new Error(" .  .")}const I=await co(C);return{calls:I.data.calls.map(k=>({callId:k.call_id,partnerId:k.partner_id,partnerNickname:k.partner_nickname,categoryId:k.category_id,categoryName:k.category_name,startedAt:k.started_at,endedAt:k.ended_at,durationMinutes:k.duration_minutes,averageNetworkQuality:k.average_network_quality,totalDataUsageMB:k.total_data_usage_mb})),pagination:{currentPage:I.data.pagination.current_page,totalPages:I.data.pagination.total_pages,totalCount:I.data.pagination.total_count,hasNext:I.data.pagination.has_next}}}catch(f){throw lt.error("   :",f),f instanceof Error?f:new Error("   .")}}async getMatchingStats(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/stats`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await Si();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/stats`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async leaveChannel(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/channel/leave`;lt.apiRequest("POST",`/v1/calls/${h}/channel/leave`);let g=await fetch(f,{method:"POST",headers:Qn(this.token)});if(g.status===401){const S=await Si();if(S)this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S)});else throw new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async endCall(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/end`;lt.apiRequest("POST",`/v1/calls/${h}/end`);let g=await fetch(f,{method:"POST",headers:Qn(this.token)});if(g.status===401){const S=await Si();if(S)this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S)});else throw new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async submitEvaluation(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/evaluations`;lt.apiRequest("POST","/v1/evaluations",h);let g=await fetch(f,{method:"POST",headers:Qn(this.token),body:JSON.stringify(h)});if(console.log(`   API    : ${g.status}`),g.status===401){console.log("   401  ,    ...");const S=await Si();if(S)console.log("   ,    ..."),this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S),body:JSON.stringify(h)}),console.log(`     : ${g.status}`);else throw console.error("   "),new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}}let nA=null;const UE=()=>(nA||(nA=new pte),nA),Gd=UE();var rA={exports:{}},$T={},q4;function fte(){return q4||(q4=1,globalThis.crypto&&globalThis.crypto.getRandomValues?$T.randomBytes=function(u){var h=new Uint8Array(u);return globalThis.crypto.getRandomValues(h),h}:$T.randomBytes=function(u){for(var h=new Array(u),f=0;f<u;f++)h[f]=Math.floor(Math.random()*256);return h}),$T}var iA,X4;function pm(){if(X4)return iA;X4=1;var u=fte(),h="abcdefghijklmnopqrstuvwxyz012345";return iA={string:function(f){for(var g=h.length,S=u.randomBytes(f),C=[],I=0;I<f;I++)C.push(h.substr(S[I]%g,1));return C.join("")},number:function(f){return Math.floor(Math.random()*f)},numberString:function(f){var g=(""+(f-1)).length,S=new Array(g+1).join("0");return(S+this.number(f)).slice(-g)}},iA}var J4;function Qd(){return J4||(J4=1,function(u){var h=pm(),f={},g=!1,S=globalThis.chrome&&globalThis.chrome.app&&globalThis.chrome.app.runtime;u.exports={attachEvent:function(I,N){typeof globalThis.addEventListener<"u"?globalThis.addEventListener(I,N,!1):globalThis.document&&globalThis.attachEvent&&(globalThis.document.attachEvent("on"+I,N),globalThis.attachEvent("on"+I,N))},detachEvent:function(I,N){typeof globalThis.addEventListener<"u"?globalThis.removeEventListener(I,N,!1):globalThis.document&&globalThis.detachEvent&&(globalThis.document.detachEvent("on"+I,N),globalThis.detachEvent("on"+I,N))},unloadAdd:function(I){if(S)return null;var N=h.string(8);return f[N]=I,g&&setTimeout(this.triggerUnloadCallbacks,0),N},unloadDel:function(I){I in f&&delete f[I]},triggerUnloadCallbacks:function(){for(var I in f)f[I](),delete f[I]}};var C=function(){g||(g=!0,u.exports.triggerUnloadCallbacks())};S||u.exports.attachEvent("unload",C)}(rA)),rA.exports}var sA,Q4;function mte(){return Q4||(Q4=1,sA=function(h,f){if(f=f.split(":")[0],h=+h,!h)return!1;switch(f){case"http":case"ws":return h!==80;case"https":case"wss":return h!==443;case"ftp":return h!==21;case"gopher":return h!==70;case"file":return!1}return h!==0}),sA}var e0={},Z4;function _te(){if(Z4)return e0;Z4=1;var u=Object.prototype.hasOwnProperty,h;function f(I){try{return decodeURIComponent(I.replace(/\+/g," "))}catch{return null}}function g(I){try{return encodeURIComponent(I)}catch{return null}}function S(I){for(var N=/([^=?#&]+)=?([^&]*)/g,k={},M;M=N.exec(I);){var F=f(M[1]),B=f(M[2]);F===null||B===null||F in k||(k[F]=B)}return k}function C(I,N){N=N||"";var k=[],M,F;typeof N!="string"&&(N="?");for(F in I)if(u.call(I,F)){if(M=I[F],!M&&(M===null||M===h||isNaN(M))&&(M=""),F=g(F),M=g(M),F===null||M===null)continue;k.push(F+"="+M)}return k.length?N+k.join("&"):""}return e0.stringify=C,e0.parse=S,e0}var oA,$4;function nF(){if($4)return oA;$4=1;var u=mte(),h=_te(),f=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,g=/[\n\r\t]/g,S=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,C=/:\d+$/,I=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,N=/^[a-zA-Z]:/;function k($){return($||"").toString().replace(f,"")}var M=[["#","hash"],["?","query"],function(le,ne){return q(ne.protocol)?le.replace(/\\/g,"/"):le},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],F={hash:1,query:1};function B($){var le;typeof window<"u"?le=window:typeof globalThis<"u"?le=globalThis:typeof self<"u"?le=self:le={};var ne=le.location||{};$=$||ne;var de={},be=typeof $,Se;if($.protocol==="blob:")de=new X(unescape($.pathname),{});else if(be==="string"){de=new X($,{});for(Se in F)delete de[Se]}else if(be==="object"){for(Se in $)Se in F||(de[Se]=$[Se]);de.slashes===void 0&&(de.slashes=S.test($.href))}return de}function q($){return $==="file:"||$==="ftp:"||$==="http:"||$==="https:"||$==="ws:"||$==="wss:"}function K($,le){$=k($),$=$.replace(g,""),le=le||{};var ne=I.exec($),de=ne[1]?ne[1].toLowerCase():"",be=!!ne[2],Se=!!ne[3],fe=0,ye;return be?Se?(ye=ne[2]+ne[3]+ne[4],fe=ne[2].length+ne[3].length):(ye=ne[2]+ne[4],fe=ne[2].length):Se?(ye=ne[3]+ne[4],fe=ne[3].length):ye=ne[4],de==="file:"?fe>=2&&(ye=ye.slice(2)):q(de)?ye=ne[4]:de?be&&(ye=ye.slice(2)):fe>=2&&q(le.protocol)&&(ye=ne[4]),{protocol:de,slashes:be||q(de),slashesCount:fe,rest:ye}}function ie($,le){if($==="")return le;for(var ne=(le||"/").split("/").slice(0,-1).concat($.split("/")),de=ne.length,be=ne[de-1],Se=!1,fe=0;de--;)ne[de]==="."?ne.splice(de,1):ne[de]===".."?(ne.splice(de,1),fe++):fe&&(de===0&&(Se=!0),ne.splice(de,1),fe--);return Se&&ne.unshift(""),(be==="."||be==="..")&&ne.push(""),ne.join("/")}function X($,le,ne){if($=k($),$=$.replace(g,""),!(this instanceof X))return new X($,le,ne);var de,be,Se,fe,ye,je,Je=M.slice(),Ue=typeof le,xe=this,Ge=0;for(Ue!=="object"&&Ue!=="string"&&(ne=le,le=null),ne&&typeof ne!="function"&&(ne=h.parse),le=B(le),be=K($||"",le),de=!be.protocol&&!be.slashes,xe.slashes=be.slashes||de&&le.slashes,xe.protocol=be.protocol||le.protocol||"",$=be.rest,(be.protocol==="file:"&&(be.slashesCount!==2||N.test($))||!be.slashes&&(be.protocol||be.slashesCount<2||!q(xe.protocol)))&&(Je[3]=[/(.*)/,"pathname"]);Ge<Je.length;Ge++){if(fe=Je[Ge],typeof fe=="function"){$=fe($,xe);continue}Se=fe[0],je=fe[1],Se!==Se?xe[je]=$:typeof Se=="string"?(ye=Se==="@"?$.lastIndexOf(Se):$.indexOf(Se),~ye&&(typeof fe[2]=="number"?(xe[je]=$.slice(0,ye),$=$.slice(ye+fe[2])):(xe[je]=$.slice(ye),$=$.slice(0,ye)))):(ye=Se.exec($))&&(xe[je]=ye[1],$=$.slice(0,ye.index)),xe[je]=xe[je]||de&&fe[3]&&le[je]||"",fe[4]&&(xe[je]=xe[je].toLowerCase())}ne&&(xe.query=ne(xe.query)),de&&le.slashes&&xe.pathname.charAt(0)!=="/"&&(xe.pathname!==""||le.pathname!=="")&&(xe.pathname=ie(xe.pathname,le.pathname)),xe.pathname.charAt(0)!=="/"&&q(xe.protocol)&&(xe.pathname="/"+xe.pathname),u(xe.port,xe.protocol)||(xe.host=xe.hostname,xe.port=""),xe.username=xe.password="",xe.auth&&(ye=xe.auth.indexOf(":"),~ye?(xe.username=xe.auth.slice(0,ye),xe.username=encodeURIComponent(decodeURIComponent(xe.username)),xe.password=xe.auth.slice(ye+1),xe.password=encodeURIComponent(decodeURIComponent(xe.password))):xe.username=encodeURIComponent(decodeURIComponent(xe.auth)),xe.auth=xe.password?xe.username+":"+xe.password:xe.username),xe.origin=xe.protocol!=="file:"&&q(xe.protocol)&&xe.host?xe.protocol+"//"+xe.host:"null",xe.href=xe.toString()}function te($,le,ne){var de=this;switch($){case"query":typeof le=="string"&&le.length&&(le=(ne||h.parse)(le)),de[$]=le;break;case"port":de[$]=le,u(le,de.protocol)?le&&(de.host=de.hostname+":"+le):(de.host=de.hostname,de[$]="");break;case"hostname":de[$]=le,de.port&&(le+=":"+de.port),de.host=le;break;case"host":de[$]=le,C.test(le)?(le=le.split(":"),de.port=le.pop(),de.hostname=le.join(":")):(de.hostname=le,de.port="");break;case"protocol":de.protocol=le.toLowerCase(),de.slashes=!ne;break;case"pathname":case"hash":if(le){var be=$==="pathname"?"/":"#";de[$]=le.charAt(0)!==be?be+le:le}else de[$]=le;break;case"username":case"password":de[$]=encodeURIComponent(le);break;case"auth":var Se=le.indexOf(":");~Se?(de.username=le.slice(0,Se),de.username=encodeURIComponent(decodeURIComponent(de.username)),de.password=le.slice(Se+1),de.password=encodeURIComponent(decodeURIComponent(de.password))):de.username=encodeURIComponent(decodeURIComponent(le))}for(var fe=0;fe<M.length;fe++){var ye=M[fe];ye[4]&&(de[ye[1]]=de[ye[1]].toLowerCase())}return de.auth=de.password?de.username+":"+de.password:de.username,de.origin=de.protocol!=="file:"&&q(de.protocol)&&de.host?de.protocol+"//"+de.host:"null",de.href=de.toString(),de}function ce($){(!$||typeof $!="function")&&($=h.stringify);var le,ne=this,de=ne.host,be=ne.protocol;be&&be.charAt(be.length-1)!==":"&&(be+=":");var Se=be+(ne.protocol&&ne.slashes||q(ne.protocol)?"//":"");return ne.username?(Se+=ne.username,ne.password&&(Se+=":"+ne.password),Se+="@"):ne.password?(Se+=":"+ne.password,Se+="@"):ne.protocol!=="file:"&&q(ne.protocol)&&!de&&ne.pathname!=="/"&&(Se+="@"),(de[de.length-1]===":"||C.test(ne.hostname)&&!ne.port)&&(de+=":"),Se+=de+ne.pathname,le=typeof ne.query=="object"?$(ne.query):ne.query,le&&(Se+=le.charAt(0)!=="?"?"?"+le:le),ne.hash&&(Se+=ne.hash),Se}return X.prototype={set:te,toString:ce},X.extractProtocol=K,X.location=B,X.trimLeft=k,X.qs=h,oA=X,oA}var aA,e3;function qo(){if(e3)return aA;e3=1;var u=nF();return aA={getOrigin:function(h){if(!h)return null;var f=new u(h);if(f.protocol==="file:")return null;var g=f.port;return g||(g=f.protocol==="https:"?"443":"80"),f.protocol+"//"+f.hostname+":"+g},isOriginEqual:function(h,f){var g=this.getOrigin(h)===this.getOrigin(f);return g},isSchemeEqual:function(h,f){return h.split(":")[0]===f.split(":")[0]},addPath:function(h,f){var g=h.split("?");return g[0]+f+(g[1]?"?"+g[1]:"")},addQuery:function(h,f){return h+(h.indexOf("?")===-1?"?"+f:"&"+f)},isLoopbackAddr:function(h){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(h)||/^\[::1\]$/.test(h)}},aA}var t0={exports:{}},t3;function Un(){return t3||(t3=1,typeof Object.create=="function"?t0.exports=function(h,f){f&&(h.super_=f,h.prototype=Object.create(f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}))}:t0.exports=function(h,f){if(f){h.super_=f;var g=function(){};g.prototype=f.prototype,h.prototype=new g,h.prototype.constructor=h}}),t0.exports}var cA={},lA,n3;function rF(){if(n3)return lA;n3=1;function u(){this._listeners={}}return u.prototype.addEventListener=function(h,f){h in this._listeners||(this._listeners[h]=[]);var g=this._listeners[h];g.indexOf(f)===-1&&(g=g.concat([f])),this._listeners[h]=g},u.prototype.removeEventListener=function(h,f){var g=this._listeners[h];if(g){var S=g.indexOf(f);if(S!==-1){g.length>1?this._listeners[h]=g.slice(0,S).concat(g.slice(S+1)):delete this._listeners[h];return}}},u.prototype.dispatchEvent=function(){var h=arguments[0],f=h.type,g=arguments.length===1?[h]:Array.apply(null,arguments);if(this["on"+f]&&this["on"+f].apply(this,g),f in this._listeners)for(var S=this._listeners[f],C=0;C<S.length;C++)S[C].apply(this,g)},lA=u,lA}var r3;function us(){if(r3)return cA;r3=1;var u=Un(),h=rF();function f(){h.call(this)}return u(f,h),f.prototype.removeAllListeners=function(g){g?delete this._listeners[g]:this._listeners={}},f.prototype.once=function(g,S){var C=this,I=!1;function N(){C.removeListener(g,N),I||(I=!0,S.apply(this,arguments))}this.on(g,N)},f.prototype.emit=function(){var g=arguments[0],S=this._listeners[g];if(S){for(var C=arguments.length,I=new Array(C-1),N=1;N<C;N++)I[N-1]=arguments[N];for(var k=0;k<S.length;k++)S[k].apply(this,I)}},f.prototype.on=f.prototype.addListener=h.prototype.addEventListener,f.prototype.removeListener=h.prototype.removeEventListener,cA.EventEmitter=f,cA}var n0={exports:{}},i3;function gte(){if(i3)return n0.exports;i3=1;var u=globalThis.WebSocket||globalThis.MozWebSocket;return u?n0.exports=function(f){return new u(f)}:n0.exports=void 0,n0.exports}var dA,s3;function Ete(){if(s3)return dA;s3=1;var u=Qd(),h=qo(),f=Un(),g=us().EventEmitter,S=gte(),C=function(){};function I(N,k,M){if(!I.enabled())throw new Error("Transport created when disabled");g.call(this);var F=this,B=h.addPath(N,"/websocket");B.slice(0,5)==="https"?B="wss"+B.slice(5):B="ws"+B.slice(4),this.url=B,this.ws=new S(this.url,[],M),this.ws.onmessage=function(q){C("message event",q.data),F.emit("message",q.data)},this.unloadRef=u.unloadAdd(function(){F.ws.close()}),this.ws.onclose=function(q){C("close event",q.code,q.reason),F.emit("close",q.code,q.reason),F._cleanup()},this.ws.onerror=function(q){F.emit("close",1006,"WebSocket connection broken"),F._cleanup()}}return f(I,g),I.prototype.send=function(N){var k="["+N+"]";this.ws.send(k)},I.prototype.close=function(){var N=this.ws;this._cleanup(),N&&N.close()},I.prototype._cleanup=function(){var N=this.ws;N&&(N.onmessage=N.onclose=N.onerror=null),u.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},I.enabled=function(){return!!S},I.transportName="websocket",I.roundTrips=2,dA=I,dA}var uA,o3;function vte(){if(o3)return uA;o3=1;var u=Un(),h=us().EventEmitter,f=function(){};function g(S,C){h.call(this),this.sendBuffer=[],this.sender=C,this.url=S}return u(g,h),g.prototype.send=function(S){this.sendBuffer.push(S),this.sendStop||this.sendSchedule()},g.prototype.sendScheduleWait=function(){var S=this,C;this.sendStop=function(){S.sendStop=null,clearTimeout(C)},C=setTimeout(function(){S.sendStop=null,S.sendSchedule()},25)},g.prototype.sendSchedule=function(){f("sendSchedule",this.sendBuffer.length);var S=this;if(this.sendBuffer.length>0){var C="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,C,function(I){S.sendStop=null,I?(S.emit("close",I.code||1006,"Sending error: "+I),S.close()):S.sendScheduleWait()}),this.sendBuffer=[]}},g.prototype._cleanup=function(){this.removeAllListeners()},g.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},uA=g,uA}var hA,a3;function Ste(){if(a3)return hA;a3=1;var u=Un(),h=us().EventEmitter,f=function(){};function g(S,C,I){h.call(this),this.Receiver=S,this.receiveUrl=C,this.AjaxObject=I,this._scheduleReceiver()}return u(g,h),g.prototype._scheduleReceiver=function(){var S=this,C=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);C.on("message",function(I){S.emit("message",I)}),C.once("close",function(I,N){f("close",I,N,S.pollIsClosing),S.poll=C=null,S.pollIsClosing||(N==="network"?S._scheduleReceiver():(S.emit("close",I||1006,N),S.removeAllListeners()))})},g.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},hA=g,hA}var pA,c3;function iF(){if(c3)return pA;c3=1;var u=Un(),h=qo(),f=vte(),g=Ste();function S(C,I,N,k,M){var F=h.addPath(C,I),B=this;f.call(this,C,N),this.poll=new g(k,F,M),this.poll.on("message",function(q){B.emit("message",q)}),this.poll.once("close",function(q,K){B.poll=null,B.emit("close",q,K),B.close()})}return u(S,f),S.prototype.close=function(){f.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},pA=S,pA}var fA,l3;function fm(){if(l3)return fA;l3=1;var u=Un(),h=qo(),f=iF();function g(C){return function(I,N,k){var M={};typeof N=="string"&&(M.headers={"Content-type":"text/plain"});var F=h.addPath(I,"/xhr_send"),B=new C("POST",F,N,M);return B.once("finish",function(q){if(B=null,q!==200&&q!==204)return k(new Error("http status "+q));k()}),function(){B.close(),B=null;var q=new Error("Aborted");q.code=1e3,k(q)}}}function S(C,I,N,k){f.call(this,C,I,g(k),N,k)}return u(S,f),fA=S,fA}var mA,d3;function k0(){if(d3)return mA;d3=1;var u=Un(),h=us().EventEmitter;function f(g,S){h.call(this);var C=this;this.bufferPosition=0,this.xo=new S("POST",g,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(I,N){C._chunkHandler(I,N),C.xo=null;var k=I===200?"network":"permanent";C.emit("close",null,k),C._cleanup()})}return u(f,h),f.prototype._chunkHandler=function(g,S){if(!(g!==200||!S))for(var C=-1;;this.bufferPosition+=C+1){var I=S.slice(this.bufferPosition);if(C=I.indexOf(`
`),C===-1)break;var N=I.slice(0,C);N&&this.emit("message",N)}},f.prototype._cleanup=function(){this.removeAllListeners()},f.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},mA=f,mA}var _A,u3;function sF(){if(u3)return _A;u3=1;var u=us().EventEmitter,h=Un(),f=Qd(),g=qo(),S=globalThis.XMLHttpRequest,C=function(){};function I(M,F,B,q){var K=this;u.call(this),setTimeout(function(){K._start(M,F,B,q)},0)}h(I,u),I.prototype._start=function(M,F,B,q){var K=this;try{this.xhr=new S}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}F=g.addQuery(F,"t="+ +new Date),this.unloadRef=f.unloadAdd(function(){K._cleanup(!0)});try{this.xhr.open(M,F,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){C("xhr timeout"),K.emit("finish",0,""),K._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!q||!q.noCredentials)&&I.supportsCORS&&(this.xhr.withCredentials=!0),q&&q.headers)for(var ie in q.headers)this.xhr.setRequestHeader(ie,q.headers[ie]);this.xhr.onreadystatechange=function(){if(K.xhr){var X=K.xhr,te,ce;switch(C("readyState",X.readyState),X.readyState){case 3:try{ce=X.status,te=X.responseText}catch{}ce===1223&&(ce=204),ce===200&&te&&te.length>0&&K.emit("chunk",ce,te);break;case 4:ce=X.status,ce===1223&&(ce=204),(ce===12005||ce===12029)&&(ce=0),C("finish",ce,X.responseText),K.emit("finish",ce,X.responseText),K._cleanup(!1);break}}};try{K.xhr.send(B)}catch{K.emit("finish",0,""),K._cleanup(!1)}},I.prototype._cleanup=function(M){if(this.xhr){if(this.removeAllListeners(),f.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),M)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},I.prototype.close=function(){this._cleanup(!0)},I.enabled=!!S;var N=["Active"].concat("Object").join("X");!I.enabled&&N in globalThis&&(S=function(){try{return new globalThis[N]("Microsoft.XMLHTTP")}catch{return null}},I.enabled=!!new S);var k=!1;try{k="withCredentials"in new S}catch{}return I.supportsCORS=k,_A=I,_A}var gA,h3;function L0(){if(h3)return gA;h3=1;var u=Un(),h=sF();function f(g,S,C,I){h.call(this,g,S,C,I)}return u(f,h),f.enabled=h.enabled&&h.supportsCORS,gA=f,gA}var EA,p3;function VE(){if(p3)return EA;p3=1;var u=Un(),h=sF();function f(g,S,C){h.call(this,g,S,C,{noCredentials:!0})}return u(f,h),f.enabled=h.enabled,EA=f,EA}var vA,f3;function jE(){return f3||(f3=1,vA={isOpera:function(){return globalThis.navigator&&/opera/i.test(globalThis.navigator.userAgent)},isKonqueror:function(){return globalThis.navigator&&/konqueror/i.test(globalThis.navigator.userAgent)},hasDomain:function(){if(!globalThis.document)return!0;try{return!!globalThis.document.domain}catch{return!1}}}),vA}var SA,m3;function yte(){if(m3)return SA;m3=1;var u=Un(),h=fm(),f=k0(),g=L0(),S=VE(),C=jE();function I(N){if(!S.enabled&&!g.enabled)throw new Error("Transport created when disabled");h.call(this,N,"/xhr_streaming",f,g)}return u(I,h),I.enabled=function(N){return N.nullOrigin||C.isOpera()?!1:g.enabled},I.transportName="xhr-streaming",I.roundTrips=2,I.needBody=!!globalThis.document,SA=I,SA}var yA,_3;function z1(){if(_3)return yA;_3=1;var u=us().EventEmitter,h=Un(),f=Qd(),g=jE(),S=qo(),C=function(){};function I(N,k,M){var F=this;u.call(this),setTimeout(function(){F._start(N,k,M)},0)}return h(I,u),I.prototype._start=function(N,k,M){var F=this,B=new globalThis.XDomainRequest;k=S.addQuery(k,"t="+ +new Date),B.onerror=function(){F._error()},B.ontimeout=function(){F._error()},B.onprogress=function(){C("progress",B.responseText),F.emit("chunk",200,B.responseText)},B.onload=function(){F.emit("finish",200,B.responseText),F._cleanup(!1)},this.xdr=B,this.unloadRef=f.unloadAdd(function(){F._cleanup(!0)});try{this.xdr.open(N,k),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(M)}catch{this._error()}},I.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},I.prototype._cleanup=function(N){if(this.xdr){if(this.removeAllListeners(),f.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,N)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},I.prototype.close=function(){this._cleanup(!0)},I.enabled=!!(globalThis.XDomainRequest&&g.hasDomain()),yA=I,yA}var TA,g3;function oF(){if(g3)return TA;g3=1;var u=Un(),h=fm(),f=k0(),g=z1();function S(C){if(!g.enabled)throw new Error("Transport created when disabled");h.call(this,C,"/xhr_streaming",f,g)}return u(S,h),S.enabled=function(C){return C.cookie_needed||C.nullOrigin?!1:g.enabled&&C.sameScheme},S.transportName="xdr-streaming",S.roundTrips=2,TA=S,TA}var CA,E3;function aF(){return E3||(E3=1,CA=globalThis.EventSource),CA}var RA,v3;function Tte(){if(v3)return RA;v3=1;var u=Un(),h=us().EventEmitter,f=aF(),g=function(){};function S(C){h.call(this);var I=this,N=this.es=new f(C);N.onmessage=function(k){g("message",k.data),I.emit("message",decodeURI(k.data))},N.onerror=function(k){g("error",N.readyState);var M=N.readyState!==2?"network":"permanent";I._cleanup(),I._close(M)}}return u(S,h),S.prototype.abort=function(){this._cleanup(),this._close("user")},S.prototype._cleanup=function(){var C=this.es;C&&(C.onmessage=C.onerror=null,C.close(),this.es=null)},S.prototype._close=function(C){var I=this;setTimeout(function(){I.emit("close",null,C),I.removeAllListeners()},200)},RA=S,RA}var wA,S3;function y3(){if(S3)return wA;S3=1;var u=Un(),h=fm(),f=Tte(),g=L0(),S=aF();function C(I){if(!C.enabled())throw new Error("Transport created when disabled");h.call(this,I,"/eventsource",f,g)}return u(C,h),C.enabled=function(){return!!S},C.transportName="eventsource",C.roundTrips=2,wA=C,wA}var bA,T3;function cF(){return T3||(T3=1,bA="1.6.1"),bA}var IA={exports:{}},C3;function FE(){return C3||(C3=1,function(u){var h=Qd(),f=jE();u.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){u.exports.WPrefix in globalThis||(globalThis[u.exports.WPrefix]={})},postMessage:function(g,S){globalThis.parent!==globalThis&&globalThis.parent.postMessage(JSON.stringify({windowId:u.exports.currentWindowId,type:g,data:S||""}),"*")},createIframe:function(g,S){var C=globalThis.document.createElement("iframe"),I,N,k=function(){clearTimeout(I);try{C.onload=null}catch{}C.onerror=null},M=function(){C&&(k(),setTimeout(function(){C&&C.parentNode.removeChild(C),C=null},0),h.unloadDel(N))},F=function(q){C&&(M(),S(q))},B=function(q,K){setTimeout(function(){try{C&&C.contentWindow&&C.contentWindow.postMessage(q,K)}catch{}},0)};return C.src=g,C.style.display="none",C.style.position="absolute",C.onerror=function(){F("onerror")},C.onload=function(){clearTimeout(I),I=setTimeout(function(){F("onload timeout")},2e3)},globalThis.document.body.appendChild(C),I=setTimeout(function(){F("timeout")},15e3),N=h.unloadAdd(M),{post:B,cleanup:M,loaded:k}},createHtmlfile:function(g,S){var C=["Active"].concat("Object").join("X"),I=new globalThis[C]("htmlfile"),N,k,M,F=function(){clearTimeout(N),M.onerror=null},B=function(){I&&(F(),h.unloadDel(k),M.parentNode.removeChild(M),M=I=null,CollectGarbage())},q=function(X){I&&(B(),S(X))},K=function(X,te){try{setTimeout(function(){M&&M.contentWindow&&M.contentWindow.postMessage(X,te)},0)}catch{}};I.open(),I.write('<html><script>document.domain="'+globalThis.document.domain+'";<\/script></html>'),I.close(),I.parentWindow[u.exports.WPrefix]=globalThis[u.exports.WPrefix];var ie=I.createElement("div");return I.body.appendChild(ie),M=I.createElement("iframe"),ie.appendChild(M),M.src=g,M.onerror=function(){q("onerror")},N=setTimeout(function(){q("timeout")},15e3),k=h.unloadAdd(B),{post:K,cleanup:B,loaded:F}}},u.exports.iframeEnabled=!1,globalThis.document&&(u.exports.iframeEnabled=(typeof globalThis.postMessage=="function"||typeof globalThis.postMessage=="object")&&!f.isKonqueror())}(IA)),IA.exports}var AA,R3;function lF(){if(R3)return AA;R3=1;var u=Un(),h=us().EventEmitter,f=cF(),g=qo(),S=FE(),C=Qd(),I=pm(),N=function(){};function k(M,F,B){if(!k.enabled())throw new Error("Transport created when disabled");h.call(this);var q=this;this.origin=g.getOrigin(B),this.baseUrl=B,this.transUrl=F,this.transport=M,this.windowId=I.string(8);var K=g.addPath(B,"/iframe.html")+"#"+this.windowId;this.iframeObj=S.createIframe(K,function(ie){q.emit("close",1006,"Unable to load an iframe ("+ie+")"),q.close()}),this.onmessageCallback=this._message.bind(this),C.attachEvent("message",this.onmessageCallback)}return u(k,h),k.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){C.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},k.prototype._message=function(M){if(N("message",M.data),!g.isOriginEqual(M.origin,this.origin)){N("not same origin",M.origin,this.origin);return}var F;try{F=JSON.parse(M.data)}catch{N("bad json",M.data);return}if(F.windowId!==this.windowId){N("mismatched window id",F.windowId,this.windowId);return}switch(F.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([f,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",F.data);break;case"c":var B;try{B=JSON.parse(F.data)}catch{N("bad json",F.data);return}this.emit("close",B[0],B[1]),this.close();break}},k.prototype.postMessage=function(M,F){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:M,data:F||""}),this.origin)},k.prototype.send=function(M){this.postMessage("m",M)},k.enabled=function(){return S.iframeEnabled},k.transportName="iframe",k.roundTrips=2,AA=k,AA}var OA,w3;function Y1(){return w3||(w3=1,OA={isObject:function(u){var h=typeof u;return h==="function"||h==="object"&&!!u},extend:function(u){if(!this.isObject(u))return u;for(var h,f,g=1,S=arguments.length;g<S;g++){h=arguments[g];for(f in h)Object.prototype.hasOwnProperty.call(h,f)&&(u[f]=h[f])}return u}}),OA}var NA,b3;function PA(){if(b3)return NA;b3=1;var u=Un(),h=lF(),f=Y1();return NA=function(g){function S(C,I){h.call(this,g.transportName,C,I)}return u(S,h),S.enabled=function(C,I){if(!globalThis.document)return!1;var N=f.extend({},I);return N.sameOrigin=!0,g.enabled(N)&&h.enabled()},S.transportName="iframe-"+g.transportName,S.needBody=!0,S.roundTrips=h.roundTrips+g.roundTrips-1,S.facadeTransport=g,S},NA}var DA,I3;function Cte(){if(I3)return DA;I3=1;var u=Un(),h=FE(),f=qo(),g=us().EventEmitter,S=pm(),C=function(){};function I(k){g.call(this);var M=this;h.polluteGlobalNamespace(),this.id="a"+S.string(6),k=f.addQuery(k,"c="+decodeURIComponent(h.WPrefix+"."+this.id)),C("using htmlfile",I.htmlfileEnabled);var F=I.htmlfileEnabled?h.createHtmlfile:h.createIframe;globalThis[h.WPrefix][this.id]={start:function(){M.iframeObj.loaded()},message:function(B){M.emit("message",B)},stop:function(){M._cleanup(),M._close("network")}},this.iframeObj=F(k,function(){M._cleanup(),M._close("permanent")})}u(I,g),I.prototype.abort=function(){this._cleanup(),this._close("user")},I.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete globalThis[h.WPrefix][this.id]},I.prototype._close=function(k){this.emit("close",null,k),this.removeAllListeners()},I.htmlfileEnabled=!1;var N=["Active"].concat("Object").join("X");if(N in globalThis)try{I.htmlfileEnabled=!!new globalThis[N]("htmlfile")}catch{}return I.enabled=I.htmlfileEnabled||h.iframeEnabled,DA=I,DA}var kA,A3;function O3(){if(A3)return kA;A3=1;var u=Un(),h=Cte(),f=VE(),g=fm();function S(C){if(!h.enabled)throw new Error("Transport created when disabled");g.call(this,C,"/htmlfile",h,f)}return u(S,g),S.enabled=function(C){return h.enabled&&C.sameOrigin},S.transportName="htmlfile",S.roundTrips=2,kA=S,kA}var LA,N3;function P3(){if(N3)return LA;N3=1;var u=Un(),h=fm(),f=k0(),g=L0(),S=VE();function C(I){if(!S.enabled&&!g.enabled)throw new Error("Transport created when disabled");h.call(this,I,"/xhr",f,g)}return u(C,h),C.enabled=function(I){return I.nullOrigin?!1:S.enabled&&I.sameOrigin?!0:g.enabled},C.transportName="xhr-polling",C.roundTrips=2,LA=C,LA}var xA,D3;function Rte(){if(D3)return xA;D3=1;var u=Un(),h=fm(),f=oF(),g=k0(),S=z1();function C(I){if(!S.enabled)throw new Error("Transport created when disabled");h.call(this,I,"/xhr",g,S)}return u(C,h),C.enabled=f.enabled,C.transportName="xdr-polling",C.roundTrips=2,xA=C,xA}var MA,k3;function wte(){if(k3)return MA;k3=1;var u=FE(),h=pm(),f=jE(),g=qo(),S=Un(),C=us().EventEmitter,I=function(){};function N(k){var M=this;C.call(this),u.polluteGlobalNamespace(),this.id="a"+h.string(6);var F=g.addQuery(k,"c="+encodeURIComponent(u.WPrefix+"."+this.id));globalThis[u.WPrefix][this.id]=this._callback.bind(this),this._createScript(F),this.timeoutId=setTimeout(function(){M._abort(new Error("JSONP script loaded abnormally (timeout)"))},N.timeout)}return S(N,C),N.prototype.abort=function(){if(globalThis[u.WPrefix][this.id]){var k=new Error("JSONP user aborted read");k.code=1e3,this._abort(k)}},N.timeout=35e3,N.scriptErrorTimeout=1e3,N.prototype._callback=function(k){this._cleanup(),!this.aborting&&(k&&this.emit("message",k),this.emit("close",null,"network"),this.removeAllListeners())},N.prototype._abort=function(k){this._cleanup(),this.aborting=!0,this.emit("close",k.code,k.message),this.removeAllListeners()},N.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var k=this.script;k.parentNode.removeChild(k),k.onreadystatechange=k.onerror=k.onload=k.onclick=null,this.script=null}delete globalThis[u.WPrefix][this.id]},N.prototype._scriptError=function(){var k=this;this.errorTimer||(this.errorTimer=setTimeout(function(){k.loadedOkay||k._abort(new Error("JSONP script loaded abnormally (onerror)"))},N.scriptErrorTimeout))},N.prototype._createScript=function(k){var M=this,F=this.script=globalThis.document.createElement("script"),B;if(F.id="a"+h.string(8),F.src=k,F.type="text/javascript",F.charset="UTF-8",F.onerror=this._scriptError.bind(this),F.onload=function(){M._abort(new Error("JSONP script loaded abnormally (onload)"))},F.onreadystatechange=function(){if(I("onreadystatechange",F.readyState),/loaded|closed/.test(F.readyState)){if(F&&F.htmlFor&&F.onclick){M.loadedOkay=!0;try{F.onclick()}catch{}}F&&M._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof F.async>"u"&&globalThis.document.attachEvent)if(f.isOpera())B=this.script2=globalThis.document.createElement("script"),B.text="try{var a = document.getElementById('"+F.id+"'); if(a)a.onerror();}catch(x){};",F.async=B.async=!1;else{try{F.htmlFor=F.id,F.event="onclick"}catch{}F.async=!0}typeof F.async<"u"&&(F.async=!0);var q=globalThis.document.getElementsByTagName("head")[0];q.insertBefore(F,q.firstChild),B&&q.insertBefore(B,q.firstChild)},MA=N,MA}var UA,L3;function bte(){if(L3)return UA;L3=1;var u=pm(),h=qo(),f=function(){},g,S;function C(N){try{return globalThis.document.createElement('<iframe name="'+N+'">')}catch{var k=globalThis.document.createElement("iframe");return k.name=N,k}}function I(){g=globalThis.document.createElement("form"),g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",S=globalThis.document.createElement("textarea"),S.name="d",g.appendChild(S),globalThis.document.body.appendChild(g)}return UA=function(N,k,M){g||I();var F="a"+u.string(8);g.target=F,g.action=h.addQuery(h.addPath(N,"/jsonp_send"),"i="+F);var B=C(F);B.id=F,B.style.display="none",g.appendChild(B);try{S.value=k}catch{}g.submit();var q=function(K){B.onerror&&(B.onreadystatechange=B.onerror=B.onload=null,setTimeout(function(){B.parentNode.removeChild(B),B=null},500),S.value="",M(K))};return B.onerror=function(){q()},B.onload=function(){q()},B.onreadystatechange=function(K){f("onreadystatechange",F,B.readyState),B.readyState==="complete"&&q()},function(){q(new Error("Aborted"))}},UA}var VA,x3;function Ite(){if(x3)return VA;x3=1;var u=Un(),h=iF(),f=wte(),g=bte();function S(C){if(!S.enabled())throw new Error("Transport created when disabled");h.call(this,C,"/jsonp",g,f)}return u(S,h),S.enabled=function(){return!!globalThis.document},S.transportName="jsonp-polling",S.roundTrips=1,S.needBody=!0,VA=S,VA}var jA,M3;function Ate(){return M3||(M3=1,jA=[Ete(),yte(),oF(),y3(),PA()(y3()),O3(),PA()(O3()),P3(),Rte(),PA()(P3()),Ite()]),jA}var U3={},V3;function Ote(){if(V3)return U3;V3=1;var u=Array.prototype,h=Object.prototype,f=Function.prototype,g=String.prototype,S=u.slice,C=h.toString,I=function(Se){return h.toString.call(Se)==="[object Function]"},N=function(fe){return C.call(fe)==="[object Array]"},k=function(fe){return C.call(fe)==="[object String]"},M=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),F;M?F=function(Se,fe,ye,je){!je&&fe in Se||Object.defineProperty(Se,fe,{configurable:!0,enumerable:!1,writable:!0,value:ye})}:F=function(Se,fe,ye,je){!je&&fe in Se||(Se[fe]=ye)};var B=function(Se,fe,ye){for(var je in fe)h.hasOwnProperty.call(fe,je)&&F(Se,je,fe[je],ye)},q=function(Se){if(Se==null)throw new TypeError("can't convert "+Se+" to object");return Object(Se)};function K(Se){var fe=+Se;return fe!==fe?fe=0:fe!==0&&fe!==1/0&&fe!==-1/0&&(fe=(fe>0||-1)*Math.floor(Math.abs(fe))),fe}function ie(Se){return Se>>>0}function X(){}B(f,{bind:function(fe){var ye=this;if(!I(ye))throw new TypeError("Function.prototype.bind called on incompatible "+ye);for(var je=S.call(arguments,1),Je=function(){if(this instanceof dt){var Xe=ye.apply(this,je.concat(S.call(arguments)));return Object(Xe)===Xe?Xe:this}else return ye.apply(fe,je.concat(S.call(arguments)))},Ue=Math.max(0,ye.length-je.length),xe=[],Ge=0;Ge<Ue;Ge++)xe.push("$"+Ge);var dt=Function("binder","return function ("+xe.join(",")+"){ return binder.apply(this, arguments); }")(Je);return ye.prototype&&(X.prototype=ye.prototype,dt.prototype=new X,X.prototype=null),dt}}),B(Array,{isArray:N});var te=Object("a"),ce=te[0]!=="a"||!(0 in te),$=function(fe){var ye=!0,je=!0;return fe&&(fe.call("foo",function(Je,Ue,xe){typeof xe!="object"&&(ye=!1)}),fe.call([1],function(){je=typeof this=="string"},"x")),!!fe&&ye&&je};B(u,{forEach:function(fe){var ye=q(this),je=ce&&k(this)?this.split(""):ye,Je=arguments[1],Ue=-1,xe=je.length>>>0;if(!I(fe))throw new TypeError;for(;++Ue<xe;)Ue in je&&fe.call(Je,je[Ue],Ue,ye)}},!$(u.forEach));var le=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;B(u,{indexOf:function(fe){var ye=ce&&k(this)?this.split(""):q(this),je=ye.length>>>0;if(!je)return-1;var Je=0;for(arguments.length>1&&(Je=K(arguments[1])),Je=Je>=0?Je:Math.max(0,je+Je);Je<je;Je++)if(Je in ye&&ye[Je]===fe)return Je;return-1}},le);var ne=g.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var Se=/()??/.exec("")[1]===void 0;g.split=function(fe,ye){var je=this;if(fe===void 0&&ye===0)return[];if(C.call(fe)!=="[object RegExp]")return ne.call(this,fe,ye);var Je=[],Ue=(fe.ignoreCase?"i":"")+(fe.multiline?"m":"")+(fe.extended?"x":"")+(fe.sticky?"y":""),xe=0,Ge,dt,Xe,We;for(fe=new RegExp(fe.source,Ue+"g"),je+="",Se||(Ge=new RegExp("^"+fe.source+"$(?!\\s)",Ue)),ye=ye===void 0?-1>>>0:ie(ye);(dt=fe.exec(je))&&(Xe=dt.index+dt[0].length,!(Xe>xe&&(Je.push(je.slice(xe,dt.index)),!Se&&dt.length>1&&dt[0].replace(Ge,function(){for(var Ae=1;Ae<arguments.length-2;Ae++)arguments[Ae]===void 0&&(dt[Ae]=void 0)}),dt.length>1&&dt.index<je.length&&u.push.apply(Je,dt.slice(1)),We=dt[0].length,xe=Xe,Je.length>=ye)));)fe.lastIndex===dt.index&&fe.lastIndex++;return xe===je.length?(We||!fe.test(""))&&Je.push(""):Je.push(je.slice(xe)),Je.length>ye?Je.slice(0,ye):Je}}():"0".split(void 0,0).length&&(g.split=function(fe,ye){return fe===void 0&&ye===0?[]:ne.call(this,fe,ye)});var de=g.substr,be="".substr&&"0b".substr(-1)!=="b";return B(g,{substr:function(fe,ye){return de.call(this,fe<0&&(fe=this.length+fe)<0?0:fe,ye)}},be),U3}var FA,j3;function Nte(){if(j3)return FA;j3=1;var u=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h,f=function(g){var S,C={},I=[];for(S=0;S<65536;S++)I.push(String.fromCharCode(S));return g.lastIndex=0,I.join("").replace(g,function(N){return C[N]="\\u"+("0000"+N.charCodeAt(0).toString(16)).slice(-4),""}),g.lastIndex=0,C};return FA={quote:function(g){var S=JSON.stringify(g);return u.lastIndex=0,u.test(S)?(h||(h=f(u)),S.replace(u,function(C){return h[C]})):S}},FA}var BA,F3;function Pte(){if(F3)return BA;F3=1;var u=function(){};return BA=function(h){return{filterToEnabled:function(f,g){var S={main:[],facade:[]};return f?typeof f=="string"&&(f=[f]):f=[],h.forEach(function(C){if(C&&!(C.transportName==="websocket"&&g.websocket===!1)){if(f.length&&f.indexOf(C.transportName)===-1){u("not in whitelist",C.transportName);return}C.enabled(g)?(u("enabled",C.transportName),S.main.push(C),C.facadeTransport&&S.facade.push(C.facadeTransport)):u("disabled",C.transportName)}}),S}}},BA}var WA,B3;function Dte(){if(B3)return WA;B3=1;var u={};return["log","debug","warn"].forEach(function(h){var f;try{f=globalThis.console&&globalThis.console[h]&&globalThis.console[h].apply}catch{}u[h]=f?function(){return globalThis.console[h].apply(globalThis.console,arguments)}:h==="log"?function(){}:u.log}),WA=u,WA}var GA,W3;function q1(){if(W3)return GA;W3=1;function u(h){this.type=h}return u.prototype.initEvent=function(h,f,g){return this.type=h,this.bubbles=f,this.cancelable=g,this.timeStamp=+new Date,this},u.prototype.stopPropagation=function(){},u.prototype.preventDefault=function(){},u.CAPTURING_PHASE=1,u.AT_TARGET=2,u.BUBBLING_PHASE=3,GA=u,GA}var HA,G3;function dF(){return G3||(G3=1,HA=globalThis.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}),HA}var KA,H3;function kte(){if(H3)return KA;H3=1;var u=Un(),h=q1();function f(){h.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return u(f,h),KA=f,KA}var zA,K3;function Lte(){if(K3)return zA;K3=1;var u=Un(),h=q1();function f(g){h.call(this),this.initEvent("message",!1,!1),this.data=g}return u(f,h),zA=f,zA}var YA,z3;function xte(){if(z3)return YA;z3=1;var u=us().EventEmitter,h=Un();function f(){var g=this;u.call(this),this.to=setTimeout(function(){g.emit("finish",200,"{}")},f.timeout)}return h(f,u),f.prototype.close=function(){clearTimeout(this.to)},f.timeout=2e3,YA=f,YA}var qA,Y3;function uF(){if(Y3)return qA;Y3=1;var u=us().EventEmitter,h=Un(),f=Y1();function g(S,C){u.call(this);var I=this,N=+new Date;this.xo=new C("GET",S),this.xo.once("finish",function(k,M){var F,B;if(k===200){if(B=+new Date-N,M)try{F=JSON.parse(M)}catch{}f.isObject(F)||(F={})}I.emit("finish",F,B),I.removeAllListeners()})}return h(g,u),g.prototype.close=function(){this.removeAllListeners(),this.xo.close()},qA=g,qA}var XA,q3;function hF(){if(q3)return XA;q3=1;var u=Un(),h=us().EventEmitter,f=VE(),g=uF();function S(C){var I=this;h.call(this),this.ir=new g(C,f),this.ir.once("finish",function(N,k){I.ir=null,I.emit("message",JSON.stringify([N,k]))})}return u(S,h),S.transportName="iframe-info-receiver",S.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},XA=S,XA}var JA,X3;function Mte(){if(X3)return JA;X3=1;var u=us().EventEmitter,h=Un(),f=Qd(),g=lF(),S=hF();function C(I,N){var k=this;u.call(this);var M=function(){var F=k.ifr=new g(S.transportName,N,I);F.once("message",function(B){if(B){var q;try{q=JSON.parse(B)}catch{k.emit("finish"),k.close();return}var K=q[0],ie=q[1];k.emit("finish",K,ie)}k.close()}),F.once("close",function(){k.emit("finish"),k.close()})};globalThis.document.body?M():f.attachEvent("load",M)}return h(C,u),C.enabled=function(){return g.enabled()},C.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},JA=C,JA}var QA,J3;function Ute(){if(J3)return QA;J3=1;var u=us().EventEmitter,h=Un(),f=qo(),g=z1(),S=L0(),C=VE(),I=xte(),N=Mte(),k=uF();function M(F,B){var q=this;u.call(this),setTimeout(function(){q.doXhr(F,B)},0)}return h(M,u),M._getReceiver=function(F,B,q){return q.sameOrigin?new k(B,C):S.enabled?new k(B,S):g.enabled&&q.sameScheme?new k(B,g):N.enabled()?new N(F,B):new k(B,I)},M.prototype.doXhr=function(F,B){var q=this,K=f.addPath(F,"/info");this.xo=M._getReceiver(F,K,B),this.timeoutRef=setTimeout(function(){q._cleanup(!1),q.emit("finish")},M.timeout),this.xo.once("finish",function(ie,X){q._cleanup(!0),q.emit("finish",ie,X)})},M.prototype._cleanup=function(F){clearTimeout(this.timeoutRef),this.timeoutRef=null,!F&&this.xo&&this.xo.close(),this.xo=null},M.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},M.timeout=8e3,QA=M,QA}var ZA,Q3;function Vte(){if(Q3)return ZA;Q3=1;var u=FE();function h(f){this._transport=f,f.on("message",this._transportMessage.bind(this)),f.on("close",this._transportClose.bind(this))}return h.prototype._transportClose=function(f,g){u.postMessage("c",JSON.stringify([f,g]))},h.prototype._transportMessage=function(f){u.postMessage("t",f)},h.prototype._send=function(f){this._transport.send(f)},h.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},ZA=h,ZA}var $A,Z3;function jte(){if(Z3)return $A;Z3=1;var u=qo(),h=Qd(),f=Vte(),g=hF(),S=FE(),C=dF(),I=function(){};return $A=function(N,k){var M={};k.forEach(function(B){B.facadeTransport&&(M[B.facadeTransport.transportName]=B.facadeTransport)}),M[g.transportName]=g;var F;N.bootstrap_iframe=function(){var B;S.currentWindowId=C.hash.slice(1);var q=function(K){if(K.source===parent&&(typeof F>"u"&&(F=K.origin),K.origin===F)){var ie;try{ie=JSON.parse(K.data)}catch{I("bad json",K.data);return}if(ie.windowId===S.currentWindowId)switch(ie.type){case"s":var X;try{X=JSON.parse(ie.data)}catch{I("bad json",ie.data);break}var te=X[0],ce=X[1],$=X[2],le=X[3];if(te!==N.version)throw new Error('Incompatible SockJS! Main site uses: "'+te+'", the iframe: "'+N.version+'".');if(!u.isOriginEqual($,C.href)||!u.isOriginEqual(le,C.href))throw new Error("Can't connect to different domain from within an iframe. ("+C.href+", "+$+", "+le+")");B=new f(new M[ce]($,le));break;case"m":B._send(ie.data);break;case"c":B&&B._close(),B=null;break}}};h.attachEvent("message",q),S.postMessage("s")}},$A}var e1,$3;function Fte(){if($3)return e1;$3=1,Ote();var u=nF(),h=Un(),f=pm(),g=Nte(),S=qo(),C=Qd(),I=Pte(),N=Y1(),k=jE(),M=Dte(),F=q1(),B=rF(),q=dF(),K=kte(),ie=Lte(),X=Ute(),te=function(){},ce;function $(ne,de,be){if(!(this instanceof $))return new $(ne,de,be);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");B.call(this),this.readyState=$.CONNECTING,this.extensions="",this.protocol="",be=be||{},be.protocols_whitelist&&M.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=be.transports,this._transportOptions=be.transportOptions||{},this._timeout=be.timeout||0;var Se=be.sessionId||8;if(typeof Se=="function")this._generateSessionId=Se;else if(typeof Se=="number")this._generateSessionId=function(){return f.string(Se)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=be.server||f.numberString(1e3);var fe=new u(ne);if(!fe.host||!fe.protocol)throw new SyntaxError("The URL '"+ne+"' is invalid");if(fe.hash)throw new SyntaxError("The URL must not contain a fragment");if(fe.protocol!=="http:"&&fe.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+fe.protocol+"' is not allowed.");var ye=fe.protocol==="https:";if(q.protocol==="https:"&&!ye&&!S.isLoopbackAddr(fe.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");de?Array.isArray(de)||(de=[de]):de=[];var je=de.sort();je.forEach(function(Ue,xe){if(!Ue)throw new SyntaxError("The protocols entry '"+Ue+"' is invalid.");if(xe<je.length-1&&Ue===je[xe+1])throw new SyntaxError("The protocols entry '"+Ue+"' is duplicated.")});var Je=S.getOrigin(q.href);this._origin=Je?Je.toLowerCase():null,fe.set("pathname",fe.pathname.replace(/\/+$/,"")),this.url=fe.href,te("using url",this.url),this._urlInfo={nullOrigin:!k.hasDomain(),sameOrigin:S.isOriginEqual(this.url,q.href),sameScheme:S.isSchemeEqual(this.url,q.href)},this._ir=new X(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}h($,B);function le(ne){return ne===1e3||ne>=3e3&&ne<=4999}return $.prototype.close=function(ne,de){if(ne&&!le(ne))throw new Error("InvalidAccessError: Invalid code");if(de&&de.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===$.CLOSING||this.readyState===$.CLOSED)){var be=!0;this._close(ne||1e3,de||"Normal closure",be)}},$.prototype.send=function(ne){if(typeof ne!="string"&&(ne=""+ne),this.readyState===$.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===$.OPEN&&this._transport.send(g.quote(ne))},$.version=cF(),$.CONNECTING=0,$.OPEN=1,$.CLOSING=2,$.CLOSED=3,$.prototype._receiveInfo=function(ne,de){if(this._ir=null,!ne){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(de),this._transUrl=ne.base_url?ne.base_url:this.url,ne=N.extend(ne,this._urlInfo);var be=ce.filterToEnabled(this._transportsWhitelist,ne);this._transports=be.main,te(this._transports.length+" enabled transports"),this._connect()},$.prototype._connect=function(){for(var ne=this._transports.shift();ne;ne=this._transports.shift()){if(te("attempt",ne.transportName),ne.needBody&&(!globalThis.document.body||typeof globalThis.document.readyState<"u"&&globalThis.document.readyState!=="complete"&&globalThis.document.readyState!=="interactive")){this._transports.unshift(ne),C.attachEvent("load",this._connect.bind(this));return}var de=Math.max(this._timeout,this._rto*ne.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),de);var be=S.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),Se=this._transportOptions[ne.transportName],fe=new ne(be,this._transUrl,Se);fe.on("message",this._transportMessage.bind(this)),fe.once("close",this._transportClose.bind(this)),fe.transportName=ne.transportName,this._transport=fe;return}this._close(2e3,"All transports failed",!1)},$.prototype._transportTimeout=function(){this.readyState===$.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},$.prototype._transportMessage=function(ne){var de=this,be=ne.slice(0,1),Se=ne.slice(1),fe;switch(be){case"o":this._open();return;case"h":this.dispatchEvent(new F("heartbeat")),te("heartbeat",this.transport);return}if(Se)try{fe=JSON.parse(Se)}catch{}if(!(typeof fe>"u"))switch(be){case"a":Array.isArray(fe)&&fe.forEach(function(ye){te("message",de.transport),de.dispatchEvent(new ie(ye))});break;case"m":te("message",this.transport),this.dispatchEvent(new ie(fe));break;case"c":Array.isArray(fe)&&fe.length===2&&this._close(fe[0],fe[1],!0);break}},$.prototype._transportClose=function(ne,de){if(te("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!le(ne)&&ne!==2e3&&this.readyState===$.CONNECTING){this._connect();return}this._close(ne,de)},$.prototype._open=function(){te("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===$.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=$.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new F("open")),te("connected",this.transport)):this._close(1006,"Server lost session")},$.prototype._close=function(ne,de,be){te("_close",this.transport,ne,de,be,this.readyState);var Se=!1;if(this._ir&&(Se=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===$.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=$.CLOSING,setTimeout((function(){this.readyState=$.CLOSED,Se&&this.dispatchEvent(new F("error"));var fe=new K("close");fe.wasClean=be||!1,fe.code=ne||1e3,fe.reason=de,this.dispatchEvent(fe),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},$.prototype.countRTO=function(ne){return ne>100?4*ne:300+ne},e1=function(ne){return ce=I(ne),jte()($,ne),$},e1}var t1,ej;function Bte(){if(ej)return t1;ej=1;var u=Ate();return t1=Fte()(u),"_sockjs_onload"in globalThis&&setTimeout(globalThis._sockjs_onload,1),t1}var Wte=Bte();const Gte=g0(Wte);function Hte(u,h){u.terminate=function(){const f=()=>{};this.onerror=f,this.onmessage=f,this.onopen=f;const g=new Date,S=Math.random().toString().substring(2,8),C=this.onclose;this.onclose=I=>{const N=new Date().getTime()-g.getTime();h(`Discarded socket (#${S})  closed after ${N}ms, with code/reason: ${I.code}/${I.reason}`)},this.close(),C?.call(u,{code:4001,reason:`Quick discarding socket (#${S}) without waiting for the shutdown sequence.`,wasClean:!1})}}const TE={LF:`
`,NULL:"\0"};class Hd{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(h){const{command:f,headers:g,body:S,binaryBody:C,escapeHeaderValues:I,skipContentLengthHeader:N}=h;this.command=f,this.headers=Object.assign({},g||{}),C?(this._binaryBody=C,this.isBinaryBody=!0):(this._body=S||"",this.isBinaryBody=!1),this.escapeHeaderValues=I||!1,this.skipContentLengthHeader=N||!1}static fromRawFrame(h,f){const g={},S=C=>C.replace(/^\s+|\s+$/g,"");for(const C of h.headers.reverse()){C.indexOf(":");const I=S(C[0]);let N=S(C[1]);f&&h.command!=="CONNECT"&&h.command!=="CONNECTED"&&(N=Hd.hdrValueUnEscape(N)),g[I]=N}return new Hd({command:h.command,headers:g,binaryBody:h.binaryBody,escapeHeaderValues:f})}toString(){return this.serializeCmdAndHeaders()}serialize(){const h=this.serializeCmdAndHeaders();return this.isBinaryBody?Hd.toUnit8Array(h,this._binaryBody).buffer:h+this._body+TE.NULL}serializeCmdAndHeaders(){const h=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const f of Object.keys(this.headers||{})){const g=this.headers[f];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?h.push(`${f}:${Hd.hdrValueEscape(`${g}`)}`):h.push(`${f}:${g}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&h.push(`content-length:${this.bodyLength()}`),h.join(TE.LF)+TE.LF+TE.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const h=this.binaryBody;return h?h.length:0}static sizeOfUTF8(h){return h?new TextEncoder().encode(h).length:0}static toUnit8Array(h,f){const g=new TextEncoder().encode(h),S=new Uint8Array([0]),C=new Uint8Array(g.length+f.length+S.length);return C.set(g),C.set(f,g.length),C.set(S,g.length+f.length),C}static marshall(h){return new Hd(h).serialize()}static hdrValueEscape(h){return h.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(h){return h.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const tj=0,r0=10,i0=13,Kte=58;class zte{constructor(h,f){this.onFrame=h,this.onIncomingPing=f,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(h,f=!1){let g;if(typeof h=="string"?g=this._encoder.encode(h):g=new Uint8Array(h),f&&g[g.length-1]!==0){const S=new Uint8Array(g.length+1);S.set(g,0),S[g.length]=0,g=S}for(let S=0;S<g.length;S++){const C=g[S];this._onByte(C)}}_collectFrame(h){if(h!==tj&&h!==i0){if(h===r0){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(h)}}_collectCommand(h){if(h!==i0){if(h===r0){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(h)}}_collectHeaders(h){if(h!==i0){if(h===r0){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(h)}}_reinjectByte(h){this._onByte(h)}_collectHeaderKey(h){if(h===Kte){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(h)}_collectHeaderValue(h){if(h!==i0){if(h===r0){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(h)}}_setupCollectBody(){const h=this._results.headers.filter(f=>f[0]==="content-length")[0];h?(this._bodyBytesRemaining=parseInt(h[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(h){if(h===tj){this._retrievedBody();return}this._consumeByte(h)}_collectBodyFixedSize(h){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(h)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(h){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",h)}this._initState()}_consumeByte(h){this._token.push(h)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const h=new Uint8Array(this._token);return this._token=[],h}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var Kd;(function(u){u[u.CONNECTING=0]="CONNECTING",u[u.OPEN=1]="OPEN",u[u.CLOSING=2]="CLOSING",u[u.CLOSED=3]="CLOSED"})(Kd||(Kd={}));var Pa;(function(u){u[u.ACTIVE=0]="ACTIVE",u[u.DEACTIVATING=1]="DEACTIVATING",u[u.INACTIVE=2]="INACTIVE"})(Pa||(Pa={}));var m0;(function(u){u[u.LINEAR=0]="LINEAR",u[u.EXPONENTIAL=1]="EXPONENTIAL"})(m0||(m0={}));var LE;(function(u){u.Interval="interval",u.Worker="worker"})(LE||(LE={}));class Yte{constructor(h,f=LE.Interval,g){this._interval=h,this._strategy=f,this._debug=g,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(h){this.stop(),this.shouldUseWorker()?this.runWorker(h):this.runInterval(h)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===LE.Worker}runWorker(h){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=f=>h(f.data))}runInterval(h){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const f=Date.now();this._timer=setInterval(()=>{h(Date.now()-f)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class ds{constructor(h){this.versions=h}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(h=>`v${h.replace(".","")}.stomp`)}}ds.V1_0="1.0";ds.V1_1="1.1";ds.V1_2="1.2";ds.default=new ds([ds.V1_2,ds.V1_1,ds.V1_0]);class qte{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(h,f,g){this._client=h,this._webSocket=f,this._connected=!1,this._serverFrameHandlers={CONNECTED:S=>{this.debug(`connected to server ${S.headers.server}`),this._connected=!0,this._connectedVersion=S.headers.version,this._connectedVersion===ds.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(S.headers),this.onConnect(S)},MESSAGE:S=>{const C=S.headers.subscription,I=this._subscriptions[C]||this.onUnhandledMessage,N=S,k=this,M=this._connectedVersion===ds.V1_2?N.headers.ack:N.headers["message-id"];N.ack=(F={})=>k.ack(M,C,F),N.nack=(F={})=>k.nack(M,C,F),I(N)},RECEIPT:S=>{const C=this._receiptWatchers[S.headers["receipt-id"]];C?(C(S),delete this._receiptWatchers[S.headers["receipt-id"]]):this.onUnhandledReceipt(S)},ERROR:S=>{this.onStompError(S)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=g.debug,this.stompVersions=g.stompVersions,this.connectHeaders=g.connectHeaders,this.disconnectHeaders=g.disconnectHeaders,this.heartbeatIncoming=g.heartbeatIncoming,this.heartbeatToleranceMultiplier=g.heartbeatGracePeriods,this.heartbeatOutgoing=g.heartbeatOutgoing,this.splitLargeFrames=g.splitLargeFrames,this.maxWebSocketChunkSize=g.maxWebSocketChunkSize,this.forceBinaryWSFrames=g.forceBinaryWSFrames,this.logRawCommunication=g.logRawCommunication,this.appendMissingNULLonIncoming=g.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=g.discardWebsocketOnCommFailure,this.onConnect=g.onConnect,this.onDisconnect=g.onDisconnect,this.onStompError=g.onStompError,this.onWebSocketClose=g.onWebSocketClose,this.onWebSocketError=g.onWebSocketError,this.onUnhandledMessage=g.onUnhandledMessage,this.onUnhandledReceipt=g.onUnhandledReceipt,this.onUnhandledFrame=g.onUnhandledFrame,this.onHeartbeatReceived=g.onHeartbeatReceived,this.onHeartbeatLost=g.onHeartbeatLost}start(){const h=new zte(f=>{const g=Hd.fromRawFrame(f,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${g}`),(this._serverFrameHandlers[g.command]||this.onUnhandledFrame)(g)},()=>{this.debug("<<< PONG"),this.onHeartbeatReceived()});this._webSocket.onmessage=f=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const g=f.data instanceof ArrayBuffer?new TextDecoder().decode(f.data):f.data;this.debug(`<<< ${g}`)}h.parseChunk(f.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=f=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(f)},this._webSocket.onerror=f=>{this.onWebSocketError(f)},this._webSocket.onopen=()=>{const f=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),f["accept-version"]=this.stompVersions.supportedVersions(),f["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:f})}}_setupHeartbeat(h){if(h.version!==ds.V1_1&&h.version!==ds.V1_2||!h["heart-beat"])return;const[f,g]=h["heart-beat"].split(",").map(S=>parseInt(S,10));if(this.heartbeatOutgoing!==0&&g!==0){const S=Math.max(this.heartbeatOutgoing,g);this.debug(`send PING every ${S}ms`),this._pinger=new Yte(S,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===Kd.OPEN&&(this._webSocket.send(TE.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&f!==0){const S=Math.max(this.heartbeatIncoming,f);this.debug(`check PONG every ${S}ms`),this._ponger=setInterval(()=>{const C=Date.now()-this._lastServerActivityTS;C>S*this.heartbeatToleranceMultiplier&&(this.debug(`did not receive server activity for the last ${C}ms`),this.onHeartbeatLost(),this._closeOrDiscardWebsocket())},S)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===Kd.CONNECTING||this._webSocket.readyState===Kd.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&Hte(this._webSocket,h=>this.debug(h)),this._webSocket.terminate()}_transmit(h){const{command:f,headers:g,body:S,binaryBody:C,skipContentLengthHeader:I}=h,N=new Hd({command:f,headers:g,body:S,binaryBody:C,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:I});let k=N.serialize();if(this.logRawCommunication?this.debug(`>>> ${k}`):this.debug(`>>> ${N}`),this.forceBinaryWSFrames&&typeof k=="string"&&(k=new TextEncoder().encode(k)),typeof k!="string"||!this.splitLargeFrames)this._webSocket.send(k);else{let M=k;for(;M.length>0;){const F=M.substring(0,this.maxWebSocketChunkSize);M=M.substring(this.maxWebSocketChunkSize),this._webSocket.send(F),this.debug(`chunk sent = ${F.length}, remaining = ${M.length}`)}}}dispose(){if(this.connected)try{const h=Object.assign({},this.disconnectHeaders);h.receipt||(h.receipt=`close-${this._counter++}`),this.watchForReceipt(h.receipt,f=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(f)}),this._transmit({command:"DISCONNECT",headers:h})}catch(h){this.debug(`Ignoring error during disconnect ${h}`)}else(this._webSocket.readyState===Kd.CONNECTING||this._webSocket.readyState===Kd.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(h){const{destination:f,headers:g,body:S,binaryBody:C,skipContentLengthHeader:I}=h,N=Object.assign({destination:f},g);this._transmit({command:"SEND",headers:N,body:S,binaryBody:C,skipContentLengthHeader:I})}watchForReceipt(h,f){this._receiptWatchers[h]=f}subscribe(h,f,g={}){g=Object.assign({},g),g.id||(g.id=`sub-${this._counter++}`),g.destination=h,this._subscriptions[g.id]=f,this._transmit({command:"SUBSCRIBE",headers:g});const S=this;return{id:g.id,unsubscribe(C){return S.unsubscribe(g.id,C)}}}unsubscribe(h,f={}){f=Object.assign({},f),delete this._subscriptions[h],f.id=h,this._transmit({command:"UNSUBSCRIBE",headers:f})}begin(h){const f=h||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:f}});const g=this;return{id:f,commit(){g.commit(f)},abort(){g.abort(f)}}}commit(h){this._transmit({command:"COMMIT",headers:{transaction:h}})}abort(h){this._transmit({command:"ABORT",headers:{transaction:h}})}ack(h,f,g={}){g=Object.assign({},g),this._connectedVersion===ds.V1_2?g.id=h:g["message-id"]=h,g.subscription=f,this._transmit({command:"ACK",headers:g})}nack(h,f,g={}){return g=Object.assign({},g),this._connectedVersion===ds.V1_2?g.id=h:g["message-id"]=h,g.subscription=f,this._transmit({command:"NACK",headers:g})}}class Xte{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(h){this._disconnectHeaders=h,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===Pa.ACTIVE}_changeState(h){this.state=h,this.onChangeState(h)}constructor(h={}){this.stompVersions=ds.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=900*1e3,this.reconnectTimeMode=m0.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatToleranceMultiplier=2,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=LE.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=Pa.INACTIVE;const f=()=>{};this.debug=f,this.beforeConnect=f,this.onConnect=f,this.onDisconnect=f,this.onUnhandledMessage=f,this.onUnhandledReceipt=f,this.onUnhandledFrame=f,this.onHeartbeatReceived=f,this.onHeartbeatLost=f,this.onStompError=f,this.onWebSocketClose=f,this.onWebSocketError=f,this.logRawCommunication=!1,this.onChangeState=f,this.connectHeaders={},this._disconnectHeaders={},this.configure(h)}configure(h){Object.assign(this,h),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const h=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(Pa.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===Pa.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{h()})):h()}async _connect(){if(await this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const h=this._createWebSocket();this._stompHandler=new qte(this,h,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatGracePeriods:this.heartbeatToleranceMultiplier,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:f=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(f)},onDisconnect:f=>{this.onDisconnect(f)},onStompError:f=>{this.onStompError(f)},onWebSocketClose:f=>{this._stompHandler=void 0,this.state===Pa.DEACTIVATING&&this._changeState(Pa.INACTIVE),this.onWebSocketClose(f),this.active&&this._schedule_reconnect()},onWebSocketError:f=>{this.onWebSocketError(f)},onUnhandledMessage:f=>{this.onUnhandledMessage(f)},onUnhandledReceipt:f=>{this.onUnhandledReceipt(f)},onUnhandledFrame:f=>{this.onUnhandledFrame(f)},onHeartbeatReceived:()=>{this.onHeartbeatReceived()},onHeartbeatLost:()=>{this.onHeartbeatLost()}}),this._stompHandler.start()}_createWebSocket(){let h;if(this.webSocketFactory)h=this.webSocketFactory();else if(this.brokerURL)h=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return h.binaryType="arraybuffer",h}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===m0.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}async deactivate(h={}){const f=h.force||!1,g=this.active;let S;if(this.state===Pa.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(Pa.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==Kd.CLOSED){const C=this._stompHandler.onWebSocketClose;S=new Promise((I,N)=>{this._stompHandler.onWebSocketClose=k=>{C(k),I()}})}else return this._changeState(Pa.INACTIVE),Promise.resolve();return f?this._stompHandler?.discardWebsocket():g&&this._disposeStompHandler(),S}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(h){this._checkConnection(),this._stompHandler.publish(h)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(h,f){this._checkConnection(),this._stompHandler.watchForReceipt(h,f)}subscribe(h,f,g={}){return this._checkConnection(),this._stompHandler.subscribe(h,f,g)}unsubscribe(h,f={}){this._checkConnection(),this._stompHandler.unsubscribe(h,f)}begin(h){return this._checkConnection(),this._stompHandler.begin(h)}commit(h){this._checkConnection(),this._stompHandler.commit(h)}abort(h){this._checkConnection(),this._stompHandler.abort(h)}ack(h,f,g={}){this._checkConnection(),this._stompHandler.ack(h,f,g)}nack(h,f,g={}){this._checkConnection(),this._stompHandler.nack(h,f,g)}}class Jte{client=null;subscriptions=new Map;connectionState={isConnected:!1,isConnecting:!1,reconnectAttempts:0,maxReconnectAttempts:5};onConnectionStateChangeCallbacks=[];onMatchingNotificationCallbacks=[];onCallStartNotificationCallbacks=[];onCallEndNotificationCallbacks=[];onErrorCallbacks=[];constructor(){}setupClient(h){const f="http://localhost:8080/ws";console.log(" WebSocket URL:",f),lt.log(" WebSocket  ");const g=new Gte(f);this.client=new Xte({webSocketFactory:()=>g,debug:S=>{console.log("STOMP Debug:",S)},reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),this.client.onConnect=S=>{console.log(" WebSocket  :",S),console.log("  :",S.headers),console.log("  :",S.body),this.connectionState={...this.connectionState,isConnected:!0,isConnecting:!1,reconnectAttempts:0,lastConnected:new Date().toISOString()},this.onConnectionStateChangeCallbacks.forEach(C=>C(this.connectionState)),console.log("   "),this.subscribeToQueues(),setTimeout(()=>{this.logSubscriptionStatus()},100)},this.client.onStompError=S=>{console.error(" STOMP :",S),console.error("  :",S.headers),console.error("  :",S.body),this.connectionState={...this.connectionState,isConnected:!1,isConnecting:!1},this.onConnectionStateChangeCallbacks.forEach(I=>I(this.connectionState));const C=`WebSocket  : ${S.headers.message||"   "}`;this.onErrorCallbacks.forEach(I=>I(C))},this.client.onDisconnect=()=>{console.log("WebSocket  "),this.connectionState={...this.connectionState,isConnected:!1,isConnecting:!1},this.onConnectionStateChangeCallbacks.forEach(S=>S(this.connectionState))}}async connect(h){if(this.connectionState.isConnected||this.connectionState.isConnecting){console.log("    .");return}try{console.log(" WebSocket   "),this.connectionState={...this.connectionState,isConnecting:!0},this.onConnectionStateChangeCallbacks.forEach(f=>f(this.connectionState)),this.client||(console.log(" WebSocket  "),this.setupClient(h)),this.client.connectHeaders={Authorization:`Bearer ${h}`},console.log(" JWT    (URL + )"),console.log(" STOMP   "),await this.client.activate(),console.log(" STOMP   ")}catch(f){console.error(" WebSocket  :",f),this.connectionState={...this.connectionState,isConnecting:!1,reconnectAttempts:this.connectionState.reconnectAttempts+1},this.onConnectionStateChangeCallbacks.forEach(S=>S(this.connectionState));const g=` : ${f instanceof Error?f.message:"   "}`;throw this.onErrorCallbacks.forEach(S=>S(g)),f}}disconnect(){this.client&&this.connectionState.isConnected&&(this.unsubscribeFromQueues(),this.client.deactivate())}subscribeToQueues(){if(!this.client||!this.connectionState.isConnected){console.warn(" WebSocket    ");return}console.log("    -  :",{isConnected:this.connectionState.isConnected,clientExists:!!this.client}),console.log(" /user/queue/matching  ");const h=this.client.subscribe("/user/queue/matching",S=>{try{console.log(" [] WebSocket   (/user/queue/matching):",S.body);const C=JSON.parse(S.body);console.log(" []   :",C),console.log(" []  :",{type:C.type,matchingId:C.matchingId,matchedUser:C.matchedUser,message:C.message,timestamp:C.timestamp}),console.log(` [] ${this.onMatchingNotificationCallbacks.length}  `),this.onMatchingNotificationCallbacks.forEach(I=>I(C))}catch(C){console.error(" []   :",C),console.error(" []  :",S.body);const I="     .";this.onErrorCallbacks.forEach(N=>N(I))}});console.log(" /user/queue/call-start  ");const f=this.client.subscribe("/user/queue/call-start",S=>{try{console.log(" [] WebSocket   (/user/queue/call-start):",S.body);const C=JSON.parse(S.body);console.log(" []   :",C),console.log(" []  :",{type:C.type,callId:C.callId,matchingId:C.matchingId,partnerId:C.partnerId,partnerNickname:C.partnerNickname,channelName:C.channelName,agoraUid:C.agoraUid,timestamp:C.timestamp}),console.log(` [] ${this.onCallStartNotificationCallbacks.length}  `),this.onCallStartNotificationCallbacks.forEach(I=>I(C))}catch(C){console.error(" []   :",C),console.error(" []  :",S.body);const I="      .";this.onErrorCallbacks.forEach(N=>N(I))}});console.log(" /user/queue/call-end  ");const g=this.client.subscribe("/user/queue/call-end",S=>{try{console.log(" [] WebSocket   (/user/queue/call-end):",S.body);const C=JSON.parse(S.body);console.log(" []   :",C),console.log(" []  :",{type:C.type,callId:C.callId,partnerId:C.partnerId,timestamp:C.timestamp}),console.log(` [] ${this.onCallEndNotificationCallbacks.length}  `),this.onCallEndNotificationCallbacks.forEach(I=>I(C))}catch(C){console.error(" []   :",C),console.error(" []  :",S.body);const I="      .";this.onErrorCallbacks.forEach(N=>N(I))}});this.subscriptions.set("matching",h),this.subscriptions.set("call-start",f),this.subscriptions.set("call-end",g),console.log("   :",{matchingSubscribed:this.subscriptions.has("matching"),callStartSubscribed:this.subscriptions.has("call-start"),callEndSubscribed:this.subscriptions.has("call-end"),totalSubscriptions:this.subscriptions.size})}unsubscribeFromQueues(){this.subscriptions.forEach((h,f)=>{h.unsubscribe(),console.log(` : ${f}`)}),this.subscriptions.clear()}onConnectionStateChangeCallback(h){this.onConnectionStateChangeCallbacks.includes(h)||(this.onConnectionStateChangeCallbacks.push(h),console.log(`      ( ${this.onConnectionStateChangeCallbacks.length})`))}onMatchingNotificationCallback(h){this.onMatchingNotificationCallbacks.includes(h)||(this.onMatchingNotificationCallbacks.push(h),console.log(`     ( ${this.onMatchingNotificationCallbacks.length})`))}onCallStartNotificationCallback(h){this.onCallStartNotificationCallbacks.includes(h)||(this.onCallStartNotificationCallbacks.push(h),console.log(`      ( ${this.onCallStartNotificationCallbacks.length})`))}onCallEndNotificationCallback(h){this.onCallEndNotificationCallbacks.includes(h)||(this.onCallEndNotificationCallbacks.push(h),console.log(`      ( ${this.onCallEndNotificationCallbacks.length})`))}onErrorCallback(h){this.onErrorCallbacks.includes(h)||(this.onErrorCallbacks.push(h),console.log(`    ( ${this.onErrorCallbacks.length})`))}sendMessage(h,f){if(!this.client||!this.connectionState.isConnected)throw console.error(" WebSocket   -   "),new Error("WebSocket  .");try{this.client.publish({destination:h,body:JSON.stringify(f)}),console.log(" WebSocket   ")}catch(g){throw console.error(" WebSocket   :",g),g}}sendCallEndNotification(h,f){const g={type:"call_end",callId:h,partnerId:f,timestamp:new Date().toISOString()},S=`/app/call-end/${f}`;this.sendMessage(S,g)}getConnectionState(){return{...this.connectionState}}isConnected(){return this.connectionState.isConnected}getSubscriptionStatus(){const h={};return this.subscriptions.forEach((f,g)=>{h[g]=!0}),h}logSubscriptionStatus(){console.log(" WebSocket  :",{isConnected:this.connectionState.isConnected,subscriptions:this.getSubscriptionStatus(),totalSubscriptions:this.subscriptions.size,lastConnected:this.connectionState.lastConnected})}async reconnect(h){if(this.connectionState.reconnectAttempts>=this.connectionState.maxReconnectAttempts)throw new Error("    .");console.log(`  ${this.connectionState.reconnectAttempts+1}/${this.connectionState.maxReconnectAttempts}`),this.disconnect(),this.client=null,await new Promise(f=>setTimeout(f,2e3)),await this.connect(h)}destroy(){this.disconnect(),this.subscriptions.clear(),this.client=null,this.onConnectionStateChangeCallbacks=[],this.onMatchingNotificationCallbacks=[],this.onCallStartNotificationCallbacks=[],this.onCallEndNotificationCallbacks=[],this.onErrorCallbacks=[],console.log(" WebSocket   ")}}let n1=null;const x0=()=>(n1||(n1=new Jte),n1),tm=x0(),nj={status:"idle",matchingId:void 0,categoryId:void 0,location:void 0,queuePosition:void 0,estimatedWaitTime:void 0,matchedUser:void 0,connectionState:{isConnected:!1,isConnecting:!1,reconnectAttempts:0,maxReconnectAttempts:5},categories:[],error:void 0,createdAt:void 0,updatedAt:void 0},X1=tF()(cte(ute((u,h)=>({...nj,startMatching:async f=>{try{u({error:null,status:"waiting"});const g=uo();if(!g)throw new Error("  .");Gd.setToken(g);const S=await Gd.joinMatching(f);u({matchingId:S.queue_id,status:S.queue_status.toLowerCase(),categoryId:S.category_id,queuePosition:S.queue_position,estimatedWaitTime:Math.ceil(S.estimated_wait_time_seconds/60),createdAt:S.created_at,updatedAt:new Date().toISOString()});const C=x0(),I=C.getConnectionState();if(!h().connectionState.isConnected||!I.isConnected)try{await h().connectWebSocket()}catch{}else{const N=C.getSubscriptionStatus();if(Object.keys(N).length===0)try{await h().connectWebSocket()}catch{}}}catch(g){const S=g instanceof Error?g.message:"    .";throw u({error:S,status:"idle"}),g}},cancelMatching:async()=>{try{u({error:null});const f=uo();if(!f)throw new Error("  .");const{matchingId:g}=h();if(!g)throw new Error("  .");Gd.setToken(f),await Gd.cancelMatching(g),u({status:"cancelled",updatedAt:new Date().toISOString()})}catch(f){const g=f instanceof Error?f.message:"    .";throw u({error:g}),f}},refreshMatchingStatus:async()=>{try{u({error:null});const f=uo();if(!f)throw new Error("  .");Gd.setToken(f);const g=await Gd.getMatchingStatus();h().setMatchingStatus(g)}catch(f){const g=f instanceof Error?f.message:"     .";throw u({error:g}),f}},loadCategories:async()=>{try{u({error:null});const f=uo();Gd.setToken(f||void 0);const g=await Gd.getActiveCategories();u({categories:g})}catch(f){const g=f instanceof Error?f.message:"     .";throw u({error:g}),f}},connectWebSocket:async()=>{try{const f=uo();if(!f)throw new Error("  .");u({error:null,connectionState:{...h().connectionState,isConnecting:!0}}),tm.onConnectionStateChangeCallback(g=>{h().setConnectionState(g)}),tm.onMatchingNotificationCallback(g=>{h().handleMatchingNotification(g)}),tm.onCallStartNotificationCallback(g=>{h().handleCallStartNotification(g)}),tm.onErrorCallback(g=>{h().setError(g)}),await tm.connect(f)}catch(f){console.error(" connectWebSocket :",f);const g=f instanceof Error?f.message:"WebSocket    .";throw u({error:g,connectionState:{...h().connectionState,isConnecting:!1}}),f}},disconnectWebSocket:()=>{tm.disconnect(),u({connectionState:{...h().connectionState,isConnected:!1,isConnecting:!1}})},setMatchingStatus:f=>{u({status:f.status,queuePosition:f.queuePosition,estimatedWaitTime:f.estimatedWaitTime,categoryId:f.categoryId,location:f.location,matchedUser:f.matchedUser,updatedAt:new Date().toISOString()})},setConnectionState:f=>{u({connectionState:{...h().connectionState,...f}})},setError:f=>{u({error:f})},setCategories:f=>{u({categories:f})},handleMatchingNotification:f=>{switch(h(),f.type){case"position_update":u({queuePosition:f.queuePosition,estimatedWaitTime:f.estimatedWaitTime,updatedAt:new Date().toISOString()});break;case"matched":u({status:"matched",matchedUser:f.matchedUser,updatedAt:new Date().toISOString()});break;case"cancelled":u({status:"cancelled",updatedAt:new Date().toISOString()});break;case"timeout":u({status:"timeout",updatedAt:new Date().toISOString()});break}},handleCallStartNotification:f=>{u({updatedAt:new Date().toISOString()})},resetMatching:()=>{u({...nj,categories:h().categories,connectionState:h().connectionState})}}),{name:"matching-store",partialize:u=>({categories:u.categories,connectionState:u.connectionState})}),{name:"matching-store"})),_0={HOBBY:{id:1,name:"",icon:"hobby.png"},CHILDREN:{id:2,name:"",icon:"children.png"},SPOUSE:{id:3,name:"",icon:"marriage.png"},MEMORIES:{id:4,name:"",icon:"memories.png"},STRESS:{id:5,name:"",icon:"stress.png"},REQUEST:{id:0,name:"",icon:"plus.png"}};function pF(u){if(u==null)return"  ";const h=typeof u=="string"?parseInt(u):u;if(!isNaN(h))return Object.values(_0).find(C=>C.id===h)?.name||"  ";const f=String(u).toUpperCase();return _0[f]?.name||String(u)}function Qte({isOpen:u,onClose:h,onSubmit:f}){const[g,S]=ee.useState(""),[C,I]=ee.useState(!1),N=async()=>{if(!g.trim()){alert("  .");return}if(g.trim().length<2){alert("   2  .");return}I(!0);try{await f(g.trim()),S(""),h()}catch(F){console.error("  :",F)}finally{I(!1)}},k=()=>{C||(S(""),h())},M=F=>{F.key==="Enter"&&!C&&N()};return u?P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4",onClick:k,children:P.jsxs("div",{className:"bg-white rounded-2xl p-6 md:p-8 max-w-md w-full",onClick:F=>F.stopPropagation(),children:[P.jsx("h2",{className:"text-xl md:text-2xl font-crimson font-bold text-gray-900 mb-3",children:" "}),P.jsxs("p",{className:"text-gray-600 font-pretendard text-sm md:text-base mb-6",children:["   .",P.jsx("br",{}),"     ."]}),P.jsx("input",{type:"text",value:g,onChange:F=>S(F.target.value),onKeyPress:M,placeholder:": , , ,  ",maxLength:20,disabled:C,className:"w-full px-4 py-3 border border-gray-300 rounded-lg font-pretendard text-base focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed mb-6"}),P.jsxs("div",{className:"flex gap-3",children:[P.jsx("button",{onClick:k,disabled:C,className:"flex-1 py-3 border-2 border-gray-300 text-gray-700 font-crimson text-lg font-semibold rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:""}),P.jsx("button",{onClick:N,disabled:C||!g.trim(),className:"flex-1 py-3 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-lg font-semibold rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:C?" ...":""})]})]})}):null}function Zte({onStartCall:u,onOpenSettings:h,onOpenCallHistory:f}){const g=jh(),{startMatching:S,status:C,error:I}=X1(),[N,k]=ee.useState(null),[M,F]=ee.useState(!1),[B,q]=ee.useState(" "),[K,ie]=ee.useState(!0),[X,te]=ee.useState(!1),[ce,$]=ee.useState(!1),[le,ne]=ee.useState(!1);ee.useEffect(()=>{let ye=!0;return(async()=>{try{ie(!0);const Je=await K1();ye&&q(Je.data.nickname)}catch(Je){console.error("   :",Je),Je instanceof Error&&Je.message.includes(" ")&&console.warn("    ")}finally{ye&&ie(!1)}})(),()=>{ye=!1}},[]);const de=Object.values(_0).map(ye=>({id:ye.id.toString(),name:ye.name,icon:ye.id===0?P.jsx("div",{className:"w-full h-full flex items-center justify-center",children:P.jsxs("svg",{className:"w-16 h-16 xs:w-14 xs:h-14",viewBox:"0 0 64 64",fill:"none",preserveAspectRatio:"xMidYMid meet",children:[P.jsx("circle",{cx:"32",cy:"32",r:"30",fill:"#FFDAB9"}),P.jsx("path",{d:"M32 16V48M16 32H48",stroke:"#EF4444",strokeWidth:"6",strokeLinecap:"round"})]})}):P.jsx("div",{className:"w-full h-full flex items-center justify-center",children:P.jsx("img",{src:`/icons/${ye.icon}`,alt:ye.name,className:"w-16 h-16 xs:w-12 xs:h-12 object-contain"})})})),be=async()=>{if(!(!N||X))try{te(!0),await S({category_id:parseInt(N)}),g("/connecting-call")}catch(ye){console.error("   :",ye)}finally{te(!1)}},Se=ye=>{if(ye==="0"){$(!0);return}k(ye)},fe=async ye=>{try{const je=uo();if(!je){alert(" .");return}const Je="http://localhost:8080/api".replace(/\/$/,""),Ue={category_name:ye},xe=await fetch(`${Je}/v1/categories/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${je}`},credentials:"include",body:JSON.stringify(Ue)});if(!xe.ok){const dt=await xe.json().catch(()=>({}));throw new Error(dt.message||"  .")}const Ge=await xe.json();ne(!0),setTimeout(()=>{ne(!1)},2e3)}catch(je){throw console.error("  :",je),alert(je instanceof Error?je.message:"  .  ."),je}};return P.jsxs("div",{className:"min-h-screen bg-grey-50 flex flex-col safe-area-page",children:[P.jsx(Qte,{isOpen:ce,onClose:()=>$(!1),onSubmit:fe}),le&&P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"category-request-success-title","aria-describedby":"category-request-success-desc",children:P.jsxs("div",{className:"bg-white rounded-lg p-6 mx-4 text-center",children:[P.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:P.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),P.jsx("h3",{id:"category-request-success-title",className:"text-lg font-semibold text-gray-900 mb-2",children:"  !"}),P.jsx("p",{id:"category-request-success-desc",className:"text-gray-600",children:"  ."})]})}),P.jsxs("div",{className:"flex items-center justify-between px-8 py-4",children:[P.jsx("div",{className:"flex items-center",children:P.jsxs("svg",{width:"90",height:"28",viewBox:"0 0 90 28",fill:"none",children:[P.jsx("path",{d:"M67.8945 7.44597V4.56752H79.6163V7.44597H75.5525V9.61661C75.5525 10.6076 75.4585 11.4805 75.2706 12.2827C76.3276 13.722 78.7472 15.9634 80.4855 16.8835L79.123 19.8328C77.5726 19.0306 75.4115 17.1431 74.0726 15.2792C73.7907 15.751 73.4853 16.1993 73.1564 16.6712C72.2638 17.9453 70.2671 19.8328 68.9281 20.517L67.0019 17.8037C67.7771 17.4026 69.116 16.3409 70.0557 15.2792C71.5591 13.604 72.1228 12.0232 72.1228 9.73458V7.44597H67.8945ZM81.8244 3.55298H85.2306V10.7963H88.3548V14.0287H85.2306V23.8201H81.8244V3.55298Z",fill:"black"}),P.jsx("path",{d:"M51.7229 10.5604C55.0586 10.5604 57.4781 12.6838 57.4781 15.869C57.4781 19.0542 55.0586 21.154 51.7229 21.154C48.3638 21.154 45.9912 19.0778 45.9912 15.869C45.9912 12.6838 48.3638 10.5604 51.7229 10.5604ZM59.7332 23.8201V3.55296H63.1393V10.985H66.2636V14.2174H63.1393V23.8201H59.7332ZM45.0751 6.4786H50.1255L49.7732 3.48218H53.8371L53.4847 6.4786H58.3472V9.33347H45.0751V6.4786ZM51.7229 13.2029C50.1725 13.2029 49.1155 14.1938 49.1155 15.869C49.1155 17.5677 50.1725 18.5115 51.7229 18.5115C53.2733 18.5115 54.3304 17.5441 54.3304 15.869C54.3304 14.1938 53.2733 13.2029 51.7229 13.2029Z",fill:"black"}),P.jsx("path",{d:"M23.1718 14.4297H35.9507C36.2091 13.368 36.4675 11.6928 36.6319 10.0176C36.7259 9.05028 36.7729 7.87058 36.7963 6.78526H25.5679V3.85962H40.3434C40.3669 6.10104 40.2964 7.89418 40.1085 9.7581C39.8971 11.504 39.4743 13.3444 39.1219 14.4297H43.0683V17.3553H34.8936V24.693H31.2526V17.3553H23.1718V14.4297Z",fill:"black"}),P.jsx("path",{d:"M6.13102 2.93945H10.1009L9.84253 5.36963H13.8594V8.22449H9.81904V8.76715C9.81904 9.3334 9.72508 9.87606 9.56065 10.3951C10.9936 11.4569 13.1077 12.4714 14.3292 12.8253L13.5071 15.7745C11.9802 15.4206 9.70159 14.123 8.19819 12.7781C7.91631 13.132 7.58744 13.4623 7.25857 13.7927C6.01357 14.9959 4.18131 16.0813 2.67791 16.5059L1.57385 13.5331C2.46649 13.2028 3.82895 12.5658 4.74508 11.8108C5.91961 10.8434 6.41291 9.94684 6.41291 8.76715V8.22449H2.16112V5.36963H6.36593L6.13102 2.93945ZM8.40961 17.1194V21.4843H19.92V24.4807H4.95649V17.1194H8.40961ZM16.232 3.5529H19.6381V18.2519H16.232V3.5529Z",fill:"black"})]})}),P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("button",{type:"button",onClick:f,className:"px-3 py-1 border-2 border-orange-accent text-orange-accent font-crimson text-sm font-bold rounded hover:bg-orange-50 transition-colors",children:" "}),P.jsx("button",{type:"button",onClick:h,className:"p-3",title:"",children:P.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:[P.jsx("path",{d:"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z",stroke:"#EA8C4B",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),P.jsx("path",{d:"M19.4 15C19.2669 15.3016 19.2272 15.6362 19.286 15.9606C19.3448 16.285 19.4995 16.5843 19.73 16.82L19.79 16.88C19.976 17.0657 20.1235 17.2863 20.2241 17.5291C20.3248 17.7719 20.3766 18.0322 20.3766 18.295C20.3766 18.5578 20.3248 18.8181 20.2241 19.0609C20.1235 19.3037 19.976 19.5243 19.79 19.71C19.6043 19.896 19.3837 20.0435 19.1409 20.1441C18.8981 20.2448 18.6378 20.2966 18.375 20.2966C18.1122 20.2966 17.8519 20.2448 17.6091 20.1441C17.3663 20.0435 17.1457 19.896 16.96 19.71L16.9 19.65C16.6643 19.4195 16.365 19.2648 16.0406 19.206C15.7162 19.1472 15.3816 19.1869 15.08 19.32C14.7842 19.4468 14.532 19.6572 14.3543 19.9255C14.1766 20.1938 14.0813 20.5082 14.08 20.83V21C14.08 21.5304 13.8693 22.0391 13.4942 22.4142C13.1191 22.7893 12.6104 23 12.08 23C11.5496 23 11.0409 22.7893 10.6658 22.4142C10.2907 22.0391 10.08 21.5304 10.08 21V20.91C10.0723 20.579 9.96512 20.258 9.77251 19.9887C9.5799 19.7194 9.31074 19.5143 9 19.4C8.69838 19.2669 8.36381 19.2272 8.03941 19.286C7.71502 19.3448 7.41568 19.4995 7.18 19.73L7.12 19.79C6.93425 19.976 6.71368 20.1235 6.47088 20.2241C6.22808 20.3248 5.96783 20.3766 5.705 20.3766C5.44217 20.3766 5.18192 20.3248 4.93912 20.2241C4.69632 20.1235 4.47575 19.976 4.29 19.79C4.10405 19.6043 3.95653 19.3837 3.85588 19.1409C3.75523 18.8981 3.70343 18.6378 3.70343 18.375C3.70343 18.1122 3.75523 17.8519 3.85588 17.6091C3.95653 17.3663 4.10405 17.1457 4.29 16.96L4.35 16.9C4.58054 16.6643 4.73519 16.365 4.794 16.0406C4.85282 15.7162 4.81312 15.3816 4.68 15.08C4.55324 14.7842 4.34276 14.532 4.07447 14.3543C3.80618 14.1766 3.49179 14.0813 3.17 14.08H3C2.46957 14.08 1.96086 13.8693 1.58579 13.4942C1.21071 13.1191 1 12.6104 1 12.08C1 11.5496 1.21071 11.0409 1.58579 10.6658C1.96086 10.2907 2.46957 10.08 3 10.08H3.09C3.42099 10.0723 3.742 9.96512 4.0113 9.77251C4.28059 9.5799 4.48572 9.31074 4.6 9C4.73312 8.69838 4.77282 8.36381 4.714 8.03941C4.65519 7.71502 4.50054 7.41568 4.27 7.18L4.21 7.12C4.02405 6.93425 3.87653 6.71368 3.77588 6.47088C3.67523 6.22808 3.62343 5.96783 3.62343 5.705C3.62343 5.44217 3.67523 5.18192 3.77588 4.93912C3.87653 4.69632 4.02405 4.47575 4.21 4.29C4.39575 4.10405 4.61632 3.95653 4.85912 3.85588C5.10192 3.75523 5.36217 3.70343 5.625 3.70343C5.88783 3.70343 6.14808 3.75523 6.39088 3.85588C6.63368 3.95653 6.85425 4.10405 7.04 4.29L7.1 4.35C7.33568 4.58054 7.63502 4.73519 7.95941 4.794C8.28381 4.85282 8.61838 4.81312 8.92 4.68H9C9.29577 4.55324 9.54802 4.34276 9.72569 4.07447C9.90337 3.80618 9.99872 3.49179 10 3.17V3C10 2.46957 10.2107 1.96086 10.5858 1.58579C10.9609 1.21071 11.4696 1 12 1C12.5304 1 13.0391 1.21071 13.4142 1.58579C13.7893 1.96086 14 2.46957 14 3V3.09C14.0013 3.41179 14.0966 3.72618 14.2743 3.99447C14.452 4.26276 14.7042 4.47324 15 4.6C15.3016 4.73312 15.6362 4.77282 15.9606 4.714C16.285 4.65519 16.5843 4.50054 16.82 4.27L16.88 4.21C17.0657 4.02405 17.2863 3.87653 17.5291 3.77588C17.7719 3.67523 18.0322 3.62343 18.295 3.62343C18.5578 3.62343 18.8181 3.67523 19.0609 3.77588C19.3037 3.87653 19.5243 4.02405 19.71 4.21C19.896 4.39575 20.0435 4.61632 20.1441 4.85912C20.2448 5.10192 20.2966 5.36217 20.2966 5.625C20.2966 5.88783 20.2448 6.14808 20.1441 6.39088C20.0435 6.63368 19.896 6.85425 19.71 7.04L19.65 7.1C19.4195 7.33568 19.2648 7.63502 19.206 7.95941C19.1472 8.28381 19.1869 8.61838 19.32 8.92V9C19.4468 9.29577 19.6572 9.54802 19.9255 9.72569C20.1938 9.90337 20.5082 9.99872 20.83 10H21C21.5304 10 22.0391 10.2107 22.4142 10.5858C22.7893 10.9609 23 11.4696 23 12C23 12.5304 22.7893 13.0391 22.4142 13.4142C22.0391 13.7893 21.5304 14 21 14H20.91C20.5882 14.0013 20.2738 14.0966 20.0055 14.2743C19.7372 14.452 19.5268 14.7042 19.4 15V15Z",stroke:"#EA8C4B",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),P.jsx("div",{className:"px-8 mb-6",children:P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("div",{className:"relative",children:P.jsx("button",{onClick:()=>F(!M),className:"flex items-center gap-1 px-3 py-1 bg-white border border-grey-100 rounded",children:P.jsx("span",{className:"text-orange-accent font-crimson text-lg font-semibold",children:K?" ...":B})})}),P.jsx("span",{className:"text-grey-900 font-crimson text-lg font-bold",children:""})]})}),P.jsx("div",{className:"px-8 mb-8",children:P.jsx("h2",{className:"text-grey-900 font-crimson text-xl font-bold",children:"   !"})}),P.jsx("div",{className:"px-8",children:P.jsx("div",{className:"grid grid-cols-2 gap-6 mb-8",children:de.map(ye=>P.jsx("button",{onClick:()=>Se(ye.id),disabled:X,className:`relative h-32 border border-grey-100 rounded-2xl flex items-center justify-center px-4 xs:px-2 overflow-hidden transition-colors hover:shadow-md ${ye.id==="0"?"bg-orange-50":"bg-white"} ${N===ye.id?"border-orange-accent bg-orange-accent/5":""} ${X?"opacity-50 cursor-not-allowed":""}`,children:P.jsxs("div",{className:"flex items-center justify-center gap-3 xs:justify-between xs:w-full",children:[P.jsx("span",{className:"text-grey-900 font-crimson text-2xl xs:text-1.5xl font-bold whitespace-nowrap text-center pl-4",children:ye.name}),P.jsx("div",{className:"w-20 xs:w-16 flex items-center justify-center flex-shrink-0 pr-4",children:ye.icon})]})},ye.id))})}),I&&P.jsx("div",{className:"px-8 mb-4",children:P.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:P.jsx("p",{className:"text-red-600 font-crimson text-sm",children:I})})}),P.jsx("div",{className:"px-8 pb-12",children:P.jsx("div",{className:"h-24 relative",children:P.jsx("button",{onClick:be,disabled:!N||X,className:`w-full h-16 rounded-lg font-crimson text-2xl font-semibold text-white transition-all ${N&&!X?"bg-gradient-to-r from-yellow-300 to-red-gradient shadow-lg":"bg-gray-400 opacity-50 cursor-not-allowed"}`,children:X?" ...":" "})})})]})}const $te="modulepreload",ene=function(u){return"/"+u},rj={},s0=function(h,f,g){let S=Promise.resolve();if(f&&f.length>0){let M=function(F){return Promise.all(F.map(B=>Promise.resolve(B).then(q=>({status:"fulfilled",value:q}),q=>({status:"rejected",reason:q}))))};var I=M;document.getElementsByTagName("link");const N=document.querySelector("meta[property=csp-nonce]"),k=N?.nonce||N?.getAttribute("nonce");S=M(f.map(F=>{if(F=ene(F),F in rj)return;rj[F]=!0;const B=F.endsWith(".css"),q=B?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${F}"]${q}`))return;const K=document.createElement("link");if(K.rel=B?"stylesheet":$te,B||(K.as="script"),K.crossOrigin="",K.href=F,k&&K.setAttribute("nonce",k),document.head.appendChild(K),B)return new Promise((ie,X)=>{K.addEventListener("load",ie),K.addEventListener("error",()=>X(new Error(`Unable to preload CSS for ${F}`)))})}))}function C(N){const k=new Event("vite:preloadError",{cancelable:!0});if(k.payload=N,window.dispatchEvent(k),!k.defaultPrevented)throw N}return S.then(N=>{for(const k of N||[])k.status==="rejected"&&C(k.reason);return h().catch(C)})},ij={callId:null,matchingId:null,partner:null,agoraChannelInfo:null,isInCall:!1,isConnecting:!1,callStartTime:null,agoraState:{isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},error:null},sj=tF((u,h)=>({...ij,startCall:f=>{const g={id:String(f.partnerId),nickname:f.partnerNickname};u({callId:String(f.callId),matchingId:f.matchingId||null,partner:g,agoraChannelInfo:null,isInCall:!0,callStartTime:new Date,error:null})},endCall:()=>{const f=h();u({callId:f.callId,matchingId:null,partner:f.partner,agoraChannelInfo:null,isInCall:!1,isConnecting:!1,callStartTime:null,agoraState:{isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},error:null})},updateConnectingState:f=>{u({isConnecting:f})},updateAgoraState:f=>{u({agoraState:f})},setError:f=>{u({error:f})},reset:()=>{u(ij)},clearPartner:()=>{u({partner:null,callId:null})}}));var l0={exports:{}},tne=l0.exports,oj;function nne(){return oj||(oj=1,function(u,h){(function(f,g){u.exports=g()})(tne,function(){function f(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function S(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C=function(e){try{return!!e()}catch{return!0}},I=!C(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),N=I,k=Function.prototype,M=k.call,F=N&&k.bind.bind(M,M),B=N?F:function(e){return function(){return M.apply(e,arguments)}},q=B({}.isPrototypeOf),K=function(e){return e&&e.Math===Math&&e},ie=K(typeof globalThis=="object"&&globalThis)||K(typeof window=="object"&&window)||K(typeof self=="object"&&self)||K(typeof g=="object"&&g)||K(typeof g=="object"&&g)||function(){return this}()||Function("return this")(),X=I,te=Function.prototype,ce=te.apply,$=te.call,le=typeof Reflect=="object"&&Reflect.apply||(X?$.bind(ce):function(){return $.apply(ce,arguments)}),ne=B,de=ne({}.toString),be=ne("".slice),Se=function(e){return be(de(e),8,-1)},fe=Se,ye=B,je=function(e){if(fe(e)==="Function")return ye(e)},Je=typeof document=="object"&&document.all,Ue=Je===void 0&&Je!==void 0?function(e){return typeof e=="function"||e===Je}:function(e){return typeof e=="function"},xe={},Ge=!C(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),dt=I,Xe=Function.prototype.call,We=dt?Xe.bind(Xe):function(){return Xe.apply(Xe,arguments)},Ae={},De={}.propertyIsEnumerable,ze=Object.getOwnPropertyDescriptor,me=ze&&!De.call({1:2},1);Ae.f=me?function(e){var t=ze(this,e);return!!t&&t.enumerable}:De;var ke,at,ot=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ot=C,Gt=Se,yt=Object,pn=B("".split),vn=Ot(function(){return!yt("z").propertyIsEnumerable(0)})?function(e){return Gt(e)==="String"?pn(e,""):yt(e)}:yt,or=function(e){return e==null},hs=or,Ma=TypeError,Kr=function(e){if(hs(e))throw new Ma("Can't call method on "+e);return e},Zd=vn,Fh=Kr,ps=function(e){return Zd(Fh(e))},$d=Ue,pr=function(e){return typeof e=="object"?e!==null:$d(e)},Jr={},po=Jr,ki=ie,bl=Ue,Ms=function(e){return bl(e)?e:void 0},Ar=function(e,t){return arguments.length<2?Ms(po[e])||Ms(ki[e]):po[e]&&po[e][t]||ki[e]&&ki[e][t]},eu=ie.navigator,ci=eu&&eu.userAgent,zr=ci?String(ci):"",Mc=ie,Il=zr,Us=Mc.process,Ua=Mc.Deno,tu=Us&&Us.versions||Ua&&Ua.version,Uc=tu&&tu.v8;Uc&&(at=(ke=Uc.split("."))[0]>0&&ke[0]<4?1:+(ke[0]+ke[1])),!at&&Il&&(!(ke=Il.match(/Edge\/(\d+)/))||ke[1]>=74)&&(ke=Il.match(/Chrome\/(\d+)/))&&(at=+ke[1]);var Ti=at,nu=Ti,fo=C,ru=ie.String,mo=!!Object.getOwnPropertySymbols&&!fo(function(){var e=Symbol("symbol detection");return!ru(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&nu&&nu<41}),Vc=mo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Al=Ar,Va=Ue,_o=q,Vs=Object,ja=Vc?function(e){return typeof e=="symbol"}:function(e){var t=Al("Symbol");return Va(t)&&_o(t.prototype,Vs(e))},Kt=String,fn=function(e){try{return Kt(e)}catch{return"Object"}},Fn=Ue,Ci=fn,Li=TypeError,Bn=function(e){if(Fn(e))return e;throw new Li(Ci(e)+" is not a function")},js=Bn,Qr=or,Xi=function(e,t){var n=e[t];return Qr(n)?void 0:js(n)},Ol=We,iu=Ue,su=pr,mm=TypeError,BE={exports:{}},WE=ie,M0=Object.defineProperty,jc=ie,GE=function(e,t){try{M0(WE,e,{value:t,configurable:!0,writable:!0})}catch{WE[e]=t}return t},_m="__core-js_shared__",HE=BE.exports=jc[_m]||GE(_m,{});(HE.versions||(HE.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Bh=BE.exports,gm=Bh,Fc=function(e,t){return gm[e]||(gm[e]=t||{})},KE=Kr,U0=Object,go=function(e){return U0(KE(e))},vr=go,V0=B({}.hasOwnProperty),fr=Object.hasOwn||function(e,t){return V0(vr(e),t)},zE=B,Wh=0,j0=Math.random(),YE=zE(1 .toString),Nl=function(e){return"Symbol("+(e===void 0?"":e)+")_"+YE(++Wh+j0,36)},Eo=Fc,qE=fr,Fs=Nl,F0=mo,B0=Vc,Pl=ie.Symbol,Dl=Eo("wks"),Gh=B0?Pl.for||Pl:Pl&&Pl.withoutSetter||Fs,An=function(e){return qE(Dl,e)||(Dl[e]=F0&&qE(Pl,e)?Pl[e]:Gh("Symbol."+e)),Dl[e]},Hh=We,XE=pr,JE=ja,Em=Xi,QE=function(e,t){var n,r;if(iu(n=e.toString)&&!su(r=Ol(n,e))||iu(n=e.valueOf)&&!su(r=Ol(n,e)))return r;throw new mm("Can't convert object to primitive value")},vm=TypeError,ou=An("toPrimitive"),W0=function(e,t){if(!XE(e)||JE(e))return e;var n,r=Em(e,ou);if(r){if(n=Hh(r,e,t),!XE(n)||JE(n))return n;throw new vm("Can't convert object to primitive value")}return QE(e)},Sm=ja,On=function(e){var t=W0(e,"string");return Sm(t)?t:t+""},ym=pr,Kh=ie.document,Tm=ym(Kh)&&ym(Kh.createElement),zh=function(e){return Tm?Kh.createElement(e):{}},ZE=zh,Cm=!Ge&&!C(function(){return Object.defineProperty(ZE("div"),"a",{get:function(){return 7}}).a!==7}),Rm=Ge,Yh=We,Fa=Ae,Ba=ot,Wa=ps,au=On,cu=fr,Ga=Cm,$E=Object.getOwnPropertyDescriptor;xe.f=Rm?$E:function(e,t){if(e=Wa(e),t=au(t),Ga)try{return $E(e,t)}catch{}if(cu(e,t))return Ba(!Yh(Fa.f,e,t),e[t])};var ev=C,lu=Ue,G0=/#|\.prototype\./,kl=function(e,t){var n=tv[qh(e)];return n===du||n!==H0&&(lu(t)?ev(t):!!t)},qh=kl.normalize=function(e){return String(e).replace(G0,".").toLowerCase()},tv=kl.data={},H0=kl.NATIVE="N",du=kl.POLYFILL="P",Ll=kl,xl=Bn,Xh=I,K0=je(je.bind),Ha=function(e,t){return xl(e),t===void 0?e:Xh?K0(e,t):function(){return e.apply(t,arguments)}},xi={},uu=Ge&&C(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),wm=pr,nv=String,Ka=TypeError,Zr=function(e){if(wm(e))return e;throw new Ka(nv(e)+" is not an object")},Jh=Ge,rv=Cm,Qh=uu,Bc=Zr,bm=On,Ji=TypeError,za=Object.defineProperty,Im=Object.getOwnPropertyDescriptor,Wc="enumerable",Am="configurable",hu="writable";xi.f=Jh?Qh?function(e,t,n){if(Bc(e),t=bm(t),Bc(n),typeof e=="function"&&t==="prototype"&&"value"in n&&hu in n&&!n[hu]){var r=Im(e,t);r&&r[hu]&&(e[t]=n.value,n={configurable:Am in n?n[Am]:r[Am],enumerable:Wc in n?n[Wc]:r[Wc],writable:!1})}return za(e,t,n)}:za:function(e,t,n){if(Bc(e),t=bm(t),Bc(n),rv)try{return za(e,t,n)}catch{}if("get"in n||"set"in n)throw new Ji("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Om=xi,pu=ot,vo=Ge?function(e,t,n){return Om.f(e,t,pu(1,n))}:function(e,t,n){return e[t]=n,e},Ml=ie,z0=le,Y0=je,q0=Ue,Nm=xe.f,X0=Ll,Ul=Jr,J0=Ha,Vl=vo,iv=fr,sv=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return z0(e,this,arguments)};return t.prototype=e.prototype,t},qt=function(e,t){var n,r,i,s,o,c,l,p,m,E=e.target,v=e.global,y=e.stat,D=e.proto,A=v?Ml:y?Ml[E]:Ml[E]&&Ml[E].prototype,O=v?Ul:Ul[E]||Vl(Ul,E,{})[E],V=O.prototype;for(s in t)r=!(n=X0(v?s:E+(y?".":"#")+s,e.forced))&&A&&iv(A,s),c=O[s],r&&(l=e.dontCallGetSet?(m=Nm(A,s))&&m.value:A[s]),o=r&&l?l:t[s],(n||D||typeof c!=typeof o)&&(p=e.bind&&r?J0(o,Ml):e.wrap&&r?sv(o):D&&q0(o)?Y0(o):o,(e.sham||o&&o.sham||c&&c.sham)&&Vl(p,"sham",!0),Vl(O,s,p),D&&(iv(Ul,i=E+"Prototype")||Vl(Ul,i,{}),Vl(Ul[i],s,o),e.real&&V&&(n||!V[s])&&Vl(V,s,o)))},Q0=Math.ceil,Z0=Math.floor,$0=Math.trunc||function(e){var t=+e;return(t>0?Z0:Q0)(t)},Pm=$0,Dm=function(e){var t=+e;return t!=t||t===0?0:Pm(t)},eC=Dm,tC=Math.max,ov=Math.min,km=function(e,t){var n=eC(e);return n<0?tC(n+t,0):ov(n,t)},nC=Dm,rC=Math.min,av=function(e){var t=nC(e);return t>0?rC(t,9007199254740991):0},iC=av,Ya=function(e){return iC(e.length)},sC=ps,Lm=km,fu=Ya,cv=function(e){return function(t,n,r){var i=sC(t),s=fu(i);if(s===0)return!e&&-1;var o,c=Lm(r,s);if(e&&n!=n){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},Zh={includes:cv(!0),indexOf:cv(!1)},lv=Zh.includes;qt({target:"Array",proto:!0,forced:C(function(){return!Array(1).includes()})},{includes:function(e){return lv(this,e,arguments.length>1?arguments[1]:void 0)}});var dv=ie,uv=Jr,Qi=function(e,t){var n=uv[e+"Prototype"],r=n&&n[t];if(r)return r;var i=dv[e],s=i&&i.prototype;return s&&s[t]},jl=Qi("Array","includes"),oC=pr,aC=Se,cC=An("match"),xm=function(e){var t;return oC(e)&&((t=e[cC])!==void 0?!!t:aC(e)==="RegExp")},hv=xm,mu=TypeError,Fl={};Fl[An("toStringTag")]="z";var Mm=String(Fl)==="[object z]",$h=Mm,lC=Ue,_u=Se,Um=An("toStringTag"),Vm=Object,pv=_u(function(){return arguments}())==="Arguments",Xo=$h?_u:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(i,s){try{return i[s]}catch{}}(t=Vm(e),Um))=="string"?n:pv?_u(t):(r=_u(t))==="Object"&&lC(t.callee)?"Arguments":r},fv=Xo,dC=String,Mi=function(e){if(fv(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return dC(e)},uC=An("match"),hC=qt,pC=function(e){if(hv(e))throw new mu("The method doesn't accept regular expressions");return e},Bs=Kr,Bl=Mi,mv=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[uC]=!1,"/./"[e](t)}catch{}}return!1},_v=B("".indexOf);hC({target:"String",proto:!0,forced:!mv("includes")},{includes:function(e){return!!~_v(Bl(Bs(this)),Bl(pC(e)),arguments.length>1?arguments[1]:void 0)}});var gv=Qi("String","includes"),jm=q,Fm=jl,fC=gv,Bm=Array.prototype,qa=String.prototype,Wm=function(e){var t=e.includes;return e===Bm||jm(Bm,e)&&t===Bm.includes?Fm:typeof e=="string"||e===qa||jm(qa,e)&&t===qa.includes?fC:t},Oe=S(Wm),Gm=Bn,Ev=go,ep=vn,Wl=Ya,tp=TypeError,Hm="Reduce of empty array with no initial value",np=function(e){return function(t,n,r,i){var s=Ev(t),o=ep(s),c=Wl(s);if(Gm(n),c===0&&r<2)throw new tp(Hm);var l=e?c-1:0,p=e?-1:1;if(r<2)for(;;){if(l in o){i=o[l],l+=p;break}if(l+=p,e?l<0:c<=l)throw new tp(Hm)}for(;e?l>=0:c>l;l+=p)l in o&&(i=n(i,o[l],l,s));return i}},vv={left:np(!1)},Sv=C,gu=function(e,t){var n=[][e];return!!n&&Sv(function(){n.call(null,t||function(){return 1},1)})},Gl=ie,yv=zr,Tv=Se,Ws=function(e){return yv.slice(0,e.length)===e},Eu=Ws("Bun/")?"BUN":Ws("Cloudflare-Workers")?"CLOUDFLARE":Ws("Deno/")?"DENO":Ws("Node.js/")?"NODE":Gl.Bun&&typeof Bun.version=="string"?"BUN":Gl.Deno&&typeof Deno.version=="object"?"DENO":Tv(Gl.process)==="process"?"NODE":Gl.window&&Gl.document?"BROWSER":"REST",Hl=Eu==="NODE",mC=vv.left;qt({target:"Array",proto:!0,forced:!Hl&&Ti>79&&Ti<83||!gu("reduce")},{reduce:function(e){var t=arguments.length;return mC(this,e,t,t>1?arguments[1]:void 0)}});var _C=Qi("Array","reduce"),vu=q,gC=_C,rp=Array.prototype,Cv=function(e){var t=e.reduce;return e===rp||vu(rp,e)&&t===rp.reduce?gC:t},zn=Cv,Ui=S(zn),ip=Se,Jo=Array.isArray||function(e){return ip(e)==="Array"},Rv=qt,Km=Jo,Su=B([].reverse),yu=[1,2];Rv({target:"Array",proto:!0,forced:String(yu)===String(yu.reverse())},{reverse:function(){return Km(this)&&(this.length=this.length),Su(this)}});var Kl=Qi("Array","reverse"),wv=q,EC=Kl,zm=Array.prototype,bv=function(e){var t=e.reverse;return e===zm||wv(zm,e)&&t===zm.reverse?EC:t},Tu=bv,Cu=S(Tu),Ym=Nl,sp=Fc("keys"),zl=function(e){return sp[e]||(sp[e]=Ym(e))},qm=!C(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),vC=fr,Iv=Ue,SC=go,yC=qm,op=zl("IE_PROTO"),So=Object,Av=So.prototype,Xa=yC?So.getPrototypeOf:function(e){var t=SC(e);if(vC(t,op))return t[op];var n=t.constructor;return Iv(n)&&t instanceof n?n.prototype:t instanceof So?Av:null},yo=B,Ru=Bn,Qo=pr,Xm=function(e){return Qo(e)||e===null},TC=String,CC=TypeError,Gc=function(e,t,n){try{return yo(Ru(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},wu=pr,Yl=Kr,ap=function(e){if(Xm(e))return e;throw new CC("Can't set "+TC(e)+" as a prototype")},Jm=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Gc(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return Yl(r),ap(i),wu(r)&&(t?e(r,i):r.__proto__=i),r}}():void 0),Zo={},Gs={},Wn=fr,Yn=ps,Ja=Zh.indexOf,li=Gs,Ri=B([].push),Qa=function(e,t){var n,r=Yn(e),i=0,s=[];for(n in r)!Wn(li,n)&&Wn(r,n)&&Ri(s,n);for(;t.length>i;)Wn(r,n=t[i++])&&(~Ja(s,n)||Ri(s,n));return s},Za=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Vi=Qa,cp=Za.concat("length","prototype");Zo.f=Object.getOwnPropertyNames||function(e){return Vi(e,cp)};var ql={};ql.f=Object.getOwnPropertySymbols;var Ov=Ar,lp=Zo,Nv=ql,$o=Zr,dp=B([].concat),Qm=Ov("Reflect","ownKeys")||function(e){var t=lp.f($o(e)),n=Nv.f;return n?dp(t,n(e)):t},Zm=fr,RC=Qm,$a=xe,Xl=xi,ec={},up=Qa,hp=Za,wi=Object.keys||function(e){return up(e,hp)},fs=Ge,Hc=uu,ea=xi,ta=Zr,Kc=ps,Pv=wi;ec.f=fs&&!Hc?Object.defineProperties:function(e,t){ta(e);for(var n,r=Kc(t),i=Pv(t),s=i.length,o=0;s>o;)ea.f(e,n=i[o++],r[n]);return e};var Jl,pp=Ar("document","documentElement"),Zi=Zr,$i=ec,Zn=Za,Hs=Gs,Dv=pp,kv=zh,bu="prototype",Iu="script",$m=zl("IE_PROTO"),Ql=function(){},e_=function(e){return"<"+Iu+">"+e+"</"+Iu+">"},zc=function(e){e.write(e_("")),e.close();var t=e.parentWindow.Object;return e=null,t},Zl=function(){try{Jl=new ActiveXObject("htmlfile")}catch{}var e,t,n;Zl=typeof document<"u"?document.domain&&Jl?zc(Jl):(t=kv("iframe"),n="java"+Iu+":",t.style.display="none",Dv.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(e_("document.F=Object")),e.close(),e.F):zc(Jl);for(var r=Zn.length;r--;)delete Zl[bu][Zn[r]];return Zl()};Hs[$m]=!0;var Au=Object.create||function(e,t){var n;return e!==null?(Ql[bu]=Zi(e),n=new Ql,Ql[bu]=null,n[$m]=e):n=Zl(),t===void 0?n:$i.f(n,t)},Ou=pr,fp=vo,t_=Error,Lv=B("".replace),$l=String(new t_("zxcasd").stack),n_=/\n\s*at [^:]*:[^\n]*/,mp=n_.test($l),_p=ot,ed=!C(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",_p(1,7)),e.stack!==7)}),r_=vo,i_=function(e,t){if(mp&&typeof e=="string"&&!t_.prepareStackTrace)for(;t--;)e=Lv(e,n_,"");return e},s_=ed,gp=Error.captureStackTrace,Ks={},ms=Ks,Yc=An("iterator"),o_=Array.prototype,a_=function(e){return e!==void 0&&(ms.Array===e||o_[Yc]===e)},na=Xo,ra=Xi,c_=or,xv=Ks,ia=An("iterator"),zs=function(e){if(!c_(e))return ra(e,ia)||ra(e,"@@iterator")||xv[na(e)]},Ep=We,Mv=Bn,vp=Zr,Uv=fn,Nu=zs,To=TypeError,qc=function(e,t){var n=arguments.length<2?Nu(e):t;if(Mv(n))return vp(Ep(n,e));throw new To(Uv(e)+" is not iterable")},Pu=We,tc=Zr,l_=Xi,Xc=function(e,t,n){var r,i;tc(e);try{if(!(r=l_(e,"return"))){if(t==="throw")throw n;return n}r=Pu(r,e)}catch(s){i=!0,r=s}if(t==="throw")throw n;if(i)throw r;return tc(r),n},Vv=Ha,d_=We,ar=Zr,Sp=fn,u_=a_,h_=Ya,Du=q,p_=qc,Jc=zs,rr=Xc,xr=TypeError,Sr=function(e,t){this.stopped=e,this.result=t},ku=Sr.prototype,sa=function(e,t,n){var r,i,s,o,c,l,p,m=n&&n.that,E=!(!n||!n.AS_ENTRIES),v=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),D=!(!n||!n.INTERRUPTED),A=Vv(t,m),O=function(U){return r&&rr(r,"normal",U),new Sr(!0,U)},V=function(U){return E?(ar(U),D?A(U[0],U[1],O):A(U[0],U[1])):D?A(U,O):A(U)};if(v)r=e.iterator;else if(y)r=e;else{if(!(i=Jc(e)))throw new xr(Sp(e)+" is not iterable");if(u_(i)){for(s=0,o=h_(e);o>s;s++)if((c=V(e[s]))&&Du(ku,c))return c;return new Sr(!1)}r=p_(e,i)}for(l=v?e.next:r.next;!(p=d_(l,r)).done;){try{c=V(p.value)}catch(U){rr(r,"throw",U)}if(typeof c=="object"&&c&&Du(ku,c))return c}return new Sr(!1)},Lu=Mi,wC=qt,di=q,f_=Xa,td=Jm,m_=function(e,t,n){for(var r=RC(t),i=Xl.f,s=$a.f,o=0;o<r.length;o++){var c=r[o];Zm(e,c)||n&&Zm(n,c)||i(e,c,s(t,c))}},Ys=Au,ji=vo,Qc=ot,__=function(e,t){Ou(t)&&"cause"in t&&fp(e,"cause",t.cause)},g_=function(e,t,n,r){s_&&(gp?gp(e,t):r_(e,"stack",i_(n,r)))},jv=sa,Fv=function(e,t){return e===void 0?arguments.length<2?"":t:Lu(e)},Bv=An("toStringTag"),xu=Error,Wv=[].push,Zc=function(e,t){var n,r=di(yp,this);td?n=td(new xu,r?f_(this):yp):(n=r?this:Ys(yp),ji(n,Bv,"Error")),t!==void 0&&ji(n,"message",Fv(t)),g_(n,Zc,n.stack,1),arguments.length>2&&__(n,arguments[2]);var i=[];return jv(e,Wv,{that:i}),ji(n,"errors",i),n};td?td(Zc,xu):m_(Zc,xu,{name:!0});var yp=Zc.prototype=Ys(xu.prototype,{constructor:Qc(1,Zc),message:Qc(1,""),name:Qc(1,"AggregateError")});wC({global:!0},{AggregateError:Zc});var Mu,oa,Uu,Tp=Ue,Vu=ie.WeakMap,Gv=Tp(Vu)&&/native code/.test(String(Vu)),Cp=ie,Hv=pr,Kv=vo,Rp=fr,wp=Bh,E_=zl,zv=Gs,v_="Object already initialized",bp=Cp.TypeError,bC=Cp.WeakMap;if(Gv||wp.state){var qs=wp.state||(wp.state=new bC);qs.get=qs.get,qs.has=qs.has,qs.set=qs.set,Mu=function(e,t){if(qs.has(e))throw new bp(v_);return t.facade=e,qs.set(e,t),t},oa=function(e){return qs.get(e)||{}},Uu=function(e){return qs.has(e)}}else{var nd=E_("state");zv[nd]=!0,Mu=function(e,t){if(Rp(e,nd))throw new bp(v_);return t.facade=e,Kv(e,nd,t),t},oa=function(e){return Rp(e,nd)?e[nd]:{}},Uu=function(e){return Rp(e,nd)}}var $c,S_,y_,nc={set:Mu,get:oa,has:Uu,enforce:function(e){return Uu(e)?oa(e):Mu(e,{})},getterFor:function(e){return function(t){var n;if(!Hv(t)||(n=oa(t)).type!==e)throw new bp("Incompatible receiver, "+e+" required");return n}}},rd=Ge,IC=fr,Yv=Function.prototype,AC=rd&&Object.getOwnPropertyDescriptor,_s=IC(Yv,"name"),Ip={PROPER:_s&&(function(){}).name==="something",CONFIGURABLE:_s&&(!rd||rd&&AC(Yv,"name").configurable)},Ap=vo,aa=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Ap(e,t,n),e},qv=C,Xv=Ue,T_=pr,id=Au,Op=Xa,C_=aa,R_=An("iterator"),w_=!1;[].keys&&("next"in(y_=[].keys())?(S_=Op(Op(y_)))!==Object.prototype&&($c=S_):w_=!0);var Jv=!T_($c)||qv(function(){var e={};return $c[R_].call(e)!==e});Xv(($c=Jv?{}:id($c))[R_])||C_($c,R_,function(){return this});var b_={IteratorPrototype:$c,BUGGY_SAFARI_ITERATORS:w_},Qv=Xo,Zv=Mm?{}.toString:function(){return"[object "+Qv(this)+"]"},OC=Mm,Fi=xi.f,bi=vo,$v=fr,eS=Zv,I_=An("toStringTag"),Co=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&($v(i,I_)||Fi(i,I_,{configurable:!0,value:t}),r&&!OC&&bi(i,"toString",eS))},tS=b_.IteratorPrototype,A_=Au,nS=ot,O_=Co,rS=Ks,iS=function(){return this},ju=function(e,t,n,r){var i=t+" Iterator";return e.prototype=A_(tS,{next:nS(+!r,n)}),O_(e,i,!1,!0),rS[i]=iS,e},N_=qt,sS=We,P_=Ip,Np=ju,NC=Xa,oS=Co,Pp=aa,D_=Ks,Dp=b_,ca=P_.PROPER,kp=Dp.BUGGY_SAFARI_ITERATORS,Lp=An("iterator"),xp="keys",Fu="values",k_="entries",Bu=function(){return this},$r=function(e,t,n,r,i,s,o){Np(n,t,r);var c,l,p,m=function(V){if(V===i&&A)return A;if(!kp&&V&&V in y)return y[V];switch(V){case xp:case Fu:case k_:return function(){return new n(this,V)}}return function(){return new n(this)}},E=t+" Iterator",v=!1,y=e.prototype,D=y[Lp]||y["@@iterator"]||i&&y[i],A=!kp&&D||m(i),O=t==="Array"&&y.entries||D;if(O&&(c=NC(O.call(new e)))!==Object.prototype&&c.next&&(oS(c,E,!0,!0),D_[E]=Bu),ca&&i===Fu&&D&&D.name!==Fu&&(v=!0,A=function(){return sS(D,this)}),i)if(l={values:m(Fu),keys:s?A:m(xp),entries:m(k_)},o)for(p in l)(kp||v||!(p in y))&&Pp(y,p,l[p]);else N_({target:t,proto:!0,forced:kp||v},l);return o&&y[Lp]!==A&&Pp(y,Lp,A,{}),D_[t]=A,l},Mp=function(e,t){return{value:e,done:t}},PC=ps,Wu=Ks,ei=nc;xi.f;var DC=$r,Et=Mp,el="Array Iterator",L_=ei.set,aS=ei.getterFor(el);DC(Array,"Array",function(e,t){L_(this,{type:el,target:PC(e),index:0,kind:t})},function(){var e=aS(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Et(void 0,!0);switch(e.kind){case"keys":return Et(n,!1);case"values":return Et(t[n],!1)}return Et([n,t[n]],!1)},"values"),Wu.Arguments=Wu.Array;var kC=xi,rc=function(e,t,n){return kC.f(e,t,n)},Up=Ar,x_=rc,cS=Ge,M_=An("species"),lS=q,U_=TypeError,Gu=function(e,t){if(lS(t,e))return e;throw new U_("Incorrect invocation")},ti=Ue,es=Bh,ic=B(Function.toString);ti(es.inspectSource)||(es.inspectSource=function(e){return ic(e)});var V_=es.inspectSource,dS=B,Xs=C,j_=Ue,Ro=Xo,LC=V_,F_=function(){},B_=Ar("Reflect","construct"),Vp=/^\s*(?:class|function)\b/,uS=dS(Vp.exec),xC=!Vp.test(F_),sc=function(e){if(!j_(e))return!1;try{return B_(F_,[],e),!0}catch{return!1}},jp=function(e){if(!j_(e))return!1;switch(Ro(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return xC||!!uS(Vp,LC(e))}catch{return!0}};jp.sham=!0;var ui,ln,Mr,mr,Or=!B_||Xs(function(){var e;return sc(sc.call)||!sc(Object)||!sc(function(){e=!0})||e})?jp:sc,ts=Or,sd=fn,Ur=TypeError,od=Zr,tl=function(e){if(ts(e))return e;throw new Ur(sd(e)+" is not a constructor")},Fp=or,W_=An("species"),nl=function(e,t){var n,r=od(e).constructor;return r===void 0||Fp(n=od(r)[W_])?t:tl(n)},yr=B([].slice),G_=TypeError,gs=function(e,t){if(e<t)throw new G_("Not enough arguments");return e},wo=/(?:ipad|iphone|ipod).*applewebkit/i.test(zr),hi=ie,H_=le,oc=Ha,Hu=Ue,ac=fr,Ku=C,ad=pp,K_=yr,zu=zh,Bp=gs,Ii=wo,cc=Hl,ns=hi.setImmediate,pi=hi.clearImmediate,hS=hi.process,Yu=hi.Dispatch,z_=hi.Function,pS=hi.MessageChannel,lc=hi.String,Wp=0,rl={},dc="onreadystatechange";Ku(function(){ui=hi.location});var qu=function(e){if(ac(rl,e)){var t=rl[e];delete rl[e],t()}},la=function(e){return function(){qu(e)}},Y_=function(e){qu(e.data)},q_=function(e){hi.postMessage(lc(e),ui.protocol+"//"+ui.host)};ns&&pi||(ns=function(e){Bp(arguments.length,1);var t=Hu(e)?e:z_(e),n=K_(arguments,1);return rl[++Wp]=function(){H_(t,void 0,n)},ln(Wp),Wp},pi=function(e){delete rl[e]},cc?ln=function(e){hS.nextTick(la(e))}:Yu&&Yu.now?ln=function(e){Yu.now(la(e))}:pS&&!Ii?(mr=(Mr=new pS).port2,Mr.port1.onmessage=Y_,ln=oc(mr.postMessage,mr)):hi.addEventListener&&Hu(hi.postMessage)&&!hi.importScripts&&ui&&ui.protocol!=="file:"&&!Ku(q_)?(ln=q_,hi.addEventListener("message",Y_,!1)):ln=dc in zu("script")?function(e){ad.appendChild(zu("script"))[dc]=function(){ad.removeChild(this),qu(e)}}:function(e){setTimeout(la(e),0)});var cd={set:ns,clear:pi},Xu=ie,MC=Ge,UC=Object.getOwnPropertyDescriptor,X_=function(e){if(!MC)return Xu[e];var t=UC(Xu,e);return t&&t.value},J_=function(){this.head=null,this.tail=null};J_.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Es,Q_,uc,Gp,cr,fS=J_,mS=/ipad|iphone|ipod/i.test(zr)&&typeof Pebble<"u",VC=/web0s(?!.*chrome)/i.test(zr),ld=ie,_S=X_,Z_=Ha,$_=cd.set,vs=fS,eg=wo,jC=mS,hc=VC,dd=Hl,pc=ld.MutationObserver||ld.WebKitMutationObserver,Ju=ld.document,Hp=ld.process,ud=ld.Promise,tg=_S("queueMicrotask");if(!tg){var hd=new vs,Kp=function(){var e,t;for(dd&&(e=Hp.domain)&&e.exit();t=hd.get();)try{t()}catch(n){throw hd.head&&Es(),n}e&&e.enter()};eg||dd||hc||!pc||!Ju?!jC&&ud&&ud.resolve?((Gp=ud.resolve(void 0)).constructor=ud,cr=Z_(Gp.then,Gp),Es=function(){cr(Kp)}):dd?Es=function(){Hp.nextTick(Kp)}:($_=Z_($_,ld),Es=function(){$_(Kp)}):(Q_=!0,uc=Ju.createTextNode(""),new pc(Kp).observe(uc,{characterData:!0}),Es=function(){uc.data=Q_=!Q_}),tg=function(e){hd.head||Es(),hd.add(e)}}var ng=tg,il=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},bo=ie.Promise,zp=ie,pd=bo,rg=Ue,FC=Ll,gS=V_,ig=An,Qu=Eu,Zu=Ti,$u=pd&&pd.prototype,ES=ig("species"),vS=rg(zp.PromiseRejectionEvent),Yp=FC("Promise",function(){var e=gS(pd),t=e!==String(pd);if(!t&&Zu===66||!$u.catch||!$u.finally)return!0;if(!Zu||Zu<51||!/native code/.test(e)){var n=new pd(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[ES]=r,!(n.then(function(){})instanceof r))return!0}return!(t||Qu!=="BROWSER"&&Qu!=="DENO"||vS)}),eh={CONSTRUCTOR:Yp,REJECTION_EVENT:vS},Bi={},SS=Bn,qp=TypeError,a=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw new qp("Bad Promise constructor");t=r,n=i}),this.resolve=SS(t),this.reject=SS(n)};Bi.f=function(e){return new a(e)};var d,_,T=qt,b=Hl,L=ie,Y=We,oe=aa,pe=Co,Le=function(e){var t=Up(e);cS&&t&&!t[M_]&&x_(t,M_,{configurable:!0,get:function(){return this}})},Ze=Bn,$e=Ue,Qe=pr,_t=Gu,Tt=nl,Rt=cd.set,lr=ng,Ce=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},_e=il,Ne=fS,tt=nc,wt=bo,Dt=eh,kt=Bi,Vt="Promise",Vr=Dt.CONSTRUCTOR,wn=Dt.REJECTION_EVENT,Io=tt.getterFor(Vt),BC=tt.set,RF=wt&&wt.prototype,sg=wt,WC=RF,Q1=L.TypeError,GC=L.document,HC=L.process,KC=kt.f,wF=KC,bF=!!(GC&&GC.createEvent&&L.dispatchEvent),Z1="unhandledrejection",$1=function(e){var t;return!(!Qe(e)||!$e(t=e.then))&&t},eO=function(e,t){var n,r,i,s=t.value,o=t.state===1,c=o?e.ok:e.fail,l=e.resolve,p=e.reject,m=e.domain;try{c?(o||(t.rejection===2&&AF(t),t.rejection=1),c===!0?n=s:(m&&m.enter(),n=c(s),m&&(m.exit(),i=!0)),n===e.promise?p(new Q1("Promise-chain cycle")):(r=$1(n))?Y(r,n,l,p):l(n)):p(s)}catch(E){m&&!i&&m.exit(),p(E)}},tO=function(e,t){e.notified||(e.notified=!0,lr(function(){for(var n,r=e.reactions;n=r.get();)eO(n,e);e.notified=!1,t&&!e.rejection&&IF(e)}))},nO=function(e,t,n){var r,i;bF?((r=GC.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),L.dispatchEvent(r)):r={promise:t,reason:n},!wn&&(i=L["on"+e])?i(r):e===Z1&&Ce("Unhandled promise rejection",n)},IF=function(e){Y(Rt,L,function(){var t,n=e.facade,r=e.value;if(rO(e)&&(t=_e(function(){b?HC.emit("unhandledRejection",r,n):nO(Z1,n,r)}),e.rejection=b||rO(e)?2:1,t.error))throw t.value})},rO=function(e){return e.rejection!==1&&!e.parent},AF=function(e){Y(Rt,L,function(){var t=e.facade;b?HC.emit("rejectionHandled",t):nO("rejectionhandled",t,e.value)})},Xp=function(e,t,n){return function(r){e(t,r,n)}},Jp=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,tO(e,!0))},zC=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new Q1("Promise can't be resolved itself");var r=$1(t);r?lr(function(){var i={done:!1};try{Y(r,t,Xp(zC,i,e),Xp(Jp,i,e))}catch(s){Jp(i,s,e)}}):(e.value=t,e.state=1,tO(e,!1))}catch(i){Jp({done:!1},i,e)}}};Vr&&(WC=(sg=function(e){_t(this,WC),Ze(e),Y(d,this);var t=Io(this);try{e(Xp(zC,t),Xp(Jp,t))}catch(n){Jp(t,n)}}).prototype,(d=function(e){BC(this,{type:Vt,done:!1,notified:!1,parent:!1,reactions:new Ne,rejection:!1,state:0,value:null})}).prototype=oe(WC,"then",function(e,t){var n=Io(this),r=KC(Tt(this,sg));return n.parent=!0,r.ok=!$e(e)||e,r.fail=$e(t)&&t,r.domain=b?HC.domain:void 0,n.state===0?n.reactions.add(r):lr(function(){eO(r,n)}),r.promise}),_=function(){var e=new d,t=Io(e);this.promise=e,this.resolve=Xp(zC,t),this.reject=Xp(Jp,t)},kt.f=KC=function(e){return e===sg||e===void 0?new _(e):wF(e)}),T({global:!0,wrap:!0,forced:Vr},{Promise:sg}),pe(sg,Vt,!1,!0),Le(Vt);var iO=An("iterator"),sO=!1;try{var OF=0,oO={next:function(){return{done:!!OF++}},return:function(){sO=!0}};oO[iO]=function(){return this},Array.from(oO,function(){throw 2})}catch{}var NF=bo,PF=function(e,t){try{if(!t&&!sO)return!1}catch{return!1}var n=!1;try{var r={};r[iO]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},yS=eh.CONSTRUCTOR||!PF(function(e){NF.all(e).then(void 0,function(){})}),DF=We,kF=Bn,LF=Bi,xF=il,MF=sa;qt({target:"Promise",stat:!0,forced:yS},{all:function(e){var t=this,n=LF.f(t),r=n.resolve,i=n.reject,s=xF(function(){var o=kF(t.resolve),c=[],l=0,p=1;MF(e,function(m){var E=l++,v=!1;p++,DF(o,t,m).then(function(y){v||(v=!0,c[E]=y,--p||r(c))},i)}),--p||r(c)});return s.error&&i(s.value),n.promise}});var UF=qt,VF=eh.CONSTRUCTOR;bo&&bo.prototype,UF({target:"Promise",proto:!0,forced:VF,real:!0},{catch:function(e){return this.then(void 0,e)}});var jF=We,FF=Bn,BF=Bi,WF=il,GF=sa;qt({target:"Promise",stat:!0,forced:yS},{race:function(e){var t=this,n=BF.f(t),r=n.reject,i=WF(function(){var s=FF(t.resolve);GF(e,function(o){jF(s,t,o).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var HF=Bi;qt({target:"Promise",stat:!0,forced:eh.CONSTRUCTOR},{reject:function(e){var t=HF.f(this);return(0,t.reject)(e),t.promise}});var KF=Zr,zF=pr,YF=Bi,aO=function(e,t){if(KF(e),zF(t)&&t.constructor===e)return t;var n=YF.f(e);return(0,n.resolve)(t),n.promise},qF=qt,XF=bo,JF=eh.CONSTRUCTOR,QF=aO,ZF=Ar("Promise"),$F=!JF;qF({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return QF($F&&this===ZF?XF:this,e)}});var e7=We,t7=Bn,n7=Bi,r7=il,i7=sa;qt({target:"Promise",stat:!0,forced:yS},{allSettled:function(e){var t=this,n=n7.f(t),r=n.resolve,i=n.reject,s=r7(function(){var o=t7(t.resolve),c=[],l=0,p=1;i7(e,function(m){var E=l++,v=!1;p++,e7(o,t,m).then(function(y){v||(v=!0,c[E]={status:"fulfilled",value:y},--p||r(c))},function(y){v||(v=!0,c[E]={status:"rejected",reason:y},--p||r(c))})}),--p||r(c)});return s.error&&i(s.value),n.promise}});var s7=We,o7=Bn,a7=Ar,c7=Bi,l7=il,d7=sa,cO="No one promise resolved";qt({target:"Promise",stat:!0,forced:yS},{any:function(e){var t=this,n=a7("AggregateError"),r=c7.f(t),i=r.resolve,s=r.reject,o=l7(function(){var c=o7(t.resolve),l=[],p=0,m=1,E=!1;d7(e,function(v){var y=p++,D=!1;m++,s7(c,t,v).then(function(A){D||E||(E=!0,i(A))},function(A){D||E||(D=!0,l[y]=A,--m||s(new n(l,cO)))})}),--m||s(new n(l,cO))});return o.error&&s(o.value),r.promise}});var u7=qt,h7=le,p7=yr,f7=Bi,m7=Bn,lO=il,YC=ie.Promise,dO=!1;u7({target:"Promise",stat:!0,forced:!YC||!YC.try||lO(function(){YC.try(function(e){dO=e===8},8)}).error||!dO},{try:function(e){var t=arguments.length>1?p7(arguments,1):[],n=f7.f(this),r=lO(function(){return h7(m7(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var _7=Bi;qt({target:"Promise",stat:!0},{withResolvers:function(){var e=_7.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var g7=qt,qC=bo,E7=C,v7=Ar,S7=Ue,y7=nl,uO=aO,T7=qC&&qC.prototype;g7({target:"Promise",proto:!0,real:!0,forced:!!qC&&E7(function(){T7.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=y7(this,v7("Promise")),n=S7(e);return this.then(n?function(r){return uO(t,e()).then(function(){return r})}:e,n?function(r){return uO(t,e()).then(function(){throw r})}:e)}});var XC=B,C7=Dm,R7=Mi,w7=Kr,b7=XC("".charAt),hO=XC("".charCodeAt),I7=XC("".slice),pO=function(e){return function(t,n){var r,i,s=R7(w7(t)),o=C7(n),c=s.length;return o<0||o>=c?e?"":void 0:(r=hO(s,o))<55296||r>56319||o+1===c||(i=hO(s,o+1))<56320||i>57343?e?b7(s,o):r:e?I7(s,o,o+2):i-56320+(r-55296<<10)+65536}},JC={codeAt:pO(!1),charAt:pO(!0)},A7=JC.charAt,O7=Mi,fO=nc,N7=$r,mO=Mp,_O="String Iterator",P7=fO.set,D7=fO.getterFor(_O);N7(String,"String",function(e){P7(this,{type:_O,string:O7(e),index:0})},function(){var e,t=D7(this),n=t.string,r=t.index;return r>=n.length?mO(void 0,!0):(e=A7(n,r),t.index+=e.length,mO(e,!1))});var k7=Jr.Promise,L7={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},x7=ie,M7=Co,gO=Ks;for(var QC in L7)M7(x7[QC],QC),gO[QC]=gO.Array;var EO=k7,Ve=S(EO),U7=Qi("Array","values"),V7=Xo,j7=fr,F7=q,B7=U7,ZC=Array.prototype,W7={DOMTokenList:!0,NodeList:!0},G7=function(e){var t=e.values;return e===ZC||F7(ZC,e)&&t===ZC.values||j7(W7,V7(e))?B7:t},rs=S(G7),vO=fn,H7=TypeError,SO=yr,K7=Math.floor,$C=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var o=K7(n/2),c=$C(SO(e,0,o),t),l=$C(SO(e,o),t),p=c.length,m=l.length,E=0,v=0;E<p||v<m;)e[E+v]=E<p&&v<m?t(c[E],l[v])<=0?c[E++]:l[v++]:E<p?c[E++]:l[v++];return e},yO=$C,TO=zr.match(/firefox\/(\d+)/i),z7=!!TO&&+TO[1],Y7=/MSIE|Trident/.test(zr),CO=zr.match(/AppleWebKit\/(\d+)\./),q7=!!CO&&+CO[1],X7=qt,RO=B,J7=Bn,Q7=go,wO=Ya,Z7=function(e,t){if(!delete e[t])throw new H7("Cannot delete property "+vO(t)+" of "+vO(e))},bO=Mi,eR=C,$7=yO,e9=gu,IO=z7,t9=Y7,AO=Ti,OO=q7,fd=[],NO=RO(fd.sort),n9=RO(fd.push),r9=eR(function(){fd.sort(void 0)}),i9=eR(function(){fd.sort(null)}),s9=e9("sort"),PO=!eR(function(){if(AO)return AO<70;if(!(IO&&IO>3)){if(t9)return!0;if(OO)return OO<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)fd.push({k:t+r,v:n})}for(fd.sort(function(s,o){return o.v-s.v}),r=0;r<fd.length;r++)t=fd[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});X7({target:"Array",proto:!0,forced:r9||!i9||!s9||!PO},{sort:function(e){e!==void 0&&J7(e);var t=Q7(this);if(PO)return e===void 0?NO(t):NO(t,e);var n,r,i=[],s=wO(t);for(r=0;r<s;r++)r in t&&n9(i,t[r]);for($7(i,function(o){return function(c,l){return l===void 0?-1:c===void 0?1:o!==void 0?+o(c,l)||0:bO(c)>bO(l)?1:-1}}(e)),n=wO(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)Z7(t,r++);return t}});var o9=Qi("Array","sort"),a9=q,c9=o9,tR=Array.prototype,l9=function(e){var t=e.sort;return e===tR||a9(tR,e)&&t===tR.sort?c9:t},th=S(l9),d9=qt,u9=B,h9=km,p9=RangeError,DO=String.fromCharCode,kO=String.fromCodePoint,f9=u9([].join);d9({target:"String",stat:!0,forced:!!kO&&kO.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],h9(t,1114111)!==t)throw new p9(t+" is not a valid code point");n[i]=t<65536?DO(t):DO(55296+((t-=65536)>>10),t%1024+56320)}return f9(n,"")}});var m9=C,_9=An("iterator"),TS=!m9(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,s){t.delete("b"),r+=s+i}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[_9]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),g9=aa,nR=qt,LO=ie,rR=X_,E9=Ar,CS=We,da=B,og=Ge,xO=TS,MO=aa,v9=rc,S9=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:g9(e,r,t[r],n);return e},y9=Co,T9=ju,iR=nc,UO=Gu,sR=Ue,C9=fr,R9=Ha,w9=Xo,b9=Zr,VO=pr,is=Mi,I9=Au,jO=ot,FO=qc,A9=zs,RS=Mp,Qp=gs,O9=yO,N9=An("iterator"),Zp="URLSearchParams",BO=Zp+"Iterator",WO=iR.set,Ao=iR.getterFor(Zp),P9=iR.getterFor(BO),GO=rR("fetch"),wS=rR("Request"),ag=rR("Headers"),oR=wS&&wS.prototype,HO=ag&&ag.prototype,D9=LO.TypeError,k9=LO.encodeURIComponent,L9=String.fromCharCode,x9=E9("String","fromCodePoint"),M9=parseInt,bS=da("".charAt),KO=da([].join),md=da([].push),zO=da("".replace),U9=da([].shift),YO=da([].splice),qO=da("".split),XO=da("".slice),V9=da(/./.exec),j9=/\+/g,F9=/^[0-9a-f]+$/i,JO=function(e,t){var n=XO(e,t,t+2);return V9(F9,n)?M9(n,16):NaN},B9=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},W9=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},QO=function(e){for(var t=(e=zO(e,j9," ")).length,n="",r=0;r<t;){var i=bS(e,r);if(i==="%"){if(bS(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var s=JO(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var o=B9(s);if(o===0)i=L9(s);else{if(o===1||o>4){n+="",r++;continue}for(var c=[s],l=1;l<o&&!(++r+3>t||bS(e,r)!=="%");){var p=JO(e,r+1);if(p!=p){r+=3;break}if(p>191||p<128)break;md(c,p),r+=2,l++}if(c.length!==o){n+="";continue}var m=W9(c);m===null?n+="":i=x9(m)}}n+=i,r++}return n},G9=/[!'()~]|%20/g,H9={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},K9=function(e){return H9[e]},ZO=function(e){return zO(k9(e),G9,K9)},aR=T9(function(e,t){WO(this,{type:BO,target:Ao(e).entries,index:0,kind:t})},Zp,function(){var e=P9(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,RS(void 0,!0);var r=t[n];switch(e.kind){case"keys":return RS(r.key,!1);case"values":return RS(r.value,!1)}return RS([r.key,r.value],!1)},!0),$O=function(e){this.entries=[],this.url=null,e!==void 0&&(VO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?bS(e,0)==="?"?XO(e,1):e:is(e)))};$O.prototype={type:Zp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,o,c,l=this.entries,p=A9(e);if(p)for(n=(t=FO(e,p)).next;!(r=CS(n,t)).done;){if(s=(i=FO(b9(r.value))).next,(o=CS(s,i)).done||(c=CS(s,i)).done||!CS(s,i).done)throw new D9("Expected sequence with length 2");md(l,{key:is(o.value),value:is(c.value)})}else for(var m in e)C9(e,m)&&md(l,{key:m,value:is(e[m])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=qO(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=qO(t,"="),md(r,{key:QO(U9(n)),value:QO(KO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],md(n,ZO(e.key)+"="+ZO(e.value));return KO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var IS=function(){UO(this,$p);var e=WO(this,new $O(arguments.length>0?arguments[0]:void 0));og||(this.size=e.entries.length)},$p=IS.prototype;if(S9($p,{append:function(e,t){var n=Ao(this);Qp(arguments.length,2),md(n.entries,{key:is(e),value:is(t)}),og||this.length++,n.updateURL()},delete:function(e){for(var t=Ao(this),n=Qp(arguments.length,1),r=t.entries,i=is(e),s=n<2?void 0:arguments[1],o=s===void 0?s:is(s),c=0;c<r.length;){var l=r[c];if(l.key!==i||o!==void 0&&l.value!==o)c++;else if(YO(r,c,1),o!==void 0)break}og||(this.size=r.length),t.updateURL()},get:function(e){var t=Ao(this).entries;Qp(arguments.length,1);for(var n=is(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Ao(this).entries;Qp(arguments.length,1);for(var n=is(e),r=[],i=0;i<t.length;i++)t[i].key===n&&md(r,t[i].value);return r},has:function(e){for(var t=Ao(this).entries,n=Qp(arguments.length,1),r=is(e),i=n<2?void 0:arguments[1],s=i===void 0?i:is(i),o=0;o<t.length;){var c=t[o++];if(c.key===r&&(s===void 0||c.value===s))return!0}return!1},set:function(e,t){var n=Ao(this);Qp(arguments.length,1);for(var r,i=n.entries,s=!1,o=is(e),c=is(t),l=0;l<i.length;l++)(r=i[l]).key===o&&(s?YO(i,l--,1):(s=!0,r.value=c));s||md(i,{key:o,value:c}),og||(this.size=i.length),n.updateURL()},sort:function(){var e=Ao(this);O9(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Ao(this).entries,r=R9(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new aR(this,"keys")},values:function(){return new aR(this,"values")},entries:function(){return new aR(this,"entries")}},{enumerable:!0}),MO($p,N9,$p.entries,{}),MO($p,"toString",function(){return Ao(this).serialize()},{enumerable:!0}),og&&v9($p,"size",{get:function(){return Ao(this).entries.length},configurable:!0,enumerable:!0}),y9(IS,Zp),nR({global:!0,forced:!xO},{URLSearchParams:IS}),!xO&&sR(ag)){var z9=da(HO.has),Y9=da(HO.set),eN=function(e){if(VO(e)){var t,n=e.body;if(w9(n)===Zp)return t=e.headers?new ag(e.headers):new ag,z9(t,"content-type")||Y9(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),I9(e,{body:jO(0,is(n)),headers:jO(0,t)})}return e};if(sR(GO)&&nR({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return GO(e,arguments.length>1?eN(arguments[1]):{})}}),sR(wS)){var cR=function(e){return UO(this,oR),new wS(e,arguments.length>1?eN(arguments[1]):{})};oR.constructor=cR,cR.prototype=oR,nR({global:!0,dontCallGetSet:!0,forced:!0},{Request:cR})}}var Oo,q9={URLSearchParams:IS,getState:Ao},X9=Jr.URLSearchParams,tN=Ge,J9=B,Q9=We,Z9=C,lR=wi,$9=ql,eB=Ae,tB=go,nB=vn,ef=Object.assign,nN=Object.defineProperty,rB=J9([].concat),iB=!ef||Z9(function(){if(tN&&ef({b:1},ef(nN({},"a",{enumerable:!0,get:function(){nN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),ef({},e)[n]!==7||lR(ef({},t)).join("")!==r})?function(e,t){for(var n=tB(e),r=arguments.length,i=1,s=$9.f,o=eB.f;r>i;)for(var c,l=nB(arguments[i++]),p=s?rB(lR(l),s(l)):lR(l),m=p.length,E=0;m>E;)c=p[E++],tN&&!Q9(o,l,c)||(n[c]=l[c]);return n}:ef,sB=Zr,oB=Xc,aB=Ge,cB=xi,lB=ot,dR=function(e,t,n){aB?cB.f(e,t,lB(0,n)):e[t]=n},dB=Ha,uB=We,hB=go,pB=function(e,t,n,r){try{return r?t(sB(n)[0],n[1]):t(n)}catch(i){oB(e,"throw",i)}},fB=a_,mB=Or,_B=Ya,rN=dR,gB=qc,EB=zs,iN=Array,nh=B,uR=2147483647,vB=/[^\0-\u007E]/,sN=/[.\u3002\uFF0E\uFF61]/g,oN="Overflow: input needs wider integers to process",aN=RangeError,SB=nh(sN.exec),tf=Math.floor,hR=String.fromCharCode,cN=nh("".charCodeAt),lN=nh([].join),_d=nh([].push),yB=nh("".replace),TB=nh("".split),CB=nh("".toLowerCase),dN=function(e){return e+22+75*(e<26)},RB=function(e,t,n){var r=0;for(e=n?tf(e/700):e>>1,e+=tf(e/t);e>455;)e=tf(e/35),r+=36;return tf(r+36*e/(e+38))},wB=function(e){var t=[];e=function(V){for(var U=[],G=0,Z=V.length;G<Z;){var Q=cN(V,G++);if(Q>=55296&&Q<=56319&&G<Z){var z=cN(V,G++);(64512&z)==56320?_d(U,((1023&Q)<<10)+(1023&z)+65536):(_d(U,Q),G--)}else _d(U,Q)}return U}(e);var n,r,i=e.length,s=128,o=0,c=72;for(n=0;n<e.length;n++)(r=e[n])<128&&_d(t,hR(r));var l=t.length,p=l;for(l&&_d(t,"-");p<i;){var m=uR;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<m&&(m=r);var E=p+1;if(m-s>tf((uR-o)/E))throw new aN(oN);for(o+=(m-s)*E,s=m,n=0;n<e.length;n++){if((r=e[n])<s&&++o>uR)throw new aN(oN);if(r===s){for(var v=o,y=36;;){var D=y<=c?1:y>=c+26?26:y-c;if(v<D)break;var A=v-D,O=36-D;_d(t,hR(dN(D+A%O))),v=tf(A/O),y+=36}_d(t,hR(dN(v))),c=RB(o,E,p===l),o=0,p++}}o++,s++}return lN(t,"")},bB=qt,pR=Ge,IB=TS,fR=ie,uN=Ha,No=B,AS=aa,Po=rc,AB=Gu,mR=fr,_R=iB,nf=function(e){var t=hB(e),n=mB(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=dB(i,r>2?arguments[2]:void 0));var o,c,l,p,m,E,v=EB(t),y=0;if(!v||this===iN&&fB(v))for(o=_B(t),c=n?new this(o):iN(o);o>y;y++)E=s?i(t[y],y):t[y],rN(c,y,E);else for(c=n?new this:[],m=(p=gB(t,v)).next;!(l=uB(m,p)).done;y++)E=s?pB(p,i,[l.value,y],!0):l.value,rN(c,y,E);return c.length=y,c},ua=yr,OB=JC.codeAt,NB=function(e){var t,n,r=[],i=TB(yB(CB(e),sN,"."),".");for(t=0;t<i.length;t++)n=i[t],_d(r,SB(vB,n)?"xn--"+wB(n):n);return lN(r,".")},sl=Mi,PB=Co,DB=gs,hN=q9,pN=nc,kB=pN.set,OS=pN.getterFor("URL"),LB=hN.URLSearchParams,xB=hN.getState,cg=fR.URL,gR=fR.TypeError,NS=fR.parseInt,MB=Math.floor,fN=Math.pow,Do=No("".charAt),ha=No(/./.exec),lg=No([].join),UB=No(1 .toString),VB=No([].pop),rf=No([].push),ER=No("".replace),jB=No([].shift),FB=No("".split),dg=No("".slice),PS=No("".toLowerCase),BB=No([].unshift),vR="Invalid scheme",rh="Invalid host",mN="Invalid port",_N=/[a-z]/i,WB=/[\d+-.a-z]/i,SR=/\d/,GB=/^0x/i,HB=/^[0-7]+$/,KB=/^\d+$/,gN=/^[\da-f]+$/i,zB=/[\0\t\n\r #%/:<>?@[\\\]^|]/,YB=/[\0\t\n\r #/:<>?@[\\\]^|]/,qB=/^[\u0000-\u0020]+/,XB=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,JB=/[\t\n\r]/g,ug=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)BB(t,e%256),e=MB(e/256);return lg(t,".")}if(typeof e=="object"){for(t="",r=function(s){for(var o=null,c=1,l=null,p=0,m=0;m<8;m++)s[m]!==0?(p>c&&(o=l,c=p),l=null,p=0):(l===null&&(l=m),++p);return p>c?l:o}(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=UB(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},DS={},EN=_R({},DS,{" ":1,'"':1,"<":1,">":1,"`":1}),vN=_R({},EN,{"#":1,"?":1,"{":1,"}":1}),yR=_R({},vN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),gd=function(e,t){var n=OB(e,0);return n>32&&n<127&&!mR(t,e)?e:encodeURIComponent(e)},kS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hg=function(e,t){var n;return e.length===2&&ha(_N,Do(e,0))&&((n=Do(e,1))===":"||!t&&n==="|")},SN=function(e){var t;return e.length>1&&hg(dg(e,0,2))&&(e.length===2||(t=Do(e,2))==="/"||t==="\\"||t==="?"||t==="#")},QB=function(e){return e==="."||PS(e)==="%2e"},TR={},yN={},CR={},TN={},CN={},RR={},RN={},wN={},LS={},xS={},wR={},bR={},IR={},AR={},bN={},OR={},sf={},fc={},IN={},ih={},ol={},NR=function(e,t,n){var r,i,s,o=sl(e);if(t){if(i=this.parse(o))throw new gR(i);this.searchParams=null}else{if(n!==void 0&&(r=new NR(n,!0)),i=this.parse(o,null,r))throw new gR(i);(s=xB(new LB)).bindURL(this),this.searchParams=s}};NR.prototype={type:"URL",parse:function(e,t,n){var r,i,s,o,c,l=this,p=t||TR,m=0,E="",v=!1,y=!1,D=!1;for(e=sl(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=ER(e,qB,""),e=ER(e,XB,"$1")),e=ER(e,JB,""),r=nf(e);m<=r.length;){switch(i=r[m],p){case TR:if(!i||!ha(_N,i)){if(t)return vR;p=CR;continue}E+=PS(i),p=yN;break;case yN:if(i&&(ha(WB,i)||i==="+"||i==="-"||i==="."))E+=PS(i);else{if(i!==":"){if(t)return vR;E="",p=CR,m=0;continue}if(t&&(l.isSpecial()!==mR(kS,E)||E==="file"&&(l.includesCredentials()||l.port!==null)||l.scheme==="file"&&!l.host))return;if(l.scheme=E,t)return void(l.isSpecial()&&kS[l.scheme]===l.port&&(l.port=null));E="",l.scheme==="file"?p=AR:l.isSpecial()&&n&&n.scheme===l.scheme?p=TN:l.isSpecial()?p=wN:r[m+1]==="/"?(p=CN,m++):(l.cannotBeABaseURL=!0,rf(l.path,""),p=IN)}break;case CR:if(!n||n.cannotBeABaseURL&&i!=="#")return vR;if(n.cannotBeABaseURL&&i==="#"){l.scheme=n.scheme,l.path=ua(n.path),l.query=n.query,l.fragment="",l.cannotBeABaseURL=!0,p=ol;break}p=n.scheme==="file"?AR:RR;continue;case TN:if(i!=="/"||r[m+1]!=="/"){p=RR;continue}p=LS,m++;break;case CN:if(i==="/"){p=xS;break}p=fc;continue;case RR:if(l.scheme=n.scheme,i===Oo)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.query=n.query;else if(i==="/"||i==="\\"&&l.isSpecial())p=RN;else if(i==="?")l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.query="",p=ih;else{if(i!=="#"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.path.length--,p=fc;continue}l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ua(n.path),l.query=n.query,l.fragment="",p=ol}break;case RN:if(!l.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,p=fc;continue}p=xS}else p=LS;break;case wN:if(p=LS,i!=="/"||Do(E,m+1)!=="/")continue;m++;break;case LS:if(i!=="/"&&i!=="\\"){p=xS;continue}break;case xS:if(i==="@"){v&&(E="%40"+E),v=!0,s=nf(E);for(var A=0;A<s.length;A++){var O=s[A];if(O!==":"||D){var V=gd(O,yR);D?l.password+=V:l.username+=V}else D=!0}E=""}else if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(v&&E==="")return"Invalid authority";m-=nf(E).length+1,E="",p=wR}else E+=i;break;case wR:case bR:if(t&&l.scheme==="file"){p=OR;continue}if(i!==":"||y){if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(l.isSpecial()&&E==="")return rh;if(t&&E===""&&(l.includesCredentials()||l.port!==null))return;if(o=l.parseHost(E))return o;if(E="",p=sf,t)return;continue}i==="["?y=!0:i==="]"&&(y=!1),E+=i}else{if(E==="")return rh;if(o=l.parseHost(E))return o;if(E="",p=IR,t===bR)return}break;case IR:if(!ha(SR,i)){if(i===Oo||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()||t){if(E!==""){var U=NS(E,10);if(U>65535)return mN;l.port=l.isSpecial()&&U===kS[l.scheme]?null:U,E=""}if(t)return;p=sf;continue}return mN}E+=i;break;case AR:if(l.scheme="file",i==="/"||i==="\\")p=bN;else{if(!n||n.scheme!=="file"){p=fc;continue}switch(i){case Oo:l.host=n.host,l.path=ua(n.path),l.query=n.query;break;case"?":l.host=n.host,l.path=ua(n.path),l.query="",p=ih;break;case"#":l.host=n.host,l.path=ua(n.path),l.query=n.query,l.fragment="",p=ol;break;default:SN(lg(ua(r,m),""))||(l.host=n.host,l.path=ua(n.path),l.shortenPath()),p=fc;continue}}break;case bN:if(i==="/"||i==="\\"){p=OR;break}n&&n.scheme==="file"&&!SN(lg(ua(r,m),""))&&(hg(n.path[0],!0)?rf(l.path,n.path[0]):l.host=n.host),p=fc;continue;case OR:if(i===Oo||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&hg(E))p=fc;else if(E===""){if(l.host="",t)return;p=sf}else{if(o=l.parseHost(E))return o;if(l.host==="localhost"&&(l.host=""),t)return;E="",p=sf}continue}E+=i;break;case sf:if(l.isSpecial()){if(p=fc,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==Oo&&(p=fc,i!=="/"))continue}else l.fragment="",p=ol;else l.query="",p=ih;break;case fc:if(i===Oo||i==="/"||i==="\\"&&l.isSpecial()||!t&&(i==="?"||i==="#")){if((c=PS(c=E))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(l.shortenPath(),i==="/"||i==="\\"&&l.isSpecial()||rf(l.path,"")):QB(E)?i==="/"||i==="\\"&&l.isSpecial()||rf(l.path,""):(l.scheme==="file"&&!l.path.length&&hg(E)&&(l.host&&(l.host=""),E=Do(E,0)+":"),rf(l.path,E)),E="",l.scheme==="file"&&(i===Oo||i==="?"||i==="#"))for(;l.path.length>1&&l.path[0]==="";)jB(l.path);i==="?"?(l.query="",p=ih):i==="#"&&(l.fragment="",p=ol)}else E+=gd(i,vN);break;case IN:i==="?"?(l.query="",p=ih):i==="#"?(l.fragment="",p=ol):i!==Oo&&(l.path[0]+=gd(i,DS));break;case ih:t||i!=="#"?i!==Oo&&(i==="'"&&l.isSpecial()?l.query+="%27":l.query+=i==="#"?"%23":gd(i,DS)):(l.fragment="",p=ol);break;case ol:i!==Oo&&(l.fragment+=gd(i,EN))}m++}},parseHost:function(e){var t,n,r;if(Do(e,0)==="["){if(Do(e,e.length-1)!=="]"||(t=function(i){var s,o,c,l,p,m,E,v=[0,0,0,0,0,0,0,0],y=0,D=null,A=0,O=function(){return Do(i,A)};if(O()===":"){if(Do(i,1)!==":")return;A+=2,D=++y}for(;O();){if(y===8)return;if(O()!==":"){for(s=o=0;o<4&&ha(gN,O());)s=16*s+NS(O(),16),A++,o++;if(O()==="."){if(o===0||(A-=o,y>6))return;for(c=0;O();){if(l=null,c>0){if(!(O()==="."&&c<4))return;A++}if(!ha(SR,O()))return;for(;ha(SR,O());){if(p=NS(O(),10),l===null)l=p;else{if(l===0)return;l=10*l+p}if(l>255)return;A++}v[y]=256*v[y]+l,++c!=2&&c!==4||y++}if(c!==4)return;break}if(O()===":"){if(A++,!O())return}else if(O())return;v[y++]=s}else{if(D!==null)return;A++,D=++y}}if(D!==null)for(m=y-D,y=7;y!==0&&m>0;)E=v[y],v[y--]=v[D+m-1],v[D+--m]=E;else if(y!==8)return;return v}(dg(e,1,-1)),!t))return rh;this.host=t}else if(this.isSpecial()){if(e=NB(e),ha(zB,e)||(t=function(i){var s,o,c,l,p,m,E,v=FB(i,".");if(v.length&&v[v.length-1]===""&&v.length--,(s=v.length)>4)return i;for(o=[],c=0;c<s;c++){if((l=v[c])==="")return i;if(p=10,l.length>1&&Do(l,0)==="0"&&(p=ha(GB,l)?16:8,l=dg(l,p===8?1:2)),l==="")m=0;else{if(!ha(p===10?KB:p===8?HB:gN,l))return i;m=NS(l,p)}rf(o,m)}for(c=0;c<s;c++)if(m=o[c],c===s-1){if(m>=fN(256,5-s))return null}else if(m>255)return null;for(E=VB(o),c=0;c<o.length;c++)E+=o[c]*fN(256,3-c);return E}(e),t===null))return rh;this.host=t}else{if(ha(YB,e))return rh;for(t="",n=nf(e),r=0;r<n.length;r++)t+=gd(n[r],DS);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return mR(kS,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&hg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,o=e.path,c=e.query,l=e.fragment,p=t+":";return i!==null?(p+="//",e.includesCredentials()&&(p+=n+(r?":"+r:"")+"@"),p+=ug(i),s!==null&&(p+=":"+s)):t==="file"&&(p+="//"),p+=e.cannotBeABaseURL?o[0]:o.length?"/"+lg(o,"/"):"",c!==null&&(p+="?"+c),l!==null&&(p+="#"+l),p},setHref:function(e){var t=this.parse(e);if(t)throw new gR(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new of(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+ug(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(sl(e)+":",TR)},getUsername:function(){return this.username},setUsername:function(e){var t=nf(sl(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=gd(t[n],yR)}},getPassword:function(){return this.password},setPassword:function(e){var t=nf(sl(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=gd(t[n],yR)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?ug(e):ug(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,wR)},getHostname:function(){var e=this.host;return e===null?"":ug(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,bR)},getPort:function(){var e=this.port;return e===null?"":sl(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=sl(e))===""?this.port=null:this.parse(e,IR))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+lg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,sf))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=sl(e))===""?this.query=null:(Do(e,0)==="?"&&(e=dg(e,1)),this.query="",this.parse(e,ih)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=sl(e))!==""?(Do(e,0)==="#"&&(e=dg(e,1)),this.fragment="",this.parse(e,ol)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var of=function(e){var t=AB(this,ss),n=DB(arguments.length,1)>1?arguments[1]:void 0,r=kB(t,new NR(e,!1,n));pR||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},ss=of.prototype,ko=function(e,t){return{get:function(){return OS(this)[e]()},set:t&&function(n){return OS(this)[t](n)},configurable:!0,enumerable:!0}};if(pR&&(Po(ss,"href",ko("serialize","setHref")),Po(ss,"origin",ko("getOrigin")),Po(ss,"protocol",ko("getProtocol","setProtocol")),Po(ss,"username",ko("getUsername","setUsername")),Po(ss,"password",ko("getPassword","setPassword")),Po(ss,"host",ko("getHost","setHost")),Po(ss,"hostname",ko("getHostname","setHostname")),Po(ss,"port",ko("getPort","setPort")),Po(ss,"pathname",ko("getPathname","setPathname")),Po(ss,"search",ko("getSearch","setSearch")),Po(ss,"searchParams",ko("getSearchParams")),Po(ss,"hash",ko("getHash","setHash"))),AS(ss,"toJSON",function(){return OS(this).serialize()},{enumerable:!0}),AS(ss,"toString",function(){return OS(this).serialize()},{enumerable:!0}),cg){var AN=cg.createObjectURL,ON=cg.revokeObjectURL;AN&&AS(of,"createObjectURL",uN(AN,cg)),ON&&AS(of,"revokeObjectURL",uN(ON,cg))}PB(of,"URL"),bB({global:!0,forced:!IB,sham:!pR},{URL:of});var ZB=qt,NN=C,$B=gs,PN=Mi,e2=TS,PR=Ar("URL"),t2=e2&&NN(function(){PR.canParse()}),n2=NN(function(){return PR.canParse.length!==1});ZB({target:"URL",stat:!0,forced:!t2||n2},{canParse:function(e){var t=$B(arguments.length,1),n=PN(e),r=t<2||arguments[1]===void 0?void 0:PN(arguments[1]);try{return!!new PR(n,r)}catch{return!1}}});var r2=qt,i2=gs,DN=Mi,s2=TS,o2=Ar("URL");r2({target:"URL",stat:!0,forced:!s2},{parse:function(e){var t=i2(arguments.length,1),n=DN(e),r=t<2||arguments[1]===void 0?void 0:DN(arguments[1]);try{return new o2(n,r)}catch{return null}}});var MS=S(Jr.URL);let kN=!0,LN=!0;function US(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function sh(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,c){if(o!==t)return i.apply(this,arguments);const l=p=>{const m=n(p);m&&(c.handleEvent?c.handleEvent(m):c(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,l),i.apply(this,[o,l])};const s=r.removeEventListener;r.removeEventListener=function(o,c){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const l=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function a2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(kN=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function c2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(LN=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function xN(){if(typeof window=="object"){if(kN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function DR(e,t){LN&&console.warn(e+" is deprecated, please use "+t+" instead.")}function MN(e){return Object.prototype.toString.call(e)==="[object Object]"}function UN(e){var t;return MN(e)?Ui(t=Object.keys(e)).call(t,function(n,r){const i=MN(e[r]),s=i?UN(e[r]):e[r],o=i&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[r]:s})},{}):e}function kR(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?kR(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{kR(e,e.get(i),n)})}))}function VN(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)}),s.forEach(o=>{e.forEach(c=>{c.type===r&&c.trackId===o.id&&kR(e,c,i)})}),i}const jN=xN;function FN(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const p=typeof o[l]=="object"?o[l]:{ideal:o[l]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const m=function(E,v){return E?E+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(p.ideal!==void 0){c.optional=c.optional||[];let E={};typeof p.ideal=="number"?(E[m("min",l)]=p.ideal,c.optional.push(E),E={},E[m("max",l)]=p.ideal,c.optional.push(E)):(E[m("",l)]=p.ideal,c.optional.push(E))}p.exact!==void 0&&typeof p.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[m("",l)]=p.exact):["min","max"].forEach(E=>{p[E]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[m(E,l)]=p[E])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(t.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const l=function(p,m,E){m in p&&!(E in p)&&(p[E]=p[m],delete p[m])};l((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),l(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let l=o.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const p=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let m;if(delete o.video.facingMode,l.exact==="environment"||l.ideal==="environment"?m=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(E=>{E=E.filter(y=>y.kind==="videoinput");let v=E.find(y=>m.some(D=>{var A;return Oe(A=y.label.toLowerCase()).call(A,D)}));return!v&&E.length&&Oe(m).call(m,"back")&&(v=E[E.length-1]),v&&(o.video.deviceId=l.exact?{exact:v.deviceId}:{ideal:v.deviceId}),o.video=r(o.video),jN("chrome: "+JSON.stringify(o)),c(o)})}o.video=r(o.video)}return jN("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,c,l){i(o,p=>{n.webkitGetUserMedia(p,c,m=>{l&&l(s(m))})})}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>o(l).then(p=>{if(l.audio&&!p.getAudioTracks().length||l.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return p},p=>Ve.reject(s(p))))}}}function BN(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function WN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.track.id):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.id):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else sh(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function GN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let l=i.apply(this,arguments);return l||(l=t(this,o),this._senders.push(l)),l};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{const o=this._senders.find(c=>c.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function HN(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const l={};return c.result().forEach(p=>{const m={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(E=>{m[E]=p.stat(E)}),l[m.id]=m}),l},o=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){r(o(s(l)))};return t.apply(this,[c,n])}return new Ve((c,l)=>{t.apply(this,[function(p){c(o(s(p)))},l])}).then(r,i)}}function KN(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>VN(s,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),sh(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>VN(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach(o=>{o.track===n&&(r?s=!0:r=o)}),this.getReceivers().forEach(o=>(o.track===n&&(i?s=!0:i=o),o.track===n)),s||r&&i?Ve.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Ve.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function zN(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(m=>m.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>o.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function YN(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return zN(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(p=>this._reverseStreams[p.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(p=>{if(this.getSenders().find(E=>E.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const p=new e.MediaStream(l.getTracks());this._streams[l.id]=p,this._reverseStreams[p.id]=l,l=p}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;function s(l,p){let m=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(E=>{const v=l._reverseStreams[E],y=l._streams[v.id];m=m.replace(new RegExp(y.id,"g"),v.id)}),new RTCSessionDescription({type:p.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(y=>y===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[p.id];if(v)v.addTrack(l),Ve.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new e.MediaStream([l]);this._streams[p.id]=y,this._reverseStreams[y.id]=p,this.addStream(y)}return this.getSenders().find(y=>y.track===l)},["createOffer","createAnswer"].forEach(function(l){const p=e.RTCPeerConnection.prototype[l],m={[l](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[v=>{const y=s(this,v);E[0].apply(null,[y])},v=>{E[1]&&E[1].apply(null,v)},arguments[2]]):p.apply(this,arguments).then(v=>s(this,v))}};e.RTCPeerConnection.prototype[l]=m[l]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(l,p){let m=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(E=>{const v=l._reverseStreams[E],y=l._streams[v.id];m=m.replace(new RegExp(v.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:m})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(E=>l.track===E)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LR(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function qN(e,t){sh(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var XN=Object.freeze({__proto__:null,fixNegotiationNeeded:qN,shimAddTrackRemoveTrack:YN,shimAddTrackRemoveTrackWithNative:zN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:GN,shimGetStats:HN,shimGetUserMedia:FN,shimMediaStream:BN,shimOnTrack:WN,shimPeerConnection:LR,shimSenderReceiverGetStats:KN});function JN(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){DR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,c,l){c in o&&!(l in o)&&(o[l]=o[c],delete o[c])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const c=o.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function QN(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xR(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return r.apply(this,[i||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((p,m)=>{c.set(m,Object.assign({},p,{type:n[p.type]||p.type}))})}return c}).then(s,o)}}function ZN(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ve.resolve(new Map)}}function $N(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),sh(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function eP(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){DR("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&Oe(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function tP(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function nP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function rP(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function iP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function sP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ve.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var oP=Object.freeze({__proto__:null,shimAddTransceiver:nP,shimCreateAnswer:sP,shimCreateOffer:iP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Ve.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:rP,shimGetUserMedia:JN,shimOnTrack:QN,shimPeerConnection:xR,shimRTCDataChannel:tP,shimReceiverGetStats:$N,shimRemoveStream:eP,shimSenderGetStats:ZN});function aP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Oe(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach(o=>{var c;this._localStreams?Oe(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{Oe(r).call(r,i.track)&&this.removeTrack(i)})})}}function cP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Oe(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function lP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(l,p){const m=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[m]);return p?(E.then(l,p),Ve.resolve()):E},t.createAnswer=function(l,p){const m=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[m]);return p?(E.then(l,p),Ve.resolve()):E};let c=function(l,p,m){const E=i.apply(this,[l]);return m?(E.then(p,m),Ve.resolve()):E};t.setLocalDescription=c,c=function(l,p,m){const E=s.apply(this,[l]);return m?(E.then(p,m),Ve.resolve()):E},t.setRemoteDescription=c,c=function(l,p,m){const E=o.apply(this,[l]);return m?(E.then(p,m),Ve.resolve()):E},t.addIceCandidate=c}function dP(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(uP(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function uP(e){return e&&e.video!==void 0?Object.assign({},e,{video:UN(e.video)}):e}function hP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(DR("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function pP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fP(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function mP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var _P=Object.freeze({__proto__:null,shimAudioContext:mP,shimCallbacksAPI:lP,shimConstraints:uP,shimCreateOfferLegacy:fP,shimGetUserMedia:dP,shimLocalStreamsAPI:aP,shimRTCIceServerUrls:hP,shimRemoteStreamsAPI:cP,shimTrackEventTransceiver:pP}),gP=`	
\v\f\r \u2028\u2029\uFEFF`,l2=Kr,d2=Mi,MR=gP,EP=B("".replace),u2=RegExp("^["+MR+"]+"),h2=RegExp("(^|[^"+MR+"])["+MR+"]+$"),p2=function(e){return function(t){var n=d2(l2(t));return 1&e&&(n=EP(n,u2,"")),2&e&&(n=EP(n,h2,"$1")),n}},f2={trim:p2(3)},m2=Ip.PROPER,_2=C,vP=gP,g2=f2.trim;qt({target:"String",proto:!0,forced:function(e){return _2(function(){return!!vP[e]()||""[e]()!==""||m2&&vP[e].name!==e})}("trim")},{trim:function(){return g2(this)}});var E2=Qi("String","trim"),v2=q,S2=E2,UR=String.prototype,y2=function(e){var t=e.trim;return typeof e=="string"||e===UR||v2(UR,e)&&t===UR.trim?S2:t},ni=S(y2),SP={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],s=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const c=i[o],l=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const p=t.parseRtpMap(l),m=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(p.parameters=m.length?t.parseFmtp(m[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(o=>{r.headerExtensions.push(t.parseExtmap(o))});const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(o=>{s.forEach(c=>{o.rtcpFeedback.find(l=>l.type===c.type&&l.parameter===c.parameter)||o.rtcpFeedback.push(c)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=t.writeRtpMap(o),i+=t.writeFmtp(o),i+=t.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=t.writeExtmap(o)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(n,"a=ssrc:").map(v=>t.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),l=c.length>0&&c[0].ssrc;let p;const m=t.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===l&&(p=m[0][1]),i.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let y={ssrc:l,codecPayloadType:parseInt(v.parameters.apt,10)};l&&p&&(y.rtx={ssrc:p}),r.push(y),s&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&l&&r.push({ssrc:l});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,r.forEach(v=>{v.maxBitrate=E})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(n,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const c=t.matchPrefix(n,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(SP);var yP=SP.exports,af=S(yP),T2=f({__proto__:null,default:af},[yP]);function VS(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=af.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,sh(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function VR(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||sh(e,"icecandidate",t=>{if(t.candidate){const n=af.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function jS(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const l=af.splitSections(c.sdp);return l.shift(),l.some(p=>{const m=af.parseMLine(p);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},r=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const p=parseInt(l[1],10);return p!=p?-1:p},i=function(c){let l=65536;return t.browser==="firefox"&&(l=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},s=function(c,l){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const m=af.matchPrefix(c.sdp,"a=max-message-size:");return m.length>0?p=parseInt(m[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(p=2147483637),p},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),p=s(arguments[0],c);let m;m=l===0&&p===0?Number.POSITIVE_INFINITY:l===0||p===0?Math.max(l,p):Math.min(l,p);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>m}),this._sctp=E}return o.apply(this,arguments)}}function FS(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const s=r.send;r.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},sh(e,"datachannel",r=>(t(r.channel,r.target),r))}function jR(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function FR(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(s=>ni(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function BS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ve.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ve.resolve())})}function WS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var C2=Object.freeze({__proto__:null,removeExtmapAllowMixed:FR,shimAddIceCandidateNullOrEmpty:BS,shimConnectionState:jR,shimMaxMessageSize:jS,shimParameterlessSetLocalDescription:WS,shimRTCIceCandidate:VS,shimRTCIceCandidateRelayProtocol:VR,shimSendThrowTypeError:FS});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=xN,r=function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=US(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=US(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=US(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o}(e),i={browserDetails:r,commonShim:C2,extractVersion:US,disableLog:a2,disableWarnings:c2,sdp:T2};switch(r.browser){case"chrome":if(!XN||!LR||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=XN,BS(e,r),WS(e),FN(e,r),BN(e),LR(e,r),WN(e),YN(e,r),GN(e),HN(e),KN(e),qN(e,r),VS(e),VR(e),jR(e),jS(e,r),FS(e),FR(e,r);break;case"firefox":if(!oP||!xR||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=oP,BS(e,r),WS(e),JN(e,r),xR(e,r),QN(e),eP(e),ZN(e),$N(e),tP(e),nP(e),rP(e),iP(e),sP(e),VS(e),jR(e),jS(e,r),FS(e);break;case"safari":if(!_P||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=_P,BS(e,r),WS(e),hP(e),fP(e),lP(e),aP(e),cP(e),pP(e),dP(e),mP(e),VS(e),VR(e),jS(e,r),FS(e),FR(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var BR=ie;qt({global:!0,forced:BR.globalThis!==BR},{globalThis:BR});var TP=S(ie),WR={exports:{}};(function(e,t){(function(n,r){var i="function",s="undefined",o="object",c="string",l="major",p="model",m="name",E="type",v="vendor",y="version",D="architecture",A="console",O="mobile",V="tablet",U="smarttv",G="wearable",Z="embedded",Q="Amazon",z="Apple",re="ASUS",he="BlackBerry",Ee="Browser",Re="Chrome",Ct="Firefox",bt="Google",ut="Huawei",Yt="LG",Ht="Microsoft",Hr="Motorola",ge="Opera",Pe="Samsung",He="Sharp",ve="Sony",w="Xiaomi",H="Zebra",J="Facebook",Ie="Chromium OS",gt="Mac OS",dn=" Browser",tr=function(Jn){for(var nr={},gn=0;gn<Jn.length;gn++)nr[Jn[gn].toUpperCase()]=Jn[gn];return nr},oo=function(Jn,nr){return typeof Jn===c&&Yo(nr).indexOf(Yo(Jn))!==-1},Yo=function(Jn){return Jn.toLowerCase()},_E=function(Jn,nr){if(typeof Jn===c)return Jn=Jn.replace(/^\s\s*/,""),typeof nr===s?Jn:Jn.substring(0,500)},kh=function(Jn,nr){for(var gn,qi,Aa,jn,Sl,Ut,Oa=0;Oa<nr.length&&!Sl;){var Lh=nr[Oa],Pc=nr[Oa+1];for(gn=qi=0;gn<Lh.length&&!Sl&&Lh[gn];)if(Sl=Lh[gn++].exec(Jn))for(Aa=0;Aa<Pc.length;Aa++)Ut=Sl[++qi],typeof(jn=Pc[Aa])===o&&jn.length>0?jn.length===2?typeof jn[1]==i?this[jn[0]]=jn[1].call(this,Ut):this[jn[0]]=jn[1]:jn.length===3?typeof jn[1]!==i||jn[1].exec&&jn[1].test?this[jn[0]]=Ut?Ut.replace(jn[1],jn[2]):r:this[jn[0]]=Ut?jn[1].call(this,Ut,jn[2]):r:jn.length===4&&(this[jn[0]]=Ut?jn[3].call(this,Ut.replace(jn[1],jn[2])):r):this[jn]=Ut||r;Oa+=2}},em=function(Jn,nr){for(var gn in nr)if(typeof nr[gn]===o&&nr[gn].length>0){for(var qi=0;qi<nr[gn].length;qi++)if(oo(nr[gn][qi],Jn))return gn==="?"?r:gn}else if(oo(nr[gn],Jn))return gn==="?"?r:gn;return nr.hasOwnProperty("*")?nr["*"]:Jn},WT={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},GT={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,ge+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[m,ge+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[m,ge]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[m,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[m,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[m,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[m,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+Ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[m,"Smart Lenovo "+Ee]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+Ee],y],[/\bfocus\/([\w\.]+)/i],[y,[m,Ct+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,ge+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,ge+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI"+dn]],[/fxios\/([\w\.-]+)/i],[y,[m,Ct]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[m,"360"]],[/\b(qq)\/([\w\.]+)/i],[[m,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1"+dn],y],[/samsungbrowser\/([\w\.]+)/i],[y,[m,Pe+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[m,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[m,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[m,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[m],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,J],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[m,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,Re+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,Re+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+Ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,em,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[m,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,Ct+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[m,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,Yo]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,"",Yo]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,Yo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[v,Pe],[E,V]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[p,[v,Pe],[E,O]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[v,z],[E,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[v,z],[E,V]],[/(macintosh);/i],[p,[v,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[v,He],[E,O]],[/(?:honor)([-\w ]+)[;\)]/i],[p,[v,"Honor"],[E,O]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[v,ut],[E,V]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[v,ut],[E,O]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[p,/_/g," "],[v,w],[E,O]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[v,w],[E,V]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[v,"OPPO"],[E,O]],[/\b(opd2\d{3}a?) bui/i],[p,[v,"OPPO"],[E,V]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[v,"Vivo"],[E,O]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[p,[v,"Realme"],[E,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[v,Hr],[E,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[v,Hr],[E,V]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[v,Yt],[E,V]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[v,Yt],[E,O]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[v,"Lenovo"],[E,V]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[v,"Nokia"],[E,O]],[/(pixel c)\b/i],[p,[v,bt],[E,V]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[v,bt],[E,O]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[v,ve],[E,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[v,ve],[E,V]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[v,"OnePlus"],[E,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[v,Q],[E,V]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[v,Q],[E,O]],[/(playbook);[-\w\),; ]+(rim)/i],[p,v,[E,V]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[v,he],[E,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[v,re],[E,V]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[v,re],[E,O]],[/(nexus 9)/i],[p,[v,"HTC"],[E,V]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[p,/_/g," "],[E,O]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[p,[v,"TCL"],[E,V]],[/(itel) ((\w+))/i],[[v,Yo],p,[E,em,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[v,"Acer"],[E,V]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[v,"Meizu"],[E,O]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[p,[v,"Ulefone"],[E,O]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[p,[v,"Energizer"],[E,O]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[p,[v,"Cat"],[E,O]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[p,[v,"Smartfren"],[E,O]],[/droid.+; (a(?:015|06[35]|142p?))/i],[p,[v,"Nothing"],[E,O]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,p,[E,O]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,p,[E,V]],[/(surface duo)/i],[p,[v,Ht],[E,V]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[v,"Fairphone"],[E,O]],[/(u304aa)/i],[p,[v,"AT&T"],[E,O]],[/\bsie-(\w*)/i],[p,[v,"Siemens"],[E,O]],[/\b(rct\w+) b/i],[p,[v,"RCA"],[E,V]],[/\b(venue[\d ]{2,7}) b/i],[p,[v,"Dell"],[E,V]],[/\b(q(?:mv|ta)\w+) b/i],[p,[v,"Verizon"],[E,V]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[v,"Barnes & Noble"],[E,V]],[/\b(tm\d{3}\w+) b/i],[p,[v,"NuVision"],[E,V]],[/\b(k88) b/i],[p,[v,"ZTE"],[E,V]],[/\b(nx\d{3}j) b/i],[p,[v,"ZTE"],[E,O]],[/\b(gen\d{3}) b.+49h/i],[p,[v,"Swiss"],[E,O]],[/\b(zur\d{3}) b/i],[p,[v,"Swiss"],[E,V]],[/\b((zeki)?tb.*\b) b/i],[p,[v,"Zeki"],[E,V]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],p,[E,V]],[/\b(ns-?\w{0,9}) b/i],[p,[v,"Insignia"],[E,V]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[v,"NextBook"],[E,V]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],p,[E,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],p,[E,O]],[/\b(ph-1) /i],[p,[v,"Essential"],[E,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[v,"Envizen"],[E,V]],[/\b(trio[-\w\. ]+) b/i],[p,[v,"MachSpeed"],[E,V]],[/\btu_(1491) b/i],[p,[v,"Rotor"],[E,V]],[/(shield[\w ]+) b/i],[p,[v,"Nvidia"],[E,V]],[/(sprint) (\w+)/i],[v,p,[E,O]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[v,Ht],[E,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[v,H],[E,V]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[v,H],[E,O]],[/smart-tv.+(samsung)/i],[v,[E,U]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[v,Pe],[E,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,Yt],[E,U]],[/(apple) ?tv/i],[v,[p,z+" TV"],[E,U]],[/crkey/i],[[p,Re+"cast"],[v,bt],[E,U]],[/droid.+aft(\w+)( bui|\))/i],[p,[v,Q],[E,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[v,He],[E,U]],[/(bravia[\w ]+)( bui|\))/i],[p,[v,ve],[E,U]],[/(mitv-\w{5}) bui/i],[p,[v,w],[E,U]],[/Hbbtv.*(technisat) (.*);/i],[v,p,[E,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,_E],[p,_E],[E,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,p,[E,A]],[/droid.+; (shield) bui/i],[p,[v,"Nvidia"],[E,A]],[/(playstation [345portablevi]+)/i],[p,[v,ve],[E,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[v,Ht],[E,A]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[p,[v,Pe],[E,G]],[/((pebble))app/i],[v,p,[E,G]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[v,z],[E,G]],[/droid.+; (glass) \d/i],[p,[v,bt],[E,G]],[/droid.+; (wt63?0{2,3})\)/i],[p,[v,H],[E,G]],[/droid.+; (glass) \d/i],[p,[v,bt],[E,G]],[/(pico) (4|neo3(?: link|pro)?)/i],[v,p,[E,G]],[/; (quest( \d| pro)?)/i],[p,[v,J],[E,G]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[E,Z]],[/(aeobc)\b/i],[p,[v,Q],[E,Z]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[p,[E,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[E,V]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,V]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,O]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[m,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[m,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[m,[y,em,WT]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,em,WT],[m,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,gt],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,y],[/\(bb(10);/i],[y,[m,he]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,Ct+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,Re+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,Ie],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[m,y]]},ao=function(Jn,nr){if(typeof Jn===o&&(nr=Jn,Jn=r),!(this instanceof ao))return new ao(Jn,nr).getResult();var gn=typeof n!==s&&n.navigator?n.navigator:r,qi=Jn||(gn&&gn.userAgent?gn.userAgent:""),Aa=gn&&gn.userAgentData?gn.userAgentData:r,jn=nr?function(Ut,Oa){var Lh={};for(var Pc in Ut)Oa[Pc]&&Oa[Pc].length%2==0?Lh[Pc]=Oa[Pc].concat(Ut[Pc]):Lh[Pc]=Ut[Pc];return Lh}(GT,nr):GT,Sl=gn&&gn.userAgent==qi;return this.getBrowser=function(){var Ut={};return Ut[m]=r,Ut[y]=r,kh.call(Ut,qi,jn.browser),Ut[l]=function(Oa){return typeof Oa===c?Oa.replace(/[^\d\.]/g,"").split(".")[0]:r}(Ut[y]),Sl&&gn&&gn.brave&&typeof gn.brave.isBrave==i&&(Ut[m]="Brave"),Ut},this.getCPU=function(){var Ut={};return Ut[D]=r,kh.call(Ut,qi,jn.cpu),Ut},this.getDevice=function(){var Ut={};return Ut[v]=r,Ut[p]=r,Ut[E]=r,kh.call(Ut,qi,jn.device),Sl&&!Ut[E]&&Aa&&Aa.mobile&&(Ut[E]=O),Sl&&Ut[p]=="Macintosh"&&gn&&typeof gn.standalone!==s&&gn.maxTouchPoints&&gn.maxTouchPoints>2&&(Ut[p]="iPad",Ut[E]=V),Ut},this.getEngine=function(){var Ut={};return Ut[m]=r,Ut[y]=r,kh.call(Ut,qi,jn.engine),Ut},this.getOS=function(){var Ut={};return Ut[m]=r,Ut[y]=r,kh.call(Ut,qi,jn.os),Sl&&!Ut[m]&&Aa&&Aa.platform&&Aa.platform!="Unknown"&&(Ut[m]=Aa.platform.replace(/chrome os/i,Ie).replace(/macos/i,gt)),Ut},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return qi},this.setUA=function(Ut){return qi=typeof Ut===c&&Ut.length>500?_E(Ut,500):Ut,this},this.setUA(qi),this};ao.VERSION="0.7.40",ao.BROWSER=tr([m,y,l]),ao.CPU=tr([D]),ao.DEVICE=tr([p,v,E,A,O,U,V,G,Z]),ao.ENGINE=ao.OS=tr([m,y]),e.exports&&(t=e.exports=ao),t.UAParser=ao;var vl=typeof n!==s&&(n.jQuery||n.Zepto);if(vl&&!vl.ua){var HT=new ao;vl.ua=HT.getResult(),vl.ua.get=function(){return HT.getUA()},vl.ua.set=function(Jn){HT.setUA(Jn);var nr=HT.getResult();for(var gn in nr)vl.ua[gn]=nr[gn]}}})(typeof window=="object"?window:g)})(WR,WR.exports);var R2=S(WR.exports),CP=cd.clear;qt({global:!0,bind:!0,forced:ie.clearImmediate!==CP},{clearImmediate:CP});var RP=ie,w2=le,b2=Ue,I2=Eu,A2=zr,O2=yr,N2=gs,P2=RP.Function,D2=/MSIE .\./.test(A2)||I2==="BUN"&&function(){var e=RP.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),k2=qt,wP=ie,bP=cd.set,L2=function(e,t){var n=1;return D2?function(r,i){var s=N2(arguments.length,1)>n,o=b2(r)?r:P2(r),c=s?O2(arguments,n):[],l=s?function(){w2(o,this,c)}:o;return e(l)}:e},IP=wP.setImmediate?L2(bP):bP;k2({global:!0,bind:!0,forced:wP.setImmediate!==IP},{setImmediate:IP});var AP=S(Jr.setImmediate),x2=ie,M2=ng,U2=Bn,V2=gs,j2=Ge;qt({global:!0,dontCallGetSet:!0,forced:C(function(){return j2&&Object.getOwnPropertyDescriptor(x2,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){V2(arguments.length,1),M2(U2(e))}});var OP=S(Jr.queueMicrotask);function NP(e,t){return function(){return e.apply(t,arguments)}}const{toString:F2}=Object.prototype,{getPrototypeOf:GR}=Object,{iterator:GS,toStringTag:PP}=Symbol,HS=(HR=Object.create(null),e=>{const t=F2.call(e);return HR[t]||(HR[t]=t.slice(8,-1).toLowerCase())});var HR;const pa=e=>(e=e.toLowerCase(),t=>HS(t)===e),KS=e=>t=>typeof t===e,{isArray:cf}=Array,pg=KS("undefined"),DP=pa("ArrayBuffer"),B2=KS("string"),Ss=KS("function"),kP=KS("number"),zS=e=>e!==null&&typeof e=="object",YS=e=>{if(HS(e)!=="object")return!1;const t=GR(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||PP in e||GS in e)},W2=pa("Date"),G2=pa("File"),H2=pa("Blob"),K2=pa("FileList"),z2=pa("URLSearchParams"),[Y2,q2,X2,J2]=["ReadableStream","Request","Response","Headers"].map(pa);function fg(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),cf(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let c;for(n=0;n<o;n++)c=s[n],t.call(null,e[c],c,e)}}function LP(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const oh=TP!==void 0?TP:typeof self<"u"?self:typeof window<"u"?window:globalThis,xP=e=>!pg(e)&&e!==oh,Q2=(KR=typeof Uint8Array<"u"&&GR(Uint8Array),e=>KR&&e instanceof KR);var KR;const Z2=pa("HTMLFormElement"),MP=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),$2=pa("RegExp"),UP=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};fg(n,(i,s)=>{let o;(o=t(i,s,e))!==!1&&(r[s]=o||i)}),Object.defineProperties(e,r)},eW=pa("AsyncFunction"),VP=(jP=typeof AP=="function",FP=Ss(oh.postMessage),jP?AP:FP?(zR="axios@".concat(Math.random()),qS=[],oh.addEventListener("message",e=>{let{source:t,data:n}=e;t===oh&&n===zR&&qS.length&&qS.shift()()},!1),e=>{qS.push(e),oh.postMessage(zR,"*")}):e=>setTimeout(e));var jP,FP,zR,qS;const tW=OP!==void 0?OP.bind(oh):typeof process<"u"&&process.nextTick||VP;var Me={isArray:cf,isArrayBuffer:DP,isBuffer:function(e){return e!==null&&!pg(e)&&e.constructor!==null&&!pg(e.constructor)&&Ss(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ss(e.append)&&((t=HS(e))==="formdata"||t==="object"&&Ss(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&DP(e.buffer),t},isString:B2,isNumber:kP,isBoolean:e=>e===!0||e===!1,isObject:zS,isPlainObject:YS,isReadableStream:Y2,isRequest:q2,isResponse:X2,isHeaders:J2,isUndefined:pg,isDate:W2,isFile:G2,isBlob:H2,isRegExp:$2,isFunction:Ss,isStream:e=>zS(e)&&Ss(e.pipe),isURLSearchParams:z2,isTypedArray:Q2,isFileList:K2,forEach:fg,merge:function e(){const{caseless:t}=xP(this)&&this||{},n={},r=(i,s)=>{const o=t&&LP(n,s)||s;YS(n[o])&&YS(i)?n[o]=e(n[o],i):YS(i)?n[o]=e({},i):cf(i)?n[o]=i.slice():n[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&fg(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return fg(t,(i,s)=>{n&&Ss(i)?e[s]=NP(i,n):e[s]=i},{allOwnKeys:r}),e},trim:e=>ni(e)?ni(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,o;const c={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],r&&!r(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=n!==!1&&GR(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:HS,kindOfTest:pa,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(cf(e))return e;let t=e.length;if(!kP(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[GS]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:Z2,hasOwnProperty:MP,hasOwnProp:MP,reduceDescriptors:UP,freezeMethods:e=>{UP(e,(t,n)=>{if(Ss(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];Ss(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach(s=>{n[s]=!0})};return cf(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:LP,global:oh,isContextDefined:xP,isSpecCompliantForm:function(e){return!!(e&&Ss(e.append)&&e[PP]==="FormData"&&e[GS])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(zS(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const s=cf(r)?[]:{};return fg(r,(o,c)=>{const l=n(o,i+1);!pg(l)&&(s[c]=l)}),t[i]=void 0,s}}return r};return n(e,0)},isAsyncFn:eW,isThenable:e=>e&&(zS(e)||Ss(e))&&Ss(e.then)&&Ss(e.catch),setImmediate:VP,asap:tW,isIterable:e=>e!=null&&Ss(e[GS])};function tn(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Me.inherits(tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Me.toJSONObject(this.config),code:this.code,status:this.status}}});const BP=tn.prototype,WP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{WP[e]={value:e}}),Object.defineProperties(tn,WP),Object.defineProperty(BP,"isAxiosError",{value:!0}),tn.from=(e,t,n,r,i,s)=>{const o=Object.create(BP);return Me.toFlatObject(e,o,function(c){return c!==Error.prototype},c=>c!=="isAxiosError"),tn.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function YR(e){return Me.isPlainObject(e)||Me.isArray(e)}function GP(e){return Me.endsWith(e,"[]")?e.slice(0,-2):e}function HP(e,t,n){return e?e.concat(t).map(function(r,i){return r=GP(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}const nW=Me.toFlatObject(Me,{},null,function(e){return/^is[A-Z]/.test(e)});function XS(e,t,n){if(!Me.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Me.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,y){return!Me.isUndefined(y[v])})).metaTokens,i=n.visitor||p,s=n.dots,o=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&Me.isSpecCompliantForm(t);if(!Me.isFunction(i))throw new TypeError("visitor must be a function");function l(v){if(v===null)return"";if(Me.isDate(v))return v.toISOString();if(!c&&Me.isBlob(v))throw new tn("Blob is not supported. Use a Buffer instead.");return Me.isArrayBuffer(v)||Me.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function p(v,y,D){let A=v;if(v&&!D&&typeof v=="object"){if(Me.endsWith(y,"{}"))y=r?y:y.slice(0,-2),v=JSON.stringify(v);else if(Me.isArray(v)&&function(O){return Me.isArray(O)&&!O.some(YR)}(v)||(Me.isFileList(v)||Me.endsWith(y,"[]"))&&(A=Me.toArray(v)))return y=GP(y),A.forEach(function(O,V){!Me.isUndefined(O)&&O!==null&&t.append(o===!0?HP([y],V,s):o===null?y:y+"[]",l(O))}),!1}return!!YR(v)||(t.append(HP(D,y,s),l(v)),!1)}const m=[],E=Object.assign(nW,{defaultVisitor:p,convertValue:l,isVisitable:YR});if(!Me.isObject(e))throw new TypeError("data must be an object");return function v(y,D){if(!Me.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+D.join("."));m.push(y),Me.forEach(y,function(A,O){(!(Me.isUndefined(A)||A===null)&&i.call(t,A,Me.isString(O)?ni(O).call(O):O,D,E))===!0&&v(A,D?D.concat(O):[O])}),m.pop()}}(e),t}function KP(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function qR(e,t){this._pairs=[],e&&XS(e,this,t)}const zP=qR.prototype;function rW(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function YP(e,t,n){if(!t)return e;const r=n&&n.encode||rW;Me.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):Me.isURLSearchParams(t)?t.toString():new qR(t,n).toString(r),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}zP.append=function(e,t){this._pairs.push([e,t])},zP.toString=function(e){const t=e?function(n){return e.call(this,n,KP)}:KP;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var qP=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Me.forEach(this.handlers,function(t){t!==null&&e(t)})}},XP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},JP={exports:{}},iW=qt,sW=Ge,QP=xi.f;iW({target:"Object",stat:!0,forced:Object.defineProperty!==QP,sham:!sW},{defineProperty:QP});var ZP=Jr.Object,oW=JP.exports=function(e,t,n){return ZP.defineProperty(e,t,n)};ZP.defineProperty.sham&&(oW.sham=!0);var $P=S(JP.exports),aW=TypeError,eD=Jo,cW=Or,lW=pr,dW=An("species"),tD=Array,uW=function(e){var t;return eD(e)&&(t=e.constructor,(cW(t)&&(t===tD||eD(t.prototype))||lW(t)&&(t=t[dW])===null)&&(t=void 0)),t===void 0?tD:t},nD=function(e,t){return new(uW(e))(t===0?0:t)},hW=C,pW=Ti,fW=An("species"),rD=function(e){return pW>=51||!hW(function(){var t=[];return(t.constructor={})[fW]=function(){return{foo:1}},t[e](Boolean).foo!==1})},mW=qt,_W=C,gW=Jo,EW=pr,vW=go,SW=Ya,iD=function(e){if(e>9007199254740991)throw aW("Maximum allowed index exceeded");return e},sD=dR,yW=nD,TW=rD,CW=Ti,oD=An("isConcatSpreadable"),RW=CW>=51||!_W(function(){var e=[];return e[oD]=!1,e.concat()[0]!==e}),wW=function(e){if(!EW(e))return!1;var t=e[oD];return t!==void 0?!!t:gW(e)};mW({target:"Array",proto:!0,forced:!RW||!TW("concat")},{concat:function(e){var t,n,r,i,s,o=vW(this),c=yW(o,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(wW(s=t===-1?o:arguments[t]))for(i=SW(s),iD(l+i),n=0;n<i;n++,l++)n in s&&sD(c,l,s[n]);else iD(l+1),sD(c,l++,s);return c.length=l,c}});var aD={},bW=Se,IW=ps,cD=Zo.f,AW=yr,lD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];aD.f=function(e){return lD&&bW(e)==="Window"?function(t){try{return cD(t)}catch{return AW(lD)}}(e):cD(IW(e))};var lf={},OW=An;lf.f=OW;var dD=Jr,NW=fr,PW=lf,DW=xi.f,Tr=function(e){var t=dD.Symbol||(dD.Symbol={});NW(t,e)||DW(t,e,{value:PW.f(e)})},kW=We,LW=Ar,xW=An,MW=aa,uD=function(){var e=LW("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=xW("toPrimitive");t&&!t[r]&&MW(t,r,function(i){return kW(n,this)},{})},UW=Ha,VW=vn,jW=go,FW=Ya,BW=nD,hD=B([].push),WW=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,s=e===6,o=e===7,c=e===5||s;return function(l,p,m,E){for(var v,y,D=jW(l),A=VW(D),O=FW(A),V=UW(p,m),U=0,G=E||BW,Z=t?G(l,O):n||o?G(l,0):void 0;O>U;U++)if((c||U in A)&&(y=V(v=A[U],U,D),e))if(t)Z[U]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return U;case 2:hD(Z,v)}else switch(e){case 4:return!1;case 7:hD(Z,v)}return s?-1:r||i?i:Z}},pD={forEach:WW(0)},JS=qt,mg=ie,XR=We,GW=B,df=Ge,uf=mo,HW=C,fi=fr,KW=q,JR=Zr,QS=ps,QR=On,zW=Mi,ZR=ot,hf=Au,fD=wi,YW=Zo,mD=aD,qW=ql,_D=xe,gD=xi,XW=ec,ED=Ae,vD=aa,JW=rc,$R=Fc,SD=Gs,yD=Nl,QW=An,ZW=lf,$W=Tr,eG=uD,tG=Co,TD=nc,ZS=pD.forEach,ys=zl("hidden"),$S="Symbol",_g="prototype",nG=TD.set,CD=TD.getterFor($S),fa=Object[_g],ah=mg.Symbol,ey=ah&&ah[_g],rG=mg.RangeError,iG=mg.TypeError,ew=mg.QObject,RD=_D.f,ch=gD.f,wD=mD.f,sG=ED.f,bD=GW([].push),al=$R("symbols"),gg=$R("op-symbols"),oG=$R("wks"),tw=!ew||!ew[_g]||!ew[_g].findChild,ID=function(e,t,n){var r=RD(fa,t);r&&delete fa[t],ch(e,t,n),r&&e!==fa&&ch(fa,t,r)},nw=df&&HW(function(){return hf(ch({},"a",{get:function(){return ch(this,"a",{value:7}).a}})).a!==7})?ID:ch,rw=function(e,t){var n=al[e]=hf(ey);return nG(n,{type:$S,tag:e,description:t}),df||(n.description=t),n},ty=function(e,t,n){e===fa&&ty(gg,t,n),JR(e);var r=QR(t);return JR(n),fi(al,r)?(n.enumerable?(fi(e,ys)&&e[ys][r]&&(e[ys][r]=!1),n=hf(n,{enumerable:ZR(0,!1)})):(fi(e,ys)||ch(e,ys,ZR(1,hf(null))),e[ys][r]=!0),nw(e,r,n)):ch(e,r,n)},iw=function(e,t){JR(e);var n=QS(t),r=fD(n).concat(PD(n));return ZS(r,function(i){df&&!XR(AD,n,i)||ty(e,i,n[i])}),e},AD=function(e){var t=QR(e),n=XR(sG,this,t);return!(this===fa&&fi(al,t)&&!fi(gg,t))&&(!(n||!fi(this,t)||!fi(al,t)||fi(this,ys)&&this[ys][t])||n)},OD=function(e,t){var n=QS(e),r=QR(t);if(n!==fa||!fi(al,r)||fi(gg,r)){var i=RD(n,r);return!i||!fi(al,r)||fi(n,ys)&&n[ys][r]||(i.enumerable=!0),i}},ND=function(e){var t=wD(QS(e)),n=[];return ZS(t,function(r){fi(al,r)||fi(SD,r)||bD(n,r)}),n},PD=function(e){var t=e===fa,n=wD(t?gg:QS(e)),r=[];return ZS(n,function(i){!fi(al,i)||t&&!fi(fa,i)||bD(r,al[i])}),r};uf||(ah=function(){if(KW(ey,this))throw new iG("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?zW(arguments[0]):void 0,t=yD(e),n=function(r){var i=this===void 0?mg:this;i===fa&&XR(n,gg,r),fi(i,ys)&&fi(i[ys],t)&&(i[ys][t]=!1);var s=ZR(1,r);try{nw(i,t,s)}catch(o){if(!(o instanceof rG))throw o;ID(i,t,s)}};return df&&tw&&nw(fa,t,{configurable:!0,set:n}),rw(t,e)},vD(ey=ah[_g],"toString",function(){return CD(this).tag}),vD(ah,"withoutSetter",function(e){return rw(yD(e),e)}),ED.f=AD,gD.f=ty,XW.f=iw,_D.f=OD,YW.f=mD.f=ND,qW.f=PD,ZW.f=function(e){return rw(QW(e),e)},df&&JW(ey,"description",{configurable:!0,get:function(){return CD(this).description}})),JS({global:!0,wrap:!0,forced:!uf,sham:!uf},{Symbol:ah}),ZS(fD(oG),function(e){$W(e)}),JS({target:$S,stat:!0,forced:!uf},{useSetter:function(){tw=!0},useSimple:function(){tw=!1}}),JS({target:"Object",stat:!0,forced:!uf,sham:!df},{create:function(e,t){return t===void 0?hf(e):iw(hf(e),t)},defineProperty:ty,defineProperties:iw,getOwnPropertyDescriptor:OD}),JS({target:"Object",stat:!0,forced:!uf},{getOwnPropertyNames:ND}),eG(),tG(ah,$S),SD[ys]=!0;var DD=mo&&!!Symbol.for&&!!Symbol.keyFor,aG=qt,cG=Ar,lG=fr,dG=Mi,kD=Fc,uG=DD,sw=kD("string-to-symbol-registry"),hG=kD("symbol-to-string-registry");aG({target:"Symbol",stat:!0,forced:!uG},{for:function(e){var t=dG(e);if(lG(sw,t))return sw[t];var n=cG("Symbol")(t);return sw[t]=n,hG[n]=t,n}});var pG=qt,fG=fr,mG=ja,_G=fn,gG=DD,LD=Fc("symbol-to-string-registry");pG({target:"Symbol",stat:!0,forced:!gG},{keyFor:function(e){if(!mG(e))throw new TypeError(_G(e)+" is not a symbol");if(fG(LD,e))return LD[e]}});var xD=Jo,EG=Ue,MD=Se,vG=Mi,UD=B([].push),SG=qt,VD=Ar,jD=le,yG=We,Eg=B,FD=C,BD=Ue,WD=ja,GD=yr,TG=function(e){if(EG(e))return e;if(xD(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?UD(n,i):typeof i!="number"&&MD(i)!=="Number"&&MD(i)!=="String"||UD(n,vG(i))}var s=n.length,o=!0;return function(c,l){if(o)return o=!1,l;if(xD(this))return l;for(var p=0;p<s;p++)if(n[p]===c)return l}}},CG=mo,RG=String,Ed=VD("JSON","stringify"),ny=Eg(/./.exec),HD=Eg("".charAt),wG=Eg("".charCodeAt),bG=Eg("".replace),IG=Eg(1 .toString),AG=/[\uD800-\uDFFF]/g,KD=/^[\uD800-\uDBFF]$/,zD=/^[\uDC00-\uDFFF]$/,YD=!CG||FD(function(){var e=VD("Symbol")("stringify detection");return Ed([e])!=="[null]"||Ed({a:e})!=="{}"||Ed(Object(e))!=="{}"}),qD=FD(function(){return Ed("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ed("\uDEAD")!=='"\\udead"'}),OG=function(e,t){var n=GD(arguments),r=TG(t);if(BD(r)||e!==void 0&&!WD(e))return n[1]=function(i,s){if(BD(r)&&(s=yG(r,this,RG(i),s)),!WD(s))return s},jD(Ed,null,n)},NG=function(e,t,n){var r=HD(n,t-1),i=HD(n,t+1);return ny(KD,e)&&!ny(zD,i)||ny(zD,e)&&!ny(KD,r)?"\\u"+IG(wG(e,0),16):e};Ed&&SG({target:"JSON",stat:!0,forced:YD||qD},{stringify:function(e,t,n){var r=GD(arguments),i=jD(YD?OG:Ed,null,r);return qD&&typeof i=="string"?bG(i,AG,NG):i}});var XD=ql,PG=go;qt({target:"Object",stat:!0,forced:!mo||C(function(){XD.f(1)})},{getOwnPropertySymbols:function(e){var t=XD.f;return t?t(PG(e)):[]}}),Tr("asyncIterator"),Tr("hasInstance"),Tr("isConcatSpreadable"),Tr("iterator"),Tr("match"),Tr("matchAll"),Tr("replace"),Tr("search"),Tr("species"),Tr("split");var DG=uD;Tr("toPrimitive"),DG();var kG=Ar,LG=Co;Tr("toStringTag"),LG(kG("Symbol"),"Symbol"),Tr("unscopables"),Co(ie.JSON,"JSON",!0);var xG=Jr.Symbol,MG=An,UG=xi.f,JD=MG("metadata"),QD=Function.prototype;QD[JD]===void 0&&UG(QD,JD,{value:null}),Tr("asyncDispose"),Tr("dispose"),Tr("metadata");var VG=xG,jG=B,ow=Ar("Symbol"),FG=ow.keyFor,BG=jG(ow.prototype.valueOf),ZD=ow.isRegisteredSymbol||function(e){try{return FG(BG(e))!==void 0}catch{return!1}};qt({target:"Symbol",stat:!0},{isRegisteredSymbol:ZD});for(var WG=Fc,$D=Ar,GG=B,HG=ja,KG=An,ry=$D("Symbol"),ek=ry.isWellKnownSymbol,tk=$D("Object","getOwnPropertyNames"),zG=GG(ry.prototype.valueOf),nk=WG("wks"),aw=0,rk=tk(ry),YG=rk.length;aw<YG;aw++)try{var ik=rk[aw];HG(ry[ik])&&KG(ik)}catch{}var sk=function(e){if(ek&&ek(e))return!0;try{for(var t=zG(e),n=0,r=tk(nk),i=r.length;n<i;n++)if(nk[r[n]]==t)return!0}catch{}return!1};qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:sk}),Tr("customMatcher"),Tr("observable"),qt({target:"Symbol",stat:!0},{isRegistered:ZD}),qt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:sk}),Tr("matcher"),Tr("metadataKey"),Tr("patternMatch"),Tr("replaceAll");var pf=S(VG),ok=S(lf.f("iterator"));function vg(e){return vg=typeof pf=="function"&&typeof ok=="symbol"?function(t){return typeof t}:function(t){return t&&typeof pf=="function"&&t.constructor===pf&&t!==pf.prototype?"symbol":typeof t},vg(e)}var qG=S(lf.f("toPrimitive"));function XG(e){var t=function(n,r){if(vg(n)!="object"||!n)return n;var i=n[qG];if(i!==void 0){var s=i.call(n,r);if(vg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return vg(t)=="symbol"?t:t+""}function x(e,t,n){return(t=XG(t))in e?$P(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ak=S(X9),JG={isBrowser:!0,classes:{URLSearchParams:ak!==void 0?ak:qR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const cw=typeof window<"u"&&typeof document<"u",lw=typeof navigator=="object"&&navigator||void 0,QG=cw&&(!lw||["ReactNative","NativeScript","NS"].indexOf(lw.product)<0),ZG=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$G=cw&&window.location.href||"http://localhost";function ck(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function lk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ck(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ck(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Wi=lk(lk({},Object.freeze({__proto__:null,hasBrowserEnv:cw,hasStandardBrowserEnv:QG,hasStandardBrowserWebWorkerEnv:ZG,navigator:lw,origin:$G})),JG),eH=Zr,tH=We,nH=fr,rH=q,iH=function(){var e=eH(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},dk=RegExp.prototype,uk=function(e){var t=e.flags;return t!==void 0||"flags"in dk||nH(e,"flags")||!rH(dk,e)?t:tH(iH,e)},sH=JC.charAt,hk=We,oH=Zr,aH=Ue,cH=Se,lH=/./.exec,dH=TypeError,uH=qt,pk=We,fk=je,hH=ju,iy=Mp,mk=Kr,_k=av,Sg=Mi,pH=Zr,fH=pr,mH=Se,_H=xm,gk=uk,gH=Xi,EH=C,vH=nl,SH=function(e,t,n){return t+(n?sH(e,t).length:1)},yH=function(e,t){var n=e.exec;if(aH(n)){var r=hk(n,e,t);return r!==null&&oH(r),r}if(cH(e)==="RegExp")return hk(lH,e,t);throw new dH("RegExp#exec called on incompatible receiver")},Ek=nc,TH=An("matchAll"),vk="RegExp String",Sk=vk+" Iterator",CH=Ek.set,RH=Ek.getterFor(Sk),wH=TypeError,dw=fk("".indexOf),sy=fk("".matchAll),uw=!!sy&&!EH(function(){sy("a",/./)}),bH=hH(function(e,t,n,r){CH(this,{type:Sk,regexp:e,string:t,global:n,unicode:r,done:!1})},vk,function(){var e=RH(this);if(e.done)return iy(void 0,!0);var t=e.regexp,n=e.string,r=yH(t,n);return r===null?(e.done=!0,iy(void 0,!0)):e.global?(Sg(r[0])===""&&(t.lastIndex=SH(n,_k(t.lastIndex),e.unicode)),iy(r,!1)):(e.done=!0,iy(r,!1))}),yk=function(e){var t,n,r,i=pH(this),s=Sg(e),o=vH(i,RegExp),c=Sg(gk(i));return t=new o(o===RegExp?i.source:i,c),n=!!~dw(c,"g"),r=!!~dw(c,"u"),t.lastIndex=_k(i.lastIndex),new bH(t,s,n,r)};uH({target:"String",proto:!0,forced:uw},{matchAll:function(e){var t,n,r,i,s=mk(this);if(fH(e)){if(_H(e)&&(t=Sg(mk(gk(e))),!~dw(t,"g")))throw new wH("`.matchAll` does not allow non-global regexes");if(uw)return sy(s,e);if((r=gH(e,TH))===void 0&&mH(e)==="RegExp"&&(r=yk),r)return pk(r,e,s)}else if(uw)return sy(s,e);return n=Sg(s),i=new RegExp(e,"g"),pk(yk,i,n)}});var IH=Qi("String","matchAll"),AH=q,OH=IH,hw=String.prototype,NH=function(e){var t=e.matchAll;return typeof e=="string"||e===hw||AH(hw,e)&&t===hw.matchAll?OH:t},PH=S(NH);function Tk(e){function t(n,r,i,s){let o=n[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),l=s>=n.length;return o=!o&&Me.isArray(i)?i.length:o,l?(Me.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!c):(i[o]&&Me.isObject(i[o])||(i[o]=[]),t(n,r,i[o],s)&&Me.isArray(i[o])&&(i[o]=function(p){const m={},E=Object.keys(p);let v;const y=E.length;let D;for(v=0;v<y;v++)D=E[v],m[D]=p[D];return m}(i[o])),!c)}if(Me.isFormData(e)&&Me.isFunction(e.entries)){const n={};return Me.forEachEntry(e,(r,i)=>{t(function(s){return PH(Me).call(Me,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])}(r),i,n,0)}),n}return null}const pw={transitional:XP,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Me.isObject(e);if(i&&Me.isHTMLForm(e)&&(e=new FormData(e)),Me.isFormData(e))return r?JSON.stringify(Tk(e)):e;if(Me.isArrayBuffer(e)||Me.isBuffer(e)||Me.isStream(e)||Me.isFile(e)||Me.isBlob(e)||Me.isReadableStream(e))return e;if(Me.isArrayBufferView(e))return e.buffer;if(Me.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(o,c){return XS(o,new Wi.classes.URLSearchParams,Object.assign({visitor:function(l,p,m,E){return Wi.isNode&&Me.isBuffer(l)?(this.append(p,l.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},c))}(e,this.formSerializer).toString();if((s=Me.isFileList(e))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return XS(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(o,c,l){if(Me.isString(o))try{return(c||JSON.parse)(o),ni(Me).call(Me,o)}catch(p){if(p.name!=="SyntaxError")throw p}return(l||JSON.stringify)(o)}(e)):e}],transformResponse:[function(e){const t=this.transitional||pw.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Me.isResponse(e)||Me.isReadableStream(e))return e;if(e&&Me.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(i)throw s.name==="SyntaxError"?tn.from(s,tn.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wi.classes.FormData,Blob:Wi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Me.forEach(["delete","get","head","post","put","patch"],e=>{pw.headers[e]={}});var fw=pw;const DH=Me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ck=Symbol("internals");function yg(e){var t;return e&&ni(t=String(e)).call(t).toLowerCase()}function oy(e){return e===!1||e==null?e:Me.isArray(e)?e.map(oy):String(e)}function mw(e,t,n,r,i){return Me.isFunction(r)?r.call(this,t,n):(i&&(t=n),Me.isString(t)?Me.isString(r)?t.indexOf(r)!==-1:Me.isRegExp(r)?r.test(t):void 0:void 0)}class ay{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function s(l,p,m){const E=yg(p);if(!E)throw new Error("header name must be a non-empty string");const v=Me.findKey(i,E);(!v||i[v]===void 0||m===!0||m===void 0&&i[v]!==!1)&&(i[v||p]=oy(l))}const o=(l,p)=>Me.forEach(l,(m,E)=>s(m,E,p));if(Me.isPlainObject(t)||t instanceof this.constructor)o(t,n);else if(Me.isString(t)&&(t=ni(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ni(c=t).call(c)))o((l=>{const p={};let m,E,v;return l&&l.split(`
`).forEach(function(y){var D,A;v=y.indexOf(":"),m=ni(D=y.substring(0,v)).call(D).toLowerCase(),E=ni(A=y.substring(v+1)).call(A),!m||p[m]&&DH[m]||(m==="set-cookie"?p[m]?p[m].push(E):p[m]=[E]:p[m]=p[m]?p[m]+", "+E:E)}),p})(t),n);else if(Me.isObject(t)&&Me.isIterable(t)){let l,p,m={};for(const E of t){if(!Me.isArray(E))throw TypeError("Object iterator must return a key-value pair");m[p=E[0]]=(l=m[p])?Me.isArray(l)?[...l,E[1]]:[l,E[1]]:E[1]}o(m,n)}else t!=null&&s(n,t,r);var c;return this}get(t,n){if(t=yg(t)){const r=Me.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(s){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=c.exec(s);)o[l[1]]=l[2];return o}(i);if(Me.isFunction(n))return n.call(this,i,r);if(Me.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=yg(t)){const r=Me.findKey(this,t);return!(!r||this[r]===void 0||n&&!mw(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function s(o){if(o=yg(o)){const c=Me.findKey(r,o);!c||n&&!mw(0,r[c],c,n)||(delete r[c],i=!0)}}return Me.isArray(t)?t.forEach(s):s(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];t&&!mw(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const n=this,r={};return Me.forEach(this,(i,s)=>{var o;const c=Me.findKey(r,s);if(c)return n[c]=oy(i),void delete n[s];const l=t?function(p){return ni(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,E,v)=>E.toUpperCase()+v)}(s):ni(o=String(s)).call(o);l!==s&&delete n[s],n[l]=oy(i),r[l]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Me.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&Me.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[Ck]=this[Ck]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=yg(s);n[o]||(function(c,l){const p=Me.toCamelCase(" "+l);["get","set","has"].forEach(m=>{Object.defineProperty(c,m+p,{value:function(E,v,y){return this[m].call(this,l,E,v,y)},configurable:!0})})}(r,s),n[o]=!0)}return Me.isArray(t)?t.forEach(i):i(t),this}}ay.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Me.reduceDescriptors(ay.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),Me.freezeMethods(ay);var ma=ay;function _w(e,t){const n=this||fw,r=t||n,i=ma.from(r.headers);let s=r.data;return Me.forEach(e,function(o){s=o.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function Rk(e){return!(!e||!e.__CANCEL__)}function ff(e,t,n){tn.call(this,e??"canceled",tn.ERR_CANCELED,t,n),this.name="CanceledError"}function wk(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new tn("Request failed with status code "+n.status,[tn.ERR_BAD_REQUEST,tn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Me.inherits(ff,tn,{__CANCEL__:!0});const cy=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(s,o){s=s||10;const c=new Array(s),l=new Array(s);let p,m=0,E=0;return o=o!==void 0?o:1e3,function(v){const y=Date.now(),D=l[E];p||(p=y),c[m]=v,l[m]=y;let A=E,O=0;for(;A!==m;)O+=c[A++],A%=s;if(m=(m+1)%s,m===E&&(E=(E+1)%s),y-p<o)return;const V=D&&y-D;return V?Math.round(1e3*O/V):void 0}}(50,250);return function(s,o){let c,l,p=0,m=1e3/o;const E=function(v){p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,l&&(clearTimeout(l),l=null),s.apply(null,v)};return[function(){const v=Date.now(),y=v-p;for(var D=arguments.length,A=new Array(D),O=0;O<D;O++)A[O]=arguments[O];y>=m?E(A,v):(c=A,l||(l=setTimeout(()=>{l=null,E(c)},m-y)))},()=>c&&E(c)]}(s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,l=o-r,p=i(l);r=o,e({loaded:o,total:c,progress:c?o/c:void 0,bytes:l,rate:p||void 0,estimated:p&&c&&o<=c?(c-o)/p:void 0,event:s,lengthComputable:c!=null,[t?"download":"upload"]:!0})},n)},bk=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Ik=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Me.asap(()=>e(...n))};var kH=Wi.hasStandardBrowserEnv?((e,t)=>n=>(n=new MS(n,Wi.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new MS(Wi.origin),Wi.navigator&&/(msie|trident)/i.test(Wi.navigator.userAgent)):()=>!0,LH=Wi.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const o=[e+"="+encodeURIComponent(t)];Me.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Me.isString(r)&&o.push("path="+r),Me.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Ak(e,t,n){let r=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t);return e&&(r||n==0)?function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i}(e,t):t}function Ok(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const Nk=e=>e instanceof ma?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ok(Object(r),!0).forEach(function(i){x(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ok(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e):e;function lh(e,t){t=t||{};const n={};function r(p,m,E,v){return Me.isPlainObject(p)&&Me.isPlainObject(m)?Me.merge.call({caseless:v},p,m):Me.isPlainObject(m)?Me.merge({},m):Me.isArray(m)?m.slice():m}function i(p,m,E,v){return Me.isUndefined(m)?Me.isUndefined(p)?void 0:r(void 0,p,0,v):r(p,m,0,v)}function s(p,m){if(!Me.isUndefined(m))return r(void 0,m)}function o(p,m){return Me.isUndefined(m)?Me.isUndefined(p)?void 0:r(void 0,p):r(void 0,m)}function c(p,m,E){return E in t?r(p,m):E in e?r(void 0,p):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(p,m,E)=>i(Nk(p),Nk(m),0,!0)};return Me.forEach(Object.keys(Object.assign({},e,t)),function(p){const m=l[p]||i,E=m(e[p],t[p],p);Me.isUndefined(E)&&m!==c||(n[p]=E)}),n}var Pk=e=>{const t=lh({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:l}=t;if(t.headers=c=ma.from(c),t.url=YP(Ak(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&c.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Me.isFormData(r)){if(Wi.hasStandardBrowserEnv||Wi.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((n=c.getContentType())!==!1){const[p,...m]=n?n.split(";").map(E=>ni(E).call(E)).filter(Boolean):[];c.setContentType([p||"multipart/form-data",...m].join("; "))}}if(Wi.hasStandardBrowserEnv&&(i&&Me.isFunction(i)&&(i=i(t)),i||i!==!1&&kH(t.url))){const p=s&&o&&LH.read(o);p&&c.set(s,p)}return t},xH=typeof XMLHttpRequest<"u"&&function(e){return new Ve(function(t,n){const r=Pk(e);let i=r.data;const s=ma.from(r.headers).normalize();let o,c,l,p,m,{responseType:E,onUploadProgress:v,onDownloadProgress:y}=r;function D(){p&&p(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let A=new XMLHttpRequest;function O(){if(!A)return;const U=ma.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());wk(function(G){t(G),D()},function(G){n(G),D()},{data:E&&E!=="text"&&E!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:U,config:e,request:A}),A=null}A.open(r.method.toUpperCase(),r.url,!0),A.timeout=r.timeout,"onloadend"in A?A.onloadend=O:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(O)},A.onabort=function(){A&&(n(new tn("Request aborted",tn.ECONNABORTED,e,A)),A=null)},A.onerror=function(){n(new tn("Network Error",tn.ERR_NETWORK,e,A)),A=null},A.ontimeout=function(){let U=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const G=r.transitional||XP;r.timeoutErrorMessage&&(U=r.timeoutErrorMessage),n(new tn(U,G.clarifyTimeoutError?tn.ETIMEDOUT:tn.ECONNABORTED,e,A)),A=null},i===void 0&&s.setContentType(null),"setRequestHeader"in A&&Me.forEach(s.toJSON(),function(U,G){A.setRequestHeader(G,U)}),Me.isUndefined(r.withCredentials)||(A.withCredentials=!!r.withCredentials),E&&E!=="json"&&(A.responseType=r.responseType),y&&([l,m]=cy(y,!0),A.addEventListener("progress",l)),v&&A.upload&&([c,p]=cy(v),A.upload.addEventListener("progress",c),A.upload.addEventListener("loadend",p)),(r.cancelToken||r.signal)&&(o=U=>{A&&(n(!U||U.type?new ff(null,e,A):U),A.abort(),A=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const V=function(U){const G=/^([-+\w]{1,25})(:?\/\/|:)/.exec(U);return G&&G[1]||""}(r.url);V&&Wi.protocols.indexOf(V)===-1?n(new tn("Unsupported protocol "+V+":",tn.ERR_BAD_REQUEST,e)):A.send(i||null)})},MH=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController;const s=function(p){if(!r){r=!0,c();const m=p instanceof Error?p:this.reason;i.abort(m instanceof tn?m:new ff(m instanceof Error?m.message:m))}};let o=t&&setTimeout(()=>{o=null,s(new tn("timeout ".concat(t," of ms exceeded"),tn.ETIMEDOUT))},t);const c=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(p=>{p.unsubscribe?p.unsubscribe(s):p.removeEventListener("abort",s)}),e=null)};e.forEach(p=>p.addEventListener("abort",s));const{signal:l}=i;return l.unsubscribe=()=>Me.asap(c),l}},gw=S(EO),Dk=lf.f("asyncIterator"),UH=S(Dk);function Ew(e,t){this.v=e,this.k=t}function Js(e){return function(){return new Tg(e.apply(this,arguments))}}function Tg(e){var t,n;function r(s,o){try{var c=e[s](o),l=c.value,p=l instanceof Ew;gw.resolve(p?l.v:l).then(function(m){if(p){var E=s==="return"?"return":"next";if(!l.k||m.done)return r(E,m);m=e[E](m).value}i(c.done?"return":"normal",m)},function(m){r("throw",m)})}catch(m){i("throw",m)}}function i(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(s,o){return new gw(function(c,l){var p={key:s,arg:o,resolve:c,reject:l,next:null};n?n=n.next=p:(t=n=p,r(s,o))})},typeof e.return!="function"&&(this.return=void 0)}function jt(e){return new Ew(e,0)}function ly(e){var t={},n=!1;function r(i,s){return n=!0,s=new gw(function(o){o(e[i](s))}),{done:!1,value:new Ew(s,1)}}return t[pf!==void 0&&ok||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}Tg.prototype[typeof pf=="function"&&UH||"@@asyncIterator"]=function(){return this},Tg.prototype.next=function(e){return this._invoke("next",e)},Tg.prototype.throw=function(e){return this._invoke("throw",e)},Tg.prototype.return=function(e){return this._invoke("return",e)};var vw=S(Dk);function Sw(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=vw,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new dy(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function dy(e){function t(n){if(Object(n)!==n)return Ve.reject(new TypeError(n+" is not an object."));var r=n.done;return Ve.resolve(n.value).then(function(i){return{value:i,done:r}})}return dy=function(n){this.s=n,this.n=n.next},dy.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Ve.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Ve.reject(n):t(r.apply(this.s,arguments))}},new dy(e)}const VH=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},jH=function(){var e=Js(function*(t,n){var r,i=!1,s=!1;try{for(var o,c=Sw(FH(t));i=!(o=yield jt(c.next())).done;i=!1){const l=o.value;yield*ly(Sw(VH(l,n)))}}catch(l){s=!0,r=l}finally{try{i&&c.return!=null&&(yield jt(c.return()))}finally{if(s)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),FH=function(){var e=Js(function*(t){if(t[vw])return void(yield*ly(Sw(t)));const n=t.getReader();try{for(;;){const{done:r,value:i}=yield jt(n.read());if(r)break;yield i}}finally{yield jt(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),kk=(e,t,n,r)=>{const i=jH(e,t);let s,o=0,c=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:p,value:m}=await i.next();if(p)return c(),void l.close();let E=m.byteLength;if(n){let v=o+=E;n(v)}l.enqueue(new Uint8Array(m))}catch(p){throw c(p),p}},cancel:l=>(c(l),i.return())},{highWaterMark:2})};function Lk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function xk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lk(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const uy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Mk=uy&&typeof ReadableStream=="function",BH=uy&&(typeof TextEncoder=="function"?(Uk=new TextEncoder,e=>Uk.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Uk;const Vk=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},WH=Mk&&Vk(()=>{let e=!1;const t=new Request(Wi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),yw=Mk&&Vk(()=>Me.isReadableStream(new Response("").body)),hy={stream:yw&&(e=>e.body)};var jk;uy&&(jk=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!hy[e]&&(hy[e]=Me.isFunction(jk[e])?t=>t[e]():(t,n)=>{throw new tn("Response type '".concat(e,"' is not supported"),tn.ERR_NOT_SUPPORT,n)})}));const GH=async(e,t)=>{const n=Me.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:Me.isBlob(r)?r.size:Me.isSpecCompliantForm(r)?(await new Request(Wi.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Me.isArrayBufferView(r)||Me.isArrayBuffer(r)?r.byteLength:(Me.isURLSearchParams(r)&&(r+=""),Me.isString(r)?(await BH(r)).byteLength:void 0))(t)};var HH=uy&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:l,responseType:p,headers:m,withCredentials:E="same-origin",fetchOptions:v}=Pk(e);p=p?(p+"").toLowerCase():"text";let y,D=MH([i,s&&s.toAbortSignal()],o);const A=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let O;try{if(l&&WH&&n!=="get"&&n!=="head"&&(O=await GH(m,r))!==0){let Q,z=new Request(t,{method:"POST",body:r,duplex:"half"});if(Me.isFormData(r)&&(Q=z.headers.get("content-type"))&&m.setContentType(Q),z.body){const[re,he]=bk(O,cy(Ik(l)));r=kk(z.body,65536,re,he)}}Me.isString(E)||(E=E?"include":"omit");const V="credentials"in Request.prototype;y=new Request(t,xk(xk({},v),{},{signal:D,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:r,duplex:"half",credentials:V?E:void 0}));let U=await fetch(y);const G=yw&&(p==="stream"||p==="response");if(yw&&(c||G&&A)){const Q={};["status","statusText","headers"].forEach(Ee=>{Q[Ee]=U[Ee]});const z=Me.toFiniteNumber(U.headers.get("content-length")),[re,he]=c&&bk(z,cy(Ik(c),!0))||[];U=new Response(kk(U.body,65536,re,()=>{he&&he(),A&&A()}),Q)}p=p||"text";let Z=await hy[Me.findKey(hy,p)||"text"](U,e);return!G&&A&&A(),await new Ve((Q,z)=>{wk(Q,z,{data:Z,headers:ma.from(U.headers),status:U.status,statusText:U.statusText,config:e,request:y})})}catch(V){throw A&&A(),V&&V.name==="TypeError"&&/Load failed|fetch/i.test(V.message)?Object.assign(new tn("Network Error",tn.ERR_NETWORK,e,y),{cause:V.cause||V}):tn.from(V,V&&V.code,e,y)}});const Tw={http:null,xhr:xH,fetch:HH};Me.forEach(Tw,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Fk=e=>"- ".concat(e),KH=e=>Me.isFunction(e)||e===null||e===!1;var Bk={getAdapter:e=>{e=Me.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let o;if(n=e[s],r=n,!KH(n)&&(r=Tw[(o=String(n)).toLowerCase()],r===void 0))throw new tn("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map(o=>{let[c,l]=o;return"adapter ".concat(c," ")+(l===!1?"is not supported by the environment":"is not available in the build")});throw new tn("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(Fk).join(`
`):" "+Fk(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:Tw};function Cw(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ff(null,e)}function Wk(e){return Cw(e),e.headers=ma.from(e.headers),e.data=_w.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Bk.getAdapter(e.adapter||fw.adapter)(e).then(function(t){return Cw(e),t.data=_w.call(e,e.transformResponse,t),t.headers=ma.from(t.headers),t},function(t){return Rk(t)||(Cw(e),t&&t.response&&(t.response.data=_w.call(e,e.transformResponse,t.response),t.response.headers=ma.from(t.response.headers))),Ve.reject(t)})}const Gk="1.9.0",py={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{py[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Hk={};py.transitional=function(e,t,n){function r(i,s){return"[Axios v"+Gk+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,o)=>{if(e===!1)throw new tn(r(s," has been removed"+(t?" in "+t:"")),tn.ERR_DEPRECATED);return t&&!Hk[s]&&(Hk[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,o)}},py.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var fy={assertOptions:function(e,t,n){if(typeof e!="object")throw new tn("options must be an object",tn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],o=t[s];if(o){const c=e[s],l=c===void 0||o(c,s,e);if(l!==!0)throw new tn("option "+s+" must be "+l,tn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new tn("Unknown option "+s,tn.ERR_BAD_OPTION)}},validators:py};const mc=fy.validators;let my=class{constructor(e){this.defaults=e||{},this.interceptors={request:new qP,response:new qP}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=lh(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&fy.assertOptions(n,{silentJSONParsing:mc.transitional(mc.boolean),forcedJSONParsing:mc.transitional(mc.boolean),clarifyTimeoutError:mc.transitional(mc.boolean)},!1),r!=null&&(Me.isFunction(r)?t.paramsSerializer={serialize:r}:fy.assertOptions(r,{encode:mc.function,serialize:mc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),fy.assertOptions(t,{baseUrl:mc.spelling("baseURL"),withXsrfToken:mc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Me.merge(i.common,i[t.method]);i&&Me.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),t.headers=ma.concat(s,i);const o=[];let c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(c=c&&y.synchronous,o.unshift(y.fulfilled,y.rejected))});const l=[];let p;this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let m,E=0;if(!c){const y=[Wk.bind(this),void 0];for(y.unshift.apply(y,o),y.push.apply(y,l),m=y.length,p=Ve.resolve(t);E<m;)p=p.then(y[E++],y[E++]);return p}m=o.length;let v=t;for(E=0;E<m;){const y=o[E++],D=o[E++];try{v=y(v)}catch(A){D.call(this,A);break}}try{p=Wk.call(this,v)}catch(y){return Ve.reject(y)}for(E=0,m=l.length;E<m;)p=p.then(l[E++],l[E++]);return p}getUri(e){return YP(Ak((e=lh(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Me.forEach(["delete","get","head","options"],function(e){my.prototype[e]=function(t,n){return this.request(lh(n||{},{method:e,url:t,data:(n||{}).data}))}}),Me.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,s){return this.request(lh(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}my.prototype[e]=t(),my.prototype[e+"Form"]=t(!0)});var _y=my;class Rw{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Ve(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new Ve(c=>{r.subscribe(c),s=c}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},t(function(i,s,o){r.reason||(r.reason=new ff(i,s,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Rw(function(r){t=r}),cancel:t}}}var zH=Rw;const ww={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ww).forEach(e=>{let[t,n]=e;ww[n]=t});var YH=ww;const Yr=function e(t){const n=new _y(t),r=NP(_y.prototype.request,n);return Me.extend(r,_y.prototype,n,{allOwnKeys:!0}),Me.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(lh(t,i))},r}(fw);Yr.Axios=_y,Yr.CanceledError=ff,Yr.CancelToken=zH,Yr.isCancel=Rk,Yr.VERSION=Gk,Yr.toFormData=XS,Yr.AxiosError=tn,Yr.Cancel=Yr.CanceledError,Yr.all=function(e){return Ve.all(e)},Yr.spread=function(e){return function(t){return e.apply(null,t)}},Yr.isAxiosError=function(e){return Me.isObject(e)&&e.isAxiosError===!0},Yr.mergeConfig=lh,Yr.AxiosHeaders=ma,Yr.formToJSON=e=>Tk(Me.isHTMLForm(e)?new FormData(e):e),Yr.getAdapter=Bk.getAdapter,Yr.HttpStatusCode=YH,Yr.default=Yr;var Ai=Yr;const qH=()=>{};function Cg(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:qH};return e.promise=new Ve((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const gy=new Map,Ey=new Map,_c=new Map;let dr=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Wt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Kk=new R2;let _a=Kk.getResult(),bw=null;function xt(e){if(!bw){_a=Kk.getResult();const t=function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return Wt.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Wt.CHROME;case"Safari":case"Mobile Safari":return Wt.SAFARI;case"Edge":return Wt.EDGE;case"Firefox":return Wt.FIREFOX;case"QQ":case"QQBrowser":return Wt.QQ;case"Opera":return Wt.OPERA;case"WeChat":return Wt.WECHAT;default:return c.browser.name||""}}(_a),n=zk(_a),r=function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""}(_a),i=_a.os.version,s=zk(_a,!1),o=_a.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o};bw={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o}}return bw}function zk(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function vy(){return xt().os}function Yk(){const e=xt();return"".concat(e.os," ").concat(e.osVersion)}function Sy(){const e=xt();return!!(_a.engine.name==="WebKit"&&e.os===dr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Wt.SAFARI||qr()&&e.name!==Wt.SAFARI)}function cl(){return xt().name===Wt.CHROME}function Nr(){return xt().name===Wt.SAFARI}function qk(){const e=xt();if(e.name!==Wt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function Xk(){return xt().name===Wt.EDGE}function Nn(){return xt().name===Wt.FIREFOX}function qr(){return xt().os===dr.IOS}function mf(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)>=e}function Jk(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)<e}function Iw(e,t,n){const r=xt();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function Aw(e){const t=xt();return!(t.name!==Wt.EDGE||!t.osVersion)&&Number(t.version)>=e}function Ow(e){const t=xt();return!(t.name!==Wt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function Qk(e){const t=xt();return!(t.name!==Wt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function Zk(e,t,n){const r=xt();if(r.os!==dr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function $k(e,t,n){const r=xt();if(r.os!==dr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function Nw(e,t,n){const r=xt();if(r.name!==Wt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function Pw(e){const t=xt();return!(t.name!==Wt.OPERA||!t.osVersion)&&Number(t.version)>=e}function eL(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function _f(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function Dw(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function tL(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Lo(){return Nr()&&navigator.maxTouchPoints>0}function nL(){return xt().name===Wt.WECHAT}function rL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function kw(){const e=vy();return function(){const{deviceType:t}=xt();return t==="mobile"||t==="tablet"}()||e===dr.ANDROID||e===dr.IOS||e===dr.HARMONY_OS}function ll(){const e=xt();return e.name!==Wt.EDGE&&e.name!==Wt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function yy(){return vy()===dr.ANDROID}function Rg(){const e=xt();return yy()&&(e.name===Wt.CHROME||e.name===Wt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function pt(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iL(Object(n),!0).forEach(function(r){pt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let j=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),ue=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),pt(this,"code",void 0),pt(this,"message",void 0),pt(this,"data",void 0),pt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ga(e,t){if(typeof e!="boolean")throw new ue(j.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ir(e,t,n){if(!Oe(n).call(n,e))throw new ue(j.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function nn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new ue(j.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function Lw(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ue(j.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&nn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&nn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&nn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&nn(e.ideal,"".concat(t,".ideal"),1,1/0)}else nn(e,t,1,1/0)}function Cr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ue(j.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!sL(e,n,r,i))throw new ue(j.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function dl(e,t){if(!Array.isArray(e))throw new ue(j.INVALID_PARAMS,"".concat(t," should be an array"))}function Pn(e){return e==null}function sL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0}(e))}var wg=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(wg||{}),xw=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(xw||{});const oL=new class{constructor(){pt(this,"_clientSize",null),pt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),pt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),pt(this,"getStyle",e=>window.getComputedStyle(e,null)),pt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:o,filter:c}=r;return(i==="none"||Oe(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(n=!1),!!n&&(c&&c.split(" ").filter(l=>{var p;const m=l.split("(")[0];return Oe(p=["brightness","blur","opacity"]).call(p,m)}).map(l=>{const[p,m]=l.split(/\(|\)/);return[p,Number(m.match(/^[0-9\.]+/))]}).forEach(l=>{const[p,m]=l;switch(p){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),pt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=o=>t(o);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),pt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),pt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:o}=e.getBoundingClientRect(),c=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:o,clientWidth:c,clientHeight:l,clientMin:Math.min(c,l)}}),pt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),pt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),pt(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),pt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,o=[],c=10**6;for(let l=0;l<5;l++)for(let p=0;p<5;p++){const m=(n*c+(l===0?.1:l===4?(i*l*c-1e5)/c:i*l)*c)/c,E=(r*c+(p===0?.1:p===4?(s*p*c-1e5)/c:s*p)*c)/c;o.push({x:m,y:E})}return[...o]}),pt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),pt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),pt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let c,l,p,m;if(e<0)c=0;else{if(!(e<s))return!1;c=e}if(t<0)return!1;if(l=t<s?t:s,n<0)p=0;else{if(!(n<i))return!1;p=n}if(r<0)return!1;m=r<i?r:i;const E=l-c,v=m-p;return this.checkSizeIsVisible(E,v,o)}),pt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),pt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(wg.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(wg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(wg.SIZE)}}return this.returnHiddenResult(wg.STYLE)}return this.returnHiddenResult(xw.UNMOUNTED)}return this.returnHiddenResult(xw.INVALID_HTML_ELEMENT)}),pt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Mw(e){return new TextEncoder().encode(e)}const aL=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Uw=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",Mw(e)),16);class bn{constructor(){pt(this,"_events",{}),pt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],i=this._indexOfListener(r,n);i!==-1&&r.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(o=>o);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(let o=0;o<n.length;o+=1){const c=n[o];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o?.toString()))}})}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}let bg=null;function cL(){if(bg)return bg;if(window.electron)return bg=window.electron;if(!window.require)return null;try{return bg=window.require("electron"),bg}catch{return null}}let xn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Tn=function(e){return e.TRACER="tracer",e}({});function lL(e){return nn(e.timeout,"config.timeout",0,1e5),nn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),nn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),nn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let XH=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Xt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Ig(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function dL(e){return Cr(e.turnServerURL,"turnServerURL"),Cr(e.username,"username"),Cr(e.password,"password"),e.udpport&&nn(e.udpport,"udpport",1,99999,!0),e.forceturn&&ga(e.forceturn,"forceturn"),e.security&&ga(e.security,"security"),e.tcpport&&nn(e.tcpport,"tcpport",1,99999,!0),!0}function Vw(e){return e.level!==void 0&&ir(e.level,"level",[1,2,3]),e.delay!==void 0&&nn(e.delay,"delay",0,3e3,!0),!0}let Nt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Pr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),os=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),gf=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Dr(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?Ve.reject(new ue(j.UNEXPECTED_ERROR,"can not emit promise")):new Ve((s,o)=>{e.emit(t,...r,s,o)})}function sn(e,t){if(e.getListeners(t).length===0)return Ve.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Dr(e,t,...r)}function Ts(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Ag(e,t,...r)}function Ag(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(e.emit(t,...s,c=>{n=c},c=>{r=c}),r!==null)throw r;if(n===null)throw new ue(j.UNEXPECTED_ERROR,"handler is not sync");return n}const Gn=new class extends bn{set networkState(e){this.emit(gf.NETWORK_STATE_CHANGE,e,this._networkState),e===os.ONLINE?this.emit(gf.ONLINE):e===os.OFFLINE&&(this.onlineWaiter=new Ve(t=>{this.once(gf.ONLINE,()=>{this.onlineWaiter=void 0,t(os.ONLINE)})}),this.emit(gf.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===os.ONLINE}constructor(){super(),pt(this,"_moduleName","network-indicator"),pt(this,"_networkState",os.ONLINE),pt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=os.ONLINE}),window.addEventListener("offline",()=>{this.networkState=os.OFFLINE})}};function Ty(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Ef(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Cy(e){Ve!==void 0?Ve.resolve().then(e):setTimeout(e,0)}function Cn(e){return JSON.parse(JSON.stringify(e))}function dh(e){try{return Cn(e)}catch{return e}}const uL={};function vd(e,t){uL[t]||(uL[t]=!0,e())}function uh(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Sd(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function hL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function pL(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Ui(t).call(t,(o,c)=>o+c.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach(o=>{i.set(o,s),s+=o.length}),i}function gc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function fL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?gc(n):n.size}),t+138}function JH(e){const t=new ue(j.TIMEOUT,"timeout");return new Ve((n,r)=>{window.setTimeout(()=>r(t),e)})}function Rr(e){return new Ve(t=>{window.setTimeout(t,e)})}function on(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+on(e-n.length,"")}function hh(){return on(32,"").toUpperCase()}const Ry=()=>{},mL=new class{constructor(){pt(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==n){c.fn(...c.args),clearTimeout(c.timer);const l=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:s,skipFn:r})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,we(we({},c),{},{fn:e,args:s,skipFn:r}))}else{const c=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:c,args:s,skipFn:r})}}},_L=mL.throttleByKey.bind(mL);function gL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function jw(e,t){if(!gL(e)||!gL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=jw(e[r],t[r]);return n}{const n=we({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=jw(e[r],t[r]):n[r]=t[r]);return n}}function EL(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function vf(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Fw(e){return Ui(e).call(e,(t,n)=>t+n,0)}function vL(e){const t="0123456789abcdef";function n(G){let Z,Q="";for(Z=0;Z<=3;Z++)Q+=t.charAt(G>>8*Z+4&15)+t.charAt(G>>8*Z&15);return Q}function r(G,Z){const Q=(65535&G)+(65535&Z);return(G>>16)+(Z>>16)+(Q>>16)<<16|65535&Q}function i(G,Z,Q,z,re,he){return r(function(Ee,Re){return Ee<<Re|Ee>>>32-Re}(r(r(Z,G),r(z,he)),re),Q)}function s(G,Z,Q,z,re,he,Ee){return i(Z&Q|~Z&z,G,Z,re,he,Ee)}function o(G,Z,Q,z,re,he,Ee){return i(Z&z|Q&~z,G,Z,re,he,Ee)}function c(G,Z,Q,z,re,he,Ee){return i(Z^Q^z,G,Z,re,he,Ee)}function l(G,Z,Q,z,re,he,Ee){return i(Q^(Z|~z),G,Z,re,he,Ee)}const p=function(G){let Z;const Q=1+(G.length+8>>6),z=new Array(16*Q);for(Z=0;Z<16*Q;Z++)z[Z]=0;for(Z=0;Z<G.length;Z++)z[Z>>2]|=G.charCodeAt(Z)<<Z%4*8;return z[Z>>2]|=128<<Z%4*8,z[16*Q-2]=8*G.length,z}(e);let m,E,v,y,D,A=1732584193,O=-271733879,V=-1732584194,U=271733878;for(m=0;m<p.length;m+=16)E=A,v=O,y=V,D=U,A=s(A,O,V,U,p[m+0],7,-680876936),U=s(U,A,O,V,p[m+1],12,-389564586),V=s(V,U,A,O,p[m+2],17,606105819),O=s(O,V,U,A,p[m+3],22,-1044525330),A=s(A,O,V,U,p[m+4],7,-176418897),U=s(U,A,O,V,p[m+5],12,1200080426),V=s(V,U,A,O,p[m+6],17,-1473231341),O=s(O,V,U,A,p[m+7],22,-45705983),A=s(A,O,V,U,p[m+8],7,1770035416),U=s(U,A,O,V,p[m+9],12,-1958414417),V=s(V,U,A,O,p[m+10],17,-42063),O=s(O,V,U,A,p[m+11],22,-1990404162),A=s(A,O,V,U,p[m+12],7,1804603682),U=s(U,A,O,V,p[m+13],12,-40341101),V=s(V,U,A,O,p[m+14],17,-1502002290),O=s(O,V,U,A,p[m+15],22,1236535329),A=o(A,O,V,U,p[m+1],5,-165796510),U=o(U,A,O,V,p[m+6],9,-1069501632),V=o(V,U,A,O,p[m+11],14,643717713),O=o(O,V,U,A,p[m+0],20,-373897302),A=o(A,O,V,U,p[m+5],5,-701558691),U=o(U,A,O,V,p[m+10],9,38016083),V=o(V,U,A,O,p[m+15],14,-660478335),O=o(O,V,U,A,p[m+4],20,-405537848),A=o(A,O,V,U,p[m+9],5,568446438),U=o(U,A,O,V,p[m+14],9,-1019803690),V=o(V,U,A,O,p[m+3],14,-187363961),O=o(O,V,U,A,p[m+8],20,1163531501),A=o(A,O,V,U,p[m+13],5,-1444681467),U=o(U,A,O,V,p[m+2],9,-51403784),V=o(V,U,A,O,p[m+7],14,1735328473),O=o(O,V,U,A,p[m+12],20,-1926607734),A=c(A,O,V,U,p[m+5],4,-378558),U=c(U,A,O,V,p[m+8],11,-2022574463),V=c(V,U,A,O,p[m+11],16,1839030562),O=c(O,V,U,A,p[m+14],23,-35309556),A=c(A,O,V,U,p[m+1],4,-1530992060),U=c(U,A,O,V,p[m+4],11,1272893353),V=c(V,U,A,O,p[m+7],16,-155497632),O=c(O,V,U,A,p[m+10],23,-1094730640),A=c(A,O,V,U,p[m+13],4,681279174),U=c(U,A,O,V,p[m+0],11,-358537222),V=c(V,U,A,O,p[m+3],16,-722521979),O=c(O,V,U,A,p[m+6],23,76029189),A=c(A,O,V,U,p[m+9],4,-640364487),U=c(U,A,O,V,p[m+12],11,-421815835),V=c(V,U,A,O,p[m+15],16,530742520),O=c(O,V,U,A,p[m+2],23,-995338651),A=l(A,O,V,U,p[m+0],6,-198630844),U=l(U,A,O,V,p[m+7],10,1126891415),V=l(V,U,A,O,p[m+14],15,-1416354905),O=l(O,V,U,A,p[m+5],21,-57434055),A=l(A,O,V,U,p[m+12],6,1700485571),U=l(U,A,O,V,p[m+3],10,-1894986606),V=l(V,U,A,O,p[m+10],15,-1051523),O=l(O,V,U,A,p[m+1],21,-2054922799),A=l(A,O,V,U,p[m+8],6,1873313359),U=l(U,A,O,V,p[m+15],10,-30611744),V=l(V,U,A,O,p[m+6],15,-1560198380),O=l(O,V,U,A,p[m+13],21,1309151649),A=l(A,O,V,U,p[m+4],6,-145523070),U=l(U,A,O,V,p[m+11],10,-1120210379),V=l(V,U,A,O,p[m+2],15,718787259),O=l(O,V,U,A,p[m+9],21,-343485551),A=r(A,E),O=r(O,v),V=r(V,y),U=r(U,D);return n(A)+n(O)+n(V)+n(U)}let QH=1,SL=console,jr=class{static setLogger(e){SL=e}constructor(e,t){pt(this,"id",void 0),pt(this,"lockingPromise",Ve.resolve()),pt(this,"locks",0),pt(this,"name",""),pt(this,"lockId",void 0),this.lockId=QH++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");SL.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new Ve(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Sf(e,t){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const c=await o.lock("From ".concat(e,".").concat(r));try{for(var l=arguments.length,p=new Array(l),m=0;m<l;m++)p[m]=arguments[m];return await s.apply(this,p)}finally{c()}},i}}const qn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Bw(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ea(e,t,n,r){const i=Object.assign({},qn,r);let s=i.timeout;const o=async()=>{await function(p){return new Ve(m=>{window.setTimeout(m,p)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let c=!1;const l=new Ve(async(p,m)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<i.maxRetryCount;E+=1){if(c)return m(new ue(j.OPERATION_ABORTED));try{const v=await e();if(!t(v,E)||E+1===i.maxRetryCount)return p(v);await o()}catch(v){if(!n(v,E)||E+1===i.maxRetryCount)return m(v);await o()}}});return l.cancel=()=>c=!0,l}let wy,yL=class{constructor(e){pt(this,"input",[]),pt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ui(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},by=0,Ww=0;function Gw(e,t,n,r){return new Ve((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),by+=gc(t.data)):n&&(t.data.size?by+=t.data.size:t.data instanceof FormData?by+=fL(t.data):by+=gc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ai.request(t).then(o=>{typeof o.data=="string"?Ww+=gc(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?Ww+=o.data.byteLength:Ww+=gc(JSON.stringify(o.data)),i(o.data)}).catch(o=>{Ai.isCancel(o)?s(new ue(j.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ue(j.NETWORK_TIMEOUT,o.message)):o.response?s(new ue(j.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ue(j.NETWORK_ERROR,o.message))})})}async function ZH(e,t){const n=new Blob([t.data],{type:"buffer"});return await Gw(e,we(we({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const TL=()=>window.isSecureContext!==void 0;function xo(e){if(Array.isArray(e))return e.map(n=>n);if(!CL(e))return e;const t={};for(const n in e){const r=e[n];CL(r)||Array.isArray(r)?t[n]=xo(r):t[n]=r}return t}function CL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Hw=class{constructor(e){pt(this,"input",[]),pt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Ec={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Og={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ec,remoteCandidate:Ec},updateInterval:0},RL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},wL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},bL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},IL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let Kw=class{constructor(e,t){pt(this,"onFirstVideoReceived",void 0),pt(this,"onFirstVideoDecoded",void 0),pt(this,"onFirstAudioReceived",void 0),pt(this,"onFirstVideoDecodedTimeout",void 0),pt(this,"onFirstAudioDecoded",void 0),pt(this,"onSelectedLocalCandidateChanged",void 0),pt(this,"onSelectedRemoteCandidateChanged",void 0),pt(this,"videoIsReady",!1),pt(this,"videoIsReady2",{}),pt(this,"pc",void 0),pt(this,"options",void 0),pt(this,"intervalTimer",void 0),pt(this,"stats",xo(Og)),pt(this,"isFirstVideoReceived",{}),pt(this,"isFirstVideoDecoded",{}),pt(this,"isFirstAudioReceived",{}),pt(this,"isFirstAudioDecoded",{}),pt(this,"isFirstVideoDecodedTimeout",{}),pt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ve(e=>{e({local:we({},Ec),remote:we({},Ec)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,o=0;for(const c of n)e[c].forEach((l,p)=>{if(!this.lossRateWindowStats[t-1][c][p]||!this.lossRateWindowStats[0][c][p])return;const m=this.lossRateWindowStats[t-1][c][p].packets-this.lossRateWindowStats[0][c][p].packets,E=this.lossRateWindowStats[t-1][c][p].packetsLost-this.lossRateWindowStats[0][c][p].packetsLost;c==="videoSend"||c==="audioSend"?(r+=m,s+=E):(i+=m,o+=E),Number.isNaN(m)||Number.isNaN(m)?l.packetLostRate=0:l.packetLostRate=m<=0||E<=0?0:E/(m+E)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},$H=class extends Kw{constructor(){super(...arguments),pt(this,"_stats",Og),pt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=xo(Og);const n=t.filter(i=>i.type==="ssrc");this.processSSRCStats(n);const r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const r=Oe(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=xo(wL);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=xo(RL),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){const o=s.stats,c=Date.now()-s.lts;i.framesDecodeFreezeTime=o.framesDecodeFreezeTime,i.framesDecodeInterval=o.framesDecodeInterval,i.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=c,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:we({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=xo(IL);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=xo(bL);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new Ve((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(i=>{r[i]=n.stat(i)}),t.push(r)}),t}},Ng=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Iy=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),zw=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Cs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var yf=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(yf||{});function Pg(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:yf.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const o=Number(t[r]);if(typeof o!="number")return;if(!e)return o?s/o*i:void 0;const c=Number(e[n]);if(typeof c!="number")return;const l=Number(e[r]);if(typeof l!="number")return;const p=o-l;return p?(s-c)/p*i:void 0}let AL=class extends Kw{constructor(){super(...arguments),pt(this,"_stats",Og),pt(this,"report",void 0),pt(this,"lastDecodeVideoReceiverStats",new Map),pt(this,"lastVideoFramesRecv",new Map),pt(this,"lastVideoFramesSent",new Map),pt(this,"lastVideoFramesDecode",new Map),pt(this,"lastVideoFramesOutput",new Map),pt(this,"lastVideoJBDelay",new Map),pt(this,"lastAudioJBDelay",new Map),pt(this,"mediaBytesSent",new Map),pt(this,"mediaBytesRetransmit",new Map),pt(this,"mediaBytesTargetEncode",new Map),pt(this,"lastDecodeAudioReceiverStats",new Map),pt(this,"lastAudioConcealment",new Map),pt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=xo(Og),this.report.forEach(e=>{switch(e.type){case Cs.OUTBOUND:case Cs.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Cs.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Cs.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Cs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Cs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:we({},Ec),remote:we({},Ec)};return e.forEach(n=>{let r;if(n.type===Cs.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===Cs.CANDIDATE_PAIR&&n.selected&&(r=n),r){const i=(s,o)=>{s.type=o.type,s.id=o.id,o.address&&(s.address=o.address),o.candidateType&&(s.candidateType=o.candidateType),o.port&&(s.port=o.port),o.priority&&(s.priority=o.priority),o.protocol&&(s.protocol=o.protocol),o.relayProtocol&&(s.relayProtocol=o.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&i(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&i(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Cs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Cs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Cs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(we({},t),we({},this.stats.selectedCandidatePair.localCandidate)),e.type===Cs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(we({},t),we({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=xo(IL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Pg(n,t,"totalProcessingDelay","jitterBufferEmittedCount",yf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,we({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,s=n.timestamp,o=s-i;if(o<=0)return;const c=e.concealedSamples-t.concealedSamples-0,l=r.nonSilent+c,p=e.totalSamplesReceived-t.totalSamplesReceived;if(p<=0)return;const m=80*p/o,E=200*p/o,v=o/p;let y=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,l>m&&(r.plc80>0?(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*v)):(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*v)),y=r.plc80+1);let D=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,l>E&&(r.plc200>0?(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*v)):(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*v)),D=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:c,lts:s,plc80:y,plc200:D})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(o=>o.ssrc===e.ssrc);t||(t=xo(RL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const o=t.decodedFrame?t.decodedFrame.width:0,c=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,c),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const o=n.stats,c=s-n.lts;t.framesDecodeFreezeTime=o.framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Pg(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Pg(n?.stats,t,"totalProcessingDelay","framesDecodeCount",yf.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Pg(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",yf.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Pg(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",yf.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:we({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=xo(wL),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new Hw(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new Hw(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new Hw(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Cs.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=xo(bL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Cs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(rs(n=this.report).call(n)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=c?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof l!="number")return;let p=(i=c?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,m=(s=c?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,E=(o=c?.framesPerSecond)!==null&&o!==void 0?o:e.framesPerSecond;if(typeof p=="number"&&typeof m=="number"||(p=0,m=0),E==null){const v=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&v-y.lts>=800?(E=Math.round((l-y.count)/((v-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:v,rate:E})):y?E=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:v,rate:0})}n.sentFrame={width:p,height:m,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,o,c;const l=t?this.report.get(t):void 0,p=(r=l?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,m=(i=l?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,E=(s=l?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,v=(o=l?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,y=(c=l?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount;if(typeof p=="number"){const D=this.lastVideoFramesRecv.get(n.ssrc),A=Date.now();n.framesReceivedCount=p;let O=0;D&&A-D.lts>=800?(O=Math.round((p-D.count)/((A-D.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:O})):D?O=D.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:0}),n.receivedFrame={width:m||0,height:E||0,frameRate:O||0},n.decodedFrame={width:m||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(v&&y){const D=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=D.jitterBufferMs;const O=y-D.jitterBufferEmittedCount;O>0&&(A=1e3*(v-D.jitterBufferDelay)/O),n.jitterBufferMs=A,n.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=(i=c?.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,p=(s=(o=c?.echoReturnLossEnhancement)!==null&&o!==void 0?o:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=l,n.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(e,t,n){var r,i,s,o,c,l,p,m,E;const v=t?this.report.get(t):void 0,y=(r=v?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,D=(i=v?.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,A=(s=v?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,O=(o=v?.jitterBufferEmittedCount)!==null&&o!==void 0?o:e.jitterBufferEmittedCount,V=(c=v?.audioLevel)!==null&&c!==void 0?c:e?.audioLevel,U=(l=v?.totalSamplesDuration)!==null&&l!==void 0?l:e?.totalSamplesDuration,G=(p=v?.concealedSamples)!==null&&p!==void 0?p:e.concealedSamples,Z=(m=v?.silentConcealedSamples)!==null&&m!==void 0?m:e.silentConcealedSamples,Q=(E=v?.concealmentEvents)!==null&&E!==void 0?E:e.concealmentEvents;if(typeof D=="number"&&(n.totalSamplesReceived=D),typeof Z=="number"&&(n.silentConcealedSamples=Z),typeof Q=="number"&&(n.concealmentEvents=Q),typeof G=="number"&&(n.concealedSamples=G),y&&D&&(n.accelerateRate=y/D),A&&O){const re=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let he=re.jitterBufferMs;const Ee=O-re.jitterBufferEmittedCount;Ee>0&&(he=1e3*(A-re.jitterBufferDelay)/Ee),n.jitterBufferMs=Math.round(he),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:O,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=V;let z=1920;U&&D&&(z=D/U/50,n.receivedFrames=Math.round(D/z)),G&&(n.droppedFrames=Math.round(G/z))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{n=n===null?i.diffMean():n+i.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},eK=class extends Kw{updateStats(){return Ve.resolve()}};function Yw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return s?s<76?new $H(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new AL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(o){if(!window.RTCStatsReport)return!1;const c=o.getStats();return!!(c instanceof Ve||function(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}(c))}(e)?new AL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new eK(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const OL="websdk_ng_install_id";function qw(){try{if(W("INSTALL_ID"))return W("INSTALL_ID");let e=window.localStorage.getItem(OL);return e||(e=hh(),window.localStorage.setItem(OL,e)),$t("INSTALL_ID",e),e}catch{return}}const Qs=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.24.0"),Xw=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let ph=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const kr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let c=0;c<6;c++)i.push("1");const s=i.join(""),o={};return o[e]=r,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=kr;const Ay={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Jw={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Qw="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",Zw={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Sn=we(we(we(we({},Zw),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Jw,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Ay),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function $t(e,t,n){var r,i,s;Oe(r=Object.keys(Sn)).call(r,e)&&(!n&&Oe(i=Object.keys(va)).call(i,e)||(Sn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Sn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,Sn.USE_NEW_NETWORK_CONFIG=s,s&&(Sn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Sn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Sn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Sn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Sn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Sn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Sn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Sn.ENABLE_INSTANT_VIDEO=!0,Sn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Sn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Sn.NEW_TURN_MODE||(Sn.NEW_TURN_MODE=4))))}function W(e){return Sn[e]}Xw||(Sn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Sn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Sn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Sn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Sn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Sn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Sn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Sn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Sn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Sn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Sn.AREAS=["NORTH_AMERICA","OVERSEA"]);let NL=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const va={};var ft=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ft||{});let Dg=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const PL=128,tK=96,DL=1e3,Tf=10;let nK=0;var kL=(()=>{var e={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>Ee,Printer:()=>Yt,parse:()=>Pe,print:()=>He});const o=`
`,c="".concat("\r").concat(o),l=" ";let p;function m(ve){return ve>="0"&&ve<="9"}function E(ve){return ve>="!"&&ve<="~"}function v(ve){return E(ve)||ve>=""&&ve<=""}function y(ve){return ve==="!"||ve>="#"&&ve<="'"||ve>="*"&&ve<="+"||ve>="-"&&ve<="."||ve>="0"&&ve<="9"||ve>="A"&&ve<="Z"||ve>="^"&&ve<="~"}function D(ve){return ve>="1"&&ve<="9"}function A(ve){return ve>="A"&&ve<="Z"||ve>="a"&&ve<="z"}function O(ve){return ve==="d"||ve==="h"||ve==="m"||ve==="s"}function V(ve){return ve>""&&ve<"	"||ve>"\v"&&ve<"\f"||ve>""&&ve<""}function U(ve){return A(ve)||m(ve)||ve==="+"||ve==="/"}function G(ve){return m(ve)||A(ve)||ve==="+"||ve==="/"||ve==="-"||ve==="_"}function Z(ve){return A(ve)||m(ve)||ve==="+"||ve==="/"}function Q(ve,w){var H=Object.keys(ve);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(ve);w&&(J=J.filter(function(Ie){return Object.getOwnPropertyDescriptor(ve,Ie).enumerable})),H.push.apply(H,J)}return H}function z(ve){for(var w=1;w<arguments.length;w++){var H=arguments[w]!=null?arguments[w]:{};w%2?Q(Object(H),!0).forEach(function(J){re(ve,J,H[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ve,Object.getOwnPropertyDescriptors(H)):Q(Object(H)).forEach(function(J){Object.defineProperty(ve,J,Object.getOwnPropertyDescriptor(H,J))})}return ve}function re(ve,w,H){return w in ve?Object.defineProperty(ve,w,{value:H,enumerable:!0,configurable:!0,writable:!0}):ve[w]=H,ve}(function(ve){ve.VERSION="v",ve.ORIGIN="o",ve.SESSION_NAME="s",ve.INFORMATION="i",ve.URI="u",ve.EMAIL="e",ve.PHONE="p",ve.CONNECTION="c",ve.BANDWIDTH="b",ve.TIME="t",ve.REPEAT="r",ve.ZONE_ADJUSTMENTS="z",ve.KEY="k",ve.ATTRIBUTE="a",ve.MEDIA="m"})(p||(p={}));class he{consumeText(w,H){let J=H;for(;J<w.length;){const Ie=w[J];if(Ie==="\0"||Ie==="\r"||Ie===o)break;J+=1}if(J-H==0)throw new Error("Invalid text, at ".concat(w));return J}consumeUnicastAddress(w,H,J){return this.consumeTill(w,H,l)}consumeOneOrMore(w,H,J){let Ie=H;for(;J(w[Ie]);)Ie++;if(Ie-H==0)throw new Error("Invalid rule at ".concat(H,"."));return Ie}consumeSpace(w,H){if(w[H]===l)return H+1;throw new Error("Invalid space at ".concat(H,"."))}consumeIP4Address(w,H){let J=H;for(let Ie=0;Ie<4;Ie++)if(J=this.consumeDecimalUChar(w,J),Ie!==3){if(w[J]!==".")throw new Error("Invalid IP4 address.");J++}return J}consumeDecimalUChar(w,H){let J=H;for(let gt=0;gt<3&&m(w[J]);gt++,J++);if(J-H==0)throw new Error("Invalid decimal uchar.");const Ie=parseInt(w.slice(H,J));if(Ie>=0&&Ie<=255)return J;throw new Error("Invalid decimal uchar")}consumeIP6Address(w,H){let J=this.consumeHexpart(w,H);return w[J]===":"&&(J+=1,J=this.consumeIP4Address(w,J)),J}consumeHexpart(w,H){let J=H;if(w[J]===":"&&w[J+1]===":"){J+=2;try{J=this.consumeHexseq(w,J)}catch{}return J}if(J=this.consumeHexseq(w,J),w[J]===":"&&w[J+1]===":"){J+=2;try{J=this.consumeHexseq(w,J)}catch{}return J}return J}consumeHexseq(w,H){let J=H;for(;J=this.consumeHex4(w,J),w[J]===":"&&w[J+1]!==":";)J+=1;return J}consumeHex4(w,H){let J=0;for(;J<4;J++)if(!((Ie=w[H+J])>="0"&&Ie<="9"||Ie>="a"&&Ie<="f"||Ie>="A"&&Ie<="F")){if(J===0)throw new Error("Invalid hex 4");break}var Ie;return H+J}consumeFQDN(w,H){let J=H;for(;m(w[J])||A(w[J])||w[J]==="-"||w[J]===".";)J+=1;if(J-H<4)throw new Error("Invalid FQDN");return J}consumeExtnAddr(w,H){return this.consumeOneOrMore(w,H,v)}consumeMulticastAddress(w,H,J){switch(J){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(w,H);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(w,H);default:try{return this.consumeFQDN(w,H)}catch{return this.consumeExtnAddr(w,H)}}}consumeIP6MulticastAddress(w,H){const J=this.consumeHexpart(w,H);return w[J]==="/"?this.consumeInteger(w,J+1):J}consumeIP4MulticastAddress(w,H){let J=H+3;const Ie=w.slice(H,J),gt=parseInt(Ie);if(gt<224||gt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dn=0;dn<3;dn++){if(w[J]!==".")throw new Error("Invalid IP4 multicast address.");J+=1,J=this.consumeDecimalUChar(w,J)}return w[J]==="/"&&(J+=1),J=this.consumeTTL(w,J),w[J]==="/"&&(J=this.consumeInteger(w,J)),J}consumeInteger(w,H){if(!D(w[H]))throw new Error("Invalid integer.");for(H+=1;m(w[H]);)H+=1;return H}consumeTTL(w,H){if(w[H]==="0")return H+1;if(!D(w[H]))throw new Error("Invalid TTL.");H+=1;for(let J=0;J<2&&m(w[H]);J++)H+=1;return H}consumeToken(w,H){return this.consumeOneOrMore(w,H,y)}consumeTime(w,H){let J=H;if(w[J]==="0")return J+1;for(D(w[J])&&(J+=1);m(w[J]);)J++;if(J-H<10)throw new Error("Invalid time");return J}consumeAddress(w,H){return this.consumeTill(w,H,l)}consumeTypedTime(w,H){let J=H;return J=this.consumeOneOrMore(w,J,m),O(w[J])?J+1:J}consumeRepeatInterval(w,H){if(!D(w[H]))throw new Error("Invalid repeat interval");for(H+=1;m(w[H]);)H+=1;return O(w[H])&&(H+=1),H}consumePort(w,H){return this.consumeOneOrMore(w,H,m)}consume(w,H,J){for(let Ie=0;Ie<J.length;Ie++){if(H+Ie>=w.length)throw new Error("consume exceeding value length");if(w[H+Ie]!==J[Ie])throw new Error("consume ".concat(J," failed at ").concat(Ie))}return H+J.length}consumeTill(w,H,J){let Ie=H;for(;Ie<w.length&&(typeof J!="string"||w[Ie]!==J)&&(typeof J!="function"||!J(w[Ie]));)Ie++;return Ie}}class Ee extends he{constructor(){super(),re(this,"records",[]),re(this,"currentLine",0)}parse(w){const H=this.probeEOL(w);this.records=w.split(H).filter(vl=>!!ni(vl).call(vl)).map(this.parseLine),this.currentLine=0;const J=this.parseVersion(),Ie=this.parseOrigin(),gt=this.parseSessionName(),dn=this.parseInformation(),tr=this.parseUri(),oo=this.parseEmail(),Yo=this.parsePhone(),_E=this.parseConnection(),kh=this.parseBandWidth(),em=this.parseTimeFields(),WT=this.parseKey(),GT=this.parseSessionAttribute(),ao=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:J,origin:Ie,sessionName:gt,information:dn,uri:tr,emails:oo,phones:Yo,connection:_E,bandwidths:kh,timeFields:em,key:WT,attributes:GT,mediaDescriptions:ao}}getCurrentRecord(){const w=this.records[this.currentLine];if(!w)throw new Error("Record doesn't exit.");return w}probeEOL(w){for(let H=0;H<w.length;H++)if(w[H]===o)return w[H-1]==="\r"?c:o;throw new Error("Invalid newline character.")}parseLine(w,H){if(w.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const J=w[0];if(w[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:J,value:w.slice(2),line:H,cur:0}}parseSessionAttribute(){const w=new Ct;for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==p.ATTRIBUTE)break;const J={attField:this.extractOneOrMore(H,Ie=>y(Ie)&&Ie!==":"),_cur:0};H.value[H.cur]===":"&&(H.cur+=1,J.attValue=this.extractOneOrMore(H,V)),w.parse(J),this.currentLine++}return w.digest()}parseMediaAttributes(w){const H=new bt(w);for(;this.currentLine<this.records.length;){const J=this.getCurrentRecord();if(J.type!==p.ATTRIBUTE)break;const Ie={attField:this.extractOneOrMore(J,gt=>y(gt)&&gt!==":"),_cur:0};J.value[J.cur]===":"&&(J.cur+=1,Ie.attValue=this.extractOneOrMore(J,V)),H.parse(Ie),this.currentLine++}return H.digest()}parseKey(){const w=this.getCurrentRecord();if(w.type===p.KEY){if(w.value==="prompt"||w.value==="clear:"||w.value==="base64:"||w.value==="uri:")return w.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const w=this.getCurrentRecord();if(w.type===p.ZONE_ADJUSTMENTS){const H=[];for(;;)try{const J=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);let Ie=!1;w.value[w.cur]==="-"&&(Ie=!0,w.cur+=1);const gt=this.extract(w,this.consumeTypedTime);H.push({time:J,typedTime:gt,back:Ie})}catch{break}if(H.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,H}return[]}parseRepeat(){const w=[];for(;;){const H=this.getCurrentRecord();if(H.type!==p.REPEAT)break;{const J=this.extract(H,this.consumeRepeatInterval),Ie=this.parseTypedTime(H);w.push({repeatInterval:J,typedTimes:Ie}),this.currentLine++}}return w}parseTypedTime(w){const H=[];for(;;)try{this.consumeSpaceForRecord(w),H.push(this.extract(w,this.consumeTypedTime))}catch{break}if(H.length===0)throw new Error("Invalid typed time.");return H}parseTime(){const w=this.getCurrentRecord(),H=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);const J=this.extract(w,this.consumeTime);return this.currentLine++,{startTime:H,stopTime:J}}parseBandWidth(){const w=[];for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==p.BANDWIDTH)break;{const J=this.extractOneOrMore(H,y);if(H.value[H.cur]!==":")throw new Error("Invalid bandwidth field.");H.cur++;const Ie=this.extractOneOrMore(H,m);w.push({bwtype:J,bandwidth:Ie}),this.currentLine++}}return w}parseVersion(){const w=this.getCurrentRecord();if(w.type!==p.VERSION)throw new Error("first sdp record must be version");const H=w.value.slice(0,this.consumeOneOrMore(w.value,0,m));if(H.length!==w.value.length)throw new Error('invalid proto version, "v='.concat(w.value,'"'));return this.currentLine++,H}parseOrigin(){const w=this.getCurrentRecord();if(w.type!==p.ORIGIN)throw new Error("second line of sdp must be origin");const H=this.extractOneOrMore(w,v);this.consumeSpaceForRecord(w);const J=this.extractOneOrMore(w,m);this.consumeSpaceForRecord(w);const Ie=this.extractOneOrMore(w,m);this.consumeSpaceForRecord(w);const gt=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const dn=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const tr=this.extract(w,this.consumeUnicastAddress);return this.currentLine++,{username:H,sessId:J,sessVersion:Ie,nettype:gt,addrtype:dn,unicastAddress:tr}}parseSessionName(){const w=this.getCurrentRecord();if(w.type===p.SESSION_NAME){const H=this.extract(w,this.consumeText);return this.currentLine++,H}}parseInformation(){const w=this.getCurrentRecord();if(w.type!==p.INFORMATION)return;const H=this.extract(w,this.consumeText);return this.currentLine++,H}parseUri(){const w=this.getCurrentRecord();if(w.type===p.URI)return this.currentLine++,w.value}parseEmail(){const w=[];for(;;){const H=this.getCurrentRecord();if(H.type!==p.EMAIL)break;w.push(H.value),this.currentLine++}return w}parsePhone(){const w=[];for(;;){const H=this.getCurrentRecord();if(H.type!==p.PHONE)break;w.push(H.value),this.currentLine++}return w}parseConnection(){const w=this.getCurrentRecord();if(w.type===p.CONNECTION){const H=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const J=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const Ie=this.extract(w,this.consumeAddress);return this.currentLine++,{nettype:H,addrtype:J,address:Ie}}}parseMedia(){const w=this.getCurrentRecord(),H=this.extract(w,this.consumeToken);this.consumeSpaceForRecord(w);let J=this.extract(w,this.consumePort);w.value[w.cur]==="/"&&(w.cur+=1,J+=this.extract(w,this.consumeInteger)),this.consumeSpaceForRecord(w);const Ie=[];for(Ie.push(this.extract(w,this.consumeToken));w.value[w.cur]==="/";)w.cur+=1,Ie.push(this.extract(w,this.consumeToken));if(Ie.length===0)throw new Error("Invalid proto");const gt=this.parseFmt(w);return this.currentLine++,{mediaType:H,port:J,protos:Ie,fmts:gt}}parseTimeFields(){const w=[];for(;this.getCurrentRecord().type===p.TIME;){const H=this.parseTime(),J=this.parseRepeat(),Ie=this.parseZone();w.push({time:H,repeats:J,zones:Ie})}return w}parseMediaDescription(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.MEDIA;){const H=this.parseMedia(),J=this.parseInformation(),Ie=this.parseConnections(),gt=this.parseBandWidth(),dn=this.parseKey(),tr=this.parseMediaAttributes(H);w.push({media:H,information:J,connections:Ie,bandwidths:gt,key:dn,attributes:tr})}return w}parseConnections(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.CONNECTION;)w.push(this.parseConnection());return w}parseFmt(w){const H=[];for(;;)try{this.consumeSpaceForRecord(w),H.push(this.extract(w,this.consumeToken))}catch{break}if(H.length===0)throw new Error("Invalid fmts");return H}extract(w,H){for(var J=arguments.length,Ie=new Array(J>2?J-2:0),gt=2;gt<J;gt++)Ie[gt-2]=arguments[gt];const dn=H.call(this,w.value,w.cur,...Ie),tr=w.value.slice(w.cur,dn);return w.cur=dn,tr}extractOneOrMore(w,H){const J=this.consumeOneOrMore(w.value,w.cur,H),Ie=w.value.slice(w.cur,J);return w.cur=J,Ie}consumeSpaceForRecord(w){if(w.value[w.cur]!==l)throw new Error("Invalid space at ".concat(w.cur,"."));w.cur+=1}}class Re extends he{constructor(){super(...arguments),re(this,"attributes",void 0),re(this,"digested",!1)}extractOneOrMore(w,H,J){const Ie=this.consumeOneOrMore(w.attValue,w._cur,H),gt=w.attValue.slice(w._cur,Ie),[dn,tr]=J||[];if(typeof dn=="number"&&gt.length<dn)throw new Error("error in length, should be more or equal than ".concat(dn," characters."));if(typeof tr=="number"&&gt.length>tr)throw new Error("error in length, should be less or equal than ".concat(tr," characters."));return w._cur=Ie,gt}consumeAttributeSpace(w){if(w.attValue[w._cur]!==l)throw new Error("Invalid space at ".concat(w._cur,"."));w._cur+=1}extract(w,H){if(!w.attValue)throw new Error("Nothing to extract from attValue.");for(var J=arguments.length,Ie=new Array(J>2?J-2:0),gt=2;gt<J;gt++)Ie[gt-2]=arguments[gt];const dn=H.call(this,w.attValue,w._cur,...Ie),tr=w.attValue.slice(w._cur,dn);return w._cur=dn,tr}atEnd(w){if(!w.attValue)throw new Error;return w._cur>=w.attValue.length}peekChar(w){if(!w.attValue)throw new Error;return w.attValue[w._cur]}peek(w,H){if(!w.attValue)throw new Error;for(let J=0;J<H.length;J++)if(H[J]!==w.attValue[w._cur+J])return!1;return!0}parseIceUfrag(w){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(w,U,[4,256])}parseIcePwd(w){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(w,U,[22,256])}parseIceOptions(w){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const H=[];for(;!this.atEnd(w);){H.push(this.extractOneOrMore(w,U));try{this.consumeAttributeSpace(w)}catch(J){if(this.atEnd(w))break;throw J}}this.attributes.iceOptions=H}parseFingerprint(w){const H=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill);this.attributes.fingerprints.push({hashFunction:H,fingerprint:J})}parseExtmap(w){const H=this.extractOneOrMore(w,m);let J;this.peekChar(w)==="/"&&(this.extract(w,this.consume,"/"),J=this.extract(w,this.consumeToken)),this.consumeAttributeSpace(w);const Ie=this.extract(w,this.consumeTill,l),gt=z(z({entry:parseInt(H,10)},J&&{direction:J}),{},{extensionName:Ie});this.peekChar(w)===l&&(this.consumeAttributeSpace(w),gt.extensionAttributes=this.extract(w,this.consumeTill)),this.attributes.extmaps.push(gt)}parseSetup(w){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const H=this.extract(w,this.consumeTill);if(H!=="active"&&H!=="passive"&&H!=="actpass"&&H!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=H}}class Ct extends Re{constructor(){super(...arguments),re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"group":this.parseGroup(w);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"fingerprint":this.parseFingerprint(w);break;case"setup":this.parseSetup(w);break;case"tls-id":this.parseTlsId(w);break;case"identity":this.parseIdentity(w);break;case"extmap":this.parseExtmap(w);break;case"msid-semantic":this.parseMsidSemantic(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(H){throw console.error("parsing session attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),H}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(w){const H=this.extract(w,this.consumeToken),J=[];for(;!this.atEnd(w)&&this.peekChar(w)===l;)this.consumeAttributeSpace(w),J.push(this.extract(w,this.consumeToken));this.attributes.groups.push({semantic:H,identificationTag:J})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(w){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(w,G)}parseIdentity(w){const H=this.extractOneOrMore(w,Z),J=[];for(;!this.atEnd(w)&&this.peekChar(w)===l;){this.consumeAttributeSpace(w);const Ie=this.extract(w,this.consumeToken);this.extract(w,this.consume,"=");const gt=this.extractOneOrMore(w,dn=>dn!==l&&V(dn));J.push({name:Ie,value:gt})}this.attributes.identities.push({assertionValue:H,extensions:J})}parseMsidSemantic(w){this.peekChar(w)===l&&this.consumeAttributeSpace(w);const H={semantic:this.extract(w,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(w)}catch{break}if(this.peekChar(w)==="*"){this.extract(w,this.consume,"*"),H.applyForAll=!0;break}{const J=this.extract(w,this.consumeTill,l);H.identifierList.push(J)}}this.attributes.msidSemantic=H}}class bt extends Re{constructor(w){super(),re(this,"attributes",void 0),w.protos.indexOf("RTP")!==-1||w.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"extmap":this.parseExtmap(w);break;case"setup":this.parseSetup(w);break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"candidate":this.parseCandidate(w);break;case"remote-candidate":this.parseRemoteCandidate(w);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(w);break;case"rtpmap":this.parseRtpmap(w);break;case"ptime":this.parsePtime(w);break;case"maxptime":this.parseMaxPtime(w);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(w);break;case"ssrc":this.parseSSRC(w);break;case"fmtp":this.parseFmtp(w);break;case"rtcp-fb":this.parseRtcpFb(w);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(w);break;case"mid":this.parseMid(w);break;case"msid":this.parseMsid(w);break;case"imageattr":this.parseImageAttr(w);break;case"rid":this.parseRid(w);break;case"simulcast":this.parseSimulcast(w);break;case"sctp-port":this.parseSctpPort(w);break;case"max-message-size":this.parseMaxMessageSize(w);break;case"ssrc-group":this.parseSSRCGroup(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(H){throw console.error("parsing media attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),H}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}parseCandidate(w){const H=this.extractOneOrMore(w,U,[1,32]);this.consumeAttributeSpace(w);const J=this.extractOneOrMore(w,m,[1,5]);this.consumeAttributeSpace(w);const Ie=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const gt=this.extractOneOrMore(w,m,[1,10]);this.consumeAttributeSpace(w);const dn=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const tr=this.extract(w,this.consumePort);this.consumeAttributeSpace(w),this.extract(w,this.consume,"typ"),this.consumeAttributeSpace(w);const oo={foundation:H,componentId:J,transport:Ie,priority:gt,connectionAddress:dn,port:tr,type:this.extract(w,this.consumeToken),extension:{}};for(this.peek(w," raddr")&&(this.extract(w,this.consume," raddr"),this.consumeAttributeSpace(w),oo.relAddr=this.extract(w,this.consumeAddress)),this.peek(w," rport")&&(this.extract(w,this.consume," rport"),this.consumeAttributeSpace(w),oo.relPort=this.extract(w,this.consumePort));this.peekChar(w)===l;){this.consumeAttributeSpace(w);const Yo=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w),oo.extension[Yo]=this.extractOneOrMore(w,E)}this.attributes.candidates.push(oo)}parseRemoteCandidate(w){const H=[];for(;;){const J=this.extractOneOrMore(w,m,[1,5]);this.consumeAttributeSpace(w);const Ie=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const gt=this.extract(w,this.consumePort);H.push({componentId:J,connectionAddress:Ie,port:gt});try{this.consumeAttributeSpace(w)}catch{break}}this.attributes.remoteCandidatesList.push(H)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(w){const H=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill,"/");this.extract(w,this.consume,"/");const Ie={encodingName:J,clockRate:this.extractOneOrMore(w,m)};this.atEnd(w)||this.peekChar(w)!=="/"||(this.extract(w,this.consume,"/"),Ie.encodingParameters=parseInt(this.extract(w,this.consumeTill),10));const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(H,10));gt?gt.rtpMap=Ie:this.attributes.payloads.push({payloadType:parseInt(H,10),rtpMap:Ie,rtcpFeedbacks:[]})}parsePtime(w){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(w,this.consumeTill)}parseMaxPtime(w){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(w,this.consumeTill)}parseDirection(w){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=w.attField}parseSSRC(w){const H=this.extractOneOrMore(w,m);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill,":");let Ie;this.peekChar(w)===":"&&(this.extract(w,this.consume,":"),Ie=this.extract(w,this.consumeTill));const gt=this.attributes.ssrcs.find(dn=>dn.ssrcId===parseInt(H,10));gt?gt.attributes[J]=Ie:this.attributes.ssrcs.push({ssrcId:parseInt(H,10),attributes:{[J]:Ie}})}parseFmtp(w){const H=this.extract(w,this.consumeTill,l);this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill),Ie={};J.split(";").forEach(dn=>{let[tr,oo]=dn.split("=");tr=ni(tr).call(tr);const Yo=typeof oo=="string"?ni(oo).call(oo):null;typeof tr=="string"&&tr.length>0&&(Ie[tr]=Yo)});const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(H,10));gt?gt.fmtp={parameters:Ie}:this.attributes.payloads.push({payloadType:parseInt(H,10),rtcpFeedbacks:[],fmtp:{parameters:Ie}})}parseFmtParameters(w){const H={},J=this.extract(w,this.consumeTill,"=");w._cur++;const Ie=this.extract(w,this.consumeTill,";");for(H[J]=Ie;w.attValue[w._cur]===";";){const gt=this.extract(w,this.consumeTill,"=");w._cur++;const dn=this.extract(w,this.consumeTill,";");H[gt]=dn}return H}parseRtcpFb(w){let H="";H=this.peekChar(w)==="*"?this.extract(w,this.consume,"*"):this.extract(w,this.consumeTill,l),this.consumeAttributeSpace(w);const J=this.extract(w,this.consumeTill,l);let Ie;if(J==="trr-int")Ie={type:J,interval:this.extract(w,this.consumeTill)};else{const gt={type:J};this.peekChar(w)===l&&(this.consumeAttributeSpace(w),gt.parameter=this.extract(w,this.consumeToken),this.peekChar(w)===l&&(gt.additional=this.extract(w,this.consumeTill))),Ie=gt}if(H==="*")this.attributes.rtcpFeedbackWildcards.push(Ie);else{const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(H,10));gt?gt.rtcpFeedbacks.push(Ie):this.attributes.payloads.push({payloadType:parseInt(H,10),rtcpFeedbacks:[Ie]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(w){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const H={port:this.extract(w,this.consumePort)};this.peekChar(w)===l&&(this.consumeAttributeSpace(w),H.netType=this.extractOneOrMore(w,y),this.consumeAttributeSpace(w),H.addressType=this.extractOneOrMore(w,y),this.consumeAttributeSpace(w),H.address=this.extract(w,this.consumeAddress)),this.attributes.rtcp=H}parseMsid(w){const H={id:this.extractOneOrMore(w,y,[1,64])};this.peekChar(w)===l&&(this.consumeAttributeSpace(w),H.appdata=this.extractOneOrMore(w,y,[1,64])),this.attributes.msids.push(H)}parseImageAttr(w){this.attributes.imageattr.push(w.attValue)}parseRid(w){const H=this.extractOneOrMore(w,Ie=>A(Ie)||m(Ie)||Ie==="_"||Ie==="-");this.consumeAttributeSpace(w);const J={id:H,direction:this.extract(w,this.consumeToken),params:[]};if(this.peekChar(w)===l){if(this.consumeAttributeSpace(w),this.peek(w,"pt=")){this.extract(w,this.consume,"pt=");const Ie=[];for(;;){const gt=this.extract(w,this.consumeToken);Ie.push(gt);try{this.extract(w,this.consume,",")}catch{break}}J.payloads=Ie,this.peekChar(w)===l&&this.extract(w,this.consume,l)}for(;;){const Ie=this.extract(w,this.consumeToken);switch(Ie){case"depend":{const gt={type:Ie,rids:this.extract(w,this.consume,"=").split(",")};J.params.push(gt);break}default:{const gt={type:Ie};this.peekChar(w)==="="&&(this.extract(w,this.consume,"="),gt.val=this.extract(w,this.consumeTill,";")),J.params.push(gt)}}try{this.extract(w,this.consume,";")}catch{break}}}this.attributes.rids.push(J)}parseSimulcast(w){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=w.attValue,this.extract(w,this.consumeTill)}parseSctpPort(w){this.attributes.sctpPort=this.extractOneOrMore(w,m,[1,5])}parseMaxMessageSize(w){this.attributes.maxMessageSize=this.extractOneOrMore(w,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(w){this.attributes.mid=this.extract(w,this.consumeToken)}parseSSRCGroup(w){const H=this.extract(w,this.consumeToken),J=[];for(;;)try{this.consumeAttributeSpace(w);const Ie=this.extract(w,this.consumeInteger);J.push(parseInt(Ie,10))}catch{break}this.attributes.ssrcGroups.push({semantic:H,ssrcIds:J})}}function ut(ve,w,H){return w in ve?Object.defineProperty(ve,w,{value:H,enumerable:!0,configurable:!0,writable:!0}):ve[w]=H,ve}class Yt{constructor(){ut(this,"eol",c)}print(w,H){let J="";return H&&(this.eol=H),J+=this.printVersion(w.version),J+=this.printOrigin(w.origin),J+=this.printSessionName(w.sessionName),J+=this.printInformation(w.information),J+=this.printUri(w.uri),J+=this.printEmail(w.emails),J+=this.printPhone(w.phones),J+=this.printConnection(w.connection),J+=this.printBandwidth(w.bandwidths),J+=this.printTimeFields(w.timeFields),J+=this.printKey(w.key),J+=this.printSessionAttributes(w.attributes),J+=this.printMediaDescription(w.mediaDescriptions),J}printVersion(w){return"v=".concat(w).concat(this.eol)}printOrigin(w){return"o=".concat(w.username," ").concat(w.sessId," ").concat(w.sessVersion," ").concat(w.nettype," ").concat(w.addrtype," ").concat(w.unicastAddress).concat(this.eol)}printSessionName(w){return w?"s=".concat(w).concat(this.eol):""}printInformation(w){return w?"i=".concat(w).concat(this.eol):""}printUri(w){return w?"u=".concat(w).concat(this.eol):""}printEmail(w){let H="";for(const J of w)H+="e=".concat(J).concat(this.eol);return H}printPhone(w){let H="";for(const J of w)H+="e=".concat(J).concat(this.eol);return H}printConnection(w){return w?"c=".concat(w.nettype," ").concat(w.addrtype," ").concat(w.address).concat(this.eol):""}printBandwidth(w){let H="";for(const J of w)H+="b=".concat(J.bwtype,":").concat(J.bandwidth).concat(this.eol);return H}printTimeFields(w){let H="";for(const J of w){H+="t=".concat(J.time.startTime," ").concat(J.time.startTime).concat(this.eol);for(const Ie of J.repeats)H+="r=".concat(Ie.repeatInterval," ").concat(Ie.typedTimes.join(" ")).concat(this.eol);J.zoneAdjustments&&(H+="z=",H+="z=".concat(J.zoneAdjustments.map(Ie=>"".concat(Ie.time," ").concat(Ie.back?"-":""," ").concat(Ie.typedTime)).join(" ")).concat(this.eol),H+=this.eol)}return H}printKey(w){return w?"k=".concat(w).concat(this.eol):""}printAttributes(w){let H="";for(const J of w)H+="a=".concat(J.attField).concat(J.attValue?":".concat(J.attValue):"").concat(this.eol);return H}printMediaDescription(w){let H="";for(const J of w)H+=this.printMedia(J.media),H+=this.printInformation(J.information),H+=this.printConnections(J.connections),H+=this.printBandwidth(J.bandwidths),H+=this.printKey(J.key),H+=this.printMediaAttributes(J);return H}printConnections(w){let H="";for(const J of w)H+=this.printConnection(J);return H}printMedia(w){return"m=".concat(w.mediaType," ").concat(w.port," ").concat(w.protos.join("/")," ").concat(w.fmts.join(" ")).concat(this.eol)}printSessionAttributes(w){return new Hr(this.eol).print(w)}printMediaAttributes(w){return new ge(this.eol).print(w)}}class Ht{constructor(w){ut(this,"eol",void 0),this.eol=w}printIceUfrag(w){return w===void 0?"":"a=ice-ufrag:".concat(w).concat(this.eol)}printIcePwd(w){return w===void 0?"":"a=ice-pwd:".concat(w).concat(this.eol)}printIceOptions(w){return w===void 0?"":"a=ice-options:".concat(w.join(l)).concat(this.eol)}printFingerprints(w){return w.length>0?w.map(H=>"a=fingerprint:".concat(H.hashFunction).concat(l).concat(H.fingerprint)).join(this.eol)+this.eol:""}printExtmap(w){return w.map(H=>"a=extmap:".concat(H.entry).concat(H.direction?"/".concat(H.direction):"").concat(l).concat(H.extensionName).concat(H.extensionAttributes?"".concat(l).concat(H.extensionAttributes):"").concat(this.eol)).join("")}printSetup(w){return w===void 0?"":"a=setup:".concat(w).concat(this.eol)}printUnrecognized(w){return w.map(H=>"a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol)).join("")}}class Hr extends Ht{print(w){let H="";return H+=this.printGroups(w.groups),H+=this.printMsidSemantic(w.msidSemantic),H+=this.printIceLite(w.iceLite),H+=this.printIceUfrag(w.iceUfrag),H+=this.printIcePwd(w.icePwd),H+=this.printIceOptions(w.iceOptions),H+=this.printFingerprints(w.fingerprints),H+=this.printSetup(w.setup),H+=this.printTlsId(w.tlsId),H+=this.printIdentity(w.identities),H+=this.printExtmap(w.extmaps),H+=this.printUnrecognized(w.unrecognized),H}printGroups(w){let H="";return w.length>0&&(H+=w.map(J=>"a=group:".concat(J.semantic).concat(J.identificationTag.map(Ie=>"".concat(l).concat(Ie)).join("")).concat(this.eol)).join("")),H}printIceLite(w){return w===void 0?"":"a=ice-lite"+this.eol}printTlsId(w){return w?"a=tls-id:".concat(w).concat(this.eol):""}printIdentity(w){return w.length===0?"":w.map(H=>"a=identity:".concat(H.assertionValue).concat(H.extensions.map(J=>"".concat(l).concat(J.name).concat(J.value?"=".concat(J.value):"")))).join(this.eol)+this.eol}printMsidSemantic(w){if(!w)return"";let H="a=msid-semantic:".concat(w.semantic);return w.applyForAll?H+="".concat(l,"*"):w.identifierList.length>0&&(H+=w.identifierList.map(J=>"".concat(l).concat(J))),H+this.eol}}class ge extends Ht{print(w){const H=w.attributes;let J="";return J+=this.printRTCP(H.rtcp),J+=this.printIceUfrag(H.iceUfrag),J+=this.printIcePwd(H.icePwd),J+=this.printIceOptions(H.iceOptions),J+=this.printCandidates(H.candidates),J+=this.printRemoteCandidatesList(H.remoteCandidatesList),J+=this.printEndOfCandidates(H.endOfCandidates),J+=this.printFingerprints(H.fingerprints),J+=this.printSetup(H.setup),J+=this.printMid(H.mid),J+=this.printExtmap(H.extmaps),J+=this.printRTPRelated(H),J+=this.printPtime(H.ptime),J+=this.printMaxPtime(H.maxPtime),J+=this.printDirection(H.direction),J+=this.printSSRCGroups(H.ssrcGroups),J+=this.printSSRC(H.ssrcs),J+=this.printRTCPMux(H.rtcpMux),J+=this.printRTCPMuxOnly(H.rtcpMuxOnly),J+=this.printRTCPRsize(H.rtcpRsize),J+=this.printMSId(H.msids),J+=this.printImageattr(H.imageattr),J+=this.printRid(H.rids),J+=this.printSimulcast(H.simulcast),J+=this.printSCTPPort(H.sctpPort),J+=this.printMaxMessageSize(H.maxMessageSize),J+=this.printUnrecognized(H.unrecognized),J}printCandidates(w){return w.map(H=>"a=candidate:".concat(H.foundation).concat(l).concat(H.componentId).concat(l).concat(H.transport).concat(l).concat(H.priority).concat(l).concat(H.connectionAddress).concat(l).concat(H.port).concat(l,"typ").concat(l).concat(H.type).concat(H.relAddr?"".concat(l,"raddr").concat(l).concat(H.relAddr):"").concat(H.relPort?"".concat(l,"rport").concat(l).concat(H.relPort):"").concat(Object.keys(H.extension).map(J=>"".concat(l).concat(J).concat(l).concat(H.extension[J])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(w){return w.map(H=>"a=remote-candidates:".concat(H.join(l)).concat(this.eol)).join("")}printEndOfCandidates(w){return w===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(w){if(!w.payloads)return"";const H=w.payloads;let J="";J+=w.rtcpFeedbackWildcards.map(Ie=>this.printRTCPFeedback("*",Ie)).join("");for(const Ie of H)J+=this.printRtpMap(Ie.payloadType,Ie.rtpMap),J+=this.printFmtp(Ie.payloadType,Ie.fmtp),J+=Ie.rtcpFeedbacks.map(gt=>this.printRTCPFeedback(Ie.payloadType,gt)).join("");return J}printFmtp(w,H){if(!H)return"";const J=Object.keys(H.parameters);return J.length===1&&H.parameters[J[0]]===null?"a=fmtp:".concat(w).concat(l).concat(J[0]).concat(this.eol):"a=fmtp:".concat(w).concat(l).concat(Object.keys(H.parameters).map(Ie=>"".concat(Ie,"=").concat(H.parameters[Ie])).join(";")).concat(this.eol)}printRtpMap(w,H){return H?"a=rtpmap:".concat(w).concat(l).concat(H.encodingName,"/").concat(H.clockRate).concat(H.encodingParameters?"/".concat(H.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(w,H){let J="a=rtcp-fb:".concat(w).concat(l),Ie=H;return Ie.type==="trr-int"?J+="ttr-int".concat(l).concat(Ie.interval):(J+="".concat(Ie.type),Ie.parameter&&(J+="".concat(l).concat(Ie.parameter),Ie.additional&&(J+="".concat(l).concat(Ie.additional)))),J+this.eol}printPtime(w){return w===void 0?"":"a=ptime:".concat(w).concat(this.eol)}printMaxPtime(w){return w===void 0?"":"a=maxptime:".concat(w).concat(this.eol)}printDirection(w){return w===void 0?"":"a=".concat(w).concat(this.eol)}printSSRC(w){return w.map(H=>Object.keys(H.attributes).map(J=>"a=ssrc:".concat(H.ssrcId.toString(10)).concat(l).concat(J).concat(H.attributes[J]?":".concat(H.attributes[J]):"").concat(this.eol)).join("")).join("")}printRTCPMux(w){return w===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(w){return w===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(w){return w===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(w){if(w===void 0)return"";let H="a=rtcp:".concat(w.port);return w.netType&&(H+="".concat(l).concat(w.netType)),w.addressType&&(H+="".concat(l).concat(w.addressType)),w.address&&(H+="".concat(l).concat(w.address)),H+this.eol}printMSId(w){return w.map(H=>"a=msid:".concat(H.id).concat(H.appdata?"".concat(l).concat(H.appdata):"").concat(this.eol)).join("")}printImageattr(w){return w.map(H=>"a=imageattr:".concat(H).concat(this.eol)).join("")}printRid(w){return w.map(H=>{let J="a=rid:".concat(H.id).concat(l).concat(H.direction);return H.payloads&&(J+="".concat(l,"pt=").concat(H.payloads.join(","))),H.params.length>0&&(J+="".concat(l).concat(H.params.map(Ie=>Ie.type==="depend"?"depend=".concat(Ie.rids.join(",")):"".concat(Ie.type,"=").concat(Ie.val)).join(";"))),J+this.eol}).join("")}printSimulcast(w){return w===void 0?"":"a=simulcast:".concat(w).concat(this.eol)}printSCTPPort(w){return w===void 0?"":"a=sctp-port:".concat(w).concat(this.eol)}printMaxMessageSize(w){return w===void 0?"":"a=max-message-size:".concat(w).concat(this.eol)}printMid(w){return w===void 0?"":"a=mid:".concat(w).concat(this.eol)}printSSRCGroups(w){return w.map(H=>"a=ssrc-group:".concat(H.semantic).concat(H.ssrcIds.map(J=>"".concat(l).concat(J.toString(10))).join("")).concat(this.eol)).join("")}}function Pe(ve){return new Ee().parse(ve)}function He(ve,w){return new Yt().print(ve,w)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function Gi(e){return kL.parse(e)}function yd(e,t){return kL.print(e,t)}var rK=Qi("Array","keys"),iK=Xo,sK=fr,oK=q,aK=rK,$w=Array.prototype,cK={DOMTokenList:!0,NodeList:!0},lK=function(e){var t=e.keys;return e===$w||oK($w,e)&&t===$w.keys||sK(cK,iK(e))?aK:t},Hi=S(lK);function Dn(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LL(Object(n),!0).forEach(function(r){Dn(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const xL=new class extends bn{constructor(){super(...arguments),Dn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class dK{constructor(t){Dn(this,"logger",void 0),Dn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function eb(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function ML(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Zs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Oy=Date.now(),kg=e=>{for(const t in Zs)if(Object.prototype.hasOwnProperty.call(Zs,t)&&Zs[t]===e)return t;return"DEFAULT"},R=new class{constructor(){Dn(this,"proxyServerURL",void 0),Dn(this,"logLevel",Zs.DEBUG),Dn(this,"uploadState","collecting"),Dn(this,"uploadLogWaitingList",[]),Dn(this,"uploadLogUploadingList",[]),Dn(this,"uploadErrorCount",0),Dn(this,"currentLogID",0),Dn(this,"url",void 0),Dn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Zs.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){$t("UPLOAD_LOG",!0)}disableLogUpload(){$t("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new dK(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Oy<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Oy);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=eb()+" Agora-SDK [".concat(kg(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=eb()+" %cAgora-SDK [".concat(kg(r),"]:");let s=[];if(!W("USE_NEW_LOG"))switch(r){case Zs.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case Zs.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case Zs.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case Zs.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Oy<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Oy);const r=Math.max(0,Math.min(4,t[0]));t[0]=eb()+" Agora-SDK [".concat(kg(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!W("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=ML()+" Agora-SDK [".concat(kg(e),"]:"):n[0]=ML()+" Agora-SDK [".concat(kg(e),"]:");let i="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Qs,process_id:W("PROCESS_ID"),payload:JSON.stringify(e)};return Ea(async()=>{const n=await Ai.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(W("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(W("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),xL.reportLogUploadError(r),!0},{timeout:W("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:W("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,W("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var UL;function uK(e){return Cr(e.reportId,"params.reportId",0,100,!1),Cr(e.category,"params.category",0,100,!1),Cr(e.event,"params.event",0,100,!1),Cr(e.label,"params.label",0,100,!1),nn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(UL={}).FREE="free",UL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const hK={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),yn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let pK=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function st(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var o,c=arguments.length,l=new Array(c),p=0;p<c;p++)l[p]=arguments[p];let m=l;if(e.argsMap)try{m=e.argsMap(this,...l)}catch(v){R.warning(v),m=[]}try{JSON.stringify(m)}catch{R.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const E=(e.report||qe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:m,tag:Tn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const v=i.apply(this,l);return v instanceof Ve?v.then(y=>(E.onSuccess(e.reportResult&&y),y)).catch(y=>{throw E.onError(y),y}):(E.onSuccess(e.reportResult&&v),v)}catch(v){throw E.onError(v),v}}}return r}}const qe=new class{constructor(){Dn(this,"baseInfoMap",new Map),Dn(this,"proxyServer",void 0),Dn(this,"eventUploadTimer",void 0),Dn(this,"setSessionIdTimer",void 0),Dn(this,"url",void 0),Dn(this,"sids",new Set),Dn(this,"backupUrl",void 0),Dn(this,"_appId",void 0),Dn(this,"_aid",0),Dn(this,"keyEventUploadPendingItems",[]),Dn(this,"normalEventUploadPendingItems",[]),Dn(this,"apiInvokeUploadPendingItems",[]),Dn(this,"apiInvokeCount",0),Dn(this,"apiInvokeLoggedCount",0),Dn(this,"ltsList",[]),Dn(this,"lastSendNormalEventTime",Date.now()),Dn(this,"customReportCounterTimer",void 0),Dn(this,"customReportCount",0),Dn(this,"extApiInvoke",async e=>{for(const t of e){const n=St(St({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Tn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),W("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),W("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!W("SHOW_REPORT_INVOKER_LOG"),o=!!W("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&t.id;c&&(this.apiInvokeLoggedCount+=1);const l=this.apiInvokeLoggedCount;function p(y,D){if(c){let A="[apiInvoke-".concat(l,"]");if(t.id&&(A+="[".concat(t.id,"]")),t.name&&(A+="[".concat(t.name,"]"),t.name===xn.JOIN))return R.info("".concat(A," ").concat(y));R.info("".concat(A," ").concat(y),y==="start"?t.options:D||"")}}const m=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});p("start");let E=!1;Rr(t.timeout).then(()=>{E||(this.sendApiInvoke(St(St({},m()),{},{error:j.API_INVOKE_TIMEOUT,success:!1})),p("timeout"))});const v=new ue(j.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:y=>{const D=()=>{if(E)throw v;return E=!0,this.sendApiInvoke(St(St({},m()),{},{success:!0},t.reportResult&&{result:y})),p("onSuccess"),y};return n?_L(D,t.name+"Success",n,()=>E=!0):D()},onError:y=>{const D=()=>{if(E)throw y;E=!0,this.sendApiInvoke(St(St({},m()),{},{success:!1,error:y})),p("onFailure",y.toString())};return n?_L(D,t.name+"Error",n,()=>E=!0):D()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:W("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Xw?"global":"oversea",areas:W("AREAS")&&W("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:p,clientRole:m}=t,E=Date.now(),v=St(St({},r),{},{eventType:sr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Qw,lts:E,elapse:E-n,extend:JSON.stringify(i),mode:t.mode,process:W("PROCESS_ID"),appType:W("APP_TYPE"),success:!0,version:Qs,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:p,clientType:Oe(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:m,serviceId:W("PROCESS_ID"),extensionID:W("PLUGIN_INFO").join(",")||""});var y;this.send({type:yn.SESSION,data:v},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{role:t.role,eventType:sr.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:yn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:yn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:o,isProxy:c}=t,l=i-n.startTime,p=St(St({},r),{},{eventType:sr.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:l,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:qw(),isABTestSuccess:t.isABTestSuccess?1:0}),m=p.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),s)this.send({type:yn.JOIN_GATEWAY,data:p},!0);else{let E;if(o)if(c){const y=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=o.match(/p=[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:y&&y.length?y[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:c?1:0}}else{const y=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=o.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:y&&y.length?y[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else E={isSuccess:m,gatewayIp:"",port:"",isProxy:c?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const v=Object.assign({},p,E,{eventType:sr.REJOIN_GATEWAY});this.send({type:yn.RE_JOIN_GATEWAY,data:v},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=St(St({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:yn.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:yn.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=St(St({},i),{},{eventType:sr.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:yn.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const n=[...Hi(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,o=Date.now(),c=St(St({},s),{},{eventType:sr.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:yn.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),o=St(St({},r),{},{elapse:i-n.startTime,eventType:sr.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:yn.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:c},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:c},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:sr.AB_TEST,lts:i});this.send({type:yn.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:sr.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:yn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:sr.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:yn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{eventType:t,lts:o});this.send({type:n,data:c},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:yn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?R.debug("reportProxyServerurl: ".concat(e)):R.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:yn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(s,o,c){const l=s[o];if(!l||typeof l!="string")return[s];s[o]="";const p=gc(JSON.stringify(s));let m=0;const E=[];let v=0;for(let y=0;y<l.length;y++)v+=l.charCodeAt(y)<=127?1:3,v<=c-p||(E[E.length]=we(we({},s),{},{[o]:l.substring(m,y)}),m=y,v=l.charCodeAt(y)<=127?1:3);return m!==l.length-1&&(E[E.length]=we(we({},s),{},{[o]:l.substring(m)})),E})(St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:yn.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:yn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:yn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:yn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>W("CUSTOM_REPORT_LIMIT"))throw new ue(j.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(i=>({type:yn.USER_ANALYTICS,data:St(St({sid:e},i),{},{lts:n})}));try{W("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw R.error("send custom report message failed",i.toString()),new ue(j.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=W("NOT_REPORT_EVENT");if(e.tag&&Oe(t)&&Oe(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ue){const{code:l,message:p}=e.error;o=l||p||e.error.toString()}else o=e.error.toString();const c={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:yn.API_INVOKE,data:c},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):r.push(s)}e.push(...r);for(const s of[...n]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),th(i=this.ltsList).call(i,(o,c)=>o-c))}return t||(this.lastSendNormalEventTime=Date.now()),W("ENABLE_EVENT_REPORT")&&n.length&&(W("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>o=>{W("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-W("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Gn.networkState===os.OFFLINE&&await Ve.race([Gn.onlineWaiter,Rr(2*qn.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach(o=>{const c=Mw(JSON.stringify(o.data)),l=new ArrayBuffer(5),p=(E=>{let v=0;return Object.entries(yn).forEach(y=>{let[D,A]=y;A===E.type&&(v=pK[D])}),v})(o),m=new DataView(l);m.setUint16(0,c.byteLength,!0),m.setUint8(2,255&p),m.setUint8(3,p>>>8&255),m.setUint8(4,p>>>16&255),s=aL(s,new Uint8Array(l)),s=aL(s,c)}),s},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Gw(r,{timeout:1e4,data:t(e),headers:St(St({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(c=>{const l=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return l&&l.info.vid&&+l.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(c=>JSON.stringify(c)),vid:n,aid:r};Gn.networkState===os.OFFLINE&&await Ve.race([Gn.onlineWaiter,Rr(2*qn.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(W("EVENT_REPORT_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(W("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(s)));try{t?await ZH(o,{timeout:1e4,data:i}):await Gw(o,{timeout:1e4,data:i})}catch(l){if(c===1)throw l;continue}return}}createBaseInfo(e,t){const n=Object.assign({},hK);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Tn.TRACER}).onSuccess()}};xL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Gn.networkState,qe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Tn.TRACER}).onSuccess("logUploadError")});class ae extends ue{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Dn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}}const wr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ft(){return wr}function VL(){return"setSinkId"in HTMLAudioElement.prototype&&(!W("RESTRICTION_SET_PLAYBACK_DEVICE")||(cl()||Xk())&&!kw())}function Ny(){return!wr.supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&ll()}function tb(e){return!(Nn()||Jk(87)||Ny()||!W("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}function jL(e){return!!W("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB"))}let br=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Cf(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Bt(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Mo(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function nb(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const fK={"90p":Bt(160,90),"90p_1":Bt(160,90),"120p":Bt(160,120,15,30,65),"120p_1":Bt(160,120,15,30,65),"120p_3":Bt(120,120,15,30,50),"120p_4":Bt(212,120),"180p":Bt(320,180,15,30,140),"180p_1":Bt(320,180,15,30,140),"180p_3":Bt(180,180,15,30,100),"180p_4":Bt(240,180,15,30,120),"240p":Bt(320,240,15,40,200),"240p_1":Bt(320,240,15,40,200),"240p_3":Bt(240,240,15,40,140),"240p_4":Bt(424,240,15,40,220),"360p":Bt(640,360,15,80,400),"360p_1":Bt(640,360,15,80,400),"360p_3":Bt(360,360,15,80,260),"360p_4":Bt(640,360,30,80,600),"360p_6":Bt(360,360,30,80,400),"360p_7":Bt(480,360,15,80,320),"360p_8":Bt(480,360,30,80,490),"360p_9":Bt(640,360,15,80,800),"360p_10":Bt(640,360,24,80,800),"360p_11":Bt(640,360,24,80,1e3),"480p":Bt(640,480,15,100,500),"480p_1":Bt(640,480,15,100,500),"480p_2":Bt(640,480,30,100,1e3),"480p_3":Bt(480,480,15,100,400),"480p_4":Bt(640,480,30,100,750),"480p_6":Bt(480,480,30,100,600),"480p_8":Bt(848,480,15,100,610),"480p_9":Bt(848,480,30,100,930),"480p_10":Bt(640,480,10,100,400),"720p":Bt(1280,720,15,120,1130),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Bt(1280,720,15,120,1130),"720p_2":Bt(1280,720,30,120,2e3),"720p_3":Bt(1280,720,30,120,1710),"720p_5":Bt(960,720,15,120,910),"720p_6":Bt(960,720,30,120,1380),"1080p":Bt(1920,1080,15,120,2080),"1080p_1":Bt(1920,1080,15,120,2080),"1080p_2":Bt(1920,1080,30,120,3e3),"1080p_3":Bt(1920,1080,30,120,3150),"1080p_5":Bt(1920,1080,60,120,4780),"1440p":Bt(2560,1440,30,120,4850),"1440p_1":Bt(2560,1440,30,120,4850),"1440p_2":Bt(2560,1440,60,120,7350),"4k":Bt(3840,2160,30,120,8910),"4k_1":Bt(3840,2160,30,120,8910),"4k_3":Bt(3840,2160,60,120,13500)},mK={"480p":Mo(640,480,5),"480p_1":Mo(640,480,5),"480p_2":Mo(640,480,30),"480p_3":Mo(640,480,15),"720p":Mo(1280,720,5),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Mo(1280,720,5),"720p_2":Mo(1280,720,30),"720p_3":Mo(1280,720,15),"1080p":Mo(1920,1080,5),"1080p_1":Mo(1920,1080,5),"1080p_2":Mo(1920,1080,30),"1080p_3":Mo(1920,1080,15)},_K={"1SL1TL":nb(1,1),"3SL3TL":nb(3,3),"2SL3TL":nb(2,3)};function Uo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},fK[e]):e}function rb(e){return typeof e=="string"?Object.assign({},mK[e]):e}function Py(e){return typeof e=="string"?Object.assign({},_K[e]):e}const gK={speech_low_quality:Cf(16e3,!1),speech_standard:Cf(32e3,!1,18),music_standard:Cf(48e3,!1),standard_stereo:Cf(48e3,!0,56),high_quality:Cf(48e3,!1,128),high_quality_stereo:Cf(48e3,!0,192)};function Dy(e){return typeof e=="string"?Object.assign({},gK[e]):e}const Rf=[];function FL(e){return ir(e,"mediaSource",["screen","window","application"]),!0}let Ke=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),rn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),wf=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),EK=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),vK=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),fh=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),bf=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),$s=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),If=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Rs=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const ib={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},sb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},BL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},SK={uplinkNetworkQuality:0,downlinkNetworkQuality:0},WL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let mi=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),ws=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Lg=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),mh=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Fr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),vc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const ob={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ky=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Lt(e,t,n,r,i){var s,o,c={};return Object.keys(r).forEach(function(l){c[l]=r[l]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Ui(s=Cu(o=n.slice()).call(o)).call(s,function(l,p){return p(e,t,l)||l},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(e,t,c),null):c}function se(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function GL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GL(Object(n),!0).forEach(function(r){se(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class HL extends bn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(fh.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),se(this,"trackMediaType",void 0),se(this,"_ID",void 0),se(this,"_rtpTransceiver",void 0),se(this,"_lowRtpTransceiver",void 0),se(this,"_hints",[]),se(this,"_isClosed",!1),se(this,"_originMediaStreamTrack",void 0),se(this,"mediaStreamTrack",void 0),se(this,"_external",{}),this._ID=n||on(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){Oe(Rf).call(Rf,r)||Rf.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||vd(()=>{var n;qe.reportApiInvoke(null,{name:xn.GET_MEDIA_STREAM_TRACK,options:[],tag:Tn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===wf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Rf.indexOf(t);n!==-1&&Rf.splice(n,1)}(this),this.emit(bf.CLOSED),this.removeAllListeners(fh.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===wf.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(fh.TRANSCEIVER_UPDATED,t,n)}}class Af extends HL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),se(this,"_enabled",!0),se(this,"_muted",!1),se(this,"_isExternalTrack",!1),se(this,"_isClosed",!1),se(this,"_enabledMutex",void 0),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new jr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ke.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(bf.TRACK_ENDED)}stateCheck(t,n){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),ga(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new ue(j.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new ue(j.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ve.resolve([])}}const KL=window.AudioContext||window.webkitAudioContext;let bs=null;const en=new class extends bn{constructor(){super(...arguments),se(this,"prevState",void 0),se(this,"curState",void 0),se(this,"currentTime",void 0),se(this,"currentTimeStuckAt",void 0),se(this,"interruptDetectorTrack",void 0),se(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(br.IOS_15_16_INTERRUPTION_START)}),se(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(bs&&await bs.suspend(),this.emit(br.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){R.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){R.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Of(){if(!bs){if(function(){if(!KL)return void R.error("your browser is not support web audio");R.info("create audio context");const e=un({},W("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(e)),bs=new KL(e),en.curState=bs.state,bs.onstatechange=()=>{en.prevState=en.curState,en.curState=bs?bs.state:void 0;const{prevState:t,curState:n}=en,r=n==="running",i=n==="interrupted",s=t==="running",o=t==="suspended",c=t==="interrupted",l=xt().osVersion;(qr()||Lo())&&s&&i&&(R.info("ios".concat(l,"-interruption-start")),en.emit(br.IOS_INTERRUPTION_START)),(qr()||Lo())&&(o||c)&&r&&(R.info("ios".concat(l,"-interruption-end")),en.emit(br.IOS_INTERRUPTION_END)),t!==n&&en.emit(br.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=bs)===null||t===void 0?void 0:t.currentTime;en.currentTime!==n?(en.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(n)),en.currentTimeStuckAt=void 0),en.currentTime=n):(n!==en.currentTimeStuckAt&&(qe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Tn.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(n))),en.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,o=!1;function c(A){t.state==="running"?l(!1):qr()||Lo()?t.state==="suspended"&&(l(!0),A&&t.resume().then(p,p)):t.state!=="closed"&&(l(!0),A&&t.resume().then(p,p))}function l(A){if(i!==A){i=A;for(let O=0,V=n;O<V.length;O+=1){const U=V[O];A?window.addEventListener(U,m,{capture:!0,passive:!0}):window.removeEventListener(U,m,{capture:!0,passive:!0})}}}function p(){c(!1)}function m(){c(!0)}function E(A){if(!o)if(r.paused)if(A){let O;v(!1),o=!0;try{O=r.play(),O?O.then(y,y):(r.addEventListener("playing",y),r.addEventListener("abort",y),r.addEventListener("error",y))}catch{y()}}else v(!0);else v(!1)}function v(A){if(s!==A){s=A;for(let O=0,V=n;O<V.length;O++){const U=V[O];A?window.addEventListener(U,D,{capture:!0,passive:!0}):window.removeEventListener(U,D,{capture:!0,passive:!0})}}}function y(){r.removeEventListener("playing",y),r.removeEventListener("abort",y),r.removeEventListener("error",y),o=!1,E(!1)}function D(){E(!0)}if(qr()){const A=t.createMediaStreamDestination(),O=document.createElement("div");O.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=O.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=A.stream,E(!0)}en.on(br.STATE_CHANGE,function(){c(!0)}),c(!1)}(bs)}(),!bs)throw new ue(j.NOT_SUPPORTED,"can not create audio context");return bs}return bs}function _h(e){if(function(){if(ab!==null)return ab;const r=Of(),i=r.createBufferSource(),s=r.createGain(),o=r.createGain();i.connect(s),i.connect(o),i.disconnect(s);let c=!1;try{i.disconnect(s)}catch{c=!0}return i.disconnect(),ab=c,c}())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),Oe(o=e._inputNodes).call(o,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,s)):t.call(e,r,i)),e},e.disconnect=(r,i,s)=>{n.call(e),r?Ty(e._inputNodes,r):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let ab=null;function cb(e,t){let n=!1;const r=1/t;if(W("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=Of();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(n)return void(s=null);const c=i.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(i.currentTime+r),e(i.currentTime)};o()}return()=>{n=!0}}class zL{constructor(){se(this,"context",void 0),se(this,"analyserNode",void 0),se(this,"sourceNode",void 0),this.context=Of(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||qr()||Lo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=Ui(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class YL extends bn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),se(this,"outputNode",void 0),se(this,"outputTrack",void 0),se(this,"isPlayed",!1),se(this,"sourceNode",void 0),se(this,"context",void 0),se(this,"audioBufferNode",void 0),se(this,"destNode",void 0),se(this,"audioOutputLevel",0),se(this,"volumeLevelAnalyser",void 0),se(this,"_processedNode",void 0),se(this,"playNode",void 0),se(this,"isDestroyed",!1),se(this,"onNoAudioInput",void 0),se(this,"isNoAudioInput",!1),se(this,"_noAudioInputCount",0),this.context=Of(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),_h(this.outputNode),this.volumeLevelAnalyser=new zL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Rs.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ft().webAudioMediaStreamDest)throw new ue(j.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Cy(()=>{en.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;qr()||Lo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Rr(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class qL extends YL{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),se(this,"sourceNode",void 0),se(this,"track",void 0),se(this,"clonedTrack",void 0),se(this,"audioElement",void 0),se(this,"isCurrentTrackCloned",!1),se(this,"isRemoteTrack",!1),se(this,"originVolumeLevelAnalyser",void 0),se(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),_h(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),_h(this.outputNode),this.emit(Rs.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ue(j.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),_h(this.sourceNode),r){const c=r.clone();c.enabled=!0,this.clonedTrack=c,R.debug("create an unmuted track ".concat(c.id," from the original track ").concat(r.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([c]));_h(l),this.originVolumeLevelAnalyser=new zL,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=xt();n&&o.os===dr.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(en.on(br.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),_h(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Rs.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),en.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),R.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));_h(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function XL(e,t,n){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function yK(e,t){const n=await JL(e.mediaSource),{sourceId:r,audio:i}=await function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ve((c,l)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(V);const U=new Error("NotAllowedError");U.name="NotAllowedError",l(U)};let A=o;const O=document.createElement("div");if(o){const U=document.createElement("input");U.setAttribute("type","checkbox");const G=document.createElement("span");U.setAttribute("style","margin-right: 6px;"),G.innerText="Share audio",U.checked=A,U.onchange=()=>{A=U.checked},O.appendChild(U),O.appendChild(G)}y.appendChild(O),y.appendChild(D),m.appendChild(E),m.appendChild(v),m.appendChild(y);const V=document.createElement("div");V.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),V.appendChild(p),V.appendChild(m),document.body.appendChild(V),s.map(U=>{if(U.id){const G=document.createElement("div");G.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Z=U.thumbnail;try{const{width:Q}=Z.getSize();Q>1920&&(Z=Z.resize({width:1920}))}catch(Q){throw Q&&Q.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Q}G.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Z.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+U.name.replace(/[\u00A0-\u9999<>\&]/g,function(Q){return"&#"+Q.charCodeAt(0)+";"})+"</span>",G.onclick=()=>{document.body.removeChild(V),c({sourceId:U.id,audio:A})},v.appendChild(G)}})})}(n,t);return await XL(r,e,i)}async function JL(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=cL();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ue(j.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new Ve((s,o)=>{n.desktopCapturer.getSources({types:t},(c,l)=>{c?o(c):s(l)})}));try{return await r}catch(s){throw new ue(j.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const lb=new jr("safari");let QL=!1,ZL=!1;async function Is(e,t){let n=0,r=null;for(;n<2;)try{r=await TK(e,t,n>0);break}catch(i){if(i instanceof ue)throw R.error("[".concat(t,"] ").concat(i.toString())),i;const s=Ly(i.name||i.code||i,i.message);if(s.code===j.MEDIA_OPTION_INVALID){R.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Rr(500);continue}throw R.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new ue(j.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function TK(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ue(j.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ft(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return R.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(cL())e.screen.sourceId?Nf(i,await XL(e.screen.sourceId,e.screen,!!e.screenAudio)):Nf(i,await yK(e.screen,!!e.screenAudio));else if(cl()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new ue(j.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const v=await(o=e.screen.extensionId,c=t,new Ve((y,D)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},A=>{if(!A||!A.streamId)return R.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),A),void D(new ue(j.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(A.streamId)})}catch(A){R.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),A.toString()),D(new ue(j.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=v,Nf(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&FL(e.screen.mediaSource);const v={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:O}=e.screen,V={selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:O};!y&&delete V.selfBrowserSurface,!D&&delete V.surfaceSwitching,!A&&delete V.systemAudio,!O&&delete V.preferCurrentTab,R.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:v,audio:e.screenAudio,controls:V})),Nf(i,await navigator.mediaDevices.getDisplayMedia(un({video:v,audio:e.screenAudio},V)))}else{if(!Nn())throw R.error("[".concat(t,"] This browser does not support screenSharing")),new ue(j.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&FL(e.screen.mediaSource);const v={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};R.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(v))),Nf(i,await navigator.mediaDevices.getUserMedia(v))}}var o,c;if(!e.video&&!e.audio)return i;let l={video:e.video,audio:e.audio},p=W("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),l=jw(l,p)}catch{}R.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),xt();let m,E=null;(Nr()||qr()||Sy())&&(E=await lb.lock());try{m=await navigator.mediaDevices.getUserMedia(l)}catch(v){throw E&&E(),v}return l.audio&&(QL=!0),l.video&&(ZL=!0),Nf(i,m),E&&E(),i}function Ly(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ue(j.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ue(j.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ue(j.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ue(j.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ue(j.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ue(j.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return R.error("getUserMedia unexpected error",e),new ue(j.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Nf(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const As=new class extends bn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(mh.STATE_CHANGE,e),this._state=e)}constructor(){super(),se(this,"_state",Lg.IDLE),se(this,"isAccessMicrophonePermission",!1),se(this,"isAccessCameraPermission",!1),se(this,"lastAccessMicrophonePermission",!1),se(this,"lastAccessCameraPermission",!1),se(this,"checkdeviceMatched",!1),se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(W("ENUMERATE_DEVICES_INTERVAL")||(yy()||vy()===dr.HARMONY_OS)&&ll())&&this.updateDevicesInfo()},W("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>R.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ue(j.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(o=!1);let c=null,l=null,p=null;if(!n&&(s||o)){if(lb.isLocked&&(R.debug("[device manager] wait GUM lock"),(await lb.lock())(),R.debug("[device manager] GUM unlock")),QL&&(s=!1,this.isAccessMicrophonePermission=!0),ZL&&(o=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const E=Ly(m.name||m.code||m,m.message);if(E.code===j.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){const E=Ly(m.name||m.code||m,m.message);if(E.code===j.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(o){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){const E=Ly(m.name||m.code||m,m.message);if(E.code===j.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",e,"cam permission",t)}try{const m=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(E=>E.stop()),l&&l.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),c=null,l=null,p=null,m}catch(m){return c&&c.getTracks().forEach(E=>E.stop()),l&&l.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),c=null,l=null,p=null,new ue(j.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new ue(j.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Lg.INITING;try{await this.updateDevicesInfo(),this.state=Lg.INITEND}catch(e){throw R.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Lg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ue(j.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=e.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");i&&s?s.groupId===i.groupId?R.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):R.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):R.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),n.push(o)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Lg.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(mh.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(mh.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(mh.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let db=!1;const Os=new class extends bn{constructor(){super(...arguments),se(this,"onAutoplayFailed",void 0),se(this,"onAudioAutoplayFailed",void 0)}};function $L(){if(xt(),!db){const e=t=>{t.preventDefault(),db=!1,Rg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};db=!0,Rg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Os.onAutoplayFailed?Os.onAutoplayFailed():Os.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Os.emit("autoplay-failed")}}function ex(e,t,n,r){if(!e)return;const i=qe.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,o=Date.now(),c=un(un({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:Os.onAutoplayFailed||Os.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});qe.send({type:yn.AUTOPLAY_FAILED,data:c},!0)}const CK=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Oi=new class{constructor(){se(this,"onAutoplayFailed",void 0),se(this,"elementMap",new Map),se(this,"elementStateMap",new Map),se(this,"elementsNeedToResume",[]),se(this,"sinkIdMap",new Map),se(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(R.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return r.pause(),void r.play();if(en.curState==="running")return _f()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),en.on(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),en.on(br.STATE_CHANGE,()=>{qr()&&en.prevState==="suspended"&&en.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new ue(j.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Fr.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch(c=>{R.warning("[".concat(t,"] set sink id failed"),c.toString())})}catch(c){R.warning("[".concat(t,"] set sink id failed"),c.toString())}const o=i.play();o&&o.then&&o.catch(c=>{r&&ex(r,"audio",c.message,t),R.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Cy(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),$L()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){CK.forEach(n=>{t.addEventListener(n,r=>{const i=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(R.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const o=t?.error;o&&R.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{R.debug("Auto resume audio element success")}).catch(n=>{R.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Ve(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Rg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function kn(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new ue(j.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const c=r.apply(this,s);return c instanceof Ve?new Ve((l,p)=>{c.then(l).catch(p)}):c}),n}}class tx extends bn{constructor(t){super(),se(this,"name","VideoProcessorDestination"),se(this,"ID","0"),se(this,"_source",void 0),se(this,"videoContext",void 0),se(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ue(j.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ue(j.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(mi.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(mi.ON_TRACK,void 0)}}class nx extends bn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"usageRegistry",[]),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Dr(this,ws.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return R.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){R.error(new ue(j.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Ve&&(r=await r),t.push(un(un({},r),{},{direction:this.direction}))}catch(r){R.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class rx extends bn{constructor(t){super(),se(this,"name","AudioProcessorDestination"),se(this,"ID","0"),se(this,"inputTrack",void 0),se(this,"inputNode",void 0),se(this,"audioProcessorContext",void 0),se(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ue(j.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ue(j.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(mi.ON_TRACK,void 0),this.emit(mi.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(mi.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(mi.ON_NODE,this.inputNode))}}class ix extends bn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"audioContext",void 0),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"usageRegistry",[]),se(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Dr(this,ws.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return R.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),sn(this,ws.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){R.error(new ue(j.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Ve&&(r=await r),t.push(un(un({},r),{},{direction:this.direction}))}catch(r){R.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class ub extends bn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),se(this,"context",void 0),se(this,"processSourceNode",void 0),se(this,"outputTrack",void 0),se(this,"processedNode",void 0),se(this,"clonedTrack",void 0),se(this,"outputNode",void 0),this.outputNode=new RK}setVolume(){}createOutputTrack(){throw new ue(j.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class RK{disconnect(){}connect(){}}function sx(e){return new Ve((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=qr()?"canplay":"playing";i.addEventListener(s,()=>{const o=i.videoWidth,c=i.videoHeight;!o&&Nn()||(r=!0,i.srcObject=null,i.remove(),t([o,c]))}),i.srcObject=new MediaStream([e]),i.play().catch(Ry),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function xy(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Uo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!rL()&&n.frameRate&&(t.frameRate=n.frameRate),Xk()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Nn()&&(t.frameRate={ideal:30,max:30}),t}function ox(e){const t={};return rL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,cl()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function ax(e){const t=ox(e);if(e.encoderConfig){const n=Dy(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),yy()&&(t.sampleRate=void 0),t}const wK=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=r,height:c=i}=t;if(!s||!o||!c)return;o=vf(o),c=vf(c),s=vf(s);const{max:l,min:p}=function(y,D,A){const O=200*Math.pow(A/15,.6)*Math.pow(y*D/640/360,.75);return{min:Math.floor(O),max:Math.floor(4*O)}}(o,c,s),{bitrateMax:m,bitrateMin:E}=t||{};m||R.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(m,", brMin: ").concat(E,"]"));const{maxFramerate:v}=W("ENCODER_CONFIG_LIMIT");return v&&typeof v=="number"&&(s=Math.min(s,v)),{frameRate:s,bitrateMax:m||l,bitrateMin:E||p,scaleResolutionDownBy:1,scale:0}},cx=async(e,t,n)=>await(async(r,i,s)=>{const o=function(p){const m=[];for(let E=0;E<p.length;E+=2)m.push(parseInt(p.slice(E,E+2),16));return Uint8Array.from(m)}(vL(""+i+s)).slice(0,16),c=o.slice(0,12),l=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},l,r))})(e.buffer,t,n),hb=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Ve((n,r)=>{t.toBlob(async i=>{if(t.remove(),i){const s=await lx(i);n({buffer:s,width:t.width,height:t.height})}else r(new ue(j.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},lx=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var dx,ux,hx,px,fx,mx,_x,gx,Ex,vx,Sx,yx,Tx,Cx,Rx,wx,bx,Ix,In,Ax,Ox,Nx,Px,Dx,kx,Sc,Lx,xx,Mx,Ux,Vx,jx,Fx,Bx,Wx,Gx,Hx,Kx,zx,Lr;let Ln=(dx=st({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),ux=st({argsMap:(e,t)=>[e.getTrackId(),t]}),hx=kn(),px=Sf("LocalAudioTrack","_enabledMutex"),fx=st({argsMap:(e,t)=>[e.getTrackId(),t]}),mx=kn(),_x=Sf("LocalAudioTrack","_enabledMutex"),gx=st({argsMap:(e,t)=>[e.getTrackId(),t]}),Ex=kn(),vx=kn(),Sx=kn(),yx=st({argsMap:e=>[e.getTrackId()]}),Tx=kn(),Cx=st({argsMap:e=>[e.getTrackId()]}),Rx=kn(),wx=st({argsMap:e=>[e.getTrackId()]}),bx=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ix=st({argsMap:e=>[e.getTrackId()]}),Lt((In=class extends Af{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),se(this,"trackMediaType",If.AUDIO),se(this,"_encoderConfig",void 0),se(this,"_trackSource",void 0),se(this,"metadata",[]),se(this,"_enabled",!0),se(this,"_volume",100),se(this,"_useAudioElement",!0),se(this,"_bypassWebAudio",!1),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_processorDestination",void 0),se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new ub,W("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),W("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Nr()&&!bs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){nn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Oi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,sn(this,Ke.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!VL())throw new ue(j.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await sn(this,Ke.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await sn(this,Ke.NEED_MUTE_TRACK,this):await sn(this,Ke.NEED_UNMUTE_TRACK,this))}getStats(){return vd(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},ib)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),this._source.on(Rs.ON_AUDIO_BUFFER,n=>e(n))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ve.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ue(j.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ue(j.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(mi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await sn(this,Ke.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this))}),e.on(mi.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(mi.ON_TRACK),e.removeAllListeners(mi.ON_NODE)}bindProcessorContextEvents(e){e.on(ws.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(ws.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof ub&&(this._trackSource=new qL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new ix(this._source.context,this.getTrackId(),"local"),t=new rx(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Rs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Oi.stop(this.getTrackId()),this._source.play()),sn(this,Ke.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[dx],Object.getOwnPropertyDescriptor(In.prototype,"setVolume"),In.prototype),Lt(In.prototype,"setPlaybackDevice",[ux,hx],Object.getOwnPropertyDescriptor(In.prototype,"setPlaybackDevice"),In.prototype),Lt(In.prototype,"setEnabled",[px,fx,mx],Object.getOwnPropertyDescriptor(In.prototype,"setEnabled"),In.prototype),Lt(In.prototype,"setMuted",[_x,gx,Ex],Object.getOwnPropertyDescriptor(In.prototype,"setMuted"),In.prototype),Lt(In.prototype,"getStats",[vx],Object.getOwnPropertyDescriptor(In.prototype,"getStats"),In.prototype),Lt(In.prototype,"setAudioFrameCallback",[Sx],Object.getOwnPropertyDescriptor(In.prototype,"setAudioFrameCallback"),In.prototype),Lt(In.prototype,"play",[yx,Tx],Object.getOwnPropertyDescriptor(In.prototype,"play"),In.prototype),Lt(In.prototype,"stop",[Cx,Rx],Object.getOwnPropertyDescriptor(In.prototype,"stop"),In.prototype),Lt(In.prototype,"close",[wx],Object.getOwnPropertyDescriptor(In.prototype,"close"),In.prototype),Lt(In.prototype,"pipe",[bx],Object.getOwnPropertyDescriptor(In.prototype,"pipe"),In.prototype),Lt(In.prototype,"unpipe",[Ix],Object.getOwnPropertyDescriptor(In.prototype,"unpipe"),In.prototype),In),xg=(Ax=st({argsMap:(e,t)=>[e.getTrackId(),t]}),Ox=kn(),Nx=Sf("MicrophoneAudioTrack","_enabledMutex"),Px=st({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Dx=kn(),kx=st({argsMap:e=>[e.getTrackId()]}),Lt((Sc=class extends Ln{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Dy(t.encoderConfig):{},r,W("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),se(this,"_config",void 0),se(this,"_deviceName","default"),se(this,"_constraints",void 0),se(this,"_originalConstraints",void 0),se(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(_f()||Dw())&&en.bindInterruptDetectorTrack(this)}async setDevice(e){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await As.getDeviceById(e),n={};n.audio=un({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Is(n,this.getTrackId())}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Is({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await As.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}R.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),e),W("AUTO_RESET_AUDIO_ROUTE")&&(qr()||Lo())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(o){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=un({},this._constraints),s=As.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const o=await Is({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await sn(this,Ke.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(_f()||Dw())&&en.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((qr()||Lo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const e=async()=>{en.off(br.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(br.IOS_INTERRUPTION_END,e)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(bf.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=As.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Is({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(ws.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(ws.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Ax,Ox],Object.getOwnPropertyDescriptor(Sc.prototype,"setDevice"),Sc.prototype),Lt(Sc.prototype,"setEnabled",[Nx,Px,Dx],Object.getOwnPropertyDescriptor(Sc.prototype,"setEnabled"),Sc.prototype),Lt(Sc.prototype,"close",[kx],Object.getOwnPropertyDescriptor(Sc.prototype,"close"),Sc.prototype),Sc),bK=(Lx=st({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),xx=kn(),Mx=st({argsMap:e=>[e.getTrackId()]}),Ux=kn(),Vx=st({argsMap:e=>[e.getTrackId()]}),jx=kn(),Fx=st({argsMap:e=>[e.getTrackId()]}),Bx=kn(),Wx=st({argsMap:e=>[e.getTrackId()]}),Gx=kn(),Hx=st({argsMap:e=>[e.getTrackId()]}),Kx=st({argsMap:e=>[e.getTrackId()]}),zx=kn(),Lt((Lr=class extends Ln{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),se(this,"source",void 0),se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Rs.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(bf.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){nn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Lx,xx],Object.getOwnPropertyDescriptor(Lr.prototype,"startProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"pauseProcessAudioBuffer",[Mx,Ux],Object.getOwnPropertyDescriptor(Lr.prototype,"pauseProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"seekAudioBuffer",[Vx,jx],Object.getOwnPropertyDescriptor(Lr.prototype,"seekAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"resumeProcessAudioBuffer",[Fx,Bx],Object.getOwnPropertyDescriptor(Lr.prototype,"resumeProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"stopProcessAudioBuffer",[Wx,Gx],Object.getOwnPropertyDescriptor(Lr.prototype,"stopProcessAudioBuffer"),Lr.prototype),Lt(Lr.prototype,"close",[Hx],Object.getOwnPropertyDescriptor(Lr.prototype,"close"),Lr.prototype),Lt(Lr.prototype,"setAudioBufferPlaybackSpeed",[Kx,zx],Object.getOwnPropertyDescriptor(Lr.prototype,"setAudioBufferPlaybackSpeed"),Lr.prototype),Lr);class $n extends Ln{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Of().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,on(8,"track-mix-")),se(this,"trackList",void 0),se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(R.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):R.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){R.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Ty(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof $n?n.emit(fh.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class IK extends YL{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Rs.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),se(this,"audioBuffer",void 0),se(this,"sourceNode",void 0),se(this,"startPlayTime",0),se(this,"startPlayOffset",0),se(this,"pausePlayTime",0),se(this,"options",void 0),se(this,"currentLoopCount",0),se(this,"currentPlaybackSpeed",100),se(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Yx=new Map;function qx(e,t){if(e.length===0||t.length===0)return 1/0;const n=Fw(e),r=Fw(t);return Math.floor(r/n)}class pb{get rendFrameRate(){const t=Math.max(1,qx(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Fr.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){se(this,"trackId",void 0),se(this,"config",void 0),se(this,"onFirstVideoFrameDecoded",void 0),se(this,"onFirstVideoFrameRender",void 0),se(this,"onVideoStateChanged",void 0),se(this,"freezeTimeCounterList",[]),se(this,"renderFreezeAccTime",0),se(this,"renderFreezeAccTime2",0),se(this,"isKeepLastFrame",!1),se(this,"isDestroyed",!1),se(this,"timeUpdatedCount",0),se(this,"freezeTime",0),se(this,"playbackTime",0),se(this,"lastTimeUpdatedTime",0),se(this,"autoplayFailed",!1),se(this,"videoTrack",void 0),se(this,"videoElement",void 0),se(this,"cacheVideoElement",void 0),se(this,"internal",!1),se(this,"_render_interframe_delays",[]),se(this,"_render_interframe_delays_sizes",[]),se(this,"_videoState",vc.VideoStateStopped),se(this,"videoElementCheckInterval",void 0),se(this,"videoElementFreezeTimeout",void 0),se(this,"_videoElementStatus",Fr.NONE),se(this,"_isInPage",!0),se(this,"isGettingVideoDimensions",!1),se(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&en.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Yk())),tL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),se(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Fr.PLAYING;break;case"loadeddata":if(this.videoState=vc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Fr.CANPLAY;break;case"stalled":this.videoElementStatus=Fr.STALLED;break;case"suspend":this.videoElementStatus=Fr.SUSPEND;break;case"pause":this.videoElementStatus=Fr.PAUSED,qr()||Lo()||Nr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Fr.WAITING;break;case"abort":this.videoElementStatus=Fr.ABORT;break;case"ended":this.videoElementStatus=Fr.ENDED;break;case"emptied":this.videoElementStatus=Fr.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=Fr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,yc.lastVisibleTime<yc.lastHiddenTime||s<yc.lastHiddenTime||s<yc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>W("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Yk())),tL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),en.on(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&ex(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),i)});const r=xt();if((r.name==="Safari"&&Number(r.version)===15||_f())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return R.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new Ve((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const l=await lx(c);s({buffer:l,width:r.width,height:r.height})}else o(new ue(j.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await hb(t)}destroy(){this.isDestroyed=!0,en.off(br.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.off(br.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=vc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Fr.INIT,!this.videoElementCheckInterval&&(Xx.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(s){return s!==document.body&&document.body.contains(s)}(this.videoElement)},1e3),W("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,W("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===vc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=vc.VideoStateFrozen:document.addEventListener("visibilitychange",o))},l=(p,m)=>{if(this.videoElementStatus===Fr.PLAYING){if(s){const y=m.presentationTime-s.presentationTime,D=m.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(D),this._render_interframe_delays.push(y);const A=Fw(this._render_interframe_delays_sizes),O=A-this._render_interframe_delays_sizes[0];if(A>30&&O>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===vc.VideoStateStarting&&(this.videoState=vc.VideoStateDecoding),this.videoState===vc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,W("VIDEO_FREEZE_DURATION"))),y<W("VIDEO_FREEZE_DURATION")&&this.videoState===vc.VideoStateFrozen&&(this.videoState=vc.VideoStateDecoding),y>W("VIDEO_FREEZE_DURATION")&&yc.lastVisibleTime>=yc.lastHiddenTime&&s.timestamp>yc.lastVisibleTime&&s.timestamp>yc.lastHiddenTime){const V=Math.min(66,qx(this._render_interframe_delays_sizes,this._render_interframe_delays)),U=Math.max(0,y-(D-1)*V);this.renderFreezeAccTime2+=U>V?U:0,this.renderFreezeAccTime+=y}}s=un(un({},m),{},{timestamp:p})}else this.isSkipCalcRenderFreezeTime()&&(s=un(un({},m),{},{timestamp:p}));var E,v;W("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(v=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(v,l))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,l)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),yy()&&!W("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=xt();r.name==="Safari"&&Number(r.version)===15||_f()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{R.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){Xx.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Fr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Fr.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{R.error(r)}),this.autoplayFailed=!1,Rg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Rg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),$L()}}const Xx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class fb extends pb{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),se(this,"container",void 0),se(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await hb(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",W("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Jx,Qx,Zx,$x,eM,tM,nM,rM,iM,sM,oM,aM,cM,lM,dM,uM,hM,pM,fM,mM,_M,gM,EM,vM,SM,yM,TM,CM,It,RM,wM,bM,IM,AM,OM,NM,PM,Ns;let mn=(Jx=st({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Qx=kn(),Zx=st({argsMap:e=>[e.getTrackId()]}),$x=Sf("LocalVideoTrack","_enabledMutex"),eM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),tM=kn(),nM=Sf("LocalVideoTrack","_enabledMutex"),rM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),iM=kn(),sM=st({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),oM=kn(),aM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),cM=kn(),lM=kn(),dM=st({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),uM=kn(),hM=kn(),pM=kn(),fM=st({argsMap:e=>[e.getTrackId()]}),mM=kn(),_M=kn(),gM=kn(),EM=kn(),vM=kn(),SM=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),yM=st({argsMap:e=>[e.getTrackId()]}),TM=st({argsMap:e=>[e.getTrackId()]}),CM=st({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),It=class fF extends Af{get videoHeight(){if(Nr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Nr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,s,o){if(super(t,s),se(this,"trackMediaType",If.VIDEO),se(this,"_player",void 0),se(this,"isUseScaleResolutionDownBy",!1),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"_encoderConfig",void 0),se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),se(this,"_optimizationMode",void 0),se(this,"_saveEncodeBitrateRatio",1),se(this,"_videoHeight",void 0),se(this,"_videoWidth",void 0),se(this,"_forceBitrateLimit",void 0),se(this,"_enabled",!0),se(this,"_processorDestination",void 0),se(this,"_processorContext",void 0),Nr()){const{width:c,height:l}=t.getSettings();this._videoWidth=c,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],n&&this._hints.indexOf(rn.CUSTOM_TRACK)!==-1?this._encoderConfig=Cn(n):this._encoderConfig=n,this._hints.indexOf(rn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Iw(Wt.CHROME,115)&&vy().indexOf("Windows")!==-1){const c=function(l,p){if("VideoFrame"in window&&"TransformStream"in window&&Ft().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(l),E=new MediaStreamTrackGenerator({kind:"video"});let v,y,D=Date.now();const A=()=>{O&&(clearInterval(O),O=void 0),v&&(v.close(),v=void 0),l.stop(),y=void 0,E.removeEventListener("ended",A)};let O=window.setInterval(()=>{if(y&&v&&Date.now()-D>1e3)try{E.readyState==="live"?y.enqueue(v.clone()):A()}catch{A()}},1e3);const V=new TransformStream({transform:(U,G)=>{E.readyState==="live"?(y=G,D=Date.now(),v===void 0?(v=U,G.enqueue(U.clone())):(G.enqueue(v),v=U)):U.close()}});return E.addEventListener("ended",A),m.readable.pipeThrough(V).pipeTo(E.writable),E}}(t);c&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}n&&this._hints.indexOf(rn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new nx(this.getTrackId(),"local"),this._processorDestination=new tx(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=un(un(un({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new pb(r):this._player=new fb(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(bf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sn(this,Ke.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await sn(this,Ke.NEED_MUTE_TRACK,this):await sn(this,Ke.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ue(j.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Uo(t),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=xy({encoderConfig:t});(Nr()||qr()||Lo())&&(r.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new ue(j.UNEXPECTED_ERROR,i.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(R)}}getStats(){return vd(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},sb)}async setBeautyEffect(t){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await hb(t)}async findClosestProfile(){const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:o}=this._encoderConfig||{},c=vf(this._videoWidth||t||i||0),l=vf(this._videoHeight||n||s||0),p=function(m,E,v){if(!Array.isArray(W("VIDEO_ENCODER_CONFIG_LIST"))||W("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const y=Math.min(m,E);return!(y>=480)&&un(un({},W("VIDEO_ENCODER_CONFIG_LIST").find(D=>D.height>y)),{},{frameRate:v})}(c,l,vf(r||o||15));if(p)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(l," => ").concat(JSON.stringify(p))),this.setEncoderConfiguration(p)}async setBitrateLimit(t){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void R.error(j.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await sn(this,Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return R.error(j.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){sx(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Ry)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ue(j.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Uo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:c}=function(l,p,m,E,v){const y=W("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:E,max:v};if(v===void 0){const D=Math.floor(200*Math.pow(m/15,.6)*Math.pow(l*p/640/360,.75));v=y==="STANDARD_BITRATE"?4*D:2*D,E=E??D}else E=E??Math.floor(v/10);return{min:E,max:v}}(t,n,r,s,i);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,W("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){const[l,p]=function(m,E,v){const y=4*Math.floor(2e5*Math.pow(v/15,.6)*Math.pow(m*E/230400,.75)),D=m*E,A=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),O=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let V=rs(A).call(A).next().value,U=1;if(A.has(D))V=A.get(D);else{var G;const Re=th(G=Array.from(A.entries())).call(G,(bt,ut)=>{let[Yt]=bt,[Ht]=ut;return Yt-Ht}),Ct=Re.find(bt=>{let[ut]=bt;return ut>D});if(Ct){const bt=Re.indexOf(Ct);if(bt>0){const ut=Re[bt-1],Yt=(D-ut[0])/(Ct[0]-ut[0]);V=ut[1]+Yt*(Ct[1]-ut[1])}else V=Ct[1]}else V=Re[Re.length-1][1]}if(O.has(D))U=O.get(D);else{var Z;const Re=th(Z=Array.from(O.entries())).call(Z,(bt,ut)=>{let[Yt]=bt,[Ht]=ut;return Yt-Ht}),Ct=Re.find(bt=>{let[ut]=bt;return ut>D});if(Ct){const bt=Re.indexOf(Ct);if(bt>0){const ut=Re[bt-1],Yt=(D-ut[0])/(Ct[0]-ut[0]);U=ut[1]+Yt*(Ct[1]-ut[1])}else U=Ct[1]}else U=Re[Re.length-1][1]}const Q=W("VIDEO_NEW_BITRATE_RATIO");Q&&Q>0&&(V=Q/100);const z=Math.floor(y*V),re=Math.floor(65e4*Math.pow(m*E/230400,.5)*Math.pow(v/15,.69));let he=z;const Ee=W("VIDEO_STANDARD_BITRATE_VERSION");return Ee&&Ee>0&&(Ee===1?he=y:Ee===2?he=z:Ee===3&&(he=re)),[Math.floor(he/1e3),U]}(t,n,r);this._encoderConfig.bitrateMax=l,this._encoderConfig.bitrateMin=c?Math.min(c,l):l,this._saveEncodeBitrateRatio=p,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r?.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=oL.checkOneElementVisible(s),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const p=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(r){throw new ue(j.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ue(j.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=un(un({},r),Uo(t))),r=dh(r);const i=on(8,"track-video-cloned-"),s=new fF(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,dh(this._scalabilityMode),this._optimizationMode,i,dh(this._hints));return t&&r&&s.setEncoderConfiguration(r),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new ue(j.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ue(j.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(vd(()=>{qe.reportApiInvoke(null,{name:xn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Tn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!W("ENABLE_VIDEO_SEI")||!W("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ue(j.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void R.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):R.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(mi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Ke.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ws.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ws.REQUEST_CONSTRAINTS)}},Lt(It.prototype,"play",[Jx,Qx],Object.getOwnPropertyDescriptor(It.prototype,"play"),It.prototype),Lt(It.prototype,"stop",[Zx],Object.getOwnPropertyDescriptor(It.prototype,"stop"),It.prototype),Lt(It.prototype,"setEnabled",[$x,eM,tM],Object.getOwnPropertyDescriptor(It.prototype,"setEnabled"),It.prototype),Lt(It.prototype,"setMuted",[nM,rM,iM],Object.getOwnPropertyDescriptor(It.prototype,"setMuted"),It.prototype),Lt(It.prototype,"setSaveEncodeBitrateRatio",[sM,oM],Object.getOwnPropertyDescriptor(It.prototype,"setSaveEncodeBitrateRatio"),It.prototype),Lt(It.prototype,"setEncoderConfiguration",[aM,cM],Object.getOwnPropertyDescriptor(It.prototype,"setEncoderConfiguration"),It.prototype),Lt(It.prototype,"getStats",[lM],Object.getOwnPropertyDescriptor(It.prototype,"getStats"),It.prototype),Lt(It.prototype,"setBeautyEffect",[dM,uM],Object.getOwnPropertyDescriptor(It.prototype,"setBeautyEffect"),It.prototype),Lt(It.prototype,"getCurrentFrameData",[hM],Object.getOwnPropertyDescriptor(It.prototype,"getCurrentFrameData"),It.prototype),Lt(It.prototype,"getCurrentFrameImage",[pM],Object.getOwnPropertyDescriptor(It.prototype,"getCurrentFrameImage"),It.prototype),Lt(It.prototype,"findClosestProfile",[fM,mM],Object.getOwnPropertyDescriptor(It.prototype,"findClosestProfile"),It.prototype),Lt(It.prototype,"setBitrateLimit",[_M],Object.getOwnPropertyDescriptor(It.prototype,"setBitrateLimit"),It.prototype),Lt(It.prototype,"setOptimizationMode",[gM],Object.getOwnPropertyDescriptor(It.prototype,"setOptimizationMode"),It.prototype),Lt(It.prototype,"setScalabiltyMode",[EM],Object.getOwnPropertyDescriptor(It.prototype,"setScalabiltyMode"),It.prototype),Lt(It.prototype,"updateMediaStreamTrackResolution",[vM],Object.getOwnPropertyDescriptor(It.prototype,"updateMediaStreamTrackResolution"),It.prototype),Lt(It.prototype,"pipe",[SM],Object.getOwnPropertyDescriptor(It.prototype,"pipe"),It.prototype),Lt(It.prototype,"unpipe",[yM],Object.getOwnPropertyDescriptor(It.prototype,"unpipe"),It.prototype),Lt(It.prototype,"close",[TM],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),Lt(It.prototype,"replaceTrack",[CM],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),It),My=(RM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),wM=kn(),bM=Sf("CameraVideoTrack","_enabledMutex"),IM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),AM=kn(),OM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),NM=kn(),PM=st({argsMap:e=>[e.getTrackId()]}),Ns=class mF extends mn{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,s,o){super(t,Uo(n.encoderConfig),i,s,o),se(this,"_config",void 0),se(this,"_originalConstraints",void 0),se(this,"_constraints",void 0),se(this,"_enabled",!0),se(this,"_deviceName","default"),se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(_f()||Dw())&&!function(){const c=xt();if(c.os!==dr.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&nL()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Uo(this._config.encoderConfig),en.on(br.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.on(br.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await As.getDeviceById(t),r={};r.video=un({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Is(r,this.getTrackId())}catch(s){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Is({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await As.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:un(un({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Is(n,this.getTrackId())}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Is({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=un({},n.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Is({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await sn(this,Ke.NEED_ENABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await sn(this,Ke.NEED_DISABLE_TRACK,this)}catch(r){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ue(j.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Uo(t),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Cn(this._config);r.encoderConfig=t;const i=xy(r);(Nr()||qr()||Lo())&&(i.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new ue(j.UNEXPECTED_ERROR,s.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((qr()||Lo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const t=async()=>{en.off(br.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(br.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(bf.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=As.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await Is({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),en.off(br.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.off(br.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=un(un({},r),Uo(t))),r=dh(r);const i=on(8,"track-cam-cloned-"),s=new mF(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,dh(un(un({},this._config),{},{encoderConfig:r})),dh(this._constraints),dh(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(ws.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(ws.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Lt(Ns.prototype,"setDevice",[RM,wM],Object.getOwnPropertyDescriptor(Ns.prototype,"setDevice"),Ns.prototype),Lt(Ns.prototype,"setEnabled",[bM,IM,AM],Object.getOwnPropertyDescriptor(Ns.prototype,"setEnabled"),Ns.prototype),Lt(Ns.prototype,"setEncoderConfiguration",[OM,NM],Object.getOwnPropertyDescriptor(Ns.prototype,"setEncoderConfiguration"),Ns.prototype),Lt(Ns.prototype,"close",[PM],Object.getOwnPropertyDescriptor(Ns.prototype,"close"),Ns.prototype),Ns);function mb(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=un(un({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?R.debug("[".concat(e,"] set content hint to"),n.optimizationMode):R.debug("[".concat(e,"] set content hint failed")))):R.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var DM,kM,LM,xM,eo,MM,UM,VM,jM,FM,BM,ri;class WM extends HL{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(on(5,""))),se(this,"_userId",void 0),se(this,"_uintId",void 0),se(this,"_isDestroyed",!1),se(this,"store",void 0),se(this,"processor",void 0),se(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Pf=(DM=st({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),kM=st({argsMap:e=>[e.getTrackId()]}),LM=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),xM=st({argsMap:e=>[e.getTrackId()]}),Lt((eo=class extends WM{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Fr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"trackMediaType",If.VIDEO),se(this,"_videoWidth",void 0),se(this,"_videoHeight",void 0),se(this,"_player",void 0),se(this,"_prePlayer",void 0),se(this,"processorDestination",void 0),se(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new nx(this.getTrackId(),"remote"),this.processorDestination=new tx(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return vd(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},WL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit($s.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=un(un({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new pb(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new fb(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit($s.FIRST_FRAME_DECODED),i&&this.safeEmit($s.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit($s.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit($s.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit($s.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){sx(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Ry)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=oL.checkOneElementVisible(i),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const l=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new ue(j.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ue(j.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mi.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(fh.SEI_RECEIVED,e)}}).prototype,"play",[DM],Object.getOwnPropertyDescriptor(eo.prototype,"play"),eo.prototype),Lt(eo.prototype,"stop",[kM],Object.getOwnPropertyDescriptor(eo.prototype,"stop"),eo.prototype),Lt(eo.prototype,"pipe",[LM],Object.getOwnPropertyDescriptor(eo.prototype,"pipe"),eo.prototype),Lt(eo.prototype,"unpipe",[xM],Object.getOwnPropertyDescriptor(eo.prototype,"unpipe"),eo.prototype),eo),Df=(MM=st({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),UM=st({argsMap:(e,t)=>[e.getTrackId(),t]}),VM=st({argsMap:e=>[e.getTrackId()]}),jM=st({argsMap:e=>[e.getTrackId()]}),FM=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),BM=st({argsMap:e=>[e.getTrackId()]}),Lt((ri=class extends WM{get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),se(this,"trackMediaType",If.AUDIO),se(this,"_source",void 0),se(this,"_useAudioElement",!0),se(this,"_volume",100),se(this,"processorContext",void 0),se(this,"processorDestination",void 0),se(this,"_played",!1),se(this,"_bypassWebAudio",!1),W("DISABLE_WEBAUDIO")?(this._source=new ub,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new qL(e,!0),W("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Rs.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit($s.FIRST_FRAME_DECODED)}),this.processorContext=new ix(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new rx(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Rs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Rs.ON_AUDIO_BUFFER),this._source.on(Rs.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Oi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!VL())throw new ue(j.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return vd(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ts(this,Ke.GET_STATS)||un({},BL)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ue(j.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ue(j.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ue(j.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(mi.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mi.ON_TRACK),this.processorDestination.removeAllListeners(mi.ON_NODE)}}).prototype,"setVolume",[MM],Object.getOwnPropertyDescriptor(ri.prototype,"setVolume"),ri.prototype),Lt(ri.prototype,"setPlaybackDevice",[UM],Object.getOwnPropertyDescriptor(ri.prototype,"setPlaybackDevice"),ri.prototype),Lt(ri.prototype,"play",[VM],Object.getOwnPropertyDescriptor(ri.prototype,"play"),ri.prototype),Lt(ri.prototype,"stop",[jM],Object.getOwnPropertyDescriptor(ri.prototype,"stop"),ri.prototype),Lt(ri.prototype,"pipe",[FM],Object.getOwnPropertyDescriptor(ri.prototype,"pipe"),ri.prototype),Lt(ri.prototype,"unpipe",[BM],Object.getOwnPropertyDescriptor(ri.prototype,"unpipe"),ri.prototype),ri);const yc=new class extends bn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),se(this,"_lastHiddenTime",0),se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class GM extends bn{constructor(t,n){super(),se(this,"trackMediaType",If.DATA),se(this,"_version",1),se(this,"_type",3),se(this,"_config",void 0),se(this,"_originDataChannel",void 0),se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),se(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),se(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return W("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ve((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;n(new ue(j.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new ue(j.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ue(j.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[ky.OPEN,ky.CLOSE,ky.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class AK extends GM{constructor(t){super(t),se(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(W("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(ky.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class OK extends GM{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function Uy(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>MS.revokeObjectURL(e),0),new Worker(MS.createObjectURL(e))}const HM=71,_b=1,gb=2,Eb=1,KM=2;var Td=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Td||{});function vb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==HM)return;const r=e.getUint16(1),i=_b+gb+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const o={m:n,tlvLen:r,tlv:[],frame:s};let c=_b+gb;for(;c<i;){const l=e.getUint8(c),p=e.getUint16(c+Eb),m=Eb+KM;if(l===Td.AUDIO_LEVEL){let E=e.getUint8(c+m);for(let v=1;v<p;v++)E=E<<8|e.getUint8(c+m+v);o.tlv.push({tag:l,length:p,value:t?127^E>>1:127&E})}else if(l===Td.METADATA||l===Td.AUDIO_64_BIT_PTS){const E=new Uint8Array(p);for(let v=0;v<p;v++)E[v]=e.getUint8(c+m+v);o.tlv.push({tag:l,length:p,value:E})}c+=m+p}return o}const Vy=new Map,jy=127,gh=1e-10,Sb=139/13,Fy=new Map;function yb(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;return Fy.has(r)?i=Fy.get(r):(i=Math.log(function(o,c){const l=o-c;c<l&&(c=l);let p=1;for(let m=o,E=1;m>c;m--,E++)p=p*m/E;return p}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,Fy.set(r,i)),i<gh&&(i=gh),i}function zM(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let o=0,c=0;o<r;o++){let l=0;for(let p=c+i;c<p;c++)e[c]>n&&l++;t[o]!==l&&(t[o]=l,s=!0)}return s}window.cache=Fy;let NK=0;class YM{constructor(t){se(this,"id",void 0),se(this,"immediates",[]),se(this,"lastNonSilence",-1),se(this,"immediateSpeechActivityScore",gh),se(this,"lastLevelChangedTime",Date.now()),se(this,"levels",[]),se(this,"longs",[]),se(this,"longSpeechActivityScore",gh),se(this,"mediums",[]),se(this,"mediumSpeechActivityScore",gh),se(this,"minLevel",0),se(this,"nextMinLevel",0),se(this,"nextMinLevelWindowLength",0),se(this,"energyScore",0),this.id=t||"".concat(NK++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+Sb;let i=!1;for(let s=0;s<t.length;++s){let o=n[s];o<r&&(o=0);const c=Math.floor(o/Sb);t[s]!==c&&(t[s]=c,i=!0)}return i}computeLongs(){return zM(this.mediums,this.longs,4)}computeMediums(){return zM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=yb(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=yb(this.longs[0],10,47),this.longSpeechActivityScore>gh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=yb(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Cu(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>jy&&(r=jy),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+Sb?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>jy&&(n=jy),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class PK{constructor(t){se(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Tb{constructor(t,n,r){se(this,"isDominant",void 0),se(this,"energyRanking",void 0),se(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class DK extends bn{constructor(t){super(),se(this,"dominantId",null),se(this,"lastDecisionTime",0),se(this,"lastLevelChangedTime",0),se(this,"lastLevelIdleTime",0),se(this,"relativeSpeechActivities",[]),se(this,"speakers",new Map),se(this,"enableSilence",!1),se(this,"timeoutToSilenceInterval",0),se(this,"decisionMaker",null),se(this,"loudest",[]),se(this,"numLoudestToTrack",3),se(this,"energyExpireTimeMs",250),se(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=i.levelChanged(n,r);return this.updateLoudestList(i,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new YM(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const i=t.id===this.dominantId;if(n<0){let l=0;for(;l<this.loudest.length&&this.loudest[l]!==t;)++l;return new Tb(i,l,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new Tb(i,0,t.energyScore);const s=r-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const l=this.loudest[o];if(l.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(l.id!==t.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<t.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Tb(i,c,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new PK(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const i=this.speakers.size;let s=null;if(i===0)s=null;else if(i===1){var o;const c=rs(o=this.speakers).call(o).next().value;this.enableSilence&&c&&(s=c.id,c.evaluateSpeechActivityScores(t),t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){const m=this.speakers.entries().next();m.value&&(s=m.value[0],c=m.value[1])}else s=c.id;c?.evaluateSpeechActivityScores(t);const l=this.relativeSpeechActivities;let p=2;for(const m of this.speakers.entries()){const[E,v]=m;if(v===c)continue;v.evaluateSpeechActivityScores(t);for(let O=0;O<l.length;++O){const V=c==null?gh:c.getSpeechActivityScore(O);l[O]=Math.log(v.getSpeechActivityScore(O)/V)}const y=l[0],D=l[1],A=l[2];y>3&&D>2&&A>0&&D>p&&(p=D,s=E)}this.enableSilence&&c!=null&&s===c.id&&t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const n=[];for(const i of rs(r=this.speakers).call(r)){var r;const s=t-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<s&&i.levelTimedOut()}n.forEach(i=>this.speakers.delete(i))}}const kf=new Map;let Sa=null,By=null;const qM=3;let Eh=[];const ya=new Map,Wy=new Map;class kK{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){se(this,"id",void 0),se(this,"track",void 0),se(this,"score",0),se(this,"active",!0),se(this,"muted",!1),se(this,"timer",0),se(this,"actives",0),se(this,"inactives",0),this.id=t,this.track=n,this.setActive(ya.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=function(){const i=[],s=[];return Array.from(rs(ya).call(ya)).forEach(o=>{o.active?i.push(o):s.push(o)}),{actives:i,inactives:s}}();if(n.length>3){let i;n.forEach(s=>{(!i||i.score>s.score)&&(i=s)}),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach(s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let r;return Array.from(rs(ya).call(ya)).forEach(i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let r;return Array.from(rs(ya).call(ya)).forEach(i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Gy;function XM(e){const t=ya.get(e);t&&(ya.delete(e),t.clearTimer())}const Hy=new Map,LK=new Map,Cb="video/h264",Rb="video/h265";function JM(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function QM(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function ZM(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?Rb:(31&r)<=31?Cb:""}const Ky=new Map,Mg=new Map;(function(){const e=xt();wr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),wr.getStreamFromExtension=e.name===Wt.CHROME&&Number(e.version)>34,wr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),wr.supportMinBitrate=e.name===Wt.CHROME||e.name===Wt.EDGE,wr.supportSetRtpSenderParameters=function(){const t=xt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ll()||!(!Nr()&&!Sy())||t.name===Wt.FIREFOX&&Number(t.version)>=64)}(),e.name===Wt.SAFARI&&(Number(e.version)>=14?wr.supportDualStream=!0:wr.supportDualStream=!1),wr.webAudioMediaStreamDest=function(){const t=xt();return!(t.name===Wt.SAFARI&&Number(t.version)<12)}(),wr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",wr.supportWebGL=typeof WebGLRenderingContext<"u",wr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ll()||(wr.webAudioWithAEC=!0),wr.supportShareAudio=function(){const t=xt();return(t.os===dr.WIN_10||t.os===dr.WIN_81||t.os===dr.WIN_7||t.os===dr.LINUX||t.os===dr.MAC_OS||t.os===dr.CHROMIUM_OS)&&t.name===Wt.CHROME&&Number(t.version)>=74}(),wr.supportDataChannel=!!(mf(76)||Ow(68)||Qk(14)),wr.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Nn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),wr.supportWebRTCEncodedTransform=mf(87)||qk()||Ow(117),wr.supportWebRTCInsertableStream=function(){const t=xt();return(t.name===Wt.CHROME||t.name===Wt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),wr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,wr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Cy(()=>{wr.supportDualStreamEncoding=function(){const t=xt();return!!W("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&W("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",e),R.info("browser compatibility: ",wr)})})();const xK=["CHINA","GLOBAL"],$M=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],vh=[],Lf=[];function Sh(e,t){return!!t&&vh.some(n=>n.uid===e&&n.channelName===t)}function wb(){return Lf.length>0}var MK=pD.forEach,eU=gu("forEach")?[].forEach:function(e){return MK(this,e,arguments.length>1?arguments[1]:void 0)};qt({target:"Array",proto:!0,forced:[].forEach!==eU},{forEach:eU});var UK=Qi("Array","forEach"),VK=Xo,jK=fr,FK=q,BK=UK,bb=Array.prototype,WK={DOMTokenList:!0,NodeList:!0},GK=function(e){var t=e.forEach;return e===bb||FK(bb,e)&&t===bb.forEach||jK(WK,VK(e))?BK:t},HK=S(GK),KK=go,tU=wi;qt({target:"Object",stat:!0,forced:C(function(){tU(1)})},{keys:function(e){return tU(KK(e))}});var zK=S(Jr.Object.keys),YK=S(zn),qK=S(Tu),XK=qt,nU=Jo,JK=Or,QK=pr,rU=km,ZK=Ya,$K=ps,ez=dR,tz=An,nz=yr,rz=rD("slice"),iz=tz("species"),Ib=Array,sz=Math.max;XK({target:"Array",proto:!0,forced:!rz},{slice:function(e,t){var n,r,i,s=$K(this),o=ZK(s),c=rU(e,o),l=rU(t===void 0?o:t,o);if(nU(s)&&(n=s.constructor,(JK(n)&&(n===Ib||nU(n.prototype))||QK(n)&&(n=n[iz])===null)&&(n=void 0),n===Ib||n===void 0))return nz(s,c,l);for(r=new(n===void 0?Ib:n)(sz(l-c,0)),i=0;c<l;c++,i++)c in s&&ez(r,i,s[c]);return r.length=i,r}});var oz=Qi("Array","slice"),az=q,cz=oz,Ab=Array.prototype,lz=function(e){var t=e.slice;return e===Ab||az(Ab,e)&&t===Ab.slice?cz:t},dz=S(lz);function Ye(e,t,n,r,i){var s,o,c,l={};return HK(s=zK(r)).call(s,function(p){l[p]=r[p]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=YK(o=qK(c=dz(n).call(n)).call(c)).call(o,function(p,m){return m(e,t,p)||p},l),i&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(i):void 0,l.initializer=void 0),l.initializer===void 0?($P(e,t,l),null):l}let zy=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Ob=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Vo=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),_i=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),nt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),hn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ht=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),ct=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Ug=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Pt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),gi=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),vt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Yy(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw R.error("Invalid Channel Name ".concat(e)),new ae(j.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function qy(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||sL(e,1,255)))throw new ae(j.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ul=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const uz={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Nb={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Pb(e,t){Cr(e.url,"".concat(t,".url"),1,1e3,!1),Pn(e.x)||nn(e.x,"".concat(t,".x"),0,1e4),Pn(e.y)||nn(e.y,"".concat(t,".y"),0,1e4),Pn(e.width)||nn(e.width,"".concat(t,".width"),0,1e4),Pn(e.height)||nn(e.height,"".concat(t,".height"),0,1e4),Pn(e.zOrder)||nn(e.zOrder,"".concat(t,".zOrder"),0,255),Pn(e.alpha)||nn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const hz={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Cd=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Db=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),er=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function iU(e){if(!e.channelName)throw new ae(j.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ae(j.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Cr(e.token,"info.token",1,2047),qy(e.uid),Yy(e.channelName),!0}let Ei=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),hl=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ki=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),xf=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Qt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),_r=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),Xy=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ur=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),zt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const sU=[zt.AFRICA,zt.ASIA,zt.CHINA,zt.EUROPE,zt.GLOBAL,zt.INDIA,zt.JAPAN,zt.NORTH_AMERICA,zt.OCEANIA,zt.OVERSEA,zt.SOUTH_AMERICA];let Br=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const Jy={CHINA:{},ASIA:{CODE:Br.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Br.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Br.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Br.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Br.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Br.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Br.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Br.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Br.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Br.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Br.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Br.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Br.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Xw&&(Jy.CHINA={CODE:Br.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Vg=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function oU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class aU extends bn{constructor(t,n){super(),x(this,"onICEConnectionStateChange",void 0),x(this,"onConnectionStateChange",void 0),x(this,"onDTLSTransportStateChange",void 0),x(this,"onDTLSTransportError",void 0),x(this,"onICETransportStateChange",void 0),x(this,"onFirstAudioReceived",void 0),x(this,"onFirstVideoReceived",void 0),x(this,"onFirstAudioDecoded",void 0),x(this,"onFirstVideoDecoded",void 0),x(this,"onFirstVideoRender",void 0),x(this,"onFirstVideoDecodedTimeout",void 0),x(this,"onSelectedLocalCandidateChanged",void 0),x(this,"onSelectedRemoteCandidateChanged",void 0),x(this,"onICECandidateError",void 0),x(this,"getLocalVideoStats",void 0)}}class cU extends aU{constructor(t,n){super(t,n),x(this,"establishPromise",void 0)}}let Be=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Wr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),pl=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const lU=["disconnected","failed"];let Te=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Jt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),et=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),jo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Fo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),gr=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),dU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Tc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),to=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ta=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Mf=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Vn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Uf=function(e){return e.ABORT="abort",e}({}),Rd=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),pz=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const fz={[zy.ACCESS_POINT]:{[_i.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[_i.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[_i.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[_i.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[_i.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[_i.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[_i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[zy.UNILBS]:{[Vo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Vo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Vo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Vo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Vo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Vo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Vo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Vo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Vo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Vo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Vo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Vo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[zy.STRING_UID_ALLOCATOR]:{[Ob.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Ob.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Ob.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Vf(e){const t=fz[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===zy.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const mz={[nt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[nt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[nt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[nt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[nt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[nt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[nt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[nt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[nt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[nt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[nt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[nt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[nt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[nt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[nt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[nt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[nt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[nt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[nt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[nt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[nt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[nt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[nt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[nt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[nt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[nt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[nt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[nt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[nt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[nt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[nt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[nt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[nt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[nt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[nt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[nt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[nt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[nt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[nt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[nt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[nt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[nt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[nt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[nt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[nt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[nt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[nt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[nt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[nt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[nt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[nt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[nt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[nt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[nt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[nt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[nt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[nt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[nt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[nt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[nt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[nt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[nt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[nt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function jg(e){return mz[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function uU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function kb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Lb(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const s=W("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const _z=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,gz=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Ez=/wss:\/\/(.+):([0-9]+)\/?/,vz=/wss:\/\/(.[^\/]+)\/?/;let Sz=0;class yz{constructor(t,n){x(this,"id",0),x(this,"store",void 0),x(this,"recordIndex",void 0),x(this,"websockets",[]),x(this,"try443PortDuration",2e3),x(this,"forceCloseWSDuration",5e3),x(this,"try443PortTimeout",null),x(this,"forceCloseTimeout",null),x(this,"isTry443PortFailed",!1),x(this,"isNormalPortFailed",!1),x(this,"useDoubleDomain",!1),x(this,"useProxy",!1),x(this,"startTime",Date.now()),this.id=++Sz,this.try443PortDuration=W("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];R.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=W("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=i.find(v=>{var y;return Oe(y=t.host).call(y,v)});c||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)i.forEach(v=>{l.push(Lb(kb(kb({},t),{},{host:t.host.replace(c,v)}),n))});else{const v=kb({},t);if(n&&c){const y=i.find(D=>D!==c);y&&(v.host=v.host.replace(c,y))}l.push(Lb(v,n))}try{l.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",o.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),o.forEach(y=>y.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new ae(j.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const p=Cg();this.store&&this.store.recordJoinChannelService({urls:o.map(v=>v.url),service:"gateway"},this.recordIndex),o.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,p.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(v.readyState));const D=o.every(A=>A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(D)),D&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),p.reject({code:y.code,reason:Xy.A_ROUND_WS_FAILED})):!n&&D&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=D:this.isNormalPortFailed=D},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...o);const m=()=>{this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())},E=()=>{if(p.isResolved)return m();xt().os===dr.MAC_OS&&Nn()&&m(),this.createWebSocket(t,!0,!0).then(v=>{p.resolve(v)}).catch(v=>{this.isNormalPortFailed&&p.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",p.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(s){let o,c,l;return[,o,c,l]=s.match(_z)||[],o||([,c,l]=s.match(gz)||[]),c&&l||([,c,l]=s.match(Ez)||[]),c&&l||([,c]=s.match(vz)||[]),c||R.warning("un-destructible url: ",s),{proxy:o,host:c,port:l||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function hU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class pU extends bn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Oe(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(vt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(vt.CONNECTED):this._state==="closed"?this.emit(vt.CLOSED):this._state==="failed"&&this.emit(vt.FAILED))}resetReconnectCount(t){R.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),x(this,"_websocketUrl",null),x(this,"connectionID",0),x(this,"currentURLIndex",0),x(this,"urls",[]),x(this,"_reconnectMode","tryNext"),x(this,"reconnectReason",void 0),x(this,"_initMutex",void 0),x(this,"name",void 0),x(this,"_state","closed"),x(this,"reconnectInterrupter",void 0),x(this,"websocket",void 0),x(this,"retryConfig",void 0),x(this,"reconnectCount",0),x(this,"forceCloseTimeout",5e3),x(this,"onlineReconnectListener",void 0),x(this,"useCompress",void 0),x(this,"tryDoubleDomain",!1),x(this,"use443PortOnly",!1),x(this,"wsInflateLength",0),x(this,"wsDeflateLength",0),x(this,"closeEstablishingWs",()=>{}),x(this,"store",void 0),x(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=function(E){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?hU(Object(y),!0).forEach(function(D){x(E,D,y[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(y)):hU(Object(y)).forEach(function(D){Object.defineProperty(E,D,Object.getOwnPropertyDescriptor(y,D))})}return E}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new jr("websocket",o?o.clientId:void 0);const{timeout:c,timeoutFactor:l}=n,p=Math.max(300,Math.floor(3*c/5)),m=Math.max(1.2,Math.floor(8*l)/10);os.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m),Gn.on(gf.NETWORK_STATE_CHANGE,(E,v)=>{E!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(E)),E===os.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var i;const s=Cg(),o=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(c){return!(Ny()||W("USE_NEW_TOKEN")||!W("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(dU.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(vt.CLOSED,()=>{s.reject(new ue(j.WS_DISCONNECT))}),this.once(vt.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ue(j.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new ue(j.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=Cg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=m=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async m=>{var E;if(R.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new ue(j.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const v=Ts(this,vt.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=await this.reconnectWithAction(v);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return r.reject(new ue(j.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);r.resolve()}},o=m=>{this.emit(vt.ON_MESSAGE,m)},c=m=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),W("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=W("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),t);const l=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;this._websocketUrl=Lb(t);const m=await this.chooseBestWebsocketConnection(t);this.websocket=m,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(m){const E=this.state==="closed",v=m instanceof ue,y=v&&m.code===j.WS_ABORT,D=v&&m.code===j.WS_ERR,A=v?m.message:m&&(m.reason||m.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},l),E||D?(r.reject(E?new ue(j.WS_DISCONNECT,"websocket is closed: ".concat(A)):new ue(j.WS_ERR,"init websocket failed: ".concat(A))),D&&R.error("[".concat(this.name,"] init websocket failed: ").concat(A))):s&&s(m)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Gn.isOnline||!Gn.onlineWaiter||(this.onlineReconnectListener=Gn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const o=Bw(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await Ve.race([Rr(o),this.onlineReconnectListener||new Ve(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(o,c)=>{this.emit(vt.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Dr(this,vt.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(o){var s;R.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&Oe(c).call(c,"dynamic key expired")?(this.emit(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class xb extends pU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=Cg(),i=function(o,c){return new yz(o,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new ue(j.WS_ABORT,"choose best websocket aborted"))};const s=W("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Fg extends pU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new Ve((r,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),o.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),i(new ue(j.WS_ABORT,"choose best websocket aborted"))};const c=W("GATEWAY_DOMAINS");let l;const p=t.indexOf("?h="),m=c.find(D=>p!==-1?Oe(t).call(t,D,p):Oe(t).call(t,D));R.debug("[choose-best-ws] currentDomain: ",m,", domains: ",c);let E=!this.tryDoubleDomain||!m;if(!E&&m){var v;const D=Date.now();try{c.forEach(A=>{const O=p===-1?t.replace(m,A):t.substr(0,p)+t.substr(p).replace(m,A),V=new WebSocket(O);V.binaryType="arraybuffer",o.push(V),R.debug("[choose-best-ws] ws is connecting:",V.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(O=>O.close());o.length;)o.pop();E=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:o.map(A=>A.url),service:"gateway"},n),o.forEach(A=>{A.onopen=()=>{if(s)return;const O=Date.now()-D;R.debug("[choose-best-ws] ws open cost ".concat(O,"ms")),o.filter(V=>V!==A).forEach(V=>{R.debug("[choose-best-ws]close backup websocket: ".concat(V.url)),V.close()}),s=!0,r(A)},A.onclose=O=>{l=O,!s&&(o.find(V=>!(V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),s=!0,i(l)))},A.onmessage=O=>{R.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(O.data))}}),Rr(this.forceCloseTimeout).then(()=>{o.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(E){var y;let D;R.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},n);try{D=new WebSocket(t),o.push(D),D.binaryType="arraybuffer"}catch(A){const O=new ue(j.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return R.error("[".concat(this.name,"]").concat(O)),void i(O)}D.onopen=()=>{r(D)},D.onclose=A=>{i(A)},D.onmessage=A=>{R.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(A.data))},Rr(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class Tz extends bn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===hn.CONNECTED?this.emit(ht.WS_CONNECTED):t===hn.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===hn.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",hn.CLOSED),x(this,"reconnectToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new yL(5)),x(this,"pingpongTimer",void 0),x(this,"wsInflateDataTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"ortc",void 0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Xt.UID_BANNED);break;case 15:this.close(Xt.IP_BANNED);break;case 16:this.close(Xt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case nt.ERR_LICENSE_MISSING:this.close(Xt.LICENSE_MISSING);break;case nt.ERR_LICENSE_EXPIRED:this.close(Xt.LICENSE_EXPIRED);break;case nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xt.LICENSE_MINUTES_EXCEEDED);break;case nt.ERR_LICENSE_PERIOD_INVALID:this.close(Xt.LICENSE_PERIOD_INVALID);break;case nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xt.LICENSE_MULTIPLE_SDK_SERVICE);break;case nt.ERR_LICENSE_ILLEGAL:this.close(Xt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new xb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hn.CONNECTED&&this.reconnect("retry",Pr.OFFLINE)})}async request(t,n,r,i){const s=on(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new Ve((D,A)=>{if(this.connectionState===hn.CONNECTED)return D();const O=()=>{this.off(ht.WS_CLOSED,V),D()},V=()=>{this.off(ht.WS_CONNECTED,O),A(new ae(j.WS_ABORT))};this.once(ht.WS_CONNECTED,O),this.once(ht.WS_CLOSED,V),t!==ct.PUBLISH&&t!==ct.PUBLISH_DATASTREAM&&t!==ct.SUBSCRIBE&&t!==ct.SUBSCRIBE_DATASTREAM&&t!==ct.UNSUBSCRIBE&&t!==ct.UNSUBSCRIBE_DATASTREAM&&t!==ct.UNPUBLISH&&t!==ct.UNPUBLISH_DATASTREAM&&t!==ct.CONTROL&&t!==ct.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{A(new ae(j.DISCONNECT_P2P))}),t!==ct.PUBLISH&&t!==ct.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{A(new ae(j.DISCONNECT_P2P))})});if(this.connectionState!==hn.CONNECTING&&this.connectionState!==hn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const p=new Ve((D,A)=>{let O=!1;const V=(G,Z)=>{O=!0,D({isSuccess:G==="success",message:Z||{}}),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.emit(ht.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),V);const U=()=>{A(new ae(j.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.off("res-@".concat(s),V)};this.once(ht.WS_CLOSED,U),this.once(ht.WS_RECONNECTING,U),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||O||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===hn.CLOSED||t===ct.LEAVE)throw new ae(j.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?D.throw():t===ct.JOIN||t===ct.REJOIN?null:(await l(),await this.request(t,n))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=jg(E),y=new ae(j.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:v.desc});return v.action==="success"?m.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===nt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pr.MULTI_IP)):this.reconnect(v.action,Pr.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ve(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ug.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ve((n,r)=>{this.once(ht.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ht.WS_CLOSED,i=>r(this.initError||new ae(j.WS_ABORT,i))),this.connectionState=hn.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Xt.LEAVE,this.connectionState=hn.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Dr(this,ht.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(ct.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(ht.REPORT_JOIN_GATEWAY,Xy.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ae(j.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ag(this,ht.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ct.REJOIN,t);return!!n&&(this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Pt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Pt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Pt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Pt.MUTE_AUDIO,{uid:r.uid}):this.emit(Pt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Pt.MUTE_VIDEO,{uid:r.uid}):this.emit(Pt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Pt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Pt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Pt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ct.DOWNGRADE_CODEC,n)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=jg(t.code);if(t.code===28&&"detail"in t&&(R.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ht.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xt.UID_BANNED),void this.close()):void this.reconnect(n.action,Pr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pr.TIMEOUT):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),W("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Ug.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(vt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(vt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(vt.CLOSED,()=>{this.connectionState=hn.CLOSED}),this.websocket.on(vt.FAILED,()=>{this._disconnectedReason=Xt.NETWORK_ERROR,this.connectionState=hn.CLOSED}),this.websocket.on(vt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===hn.CONNECTED?this.connectionState=hn.RECONNECTING:this.connectionState=hn.CONNECTING}),this.websocket.on(vt.WILL_RECONNECT,(t,n,r)=>{const i=Ag(this,ht.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=Xy.P2P_DISCONNECTED),s&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ht.REPORT_JOIN_GATEWAY,n||Xy.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ht.DISCONNECT_P2P)),r(t)}),this.websocket.on(vt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Pr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ae){if(t.code===j.UNEXPECTED_RESPONSE&&t.data.code===nt.ERR_NO_AUTHORIZED)return this.initError=new ae(j.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Xt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(vt.REQUEST_NEW_URLS,(t,n)=>{Dr(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(dU.PRE_CONNECT_PC,()=>{this.emit(ht.PRE_CONNECT_PC)})}}let Cz=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Hn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function fU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Qy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function wd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(W("TURN_DOMAIN")):(R.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function Zy(e){try{const t=W("GATEWAY_DOMAINS").concat(W("TURN_DOMAIN")).find(n=>Oe(e).call(e,n));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return R.debug("serverUrlToIp error, fallback to url",e),e}}function Mb(e,t){e.addresses||(e.addresses=[]);const n=function(c,l){if(W("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map(E=>{let{ip:v,port:y}=E;return{address:"".concat(v,":").concat(y)}});const p=W("GATEWAY_DOMAINS");let m=p[1]&&Oe(l).call(l,p[1])?1:0;return c.map(E=>{let{domain_prefix:v,port:y,ip:D}=E;if(v)return{address:"".concat(v,".").concat(p[m++%p.length],":").concat(y)};const A=/^[\.\:\d]+$/.test(D),O=A?"".concat(D.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(y):"".concat(D,":").concat(y);return A||R.debug("Cannot recognized as ip address: ".concat(D,", use as host3")),{ip:D,port:y,address:O}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const c=r.split(";");for(let l=0;l<c.length;l++){var i;const p=ni(i=c[l]).call(i);n[l]&&p&&(n[l].ip6=p)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[c,l]=s.split(":");c&&l&&(o={port:Number(l),ip:c,address:"".concat(c,":").concat(l)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function as(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function mU(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(as(t.width),"x").concat(as(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function _U(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Bg(e,t){let n,r,i;switch(t){case Hn.CHOOSE_SERVER:r=4096,i="choose server";break;case Hn.CLOUD_PROXY:r=1048576,i="proxy";break;case Hn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Hn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new ae(j.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>Qy(Qy({},o),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:Qy(Qy({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!n)throw new ae(j.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function gU(e,t){return await Ve.all(e.addresses.map(async n=>({address:wd(n.ip),tcpport:n.port,udpport:n.port,username:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():kr.username,password:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Uw(t.toString()):kr.password})))}function Ub(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(as(e.height),as(e.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function bd(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:o}=e;const c={candidateType:t,relayProtocol:n,protocol:o};if(r!=="local-candidate"){const l=i.split(".");l.length>=4&&(l[1]="*",l[2]="*"),c.address=l.join("."),c.port=s}return c}function yh(e){const t=e.split(":"),n=e.split(/[-.]/),r=Oe(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function $y(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W("SVC_MODE");if(W("ENABLE_SVC"))return function(t){return t in Iy}(e)?e:Iy.L1T3}const EU={[Be.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Be.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function eT(e,t,n){t.forEach(r=>{var i;const s=EU[e].find(c=>{var l;let{key:p}=c;return Oe(l=r.extensionName).call(l,p)});if(!s)return;const o=n.find(c=>{let{extensionName:l}=c;return Oe(l).call(l,s.key)});o&&Oe(i=o.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=o.extensionName)})}function jf(e,t){t.forEach(n=>{var r;const i=EU[e].find(s=>{var o;let{key:c}=s;return Oe(o=n.extensionName).call(o,c)});Oe(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)})}function vU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Oe(e).call(e,"abs-send-time")}function tT(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Oe(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function SU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function yU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?SU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Wg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:l,unsupportedVideoUplinkCodec:p,unsupportedVideoDownlinkCodec:m}=t,{useXR:E}=n;let v=[],y=[],D=[],A=[],O=!1,V=!1;if(Gi(e).mediaDescriptions.forEach(G=>{r&&r!==G.attributes.direction||(G.media.mediaType!=="video"||O||(y=G.attributes.payloads,A=G.attributes.extmaps,O=!0),G.media.mediaType!=="audio"||V||(v=G.attributes.payloads,D=G.attributes.extmaps,V=!0))}),!A||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!D||v.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(G=>{var Z;(Z=G.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),E&&G.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(G=>{var Z;(Z=G.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),E&&G.rtcpFeedbacks.push({type:"rrtr"})}),i&&(v=v.filter(G=>{var Z;return((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"}),y=y.filter(G=>{var Z;return((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"})),s){const G=y.filter(z=>{var re;return/(red)|(ulpfec)|(flexfec)/i.test(((re=z.rtpMap)===null||re===void 0?void 0:re.encodingName)||"")}),Z=Ad(G,y).map(z=>z.payloadType),Q=[...G.map(z=>z.payloadType),...Z];y=y.filter(z=>!Oe(Q).call(Q,z.payloadType))}if(o&&(v=v.filter(G=>{var Z;return!/(red)|(ulpfec)|(flexfec)/i.test(((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName)||"")})),c&&c?.length>0&&(v=v.filter(G=>{var Z;return Oe(c).call(c,((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"")})),l&&l?.length>0){const G=y.filter(Z=>{var Q;return Oe(l).call(l,((Q=Z.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())||"")});y=G.concat(i?[]:Ad(G,y))}const U=W("UNSUPPORTED_VIDEO_CODEC");if(U&&U.length>0){const G=y.filter(z=>z.rtpMap&&Oe(U).call(U,z.rtpMap.encodingName.toLowerCase())),Z=Ad(G,y),Q=G.concat(Z).map(z=>z.payloadType);y=y.filter(z=>!Oe(Q).call(Q,z.payloadType)),R.debug("unsupportedVideoCodec: ".concat(U,", toBeRemoved: ").concat(Q))}if(p&&p.length>0&&r==="sendonly"){const G=y.filter(z=>z.rtpMap&&Oe(p).call(p,z.rtpMap.encodingName.toLowerCase())),Z=Ad(G,y),Q=G.concat(Z).map(z=>z.payloadType);y=y.filter(z=>!Oe(Q).call(Q,z.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(p,", toBeRemoved: ").concat(Q))}if(m&&m.length>0&&r==="recvonly"){const G=y.filter(z=>z.rtpMap&&Oe(m).call(m,z.rtpMap.encodingName.toLowerCase())),Z=Ad(G,y),Q=G.concat(Z).map(z=>z.payloadType);y=y.filter(z=>!Oe(Q).call(Q,z.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(m,", toBeRemoved: ").concat(Q))}return{audioCodecs:v,videoCodecs:y,audioExtensions:D,videoExtensions:A}}function Id(e){const t=Gi(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function TU(e,t){const n=[],r=e.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),i=e.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(o=>{var c;const l=(c=r.find(p=>p.ssrcIds[0]===o))===null||c===void 0?void 0:c.ssrcIds[1];n.push({ssrcId:o,rtx:t?l:void 0})});else if(r.length>0){const o=r[0].ssrcIds[0],c=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function CU(e,t,n){const{cname:r}=e;let i=[];t&&(i=RU(t)),i.length===0&&(i=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),R.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const l=rT(e.rtpCapabilities),p=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{p.push({kind:Be.VIDEO,ssrcMsg:[{ssrcId:m.v,rtx:m.v_rtx}],mslabel:"".concat(m.v,"_").concat(m.a)},{kind:Be.AUDIO,ssrcMsg:[{ssrcId:m.a}],mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:l,setup:c,cname:r,preSSRCs:p}}function RU(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(yh(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(yh(e.ip6),":").concat(e.port)))),t}function Gg(e,t,n){const r=[],i=[];return e.forEach(s=>{let{ssrcId:o,rtx:c}=s;const l=on(8,"track-"),p={ssrcId:o,attributes:yU({label:l,mslabel:n=n||on(10,""),msid:"".concat(n," ").concat(l)},t&&{cname:t})};if(r.push(p),c!==void 0){const m={ssrcId:c,attributes:yU({label:l,mslabel:n,msid:"".concat(n," ").concat(l)},t&&{cname:t})};r.push(m),i.push({semantic:"FID",ssrcIds:[o,c]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:r,ssrcGroups:i}}function Ff(e,t){t instanceof Ln&&e.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof W("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=W("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Nn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof xg&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function Vb(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function jb(e,t){var n;if(!(t instanceof mn&&t._encoderConfig&&t._hints.indexOf(rn.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ft().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var s,o;Oe(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ft().supportMinBitrate&&!Oe(n=t._hints).call(n,rn.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var s,o;Oe(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(W("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function wU(e){if(e.media.mediaType!=="video")return;const t=xt();if(t.name!==Wt.SAFARI&&t.os!==dr.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function nT(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const s=r.find(o=>tT(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(l=>tT(l.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(l,p){return p.filter(m=>!!l.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(p=>p.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex(o=>tT(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}if(t.remb===!0){const s=r.find(o=>vU(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(l=>l.extensionName===o)||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(l,p){return p.filter(m=>!!l.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(p=>p.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex(o=>vU(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="goog-remb");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}}function bU(e,t,n){if(Nn()||e.media.mediaType!=="video"||!(t instanceof mn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!W("SIMULCAST")||n==="vp9"&&W("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===i.ssrcId),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let c=1;c<r;c++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+c,attributes:Cn(i.attributes)}),o.ssrcIds.push(i.ssrcId+c),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:Cn(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+c,s.ssrcIds[1]+c]}));e.attributes.ssrcGroups.unshift(o)}async function IU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const m=Wg(p,c,l,"sendonly"),E=Wg(p,c,l,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(m,E,"videoExtensions",v,y,D),Bo(m,E,"videoCodecs",v,y,D),Bo(m,E,"audioExtensions",v,y,D),Bo(m,E,"audioCodecs",v,y,D),W("RAISE_H264_BASELINE_PRIORITY")){const A=[],O=[];if(D.videoCodecs.forEach((V,U)=>{var G;if(((G=V.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){var Z,Q;const z=D.videoCodecs[U+1],re=z&&DU(V,z),he=(Z=V.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"],Ee=(Q=V.fmtp)===null||Q===void 0?void 0:Q.parameters["packetization-mode"];!he||he!==W("FIRST_H264_PROFILE_LEVEL_ID")||W("FIRST_PACKETIZATION_MODE")&&Ee!==W("FIRST_PACKETIZATION_MODE")?re?O.push([V,z]):O.push([V]):re?A.push([V,z]):A.push([V])}}),A.length>0&&O.length>0){R.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((U,G)=>{var Z;if(((Z=U.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLocaleLowerCase())==="h264"){const Q=DU(U,D.videoCodecs[G+1]),z=A.shift()||O.shift()||[];z.length>0&&(Q?D.videoCodecs.splice(G,2,...z):D.videoCodecs.splice(G,1,...z))}});const V=y.videoCodecs.filter(U=>{var G,Z;return((G=U.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&((Z=U.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID")});if(V.length>0){const U=Ad(V,y.videoCodecs).map(Z=>Z.payloadType),G=[...V.map(Z=>Z.payloadType),...U];y.videoCodecs=y.videoCodecs.filter(Z=>!Oe(G).call(G,Z.payloadType))}W("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(U=>{var G,Z;return!(((G=U.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&((Z=U.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:v,recv:y,sendrecv:D}}return{send:v,recv:y,sendrecv:D}}(e,t,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:o}}function AU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Wg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(e,t,"videoExtensions",n,r,i),Bo(e,t,"videoCodecs",n,r,i),Bo(e,t,"audioExtensions",n,r,i),Bo(e,t,"audioCodecs",n,r,i),W("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const o=i.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){R.debug("raising H264 baseline profile priority");const c=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,c)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter(c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function Bo(e,t,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return e[n].forEach(c=>{t[n].some((l,p)=>{if(c.entry===l.entry&&c.extensionName===l.extensionName)return o.push(p),!0})?s[n].push(c):r[n].push(c)}),void t[n].forEach((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)})}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return e[n].forEach(c=>{t[n].some((l,p)=>{if(c.payloadType===l.payloadType&&JSON.stringify(c)===JSON.stringify(l))return o.push(p),!0})?s[n].push(c):r[n].push(c)}),void t[n].forEach((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)})}}function rT(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function Bf(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Hg(e,t,n,r){let i=[];if(e===Be.VIDEO){if(W("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(s=>{var o;return Oe(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===W("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const o=[],c=[],l=[];if(n.videoCodecs.forEach(p=>{const m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";Oe(m).call(m,r)?s.push(p):Oe(m).call(m,"vp9")?o.push(p):Oe(m).call(m,"vp8")?c.push(p):Oe(m).call(m,"h264")&&l.push(p)}),s.length===0){let p="";o.length!==0?(s=o,p="vp9"):c.length!==0?(s=c,p="vp8"):l.length!==0&&(s=l,p="h264"),R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}s.length!==0&&(i=t.videoCodecs.filter(p=>s.some(m=>m.payloadType===p.payloadType)))}if(i.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),W("USE_PUB_RTX")||W("USE_SUB_RTX")){const s=Ad(i,t.videoCodecs);i=[...i,...s]}}else{i=t.audioCodecs.filter(o=>{var c;return Oe(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,r)});const s=t.audioCodecs.filter(o=>{var c;return Oe(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"red")});i.length===0&&(R.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(o=>{var c;return Oe(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")})),W("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function Ad(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Oe(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function Od(e,t,n){const r=t.toString(),i=NU(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=OU(o,n||{}),i?.(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function OU(e,t,n){const r=Gi(e),{useXR:i}=t;return r.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!Oe(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Bf(s),i&&Oe(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(c=>{c.rtcpFeedbacks.findIndex(l=>l.type==="rrtr")===-1&&c.rtcpFeedbacks.push({type:"rrtr"})})))}),yd(r)}function NU(e,t,n,r){if(W("SDP_LOGGING"))return R.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{NU(i,"answer",n==="local"?"remote":"local",r)}:void 0}function PU(e){const t=W("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Oe(e).call(e,n))}function DU(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function kU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ps(e,t){return typeof W(e)===t?W(e):void 0}function Rz(){try{const e=W("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?kU(Object(r),!0).forEach(function(i){x(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kU(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e)}catch(e){return R.debug("handle gateway attributes failed: ",e),{}}}const LU={};function Nd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(e.name)),LU[e.name]=e}function fl(e){const t=LU[e];if(!t)throw new ue(j.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function xU(e,t){return fl("DataStream").create(e,t)}function iT(){return fl("InterceptFrame").create()}function MU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Xr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Fb=new Map;class wz extends bn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(_r.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(_r.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,s;super(),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"key",void 0),x(this,"ntpOffset",0),x(this,"signal",void 0),x(this,"role",void 0),x(this,"isPreallocation",void 0),x(this,"isPreSub",void 0),x(this,"inChannelInfo",{joinAt:null,duration:0}),x(this,"spec",void 0),x(this,"_state","DISCONNECTED"),x(this,"_statsCollector",void 0),x(this,"_disconnectedReason",void 0),x(this,"isSignalRecover",!1),x(this,"hasChangeBGPAddress",!1),x(this,"trafficStatsInterval",void 0),x(this,"networkQualityInterval",void 0),x(this,"_joinGatewayStartTime",0),x(this,"_signalTimeout",!1),x(this,"_clientRoleOptions",void 0),x(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:Xr(Xr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(s=fl("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,r)):new Tz(Xr(Xr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=Fb.get(t.cname);if(s||(s=new Map,Fb.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const p=new ae(j.UID_CONFLICT);throw qe.joinGateway(t.sid,{lts:i,succ:!1,ec:p.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),p}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let o=0;this.joinGatewayStartTime=i;const c=t.proxyServer;try{R.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const p=t.gatewayAddrs.map(m=>{let{address:E}=m;const[v,y]=E.split(":"),D={host:v,port:y};return t.proxyServer&&(D.proxy=t.proxyServer),D});o=(await this.signal.init(p)).uid,R.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var l;throw R.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),qe.joinGateway(t.sid,{lts:i,succ:!1,ec:((l=p.data)===null||l===void 0?void 0:l.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),p}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:_U(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:_U(this._statsCollector.trafficStats.B_dnq)}):this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Xt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==hn.CONNECTED||await function(r,i){return i===1/0?r:Ve.race([r,JH(i)])}(this.signal.request(ct.LEAVE,void 0,!0),3e3)}catch(r){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Xt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:W("PUB_EXTEND"),twcc:!!W("PUBLISH_TWCC"),rtx:!!W("USE_PUB_RTX")};try{return(await this.signal.request(ct.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===nt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ct.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===nt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw o}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ct.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ve.all(t.map(n=>this.signal.request(ct.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){R.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX")||void 0,extend:W("SUB_EXTEND"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(ct.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX"),extend:W("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return(await this.signal.request(ct.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ct.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!W("USE_SUB_RTX"),twcc:!!W("SUBSCRIBE_TWCC"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(ct.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,o=r.height,c=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(c=!1)),c?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(ct.SET_VIDEO_PROFILE,n);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ve.all(t.map(r=>this.signal.request(ct.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){R.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(ct.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(ct.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ct.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ct.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),W("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),W("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(ct.SET_CLIENT_ROLE,Xr(Xr({role:t,level:i,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(ct.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ct.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(ct.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(ct.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ct.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ct.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=Fb.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:kr.username,password:kr.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Xr(Xr({},kr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ct.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Cy(()=>{this.emit(_r.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,r;if(!this.joinInfo||!this.key)throw new ae(j.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=W("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var o;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(_r.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,Oe(Lf).call(Lf,o)||Lf.push(o);const c=tb(this.store),l=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),p=jL(this.store),m=Rz(),E=mf(87)||qk()||Ow(117),v=(function(){const D=xt();if(D.name!==Wt.SAFARI||!D.browserVersion)return!1;const A=D.browserVersion.split(".");return Number(A[0])>18||Number(A[0])===18&&Number(A[1])>=4}()||Zk(18,4,!1))&&Nw(18,6,!0)&&this.spec.codec==="h264"&&W("ENABLE_ABSSENDTIME_AS_SENTTS"),y=Xr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Qs,browser:navigator.userAgent,process_id:W("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:W("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Xr(Xr({enableEncodedTransform:(!!W("ENABLE_AUDIO_METADATA")||!!W("ENABLE_AUDIO_PTS"))&&E||!!W("ENABLE_AUDIO_TOPN")&&Iw(Wt.CHROME,87,116)||void 0,enableAudioMetadata:!!W("ENABLE_AUDIO_METADATA")&&E,enableAudioPts:!!W("ENABLE_AUDIO_PTS")&&E,topnSmoothLevel:W("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:W("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:W("TOPN_SWITCH_HOLD_MS"),topnAudioGain:W("TOPN_AUDIO_GAIN"),enablePublishedUserList:W("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:W("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ps("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ps("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ps("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:W("USE_PUB_RTX")===!0||W("USE_SUB_RTX")===!0||void 0,disableFEC:W("DISABLE_FEC"),enableNTPReport:!!W("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:p,enableFulllinkAvSync:!!W("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ps("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!W("FORCE_ENABLE_AUT_CC")||!Ny()&&(!!W("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!W("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ps("USE_XR","boolean"),enableLossbasedBwe:Ps("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!W("FORCE_ENABLE_AUT_CC")||!Ny()&&(!!W("ENABLE_AUT_CC")||void 0),enableCCFallback:Ps("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:c?Ps("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ps("PUBLISH_TWCC","boolean"),enableSubTWCC:Ps("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ps("USE_PUB_RTX","boolean"),enableSubRTX:Ps("USE_SUB_RTX","boolean"),enableSubSVC:W("ENABLE_SVC")?W("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0,enableSvcExtended:W("ENABLE_SVC")&&Array.isArray(W("SVC_EXTENDED"))&&W("SVC_EXTENDED").length!==0?W("SVC_EXTENDED"):void 0},m),{},{audioDuplicate:Ps("ENABLE_AUDIO_RED","boolean")?(r=Ps("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!v||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,W("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new ae(j.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ht.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ht.WS_RECONNECTING,t=>{this.joinInfo&&qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Pr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",qe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ht.WS_CLOSED,t=>{let n;switch(t){case Xt.LEAVE:n=Pr.LEAVE;break;case Xt.UID_BANNED:case Xt.IP_BANNED:case Xt.CHANNEL_BANNED:case Xt.SERVER_ERROR:n=Pr.SERVER_ERROR;break;case Xt.FALLBACK:n=Pr.FALLBACK;break;case Xt.LICENSE_MISSING:case Xt.LICENSE_EXPIRED:case Xt.LICENSE_MINUTES_EXCEEDED:case Xt.LICENSE_PERIOD_INVALID:case Xt.LICENSE_MULTIPLE_SDK_SERVICE:case Xt.LICENSE_ILLEGAL:case Xt.TOKEN_EXPIRE:n=t;break;default:n=Pr.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Pr.NETWORK_ERROR)),this.joinInfo&&qe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Xt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Xt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ht.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=W("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));$t("EVENT_REPORT_DOMAIN",t[1]),$t("EVENT_REPORT_BACKUP_DOMAIN",t[1]),$t("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Pt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ht.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new ae(j.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Dr(this,_r.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(ht.REQUEST_JOIN_INFO,async(t,n,r)=>{var i,s,o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const c=Cn((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(W("NEW_TURN_MODE")&&c&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var l;let v=c.servers.map(A=>"turnServerURL"in A&&W("USE_TURN_IP")?Xr(Xr({},A),{},{turnServerURL:Zy(A.turnServerURL)}):A),y=(l=c.serversFromGateway)===null||l===void 0?void 0:l.map(A=>W("USE_TURN_IP")?Xr(Xr({},A),{},{turnServerURL:Zy(A.turnServerURL)}):A);const D=this.signal.currentURLIndex;v.length>0&&(v=[v[D%v.length]],c.servers=v),Array.isArray(y)&&y.length>0&&(y=[y[0]],c.serversFromGateway=y),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(D))}const{iceParameters:p,dtlsParameters:m,rtpCapabilities:E}=await Dr(this,_r.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:m,rtpCapabilities:E,version:"2"}}))}catch(v){n(v)}}),this.signal.on(ht.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ht.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,i="";var s;t instanceof ae?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):r=t,qe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ht.IS_P2P_DISCONNECTED,t=>{t(Ag(this,_r.IS_P2P_DISCONNECTED))}),this.signal.on(ht.DISCONNECT_P2P,()=>{this.emit(_r.DISCONNECT_P2P)}),this.signal.on(ht.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ht.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ht.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(_r.JOIN_RESPONSE,t,n)}),this.signal.on(ht.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=Cn((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(W("NEW_TURN_MODE")&&s&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var r;let c=s.servers.map(m=>"turnServerURL"in m&&W("USE_TURN_IP")?Xr(Xr({},m),{},{turnServerURL:Zy(m.turnServerURL)}):m),l=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map(m=>W("USE_TURN_IP")?Xr(Xr({},m),{},{turnServerURL:Zy(m.turnServerURL)}):m);const p=this.signal.currentURLIndex;c.length>0&&(c=[c[p%c.length]],s.servers=c),Array.isArray(l)&&l.length>0&&(l=[l[0]],s.serversFromGateway=l),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(p,",in pre pc"))}const o=W("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&o){const c=RU(i);this.emit(_r.PRE_CONNECT_PC,{candidates:c,fingerprint:o,turnServer:s})}}}),this.signal.on(ht.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof W("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(W("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(ct.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw R.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(ct.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(ct.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw R.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(ct.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(i=>i.stream_type===Qt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ct.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find(i=>i.stream_type===Qt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ct.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===Be.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ct.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===Be.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ct.CONTROL,r,!0,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ct.RESTART_ICE,n,!0)}catch(r){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Pr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!W("GATEWAY_WSS_ADDRESS"))return W("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ct.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let sT=0,Bb=0;function Ca(e,t,n,r){return new Ve((i,s)=>{t.timeout=t.timeout||W("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),sT+=gc(t.data)):n&&(t.data.size?sT+=t.data.size:t.data instanceof FormData?sT+=fL(t.data):sT+=gc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ai.request(t).then(o=>{typeof o.data=="string"?Bb+=gc(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?Bb+=o.data.byteLength:Bb+=gc(JSON.stringify(o.data)),r&&i({data:o.data,headers:o.headers}),i(o.data)}).catch(o=>{Ai.isCancel(o)?s(new ae(j.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ae(j.NETWORK_TIMEOUT,o.message)):o.response?s(new ae(j.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ae(j.NETWORK_ERROR,o.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(ge){var Pe=0;return function(){return Pe<ge.length?{done:!1,value:ge[Pe++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(ge,Pe,He){return ge==Array.prototype||ge==Object.prototype||(ge[Pe]=He.value),ge},r,i=function(ge){ge=[typeof globalThis=="object"&&globalThis,ge,typeof window=="object"&&window,typeof self=="object"&&self,typeof g=="object"&&g];for(var Pe=0;Pe<ge.length;++Pe){var He=ge[Pe];if(He&&He.Math==Math)return He}throw Error("Cannot find global object")}(this);function s(ge,Pe){if(Pe)e:{var He=i;ge=ge.split(".");for(var ve=0;ve<ge.length-1;ve++){var w=ge[ve];if(!(w in He))break e;He=He[w]}(Pe=Pe(ve=He[ge=ge[ge.length-1]]))!=ve&&Pe!=null&&n(He,ge,{configurable:!0,writable:!0,value:Pe})}}function o(ge){return(ge={next:ge})[Symbol.iterator]=function(){return this},ge}function c(ge){var Pe=typeof Symbol<"u"&&Symbol.iterator&&ge[Symbol.iterator];return Pe?Pe.call(ge):{next:t(ge)}}if(s("Symbol",function(ge){function Pe(w,H){this.A=w,n(this,"description",{configurable:!0,writable:!0,value:H})}if(ge)return ge;Pe.prototype.toString=function(){return this.A};var He="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ve=0;return function w(H){if(this instanceof w)throw new TypeError("Symbol is not a constructor");return new Pe(He+(H||"")+"_"+ve++,H)}}),s("Symbol.iterator",function(ge){if(ge)return ge;ge=Symbol("Symbol.iterator");for(var Pe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),He=0;He<Pe.length;He++){var ve=i[Pe[He]];typeof ve=="function"&&typeof ve.prototype[ge]!="function"&&n(ve.prototype,ge,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return ge}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var l;e:{var p={};try{p.__proto__={a:!0},l=p.a;break e}catch{}l=!1}r=l?function(ge,Pe){if(ge.__proto__=Pe,ge.__proto__!==Pe)throw new TypeError(ge+" is not extensible");return ge}:null}var m=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(ge){if(ge.m)throw new TypeError("Generator is already running");ge.m=!0}function y(ge,Pe){return ge.h=3,{value:Pe}}function D(ge){this.g=new E,this.G=ge}function A(ge,Pe,He,ve){try{var w=Pe.call(ge.g.j,He);if(!(w instanceof Object))throw new TypeError("Iterator result "+w+" is not an object");if(!w.done)return ge.g.m=!1,w;var H=w.value}catch(J){return ge.g.j=null,ge.g.s(J),O(ge)}return ge.g.j=null,ve.call(ge.g,H),O(ge)}function O(ge){for(;ge.g.h;)try{var Pe=ge.G(ge.g);if(Pe)return ge.g.m=!1,{value:Pe.value,done:!1}}catch(He){ge.g.v=void 0,ge.g.s(He)}if(ge.g.m=!1,ge.g.l){if(Pe=ge.g.l,ge.g.l=null,Pe.F)throw Pe.D;return{value:Pe.return,done:!0}}return{value:void 0,done:!0}}function V(ge){this.next=function(Pe){return ge.o(Pe)},this.throw=function(Pe){return ge.s(Pe)},this.return=function(Pe){return function(He,ve){v(He.g);var w=He.g.j;return w?A(He,"return"in w?w.return:function(H){return{value:H,done:!0}},ve,He.g.return):(He.g.return(ve),O(He))}(ge,Pe)},this[Symbol.iterator]=function(){return this}}function U(ge,Pe){return Pe=new V(new D(Pe)),m&&ge.prototype&&m(Pe,ge.prototype),Pe}if(E.prototype.o=function(ge){this.v=ge},E.prototype.s=function(ge){this.l={D:ge,F:!0},this.h=this.C||this.u},E.prototype.return=function(ge){this.l={return:ge},this.h=this.u},D.prototype.o=function(ge){return v(this.g),this.g.j?A(this,this.g.j.next,ge,this.g.o):(this.g.o(ge),O(this))},D.prototype.s=function(ge){return v(this.g),this.g.j?A(this,this.g.j.throw,ge,this.g.o):(this.g.s(ge),O(this))},s("Array.prototype.entries",function(ge){return ge||function(){return function(Pe,He){Pe instanceof String&&(Pe+="");var ve=0,w=!1,H={next:function(){if(!w&&ve<Pe.length){var J=ve++;return{value:He(J,Pe[J]),done:!1}}return w=!0,{done:!0,value:void 0}}};return H[Symbol.iterator]=function(){return H},H}(this,function(Pe,He){return[Pe,He]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var G=function(ge,Pe){for(var He=0;He<ge.length;He++)Pe(ge[He])},Z=function(ge){return ge.replace(/\r?\n|\r/g,`\r
`)},Q=function(ge,Pe,He){return Pe instanceof Blob?(He=He!==void 0?He+"":typeof Pe.name=="string"?Pe.name:"blob",Pe.name===He&&Object.prototype.toString.call(Pe)!=="[object Blob]"||(Pe=new File([Pe],He)),[String(ge),Pe]):[String(ge),String(Pe)]},z=function(ge,Pe){if(ge.length<Pe)throw new TypeError(Pe+" argument required, but only "+ge.length+" present.")},re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,he=re.FormData,Ee=re.XMLHttpRequest&&re.XMLHttpRequest.prototype.send,Re=re.Request&&re.fetch,Ct=re.navigator&&re.navigator.sendBeacon,bt=re.Element&&re.Element.prototype,ut=re.Symbol&&Symbol.toStringTag;ut&&(Blob.prototype[ut]||(Blob.prototype[ut]="Blob"),"File"in re&&!File.prototype[ut]&&(File.prototype[ut]="File"));try{new File([],"")}catch{re.File=function(Pe,He,ve){return Pe=new Blob(Pe,ve||{}),Object.defineProperties(Pe,{name:{value:He},lastModified:{value:+(ve&&ve.lastModified!==void 0?new Date(ve.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ut&&Object.defineProperty(Pe,ut,{value:"File"}),Pe}}var Yt=function(ge){return ge.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ht=function(ge){this.i=[];var Pe=this;ge&&G(ge.elements,function(He){if(He.name&&!He.disabled&&He.type!=="submit"&&He.type!=="button"&&!He.matches("form fieldset[disabled] *"))if(He.type==="file"){var ve=He.files&&He.files.length?He.files:[new File([],"",{type:"application/octet-stream"})];G(ve,function(w){Pe.append(He.name,w)})}else He.type==="select-multiple"||He.type==="select-one"?G(He.options,function(w){!w.disabled&&w.selected&&Pe.append(He.name,w.value)}):He.type==="checkbox"||He.type==="radio"?He.checked&&Pe.append(He.name,He.value):(ve=He.type==="textarea"?Z(He.value):He.value,Pe.append(He.name,ve))})};if((e=Ht.prototype).append=function(ge,Pe,He){z(arguments,2),this.i.push(Q(ge,Pe,He))},e.delete=function(ge){z(arguments,1);var Pe=[];ge=String(ge),G(this.i,function(He){He[0]!==ge&&Pe.push(He)}),this.i=Pe},e.entries=function ge(){var Pe,He=this;return U(ge,function(ve){if(ve.h==1&&(Pe=0),ve.h!=3)return Pe<He.i.length?ve=y(ve,He.i[Pe]):(ve.h=0,ve=void 0),ve;Pe++,ve.h=2})},e.forEach=function(ge,Pe){z(arguments,1);for(var He=c(this),ve=He.next();!ve.done;ve=He.next()){var w=c(ve.value);ve=w.next().value,w=w.next().value,ge.call(Pe,w,ve,this)}},e.get=function(ge){z(arguments,1);var Pe=this.i;ge=String(ge);for(var He=0;He<Pe.length;He++)if(Pe[He][0]===ge)return Pe[He][1];return null},e.getAll=function(ge){z(arguments,1);var Pe=[];return ge=String(ge),G(this.i,function(He){He[0]===ge&&Pe.push(He[1])}),Pe},e.has=function(ge){z(arguments,1),ge=String(ge);for(var Pe=0;Pe<this.i.length;Pe++)if(this.i[Pe][0]===ge)return!0;return!1},e.keys=function ge(){var Pe,He,ve,w,H=this;return U(ge,function(J){if(J.h==1&&(Pe=c(H),He=Pe.next()),J.h!=3)return He.done?void(J.h=0):(ve=He.value,w=c(ve),y(J,w.next().value));He=Pe.next(),J.h=2})},e.set=function(ge,Pe,He){z(arguments,2),ge=String(ge);var ve=[],w=Q(ge,Pe,He),H=!0;G(this.i,function(J){J[0]===ge?H&&(H=!ve.push(w)):ve.push(J)}),H&&ve.push(w),this.i=ve},e.values=function ge(){var Pe,He,ve,w,H=this;return U(ge,function(J){if(J.h==1&&(Pe=c(H),He=Pe.next()),J.h!=3)return He.done?void(J.h=0):(ve=He.value,(w=c(ve)).next(),y(J,w.next().value));He=Pe.next(),J.h=2})},Ht.prototype._asNative=function(){for(var ge=new he,Pe=c(this),He=Pe.next();!He.done;He=Pe.next()){var ve=c(He.value);He=ve.next().value,ve=ve.next().value,ge.append(He,ve)}return ge},Ht.prototype._blob=function(){var ge="----formdata-polyfill-"+Math.random(),Pe=[],He="--"+ge+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ve,w){return typeof ve=="string"?Pe.push(He+Yt(Z(w))+`"\r
\r
`+Z(ve)+`\r
`):Pe.push(He+Yt(Z(w))+'"; filename="'+Yt(ve.name)+`"\r
Content-Type: `+(ve.type||"application/octet-stream")+`\r
\r
`,ve,`\r
`)}),Pe.push("--"+ge+"--"),new Blob(Pe,{type:"multipart/form-data; boundary="+ge})},Ht.prototype[Symbol.iterator]=function(){return this.entries()},Ht.prototype.toString=function(){return"[object FormData]"},bt&&!bt.matches&&(bt.matches=bt.matchesSelector||bt.mozMatchesSelector||bt.msMatchesSelector||bt.oMatchesSelector||bt.webkitMatchesSelector||function(ge){for(var Pe=(ge=(this.document||this.ownerDocument).querySelectorAll(ge)).length;0<=--Pe&&ge.item(Pe)!==this;);return-1<Pe}),ut&&(Ht.prototype[ut]="FormData"),Ee){var Hr=re.XMLHttpRequest.prototype.setRequestHeader;re.XMLHttpRequest.prototype.setRequestHeader=function(ge,Pe){Hr.call(this,ge,Pe),ge.toLowerCase()==="content-type"&&(this.B=!0)},re.XMLHttpRequest.prototype.send=function(ge){ge instanceof Ht?(ge=ge._blob(),this.B||this.setRequestHeader("Content-Type",ge.type),Ee.call(this,ge)):Ee.call(this,ge)}}Re&&(re.fetch=function(ge,Pe){return Pe&&Pe.body&&Pe.body instanceof Ht&&(Pe.body=Pe.body._blob()),Re.call(this,ge,Pe)}),Ct&&(re.navigator.sendBeacon=function(ge,Pe){return Pe instanceof Ht&&(Pe=Pe._asNative()),Ct.call(this,ge,Pe)}),re.FormData=Ht}})();const Kg=()=>{const e=W("AREAS");return e.length===0&&e.push(zt.GLOBAL),Ui(e).call(e,(t,n,r)=>{const i=UU(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},UU=e=>e===zt.OVERSEA?"".concat(Br.ASIA,",").concat(Br.EUROPE,",").concat(Br.AFRICA,",").concat(Br.NORTH_AMERICA,",").concat(Br.SOUTH_AMERICA,",").concat(Br.OCEANIA):Br[e],bz=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=Jy[n],i=Object.keys(r);i&&i.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))})}),t},oT={GLOBAL:{ASIA:[zt.CHINA,zt.JAPAN,zt.INDIA,zt.KOREA,zt.HKMC],EUROPE:[],NORTH_AMERICA:[zt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},aT=Object.keys(oT[zt.GLOBAL]),Wb=[zt.CHINA,zt.NORTH_AMERICA,zt.EUROPE,zt.ASIA,zt.JAPAN,zt.INDIA,zt.OCEANIA,zt.SOUTH_AMERICA,zt.AFRICA,zt.KOREA,zt.HKMC,zt.US],Iz=function(e,t){let n=[];if(Oe(e).call(e,zt.GLOBAL)){const s=[zt.GLOBAL,zt.OVERSEA],o=Object.keys(Jy);if(t===zt.GLOBAL)throw new ae(j.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===zt.CHINA)n=[zt.OVERSEA];else if(i=t,Oe(aT).call(aT,i)){const c=(r=t,oT[zt.GLOBAL][r]||[]),l=[...s,t,...c];n=o.filter(p=>!Oe(l).call(l,p))}else if(function(c){let l=!1;return aT.forEach(p=>{var m;Oe(m=oT[zt.GLOBAL][p]).call(m,c)&&(l=!0)}),l}(t)){const c=function(p){let m;return aT.forEach(E=>{var v;Oe(v=oT[zt.GLOBAL][E]).call(v,p)&&(m=E)}),m}(t),l=[...s,c,t];n=o.filter(p=>!Oe(l).call(l,p))}else n=e;n=function(c){const l=[];return Wb.forEach(p=>{Oe(c).call(c,p)&&l.push(p)}),l.concat(c.filter(p=>!Oe(Wb).call(Wb,p)))}(n)}else n=e;var r,i;return n};function VU(e){var t,n;if(!e&&Oe(t=W("AREAS")).call(t,zt.EXTENSIONS))return R.debug("update area from ap : reset"),void Gb(xK,!0);if(!Oe(n=W("AREAS")).call(n,zt.GLOBAL)||!e)return;let r=Jy.EXTENSIONS;r&&(r={CODE:UU(zt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},R.debug("update area from ap success: ".concat(e,",config is "),r),$t("AREAS",[zt.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?$t(i,r[i][0]):$t(i,r[i])}))}function Gb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=qe.reportApiInvoke(null,{name:xn.SET_AREA,options:e,tag:Tn.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!Oe(sU).call(sU,s))throw new ae(j.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new ae(j.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),r=o?Iz(c,o):c}if(!t){if(va.AREAS){const s=new ae(j.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void R.warning("setArea is prohibited because of config-distribute")}if(Oe(r).call(r,zt.GLOBAL)&&W("AREAS")===zt.EXTENSIONS){const s=new ae(j.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void R.warning("setArea is prohibited because of ap extensions")}}$t("AREAS",r,t);const i=bz(r);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?$t(s,i[s][0]):$t(s,i[s])}),R.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function jU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Cc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Hb=1;function Az(e,t,n,r,i){Hb+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Hb,requestId:Hb,version:Qs,cname:n.cname},o={service_name:t,json_body:JSON.stringify(s)};let c,l,p=e[0];return Ea(async()=>{c=Date.now();const m=await Ca(p,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-c,m.code!==0){const y=new ae(j.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:l});throw R.error(y.toString()),y}const E=JSON.parse(m.json_body);if(E.code!==200){const y=new ae(j.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:l});throw R.error(y.toString()),y}if(!E.servers||E.servers.length===0){const y=new ae(j.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:l});throw R.error(y.toString()),y}const v=function(y,D){return{addressList:y.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:y.workerToken,vid:y.vid}}(E,t);return W("LIVE_STREAMING_ADDRESS")&&(v.addressList=W("LIVE_STREAMING_ADDRESS")instanceof Array?W("LIVE_STREAMING_ADDRESS"):[W("LIVE_STREAMING_ADDRESS")]),Cc(Cc({},v),{},{responseTime:l})},(m,E)=>(qe.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:E===0,responseTime:l,serverIp:e[E%e.length]}),!1),(m,E)=>(qe.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:l,serverIp:e[E%e.length]}),!!(m.code!==j.OPERATION_ABORTED&&m.code!==j.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(p=e[(E+1)%e.length],!0)),i)}let Kb=1;function FU(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:o,sid:c}=t,l=Date.now();let p;const m=t.role,[E,v]=Yb(t,s,[Hn.CHOOSE_SERVER]);let y=Gn.networkState;return Ea(async()=>{y&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await Ve.race([Gn.onlineWaiter,Rr(r&&r.maxRetryTimeout||qn.maxRetryTimeout)]),y=Gn.networkState;const{data:D,headers:A}=await Ca(i,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=A.http3==="1"?1:-1,qe.reportResourceTiming(i,c),WU(D,i,t,l,[Hn.CHOOSE_SERVER],p);const O=Bg(D,Hn.CHOOSE_SERVER);return zb(O),Mb(O,i)},D=>(D&&qe.joinChooseServer(c,{role:m,lts:l,succ:!0,csAddr:i,opid:v,serverList:D.gatewayAddrs.map(A=>A.address),ec:null,cid:D.cid.toString(),uid:D.uid.toString(),csIp:D.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),isHttp3:p,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.res.detail&&D.res.detail[38]}),!1),D=>D.code!==j.OPERATION_ABORTED&&(D.code===j.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(qe.joinChooseServer(c,{role:m,lts:l,succ:!1,csAddr:i,serverList:null,opid:v,ec:D.code,csIp:D.data&&D.data.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:p,corssRegionTagReq:t.apRequestDetail}),R.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),D),!0)),r)}function BU(e,t,n,r){let i,{url:s,areaCode:o,serviceIds:c}=e;const l=Date.now(),p=t.role,[m,E]=Yb(t,o,c);let v;return Ea(async()=>{v&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await Ve.race([Gn.onlineWaiter,Rr(r&&r.maxRetryTimeout||qn.maxRetryTimeout)]),v=Gn.networkState;const{data:y,headers:D}=await Ca(s,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=D.http3==="1"?1:-1,qe.reportResourceTiming(s,t.sid),WU(y,s,t,l,c,i);const A=Bg(y,Hn.CHOOSE_SERVER),O=Bg(y,t.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK),V=performance.getEntriesByName(s),U=V[V.length-1];let G;return U&&(G={name:U.name,protocol:"nextHopProtocol"in U?U.nextHopProtocol:"",dnscost:"domainLookupEnd"in U&&"domainLookupStart"in U&&typeof U.domainLookupEnd=="number"&&typeof U.domainLookupStart=="number"?U.domainLookupEnd-U.domainLookupStart:-1,tcpTlsCost:"connectEnd"in U&&"connectStart"in U&&typeof U.connectEnd=="number"&&typeof U.connectStart=="number"?U.connectEnd-U.connectStart:-1,reqCost:"requestStart"in U&&typeof U.requestStart=="number"&&"responseEnd"in U&&typeof U.responseEnd=="number"?U.responseEnd-U.requestStart:-1,handleCost:"leave_ts"in y&&"enter_ts"in y&&typeof y.leave_ts=="number"&&typeof y.enter_ts=="number"?y.leave_ts-y.enter_ts:-1}),zb(A),{gatewayInfo:Mb(A,s),proxyInfo:O,url:s,resourceTimingInfo:G}},y=>(y.gatewayInfo&&qe.joinChooseServer(t.sid,{role:p,lts:l,succ:!0,csAddr:s,serverList:y.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:E,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38],resourceTimingInfo:y.resourceTimingInfo?JSON.stringify(y.resourceTimingInfo):void 0}),y.proxyInfo&&qe.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:s,turnServerAddrList:y.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),y=>y.code!==j.OPERATION_ABORTED&&(y.code===j.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(qe.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:v})}),R.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),r)}const WU=(e,t,n,r,i,s)=>{const{sid:o,clientId:c,cloudProxyServer:l}=n,p=[],m=E=>{E.flag===4096?qe.joinChooseServer(o,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||qe.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:l,unilbsServerIds:i.toString()})};if(e.response_body.forEach(E=>{const v=E.buffer.code;if(E.uri===23&&v===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const y={error:new ae(j.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};p.push(y),m(y)}if(v!==0){const y=Vf(v),D={error:new ae(j.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?R.warning(D.error.toString()):p.push(D),m(D)}}),p.length)throw R.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(p.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new ae(j.CAN_NOT_GET_GATEWAY_SERVER,p.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!p.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(p.map(E=>{var v;return E==null||(v=E.error)===null||v===void 0||(v=v.data)===null||v===void 0?void 0:v.desc}).filter(E=>!!E))]})},zb=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ae(j.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(W("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?VU(e.detail[23].toLowerCase()):VU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const o=e.detail[19],c=o?.split(";");for(let l=0;l<c.length;l++){var s;const p=ni(s=c[l]).call(s);e.addresses[l]&&c&&(e.addresses[l].fingerprint=p)}}if(W("GATEWAY_ADDRESS")&&W("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",W("GATEWAY_ADDRESS"));const o=W("GATEWAY_ADDRESS").map(c=>{var l,p;const m=(l=(p=e.addresses.find(E=>E.ip===c.ip&&E.port===c.port))===null||p===void 0?void 0:p.fingerprint)!==null&&l!==void 0?l:"";return{ip:c.ip,port:c.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=o}},Oz=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=Vf(n.buffer.code);throw new ae(j.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",t),new ae(j.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Yb=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Cc(Cc(Cc({6:e.stringUid,11:t,12:W("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const o=new FormData;return o.append("request",JSON.stringify(s)),[o,r]},Nz=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let Wf=0;function Gf(e){return Ve.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const zg=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,o=0;const c=t;let l,p=0;const m=async()=>{const E=(()=>{const v=o*c,y=v+c;return n.slice(v,y).map(r)})();s&&s.push(...E);try{l=await Gf(E)}catch(v){if(p+=c,o++,!(p>=n.length))return void await m();i(v)}E.forEach(v=>v.cancel())};return await m(),l},GU=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const o=async()=>{const c=n(t.shift());try{return await c}catch(l){if(s++,s>=i||r!=null&&r(l))throw l;return o()}};return o()};async function Pz(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ve((l,p)=>{let m;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:v=>{v.close(),clearTimeout(m),l(!0)},error:v=>{clearTimeout(m),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const E=[t,n,r,i,s,o];for(let v=0;v<E.length;v++){const y=new EncodedVideoChunk({type:v==0?"key":"delta",timestamp:33333*v,duration:33333,data:new Uint8Array(E[v])});try{await e.decode(y)}catch{return void l(!1)}}})(),m=setTimeout(()=>{l(!1)},5e3)})}async function qb(e,t,n,r){return{gatewayInfo:await async function(s,o,c,l){let p=null;const m=[],E=async()=>{const y=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(O=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Kg()})),D=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(R.debug("[".concat(s.clientId,"] Connect to choose_server:"),O.url),FU(O,s,o,c)),allFailedhandler:O=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:m});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},v=async()=>{if(await Rr(1e3),p!==null)return p;const y=W("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Kg()})),D=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(R.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),O.url),FU(O,s,o,c)),allFailedhandler:O=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:m});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};try{return p=await Gf([E(),v()]),m.length&&m.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),p}catch(y){throw y[0]}}(e,t,n,r)}}async function HU(e,t,n,r,i){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await qb(e,t,n,i);if(W("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:y}=await YU(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:v};const D=y.map(A=>({turnServerURL:A.address,tcpport:A.tcpport||kr.tcpport,udpport:A.udpport||kr.udpport,username:A.username||kr.username,password:A.password||kr.password,forceturn:!1,security:!0}));if(i.useP2P){var o;const A=(o=e.uid)!==null&&o!==void 0?o:v.uid,O="glb:".concat(A.toString()),V=await Uw(O),U=y.map(G=>({turnServerURL:G.address,tcpport:G.tcpport||kr.tcpport,udpport:G.udpport||kr.udpport,username:O,password:V,forceturn:!1,security:!0}));D.push(...U)}return e.turnServer={mode:"manual",servers:D},{gatewayInfo:v}}return await qb(e,t,n,i)}const{proxyInfo:c,gatewayInfo:l}=await YU(e,t,n,i),p={gatewayInfo:l},m=c.map(v=>({turnServerURL:v.address,tcpport:s==="proxy3"?void 0:v.tcpport?v.tcpport:kr.tcpport,udpport:s==="proxy4"?void 0:v.udpport?v.udpport:kr.udpport,username:v.username||kr.username,password:v.password||kr.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var E;const v=(E=e.uid)!==null&&E!==void 0?E:l.uid,y="glb:".concat(v.toString()),D=await Uw(y),A=c.map(O=>({turnServerURL:O.address,tcpport:s==="proxy3"?void 0:O.tcpport||kr.tcpport,udpport:s==="proxy4"?void 0:O.udpport||kr.udpport,username:y,password:D,forceturn:s!=="proxy4",security:s==="proxy5"}));m.push(...A)}return e.turnServer={mode:"manual",servers:m},R.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),p}async function KU(e,t,n,r,i){const s=W("ACCOUNT_REGISTER").slice(0,W("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):s.map(l=>"https://".concat(l,"/api/v1"));const c=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const l=await async function(p,m,E,v,y){const D=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:m};let O=p[0];const V=await Ea(()=>Ca(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,G)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(m," => ").concat(U.uid),U),qe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:O,stringUid:A.string_uid,uid:U.uid,errorCode:j.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new ae(j.INVALID_UINT_UID_FROM_STRING_UID);return qe.reqUserAccount(A.sid,{lts:D,success:!0,serverAddr:O,stringUid:A.string_uid,uid:U.uid,errorCode:null,extend:A}),!1}const Z=Vf(U.code);return Z.retry&&(O=p[(G+1)%p.length]),qe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:O,stringUid:A.string_uid,uid:U.uid,errorCode:Z.desc,extend:A}),Z.retry},(U,G)=>U.code!==j.OPERATION_ABORTED&&(qe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:O,stringUid:A.string_uid,uid:null,errorCode:U.code,extend:A}),O=p[(G+1)%p.length],!0),y);if(V.code!==0){const U=Vf(V.code);throw new ae(j.UNEXPECTED_RESPONSE,U.desc)}return V}(o,e,t,n,r);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},c),l.uid}catch(l){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},c),l}}async function Dz(e,t,n){const r=W("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await GU({referenceList:i,asyncMapHandler:o=>async function(c,l,p,m){const E=Date.now(),v={sid:p.sid,opid:10,appid:p.appId,string_uid:l};try{const y=await Ca(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const D=Vf(y.code);throw new ae(j.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new ae(j.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:c,req:v,uid:y.uid,elapse:Date.now()-E}}catch(y){throw y}}(o,e,t,n),closeFn:o=>o.code===j.OPERATION_ABORTED||o.code===j.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function kz(e,t,n){const r=W("CDS_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")),i=r.map(l=>function(p,m,E,v){const y=xt(),D={flag:64,cipher_method:0,features:Cc(Cc(Cc(Cc(Cc({install_id:qw(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:Qs,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:Cz.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return Ea(()=>Ca(p,{data:D,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,A=>A.code!==j.OPERATION_ABORTED,v)}(l,e,t,n));let s=null,o=null,c={};try{s=await Gf(i)}catch(l){if(l.code===j.OPERATION_ABORTED)throw l;o=l}if(i.forEach(l=>l.cancel()),qe.reportApiInvoke(e.sid,{name:xn.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=function(l){if(!l.test_tags)return{};const p=l.test_tags,m=Object.keys(p),E={};return m.forEach(v=>{var y;const D=ni(y=v.slice(4)).call(y),A=JSON.parse(p[v]),O=A[1];E[D]={tag:A[0]||"",value:O}}),E}(s)}catch{}return c}async function zU(e,t){const n=W("WEBCS_DOMAIN").concat(W("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Kg(),serviceIds:[Hn.CHOOSE_SERVER,Hn.CLOUD_PROXY_FALLBACK]}));try{return await GU({referenceList:n,asyncMapHandler:i=>async function(s,o,c){let l,{url:p,areaCode:m,serviceIds:E}=s;const v=Date.now(),[y,D]=Yb(o,m,E);let A=Gn.networkState;try{A&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await Ve.race([Gn.onlineWaiter,Rr(qn.maxRetryTimeout)]),A=Gn.networkState;const{data:O,headers:V}=await Ca(p,{data:y,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=V.http3==="1"?1:-1,(Q=>{const z=[];if(Q.response_body.forEach(re=>{const he=re.buffer.code;if(re.uri===23&&he===0&&!re.buffer.edges_services)if(re.buffer.flag===4194310)re.buffer.edges_services=[];else{const Ee={error:new ae(j.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Q.detail[502]}),flag:re.buffer.flag};z.push(Ee)}if(he!==0){const Ee=Vf(he),Re={error:new ae(j.CAN_NOT_GET_GATEWAY_SERVER,Ee.desc,{desc:Ee.desc,retry:Ee.retry,csIp:Q.detail[502]}),flag:re.buffer.flag};re.buffer.flag===4194310?R.warning(Re.error.toString()):z.push(Re)}}),z.length)throw new ae(j.CAN_NOT_GET_GATEWAY_SERVER,z.map(re=>"flag: ".concat(re.flag,", message: ").concat(re.error.message)).join(" | "),{retry:!!z.find(re=>re.error.data.retry),csIp:Q.detail[502],desc:[...new Set(z.map(re=>{var he;return re==null||(he=re.error)===null||he===void 0||(he=he.data)===null||he===void 0?void 0:he.desc}).filter(re=>!!re))]})})(O);const G=Bg(O,Hn.CHOOSE_SERVER),Z=Bg(O,Hn.CLOUD_PROXY_FALLBACK);return zb(G),{gatewayInfo:Mb(G,p),proxyInfo:Z,opid:D,requestTime:v,url:p,isHttp3:l,elapse:Date.now()-v}}catch(O){throw O}}(i,e,t),closeFn:i=>i.code===j.OPERATION_ABORTED||i.code===j.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function YU(e,t,n,r){const i=W("PROXY_SERVER_TYPE3"),s=(y,D,A)=>{let O=A||i;return Array.isArray(O)&&(O=D%2==0&&i[1]||i[0]),"https://".concat(O,"/ap/?url=").concat(y)};let o=null;const c=[],l=async()=>{const y=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map((O,V)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(O,"/api/v2/transpond/webrtc?v=2"),V,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):s("".concat(O,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:Kg(),serviceIds:[Hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK]}}),D=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(R.debug("[".concat(e.clientId,"] Connect to choose_server:"),O.url),BU(O,e,t,n)),allFailedhandler:O=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},p=async()=>{if(await Rr(1e3),o!==null)return o;const y=W("WEBCS_DOMAIN_BACKUP_LIST").map((O,V)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(O,"/api/v2/transpond/webrtc?v=2"),V,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):s("".concat(O,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:Kg(),serviceIds:[Hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK]}}),D=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(R.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),O.url),BU(O,e,t,n)),allFailedhandler:O=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},D),O[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};let m,E,v;try{({gatewayInfo:m,proxyInfo:E,url:v}=await Gf([l(),p()]))}catch(y){throw y[0]}if(c.length&&c.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!E)throw new ae(j.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=v,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&v){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];Oe(i).call(i,y)&&(e.proxyServer=y,R.setProxyServer(y),qe.setProxyServer(y))}return o={gatewayInfo:m,proxyInfo:await gU(E,m.uid)},o}async function Lz(e,t,n){const r=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=r.map(s=>function(o,c,l,p){const m={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:Qs,cname:c.cname,uid:c.uid.toString(),requestId:Kb,seq:Kb};Kb+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(m)};return Ea(async()=>{const v=await Ca(o,{data:E,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const D=new ae(j.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw R.error(D.toString()),D}const y=JSON.parse(v.json_body);if(y.code!==200){const D=new ae(j.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw R.error(D.toString()),D}if(!y.servers||y.servers.length===0){const D=new ae(j.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(D.toString()),D}return{vid:y.vid,workerToken:y.workerToken,addressList:(W("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,v=>!!(v.code!==j.OPERATION_ABORTED&&v.code!==j.UNEXPECTED_RESPONSE||v.data&&v.data.retry),p)}(s,e,t,n));try{const s=await Gf(i);return i.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function xz(e,t,n){let r=null;const i=[],s=async o=>{const c=W(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return o&&(await Rr(1e3),r!==null)?r:await zg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:l=>(R.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),l),function(p,m,E,v){const[y]=Nz(m,[Hn.CHOOSE_SERVER]);let D=Gn.networkState;return Ea(async()=>{D&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await Ve.race([Gn.onlineWaiter,Rr(v&&v.maxRetryTimeout||qn.maxRetryTimeout)]),D=Gn.networkState;const A=await Ca(p,{data:y,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return Oz(A,p)},()=>!1,A=>A.code!==j.OPERATION_ABORTED&&(A.code===j.UPDATE_TICKET_FAILED?A.data.retry:(R.warning("[".concat(m.clientId,"] update ticket network error, retry"),A),!0)),v)}(l,e,t,n)),allFailedhandler:l=>{throw l[0]},promisesCollector:i})};try{return r=await Gf([s(!1),s(!0)]),i.length&&i.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),r}catch(o){throw o[0]}}function qU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Xb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Mz extends bn{get isSuccess(){return!!this.configs}constructor(t,n){super(),x(this,"configs",void 0),x(this,"store",void 0),x(this,"joinInfo",void 0),x(this,"cancelToken",void 0),x(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),x(this,"interval",void 0),x(this,"mutex",void 0),x(this,"mutableParamsRead",!1),x(this,"configCache",{}),x(this,"limit_bitrate",void 0),this.mutex=new jr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),W("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},W("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,qe.reportApiInvoke(null,{options:void 0,name:xn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Tn.TRACER}).onSuccess(JSON.stringify(va))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await kz(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(i){var s;const o=th(s=Object.keys(i).filter(p=>/^webrtc_ng_global_parameter/.test(p))).call(s);for(let p=0;p<o.length;p++)for(let m=o.length-1;m>p;m--){const E=o[m],v=i[E].value;if(typeof v.__priority=="number"){const y=v.__priority,D=o[m-1],A=i[D].value;if(typeof A.__priority=="number"){if(!(y>A.__priority))continue;{const O=E;o[m]=o[m-1],o[m-1]=O}}else{const O=E;o[m]=o[m-1],o[m-1]=O}}}const c=Date.now();let l={};return o.forEach(p=>{const m=i[p].value.__expires;m&&m<=c||(l[p]=i[p])}),l}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new ae(j.NETWORK_RESPONSE_ERROR,r);R.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){oU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Vg.UPDATE_BITRATE_LIMIT,t):this.emit(Vg.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Xb({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),i=[];r.forEach(s=>{const o=t[s].value;n[s]=o;const c=o.__id;if(c&&this.configCache[s]&&this.configCache[s].__id===c)return;const l=o.__type,p=t[s].value,m=t[s].tag;let E=0;l?l===NL.REALTIME&&(E=1):Object.keys(p).some(v=>Object.prototype.hasOwnProperty.call(Zw,v)||!wb()&&Object.prototype.hasOwnProperty.call(Ay,v)?(E=1,!0):void 0),i.push({tag:m,isApplied:E,feature:s,params:JSON.stringify(o)})}),i.forEach(s=>{let{tag:o,feature:c,params:l,isApplied:p}=s;this.store.sessionId&&qe.abTest(this.store.sessionId,{intSucc:1,isApplied:p,tag:o,feature:c,params:l,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){R.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(i){const s={};return Object.keys(i).forEach(o=>{const c=i[o].value,l=c.__expires,p=c.__type;Object.keys(c).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(s,m)||(s[m]=Xb(Xb({value:c[m]},l&&{expires:l}),p&&{type:p}))})}),s}(t);try{var r;const i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&oU(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(c){try{const l=Date.now();Object.keys(c).forEach(p=>{const{value:m,type:E,expires:v}=c[p];v&&v<=l||((E===NL.REALTIME||Object.prototype.hasOwnProperty.call(Zw,p))&&(va[p]=m,Sn[p]=m,R.debug("Update realtime parameters from config distribute",p,m)),E||wb()||!Object.prototype.hasOwnProperty.call(Ay,p)||(va[p]=m,Sn[p]=m,R.debug("Update gateway parameters from config distribute",p,m)))})}catch(l){R.error("Error update config immediately: ".concat(c),l.message)}}(n);const s=JSON.stringify(n),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),R.debug("Caching global parameters ".concat(s))}catch(i){R.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Sn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;(function(o,c){try{return typeof o=="object"&&typeof c=="object"&&JSON.stringify(o)===JSON.stringify(c)}catch{return!1}})(Sn[r],i)||(va[r]=i,Sn[r]=i,this.emit(Vg.UPDATE_CLIENT_ROLE_OPTIONS,i),R.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(n){R.error("Error handling global parameter config:",n.message)}}}class Uz extends bn{constructor(){super(...arguments),x(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(W("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?W("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var o;const c=Oe(o=i.result).call(o,!0);i.isPrevNormal&&!c&&this.emit("exception",Jb[t],t,n),!i.isPrevNormal&&c&&this.emit("exception",Jb[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof $n&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=as(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||Oe(n=W("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof $n&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Jb={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Gr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function XU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Th(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Yg{constructor(t){x(this,"store",void 0),x(this,"onStatsException",void 0),x(this,"onUploadPublishDuration",void 0),x(this,"onStatsChanged",void 0),x(this,"onVideoCodecChanged",void 0),x(this,"localStats",new Map),x(this,"remoteStats",new Map),x(this,"updateStatsInterval",void 0),x(this,"trafficStats",void 0),x(this,"trafficStatsPeerList",[]),x(this,"uplinkStats",void 0),x(this,"exceptionMonitor",void 0),x(this,"p2pChannel",void 0),x(this,"scalabilityMode",Iy.L1T1),x(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Uz,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Te.LocalAudioTrack)||Th({},ib)}getLocalVideoTrackStats(){return this.localStats.get(Te.LocalVideoTrack)||Th({},sb)}getRemoteAudioTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:c}]=s;c&&(r[o]=n(o,c))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:o}]=i;o&&(n[s]=o)});return n}getRemoteVideoTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:c}]=s;c&&(r[o]=n(o,c))});return r}getRTCStats(){let t=0,n=0,r=0,i=0;const s=this.localStats.get(Te.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(Te.LocalVideoTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(Te.LocalVideoLowTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:m,videoStats:E}=p;m&&(r+=m.receiveBytes,i+=m.receiveBitrate),E&&(r+=E.receiveBytes,i+=E.receiveBitrate)});let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?Gr.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?Gr.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case Te.LocalVideoTrack:case Te.LocalVideoLowTrack:{const c=i,l=Th({},sb),p=t.getStats(),m=t.getLocalMedia(r);if(p){const E=p.videoSend.find(v=>v.ssrc===m?.ssrcs[0].ssrcId);if(E){const v=t.getLocalVideoSize(),y=t.getEncoderConfig(Te.LocalVideoTrack);var s;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(l.codecType=E.codec,c?.codecType!==E.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,E.codec.toLocaleLowerCase()))),l.sendBytes=E.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,E.inputFrame?(l.captureFrameRate=E.inputFrame.frameRate,l.captureResolutionHeight=E.inputFrame.height,l.captureResolutionWidth=E.inputFrame.width):v&&(l.captureResolutionWidth=v.width,l.captureResolutionHeight=v.height),E.sentFrame?(l.sendFrameRate=E.sentFrame.frameRate,l.sendResolutionHeight=E.sentFrame.height,l.sendResolutionWidth=E.sentFrame.width):v&&(l.sendResolutionWidth=v.width,l.sendResolutionHeight=v.height),E.avgEncodeMs&&(l.encodeDelay=E.avgEncodeMs),y&&y.bitrateMax?l.targetSendBitrate=1e3*y.bitrateMax:E.targetBitrate&&(l.targetSendBitrate=E.targetBitrate),l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(l.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,l),(c?.sendResolutionWidth!==l.sendResolutionWidth||c?.sendResolutionHeight!==l.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,l);break}case Te.LocalAudioTrack:{const c=i,l=Th({},ib),p=t.getStats(),m=t.getLocalMedia(r);if(p){const E=p.audioSend.find(v=>v.ssrc===m?.ssrcs[0].ssrcId);if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(l.codecType=E.codec),E.inputLevel)l.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const v=t.getLocalAudioVolume();v&&(l.sendVolumeLevel=Math.round(32767*v))}l.sendBytes=E.bytes,l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Te.LocalAudioTrack,l),l&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[s,{videoStats:o,audioStats:c,videoPcStats:l}]=n;const p=c,m=o,E=l,v=Th({},BL),y=Th({},WL),D=Th({},SK),{audioTrack:A,videoTrack:O,audioSSRC:V,videoSSRC:U}=t.getRemoteMedia(s);let G;G=this.store.useP2P?t.getStats(!0):t.getStats();const Z=(r=G)===null||r===void 0?void 0:r.audioRecv.find(he=>he.ssrc===V),Q=(i=G)===null||i===void 0?void 0:i.videoRecv.find(he=>he.ssrc===U),z=this.trafficStats&&this.trafficStats.peer_delay.find(he=>he.peer_uid===s);if(Z&&(Z.codec!=="opus"&&Z.codec!=="aac"&&Z.codec!=="PCMU"&&Z.codec!=="PCMA"&&Z.codec!=="G722"||(v.codecType=Z.codec),Z.outputLevel?v.receiveLevel=Math.round(32767*Z.outputLevel):A&&(v.receiveLevel=Math.round(32767*A.getVolumeLevel())),v.receiveBytes=Z.bytes,v.receivePackets=Z.packets,v.receivePacketsLost=Z.packetsLost,v.receivePacketsDiscarded=Z.packetsDiscarded,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=p?8*Math.max(0,v.receiveBytes-p.receiveBytes):0,v.totalDuration=p?p.totalDuration+1:1,v.totalFreezeTime=p?p.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=Z.jitterBufferMs,v.totalDuration>10&&Yg.isRemoteAudioFreeze(A)&&(v.totalFreezeTime+=1)),Q){var re;Q.codec!=="H264"&&Q.codec!=="H265"&&Q.codec!=="VP8"&&Q.codec!=="VP9"&&Q.codec!=="AV1X"&&Q.codec!=="AV1"||(y.codecType=Q.codec),y.receiveBytes=Q.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,y.renderFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,Q.outputFrame&&(y.renderFrameRate=Q.outputFrame.frameRate),Q.receivedFrame?(y.receiveFrameRate=Q.receivedFrame.frameRate,y.receiveResolutionHeight=Q.receivedFrame.height,y.receiveResolutionWidth=Q.receivedFrame.width):O&&(y.receiveResolutionHeight=O._videoHeight||0,y.receiveResolutionWidth=O._videoWidth||0),Q.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(Q.framesRateFirefox)),y.receivePackets=Q.packets,y.receivePacketsLost=Q.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const he=m?m.totalFreezeTime:0,Ee=m?m.totalDuration:0;y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=(re=Q.totalFreezesDuration)!==null&&re!==void 0?re:he||0,y.receiveDelay=Q.jitterBufferMs||0;const Re=!!U&&t.getRemoteVideoIsReady(U);Q.totalFreezesDuration===void 0&&O&&Re&&Yg.isRemoteVideoFreeze(O,Q,E)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-he)/(y.totalDuration-Ee),1))}z&&(v.end2EndDelay=z.B_ad,y.end2EndDelay=z.B_vd,v.transportDelay=z.B_ed,y.transportDelay=z.B_ed,v.currentPacketLossRate=z.B_ealr4/100,y.currentPacketLossRate=z.B_evlr4/100,D.uplinkNetworkQuality=z.B_punq?z.B_punq:0,D.downlinkNetworkQuality=z.B_pdnq?z.B_pdnq:0),this.remoteStats.set(s,{audioStats:v,videoStats:y,videoPcStats:Q,networkStats:D}),A&&this.exceptionMonitor.setRemoteAudioStats(A,v),O&&this.exceptionMonitor.setRemoteVideoStats(O,y)})}}class JU{constructor(){x(this,"destChannelMediaInfos",new Map),x(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){iU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){iU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Yy(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function QU(e){if(!(e instanceof JU))return new ae(j.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new ae(j.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new ae(j.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Pd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){x(this,"uid",void 0),x(this,"_uintid",void 0),x(this,"_trust_in_room_",!0),x(this,"_trust_audio_enabled_state_",!0),x(this,"_trust_video_enabled_state_",!0),x(this,"_trust_audio_mute_state_",!0),x(this,"_trust_video_mute_state_",!0),x(this,"_audio_muted_",!1),x(this,"_video_muted_",!1),x(this,"_audio_enabled_",!0),x(this,"_video_enabled_",!0),x(this,"_audio_added_",!1),x(this,"_video_added_",!1),x(this,"_is_pre_created",!1),x(this,"_video_pre_subscribed",!1),x(this,"_audio_pre_subscribed",!1),x(this,"_trust_video_stream_added_state_",!0),x(this,"_trust_audio_stream_added_state_",!0),x(this,"_audioTrack",void 0),x(this,"_videoTrack",void 0),x(this,"_dataChannels",[]),x(this,"_audioSSRC",void 0),x(this,"_videoSSRC",void 0),x(this,"_audioOrtc",void 0),x(this,"_videoOrtc",void 0),x(this,"_cname",void 0),x(this,"_rtxSsrcId",void 0),x(this,"_videoMid",void 0),x(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function ZU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Qb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZU(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const cT="9",Zb=2e4,lT=4e4;function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ml(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$U(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Hf=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Hf||{});const dT=new Map;function e5(e,t,n,r){let{scale:i}=e;if(i===0&&r===Hf.UP||i>=t.length-1&&r===Hf.DOWN)return e;let s=ml(ml({},e),{},{scale:r===Hf.DOWN?++i:--i});switch(n){case"maintain-framerate":s=ml(ml({},s),t[i].motion);break;case"maintain-resolution":s=ml(ml({},s),t[i].detail);break;case"balanced":s=ml(ml({},s),t[i].balanced)}return s}function t5(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:n5(t)};dT.set(e,n)}else dT.delete(e)}function n5(e){const t=ml({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:l,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:O,BALANCE_RESOLUTION_FACTOR:V,MOTION_RESOLUTION_FACTOR:U,MOTION_BITRATE_FACTOR:G,DETAIL_FRAMERATE_FACTOR:Z,DETAIL_BITRATE_FACTOR:Q}=Jw,z=Math.min(t.frameRate,c),re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(v,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*z),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let he=1;he<=l;he++){const Ee={bwe_up:Math.round(Math.pow(E,he)*n),bwe_down:Math.round(Math.pow(v,he+1)*n),fps_up:Math.round(Math.pow(D,he)*z),fps_down:Math.round(Math.pow(y,he+1)*z)},Re={scaleResolutionDownBy:i/Math.pow(V,he),frameRate:Math.max(Math.round(Math.pow(O,he)*r),o),bitrateMax:Math.max(Math.round(Math.pow(A,he)*n),m),bitrateMin:Math.max(Math.round(Math.pow(A,he)*s),p)},Ct={scaleResolutionDownBy:i/Math.pow(U,he),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(G,he)*n),m),bitrateMin:Math.max(Math.round(Math.pow(G,he)*s),p)},bt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Z,he)*r),o),bitrateMax:Math.max(Math.round(Math.pow(Q,he)*n),m),bitrateMin:Math.max(Math.round(Math.pow(Q,he)*s),p)};re.push({scale:he,threshold:Ee,balanced:Re,motion:Ct,detail:bt})}return re}function Vz(e,t,n,r,i,s){const o=dT.get(e)||{overUse:0,underUse:0,adaptationList:n5(i)},{adaptationList:c}=o;dT.set(e,o);const{OVERUSE_TIMES_THRESHOLD:l,UNDERUSE_TIMES_THRESHOLD:p}=Jw,{scale:m}=r;let E,v;return typeof t=="number"&&t>0&&function(y,D,A,O){if(D>=A.length)return!1;let{threshold:{fps_down:V}}=A[D];return W("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(V=A[0].threshold.fps_down),y<V}(t,m,c,s)&&(o.overUse++,v=Ng.CPU,o.overUse>l)||typeof n=="number"&&n>0&&function(y,D,A){if(D>=A.length)return!1;const{threshold:{bwe_down:O}}=A[D];return y<O}(n,m,c)&&(o.overUse++,v=Ng.BANDWIDTH,o.overUse>l)?(o.overUse=0,o.underUse=0,E=e5(r,c,s,Hf.DOWN),[E,v]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(y,D,A,O){if(D===0)return;let{threshold:{fps_up:V}}=A[D];return W("FORCE_AG_HIGH_FRAMERATE")&&O==="maintain-framerate"&&(V=A[1].threshold.fps_up),y>V}(t,m,c,s)&&function(y,D,A){if(D===0)return;const{threshold:{bwe_up:O}}=A[D];return y>O}(n,m,c)&&(o.underUse++,o.underUse>p&&(o.overUse=0,o.underUse=0,E=e5(r,c,s,Hf.UP),E.scale===0&&(v=Ng.NONE))),[E,v])}function r5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function $b(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const uT=new Map;function hT(e,t){const n=uT.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),uT.delete(e)}t.qualityLimitationReason=Ng.NONE,t5(e)}function jz(e,t){var n;let r;switch(t){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Oe(n=e._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return r}function eI(e){const t=Ft();if(e.some(n=>n._bypassWebAudio))throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function tI(e,t){eI(e);const n=new $n;return e.forEach(r=>n.addAudioTrack(r)),n}const Fz=!Ft().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&ll();function pT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return Fz?(n={spec:t,store:e},fl("PlanBConnection").create(n)):new no(t,e)}function nI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function i5(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Ig(e.turnServer.servers))return!1;if(W("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Mt;function s5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let no=(Mt=class xh extends cU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Oe(n=Object.keys(Dg)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"id",on(5,"connection-")),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"forceTurn",!1),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"transportEventReceiver",void 0),x(this,"statsFilter",void 0),x(this,"extension",{useXR:W("USE_XR")}),x(this,"localCapabilities",void 0),x(this,"remoteCodecs",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"isPreallocation",!1),x(this,"preMediaMap",new Map),x(this,"dataStreamChannelMap",new Map),x(this,"establishPromise",void 0),x(this,"recoveredDataChannelIds",[]),x(this,"currentDataChannelId",1),x(this,"supportAV1RtpSpec",!1),x(this,"mutex",void 0),x(this,"qualityLimitationReason",Ng.NONE),x(this,"isFirstConnected",!1),this.store=n,this.forceTurn=i5(t),this.mutex=new jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(xh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Yw(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Id(r.sdp),s=await IU({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:W("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:W("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=rT(s),this.initialOffer=r,W("ENABLE_SVC")&&this.store.codec=="av1"){const c=await async function(){try{const l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Iy.L1T3}]});const p=await l.createOffer();if(!p.sdp)return void l.close();const m=Gi(p.sdp).mediaDescriptions[0];if(!m)return;const E=m.attributes.extmaps.find(v=>v.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return l.close(),E}catch{return}}();var t;c&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(c))}let o;return r.sdp&&PU(r.sdp)&&(o=Cn(s),(n=o).send&&(jf(Be.VIDEO,n.send.videoExtensions),jf(Be.AUDIO,n.send.audioExtensions)),n.recv&&(jf(Be.VIDEO,n.recv.videoExtensions),jf(Be.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(jf(Be.VIDEO,n.sendrecv.videoExtensions),jf(Be.AUDIO,n.sendrecv.audioExtensions))),Ra(Ra({},i),{},{rtpCapabilities:o||s,offerSDP:r.sdp})}catch(r){throw new ue(j.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&PU(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(eT(Be.VIDEO,n.send.videoExtensions,r.send.videoExtensions),eT(Be.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(eT(Be.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),eT(Be.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Cn(this._localCapabilities)}get rtpCapabilities(){return Cn(this._rtpCapabilities)}get candidates(){return Cn(this._candidates)}get iceParameters(){return Cn(this._iceParameters)}get dtlsParameters(){return Cn(this._dtlsParameters)}constructor(l){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1],m=arguments.length>2&&arguments[2]!==void 0&&arguments[2];x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_originCandidates",void 0),x(this,"_iceParameters",void 0),x(this,"_isUseExtmapAllowMixed",void 0),x(this,"_isUseLocalCodecs",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),x(this,"useLocalCodecsMids",[]),x(this,"preloadSsrcs",[]),x(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,this._isUseLocalCodecs=m,l=Cn(l);const{iceParameters:E,dtlsParameters:v,candidates:y,rtpCapabilities:D,setup:A,localCapabilities:O,cname:V}=l;this._rtpCapabilities=D,this._candidates=y,this._originCandidates=Cn(y),this._iceParameters=E,this._dtlsParameters=v,this._localCapabilities=O,this.setup=A,this.cname=V,[this.sessionDesc]=this.updateRemoteRTPCapabilities(D),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(l){return l.length===this.preloadSsrcs.length&&l.every(p=>{var m;return Oe(m=this.preloadSsrcs).call(m,p)})}preloadRemoteMedia(l){let p=0;const m=[],E=[];for(;l>0;){const v=[Qb({ssrcId:lT+p},W("USE_SUB_RTX")?{rtx:lT+p+1}:{})],y="".concat(lT+p,"_").concat(Zb+p),{ssrcs:D,ssrcGroups:A}=Gg(v,this.cname,W("SYNC_GROUP")?y:void 0),O=this.preCreateOrRecycleSendMedia("video",D,A,void 0),V=[{ssrcId:Zb+p}],U="".concat(lT+p,"_").concat(Zb+p),{ssrcs:G,ssrcGroups:Z}=Gg(V,this.cname,W("SYNC_GROUP")?U:void 0),Q=this.preCreateOrRecycleSendMedia("audio",G,Z,void 0);l--,p+=2,m.push(O,Q),E.push(D[0].ssrcId,G[0].ssrcId)}return this.useLocalCodecsMids.push(...m),this.preloadSsrcs=E,{mids:m,preSSRCs:E,isAvailable:!0}}preCreateOrRecycleSendMedia(l,p,m,E){const v=this.rtpCapabilities.send.videoCodecs,y=this._isUseLocalCodecs||v.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",p[0].ssrcId);const D=l===Be.VIDEO?y.videoCodecs:y.audioCodecs,A=l===Be.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;const O="".concat(this.currentMidIndex);let V={media:{mediaType:l,port:cT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:D,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(O)}};return V=this.mungSendMediaDesc(V,E),this.sessionDesc.mediaDescriptions.push(V),this.updateBundleMids(),O}toString(){return yd(this.sessionDesc)}send(l,p,m,E){const{ssrcs:v,ssrcGroups:y}=Gg(p,this.cname,W("SYNC_GROUP")?m:void 0),D=this.findPreloadMediaDesc(v);if(D){if(Nn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,D.attributes.mid),E&&(E.twcc||E.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(D);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(D,E),{mid:D.attributes.mid,needExchangeSDP:!0}}return{mid:D.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(l,v);let O;return A===-1||A===1&&(Nr()||function(){const V=xt();return!(V.name!==Wt.CHROME||!V.osVersion)&&Number(V.version)<=90}()||W("ENABLE_ENCODED_TRANSFORM")&&cl())||A===0&&!function(V){const U=xt();return!(U.name!==Wt.FIREFOX||!U.osVersion)&&Number(U.version)===V}(138)&&W("USE_SUB_RTX")||eL()?(O=this.createOrRecycleSendMedia(l,v,y,"sendonly",E),this.updateBundleMids()):(O=Cn(this.sessionDesc.mediaDescriptions[A]),O.attributes.direction="sendonly",O.attributes.ssrcs=v,O.attributes.ssrcGroups=y,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(O,E)),Nn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,O.attributes.mid),{mid:O.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:l,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:l.attributes.mid,needExchangeSDP:p}}batchSend(l){const p=l.map(v=>{let{kind:y,ssrcMsg:D,mslabel:A}=v;return this.send(y,D,A)}),m=[];let E=!1;return p.forEach(v=>{let{mid:y,needExchangeSDP:D}=v;D&&(E=!0),m.push(y)}),{mids:m,needExchangeSDP:E}}stopSending(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&l.indexOf(m.attributes.mid)!==-1);if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(m=>{m.attributes.mid==="0"||Nn()||eL()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(l){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l);if(!p)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(l){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l);if(!p)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>Oe(l).call(l,m.attributes.mid||""));if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>Oe(l).call(l,m.attributes.mid||""));if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="recvonly"})}receive(l,p,m,E){l.forEach((v,y)=>{this.createOrRecycleRecvMedia(v,[],"recvonly",p,m,E[y])}),this.updateBundleMids()}stopReceiving(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>l.indexOf(m.attributes.mid)!==-1);if(p.length!==l.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(l){const p=this.sessionDesc||Gi((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=l;let E=!1;const v=this.rtpCapabilities.send,y=this.localCapabilities.send,D=this.localCapabilities.recv,A=D.videoCodecs,O=D.audioCodecs,V=D.videoExtensions,U=D.audioExtensions;for(const z of p.mediaDescriptions){var G;if(z.attributes.direction!=="sendonly"||typeof z.attributes.mid!="string"||!Oe(G=this.useLocalCodecsMids).call(G,z.attributes.mid)){if(E=!0,z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var Z;z.media.fmts=A.map(he=>he.payloadType.toString(10)),z.attributes.payloads=A,z.attributes.extmaps=V;const re=z.attributes.mid;typeof re!="string"||Oe(Z=this.useLocalCodecsMids).call(Z,re)||this.useLocalCodecsMids.push(re)}else if(v.videoCodecs.length===0){const re=y.videoCodecs.filter(he=>{var Ee,Re;return(Ee=he.rtpMap)===null||Ee===void 0?void 0:Oe(Re=Ee.encodingName.toLowerCase()).call(Re,"vp8")})||[y.videoCodecs[0]];z.media.fmts=re.map(he=>he.payloadType.toString(10)),z.attributes.payloads=re,z.attributes.extmaps=[]}else z.media.fmts=v.videoCodecs.map(re=>re.payloadType.toString(10)),z.attributes.payloads=v.videoCodecs,z.attributes.extmaps=v.videoExtensions;if(z.media.mediaType==="audio")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var Q;z.media.fmts=O.map(he=>he.payloadType.toString(10)),z.attributes.payloads=O,z.attributes.extmaps=U;const re=z.attributes.mid;typeof re!="string"||Oe(Q=this.useLocalCodecsMids).call(Q,re)||this.useLocalCodecsMids.push(re)}else if(v.audioCodecs.length===0){const re=y.audioCodecs.filter(he=>{var Ee,Re;return(Ee=he.rtpMap)===null||Ee===void 0?void 0:Oe(Re=Ee.encodingName.toLowerCase()).call(Re,"opus")})||[y.audioCodecs[0]];z.media.fmts=re.map(he=>he.payloadType.toString(10)),z.attributes.payloads=re,z.attributes.extmaps=[]}else z.media.fmts=v.audioCodecs.map(re=>re.payloadType.toString(10)),z.attributes.payloads=v.audioCodecs,z.attributes.extmaps=v.audioExtensions,Bf(z)}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,[this.sessionDesc,E]}updateCandidates(l){const p=this._originCandidates.filter(E=>E.transport==="udp"),m=[];if(p.forEach(E=>{m.push(Qb(Qb({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}),p.length!==0){switch(l){case Wr.TCP_RELAY:this._candidates=m;break;case Wr.UDP_TCP_RELAY:case Wr.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(l){l=Cn(l),this._iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=l.iceUfrag,p.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const p=[];for(let m=0;m<l;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(l,p){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const E=m.media.mediaType===l&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(Nn()){if(E){const v=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(v||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!v||v!==m.attributes.mid)}return!1}return E})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const l="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:cT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(l),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(l,p,m,E,v,y){const D=l._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,O=Hg(D,A,this.localCapabilities.send,D===Be.VIDEO?E:v),V=D===Be.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const U="".concat(this.currentMidIndex);let G={media:{mediaType:D,port:cT,protos:["UDP","TLS","RTP","SAVPF"],fmts:O.map(Q=>Q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:V,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:O,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(U)}};G=this.mungRecvMediaDsec(G,l,y);const Z=this.findFirstClosedMedia(D);if(Z){const Q=this.sessionDesc.mediaDescriptions.indexOf(Z);this.sessionDesc.mediaDescriptions[Q]=G}else this.sessionDesc.mediaDescriptions.push(G);return G}updateRemoteDtlsParameters(l){const p=new Set(this._dtlsParameters.fingerprints.map(v=>v.fingerprint)),m=new Set(l.map(v=>v.fingerprint));let E=!1;p.size!==m.size&&(E=!0);for(const v of p)m.has(v)||(E=!0);return E}updateRemoteCodec(l,p,m){const E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(G=>G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||"").filter(G=>{var Z;return Oe(Z=Object.keys(Dg)).call(Z,G)}))],v=new Set(p);if(E.every(G=>v.has(G)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const y=this._rtpCapabilities.recv.videoCodecs.filter(G=>p.some(Z=>{var Q;return Oe(Q=G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||"").call(Q,Z)}));if(y.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(p)),!1;const D=[...new Set(y.map(G=>G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||""))];let A;if(R.debug("updateRemoteCodec, from ".concat(E," to ").concat(D)),l.length===0)A=this.sessionDesc.mediaDescriptions.filter(G=>G.media.mediaType==="video"&&G.attributes.direction==="recvonly");else if(A=this.sessionDesc.mediaDescriptions.filter(G=>G.attributes.mid&&G.media.mediaType==="video"&&Oe(l).call(l,G.attributes.mid)&&G.attributes.direction==="recvonly"),A.length!==l.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(l,", codecs: ").concat(p)),!1;if(W("USE_PUB_RTX")||W("USE_SUB_RTX")){const G=Ad(y,this.rtpCapabilities.recv.videoCodecs);y.push(...G)}this._rtpCapabilities.recv.videoCodecs=y;const O=this.localCapabilities.send,V=this.rtpCapabilities.recv,U=Hg(Be.VIDEO,V,O,m);return A.forEach(G=>{const Z=U.map(Q=>Q.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(G.attributes.mid,", from"),G.attributes.payloads,"to",U),G.attributes.payloads=U,G.media.fmts=Z}),!0}createOrRecycleSendMedia(l,p,m,E,v){const y=this.rtpCapabilities.send.videoCodecs,D=this._isUseLocalCodecs||y.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,A=l===Be.VIDEO?D.videoCodecs:D.audioCodecs,O=l===Be.VIDEO?D.videoExtensions:D.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let U={media:{mediaType:l,port:cT,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(Z=>Z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:O,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};U=this.mungSendMediaDesc(U,v);const G=this.findFirstClosedMedia(l);if(G){const Z=this.sessionDesc.mediaDescriptions.indexOf(G);this.sessionDesc.mediaDescriptions[Z]=U}else this.sessionDesc.mediaDescriptions.push(U);return U}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(l=>l.media.port!=="0").map(l=>l.attributes.mid)}mungRecvMediaDsec(l,p,m){const E=Cn(l);return Vb(E),Ff(E,p),jb(E,p),wU(E),nT(E,m,this.localCapabilities.send),E}mungSendMediaDesc(l,p){const m=Cn(l);return nT(m,p,this.localCapabilities.recv),Bf(m),m}updateRecvMedia(l,p){const m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===l);if(m!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=E}}bumpMid(l){this.currentMidIndex+=l}findFirstClosedMedia(l){return this.sessionDesc.mediaDescriptions.find(p=>Nn()?p.media.port==="0"&&p.media.mediaType===l:p.media.port==="0")}findPreloadMediaDesc(l){return this.sessionDesc.mediaDescriptions.find(p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===l[0].ssrcId})}getSSRC(l){var p;return(p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l))===null||p===void 0?void 0:p.attributes.ssrcs}}(Ra(Ra({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!W("ENABLE_PRE_SUB_WITH_PRE_PC")||!W("PRE_USE_LOCAL_CODECS"))&&tb(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=OU(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),tb(this.store))if(t.preallocation&&W("ENABLE_PRE_SUB_WITH_PRE_PC")){const l=W("PRE_SUB_NUM"),{mids:p,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(l);await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(p,m)}else{const{preSSRCs:l=[]}=t,p=l.map(E=>E.ssrcMsg[0].ssrcId);if(l.length===0)return;const{mids:m}=this.remoteSDP.batchSend(l.map(E=>Object.assign({},E)));await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(p)),this.presetMedia(m,p)}}catch(i){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var n,r}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const o=s.receiver.track;let c;o.kind==="video"&&W("ENABLE_PRE_RENDER")&&(c=new fb({trackId:"track-".concat(o.kind,"-unknown-").concat(this.store.clientId,"_").concat(on(5,""))},!0),c.updateVideoTrack(o),c.onFirstVideoFrameRender=()=>{var l;const p=this.preMediaMap.get(n[i]);p&&(p.firstVideoRender=Date.now()),(l=this.onFirstVideoRender)===null||l===void 0||l.call(this,n[i])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:o,player:c,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const o=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||o}const{preSSRCs:i=[]}=t,s=i.map(o=>o.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const o=[],c=[];if(Array.from(this.preMediaMap.entries()).every(l=>{let[p,{mid:m,player:E,track:v}]=l;return o.push(m),c.push(p),this.preMediaMap.delete(p),E&&E.destroy(),!0}),o.length>0&&(this.remoteSDP.stopSending(o),await Od(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),qe.reportApiInvoke(this.store.sessionId,{name:xn.PRELOAD_MEDIA_FAILED,options:[i,c],tag:Tn.TRACER}).onSuccess()),i.length>0){const{mids:l}=this.remoteSDP.batchSend(i.map(p=>Object.assign({},p)));await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(l,s)}}n?(await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return Js(function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=$y();t.forEach(O=>{const V=i.peerConnection.addTransceiver(O._mediaStreamTrack,Ra({direction:"sendonly"},O.trackMediaType==="video"&&i.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));o.push(V),O._updateRtpTransceiver(V)}),Nn()&&W("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=yield jt(i.peerConnection.createOffer()),p=i.remoteSDP.predictReceivingMids(t.length),m=i.mungSendOfferSDP(l.sdp,t,p),E=Gi(m),v=p.map(O=>{const V=E.mediaDescriptions.find(U=>U.attributes.mid===O);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return TU(V,W("USE_PUB_RTX"))});let y;try{y=yield v}catch(O){y=[],i.remoteSDP.receive(t,n,r,y);const V=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:V})),yield jt(i.stopSending(p,!0)),O}i.remoteSDP.receive(t,n,r,y);const D=i.remoteSDP.toString(),A=i.logSDPExchange(m,"offer","local","send");return yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t)),A?.(D),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:D})),o.map((O,V)=>{const U=p[V];return{localSSRC:v[V],id:U,transceiver:O}})}catch(o){throw o instanceof ue?o:new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof ue?r:new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ue?n:new ue(j.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(l=>{var p;hT(this.id+l.mid,this),l.direction="inactive",(p=l.stop)===null||p===void 0||p.call(l)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);o&&(await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Od(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(o=>o.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(o=>{let[c,{mid:l,player:p}]=o;if(l===s)return this.preMediaMap.delete(c),p&&p.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(o,c)=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Js(function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration,s=W("FORCE_TURN_TCP")||n.forceTurn;if(t===Wr.RELAY&&!i)return;if(i&&!s){const E=t===Wr.RELAY?"relay":"all",v=n.peerConnection.getConfiguration();v.iceTransportPolicy!==E&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(E,"]")),v.iceTransportPolicy=E,n.peerConnection.setConfiguration(v))}n.remoteSDP.updateCandidates(t);const o=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Id(o.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const p=n.remoteSDP.toString(),m=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield jt(n.peerConnection.setLocalDescription(o)),m?.(p),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(i){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Wr.TCP_RELAY),await Od(this.peerConnection,this.remoteSDP,this.extension)}catch(n){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{hT(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ra(Ra({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ue(j.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Ra(Ra({},Ec),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Ra(Ra({},Ec),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=yh(t.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Ig(t.turnServer.servers)?n.iceServers=t.turnServer.servers:W("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(W("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...xh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...xh.newTurnServerConfigToIceServers(t.turnServer.servers)),W("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...xh.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...xh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(wd(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!W("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const i=W("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(wd(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(wd(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n?.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const o=i.address+":"+i.port,c=s.address+":"+s.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(yh(o)),", remote ").concat(JSON.stringify(yh(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(O=>O.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=function(A,O){return A.getTransceivers().find(V=>V.sender.track===O||V.receiver.track===O)}(this.peerConnection,t._mediaStreamTrack),l=wK(t);if(function(A){var O;return!(!W("ENABLE_AG_ADAPTATION")||!(A instanceof My||Oe(O=A._hints).call(O,rn.CUSTOM_TRACK))||!W("FORCE_SUPPORT_AG_ADAPTATION")&&!(Zk(14,0,!1)&&$k(17,4)||Qk(14)&&Nw(17,4,!0)))}(t)&&c&&n&&l&&this.getLocalVideoStats&&Oe(r=["vp8","vp9"]).call(r,this.store.codec)){var p;const A=s.degradationPreference||(Oe(p=t._hints).call(p,rn.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(O,V,U,G,Z,Q){if(hT(O,U),Z(V),G!=="balanced"&&G!=="maintain-framerate"&&G!=="maintain-resolution")return;let z=-1;t5(O,V);const re=window.setInterval(()=>{const Ee=uT.get(O);if(!W("ENABLE_AG_ADAPTATION")||!Ee)return hT(O,U),void Z(V);const Re=Q();if(Re.sendPackets>0&&Re.OutgoingAvailableBandwidth>0){if(z===-1)return void(z=Date.now());if(Date.now()-z<1e3)return;const Ct=Re.sendFrameRate,bt=Re.OutgoingAvailableBandwidth,[ut,Yt]=Vz(O,Ct,bt,Ee.adaptationConfig,V,G);Yt&&(U.qualityLimitationReason=Yt),ut&&Ee.adaptationConfig.scale!==ut.scale&&(R.debug("[".concat(O,"] applyAdaptation: ").concat(U.qualityLimitationReason,`
           sendFps `).concat(Ct,", bwe ").concat(bt,", switch from ").concat(Ee.adaptationConfig.scale," to ").concat(ut.scale," ")),Ee.adaptationConfig=$b($b({},Ee.adaptationConfig),ut),Z(ut))}},W("CHECK_LOCAL_STATS_INTERVAL")),he=$b({},V);uT.set(O,{timer:re,adaptationConfig:he,originConfig:V,adaptationFunc:Z}),R.debug("[".concat(O,"] start adaptation, originConfig: ").concat(JSON.stringify(V),", degradationPreference: ").concat(G))})(this.id+c.mid,l,this,A,O=>{n&&this.updateAdaptation(n,O)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;const{bitrateMax:A,frameRate:O,scaleResolutionDownBy:V}=t._encoderConfig;A&&(o.maxBitrate=1e3*A),(Oe(m=t._hints).call(m,rn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(O&&(o.maxFramerate=as(O)),V&&V>=1&&(o.scaleResolutionDownBy=V))}const{maxFramerate:E}=W("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,E):E),W("DSCP_TYPE")&&ll()){var v;const A=W("DSCP_TYPE");Oe(v=["very-low","low","medium","high"]).call(v,A)&&(o.networkPriority=A)}const y=n.getParameters(),D=(i=y.encodings)===null||i===void 0?void 0:i[0];Nn()&&!D&&(s.encodings=[o]),D&&Object.assign(D,o),Object.assign(y,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await n.setParameters(y),await async function(A,O,V){try{var U;if(!Ft().supportSetRtpSenderParameters||!function(re){return re==="vp9"||re==="av1"}(A)||!W("ENABLE_SVC"))return;const G={},Z={},Q=O.getParameters(),z=(U=Q.encodings)===null||U===void 0?void 0:U[0];Z.scalabilityMode=$y(V),z&&Object.assign(z,Z),Object.assign(Q,G),await O.setParameters(Q),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Q.encodings)))}catch(G){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",G)}}(this.store.codec,n,W("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return R.debug("[updateAdaptation] no rtpSender found");if(!Ft().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:l}=n;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=as(c)),l&&l>=1&&Oe(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=l);const p=t.getParameters(),m=(i=p.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,s),Object.assign(p,{});try{await t.setParameters(p),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof mn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Gi(t);return n.forEach((s,o)=>{const c=r[o],l=i.mediaDescriptions.find(p=>p.attributes.mid===c);l&&(Ff(l,s),bU(l,s,this.store.codec))}),yd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const p=t[l],m=n[l];if(m instanceof mn&&!Oe(r=m._hints).call(r,rn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,n){if(!Nn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof mn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof mn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Oe(n=t._hints).call(n,rn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=xh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ye(Mt.prototype,"updateRemoteRTPCapabilities",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteRTPCapabilities"),Mt.prototype),Ye(Mt.prototype,"connect",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"connect"),Mt.prototype),Ye(Mt.prototype,"updateRemoteConnect",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteConnect"),Mt.prototype),Ye(Mt.prototype,"createDataChannels",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"createDataChannels"),Mt.prototype),Ye(Mt.prototype,"receive",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"receive"),Mt.prototype),Ye(Mt.prototype,"batchReceive",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"batchReceive"),Mt.prototype),Ye(Mt.prototype,"stopReceiving",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"stopReceiving"),Mt.prototype),Ye(Mt.prototype,"muteRemote",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"muteRemote"),Mt.prototype),Ye(Mt.prototype,"unmuteRemote",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteRemote"),Mt.prototype),Ye(Mt.prototype,"muteLocal",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"muteLocal"),Mt.prototype),Ye(Mt.prototype,"unmuteLocal",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteLocal"),Mt.prototype),Ye(Mt.prototype,"close",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),Ye(Mt.prototype,"updateEncoderConfig",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateEncoderConfig"),Mt.prototype),Ye(Mt.prototype,"updateSendParameters",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateSendParameters"),Mt.prototype),Ye(Mt.prototype,"replaceTrack",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),Ye(Mt.prototype,"updateAdaptation",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateAdaptation"),Mt.prototype),Ye(Mt.prototype,"getRemoteSSRC",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"getRemoteSSRC"),Mt.prototype),Mt);function Ni(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function rI(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=as(t.width),r.height=as(t.height);const i=as(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=r.getContext("2d");if(!o)throw new ae(j.UNEXPECTED_ERROR,"can not get canvas context");const c=Ft(),l=r.captureStream(c.supportRequestFrame?0:i).getVideoTracks()[0];l.canvas||(l.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,E=n.videoHeight/m,v=r.width*E;Math.abs(v-r.height)>=2&&(R.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(v)),r.height=v)}o.drawImage(n,0,0,r.width,r.height),l.requestFrame&&l.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=cb(()=>r.startCapture&&r.startCapture(),i);const p=l.stop;return l.stop=()=>{p.call(l),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),R.debug("clean low stream renderer")},l}var o5=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(o5||{}),wa=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(wa||{}),mt=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(mt||{}),Ir=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(Ir||{}),Pi=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Pi||{}),fT=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(fT||{});const Ch=1e3,mT=6,qg=3,Bz=Math.max(mT,qg,60);function rt(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function a5(e){const t={[Pi.CONN_TYPE]:0,[Pi.RTT]:e.rtt,[Pi.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Pi.CONN_TYPE]=1),n==="tcp"&&(t[Pi.CONN_TYPE]=3),n==="tls"&&(t[Pi.CONN_TYPE]=4);break}case"srflx":t[Pi.CONN_TYPE]=2;break;case"unknown":t[Pi.CONN_TYPE]=5;break;default:t[Pi.CONN_TYPE]=0}return t}function c5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class l5 extends bn{constructor(t){super(),x(this,"store",void 0),x(this,"uploadWRTCStatsTimer",void 0),x(this,"uploadOutboundDenoiserStatsTimer",void 0),x(this,"uploadExtStatsTimer",void 0),x(this,"uploadExtUsageStatsTimer",void 0),x(this,"uploadInboundExtStatsTimer",void 0),x(this,"requestStats",void 0),x(this,"requestTransportStats",void 0),x(this,"requestLocalMedia",void 0),x(this,"requestRemoteMedia",void 0),x(this,"requestAllTracks",void 0),x(this,"requestVideoIsReady",void 0),x(this,"requestUploadStats",void 0),x(this,"requestUpload",void 0),x(this,"uploadOutboundStarted",!1),x(this,"uploadInboundStarted",!1),x(this,"uploadTransportStarted",!1),x(this,"uploadBaseStatsStarted",!1),x(this,"uploadExtensionUsageStarted",!1),x(this,"lastRecvStats",void 0),x(this,"lastSendStats",void 0),x(this,"lastRefRecvStats",void 0),x(this,"lastRefSendStats",void 0),x(this,"lastNormalRecvStats",void 0),x(this,"lastNormalSendStats",void 0),x(this,"lastExtendStats",{}),x(this,"needUploadStats",{}),x(this,"needUploadRenderFreezeTime",!0),x(this,"lastUploadCompensateTime",-1),x(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%qg==0,r=t%mT==0,i=t%60==0;let s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;const l={};if(this.uploadTransportStarted&&s){const m=this.getTransportStats(s,o,n);m&&(l.misc=[m])}if(this.uploadOutboundStarted&&s){const m=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);m&&(l.outbound=[m])}if(this.uploadInboundStarted&&o){this.uploadCompensateStats(t);const m=this.getInboundStats(o,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);m&&(l.inbound=m)}const p=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;p&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[fT.RTC_PEER_CONNECTION_STATE]=zw[p]):l.misc=[{addition:{[fT.RTC_PEER_CONNECTION_STATE]:zw[p]}}]),this.needUploadStats.sendType&&(Array.isArray(l.outbound)&&l.outbound[0]&&l.outbound[0].high&&(l.outbound[0].high[o5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(l)}this.lastRecvStats=o,this.lastSendStats=s,r&&(this.lastNormalRecvStats=o,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[fT.RTC_PEER_CONNECTION_STATE]:zw[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Bz+1&&(t=1)},Ch)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%qg==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const o={};if(this.uploadInboundStarted&&s){const c=this.requestRemoteMedia()||[],l=[];c.forEach(p=>{let[m,E]=p;const v={peer:m.uid};if(m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)&&E.has(Be.VIDEO)&&m.videoTrack){const y=function(D,A,O){if(!A.videoRecv.find(U=>U.ssrc===D))return;const V={};if(O&&O._player){const U=O._player,{renderFreezeAccTime2:G,videoElementStatus:Z}=U;if(yc.visibility==="visible"&&Z===Fr.PLAYING&&Ft().supportRequestVideoFrameCallback){const Q=Math.min(6e3,G);U.renderFreezeAccTime2=Math.max(0,G-Q),rt(V,wa.Video_Render_Freeze_Time_Render2,Q),W("USE_NEW_RENDER_FREEZE_TIME")&&rt(V,wa.Video_Render_Freeze_Time_Render,Q)}}return V}(m._videoSSRC,s,m.videoTrack);y&&(v.video=y)}v.video&&l.push(v)}),l.length>0&&(o.inbound=l,this.requestUploadStats(o))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[Pi.RTT]:t.rtt,[Pi.CONN_TYPE]:void 0,[Pi.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const i=a5(t);if(this.store.useP2P){if(n){const s=a5(n);i[Pi.CONN_TYPE]+=s[Pi.CONN_TYPE]<<3}i[Pi.CONN_TYPE]+=110}else i[Pi.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,l,p;return o.forEach(m=>{let[E,{track:v,ssrcs:y}]=m;switch(E){case Te.LocalVideoLowTrack:case Te.LocalVideoTrack:if(E===Te.LocalVideoTrack){var D;const A=function(G,Z,Q,z,re,he){const Ee=Z.videoSend.find(ut=>ut.ssrc===G);if(!Ee)return;const Re={},{sentFrame:Ct,inputFrame:bt}=Ee;if(z&&(rt(Re,wa.Video_Send_Qp_Sum,Ee.qpSumPerFrame),bt&&Ct)){const ut=bt.frameRate,Yt=Ct.frameRate;Re[wa.Video_Send_Freeze]=function(Ht,Hr){let ge=!0;return ge=!(Ht<=5)&&(Ht<=10?Hr<3:Ht<=20?Hr<4:Hr<5),ge}(ut,Yt)?1:0}if(re){switch(Ct&&(rt(Re,mt.Video_Send_Height,Ct.height),rt(Re,mt.Video_Send_Width,Ct.width),rt(Re,mt.Video_Send_Frame_Rate,Ct.frameRate)),Re[mt.Video_Send_Disabled]=Q._originMediaStreamTrack&&!Q._originMediaStreamTrack.enabled||Q._mediaStreamTrack&&!Q._mediaStreamTrack.enabled?1:0,Ee.adaptionChangeReason){case"none":Re[mt.Video_Send_Adaptation]=0;break;case"cpu":Re[mt.Video_Send_Adaptation]=1;break;case"bandwidth":Re[mt.Video_Send_Adaptation]=2;break;case"other":Re[mt.Video_Send_Adaptation]=3}let ut=0;Ee.adaptionChangeReason&&(ut+=c5(Ee.adaptionChangeReason)),Z.qualityLimitationReason&&(ut+=c5(Z.qualityLimitationReason)<<3),Re[mt.Video_Send_Adaptation]=ut,Re[mt.Video_Send_Player_Status]=ob[Q._player?Q._player.videoElementStatus:"uninit"],rt(Re,mt.Video_Send_Nacks,Ee.nacksCount),rt(Re,mt.Video_Send_Plis,Ee.plisCount),rt(Re,mt.Video_Send_Firs,Ee.firsCount),rt(Re,mt.Video_Send_Avg_Encode,Ee.avgEncodeMs),rt(Re,mt.Video_Send_Huge_Frame_Sent,Ee.hugeFramesSent),rt(Re,mt.Video_Send_Bytes_Retransmit,Ee.retransmittedBytesSent),rt(Re,mt.Video_Send_Packages_Retransmit,Ee.retransmittedPacketsSent),rt(Re,mt.Video_Send_Key_Frames_Encoded,Ee.keyFramesEncoded);const Yt=re.videoSend.find(Ht=>Ht.ssrc===G);if(Yt){let Ht=Ch*qg;Yt.timestamp&&Ee.timestamp&&(Ht=Ee.timestamp-Yt.timestamp),Yt.packets!=null&&Ee.packets!=null&&rt(Re,mt.Video_Send_Package_Rate,1e3*(Ee.packets-Yt.packets)/Ht),Ee.packetsLost!=null&&Yt.packetsLost!=null&&rt(Re,mt.Video_Send_Package_Lost,Ee.packetsLost-Yt.packetsLost),Yt.bytes!=null&&Ee.bytes!=null&&rt(Re,mt.Video_Send_Bitrate,8*(Ee.bytes-Yt.bytes)/Ht)}}return Re}(y[0].ssrcId,t,v,n,r),O=v.__className__==="CameraVideoTrack"?3:Oe(D=v._hints).call(D,rn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==O||s)&&(this.needUploadStats={sendType:O},this.lastExtendStats.sendType=O);const V=v&&function(G,Z,Q,z){const re=Z.videoSend.find(Ee=>Ee.ssrc===G);if(!re)return null;const he={};if(z){const Ee=re.inputFrame,Re=Ee&&Ee.height||Q.videoHeight||0,Ct=Ee&&Ee.width||Q.videoWidth||0,bt=Ee&&Ee.frameRate||0;rt(he,mt.Video_Capture_Height,Re),rt(he,mt.Video_Capture_Width,Ct),rt(he,mt.Video_Capture_Frame_Rate,bt)}return he}(y[0].ssrcId,t,v,!!r),U=function(G,Z){const Q={};return Z&&(rt(Q,mt.Video_Send_Retransmit,G.bitrate.retransmit),rt(Q,mt.Video_Send_Target_Encoded,G.bitrate.targetEncoded),rt(Q,mt.Video_Send_Actual_Encoded,G.bitrate.actualEncoded),rt(Q,mt.Video_Send_Transmit,G.bitrate.transmit),rt(Q,mt.Video_Send_Bandwidth,G.sendBandwidth)),Q}(t,!!r);l=Object.assign({},A,V,U)}else p=function(A,O,V,U,G){const Z=O.videoSend.find(z=>z.ssrc===A);if(!Z)return;const Q={};if(U){const z=Z.sentFrame;z&&(rt(Q,mt.Video_Send_Low_Height,z.height),rt(Q,mt.Video_Send_Low_Width,z.width),rt(Q,mt.Video_Send_Low_Frame_Rate,z.frameRate));const re=U.videoSend.find(he=>he.ssrc===A);if(re){let he=Ch*mT;re.timestamp&&Z.timestamp&&(he=Z.timestamp-re.timestamp),re.packets!=null&&Z.packets!=null&&rt(Q,mt.Video_Send_Low_Package_Rate,1e3*(Z.packets-re.packets)/he),Z.packetsLost!=null&&re.packetsLost!=null&&rt(Q,mt.Video_Send_Low_Package_Lost,Z.packetsLost-re.packetsLost),re.bytes!=null&&Z.bytes!=null&&rt(Q,mt.Video_Send_Low_Bitrate,8*(Z.bytes-re.bytes)/he)}}return Q}(y[0].ssrcId,t,0,r);break;case Te.LocalAudioTrack:c=v&&function(A,O,V,U,G,Z){const Q=O.audioSend.find(re=>re.ssrc===A);if(!Q)return;const z={};if(G){z[mt.Audio_Send_Disabled]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0;const re=100*V._source.getAccurateVolumeLevel(),he=Q.inputLevel;if(he!=null){const Re=Math.ceil(50*Math.log10(100*he+1));rt(z,mt.Audio_Send_Level,Re)}rt(z,mt.Audio_Capture_PCM_Level,re),rt(z,mt.Audio_Send_AEC_Return_Loss,Q.aecReturnLoss),rt(z,mt.Audio_Send_AEC_Return_Loss_Enhancement,Q.aecReturnLossEnhancement),rt(z,mt.Audio_Send_Bytes_Retransmit,Q.retransmittedBytesSent),rt(z,mt.Audio_Send_Packages_Retransmit,Q.retransmittedPacketsSent),z[mt.Audio_Send_Freeze]=0;const Ee=G.audioSend.find(Re=>Re.ssrc===A);if(Ee){let Re=Ch*mT;Ee.timestamp&&Q.timestamp&&(Re=Q.timestamp-Ee.timestamp),Ee.bytes!=null&&Q.bytes!=null&&rt(z,mt.Audio_Send_Bitrate,8*(Q.bytes-Ee.bytes)/Re),Ee.packets!=null&&Q.packets!=null&&rt(z,mt.Audio_Send_Package_Rate,1e3*(Q.packets-Ee.packets)/Re)}}return z}(y[0].ssrcId,t,v,0,r)}}),{high:l,low:p,audio:c}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],o=[];return s.forEach(c=>{let[l,p]=c;const m={peer:l.uid};if(p.has(Be.VIDEO)&&l.videoTrack){const E=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,v=l.videoTrack?function(y,D,A,O,V,U,G,Z){const Q=D.videoRecv.find(ut=>ut.ssrc===y);if(!Q)return;const z={},{receivedFrame:re,outputFrame:he,decodeFrameRate:Ee}=Q;rt(z,Ir.Video_Render_Frame_Rate_Decode,Ee),Q.framesRateFirefox&&rt(z,Ir.Video_Recv_Frame_Rate,Q.framesRateFirefox),re&&rt(z,Ir.Video_Recv_Frame_Rate,re.frameRate),rt(z,Ir.Video_Recv_Frame_Dropped,Q.framesDroppedCount),rt(z,Ir.Video_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),rt(z,Ir.Video_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),rt(z,Ir.Video_Recv_Packages_Discarded,Q.packetsDiscarded),rt(z,Ir.Video_Recv_Avg_Decode,Q.avgDecodeMs),rt(z,Ir.Video_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs),rt(z,Ir.Video_Recv_Avg_Assembly_Time,Q.avgFramesAssembledFromMultiplePacketsMs),rt(z,Ir.Video_Recv_Avg_Inter_Frame_Delay,Q.avgInterFrameDelayMs),rt(z,Ir.Video_Recv_Key_Frames_Decoded,Q.keyFramesDecoded);const Re=Z&&Z.videoRecv.find(ut=>ut.ssrc===y);if(Re){const ut=D.timestamp-Z.timestamp||Ch;Q.packetsLost!=null&&Re.packetsLost!=null&&rt(z,Ir.Video_Recv_Package_Lost,Q.packetsLost-Re.packetsLost),Re.bytes!=null&&Q.bytes!=null&&rt(z,Ir.Video_Recv_Bitrate,8*(Q.bytes-Re.bytes)/ut),Re.packets!=null&&Q.packets!=null&&rt(z,Ir.Video_Recv_Package_Rate,1e3*(Q.packets-Re.packets)/ut)}const Ct=U&&U.videoRecv.find(ut=>ut.ssrc===y);if(Ct&&(rt(z,wa.Video_Recv_Qp_Sum,Q.qpSumPerFrame),z[wa.Video_Recv_Freeze]=O&&Yg.isRemoteVideoFreeze(A,Q,Ct)?1:0),G){var bt;const ut=G.videoRecv.find(Ht=>Ht.ssrc===y);re?(rt(z,mt.Video_Recv_Height,re.height),rt(z,mt.Video_Recv_Width,re.width)):A&&(rt(z,mt.Video_Recv_Height,A._videoHeight||0),rt(z,mt.Video_Recv_Width,A._videoWidth||0)),he&&rt(z,mt.Video_Recv_Frame_Rate_Output,he.frameRate);const Yt=(bt=A._player)===null||bt===void 0?void 0:bt.rendFrameRate.toFixed(0);if(Yt&&rt(z,mt.Video_Render_Frame_Rate_Render,+Yt),rt(z,mt.Video_Recv_Jitter_Buffer,Q.jitterBufferMs),rt(z,mt.Video_Recv_Current_Delay,Q.currentDelayMs),rt(z,mt.Video_Recv_Firs,Q.firsCount),rt(z,mt.Video_Recv_Nacks,Q.nacksCount),rt(z,mt.Video_Recv_Plis,Q.plisCount),A){z[mt.Video_Recv_Disabled]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1;const Ht=A._player;if(Ht){const{freezeTimeCounterList:Hr,renderFreezeAccTime:ge,renderFreezeAccTime2:Pe,videoElementStatus:He}=Ht;if(Hr&&Hr.length>0&&rt(z,wa.Video_Render_Freeze_Time,Hr.splice(0,1)[0]),V&&yc.visibility==="visible"&&He===Fr.PLAYING&&Ft().supportRequestVideoFrameCallback){const ve=Math.min(6e3,Pe);Ht.renderFreezeAccTime2=Math.max(0,Pe-ve),rt(z,wa.Video_Render_Freeze_Time_Render2,ve);const w=Math.min(6e3,ge);Ht.renderFreezeAccTime=Math.max(0,ge-w),rt(z,wa.Video_Render_Freeze_Time_Render,W("USE_NEW_RENDER_FREEZE_TIME")?ve:w)}if(typeof Q.totalFreezesDuration=="number"){const ve=ut&&ut.totalFreezesDuration?Q.totalFreezesDuration-ut.totalFreezesDuration:Q.totalFreezesDuration;rt(z,mt.Video_Render_Freeze_Duration,1e3*ve)}}}if(z[mt.Video_Recv_Player_Status]=ob[A._player?A._player.videoElementStatus:"uninit"],ut&&Q.totalInterFrameDelay!==void 0&&Q.totalSquaredInterFrameDelay!==void 0&&ut.totalInterFrameDelay!==void 0&&ut.totalSquaredInterFrameDelay!==void 0){const Ht=Q.totalInterFrameDelay-ut.totalInterFrameDelay,Hr=Q.totalSquaredInterFrameDelay-ut.totalSquaredInterFrameDelay,ge=Q.framesDecodeCount-ut.framesDecodeCount,Pe=Ht/ge*1e3,He=Math.round(1e3*Math.sqrt((Hr-Math.pow(Ht,2)/ge)/ge));!isNaN(He)&&Pe+He>Math.max(3*Pe,Pe+150)&&(z[mt.Video_Recv_I_Frame_Delay]=He)}}return z}(l._videoSSRC,t,l.videoTrack,E===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;v&&(m.video=v)}if(p.has(Be.AUDIO)&&l.audioTrack){const E=l.audioTrack?function(v,y,D,A,O,V){const U=y.audioRecv.find(z=>z.ssrc===v);if(!U)return;const G={};rt(G,Ir.Audio_Recv_Jitter,U.jitterMs),rt(G,Ir.Audio_Recv_Bytes_Retransmit,U.retransmittedBytesReceived),rt(G,Ir.Audio_Recv_Packages_Retransmit,U.retransmittedPacketsReceived),rt(G,Ir.Audio_Recv_Packages_Discarded,U.packetsDiscarded),rt(G,Ir.Audio_Recv_Avg_Processing_Delay,U.avgProcessingDelayMs);const Z=V&&V.audioRecv.find(z=>z.ssrc===v);if(Z){const z=Ch;U.packets!=null&&Z.packets!=null&&rt(G,Ir.Audio_Recv_Package_Rate,1e3*(U.packets-Z.packets)/z),U.packetsLost!=null&&Z.packetsLost!=null&&rt(G,Ir.Audio_Recv_Package_Lost,U.packetsLost-Z.packetsLost)}if(A){const{receivedFrames:z,droppedFrames:re}=U;z!=null&&re!=null&&(G[wa.Audio_Recv_Freeze]=(Q=z)===0||100*re/Q>20?1:0)}var Q;if(O){const z=100*D._source.getAccurateVolumeLevel(),re=U.outputLevel;if(re!=null){const Ee=Math.ceil(50*Math.log10(100*re+1));rt(G,mt.Audio_Render_Level,Ee)}rt(G,mt.Audio_Recv_PCM_Level,z),D&&(G[mt.Audio_Recv_Disabled]=D._originMediaStreamTrack.enabled&&D._mediaStreamTrack.enabled?0:1),rt(G,mt.Audio_Recv_Jitter_Buffer,U.jitterBufferMs),rt(G,mt.Audio_Recv_Current_Delay,U.jitterBufferMs),G[mt.Audio_Recv_Player_Status]=ob[Oi.getPlayerState(D.getTrackId())];const he=O.audioRecv.find(Ee=>Ee.ssrc===v);if(he){he.bytes!=null&&U.bytes!=null&&rt(G,mt.Audio_Recv_Bitrate,8*(U.bytes-he.bytes)/(Ch*qg));const Ee=U.concealedSamples-he.concealedSamples;Ee>0&&rt(G,mt.Audio_Recv_Concealed_Samples,Ee);const Re=U.totalSamplesReceived-he.totalSamplesReceived;Re>0&&rt(G,mt.Audio_Recv_Total_Samples_Received,Re);const Ct=U.freezeSamples80-he.freezeSamples80;Ct>0&&rt(G,mt.Audio_Render_Freeze_Samples_80ms,Ct);const bt=U.freezeSamples200-he.freezeSamples200;bt>0&&rt(G,mt.Audio_Render_Freeze_Samples_200ms,bt);const ut=U.freezeMs80-he.freezeMs80;rt(G,mt.Audio_Render_Freeze_Time_80ms,ut<0?0:ut);const Yt=U.freezeMs200-he.freezeMs200;rt(G,mt.Audio_Render_Freeze_Time_200ms,Yt<0?0:Yt)}}return G}(l._audioSSRC,t,l.audioTrack,n,r,i):void 0;E&&(m.audio=E)}(m.video||m.audio)&&o.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof xg);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Ug.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(Be.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Be.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of s)!p.muted&&p.enabled&&(i=i.concat(await p.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,m]of o)m.has(Be.VIDEO)&&p.videoTrack&&(i=i.concat(await p.videoTrack.getProcessorUsage())),m.has(Be.AUDIO)&&p.audioTrack&&(i=i.concat(await p.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(p,m){const E={};for(const{id:A,value:O,level:V,direction:U}of p){var v;const G=(v=m.get(A))!==null&&v!==void 0?v:0,Z=O===2?G+W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:G;var y,D;m.set(A,Z),E[A]?(O===2&&(E[A].value=O),V>E[A].level&&(E[A].level=V),U==="remote"&&(E[A].remoteUidCount+=1),E[A].totalTs=(y=m.get(A))!==null&&y!==void 0?y:0):E[A]={value:O,level:V,remoteUidCount:U==="local"?0:1,totalTs:(D=m.get(A))!==null&&D!==void 0?D:0}}return Object.keys(E).map(A=>{const{level:O,value:V,totalTs:U}=E[A];return{id:A,level:O,value:V,totalTs:U}})}(i,t);const c=Date.now(),l=c>n?c:n+1;this.requestUpload&&this.requestUpload(Ug.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:l})},W("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Wz=W("ICE_RESTART_INTERVAL");let _T=new Map,Kf=new Map,Dd=[Wr.UDP_TCP_RELAY,Wr.TCP_RELAY,Wr.RELAY],iI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration;function d5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=_T.get(e.id);n&&(window.clearTimeout(n),_T.delete(e.id));const r=Kf.get(e.id);t&&r&&r.index===Dd.length-1&&(R.debug("[".concat(e.id,"] reset ICE restart policy")),Kf.delete(e.id))}function u5(e,t,n){if(_T.size===0&&Kf.size===0&&(Array.isArray(W("RESTART_SEQUENCE"))&&W("RESTART_SEQUENCE").length>0&&!function(c,l){if(c.length!==l.length)return!1;for(let p=0;p<c.length;p+=1){const m=c[p];if(c.filter(E=>E===m).length!==l.filter(E=>E===m).length)return!1}return!0}(Dd,W("RESTART_SEQUENCE"))&&(Dd=W("RESTART_SEQUENCE").filter(c=>{var l;if(Oe(l=Object.values(Wr)).call(l,c))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(Dd.join(" => ")))),iI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration),Dd.length===0)return void n();let r,{index:i=0,type:s}=Kf.get(e.id)||{};if(iI&&s===Wr.RELAY)return void n();let o=s&&i>=Dd.length-1;if(iI)s=Wr.RELAY;else{if(o)return void n();s?(i++,s=Dd[i]):(s=Dd[0],i=0)}R.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),Kf.set(e.id,{index:i,type:s}),r=window.setTimeout(()=>u5(e,t,n),Wz),_T.set(e.id,r)}var At;function h5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Rc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?h5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function p5(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=vw,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new gT(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function gT(e){function t(n){if(Object(n)!==n)return Ve.reject(new TypeError(n+" is not an object."));var r=n.done;return Ve.resolve(n.value).then(function(i){return{value:i,done:r}})}return gT=function(n){this.s=n,this.n=n.next},gT.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Ve.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Ve.reject(n):t(r.apply(this.s,arguments))}},new gT(e)}let Xg=(At=class extends bn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(et.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",void 0),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"connection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"remoteDataChannelMap",new Map),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"pendingLocalDataChannels",[]),x(this,"pendingRemoteDataChannels",[]),x(this,"statsCollector",void 0),x(this,"shouldForwardP2PCreation",void 0),x(this,"iceFailedCount",0),x(this,"dtlsFailedCount",0),x(this,"mutex",void 0),x(this,"_state",Jt.Disconnected),x(this,"_pcStatsUploadType",W("NEW_ICE_RESTART")?pl.FIRST_CONNECTION:pl.OLD_FIRST_CONNECTION),x(this,"_isStartRestartIce",!1),x(this,"_restartTimer",void 0),x(this,"_isTryConnecting",!1),x(this,"_iceError",null),x(this,"_forceTurn",!1),x(this,"_isWaitPcToRePub",!1),x(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void i(new ue(j.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void r();const c=o.find(p=>p[0]==="videoLowTrack");if(c){const p=c[1];this.store.enableInstantMuteRestore?(p.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):p.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const l=this.createMuteMessage(o);await sn(this,et.RequestMuteLocal,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void i(new ue(j.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();const c=o.find(p=>p[0]==="videoLowTrack");if(c){const p=c[1];if(this.store.enableInstantMuteRestore)p.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(p.track._originMediaStreamTrack.stop(),!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}else{const m=rI(n,Ag(this,et.RequestLowStreamParameter));p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}await new Ve((m,E)=>{this.handleReplaceTrack(p.track,m,E,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const l=this.createUnmuteMessage(o);await sn(this,et.RequestUnmuteLocal,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let o;s||(o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==Jt.Connected)return void r();const{id:p,track:m}=l;await this.connection.updateSendParameters(p,m),await this.connection.updateEncoderConfig(p,m),this.emit(et.UpdateVideoEncoder,m),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}}),x(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Jt.Connected)return void r();const{id:c,track:l}=o;await this.connection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleReplaceMixingTrack",async(n,r,i,s)=>{if(!this.connection||this.state!==Jt.Connected)return void r();const o=tI([n]);let c;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),r()}catch(p){i(p)}finally{var l;(l=c)===null||l===void 0||l()}}),x(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.connection||!p||this.state!==Jt.Connected)return void r();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),this.isPlanB){const m=p[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],m)}if(p[0]===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const m=this.localTrackMap.get(Te.LocalVideoLowTrack);if(m){const E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new Ve((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}r()}catch(p){i(p)}finally{var l;(l=o)===null||l===void 0||l()}}),x(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new l5(this.store),this.bindStatsUploaderEvents(),this.mutex=new jr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ft().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&ll(),this.shouldForwardP2PCreation=W("FORWARD_P2P_CREATION")&&Ft().supportPCSetConfiguration&&kw(),this.shouldForwardP2PCreation&&(this.connection=pT(this.store),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Jt.New,this._forceTurn=i5(e),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=pT(this.store,e),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ue(j.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=W("NEW_ICE_RESTART")?pl.FIRST_CONNECTION:pl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ue(j.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Jt.Connected){if(this.connection instanceof no&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),qe.reportApiInvoke(this.store.sessionId,{name:xn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Tn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(et.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[o]=i;return Oe(s=[Te.LocalVideoLowTrack,Te.LocalVideoTrack]).call(s,o)}),n=t.map(i=>{let[,{id:s}]=i;return s}),r=t.map(i=>{let[s]=i;return s});if(this.connection instanceof no){if(qe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Oe(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>Oe(e).call(e,s));i&&(this.store.codec=i,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof no&&this.connection.peerConnectionState!=="closed"&&Oe(e=[Jt.New,Jt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Jt.Connected){if(this.state===Jt.Disconnected)throw new ue(j.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;Oe(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var r=this;return Js(function*(){const i=yield jt(r.mutex.lock("From P2PChannel.publish"));try{var s;const o=r.connection&&Oe(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==Jt.Connected||o){if(r.state===Jt.Disconnected)throw new ue(j.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const l=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(l),void(o&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Gr.markPublishStart(r.store.clientId,r.store.pubId);const c=r.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));yield*ly(p5(r.doPublish(r.connection,c)))}finally{i()}})()}doPublish(e,t){var n=this;return Js(function*(){t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===Te.LocalAudioTrack?"audio":"video",A)}),n.bindLocalTrackEvents(t);const r=t.map(v=>{let{track:y}=v;return y}),i=yield jt(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield jt(i.next())).value,o=n.createGatewayPublishMessage(t,s);let c;try{c=yield o}catch(v){throw i.throw(v),v?.code===j.WS_ABORT&&t.forEach(y=>{let{track:D}=y;n.pendingLocalTracks.indexOf(D)===-1&&n.pendingLocalTracks.push(D)}),n.unbindLocalTrackEvents(t),v}const l=n.mapPubResToRemoteConfig(o,c,r),p=(yield jt(i.next(l))).value;if(n.state===Jt.Disconnected)throw new ue(j.UNEXPECTED_ERROR,"PeerConnection already disconnected.");W("ENABLE_VIDEO_SEI");const m=W("ENABLE_ENCODED_TRANSFORM"),E=W("ENABLE_AUDIO_METADATA");r.forEach(async v=>{const y=v.getRTCRtpTransceiver();if(!y||!m)return;const{interceptLocalVideoFrame:D,interceptLocalAudioFrame:A}=iT();v.trackMediaType===Be.VIDEO?await D(y.sender,v):v.trackMediaType===Be.AUDIO&&await A(y.sender,{metadata:E?()=>{const O=v.metadata.shift();return O&&O.value}:void 0})}),t.forEach(v=>{let{type:y}=v;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(t,p),n.statsUploader.startUploadOutboundStats(),t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===Te.LocalAudioTrack?"audio":"video",void 0,A)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof mn))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(s,o){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=Ub(s,o)),c.maxFramerate=s.framerate?as(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Te.LocalVideoLowTrack||!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return R.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,c){const l=o.canvas;c.width&&(l.width=as(c.width)),c.height&&(l.height=as(c.height)),c.framerate&&(l.stopCapture&&l.stopCapture(),l.stopCapture=cb(()=>{!l.startCapture&&l.stopCapture&&l.stopCapture(),l.startCapture&&l.startCapture()},as(c.framerate)))})(s,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),R.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return Js(function*(){if(!t.connection||t.state!==Jt.Connected)return;const n=yield jt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(Te.LocalVideoTrack);if(!i)throw new ue(j.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Te.LocalVideoLowTrack))throw new ue(j.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:Te.LocalVideoLowTrack}];if(yield*ly(p5(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var r;const o=(r=t.localTrackMap.get(Te.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield jt(t.connection.muteLocal([o])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Dr(this,et.RequestRePublish,this.pendingLocalTracks),this.emit(et.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Dr(this,et.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==Be.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Be.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Dr(this,et.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Be.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(et.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Jt.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Jt.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Jt.Connected)return;const e=this.localTrackMap.get(Te.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Te.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:s}]=r;return{type:i,track:s}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Jt.Connected)throw new ue(j.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:c,id:l}=o;return c.uid===e.uid&&l===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==Jt.Connected)throw new ue(j.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,c,l,p;const m=this.connection.getPreMedia(n);if(m)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),l=m.transceiver,o=m.track,c=m.mid,p=m.player,m.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:m.firstVideoRender});else if(i){const y=i.find(A=>{let{stream_type:O}=A;return O===t});if(!y)throw new ue(j.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const D=await this.connection.receive(t,y.ssrcs,String(e._uintid),y.attributes);this.connection instanceof no&&(l=D.transceiver),o=D.track,c=D.id}else{const y=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof no&&(l=y.transceiver),o=y.track,c=y.id}if(t===Be.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new Df(o,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new Pf(o,e.uid,e._uintid,this.store,p),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once($s.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once($s.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),p?e._videoTrack.once($s.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once($s.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack)),l&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:D}=iT();t==Be.VIDEO?await y(l.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(A=>{var O;return(O=e._videoTrack)===null||O===void 0?void 0:O._onSei(A)})}):t==Be.AUDIO&&await D(l.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:A=>{this.safeEmit(et.AudioMetadata,A)},onPts:A=>{this.safeEmit(et.AudioPts,A)}})}const E=this.remoteUserMap.get(e);E?E.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:D,kind:A}=y;return D.uid===e.uid&&t===A});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(et.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Jt.Connected)throw new ue(j.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var s;let{user:o,mediaType:c}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))});const t=[],n=new Map;e.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);if(s){const{track:o,mid:c,transceiver:l,player:p}=s;n.set(i.ssrcId,{track:o,id:c,transceiver:l,player:p})}else t.push(i)});const r=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:l}=i;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:l}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{n.set(i.ssrcId,r[s])});for(const{user:i,mediaType:s,ssrcId:o}of e){const c=n.get(o);if(!c)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(o));const{track:l,id:p,transceiver:m,player:E}=c;if(m&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:A}=iT();s==Be.VIDEO?await D(m.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(O=>{var V;return(V=i._videoTrack)===null||V===void 0?void 0:V._onSei(O)})}):s==Be.AUDIO&&await A(m.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:O=>{this.safeEmit(et.AudioMetadata,O)},onPts:O=>{this.safeEmit(et.AudioPts,O)}})}if(s===Be.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(l):(i._audioTrack=new Df(l,i.uid,i._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),m&&i._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(l):(i._videoTrack=new Pf(l,i.uid,i._uintid,this.store,E),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),m&&i._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._videoTrack)),W("ENABLE_VIDEO_SEI")&&m){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:A}=iT();s==Be.VIDEO?await D(m.receiver,{onSei:O=>{var V;(V=i._videoTrack)===null||V===void 0||V._onSei(O)}}):s==Be.AUDIO&&await A(m.receiver)}const v=this.remoteUserMap.get(i);v?v.set(s,p):this.remoteUserMap.set(i,new Map([[s,p]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(D=>{let{user:A,kind:O}=D;return A.uid===i.uid&&s===O});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(et.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:l}=o;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid});if(r.forEach(o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.connection&&this.state===Jt.Connected||n||r.forEach(o=>{let{kind:c}=o;var l;if(c===Be.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===Be.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Jt.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(o=>{let[,{id:c}]=o;return c}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[c,{kind:l}]=o;var p,m;if(l===Be.VIDEO&&c._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Be.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((m=c._videoTrack)===null||m===void 0||m._destroy(),c._videoTrack=void 0);else if(l===Be.AUDIO){var E;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((E=c._audioTrack)===null||E===void 0||E._destroy(),c._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(o=>o.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const o=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:p}=c;return s!==void 0?l.uid===i.uid&&s===p:l.uid===i.uid});o.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),t=t.concat(o)}if(!this.connection||this.state!==Jt.Connected)return void t.forEach(i=>{let{user:s,kind:o}=i;var c;if(o===Be.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===Be.VIDEO){var l;(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0}});const n=Ui(e).call(e,(i,s)=>{let{user:o,mediaType:c}=s;const l=this.filterTobeUnSubscribedTracks(o,c);return i.concat(l)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:s}]=i;return s}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[s,{kind:o}]=i;var c,l;if(o===Be.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Be.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0;else if(o===Be.AUDIO){var p;this.unbindRemoteTrackEvents(s._audioTrack),(p=s._audioTrack)===null||p===void 0||p._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==Jt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Be.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Te.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t?.track instanceof $n){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Te.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Te.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Te.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Te.LocalAudioTrack),c=r?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(l=>l instanceof Ln),c=r?(s=this.localTrackMap.get(Te.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof mn);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Be.VIDEO?n._videoSSRC:n._audioSSRC;i&&qe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Be.VIDEO,audio:r===Be.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Gr.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new jr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=pT(this.store),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e?.track instanceof $n){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Jt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof mn||t&&t.track instanceof Ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=th(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=pT(this.store),this.emit(et.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Te.LocalVideoTrack:Oe(t=r._hints).call(t,rn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Te.LocalAudioTrack:r instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Te.LocalVideoLowTrack:}}),this.emit(et.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(et.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Js(function*(){if(!t.connection||t.state!==Jt.Connected)return;const n=yield jt(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield jt(t.connection.restartICE(e));const s=yield jt(r.next());if(s.done)return;const o=s.value,c=yield o;switch(nI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Wr.UDP_TCP_RELAY:t._pcStatsUploadType=pl.UDP_TCP_RESTART;break;case Wr.TCP_RELAY:t._pcStatsUploadType=pl.TCP_RESTART;break;case Wr.RELAY:t._pcStatsUploadType=pl.RELAY_RESTART;break;default:t._pcStatsUploadType=pl.OLD_RESTART}t._isTryConnecting=!0,r.next(c)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalAudioTrack),r=e.videoSend.find(y=>y.ssrc===t?.ssrcs[0].ssrcId),i=e.audioSend.find(y=>y.ssrc===n?.ssrcs[0].ssrcId);if(!r||!i)return 1;const s=Ts(this,et.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,p=(l&&s?(l+s)/2:l||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t?.track;if(v&&v._encoderConfig&&v._hints.indexOf(rn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return $M[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===i),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const l=Ts(this,et.NeedSignalRTT),p=e.rtt,m=(p&&l?(p+l)/2:p||l)||0,E=o?o.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;E&&(y=.6*v*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ve((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Jt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const s=this.localTrackMap.get(Te.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new Ve((c,l)=>{this.handleReplaceTrack(s.track,c,l,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=Ef(e=e.filter(l=>i.indexOf(l)===-1));let s,o=!1;const c=this.localTrackMap.get(Te.LocalAudioTrack);for(const l of e){if(l instanceof mn&&(this.localTrackMap.has(Te.LocalVideoTrack)||o?new ue(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Te.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(l,n);r.push({track:p,type:Te.LocalVideoLowTrack})}if(l instanceof Ln)if(c){const p=c.track;if(p instanceof $n)eI([l]),p.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0);else{const m=tI([p,l]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(p,m)}}else s instanceof $n?(eI([l]),s.addAudioTrack(l)):s||!l._useAudioElement&&Ft().webAudioMediaStreamDest&&!l._bypassWebAudio?s=tI(s?[l,s]:[l]):s=l}return s&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:Te.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Ef(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Ln){const i=this.localTrackMap.get(Te.LocalAudioTrack);if(!i)continue;i.track instanceof $n?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,i]),i.track.close())):t.push([Te.LocalAudioTrack,i])}if(r instanceof mn){const i=this.localTrackMap.get(Te.LocalVideoTrack);if(!i)continue;t.push([Te.LocalVideoTrack,i]);const s=this.localTrackMap.get(Te.LocalVideoLowTrack);s&&t.push([Te.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=Ef(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Ef(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.addListener(Ke.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ke.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof $n?e.trackList.forEach(n=>{n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ke.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.off(Ke.GET_STATS,this.handleGetLocalVideoStats),n.off(Ke.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof $n?e.trackList.forEach(t=>{t.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ke.GET_STATS,this.handleGetLocalAudioStats),t.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ke.GET_STATS,this.handleGetLocalAudioStats),e.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ke.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Pf&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Df&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ke.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Be.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Be.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,o,{track:c,type:l}=n;switch(l){case Te.LocalAudioTrack:s=Qt.Audio,o={dtx:c instanceof xg&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Te.LocalVideoTrack:s=Oe(i=c._hints).call(i,rn.SCREEN_TRACK)?Qt.Screen:Qt.High,o=Rc(Rc({},mU(c)),{},{codec:this.store.codec,svc_mode:$y()});break;case Te.LocalVideoLowTrack:s=Qt.Low,o=Rc(Rc({},mU(c)),{},{codec:this.store.codec,svc_mode:$y()})}return{stream_type:s,attributes:o,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalVideoTrack:r=Oe(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(et.PeerConnectionStateChange,t),t==="connecting"&&e instanceof no&&!Nn()&&W("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},W("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof no&&d5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=pl.DISCONNECTED_OR_FAILED,Ts(this,et.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));qe.reportApiInvoke(this.store.sessionId,{name:xn.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:Tn.TRACER}).onSuccess(),this.republish()}if(W("NEW_ICE_RESTART")&&e instanceof no&&!Nn()&&!this._forceTurn){if(Oe(lU).call(lU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=i=>{nI(e)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Ts(this,et.QueryClientConnectionState)==="CONNECTED"&&this.emit(et.RequestRestartICE,i))},r=()=>{nI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{u5(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&W("ICE_RESTART")&&Ts(this,et.QueryClientConnectionState)==="CONNECTED"&&this.emit(et.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(et.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit($s.FIRST_FRAME_DECODED),qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===t);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(et.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Rc(Rc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof no&&function(t){Kf.delete(t.id),d5(t)}(e),e.close(),this.emit(et.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive||t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===Te.LocalVideoTrack)){const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive&&t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===Te.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Oe(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Oe(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Be.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Be.VIDEO,ssrcId:r._videoSSRC}));case Be.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Be.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let s=t.get(r);i===Be.VIDEO?s|=ur.Video:s|=ur.Audio,t.set(r,s)}else i===Be.VIDEO?t.set(r,ur.Video):t.set(r,ur.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ve((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ve((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof no&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof no&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((r,i)=>{var s;let{stream_type:o}=r;const c=(s=t.find(l=>{let{stream_type:p}=l;return o===p}))===null||s===void 0?void 0:s.attributes;if(c&&W("DISABLE_SCREEN_SHARE_REMB")){const l=n[i]._hints;(Oe(l).call(l,rn.SCREEN_TRACK)||Oe(l).call(l,rn.SCREEN_LOW_TRACK))&&(c.remb=!1,R.debug("disable remb for screen share, hints:",l))}return c})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Ln){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(s=>{let[,{id:o}]=s;return o})));const i=this.createUnmuteMessage(r);return void await sn(this,et.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(et.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(et.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rr(Bw(this.dtlsFailedCount,qn)),this.emit(et.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Dr(this,et.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(et.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof mn).length>1)throw new ue(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ln).length>1&&(e.some(t=>t instanceof Ln&&t._bypassWebAudio)||!Ft().webAudioMediaStreamDest))throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof mn&&this.pendingLocalTracks.some(n=>n instanceof mn))throw new ue(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ln&&this.pendingLocalTracks.some(n=>n instanceof Ln)&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ln&&n._bypassWebAudio)))throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,i=Rc(Rc({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():rI(e,i);const o=on(8,"track-low-"),c=new mn(s,Rc(Rc({},r&&{scaleResolutionDownBy:Ub(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(fh.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,wf.LOW_STREAM)}),c._hints.push(rn.LOW_STREAM),Oe(n=e._hints).call(n,rn.SCREEN_TRACK)&&c._hints.push(rn.SCREEN_LOW_TRACK),e.on("sei-to-send",l=>{c.emit("sei-to-send",l)}),e.addListener(Ke.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof no){var i,s,o,c;const l=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:m,peerConnectionState:E}=this.connection,{local:v,remote:y}=await this.connection.getSelectedCandidatePair();qe.pcStats(this.store.sessionId,{startTime:l,eventElapse:e-l||0,iceconnectionsate:p,dtlsstate:m,connectionstate:E,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=v?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=v.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:(o=y.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=y.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(m=>m.userId===e.uid);if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:o,peerPublishDuration:c,peerPubStatusMs:l}=n;let{firstRender:p=0}=n;if(s&&(p||o)&&c&&l){n.isInternalUpload=!0;const{playEnd:m}=n;m&&(n.isExternalUpload=!0);const{firstPreRender:E=0}=n;p=E||p;const v=e.videoTrack,y={peer:e._uintid,width:v?._videoWidth||0,height:v?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:l,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:E||0,firstRender:m?Math.max(p,m):Math.max(p,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:jL(this.store)};qe.firstXLAPeerFirstVideoFrame(this.store.sessionId,y)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(l=>l.userId===s.uid&&l.type==="video");qe.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Te.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,wf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ye(At.prototype,"startP2PConnection",[ii],Object.getOwnPropertyDescriptor(At.prototype,"startP2PConnection"),At.prototype),Ye(At.prototype,"connect",[ii],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),Ye(At.prototype,"updateRemoteRTPCapabilities",[ii],Object.getOwnPropertyDescriptor(At.prototype,"updateRemoteRTPCapabilities"),At.prototype),Ye(At.prototype,"publishDataChannel",[ii],Object.getOwnPropertyDescriptor(At.prototype,"publishDataChannel"),At.prototype),Ye(At.prototype,"unpublish",[ii],Object.getOwnPropertyDescriptor(At.prototype,"unpublish"),At.prototype),Ye(At.prototype,"unpublishDataChannel",[ii],Object.getOwnPropertyDescriptor(At.prototype,"unpublishDataChannel"),At.prototype),Ye(At.prototype,"unpublishLowStream",[ii],Object.getOwnPropertyDescriptor(At.prototype,"unpublishLowStream"),At.prototype),Ye(At.prototype,"subscribeDataChannel",[ii],Object.getOwnPropertyDescriptor(At.prototype,"subscribeDataChannel"),At.prototype),Ye(At.prototype,"subscribe",[ii],Object.getOwnPropertyDescriptor(At.prototype,"subscribe"),At.prototype),Ye(At.prototype,"massSubscribe",[ii],Object.getOwnPropertyDescriptor(At.prototype,"massSubscribe"),At.prototype),Ye(At.prototype,"unsubscribe",[ii],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribe"),At.prototype),Ye(At.prototype,"unsubscribeDataChannel",[ii],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribeDataChannel"),At.prototype),Ye(At.prototype,"massUnsubscribe",[ii],Object.getOwnPropertyDescriptor(At.prototype,"massUnsubscribe"),At.prototype),Ye(At.prototype,"muteRemote",[ii],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),Ye(At.prototype,"unmuteRemote",[ii],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),Ye(At.prototype,"hasRemoteMediaWithLock",[ii],Object.getOwnPropertyDescriptor(At.prototype,"hasRemoteMediaWithLock"),At.prototype),Ye(At.prototype,"disconnectForReconnect",[ii],Object.getOwnPropertyDescriptor(At.prototype,"disconnectForReconnect"),At.prototype),Ye(At.prototype,"updateBitrateLimit",[ii],Object.getOwnPropertyDescriptor(At.prototype,"updateBitrateLimit"),At.prototype),Ye(At.prototype,"remoteMediaSsrcChanged",[ii],Object.getOwnPropertyDescriptor(At.prototype,"remoteMediaSsrcChanged"),At.prototype),At);function ii(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function f5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function m5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Gz=Date.now(),Hz=20,sI=new Map,ET=new Map;async function _5(e){const t=sI.get(e),n=Array.isArray(t)&&t[t.length-1],r=ET.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let c=n.mediaDelay+o;c<=0?(t.pop(),g5(n.context,i),c=0):c=Math.min(c,Hz),setTimeout(()=>t.length&&_5(e),c)}function g5(e,t){e.safeEmit(Nt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Kz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return g5(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=sI.get(r)||[],s=i.findIndex(p=>e.sendTs>=p.sendTs),o=m5(m5({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),sI.set(r,i);let c=!1;var l;ET.has(r)?c=!((l=ET.get(r))===null||l===void 0||!l.isSyncing):ET.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||_5(r)}const zz=xt().name;function E5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function v5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?E5(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const zf="websdk_ng_cache_parameter",Yz=W("MAX_PRELOAD_ASYNC_LENGTH"),qz=1e4,Rh=new Map,wh=[];let oI=null,aI=0,cI=0;const vT=new Map,Xz=function(e,t){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new Ve(async(l,p)=>{n.push(async()=>{try{const m=await e(...o);l(m)}catch(m){p(m)}}),r<t&&(r++,i())})}}(S5,Yz),lI=Ai.CancelToken.source();async function S5(e,t,n,r,i,s){try{if(!W("ENABLE_PRELOAD"))return;if(!Ft().supportWebCrypto)return void vd(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ue(j.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Cr(n,"token",1,2047),Cr(e,"appid",1,2047),Yy(t),r&&qy(r);const o=hh();R.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:o,proxyServer:i};let l,p;typeof r=="string"?(c.stringUid=r,[p,l]=await Ve.all([Dz(r,{sid:o,appId:e},lI.token),zU(v5(v5({},c),{},{token:n||e,uid:0}),lI.token)]),c.uid=p.uid,l.gatewayInfo.uid=c.uid,l.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),l=await zU(c,lI.token));const m={sid:o,appId:e,cname:t,token:n||e,uid:c.stringUid||r,intUid:c.uid||l.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:p,ap:l};await async function(E){let v;try{E.uid&&T5({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});const y=b5(E),D=await async function(O,V){try{const U=await window.crypto.subtle.importKey("raw",hL(V),"AES-GCM",!1,["encrypt"]),G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},U,uh(window.btoa(JSON.stringify(O))));return Sd(new Uint8Array(G))}catch{return}}(E,E.token||E.appId);if(!D)return;v=w5(zf);const A=v?JSON.parse(v):[];A.push({[y]:D}),A.length>W("AP_CACHE_NUM")&&A.shift(),ST(zf,JSON.stringify(A))}catch(y){R.warn("Error caching server parameters:",y.message),ST(zf,"")}}(m),aI++}catch(o){throw cI++,function(c){oI||(oI=window.setTimeout(()=>{let p="";vT.forEach((m,E)=>{p+="".concat(E,": ").concat(m," ;")}),qe.reportApiInvoke(null,{name:xn.PRELOAD,options:{success:aI,failed:cI,err:p}}).onError(c),aI=0,cI=0,vT.clear(),oI=null},qz));const l=vT.get(c.code)||0;vT.set(c.code,l+1)}(o),o}}async function y5(e){try{if(W("AP_REQUEST_DETAIL")||W("ENABLE_ROLE_SELECT_EDGE"))return;const t=T5(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",hL(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,uh(r));return JSON.parse(window.atob(Sd(new Uint8Array(o))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<W("AP_CACHE_LIFETIME"))return n}catch(t){R.warn("Error get preloadInfo",t.message)}}function T5(e){let t;try{if(t=w5(zf),!t)return;const n=JSON.parse(t),r=b5(e),i=function(o,c){for(let l=o.length-1;l>=0;l--)if(c(o[l]))return l;return-1}(n,o=>r in o);if(i===-1)return;const s=n.splice(i,1)[0];return ST(zf,JSON.stringify(n)),s[r]}catch(n){R.warn("Error delete preload info: ".concat(t),n.message),ST(zf,"")}}function dI(e){if(e){let t=Rh.get(e);t&&(window.clearTimeout(t),t=null,Rh.delete(e)),Oe(wh).call(wh,e)||e.cloudProxyServer!=="disabled"||wh.push(e)}if(Rh.size<W("AP_CACHE_NUM")&&wh.length>0){const t=wh.shift();Rh.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:o,proxyServer:c}=t;try{await Xz(n,r,i,o,c,s),Rh.has(t)&&dI(t)}catch(l){R.warn("update preload failed",l.message),C5(t)}},W("AP_UPDATE_INTERVAL")))}}function C5(e){const t=wh.indexOf(e);t!==-1&&wh.splice(t,1);let n=Rh.get(e);n&&(window.clearTimeout(n),n=null,Rh.delete(e),dI())}function R5(e,t){const n=e.sua,r=e.ap;t&&n&&qe.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),qe.reportResourceTiming(e.ap.url,e.sid),qe.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[Hn.CHOOSE_SERVER,Hn.CLOUD_PROXY_FALLBACK].toString()}),qe.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function w5(e){return window.atob(window.localStorage.getItem(e)||"")}function ST(e,t){window.localStorage.setItem(e,window.btoa(t))}function b5(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),vL(t)}function Jz(e){let t=function(){const n=$z.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(Kn(r,10),kd(r,i));let s=n.cid;s!==void 0&&(Kn(r,16),Kn(r,s));let o=n.cname;o!==void 0&&(Kn(r,26),kd(r,o));let c=n.deviceId;c!==void 0&&(Kn(r,34),kd(r,c));let l=n.elapse;l!==void 0&&(Kn(r,40),Ld(r,l));let p=n.fileSize;p!==void 0&&(Kn(r,48),Ld(r,Yf(p)));let m=n.height;m!==void 0&&(Kn(r,56),Ld(r,Yf(m)));let E=n.jpg;E!==void 0&&(Kn(r,66),Kn(r,E.length),A5(r,E));let v=n.networkType;v!==void 0&&(Kn(r,72),Ld(r,Yf(v)));let y=n.osType;y!==void 0&&(Kn(r,80),Ld(r,Yf(y)));let D=n.requestId;D!==void 0&&(Kn(r,90),kd(r,D));let A=n.sdkVersion;A!==void 0&&(Kn(r,98),kd(r,A));let O=n.sequence;O!==void 0&&(Kn(r,104),Ld(r,Yf(O)));let V=n.sid;V!==void 0&&(Kn(r,114),kd(r,V));let U=n.timestamp;U!==void 0&&(Kn(r,120),Ld(r,U));let G=n.uid;G!==void 0&&(Kn(r,128),Kn(r,G));let Z=n.vid;Z!==void 0&&(Kn(r,136),Kn(r,Z));let Q=n.width;Q!==void 0&&(Kn(r,144),Ld(r,Yf(Q)));let z=n.service;z!==void 0&&(Kn(r,152),Kn(r,z));let re=n.callbackData;re!==void 0&&(Kn(r,162),Kn(r,re.length),A5(r,re));let he=n.ticket;he!==void 0&&(Kn(r,170),kd(r,he));let Ee=n.vendorConfigs;Ee!==void 0&&(Kn(r,178),kd(r,Ee))}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function Qz(e){return function(n){let r={};e:for(;!eY(n);){let i=Jg(n);switch(i>>>3){case 0:break e;case 1:r.code=Jg(n);break;case 2:r.msg=O5(n,Jg(n));break;case 3:r.requestId=O5(n,Jg(n));break;case 4:r.timestamp=tY(n,!1);break;default:Zz(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function Zz(e,t){switch(t){case 0:for(;128&Wo(e););break;case 2:uI(e,Jg(e));break;case 5:uI(e,4);break;case 1:uI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Yf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let $z=[];function uI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function eY(e){return e.offset>=e.limit}function yT(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function I5(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function A5(e,t){let n=yT(e,t.length);e.bytes.set(t,n)}function O5(e,t){let n=I5(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,p,m,E,v=i[c+n];(128&v)==0?o+=r(v):(224&v)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&v)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&v)==224?c+2>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],(49344&(l|p<<8))!=32896?o+=s:(E=(15&v)<<12|(63&l)<<6|63&p,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&v)==240?c+3>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],m=i[c+n+3],(12632256&(l|p<<8|m<<16))!=8421504?o+=s:(E=(7&v)<<18|(63&l)<<12|(63&p)<<6|63&m,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function kd(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}Kn(e,r);let i=yT(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function Wo(e){return e.bytes[I5(e,1)]}function N5(e,t){let n=yT(e,1);e.bytes[n]=t}function Jg(e){let t,n=0,r=0;do t=Wo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Kn(e,t){for(t>>>=0;t>=128;)N5(e,127&t|128),t>>>=7;N5(e,t)}function tY(e,t){let n,r=0,i=0,s=0;return n=Wo(e),r=127&n,128&n&&(n=Wo(e),r|=(127&n)<<7,128&n&&(n=Wo(e),r|=(127&n)<<14,128&n&&(n=Wo(e),r|=(127&n)<<21,128&n&&(n=Wo(e),i=127&n,128&n&&(n=Wo(e),i|=(127&n)<<7,128&n&&(n=Wo(e),i|=(127&n)<<14,128&n&&(n=Wo(e),i|=(127&n)<<21,128&n&&(n=Wo(e),s=127&n,128&n&&(n=Wo(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function Ld(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=yT(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}const P5={},D5={},TT=4294967296,nY=TT*TT,k5=nY/2;x5(0,!0);const L5=x5(0),rY=Qg(0,-2147483648,!1),iY=Qg(-1,2147483647,!1);function x5(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=D5[e],r)?r:(n=Qg(e,0,!0),i&&(D5[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=P5[e],r)?r:(n=Qg(e,e<0?-1:0,!1),i&&(P5[e]=n),n)}function Qg(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function M5(e,t){if(isNaN(e))return L5;{if(e<=-k5)return rY;if(e+1>=k5)return iY}return e<0?L5:Qg(e%TT|0,e/TT|0,t)}function U5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class hI extends bn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Ta.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),x(this,"name","AgoraRTCImageModeration"),x(this,"_connectionState",to.CONNECTING),x(this,"_sequence",0),x(this,"_moderationStartTime",void 0),x(this,"_workerConnection",void 0),x(this,"_workerMessageLengthLimit",void 0),x(this,"_qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Ai.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"_moderationInterval",void 0),x(this,"_moderationTimer",null),x(this,"_moderationMode",1),x(this,"_quality",1),x(this,"_qualityTimer",null),x(this,"_ticket",void 0),x(this,"_moderationIntervalMinimum",void 0),x(this,"_uploadFailedNum",0),x(this,"_uploadNum",0),x(this,"_uploadTimer",null),x(this,"_extraInfo",void 0),x(this,"_vendor",""),x(this,"_encoder",new TextEncoder),x(this,"_moderationId",void 0),x(this,"inspectImage",()=>{if(this.connectionState!==to.CONNECTED)throw new ae(j.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===to.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=on(5,"image-moderation-"),this._workerMessageLengthLimit=W("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=W("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=W("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Fg("worker-"+this._moderationId,qn),this.on(Ta.STATE_CHANGE,(r,i)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Mf[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Ta.STATE_CHANGE,Mf.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Ve((i,s)=>{this.on(Ta.CONNECTION_STATE_CHANGE,(o,c)=>{o===to.CONNECTED&&i()}),this.requestAP(t,r,n).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===to.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=W("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,p,m,E){let{appId:v,areaCode:y,cname:D,sid:A,token:O,uid:V}=p;Wf++;const U="moderation_plugin",G={service_name:U,json_body:JSON.stringify({appId:v,areaCode:y,cname:D,command:"allocateEdge",requestId:Wf,seq:Wf,sid:A,appToken:O,ts:Date.now(),uid:V+""})};let Z,Q,z=l[0];return Ea(async()=>{Z=Date.now();const re=await Ca(z,{data:G,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-Z,re.code!==0){const Re=new ae(j.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+re.code,{retry:!0,responseTime:Q});throw R.error(Re.toString()),Re}const he=JSON.parse(re.json_body);if(he.code!==200){const Re=new ae(j.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(he.code,", reason: ").concat(he.reason),{code:he.code,responseTime:Q});throw R.error(Re.toString()),Re}if(!he.servers||!Array.isArray(he.servers)||he.servers.length===0){const Re=new ae(j.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:he.code,responseTime:Q});throw R.error(Re.toString()),Re}if(!he.servers.some(Re=>!!Re.wss)){const Re=new ae(j.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:he.code,responseTime:Q});throw R.error(Re.toString()),Re}const Ee=W("IMAGE_MODERATION_WORKER_HOST");return{addressList:he.servers.map(Re=>{let{address:Ct,wss:bt}=Re;if(Ct&&bt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(Ee,":").concat(bt,"/moderation")}).filter(Re=>!!Re),workerToken:he.workerToken,vid:he.vid,ticket:he.appTicket,responseTime:Q}},(re,he)=>(qe.apworkerEvent(A,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(re.addressList),firstSuccess:he===0,responseTime:Q,serverIp:l[he%l.length]}),!1),(re,he)=>(qe.apworkerEvent(A,{success:!1,sc:re.data&&re.data.code||200,serviceName:U,responseTime:Q,serverIp:l[he%l.length]}),!!(re.code!==j.OPERATION_ABORTED&&re.code!==j.UNEXPECTED_RESPONSE||re.data&&re.data.retry)&&(z=l[(he+1)%l.length],!0)),E)}(i,t,n,r);this.emit(Ta.STATE_CHANGE,Mf.AP_CONNECTED);const{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(t){this.emit(Ta.STATE_CHANGE,Mf.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(vt.CONNECTED,async()=>{this.emit(Ta.STATE_CHANGE,Mf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=to.CONNECTED}),this._workerConnection.on(vt.CLOSED,()=>{this.connectionState=to.CLOSED}),this._workerConnection.on(vt.FAILED,()=>{this.connectionState=to.CLOSED}),this._workerConnection.on(vt.RECONNECTING,()=>{this.connectionState=this.connectionState===to.CONNECTED?to.RECONNECTING:to.CONNECTING}),this._workerConnection.on(vt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=Qz(new Uint8Array(t.data));W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{qe.reportApiInvoke(this._connectInfo.sid||null,{name:xn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Tn.TRACER}).onError(new ae(j.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},W("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ts(this,Ta.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await cx(m,r,i),v=this._sequence+"-"+s+"-"+l+"-"+p+"-"+on(12,""),y={appId:r,cid:s,cname:i,deviceId:"",elapse:hI.intToLong(Number(p-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:M5(p),uid:l,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const D=Jz(y);if(D.byteLength<this._workerMessageLengthLimit){if(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(O){for(var V=1;V<arguments.length;V++){var U=arguments[V]!=null?arguments[V]:{};V%2?U5(Object(U),!0).forEach(function(G){x(O,G,U[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(U)):U5(Object(U)).forEach(function(G){Object.defineProperty(O,G,Object.getOwnPropertyDescriptor(U,G))})}return O}({},y);delete A.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return D}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ai.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=to.CLOSED,this.emit(Ta.STATE_CHANGE,Mf.CLOSED)}}function V5(e){if(nn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ae(j.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ae(j.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const sY={name:"ImageModeration",create:function(e){let{config:t}=e;return V5(t),new hI(t)}};var j5,F5,B5,W5,G5,H5,K5,z5,Y5,q5,X5,J5,Q5,Z5,$5,eV,tV,nV,rV,iV,sV,oV,aV,cV,lV,dV,uV,hV,pV,fV,mV,_V,gV,EV,vV,SV,yV,TV,CV,RV,wV,Fe;function bV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Go(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bV(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}jr.setLogger(R);let oY=(j5=st(),F5=st({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Af))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),B5=st({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==If.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),W5=st({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),G5=st({argsMap:(e,t,n)=>[t,n]}),H5=st({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r?.uid,i]})}),K5=st({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),z5=st({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r?.uid,mediaType:i}})}),Y5=st(),q5=st(),X5=st(),J5=st(),Q5=st(),Z5=st(),$5=st(),eV=st(),tV=st(),nV=st(),rV=st(),iV=st(),sV=st(),oV=st(),aV=st(),cV=st({argsMap:(e,t)=>[t]}),lV=st(),dV=st(),uV=st(),hV=st(),pV=st(),fV=st(),mV=st(),_V=st(),gV=st({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),EV=st(),vV=st(),SV=st(),yV=st(),TV=st(),CV=st(),RV=st({reportResult:!0}),wV=st(),Fe=class extends bn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),x(this,"store",void 0),x(this,"_uid",void 0),x(this,"_channelName",void 0),x(this,"_uintUid",void 0),x(this,"_users",[]),x(this,"_config",void 0),x(this,"_clientId",void 0),x(this,"_appId",void 0),x(this,"_sessionId",null),x(this,"_key",void 0),x(this,"_rtmConfig",{}),x(this,"_joinInfo",void 0),x(this,"_gateway",void 0),x(this,"_statsCollector",void 0),x(this,"_configDistribute",void 0),x(this,"_leaveMutex",void 0),x(this,"_publishMutex",void 0),x(this,"_renewTokenMutex",void 0),x(this,"_subscribeMutex",void 0),x(this,"_encryptionMode","none"),x(this,"_encryptionSecret",null),x(this,"_encryptionSalt",null),x(this,"_encryptDataStream",!1),x(this,"_encryptDataStreamKey",null),x(this,"_encryptDataStreamIv",null),x(this,"_proxyServer",void 0),x(this,"_turnServer",{servers:[],mode:"auto"}),x(this,"_cloudProxyServerMode","disabled"),x(this,"_isDualStreamEnabled",!1),x(this,"_defaultStreamFallbackType",void 0),x(this,"_lowStreamParameter",void 0),x(this,"_streamFallbackTypeCacheMap",new Map),x(this,"_remoteStreamTypeCacheMap",new Map),x(this,"_axiosCancelSource",Ai.CancelToken.source()),x(this,"_audioVolumeIndicationInterval",void 0),x(this,"_networkQualityInterval",void 0),x(this,"_userOfflineTimeout",void 0),x(this,"_streamRemovedTimeout",void 0),x(this,"_liveTranscodeStreamingClient",void 0),x(this,"_liveRawStreamingClient",void 0),x(this,"_channelMediaRelayClient",void 0),x(this,"_networkQualitySensitivity","normal"),x(this,"_p2pChannel",void 0),x(this,"_useLocalAccessPoint",!1),x(this,"_setLocalAPVersion",void 0),x(this,"_joinAndNotLeaveYet",!1),x(this,"_numberOfJoinCount",0),x(this,"_joinResponse",null),x(this,"_remoteDefaultVideoStreamType",void 0),x(this,"_inspect",void 0),x(this,"_moderation",void 0),x(this,"_license",void 0),x(this,"_pendingPublishedUsers",[]),x(this,"ntpAlignErrorCount",0),x(this,"remoteInboundOffset",0),x(this,"_peerConnectionState",void 0),x(this,"_handleLocalTrackEnable",(i,s,o)=>{this.publish(i,!1).then(s).catch(o)}),x(this,"_handleLocalTrackDisable",(i,s,o)=>{this.unpublish(i).then(s).catch(o)}),x(this,"_handleUserOnline",i=>{if(W("BLOCK_LOCAL_CLIENT")&&Sh(i.uid,this.channelName))return void R.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(o=>o.uid===i.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Nt.USER_JOINED,s));else{const o=new Pd(i.uid,i.uint_id||i.uid);this._users.push(o),R.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.safeEmit(Nt.USER_JOINED,o)}}),x(this,"_handleUserOffline",i=>{if(W("BLOCK_LOCAL_CLIENT")&&Sh(i.uid,this.channelName))return;const s=this._users.find(o=>o.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:Ty(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),R.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Nt.USER_LEAVED,s,i.reason))}),x(this,"_handleAddAudioOrVideoStream",(i,s,o,c,l,p,m,E)=>{if(W("BLOCK_LOCAL_CLIENT")&&Sh(s,this.channelName))return;const v=this._users.find(D=>D.uid===s);if(!v)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(v.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(v.uid,{videoAddNotify:Date.now()});const y=i==="audio"?v.hasAudio:v.hasVideo;if(v._uintid||(v._uintid=p||s),i==="audio"?v._trust_audio_stream_added_state_=!0:v._trust_video_stream_added_state_=!0,i==="audio"?(v._audio_added_=!0,o!==void 0&&(v._audioSSRC=o),c!==void 0&&(v._cname=c),m&&(v._audioOrtc=m)):(v._video_added_=!0,o!==void 0&&(v._videoSSRC=o),c!==void 0&&(v._cname=c),E!==void 0&&(v._rtxSsrcId=E),m&&(v._videoOrtc=m)),(i==="audio"?v.hasAudio:v.hasVideo)&&!y&&(R.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,v,i)),i==="video"?qe.onGatewayStream(this._sessionId,sr.ON_ADD_VIDEO_STREAM,yn.ON_ADD_VIDEO_STREAM,{peer:p||s,ssrc:v._videoSSRC}):qe.onGatewayStream(this._sessionId,sr.ON_ADD_AUDIO_STREAM,yn.ON_ADD_AUDIO_STREAM,{peer:p||s,ssrc:v._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(v,i,o).then(D=>{if(D&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Xg))return this._p2pChannel.unsubscribe(v,i,!0).then(()=>this._subscribe(v,i,!0).catch(A=>{R.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(v,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after reconnect.")),this._subscribe(v,i,!0).catch(D=>{R.error("[".concat(this._clientId,"] resubscribe error"),D.toString())})),i==="video"&&!Nr()&&!qr()){const D=this._getEncodingName(l);D?.toLocaleLowerCase()==Dg.av1&&Pz().then(A=>{A||this._gateway.downgradeCodec(D)})}}),x(this,"_handleRemoveStream",i=>{if(W("BLOCK_LOCAL_CLIENT")&&Sh(i.uid,this.channelName))return;const s=this._users.find(c=>c.uid===i.uid);if(!s)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let o=()=>{};s.hasAudio&&s.hasVideo?o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(o=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Xg&&this._p2pChannel.unsubscribe(s).then(c=>{if(c)return this._gateway.unsubscribe(c,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),qe.onGatewayStream(this._sessionId,sr.ON_REMOVE_STREAM,yn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),o()}),x(this,"_handleSetStreamLocalEnable",(i,s,o)=>{if(W("BLOCK_LOCAL_CLIENT")&&Sh(s,this.channelName))return;const c=this._users.find(m=>m.uid===s);if(!c)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(o?"enabled":"disabled"," with uid ").concat(s));const l=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;const m=c._audio_enabled_;if(c._audio_enabled_=o,c._audio_enabled_===m)return;{const E=c._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}else{c._trust_video_enabled_state_=!0;const m=c._video_enabled_;if(c._video_enabled_=o,c._video_enabled_===m)return;{const E=c._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}const p=i==="audio"?c.hasAudio:c.hasVideo;return l!==p?!l&&p?(R.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(Nt.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),R.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(Nt.USER_UNPUBLISHED,c,i)):void 0}),x(this,"_handleMuteStream",(i,s,o)=>{if(W("BLOCK_LOCAL_CLIENT")&&Sh(i,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),i,s,o);const c=this._users.find(m=>m.uid===i);if(!c)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const l=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;const m=c._audio_muted_;if(c._audio_muted_=o,c._audio_muted_===m)return;{const E=c._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}else{c._trust_video_mute_state_=!0;const m=c._video_muted_;if(c._video_muted_=o,c._video_muted_===m)return;{const E=c._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}const p=s==="audio"?c.hasAudio:c.hasVideo;if(l!==p){if(!l&&p)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(Nt.USER_PUBLISHED,c,s)):void R.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),R.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(Nt.USER_UNPUBLISHED,c,s)}}),x(this,"_handleP2PLost",async i=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),x(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),x(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),x(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Nt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Nt.NETWORK_QUALITY,i)}),x(this,"_handleP2PAddAudioOrVideoStream",(i,s,o,c)=>{const l=this._users.find(m=>m.uid===s);if(!l)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(l.uid,i,void 0,void 0,void 0,Date.now());const p=i==="audio"?l.hasAudio:l.hasVideo;i==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,i==="audio"?(l._audio_added_=!0,o!==void 0&&(l._audioSSRC=o),c!==void 0&&(l._audioMid=c)):(l._video_added_=!0,o!==void 0&&(l._videoSSRC=o),c!==void 0&&(l._videoMid=c)),(i==="audio"?l.hasAudio:l.hasVideo)&&!p&&(R.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,l,i)),this._p2pChannel.hasPendingRemoteMedia(l,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,i,!0).catch(m=>{R.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=t||on(5,"client-"),this.store=new class{constructor(i,s,o,c){pt(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:o,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ph.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=function(s,o){switch(o.type){case ft.SET_SESSION_ID:return we(we({},s),{},{sessionId:o.sessionId});case ft.SET_P2P_ID:return we(we({},s),{},{p2pId:o.p2pId});case ft.SET_UID:return we(we({},s),{},{uid:o.uid});case ft.SET_INT_UID:return we(we({},s),{},{intUid:o.intUid});case ft.SET_PUB_ID:return we(we({},s),{},{pubId:o.pubId});case ft.KEY_METRIC_CLIENT_CREATED:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{clientCreated:o.metric})});case ft.KEY_METRIC_JOIN_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinStart:o.metric})});case ft.KEY_METRIC_PRELOAD_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{preloadStart:o.metric})});case ft.KEY_METRIC_PRELOAD_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{preloadEnd:o.metric})});case ft.KEY_METRIC_JOIN_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinEnd:o.metric})});case ft.KEY_METRIC_REQUEST_AP_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestAPStart:o.metric})});case ft.KEY_METRIC_REQUEST_AP_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestAPEnd:o.metric})});case ft.KEY_METRIC_REQUEST_SUA_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{requestSUAEnd:o.metric})});case ft.KEY_METRIC_BEFORE_CONNECT:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{beforeConnect:o.metric})});case ft.KEY_METRIC_PEER_RECEIVER:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerReceiver:o.metric})});case ft.KEY_METRIC_SIGNAL_CONNECTED:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{signalConnected:o.metric})});case ft.KEY_METRIC_JOIN_REQ:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinReq:o.metric})});case ft.KEY_METRIC_JOIN_REP:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinRep:o.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinGatewayStart:o.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{joinGatewayEnd:o.metric})});case ft.KEY_METRIC_PEER_CONNECTION_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerConnectionStart:o.metric})});case ft.KEY_METRIC_PEER_CONNECTION_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{peerConnectionEnd:o.metric})});case ft.KEY_METRIC_DESCRIPTION_START:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{descriptionStart:o.metric})});case ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{signalChannelOpen:o.metric})});case ft.KEY_METRIC_ICE_CONNECTION_END:return we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{iceConnectionEnd:o.metric})});case ft.KEY_METRIC_PUBLISH:{const c=s.keyMetrics.publish,l=c.findIndex(p=>p.trackId===o.metric.trackId);return l!==-1?(c[l]=we(we({},c[l]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{publish:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,o.metric]})})}case ft.KEY_METRIC_SUBSCRIBE:{const c=s.keyMetrics.subscribe,l=c.findIndex(p=>p.userId===o.metric.userId&&p.type===o.metric.type);return l!==-1?(c[l]=we(we({},c[l]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{subscribe:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,o.metric]})})}case ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const c=s.keyMetrics.firstVideoFrameDecoded,l=c.findIndex(p=>p.userId===o.metric.userId);return l!==-1?(c[l]=we(we({},c[l]),o.metric),we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):we(we({},s),{},{keyMetrics:we(we({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,o.metric]})})}case ft.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case ft.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=o.mode,s;case ft.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,o.record]:(s.joinChannelServiceRecords[o.index]=we(we({},s.joinChannelServiceRecords[o.index]),o.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case ft.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case ft.SET_USE_P2P:return we(we({},s),{},{useP2P:o.val});case ft.SET_TRANSPORT_TYPE:return we(we({},s),{},{p2pTransport:o.val});default:return s}}(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:ft.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:ft.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:ft.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:ft.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:ft.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:ft.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:ft.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:ft.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:ft.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ft.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ft.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ft.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ft.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ft.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:we({userId:i},s)})}descriptionStart(){this.dispatch({type:ft.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,o,c){this.dispatch({type:ft.KEY_METRIC_PUBLISH,metric:we(we({trackId:i,type:s},o&&{publishStart:o}),c&&{publishEnd:c})})}subscribe(i,s,o,c,l,p,m){this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:we(we(we(we(we({userId:i,type:s},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),l&&{firstFrame:l}),p&&{streamAdded:p}),m&&{firstDecoded:m})})}massSubscribe(i,s,o,c){i.forEach(l=>{this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:we(we(we({userId:l.userId,type:l.type},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:we(we({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ft.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ft.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new jr("client-leave",this._clientId),this._publishMutex=new jr("client-publish",this._clientId),this._renewTokenMutex=new jr("client-renewtoken",this._clientId),this._subscribeMutex=new jr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Qs," build: ").concat(Qw,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Vw(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){R.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new Yg(this.store),this._statsCollector.onStatsException=(i,s,o)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(o)),i===Jb.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(c=>{c instanceof My&&W("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()}),this.safeEmit(Nt.EXCEPTION,{code:i,msg:s,uid:o})},this._statsCollector.onUploadPublishDuration=(i,s,o,c)=>{const l=this._users.find(p=>p.uid===i);l&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(l._uintid,{peerPublishDuration:o,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(l)),qe.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:o,peer:l._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(W("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const s=this.localTracks.find(o=>o instanceof mn);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?W("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new wz(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||qn,httpRetryConfig:e.httpRetryConfig||qn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Mz(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},fl("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Xg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];$t("JOIN_GATEWAY_USE_443PORT_ONLY",s),$t("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const c=this._gateway.signal.websocket;return c instanceof xb&&(c.use443PortOnly=s,c.tryDoubleDomain=o),async function(l,p,m){gy.get(l)||gy.set(l,[]),Ey.get(l)||Ey.set(l,p),_c.get(l)||_c.set(l,0);const E=gy.get(l),v=Ey.get(l);if(!E||!v)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(_c.get(l)===v){const V=Cg();E.push(V),await V.promise}_c.set(l,_c.get(l)+1);for(var y=arguments.length,D=new Array(y>3?y-3:0),A=3;A<y;A++)D[A-3]=arguments[A];const O=await m(...D);return _c.set(l,_c.get(l)-1),_c.get(l)===v-1&&E.length>0&&(E[0].resolve(),E.shift()),_c.get(l)===0&&(gy.set(l,[]),Ey.set(l,0),_c.set(l,0)),O}("client.join",W("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(wy||wy||(wy=(window.location.protocol.split(":")[0]||"").toUpperCase(),wy))==="HTTPS",c=TL()?window.isSecureContext:"Browser Not Support";(!TL()&&!o||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let l;qe.setAppId(e);try{if(!n&&n!==null)throw new ae(j.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Cr(n,"token",1,2047),Cr(e,"appid",1,2047),Yy(t),r&&qy(r),i)if(typeof i=="string")Cr(i,"optionalInfo",1,256),l=i;else{if(typeof i!="object")throw new ae(j.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:O,enableInstantMuteRestore:V}=i;O&&(ga(O,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(O)),this.store.autoSubscribe=O),V&&(ga(V,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(V)),this.store.enableInstantMuteRestore=V)}}}catch(O){throw qe.reportApiInvoke(hh(),{name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}).onError(O),O}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const O=new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw qe.reportApiInvoke(hh(),{name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}).onError(O),O}this._gateway.state="CONNECTING",this.store.preloadStart();const p=await y5({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const m=p?.sid||hh();R.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);const E=qe.reportApiInvoke(m,{id:this._clientId,name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}),v=Go(Go(Go({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!p},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:W("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(v.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(v.stringUid=r,this._uintUid?(v.uid=this._uintUid,this._uintUid=void 0):v.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(v.aesmode=this._encryptionMode,v.aespassword=await(async O=>{const V=function(Q){const z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),re=new Uint8Array(new ArrayBuffer(z.length));for(let he=0;he<z.length;he+=1)re[he]=z.charCodeAt(he);return re}(),U=await window.crypto.subtle.importKey("spki",V,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),G=Mw(O),Z=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},U,G);return function(Q){let z="";for(let re=0;re<Q.length;re+=1)z+=String.fromCharCode(Q[re]);return window.btoa(z)}(new Uint8Array(Z))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(v.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const O=new TextEncoder,V=W("USE_PURE_ENCRYPTION_MASTER_KEY")?O.encode(v.appId+this._encryptionSecret+this._encryptionSecret):O.encode(v.appId+v.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(U,G,Z){const Q=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=U==="aes-128-gcm2"?128:256,re=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:DL,hash:"SHA-256",salt:Z},Q,z+tK);return new Uint8Array(re).subarray(z/8)}(this._encryptionMode,V,uh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(U,G,Z){const Q=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=U==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:DL,hash:"SHA-256",salt:Z},Q,{name:"AES-GCM",length:z},!0,["encrypt","decrypt"])}(this._encryptionMode,V,uh(this._encryptionSalt))}else c?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:v.stringUid});const y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&qe.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let O;const V=v.cloudProxyServer;if(Oe(D=["proxy3","proxy4","proxy5"]).call(D,V)){const z=W("PROXY_SERVER_TYPE3");Array.isArray(z)?v.proxyServer=z[0]:v.proxyServer=z}if(qe.setProxyServer(v.proxyServer),R.setProxyServer(v.proxyServer),this.store.requestAPStart(),p){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(v.stringUid?", ".concat(v.stringUid," => ").concat(p.intUid):""," ")),v.stringUid&&!v.uid&&(v.uid=p.intUid),O={gatewayInfo:p.ap.gatewayInfo},W("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&v.turnServer.mode==="auto")if(p.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const z=(await gU(p.ap.proxyInfo,p.ap.gatewayInfo.uid)).map(re=>({turnServerURL:re.address,tcpport:re.tcpport||kr.tcpport,udpport:re.udpport||kr.udpport,username:re.username||kr.username,password:re.password||kr.password,forceturn:!1,security:!0}));v.turnServer={mode:"manual",servers:z}}R5(p,v.stringUid)}else{if(v.stringUid&&!v.uid){let z;[z,O]=await Ve.all([KU(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store).finally(()=>{this.store.requestSUAEnd()}),HU(v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(v.stringUid," => ").concat(z)),v.uid=z,O.gatewayInfo.uid=z,O.gatewayInfo.res.uid=z}else O=await HU(v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(v,this._axiosCancelSource.token),this._configDistribute.on(Vg.UPDATE_BITRATE_LIMIT,z=>{this._p2pChannel.updateBitrateLimit(z)}),this._configDistribute.on(Vg.UPDATE_CLIENT_ROLE_OPTIONS,z=>{this._setClientRoleOptions(z)})},0),this._key=n||e;const U=O.gatewayInfo,G=v.uid?v.uid:U.uid;this._joinInfo=Go(Go({},v),{},{cid:U.cid,uid:G,vid:U.vid,apResponse:U.res,apGatewayAddress:U.apGatewayAddress,uni_lbs_ip:U.uni_lbs_ip,gatewayAddrs:U.gatewayAddrs}),this.store.intUid=G,this.store.cid=U.cid;const Z=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(Z),this._appId=e,this._channelName=v.cname,this._uid=Z,this.store.uid=Z,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Q=v.stringUid?"string uid: ".concat(v.stringUid,",uid: ").concat(v.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Q)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),A=this,Oe(vh).call(vh,A)||vh.push(A),this._cloudProxyServerMode==="disabled"&&Ft().supportWebCrypto&&W("ENABLE_PRELOAD")&&dI(this._joinInfo),Z}catch(O){const V=Array.isArray(O)?O[0]:O;throw V&&V.code===j.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),V):R.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),V),V.code!==j.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(V),V}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new ae(j.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!W("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=vh.indexOf(t);n!==-1&&vh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Xt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Af))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ae(j.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new ae(j.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof Af))throw new ae(j.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new ae(j.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof mn&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),R.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw R.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new ae(j.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));nn(e.id,"id",0,65535,!0),ga(e.ordered,"ordered"),Cr(e.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new ae(j.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ae(j.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ae(j.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return xU(i,!1)}(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ae(j.CREATE_DATACHANNEL_ERROR);try{await Ve.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==j.DISCONNECT_P2P)throw i}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw R.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ae(j.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Af))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Vn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw R.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Pd)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new ae(j.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(ir(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ae(j.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ae(j.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Be.AUDIO,r=t===Be.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:c,cname:l,uint_id:p}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new ae(j.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(v=>v.uid===e);m||(m=new Pd(e,p||e),m._is_pre_created=!0,this._users.push(m)),l&&(m._cname=l),m._uintid||(m._uintid=p||e),n&&(m._audioSSRC=s,m._audio_pre_subscribed=!0,o&&(m._audioOrtc=o)),r&&(m._videoSSRC=s,m._video_pre_subscribed=!0,o&&(m._videoOrtc=o),c!=null&&(m._rtxSsrcId=c)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(m,t,s,c,o);const E=n?m._audioTrack:m._videoTrack;if(!E)throw new ae(j.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),r&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),E}catch(s){throw R.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var n;if(nn(t,"channelId",0,65535,!0),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ae(j.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ae(j.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(c=>c.id===t);if(!i)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ae(j.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(e,[i]);if(c&&Oe(c).call(c,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ae(j.CREATE_DATACHANNEL_ERROR);const l={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await i._waitTillOpen()}catch(l){if(l?.code!==j.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),l;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){const s=new ae(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new ae(j.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new ae(j.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,o,c)}catch(o){throw o}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new ae(j.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new ae(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new ae(j.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new ae(j.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Be.AUDIO:Be.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const l=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==i&&(i=m,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Be.AUDIO:Be.VIDEO,ssrcId:i}),Gr.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,c,!0)}catch(E){if(E?.code!==j.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),E;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m?.code,e,t),m}R.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new ae(j.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),p}catch(p){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{l()}}async massSubscribe(e){if(dl(e,"subscribeList"),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(c=>{let{user:l,mediaType:p}=c;return"user: ".concat(l?.uid,", mediaType: ").concat(p)}).join("; ")));const i=(e=[...e]).map(c=>{let{user:l,mediaType:p}=c;return{user:l,mediaType:p}}),s=await this._p2pChannel.globalLock();try{var o;for(let l=e.length-1;l>=0;l--){const p=e[l],{user:m,mediaType:E}=p;if(ir(E,"mediaType",["audio","video"]),!m){const A=new ae(j.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===m)){const A=new ae(j.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),i[l].error=A,e.splice(l,1);continue}if(E==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||E==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const A=new ae(j.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(E,", remote user is not published")),i[l].error=A,e.splice(l,1);continue}const y=ur.Video|ur.LwoVideo,D=n.get(m);if(D){if(E==="video"?D&y:D&ur.Audio){e.splice(l,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(E," twice"));continue}n.set(m,D|(E==="video"?y:ur.Audio))}else n.set(m,E==="video"?y:ur.Audio)}for(let l=e.length-1;l>=0;l--){const p=e[l],{user:m,mediaType:E}=p,v=ur.Video|ur.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,E)){await this._p2pChannel.unmuteRemoteNoLock(m,E);const y=n.get(m);n.set(m,E==="video"?y^v:y^ur.Audio),e.splice(l,1)}}this.store.massSubscribe(e.map(l=>({userId:l.user.uid,type:l.mediaType})),t);let c=Ui(o=Array.from(n.entries())).call(o,(l,p)=>{let[m,E]=p;if(E===0)return l;const v={stream_id:m.uid,stream_type:E};return E&ur.Audio&&(v.audio_ssrc=m._audioSSRC),E&ur.Video&&(v.video_ssrc=m._videoSSRC),l.push(v),l},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(p=>{let{user:m,mediaType:E}=p;return{user:m,mediaType:E,ssrcId:E===Be.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:E===Be.VIDEO?m._rtxSsrcId:void 0}}));const l=new Map;if(c=c.filter(p=>p.video_ssrc&&!this._p2pChannel.isPreSubScribe(p.video_ssrc)||p.audio_ssrc&&!this._p2pChannel.isPreSubScribe(p.audio_ssrc)||!p.video_ssrc&&!p.audio_ssrc),c.length>0){const p=await this._gateway.subscribeAll(c,!0);(p?.users||[]).forEach(m=>{let{stream_id:E,video_error_code:v,audio_error_code:y,error_code:D}=m;(v||y||D)&&l.set(E,{video_error_code:v,audio_error_code:y,error_code:D})})}if(Array.from(l.entries()).length>0){const p=[];Array.from(l.entries()).forEach(m=>{let[E,v]=m;const y=this.remoteUsers.find(D=>D.uid===E);if(y){let D;v.error_code||v.video_error_code&&v.audio_error_code?D=void 0:v.video_error_code?D=Be.VIDEO:v.audio_error_code&&(D=Be.AUDIO),p.push({user:y,mediaType:D})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of i){const m=l.get(p.user.uid);if(m){const E=m.error_code||p.mediaType==="audio"&&m.audio_error_code||p.mediaType==="video"&&m.video_error_code;if(E){const v=jg(E);R.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(v.desc)),p.error=new ae(j.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(v.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(i.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),i.forEach(p=>{var m;qe.subscribe(this.store.sessionId,{succ:!!p.error,ec:((m=p.error)===null||m===void 0?void 0:m.code)||null,video:p.mediaType===Be.VIDEO,audio:p.mediaType===Be.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===Be.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(p.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(p=>{let{user:m,mediaType:E}=p;return"user: ".concat(m?.uid,", mediaType: ").concat(E)}).join("; "))),i}catch(l){throw await this._p2pChannel.massUnsubscribeNoLock(e),l}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Pd)){const s=this.remoteUsers.find(o=>o.uid===e);if(!s)throw new ae(j.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new ae(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Ty(this._users,e),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===j.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&nn(t,"id",0,65535,!0),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new ae(j.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(s=>s.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new ae(j.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===j.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(dl(e,"unsubscribeList"),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const c=new ae(j.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(ir(i,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===r)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=ur.Video|ur.LwoVideo;if(t.has(r)){const c=t.get(r);let l;switch(i){case"video":l=c&o;break;case"audio":l=c&ur.Audio;break;default:l=c&(ur.Audio|o)}if(l){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,c|ur.Audio):i==="video"&&t.set(r,c|o):t.set(r,c|ur.Audio|o)}else i?i==="audio"?t.set(r,ur.Audio):i==="video"&&t.set(r,o):t.set(r,ur.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i?.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===j.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new ue(j.INVALID_PARAMS);Pn(n.width)||Lw(n.width,"streamParameter.width"),Pn(n.height)||Lw(n.height,"streamParameter.height"),Pn(n.framerate)||Lw(n.framerate,"streamParameter.framerate"),Pn(n.bitrate)||nn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Te.LocalVideoLowTrack)}async enableDualStream(){if(!Ft().supportDualStream)throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ae(j.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ae(j.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ae(j.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Te.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,qe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){ir(r,"role",["audience","host"])}(e),t&&Vw(t),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ae(j.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ae(j.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ae(j.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&W("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Pr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),R.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&Vw(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Cr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ae(j.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ae(j.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,qe.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ae(j.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ae(j.INVALID_OPERATION,"You have already set the proxy")}if(Ig(e))return this._turnServer={servers:e,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>dL(n)),this._turnServer={servers:e,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ae(j.INVALID_OPERATION,"you should set license before join channel");if(Cr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ae(j.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,R.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ae(j.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ae(j.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ae(j.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ae(j.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ae(j.INVALID_OPERATION,"Stop proxy server after leave channel");qe.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ae(j.INVALID_PARAMS,"accessPoints is required.");dl(e.accessPoints.serverList,"accessPoints.serverList"),Cr(e.accessPoints.domain,"accessPoints.domain");const t=(v,y)=>{nn(v,y,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ae(j.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");W("CLOSE_AFB_FOR_LOCAL_AP")&&($t("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),$t("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map(v=>r.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(i):v),o=s.map(v=>"".concat(v,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,$t("WEBCS_DOMAIN",o),$t("WEBCS_DOMAIN_BACKUP_LIST",o),$t("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(dl(e.report.hostname,"report.hostname"),$t("EVENT_REPORT_DOMAIN",e.report.hostname[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):($t("EVENT_REPORT_DOMAIN",s[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),c=e.report.port),$t("STATS_COLLECTOR_PORT",c),e.report?$t("ENABLE_EVENT_REPORT",!0):$t("ENABLE_EVENT_REPORT",!1);let l="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(dl(e.log.hostname,"log.hostname"),l=e.log.hostname[0]):l=s[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),$t("LOG_UPLOAD_SERVER","".concat(l,":").concat(p));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(dl(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=s;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),$t("CDS_AP",m.map(v=>"".concat(v,":").concat(E))),e.cds?$t("ENABLE_CONFIG_DISTRIBUTE",!0):$t("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(dl(e,"serverList"),Cr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ae(j.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,$t("WEBCS_DOMAIN",e),$t("WEBCS_DOMAIN_BACKUP_LIST",e),$t("GATEWAY_DOMAINS",[t]),$t("EVENT_REPORT_DOMAIN",e[0]),$t("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),$t("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(ir(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){ir(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){ir(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}R.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(s){ir(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Cr(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Oe(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new ae(j.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ae(j.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(ga(r,"encryptDataStream"),!Oe(i).call(i,e))throw new ae(j.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Sd(n))}async renewToken(e){if(Cr(e,"token",1,2047),!this._key||!this._joinInfo)throw new ae(j.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(W("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await xz(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,R.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Nt.VOLUME_INDICATOR,e)},W("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ae(j.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ae(j.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ae(j.LIVE_STREAMING_TASK_CONFLICT);const n=t?ul.TRANSCODE:ul.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(ul.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new ae(j.INVALID_PARAMS,"can not find live streaming url to stop");await Ve.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){QU(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){QU(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Xg&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ae(j.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Oe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,s,o){var c;const l=Ui(c=Array.from(o)).call(c,(A,O)=>A+O,0),p={serverTs:0,seq:nK++,length:o.length,checkSum:l},m=new Uint8Array(EL(l,2)),E=new ArrayBuffer(Tf),v=new DataView(E);v.setUint32(0,p.serverTs),v.setUint16(4,p.seq),v.setUint16(6,p.length),v.setUint16(8,p.checkSum);const y=16-o.length%16;o=pL(o,new Uint8Array(y));const D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:PL,additionalData:m},s,o);return pL(new Uint8Array(E),new Uint8Array(D))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ae(j.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ct.DATA_STREAM,{payload:Sd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Gz},!n)}sendMetadata(e){if(!this._joinInfo)throw new ae(j.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ae(j.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ct.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Sd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(uK),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"can not send custom report, not joined");await qe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(W("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{Oe(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){ir(t.spatialLayer,"spatialLayer",[0,1,2,3]),ir(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(ga(t,"apRTM"),nn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Lf.indexOf(e);t!==-1&&Lf.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ai.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&C5(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&qe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new jr("client-publish",this._clientId),this._subscribeMutex=new jr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||hh();e?R.debug("[".concat(this._clientId,"] new Session ").concat(r)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,qe.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};qe.sessionInit(this._sessionId,Go({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ae(j.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ae(j.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Vn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==j.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof mn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(s=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===j.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ae(j.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(j.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==j.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===j.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ae(j.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},fl("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{qe.reportApiInvoke(this._sessionId,{name:xn.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Tn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{qe.reportApiInvoke(this._sessionId,{name:xn.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Tn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_WARNING,i,s)},n.on(Db.REQUEST_WORKER_MANAGER_LIST,(i,s,o)=>{if(!this._joinInfo)return o(new ae(j.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,l,p,m){const E=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(v=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(v+"/api/v1?action=uap"):"https://".concat(v,"/api/v1?action=uap"));return await Az(E,c,l,p,m)})(i,this._joinInfo,this._axiosCancelSource.token,qn).then(s).catch(o)}),n};return e===ul.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ae(j.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},fl("ChannelMediaRelay").create(e));r.on("state",i=>{i===Ki.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const s=[];this._users.forEach(o=>{o._dataChannels.forEach(c=>{n.every(l=>l.uid!==o._uintid||l.stream_id!==c.id)&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:o,stream_id:c,ordered:l,max_retrans_times:p,metadata:m}=s,E=this._users.find(v=>v._uintid===o);if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Oe(i).call(i,E)||i.push(E),E._uintid||(E._uintid=o),E._dataChannels.findIndex(v=>v.id===s.stream_id)===-1){const v={id:c,ordered:!!l,maxRetransmits:p,metadata:m},y=function(D){return xU(D,!0)}(v);E._dataChannels.push(y),R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(Nt.USER_PUBLISHED,E,"datachannel",v)}this._p2pChannel.hasPendingRemoteDataChannel(E,s.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,s.stream_id).catch(v=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),v.toString())}))}),t&&(this.safeEmit(Nt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:o,stream_id:c}=s,l=this._users.find(m=>m._uintid===o);if(!l)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=l._dataChannels.find(m=>m.id===s.stream_id);p&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(l,[p]).then(m=>{if(l._dataChannels=l._dataChannels.filter(E=>E!==p),m)return this._gateway.unsubscribeDataChannel(m,l.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(Nt.USER_UNPUBLISHED,l,"datachannel",p._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return i==null||(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Nt.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(_r.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{const{value:i,type:s,expires:o}=t[r];o&&o<=n||s||wb()||!Object.prototype.hasOwnProperty.call(Ay,r)||(va[r]=i,Sn[r]=i,R.debug("Update gateway parameters from config distribute",r,i))})}catch(t){R.error("Error update config from local cache",t.message)}})()}),this._gateway.on(_r.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(_r.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Xt.FALLBACK)return;const i=()=>{this.safeEmit(Nt.CONNECTION_STATE_CHANGE,e,t,n)};if(qe.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:xn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Tn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch(l=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),l)})}),this._remoteStreamTypeCacheMap.forEach((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch(l=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),l)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Be.AUDIO,!1)),o._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Be.VIDEO,!1)),o._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}i()}),this._gateway.on(_r.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ae(j.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await y5(Go(Go({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,R5(r),this._joinInfo.preload=!0):(n=await qb(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s;const[c,l]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:c,port:l}):i.push({host:c,port:l})}),e(i)}catch(n){t(n)}}),this._gateway.on(_r.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Nt.NETWORK_QUALITY,e)}),this._gateway.on(_r.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Nt.STREAM_TYPE_CHANGED,e,t),qe.reportApiInvoke(this._sessionId,{name:xn.STREAM_TYPE_CHANGE,options:[e,t],tag:Tn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(_r.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(_r.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}}),this._gateway.on(_r.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const r=CU(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(_r.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:o}=this._joinInfo.apResponse,c="".concat(o,"_").concat(s);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=W("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(l){l.code&&l.code===j.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Pt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Pt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Pt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Pt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Pt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Be.AUDIO,!0)),this._gateway.signal.on(Pt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Be.AUDIO,!1)),this._gateway.signal.on(Pt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Be.VIDEO,!0)),this._gateway.signal.on(Pt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Be.VIDEO,!1)),this._gateway.signal.on(Pt.RECEIVE_METADATA,e=>{const t=uh(e.metadata);this.safeEmit(Nt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Pt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=uh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Oe(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Tf)throw new ae(j.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Tf));n=await async function(s,o,c){const l=c.subarray(0,Tf),p=l.slice(8,Tf),m=(p[0]<<8)+p[1],E=(l[6]<<8)+l[7],v=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:PL,additionalData:new Uint8Array(EL(m,2))},o,c.subarray(Tf));return new Uint8Array(v).subarray(0,E)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(c=>c.uid===e.uid),o=i?.audioRecv.find(c=>c.ssrc===s?._audioSSRC);r=o?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),Kz(Go(Go({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Pt.ON_CRYPT_ERROR,()=>{vd(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Nt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xt.TOKEN_EXPIRE),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pt.ON_STREAM_FALLBACK_UPDATE,e=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Nt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Pt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Pt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ht.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ct.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const s=i.some(l=>{let{stream_type:p}=l;return p===Qt.Audio}),o=i.some(l=>{let{stream_type:p}=l;return p!==Qt.Audio}),c=i.some(l=>{let{stream_type:p}=l;return p===Qt.Screen||p===Qt.ScreenLow});t.state==="offer"&&qe.publish(this._joinInfo.sid,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:j.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(n=i.find(l=>{let{stream_type:p}=l;return p===Qt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(r=i.find(l=>{let{stream_type:p}=l;return p!==Qt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case ct.SUBSCRIBE:t&&qe.subscribe(this._joinInfo.sid,{succ:!1,ec:j.TIMEOUT,audio:t.stream_type===Be.AUDIO,video:t.stream_type===Be.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Gr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Pt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Pt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;W("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Sh(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let i=this._users.find(m=>m._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Pd(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Nt.USER_JOINED,i)));const s=ur.Audio&r.stream_type,o=(ur.Video|ur.LwoVideo)&r.stream_type,c=(65280&r.stream_type)!=0,l=s&&i.hasAudio,p=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!l&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Nt.USER_PUBLISHED,i,"audio")),o&&!p&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Nt.USER_PUBLISHED,i,"video")),(s&&!l||o&&!p||c)&&t.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Nt.PUBLISHED_USER_LIST).length>0?W("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Nt.PUBLISHED_USER_LIST,t)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Pt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Xg&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return Oe(r=Object.keys(Dg)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Pt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Vn.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(i=>{const{kind:s,ssrcs:o,mid:c,isMuted:l}=i;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,c);const p=this._users.find(m=>m.uid===r);return p&&this.store.useP2P?this._p2pChannel.mockSubscribe(p,s,o[0].ssrcId,c).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,s,!!l)})}),this._gateway.signal.on(Vn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}}),this._gateway.signal.on(ht.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Vn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find(o=>o.uid===i);if(!s)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async o=>{let{stream_type:c}=o;const l=c===Qt.Audio?Be.AUDIO:Be.VIDEO;await this._p2pChannel.unsubscribe(s,l),this._handleMuteStream(i,l,!0)}),t()}catch(o){n(o)}}}),this._gateway.signal.on(Vn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case Rd.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Be.VIDEO,!0);break;case Rd.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Be.AUDIO,!0);break;case Rd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Be.VIDEO,!1);break;case Rd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Be.AUDIO,!1)}}),this._gateway.signal.on(Vn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==gi.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Vn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(et.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Vn.RESTART_ICE,e,r===gi.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(et.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Vn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(et.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Vn.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(et.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===j.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===j.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.StateChange,(e,t)=>{t===Jt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(et.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Nt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(et.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===j.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===j.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(et.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(et.RequestRePublishDataChannel,(e,t,n)=>{Ve.all(e.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==j.DISCONNECT_P2P)throw s}})).then(t).catch(n)}),this._p2pChannel.on(et.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===Be.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(et.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(et.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(et.MediaReconnectStart,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(et.MediaReconnectEnd,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(et.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(et.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(o){return void t.throw(o)}const{iceParameters:s}=function(o){const c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}}(i);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(et.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(et.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),o=CU(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(et.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(et.P2PLost,()=>{this.safeEmit(Nt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(et.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(et.ConnectionTypeChange,e=>{this.safeEmit(Nt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(et.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(et.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(et.AudioMetadata,e=>{this.safeEmit(Nt.AUDIO_METADATA,e)}),this._p2pChannel.on(et.AudioPts,e=>{this.safeEmit(Nt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},fl("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:o,uid:c,cid:l,vid:p}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:o,uid:c,cid:l,vid:p?Number(p):0},qn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(gr.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===jo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Nt.CONTENT_INSPECT_ERROR,new ae(j.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(gr.INSPECT_RESULT,(t,n)=>{var r;if(n?.code===j.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Nt.CONTENT_INSPECT_RESULT,t,n)}),e.on(gr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ga(e,"enabled"),e){if(!t)throw new ae(j.INVALID_PARAMS,"config is required");if(V5(t),!this._joinInfo)throw new ae(j.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},fl("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:o,token:c,uid:l,cid:p,vid:m}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:l,cid:p,vid:m?Number(m):0},qn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new ae(j.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Ta.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===to.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ae(j.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ta.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){ir(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ae(j.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ga(e,"enabled"),$t("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ye(Fe.prototype,"leave",[j5],Object.getOwnPropertyDescriptor(Fe.prototype,"leave"),Fe.prototype),Ye(Fe.prototype,"publish",[F5],Object.getOwnPropertyDescriptor(Fe.prototype,"publish"),Fe.prototype),Ye(Fe.prototype,"unpublish",[B5],Object.getOwnPropertyDescriptor(Fe.prototype,"unpublish"),Fe.prototype),Ye(Fe.prototype,"subscribe",[W5],Object.getOwnPropertyDescriptor(Fe.prototype,"subscribe"),Fe.prototype),Ye(Fe.prototype,"presubscribe",[G5],Object.getOwnPropertyDescriptor(Fe.prototype,"presubscribe"),Fe.prototype),Ye(Fe.prototype,"massSubscribe",[H5],Object.getOwnPropertyDescriptor(Fe.prototype,"massSubscribe"),Fe.prototype),Ye(Fe.prototype,"unsubscribe",[K5],Object.getOwnPropertyDescriptor(Fe.prototype,"unsubscribe"),Fe.prototype),Ye(Fe.prototype,"massUnsubscribe",[z5],Object.getOwnPropertyDescriptor(Fe.prototype,"massUnsubscribe"),Fe.prototype),Ye(Fe.prototype,"setLowStreamParameter",[Y5],Object.getOwnPropertyDescriptor(Fe.prototype,"setLowStreamParameter"),Fe.prototype),Ye(Fe.prototype,"enableDualStream",[q5],Object.getOwnPropertyDescriptor(Fe.prototype,"enableDualStream"),Fe.prototype),Ye(Fe.prototype,"disableDualStream",[X5],Object.getOwnPropertyDescriptor(Fe.prototype,"disableDualStream"),Fe.prototype),Ye(Fe.prototype,"setClientRole",[J5],Object.getOwnPropertyDescriptor(Fe.prototype,"setClientRole"),Fe.prototype),Ye(Fe.prototype,"_setClientRoleOptions",[Q5],Object.getOwnPropertyDescriptor(Fe.prototype,"_setClientRoleOptions"),Fe.prototype),Ye(Fe.prototype,"setProxyServer",[Z5],Object.getOwnPropertyDescriptor(Fe.prototype,"setProxyServer"),Fe.prototype),Ye(Fe.prototype,"setTurnServer",[$5],Object.getOwnPropertyDescriptor(Fe.prototype,"setTurnServer"),Fe.prototype),Ye(Fe.prototype,"setLicense",[eV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLicense"),Fe.prototype),Ye(Fe.prototype,"startProxyServer",[tV],Object.getOwnPropertyDescriptor(Fe.prototype,"startProxyServer"),Fe.prototype),Ye(Fe.prototype,"stopProxyServer",[nV],Object.getOwnPropertyDescriptor(Fe.prototype,"stopProxyServer"),Fe.prototype),Ye(Fe.prototype,"setLocalAccessPointsV2",[rV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLocalAccessPointsV2"),Fe.prototype),Ye(Fe.prototype,"setLocalAccessPoints",[iV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLocalAccessPoints"),Fe.prototype),Ye(Fe.prototype,"setRemoteDefaultVideoStreamType",[sV],Object.getOwnPropertyDescriptor(Fe.prototype,"setRemoteDefaultVideoStreamType"),Fe.prototype),Ye(Fe.prototype,"setRemoteVideoStreamType",[oV],Object.getOwnPropertyDescriptor(Fe.prototype,"setRemoteVideoStreamType"),Fe.prototype),Ye(Fe.prototype,"setStreamFallbackOption",[aV],Object.getOwnPropertyDescriptor(Fe.prototype,"setStreamFallbackOption"),Fe.prototype),Ye(Fe.prototype,"setEncryptionConfig",[cV],Object.getOwnPropertyDescriptor(Fe.prototype,"setEncryptionConfig"),Fe.prototype),Ye(Fe.prototype,"renewToken",[lV],Object.getOwnPropertyDescriptor(Fe.prototype,"renewToken"),Fe.prototype),Ye(Fe.prototype,"enableAudioVolumeIndicator",[dV],Object.getOwnPropertyDescriptor(Fe.prototype,"enableAudioVolumeIndicator"),Fe.prototype),Ye(Fe.prototype,"startLiveStreaming",[uV],Object.getOwnPropertyDescriptor(Fe.prototype,"startLiveStreaming"),Fe.prototype),Ye(Fe.prototype,"setLiveTranscoding",[hV],Object.getOwnPropertyDescriptor(Fe.prototype,"setLiveTranscoding"),Fe.prototype),Ye(Fe.prototype,"stopLiveStreaming",[pV],Object.getOwnPropertyDescriptor(Fe.prototype,"stopLiveStreaming"),Fe.prototype),Ye(Fe.prototype,"startChannelMediaRelay",[fV],Object.getOwnPropertyDescriptor(Fe.prototype,"startChannelMediaRelay"),Fe.prototype),Ye(Fe.prototype,"updateChannelMediaRelay",[mV],Object.getOwnPropertyDescriptor(Fe.prototype,"updateChannelMediaRelay"),Fe.prototype),Ye(Fe.prototype,"stopChannelMediaRelay",[_V],Object.getOwnPropertyDescriptor(Fe.prototype,"stopChannelMediaRelay"),Fe.prototype),Ye(Fe.prototype,"sendCustomReportMessage",[gV],Object.getOwnPropertyDescriptor(Fe.prototype,"sendCustomReportMessage"),Fe.prototype),Ye(Fe.prototype,"pickSVCLayer",[EV],Object.getOwnPropertyDescriptor(Fe.prototype,"pickSVCLayer"),Fe.prototype),Ye(Fe.prototype,"setRTMConfig",[vV],Object.getOwnPropertyDescriptor(Fe.prototype,"setRTMConfig"),Fe.prototype),Ye(Fe.prototype,"enableContentInspect",[SV],Object.getOwnPropertyDescriptor(Fe.prototype,"enableContentInspect"),Fe.prototype),Ye(Fe.prototype,"disableContentInspect",[yV],Object.getOwnPropertyDescriptor(Fe.prototype,"disableContentInspect"),Fe.prototype),Ye(Fe.prototype,"setImageModeration",[TV],Object.getOwnPropertyDescriptor(Fe.prototype,"setImageModeration"),Fe.prototype),Ye(Fe.prototype,"setP2PTransport",[CV],Object.getOwnPropertyDescriptor(Fe.prototype,"setP2PTransport"),Fe.prototype),Ye(Fe.prototype,"getJoinChannelServiceRecords",[RV],Object.getOwnPropertyDescriptor(Fe.prototype,"getJoinChannelServiceRecords"),Fe.prototype),Ye(Fe.prototype,"setPublishAudioFilterEnabled",[wV],Object.getOwnPropertyDescriptor(Fe.prototype,"setPublishAudioFilterEnabled"),Fe.prototype),Fe);class Zg{constructor(t,n){x(this,"id",0),x(this,"element",void 0),x(this,"peerPair",void 0),x(this,"context",void 0),x(this,"audioPlayerElement",void 0),x(this,"audioTrack",void 0),Zg.count+=1,this.id=Zg.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new Ve(o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new ae(j.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new ae(j.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new ae(j.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var IV,CT;x(Zg,"count",0);const aY=window.AudioContext||window.webkitAudioContext,cY=new(IV=st({report:qe}),Ye((CT=class{constructor(){x(this,"units",[]),x(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new aY);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Zg(e,this.context),this.units.push(t)),t.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return xt().name!==Wt.SAFARI}}).prototype,"processExternalMediaAEC",[IV],Object.getOwnPropertyDescriptor(CT.prototype,"processExternalMediaAEC"),CT.prototype),CT);function AV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function OV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AV(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const pI=window||document;function NV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!pI)return;const n=Xn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(Xn.onSecurityPolicyViolation||Xn.getListeners(Tc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;W("CSP_DETECTED_HOSTNAME_LIST").some(o=>Oe(s).call(s,o))&&(Xn.onSecurityPolicyViolation&&typeof Xn.onSecurityPolicyViolation=="function"&&Xn.onSecurityPolicyViolation(i),Xn.getListeners(Tc.SECURITY_POLICY_VIOLATION).length>0&&Xn.safeEmit(Tc.SECURITY_POLICY_VIOLATION,i))};n&&pI.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Xn.getListeners(Tc.SECURITY_POLICY_VIOLATION).length>0)&&pI.addEventListener("securitypolicyviolation",r),Xn._cspEventHandlerPointer=r}var lY=q,dY=uk,PV=RegExp.prototype,uY=function(e){return e===PV||lY(PV,e)?dY(e):e.flags},si=S(uY);function qf(e){let t=e.length;for(;--t>=0;)e[t]=0}const fI=256,DV=286,$g=30,eE=15,mI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),RT=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),hY=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),kV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_l=new Array(576);qf(_l);const tE=new Array(60);qf(tE);const nE=new Array(512);qf(nE);const rE=new Array(256);qf(rE);const _I=new Array(29);qf(_I);const wT=new Array($g);function gI(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let LV,xV,MV;function EI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}qf(wT);const UV=e=>e<256?nE[e]:nE[256+(e>>>7)],iE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ds=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,iE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},wc=(e,t,n)=>{Ds(e,n[2*t],n[2*t+1])},VV=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},jV=(e,t,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=eE;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=t;s++){let c=e[2*s+1];c!==0&&(e[2*s]=VV(r[c]++,c))}},FV=e=>{let t;for(t=0;t<DV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<$g;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},BV=e=>{e.bi_valid>8?iE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},WV=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},vI=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&WV(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!WV(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},GV=(e,t,n)=>{let r,i,s,o,c=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+c++],r+=(255&e.pending_buf[e.sym_buf+c++])<<8,i=e.pending_buf[e.sym_buf+c++],r===0?wc(e,i,t):(s=rE[i],wc(e,s+fI+1,t),o=mI[s],o!==0&&(i-=_I[s],Ds(e,i,o)),r--,s=UV(r),wc(e,s,n),o=RT[s],o!==0&&(r-=wT[s],Ds(e,r,o)));while(c<e.sym_next);wc(e,256,t)},SI=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,c,l,p=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(e.heap[++e.heap_len]=p=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=p<2?++p:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=p,o=e.heap_len>>1;o>=1;o--)vI(e,n,o);l=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],vI(e,n,1),c=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=c,n[2*l]=n[2*o]+n[2*c],e.depth[l]=(e.depth[o]>=e.depth[c]?e.depth[o]:e.depth[c])+1,n[2*o+1]=n[2*c+1]=l,e.heap[1]=l++,vI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,E)=>{const v=E.dyn_tree,y=E.max_code,D=E.stat_desc.static_tree,A=E.stat_desc.has_stree,O=E.stat_desc.extra_bits,V=E.stat_desc.extra_base,U=E.stat_desc.max_length;let G,Z,Q,z,re,he,Ee=0;for(z=0;z<=eE;z++)m.bl_count[z]=0;for(v[2*m.heap[m.heap_max]+1]=0,G=m.heap_max+1;G<573;G++)Z=m.heap[G],z=v[2*v[2*Z+1]+1]+1,z>U&&(z=U,Ee++),v[2*Z+1]=z,Z>y||(m.bl_count[z]++,re=0,Z>=V&&(re=O[Z-V]),he=v[2*Z],m.opt_len+=he*(z+re),A&&(m.static_len+=he*(D[2*Z+1]+re)));if(Ee!==0){do{for(z=U-1;m.bl_count[z]===0;)z--;m.bl_count[z]--,m.bl_count[z+1]+=2,m.bl_count[U]--,Ee-=2}while(Ee>0);for(z=U;z!==0;z--)for(Z=m.bl_count[z];Z!==0;)Q=m.heap[--G],Q>y||(v[2*Q+1]!==z&&(m.opt_len+=(z-v[2*Q+1])*v[2*Q],v[2*Q+1]=z),Z--)}})(e,t),jV(n,p,e.bl_count)},HV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,p=4;for(o===0&&(l=138,p=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++c<l&&i===o||(c<p?e.bl_tree[2*i]+=c:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,s=i,o===0?(l=138,p=3):i===o?(l=6,p=3):(l=7,p=4))},KV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,p=4;for(o===0&&(l=138,p=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++c<l&&i===o)){if(c<p)do wc(e,i,e.bl_tree);while(--c!=0);else i!==0?(i!==s&&(wc(e,i,e.bl_tree),c--),wc(e,16,e.bl_tree),Ds(e,c-3,2)):c<=10?(wc(e,17,e.bl_tree),Ds(e,c-3,3)):(wc(e,18,e.bl_tree),Ds(e,c-11,7));c=0,s=i,o===0?(l=138,p=3):i===o?(l=6,p=3):(l=7,p=4)}};let zV=!1;const YV=(e,t,n,r)=>{Ds(e,0+(r?1:0),3),BV(e),iE(e,n),iE(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var pY=e=>{zV||((()=>{let t,n,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(_I[i]=r,t=0;t<1<<mI[i];t++)rE[r++]=i;for(rE[r-1]=i,s=0,i=0;i<16;i++)for(wT[i]=s,t=0;t<1<<RT[i];t++)nE[s++]=i;for(s>>=7;i<$g;i++)for(wT[i]=s<<7,t=0;t<1<<RT[i]-7;t++)nE[256+s++]=i;for(n=0;n<=eE;n++)o[n]=0;for(t=0;t<=143;)_l[2*t+1]=8,t++,o[8]++;for(;t<=255;)_l[2*t+1]=9,t++,o[9]++;for(;t<=279;)_l[2*t+1]=7,t++,o[7]++;for(;t<=287;)_l[2*t+1]=8,t++,o[8]++;for(jV(_l,287,o),t=0;t<$g;t++)tE[2*t+1]=5,tE[2*t]=VV(t,5);LV=new gI(_l,mI,257,DV,eE),xV=new gI(tE,RT,0,$g,eE),MV=new gI(new Array(0),hY,0,19,7)})(),zV=!0),e.l_desc=new EI(e.dyn_ltree,LV),e.d_desc=new EI(e.dyn_dtree,xV),e.bl_desc=new EI(e.bl_tree,MV),e.bi_buf=0,e.bi_valid=0,FV(e)},fY=(e,t,n,r)=>{let i,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(c=>{let l,p=4093624447;for(l=0;l<=31;l++,p>>>=1)if(1&p&&c.dyn_ltree[2*l]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(l=32;l<fI;l++)if(c.dyn_ltree[2*l]!==0)return 1;return 0})(e)),SI(e,e.l_desc),SI(e,e.d_desc),o=(c=>{let l;for(HV(c,c.dyn_ltree,c.l_desc.max_code),HV(c,c.dyn_dtree,c.d_desc.max_code),SI(c,c.bl_desc),l=18;l>=3&&c.bl_tree[2*kV[l]+1]===0;l--);return c.opt_len+=3*(l+1)+5+5+4,l})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&t!==-1?YV(e,t,n,r):e.strategy===4||s===i?(Ds(e,2+(r?1:0),3),GV(e,_l,tE)):(Ds(e,4+(r?1:0),3),((c,l,p,m)=>{let E;for(Ds(c,l-257,5),Ds(c,p-1,5),Ds(c,m-4,4),E=0;E<m;E++)Ds(c,c.bl_tree[2*kV[E]+1],3);KV(c,c.dyn_ltree,l-1),KV(c,c.dyn_dtree,p-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),GV(e,e.dyn_ltree,e.dyn_dtree)),FV(e),r&&BV(e)},mY=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(rE[n]+fI+1)]++,e.dyn_dtree[2*UV(t)]++),e.sym_next===e.sym_end),_Y=e=>{Ds(e,2,3),wc(e,256,_l),(t=>{t.bi_valid===16?(iE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},gY={_tr_init:pY,_tr_stored_block:YV,_tr_flush_block:fY,_tr_tally:mY,_tr_align:_Y},sE=(e,t,n,r)=>{let i=65535&e|0,s=e>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const EY=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var vi=(e,t,n,r)=>{const i=EY,s=r+n;e^=-1;for(let o=r;o<s;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},bh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},bT={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:vY,_tr_stored_block:yI,_tr_flush_block:SY,_tr_tally:xd,_tr_align:yY}=gY,{Z_NO_FLUSH:Md,Z_PARTIAL_FLUSH:TY,Z_FULL_FLUSH:CY,Z_FINISH:Ho,Z_BLOCK:qV,Z_OK:Di,Z_STREAM_END:XV,Z_STREAM_ERROR:bc,Z_DATA_ERROR:RY,Z_BUF_ERROR:TI,Z_DEFAULT_COMPRESSION:wY,Z_FILTERED:bY,Z_HUFFMAN_ONLY:IT,Z_RLE:IY,Z_FIXED:AY,Z_DEFAULT_STRATEGY:OY,Z_UNKNOWN:NY,Z_DEFLATED:AT}=bT,CI=286,PY=30,DY=19,kY=2*CI+1,LY=15,Ih=258,Ic=262,Xf=42,Ah=113,oE=666,Oh=(e,t)=>(e.msg=bh[t],t),JV=e=>2*e-(e>4?9:0),Ud=e=>{let t=e.length;for(;--t>=0;)e[t]=0},xY=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let Vd=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ro=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},io=(e,t)=>{SY(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ro(e.strm)},Mn=(e,t)=>{e.pending_buf[e.pending++]=t},aE=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},RI=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=sE(e.adler,t,i,n):e.state.wrap===2&&(e.adler=vi(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},QV=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,c=e.nice_match;const l=e.strstart>e.w_size-Ic?e.strstart-(e.w_size-Ic):0,p=e.window,m=e.w_mask,E=e.prev,v=e.strstart+Ih;let y=p[s+o-1],D=p[s+o];e.prev_length>=e.good_match&&(i>>=2),c>e.lookahead&&(c=e.lookahead);do if(n=t,p[n+o]===D&&p[n+o-1]===y&&p[n]===p[s]&&p[++n]===p[s+1]){s+=2,n++;do;while(p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&s<v);if(r=Ih-(v-s),s=v-Ih,r>o){if(e.match_start=t,o=r,r>=c)break;y=p[s+o-1],D=p[s+o]}}while((t=E[t&m])>l&&--i!=0);return o<=e.lookahead?o:e.lookahead},Jf=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ic)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),xY(e),r+=t),e.strm.avail_in===0)break;if(n=RI(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Vd(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Vd(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ic&&e.strm.avail_in!==0)},ZV=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,c=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&t!==Ho||t===Md||n!==r+e.strm.avail_in)))break;o=t===Ho&&n===r+e.strm.avail_in?1:0,yI(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ro(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(RI(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return c-=e.strm.avail_in,c&&(c>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=c&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-c,e.strm.next_in),e.strstart),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Md&&t!==Ho&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(RI(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===Ho)&&t!==Md&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,o=t===Ho&&e.strm.avail_in===0&&n===r?1:0,yI(e,e.block_start,n,o),e.block_start+=n,ro(e.strm)),o?3:1)},wI=(e,t)=>{let n,r;for(;;){if(e.lookahead<Ic){if(Jf(e),e.lookahead<Ic&&t===Md)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Ic&&(e.match_length=QV(e,n)),e.match_length>=3)if(r=xd(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+1]);else r=xd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(io(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ho?(io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(io(e,!1),e.strm.avail_out===0)?1:2},Qf=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Ic){if(Jf(e),e.lookahead<Ic&&t===Md)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ic&&(e.match_length=QV(e,n),e.match_length<=5&&(e.strategy===bY||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=xd(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(io(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=xd(e,0,e.window[e.strstart-1]),r&&io(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=xd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ho?(io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(io(e,!1),e.strm.avail_out===0)?1:2};function Ac(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const cE=[new Ac(0,0,0,0,ZV),new Ac(4,4,8,4,wI),new Ac(4,5,16,8,wI),new Ac(4,6,32,32,wI),new Ac(4,4,16,16,Qf),new Ac(8,16,32,32,Qf),new Ac(8,16,128,128,Qf),new Ac(8,32,128,256,Qf),new Ac(32,128,258,1024,Qf),new Ac(32,258,258,4096,Qf)];function MY(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=AT,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*kY),this.dyn_dtree=new Uint16Array(2*(2*PY+1)),this.bl_tree=new Uint16Array(2*(2*DY+1)),Ud(this.dyn_ltree),Ud(this.dyn_dtree),Ud(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(LY+1),this.heap=new Uint16Array(2*CI+1),Ud(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*CI+1),Ud(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const lE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Xf&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Ah&&t.status!==oE?1:0},$V=e=>{if(lE(e))return Oh(e,bc);e.total_in=e.total_out=0,e.data_type=NY;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Xf:Ah,e.adler=t.wrap===2?0:1,t.last_flush=-2,vY(t),Di},e6=e=>{const t=$V(e);return t===Di&&(n=>{n.window_size=2*n.w_size,Ud(n.head),n.max_lazy_match=cE[n.level].max_lazy,n.good_match=cE[n.level].good_length,n.nice_match=cE[n.level].nice_length,n.max_chain_length=cE[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},t6=(e,t,n,r,i,s)=>{if(!e)return bc;let o=1;if(t===wY&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==AT||r<8||r>15||t<0||t>9||s<0||s>AY||r===8&&o!==1)return Oh(e,bc);r===8&&(r=9);const c=new MY;return e.state=c,c.strm=e,c.status=Xf,c.wrap=o,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=s,c.method=n,e6(e)};var UY=(e,t)=>{if(lE(e)||t>qV||t<0)return e?Oh(e,bc):bc;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===oE&&t!==Ho)return Oh(e,e.avail_out===0?TI:bc);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ro(e),e.avail_out===0)return n.last_flush=-1,Di}else if(e.avail_in===0&&JV(t)<=JV(r)&&t!==Ho)return Oh(e,TI);if(n.status===oE&&e.avail_in!==0)return Oh(e,TI);if(n.status===Xf&&n.wrap===0&&(n.status=Ah),n.status===Xf){let i=AT+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=IT||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,aE(n,i),n.strstart!==0&&(aE(n,e.adler>>>16),aE(n,65535&e.adler)),e.adler=1,n.status=Ah,ro(e),n.pending!==0)return n.last_flush=-1,Di}if(n.status===57){if(e.adler=0,Mn(n,31),Mn(n,139),Mn(n,8),n.gzhead)Mn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Mn(n,255&n.gzhead.time),Mn(n,n.gzhead.time>>8&255),Mn(n,n.gzhead.time>>16&255),Mn(n,n.gzhead.time>>24&255),Mn(n,n.level===9?2:n.strategy>=IT||n.level<2?4:0),Mn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Mn(n,255&n.gzhead.extra.length),Mn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=vi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,n.level===9?2:n.strategy>=IT||n.level<2?4:0),Mn(n,3),n.status=Ah,ro(e),n.pending!==0)return n.last_flush=-1,Di}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let c=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=vi(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=c,ro(e),n.pending!==0)return n.last_flush=-1,Di;i=0,s-=c}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(e.adler=vi(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=vi(e.adler,n.pending_buf,n.pending-s,s)),ro(e),n.pending!==0)return n.last_flush=-1,Di;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Mn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=vi(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=vi(e.adler,n.pending_buf,n.pending-s,s)),ro(e),n.pending!==0)return n.last_flush=-1,Di;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Mn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=vi(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ro(e),n.pending!==0))return n.last_flush=-1,Di;Mn(n,255&e.adler),Mn(n,e.adler>>8&255),e.adler=0}if(n.status=Ah,ro(e),n.pending!==0)return n.last_flush=-1,Di}if(e.avail_in!==0||n.lookahead!==0||t!==Md&&n.status!==oE){let i=n.level===0?ZV(n,t):n.strategy===IT?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(Jf(s),s.lookahead===0)){if(o===Md)return 1;break}if(s.match_length=0,c=xd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Ho?(io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(io(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===IY?((s,o)=>{let c,l,p,m;const E=s.window;for(;;){if(s.lookahead<=Ih){if(Jf(s),s.lookahead<=Ih&&o===Md)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(p=s.strstart-1,l=E[p],l===E[++p]&&l===E[++p]&&l===E[++p])){m=s.strstart+Ih;do;while(l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&p<m);s.match_length=Ih-(m-p),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=xd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=xd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Ho?(io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(io(s,!1),s.strm.avail_out===0)?1:2})(n,t):cE[n.level].func(n,t);if(i!==3&&i!==4||(n.status=oE),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),Di;if(i===2&&(t===TY?yY(n):t!==qV&&(yI(n,0,0,!1),t===CY&&(Ud(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ro(e),e.avail_out===0))return n.last_flush=-1,Di}return t!==Ho?Di:n.wrap<=0?XV:(n.wrap===2?(Mn(n,255&e.adler),Mn(n,e.adler>>8&255),Mn(n,e.adler>>16&255),Mn(n,e.adler>>24&255),Mn(n,255&e.total_in),Mn(n,e.total_in>>8&255),Mn(n,e.total_in>>16&255),Mn(n,e.total_in>>24&255)):(aE(n,e.adler>>>16),aE(n,65535&e.adler)),ro(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Di:XV)},VY=(e,t)=>{let n=t.length;if(lE(e))return bc;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==Xf||r.lookahead)return bc;if(i===1&&(e.adler=sE(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Ud(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(t.subarray(n-r.w_size,n),0),t=l,n=r.w_size}const s=e.avail_in,o=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Jf(r);r.lookahead>=3;){let l=r.strstart,p=r.lookahead-2;do r.ins_h=Vd(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--p);r.strstart=l,r.lookahead=2,Jf(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=c,e.avail_in=s,r.wrap=i,Di},dE={deflateInit:(e,t)=>t6(e,t,AT,15,8,OY),deflateInit2:t6,deflateReset:e6,deflateResetKeep:$V,deflateSetHeader:(e,t)=>lE(e)||e.state.wrap!==2?bc:(e.state.gzhead=t,Di),deflate:UY,deflateEnd:e=>{if(lE(e))return bc;const t=e.state.status;return e.state=null,t===Ah?Oh(e,RY):Di},deflateSetDictionary:VY,deflateInfo:"pako deflate (from Nodeca project)"};const jY=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var OT={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)jY(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let o=e[r];n.set(o,i),i+=o.length}return n}};let n6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n6=!1}const uE=new Uint8Array(256);for(let e=0;e<256;e++)uE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;uE[254]=uE[254]=1;var hE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,s,o=e.length,c=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(c),s=0,i=0;s<c;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let o=e[r++];if(o<128){s[i++]=o;continue}let c=uE[o];if(c>4)s[i++]=65533,r+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&r<n;)o=o<<6|63&e[r++],c--;c>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&n6)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let l="";for(let p=0;p<c;p++)l+=String.fromCharCode(o[p]);return l})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+uE[e[n]]>t?n:t}},r6=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const i6=Object.prototype.toString,{Z_NO_FLUSH:FY,Z_SYNC_FLUSH:BY,Z_FULL_FLUSH:WY,Z_FINISH:GY,Z_OK:NT,Z_STREAM_END:HY,Z_DEFAULT_COMPRESSION:KY,Z_DEFAULT_STRATEGY:zY,Z_DEFLATED:YY}=bT;function PT(e){this.options=OT.assign({level:KY,method:YY,chunkSize:16384,windowBits:15,memLevel:8,strategy:zY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r6,this.strm.avail_out=0;let n=dE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==NT)throw new Error(bh[n]);if(t.header&&dE.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?hE.string2buf(t.dictionary):i6.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=dE.deflateSetDictionary(this.strm,r),n!==NT)throw new Error(bh[n]);this._dict_set=!0}}function qY(e,t){const n=new PT(t);if(n.push(e,!0),n.err)throw n.msg||bh[n.err];return n.result}PT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?GY:FY,typeof e=="string"?n.input=hE.string2buf(e):i6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===BY||s===WY)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=dE.deflate(n,s),i===HY)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=dE.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===NT;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},PT.prototype.onData=function(e){this.chunks.push(e)},PT.prototype.onEnd=function(e){e===NT&&(this.result=OT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var XY={deflate:qY};const DT=16209;var JY=function(e,t){let n,r,i,s,o,c,l,p,m,E,v,y,D,A,O,V,U,G,Z,Q,z,re,he,Ee;const Re=e.state;n=e.next_in,he=e.input,r=n+(e.avail_in-5),i=e.next_out,Ee=e.output,s=i-(t-e.avail_out),o=i+(e.avail_out-257),c=Re.dmax,l=Re.wsize,p=Re.whave,m=Re.wnext,E=Re.window,v=Re.hold,y=Re.bits,D=Re.lencode,A=Re.distcode,O=(1<<Re.lenbits)-1,V=(1<<Re.distbits)-1;e:do{y<15&&(v+=he[n++]<<y,y+=8,v+=he[n++]<<y,y+=8),U=D[v&O];t:for(;;){if(G=U>>>24,v>>>=G,y-=G,G=U>>>16&255,G===0)Ee[i++]=65535&U;else{if(!(16&G)){if((64&G)==0){U=D[(65535&U)+(v&(1<<G)-1)];continue t}if(32&G){Re.mode=16191;break e}e.msg="invalid literal/length code",Re.mode=DT;break e}Z=65535&U,G&=15,G&&(y<G&&(v+=he[n++]<<y,y+=8),Z+=v&(1<<G)-1,v>>>=G,y-=G),y<15&&(v+=he[n++]<<y,y+=8,v+=he[n++]<<y,y+=8),U=A[v&V];n:for(;;){if(G=U>>>24,v>>>=G,y-=G,G=U>>>16&255,!(16&G)){if((64&G)==0){U=A[(65535&U)+(v&(1<<G)-1)];continue n}e.msg="invalid distance code",Re.mode=DT;break e}if(Q=65535&U,G&=15,y<G&&(v+=he[n++]<<y,y+=8,y<G&&(v+=he[n++]<<y,y+=8)),Q+=v&(1<<G)-1,Q>c){e.msg="invalid distance too far back",Re.mode=DT;break e}if(v>>>=G,y-=G,G=i-s,Q>G){if(G=Q-G,G>p&&Re.sane){e.msg="invalid distance too far back",Re.mode=DT;break e}if(z=0,re=E,m===0){if(z+=l-G,G<Z){Z-=G;do Ee[i++]=E[z++];while(--G);z=i-Q,re=Ee}}else if(m<G){if(z+=l+m-G,G-=m,G<Z){Z-=G;do Ee[i++]=E[z++];while(--G);if(z=0,m<Z){G=m,Z-=G;do Ee[i++]=E[z++];while(--G);z=i-Q,re=Ee}}}else if(z+=m-G,G<Z){Z-=G;do Ee[i++]=E[z++];while(--G);z=i-Q,re=Ee}for(;Z>2;)Ee[i++]=re[z++],Ee[i++]=re[z++],Ee[i++]=re[z++],Z-=3;Z&&(Ee[i++]=re[z++],Z>1&&(Ee[i++]=re[z++]))}else{z=i-Q;do Ee[i++]=Ee[z++],Ee[i++]=Ee[z++],Ee[i++]=Ee[z++],Z-=3;while(Z>2);Z&&(Ee[i++]=Ee[z++],Z>1&&(Ee[i++]=Ee[z++]))}break}}break}}while(n<r&&i<o);Z=y>>3,n-=Z,y-=Z<<3,v&=(1<<y)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),Re.hold=v,Re.bits=y};const kT=15,QY=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ZY=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$Y=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),eq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pE=(e,t,n,r,i,s,o,c)=>{const l=c.bits;let p,m,E,v,y,D,A=0,O=0,V=0,U=0,G=0,Z=0,Q=0,z=0,re=0,he=0,Ee=null;const Re=new Uint16Array(16),Ct=new Uint16Array(16);let bt,ut,Yt,Ht=null;for(A=0;A<=kT;A++)Re[A]=0;for(O=0;O<r;O++)Re[t[n+O]]++;for(G=l,U=kT;U>=1&&Re[U]===0;U--);if(G>U&&(G=U),U===0)return i[s++]=20971520,i[s++]=20971520,c.bits=1,0;for(V=1;V<U&&Re[V]===0;V++);for(G<V&&(G=V),z=1,A=1;A<=kT;A++)if(z<<=1,z-=Re[A],z<0)return-1;if(z>0&&(e===0||U!==1))return-1;for(Ct[1]=0,A=1;A<kT;A++)Ct[A+1]=Ct[A]+Re[A];for(O=0;O<r;O++)t[n+O]!==0&&(o[Ct[t[n+O]]++]=O);if(e===0?(Ee=Ht=o,D=20):e===1?(Ee=QY,Ht=ZY,D=257):(Ee=$Y,Ht=eq,D=0),he=0,O=0,A=V,y=s,Z=G,Q=0,E=-1,re=1<<G,v=re-1,e===1&&re>852||e===2&&re>592)return 1;for(;;){bt=A-Q,o[O]+1<D?(ut=0,Yt=o[O]):o[O]>=D?(ut=Ht[o[O]-D],Yt=Ee[o[O]-D]):(ut=96,Yt=0),p=1<<A-Q,m=1<<Z,V=m;do m-=p,i[y+(he>>Q)+m]=bt<<24|ut<<16|Yt|0;while(m!==0);for(p=1<<A-1;he&p;)p>>=1;if(p!==0?(he&=p-1,he+=p):he=0,O++,--Re[A]==0){if(A===U)break;A=t[n+o[O]]}if(A>G&&(he&v)!==E){for(Q===0&&(Q=G),y+=V,Z=A-Q,z=1<<Z;Z+Q<U&&(z-=Re[Z+Q],!(z<=0));)Z++,z<<=1;if(re+=1<<Z,e===1&&re>852||e===2&&re>592)return 1;E=he&v,i[E]=G<<24|Z<<16|y-s|0}}return he!==0&&(i[y+he]=A-Q<<24|64<<16|0),c.bits=G,0};const{Z_FINISH:s6,Z_BLOCK:tq,Z_TREES:LT,Z_OK:Nh,Z_STREAM_END:nq,Z_NEED_DICT:rq,Z_STREAM_ERROR:Ko,Z_DATA_ERROR:o6,Z_MEM_ERROR:a6,Z_BUF_ERROR:iq,Z_DEFLATED:c6}=bT,xT=16180,MT=16190,gl=16191,bI=16192,II=16194,UT=16199,VT=16200,AI=16206,Er=16209,l6=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function sq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ph=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<xT||t.mode>16211?1:0},d6=e=>{if(Ph(e))return Ko;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=xT,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Nh},u6=e=>{if(Ph(e))return Ko;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,d6(e)},h6=(e,t)=>{let n;if(Ph(e))return Ko;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ko:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,u6(e))},p6=(e,t)=>{if(!e)return Ko;const n=new sq;e.state=n,n.strm=e,n.window=null,n.mode=xT;const r=h6(e,t);return r!==Nh&&(e.state=null),r};let OI,NI,f6=!0;const oq=e=>{if(f6){OI=new Int32Array(512),NI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pE(1,e.lens,0,288,OI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pE(2,e.lens,0,32,NI,0,e.work,{bits:5}),f6=!1}e.lencode=OI,e.lenbits=9,e.distcode=NI,e.distbits=5},m6=(e,t,n,r)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var aq=(e,t)=>{let n,r,i,s,o,c,l,p,m,E,v,y,D,A,O,V,U,G,Z,Q,z,re,he=0;const Ee=new Uint8Array(4);let Re,Ct;const bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ph(e)||!e.output||!e.input&&e.avail_in!==0)return Ko;n=e.state,n.mode===gl&&(n.mode=bI),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,p=n.hold,m=n.bits,E=c,v=l,re=Nh;e:for(;;)switch(n.mode){case xT:if(n.wrap===0){n.mode=bI;break}for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,Ee[0]=255&p,Ee[1]=p>>>8&255,n.check=vi(n.check,Ee,2,0),p=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){e.msg="incorrect header check",n.mode=Er;break}if((15&p)!==c6){e.msg="unknown compression method",n.mode=Er;break}if(p>>>=4,m-=4,z=8+(15&p),n.wbits===0&&(n.wbits=z),z>15||z>n.wbits){e.msg="invalid window size",n.mode=Er;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&p?16189:gl,p=0,m=0;break;case 16181:for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(n.flags=p,(255&si(n))!==c6){e.msg="unknown compression method",n.mode=Er;break}if(57344&si(n)){e.msg="unknown header flags set",n.mode=Er;break}n.head&&(n.head.text=p>>8&1),512&si(n)&&4&n.wrap&&(Ee[0]=255&p,Ee[1]=p>>>8&255,n.check=vi(n.check,Ee,2,0)),p=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.head&&(n.head.time=p),512&si(n)&&4&n.wrap&&(Ee[0]=255&p,Ee[1]=p>>>8&255,Ee[2]=p>>>16&255,Ee[3]=p>>>24&255,n.check=vi(n.check,Ee,4,0)),p=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&si(n)&&4&n.wrap&&(Ee[0]=255&p,Ee[1]=p>>>8&255,n.check=vi(n.check,Ee,2,0)),p=0,m=0,n.mode=16184;case 16184:if(1024&si(n)){for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.length=p,n.head&&(n.head.extra_len=p),512&si(n)&&4&n.wrap&&(Ee[0]=255&p,Ee[1]=p>>>8&255,n.check=vi(n.check,Ee,2,0)),p=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&si(n)&&(y=n.length,y>c&&(y=c),y&&(n.head&&(z=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+y),z)),512&si(n)&&4&n.wrap&&(n.check=vi(n.check,r,y,s)),c-=y,s+=y,n.length-=y),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&si(n)){if(c===0)break e;y=0;do z=r[s+y++],n.head&&z&&n.length<65536&&(n.head.name+=String.fromCharCode(z));while(z&&y<c);if(512&si(n)&&4&n.wrap&&(n.check=vi(n.check,r,y,s)),c-=y,s+=y,z)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&si(n)){if(c===0)break e;y=0;do z=r[s+y++],n.head&&z&&n.length<65536&&(n.head.comment+=String.fromCharCode(z));while(z&&y<c);if(512&si(n)&&4&n.wrap&&(n.check=vi(n.check,r,y,s)),c-=y,s+=y,z)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&si(n)){for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(4&n.wrap&&p!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Er;break}p=0,m=0}n.head&&(n.head.hcrc=si(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=gl;break;case 16189:for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}e.adler=n.check=l6(p),p=0,m=0,n.mode=MT;case MT:if(n.havedict===0)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,rq;e.adler=n.check=1,n.mode=gl;case gl:if(t===tq||t===LT)break e;case bI:if(n.last){p>>>=7&m,m-=7&m,n.mode=AI;break}for(;m<3;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}switch(n.last=1&p,p>>>=1,m-=1,3&p){case 0:n.mode=16193;break;case 1:if(oq(n),n.mode=UT,t===LT){p>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Er}p>>>=2,m-=2;break;case 16193:for(p>>>=7&m,m-=7&m;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if((65535&p)!=(p>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Er;break}if(n.length=65535&p,p=0,m=0,n.mode=II,t===LT)break e;case II:n.mode=16195;case 16195:if(y=n.length,y){if(y>c&&(y=c),y>l&&(y=l),y===0)break e;i.set(r.subarray(s,s+y),o),c-=y,s+=y,l-=y,o+=y,n.length-=y;break}n.mode=gl;break;case 16196:for(;m<14;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(n.nlen=257+(31&p),p>>>=5,m-=5,n.ndist=1+(31&p),p>>>=5,m-=5,n.ncode=4+(15&p),p>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Er;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.lens[bt[n.have++]]=7&p,p>>>=3,m-=3}for(;n.have<19;)n.lens[bt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Re={bits:n.lenbits},re=pE(0,n.lens,0,19,n.lencode,0,n.work,Re),n.lenbits=Re.bits,re){e.msg="invalid code lengths set",n.mode=Er;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;he=n.lencode[p&(1<<n.lenbits)-1],O=he>>>24,V=he>>>16&255,U=65535&he,!(O<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(U<16)p>>>=O,m-=O,n.lens[n.have++]=U;else{if(U===16){for(Ct=O+2;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(p>>>=O,m-=O,n.have===0){e.msg="invalid bit length repeat",n.mode=Er;break}z=n.lens[n.have-1],y=3+(3&p),p>>>=2,m-=2}else if(U===17){for(Ct=O+3;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=O,m-=O,z=0,y=3+(7&p),p>>>=3,m-=3}else{for(Ct=O+7;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=O,m-=O,z=0,y=11+(127&p),p>>>=7,m-=7}if(n.have+y>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Er;break}for(;y--;)n.lens[n.have++]=z}}if(n.mode===Er)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Er;break}if(n.lenbits=9,Re={bits:n.lenbits},re=pE(1,n.lens,0,n.nlen,n.lencode,0,n.work,Re),n.lenbits=Re.bits,re){e.msg="invalid literal/lengths set",n.mode=Er;break}if(n.distbits=6,n.distcode=n.distdyn,Re={bits:n.distbits},re=pE(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Re),n.distbits=Re.bits,re){e.msg="invalid distances set",n.mode=Er;break}if(n.mode=UT,t===LT)break e;case UT:n.mode=VT;case VT:if(c>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,JY(e,v),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,p=n.hold,m=n.bits,n.mode===gl&&(n.back=-1);break}for(n.back=0;he=n.lencode[p&(1<<n.lenbits)-1],O=he>>>24,V=he>>>16&255,U=65535&he,!(O<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(V&&(240&V)==0){for(G=O,Z=V,Q=U;he=n.lencode[Q+((p&(1<<G+Z)-1)>>G)],O=he>>>24,V=he>>>16&255,U=65535&he,!(G+O<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=O,m-=O,n.back+=O,n.length=U,V===0){n.mode=16205;break}if(32&V){n.back=-1,n.mode=gl;break}if(64&V){e.msg="invalid literal/length code",n.mode=Er;break}n.extra=15&V,n.mode=16201;case 16201:if(n.extra){for(Ct=n.extra;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;he=n.distcode[p&(1<<n.distbits)-1],O=he>>>24,V=he>>>16&255,U=65535&he,!(O<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if((240&V)==0){for(G=O,Z=V,Q=U;he=n.distcode[Q+((p&(1<<G+Z)-1)>>G)],O=he>>>24,V=he>>>16&255,U=65535&he,!(G+O<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=O,m-=O,n.back+=O,64&V){e.msg="invalid distance code",n.mode=Er;break}n.offset=U,n.extra=15&V,n.mode=16203;case 16203:if(n.extra){for(Ct=n.extra;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Er;break}n.mode=16204;case 16204:if(l===0)break e;if(y=v-l,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Er;break}y>n.wnext?(y-=n.wnext,D=n.wsize-y):D=n.wnext-y,y>n.length&&(y=n.length),A=n.window}else A=i,D=o-n.offset,y=n.length;y>l&&(y=l),l-=y,n.length-=y;do i[o++]=A[D++];while(--y);n.length===0&&(n.mode=VT);break;case 16205:if(l===0)break e;i[o++]=n.length,l--,n.mode=VT;break;case AI:if(n.wrap){for(;m<32;){if(c===0)break e;c--,p|=r[s++]<<m,m+=8}if(v-=l,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=si(n)?vi(n.check,i,v,o-v):sE(n.check,i,v,o-v)),v=l,4&n.wrap&&(si(n)?p:l6(p))!==n.check){e.msg="incorrect data check",n.mode=Er;break}p=0,m=0}n.mode=16207;case 16207:if(n.wrap&&si(n)){for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(4&n.wrap&&p!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Er;break}p=0,m=0}n.mode=16208;case 16208:re=nq;break e;case Er:re=o6;break e;case 16210:return a6;default:return Ko}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,(n.wsize||v!==e.avail_out&&n.mode<Er&&(n.mode<AI||t!==s6))&&m6(e,e.output,e.next_out,v-e.avail_out),E-=e.avail_in,v-=e.avail_out,e.total_in+=E,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=si(n)?vi(n.check,i,v,e.next_out-v):sE(n.check,i,v,e.next_out-v)),e.data_type=n.bits+(n.last?64:0)+(n.mode===gl?128:0)+(n.mode===UT||n.mode===II?256:0),(E===0&&v===0||t===s6)&&re===Nh&&(re=iq),re},El={inflateReset:u6,inflateReset2:h6,inflateResetKeep:d6,inflateInit:e=>p6(e,15),inflateInit2:p6,inflate:aq,inflateEnd:e=>{if(Ph(e))return Ko;let t=e.state;return t.window&&(t.window=null),e.state=null,Nh},inflateGetHeader:(e,t)=>{if(Ph(e))return Ko;const n=e.state;return(2&n.wrap)==0?Ko:(n.head=t,t.done=!1,Nh)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return Ph(e)?Ko:(r=e.state,r.wrap!==0&&r.mode!==MT?Ko:r.mode===MT&&(i=1,i=sE(i,t,n,0),i!==r.check)?o6:(s=m6(e,t,n,n),s?(r.mode=16210,a6):(r.havedict=1,Nh)))},inflateInfo:"pako inflate (from Nodeca project)"},cq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const _6=Object.prototype.toString,{Z_NO_FLUSH:lq,Z_FINISH:dq,Z_OK:fE,Z_STREAM_END:PI,Z_NEED_DICT:DI,Z_STREAM_ERROR:uq,Z_DATA_ERROR:g6,Z_MEM_ERROR:hq}=bT;function jT(e){this.options=OT.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r6,this.strm.avail_out=0;let n=El.inflateInit2(this.strm,t.windowBits);if(n!==fE)throw new Error(bh[n]);if(this.header=new cq,El.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=hE.string2buf(t.dictionary):_6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=El.inflateSetDictionary(this.strm,t.dictionary),n!==fE)))throw new Error(bh[n])}function pq(e,t){const n=new jT(t);if(n.push(e),n.err)throw n.msg||bh[n.err];return n.result}jT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,c;if(this.ended)return!1;for(o=t===~~t?t:t===!0?dq:lq,_6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=El.inflate(n,o),s===DI&&i&&(s=El.inflateSetDictionary(n,i),s===fE?s=El.inflate(n,o):s===g6&&(s=DI));n.avail_in>0&&s===PI&&n.state.wrap>0&&e[n.next_in]!==0;)El.inflateReset(n),s=El.inflate(n,o);switch(s){case uq:case g6:case DI:case hq:return this.onEnd(s),this.ended=!0,!1}if(c=n.avail_out,n.next_out&&(n.avail_out===0||s===PI))if(this.options.to==="string"){let l=hE.utf8border(n.output,n.next_out),p=n.next_out-l,m=hE.buf2string(n.output,l);n.next_out=p,n.avail_out=r-p,p&&n.output.set(n.output.subarray(l,l+p),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==fE||c!==0){if(s===PI)return s=El.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},jT.prototype.onData=function(e){this.chunks.push(e)},jT.prototype.onEnd=function(e){e===fE&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=OT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var fq={inflate:pq};const{deflate:mq}=XY,{inflate:_q}=fq;var gq=mq,Eq=_q,E6=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(E6||{});class vq{constructor(){x(this,"_sequence",0),x(this,"_startTime",Date.now()),x(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const l={id:0,length:4,data:c.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;W("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const c=this.serializeExtension(n.extension);i.set(new Uint8Array(c),o),o+=c.byteLength}if(i.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let o,c;if(r+=4,W("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){c=this.deserializeExtension(t.slice(r)),r+=2+c.length,o=t.slice(r);let l=!1;if(c.datas.length>0){const p=c.datas.find(m=>m.id===0);p&&(l=(1&new DataView(p.data).getUint32(0,!0))==1)}o=l?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:n,length:r,datas:i}=t,s=new ArrayBuffer(r+2),o=new Uint8Array(s),c=new DataView(s);let l=0;if(c.setUint8(l++,n),c.setUint8(l++,r),i.forEach(p=>{n?(c.setUint8(l++,p.id),c.setUint8(l++,p.length),o.set(new Uint8Array(p.data),l),l+=p.data.byteLength):(c.setUint8(l++,p.id|p.length<<4),o.set(new Uint8Array(p.data),l),l+=p.data.byteLength)}),l!==r+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(r+2));return s}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const o=i===E6.TWO_BYTE,c=[],l=new DataView(t,2);let p=0;for(;p<s;){let m=0,E=0,v=new ArrayBuffer(0);o?(m=l.getUint8(p),p++,E=l.getUint8(p),p++):(m=15&l.getUint8(p),E=l.getUint8(p)>>4,p++),E>0&&(v=l.buffer.slice(p+2,p+2+E),p+=v.byteLength),c.push({id:m,length:E,data:v})}if(p!==s)throw Error("parse error");return{profile:i,length:s,datas:c}}decompress(t){return Eq(new Uint8Array(t))}compress(t){return gq(new Uint8Array(t))}}const Sq={name:"DataStream",create:(e,t)=>{const n=t?new AK(e):new OK(e);return n.useDataStream(new vq),n}};class yq extends bn{constructor(t,n,r){super(),x(this,"ws",void 0),x(this,"requestId",1),x(this,"heartBeatTimer",void 0),x(this,"joinInfo",void 0),x(this,"clientId",void 0),x(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),x(this,"onClose",i=>{this.emit("close"),this.dispose()}),x(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=n,this.ws=new Fg("cross-channel-".concat(this.clientId),r),this.ws.on(vt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(vt.CONNECTED,this.onOpen),this.ws.on(vt.ON_MESSAGE,this.onMessage),this.ws.on(vt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Ve((n,r)=>{const i=window.setTimeout(()=>{r(new ae(j.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new ae(j.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new ae(j.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ae(j.WS_DISCONNECT);const n=()=>new Ve((o,c)=>{this.ws.once(vt.CLOSED,()=>c(new ae(j.WS_ABORT))),this.ws.once(vt.CONNECTED,o)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new Ve((o,c)=>{const l=()=>{c(new ae(j.WS_ABORT))};this.ws.once(vt.RECONNECTING,l),this.ws.once(vt.CLOSED,l),this.once("req_".concat(r),o),Rr(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(vt.RECONNECTING,l),this.ws.off(vt.CLOSED,l),c(new ae(j.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new ae(j.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(vt.REQUEST_NEW_URLS),this.ws.on(vt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Tq extends bn{set state(t){t!==this._state&&(t!==Ki.RELAY_STATE_FAILURE&&(this.errorCode=xf.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,s){super(),x(this,"joinInfo",void 0),x(this,"sid",void 0),x(this,"clientId",void 0),x(this,"cancelToken",Ai.CancelToken.source()),x(this,"workerToken",void 0),x(this,"requestId",0),x(this,"signal",void 0),x(this,"prevChannelMediaConfig",void 0),x(this,"httpRetryConfig",void 0),x(this,"_resolution",void 0),x(this,"_state",Ki.RELAY_STATE_IDLE),x(this,"errorCode",xf.RELAY_OK),x(this,"onStatus",o=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",hl.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",hl.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=xf.SRC_TOKEN_EXPIRED,this.state=Ki.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=xf.DEST_TOKEN_EXPIRED,this.state=Ki.RELAY_STATE_FAILURE))}),x(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",hl.NETWORK_DISCONNECTED),this.state=Ki.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==Ki.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",o.toString()),this.errorCode=xf.SERVER_CONNECTION_LOST,this.state=Ki.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=hh(),this.signal=new yq(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==Ki.RELAY_STATE_IDLE)throw new ae(j.INVALID_OPERATION);this.state=Ki.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new ae(j.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new ae(j.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new ae(j.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ki.RELAY_STATE_RUNNING)throw new ae(j.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ki.RELAY_STATE_RUNNING)throw new ae(j.INVALID_OPERATION);const n=this.genMessage(Ei.SetVideoProfile);await this.signal.request(n),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ki.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ai.CancelToken.source(),this.state=Ki.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Lz(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",hl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Ei.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(Ei.SetSdkProfile,t);await this.signal.request(r),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Ei.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",hl.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(Ei.SetSourceUserId,t);await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(Ei.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",hl.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(Ei.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",hl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ki.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Ei.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",hl.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ei.StopPacketTransfer);await this.signal.request(t),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Qs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.24.0"&&(o.sdkVersion="0.0.1");let c=null,l=null;switch(t){case Ei.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Ei.SetSourceChannel:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new ae(j.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},o;case Ei.SetSourceUserId:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new ae(j.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:l.uid+""},o;case Ei.SetDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new ae(j.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},o;case Ei.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Ei.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Ei.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Ei.UpdateDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new ae(j.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},o;case Ei.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const Cq={name:"ChannelMediaRelay",create:function(e){return new Tq(e.joinInfo,e.clientId,e.websocketRetryConfig||qn,e.httpRetryConfig||qn,e.resolution)}};function v6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function mE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Rq extends bn{constructor(t,n,r,i){super(),x(this,"spec",void 0),x(this,"token",void 0),x(this,"websocket",void 0),x(this,"pingpongTimer",void 0),x(this,"reconnectMode","retry"),x(this,"serviceMode",void 0),x(this,"reqId",0),x(this,"commandReqId",0),x(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),x(this,"handleWebSocketMessage",s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(qe.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===ul.TRANSCODE?1:2}),this.emit(Cd.PUBLISH_STREAM_STATUS,o))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new Fg("live-streaming",r),this.websocket.on(vt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(vt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(vt.REQUEST_NEW_URLS,(s,o)=>{Dr(this,Cd.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on(vt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new ae(j.UNEXPECTED_ERROR);const c=mE({command:t,sdkVersion:Qs==="4.24.0"?"0.0.1":Qs,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new ae(j.WS_DISCONNECT);const l=()=>new Ve((v,y)=>{this.websocket.once(vt.CLOSED,()=>y(new ae(j.WS_ABORT))),this.websocket.once(vt.CONNECTED,v)});this.websocket.state!=="connected"&&await l(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const p=new Ve((v,y)=>{const D=()=>{y(new ae(j.WS_ABORT))};this.websocket.once(vt.RECONNECTING,D),this.websocket.once(vt.CLOSED,D),this.once("@".concat(o,"-").concat(this.spec.sid),A=>{v(A)})});i&&qe.workerEvent(this.spec.sid,mE(mE({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(c);let E=null;try{E=await p}catch(v){if(this.websocket.state==="closed")throw v;return await l(),await this.request(t,n,r)}return i&&qe.workerEvent(this.spec.sid,mE(mE({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-m})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Qs==="4.24.0"?"0.0.1":Qs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case er.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case er.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case er.LIVE_STREAM_RESPONSE_BAD_STREAM:case er.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ae(j.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case er.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ae(j.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new ae(j.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new ae(j.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case er.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ae(j.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new ae(j.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case er.LIVE_STREAM_RESPONSE_WORKER_LOST:case er.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case er.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ae(j.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Ry)},6e3)}}function S6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function zi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class wq extends bn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qn;super(),x(this,"onLiveStreamWarning",void 0),x(this,"onLiveStreamError",void 0),x(this,"spec",void 0),x(this,"retryTimeout",1e4),x(this,"connection",void 0),x(this,"httpRetryConfig",void 0),x(this,"wsRetryConfig",void 0),x(this,"streamingTasks",new Map),x(this,"isStartingStreamingTask",!1),x(this,"taskMutex",new jr("live-streaming")),x(this,"cancelToken",Ai.CancelToken.source()),x(this,"transcodingConfig",void 0),x(this,"uapResponse",void 0),x(this,"lastTaskId",1),x(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=zi(zi({},hz),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(o=>zi(zi(zi({},uz),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){Pn(o.width)||nn(o.width,"config.width",0,1e4),Pn(o.height)||nn(o.height,"config.height",0,1e4),Pn(o.videoBitrate)||nn(o.videoBitrate,"config.videoBitrate",1,1e6),Pn(o.videoFrameRate)||nn(o.videoFrameRate,"config.videoFrameRate"),Pn(o.lowLatency)||ga(o.lowLatency,"config.lowLatency"),Pn(o.audioSampleRate)||ir(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Pn(o.audioBitrate)||nn(o.audioBitrate,"config.audioBitrate",1,128),Pn(o.audioChannels)||ir(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Pn(o.videoGop)||nn(o.videoGop,"config.videoGop"),Pn(o.videoCodecProfile)||ir(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Pn(o.userCount)||nn(o.userCount,"config.userCount",0,17),Pn(o.backgroundColor)||nn(o.backgroundColor,"config.backgroundColor",0,16777215),Pn(o.userConfigExtraInfo)||Cr(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Pn(o.transcodingUsers)&&(dl(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((c,l)=>{qy(c.uid),Pn(c.x)||nn(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),Pn(c.y)||nn(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),Pn(c.width)||nn(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),Pn(c.height)||nn(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),Pn(c.zOrder)||nn(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),Pn(c.alpha)||nn(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),Pn(o.watermark)||Pb(o.watermark,"watermark"),Pn(o.backgroundImage)||Pb(o.backgroundImage,"backgroundImage"),o.images&&!Pn(o.images)&&(dl(o.images,"config.images"),o.images.forEach((c,l)=>{Pb(c,"images[".concat(l,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(o=>zi(zi(zi({},Nb),o),{},{zOrder:255}))),n.backgroundImage&&(r.push(zi(zi(zi({},Nb),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(zi(zi(zi({},Nb),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(o=>zi({},o)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(o=>typeof o.uid=="number"?Ve.resolve(o.uid):KU(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ve.all(i)).forEach((o,c)=>{n.userConfigs&&n.userConfigs[c]&&(n.userConfigs[c].uid=o)}),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(rs(s=this.streamingTasks).call(s)).map(c=>c.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(l=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})})}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===ul.TRANSCODE)throw new ae(j.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new ae(j.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(c){throw s(),c}switch(n){case ul.TRANSCODE:i.transcodingConfig=zi({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const c=new Ve((p,m)=>{Rr(this.retryTimeout).then(()=>{if(r)return m(r);const E=this.statusError.get(t);return E?(this.statusError.delete(t),m(E)):void 0})}),l=await Ve.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===ul.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||r)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,c)):await this.startLiveStreamingTask(t,n,c)}}stopLiveStreamingTask(t){return new Ve((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new ae(j.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===ul.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;const n=Array.from(rs(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ai.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ae(j.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Dr(this,Db.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new Rq(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Cd.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Cd.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Cd.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new ae(j.UNEXPECTED_ERROR,"can not get new live streaming address list"));Dr(this,Db.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new ae(j.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return R.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new ae(j.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case er.LIVE_STREAM_RESPONSE_WORKER_LOST:case er.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(rs(s=this.streamingTasks).call(s));for(const c of o)c.abortTask?c.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new ae(j.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(l=>{R.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const bq={name:"LiveStreaming",create:function(e){return new wq(e.joinInfo,e.websocketRetryConfig||qn,e.httpRetryConfig||qn)}};function Iq(e){let t=C6();return function(n,r){let i=n.appId;i!==void 0&&(Zt(r,10),Oc(r,i));let s=n.cid;s!==void 0&&(Zt(r,16),Zt(r,s));let o=n.cname;o!==void 0&&(Zt(r,26),Oc(r,o));let c=n.deviceId;c!==void 0&&(Zt(r,34),Oc(r,c));let l=n.elapse;l!==void 0&&(Zt(r,40),jd(r,l));let p=n.fileSize;p!==void 0&&(Zt(r,48),jd(r,Zf(p)));let m=n.height;m!==void 0&&(Zt(r,56),jd(r,Zf(m)));let E=n.jpg;E!==void 0&&(Zt(r,66),Zt(r,E.length),function(Hr,ge){let Pe=$f(Hr,ge.length);Hr.bytes.set(ge,Pe)}(r,E));let v=n.networkType;v!==void 0&&(Zt(r,72),jd(r,Zf(v)));let y=n.osType;y!==void 0&&(Zt(r,80),jd(r,Zf(y)));let D=n.requestId;D!==void 0&&(Zt(r,90),Oc(r,D));let A=n.sdkVersion;A!==void 0&&(Zt(r,98),Oc(r,A));let O=n.sequence;O!==void 0&&(Zt(r,104),jd(r,Zf(O)));let V=n.sid;V!==void 0&&(Zt(r,114),Oc(r,V));let U=n.timestamp;U!==void 0&&(Zt(r,120),jd(r,U));let G=n.uid;G!==void 0&&(Zt(r,128),Zt(r,G));let Z=n.vid;Z!==void 0&&(Zt(r,136),Zt(r,Z));let Q=n.width;Q!==void 0&&(Zt(r,144),jd(r,Zf(Q)));let z=n.service;z!==void 0&&(Zt(r,152),Zt(r,z));let re=n.callbackData;re!==void 0&&(Zt(r,162),Oc(r,re));let he=n.jpgEncryption;he!==void 0&&(Zt(r,168),Zt(r,he));let Ee=n.requestType;Ee!==void 0&&(Zt(r,176),Zt(r,Ee));let Re=n.scorePorn;Re!==void 0&&(Zt(r,185),UI(r,Re));let Ct=n.scoreSexy;Ct!==void 0&&(Zt(r,193),UI(r,Ct));let bt=n.scoreNeutral;bt!==void 0&&(Zt(r,201),UI(r,bt));let ut=n.scene;ut!==void 0&&(Zt(r,208),Zt(r,ut));let Yt=n.ossFilePrefix;Yt!==void 0&&(Zt(r,218),Oc(r,Yt));let Ht=n.serviceVendor;if(Ht!==void 0)for(let Hr of Ht){Zt(r,226);let ge=C6();Nq(Hr,ge),Zt(r,ge.limit),Lq(r,ge),kq(ge)}}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function Aq(e){return function(n){let r={};e:for(;!R6(n);){let i=Nc(n);switch(i>>>3){case 0:break e;case 1:r.code=Nc(n);break;case 2:r.msg=w6(n,Nc(n));break;case 3:{let s=Pq(n);r.data=Oq(n),n.limit=s;break}default:y6(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function Oq(e){let t={};e:for(;!R6(e);){let n=Nc(e);switch(n>>>3){case 0:break e;case 1:t.requestId=w6(e,Nc(e));break;case 2:t.requestType=Nc(e)>>>0;break;case 3:t.scorePorn=MI(e);break;case 4:t.scoreSexy=MI(e);break;case 5:t.scoreNeutral=MI(e);break;case 6:t.requestScene=Nc(e)>>>0;break;case 7:t.scene=Nc(e)>>>0;break;default:y6(e,7&n)}}return t}function Nq(e,t){let n=e.service;n!==void 0&&(Zt(t,8),Zt(t,n));let r=e.vendor;r!==void 0&&(Zt(t,16),Zt(t,r));let i=e.token;i!==void 0&&(Zt(t,26),Oc(t,i));let s=e.callbackUrl;s!==void 0&&(Zt(t,34),Oc(t,s))}function Pq(e){let t=Nc(e),n=e.limit;return e.limit=e.offset+t,n}function y6(e,t){switch(t){case 0:for(;128&b6(e););break;case 2:LI(e,Nc(e));break;case 5:LI(e,4);break;case 1:LI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Dq=new Float32Array(1);new Uint8Array(Dq.buffer);let kI=new Float64Array(1),Yi=new Uint8Array(kI.buffer);function Zf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let T6=[];function C6(){const e=T6.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function kq(e){T6.push(e)}function LI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function R6(e){return e.offset>=e.limit}function $f(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function xI(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function w6(e,t){let n=xI(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,p,m,E,v=i[c+n];(128&v)==0?o+=r(v):(224&v)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&v)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&v)==224?c+2>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],(49344&(l|p<<8))!=32896?o+=s:(E=(15&v)<<12|(63&l)<<6|63&p,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&v)==240?c+3>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],m=i[c+n+3],(12632256&(l|p<<8|m<<16))!=8421504?o+=s:(E=(7&v)<<18|(63&l)<<12|(63&p)<<6|63&m,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function Oc(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}Zt(e,r);let i=$f(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function Lq(e,t){let n=$f(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,o=t.limit;s<o;s++)r[s+n]=i[s]}function b6(e){return e.bytes[xI(e,1)]}function I6(e,t){let n=$f(e,1);e.bytes[n]=t}function MI(e){let t=xI(e,8),n=e.bytes;return Yi[0]=n[t++],Yi[1]=n[t++],Yi[2]=n[t++],Yi[3]=n[t++],Yi[4]=n[t++],Yi[5]=n[t++],Yi[6]=n[t++],Yi[7]=n[t++],kI[0]}function UI(e,t){let n=$f(e,8),r=e.bytes;kI[0]=t,r[n++]=Yi[0],r[n++]=Yi[1],r[n++]=Yi[2],r[n++]=Yi[3],r[n++]=Yi[4],r[n++]=Yi[5],r[n++]=Yi[6],r[n++]=Yi[7]}function Nc(e){let t,n=0,r=0;do t=b6(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Zt(e,t){for(t>>>=0;t>=128;)I6(e,127&t|128),t>>>=7;I6(e,t)}function jd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=$f(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}function A6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const xq=new Map([["moderation",1],["supervise",2]]);class Mq extends bn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(gr.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Ui(n=t.map(r=>xq.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),x(this,"name","AgoraRTCVideoContentInspect"),x(this,"_connectionState",jo.CONNECTING),x(this,"_innerConnectionState",void 0),x(this,"sequence",0),x(this,"inspectStartTime",void 0),x(this,"workerManagerConnection",void 0),x(this,"workerConnection",void 0),x(this,"workerMessageLengthLimit",void 0),x(this,"inspectIntervalMinimum",void 0),x(this,"qualityRatio",void 0),x(this,"_connectInfo",void 0),x(this,"_cancelTokenSource",Ai.CancelToken.source()),x(this,"_retryConfig",void 0),x(this,"wmSequence",0),x(this,"inspectInterval",void 0),x(this,"inspectTimer",null),x(this,"ossFilePrefix",void 0),x(this,"extraInfo",void 0),x(this,"_inspectType",void 0),x(this,"_inspectMode",void 0),x(this,"_quality",1),x(this,"qualityTimer",null),x(this,"_inspectId",void 0),x(this,"_needWorkUrlOnly",!1),x(this,"inspectImage",()=>{if(this.connectionState!==jo.CONNECTED)throw new ae(j.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===jo.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=on(5,"inspect-"),this.workerMessageLengthLimit=W("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=W("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=W("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Fg("worker-manager-"+this._inspectId,qn),this.on(gr.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Fo[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Fg("worker-"+this._inspectId,qn),this.handleWorkerEvents()}async init(t,n){this.emit(gr.STATE_CHANGE,Fo.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Ve((i,s)=>{this.on(gr.CONNECTION_STATE_CHANGE,(o,c)=>{c===jo.CONNECTED&&i()}),this.requestAP(t,r,n).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(t,n,r){const i=W("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),s=await function(c,l,p,m){let{appId:E,areaCode:v,cname:y,sid:D,token:A,uid:O}=l;Wf++;const V="image_moderation_api",U={service_name:V,json_body:JSON.stringify({appId:E,areaCode:v,cname:y,command:"allocateEdge",requestId:Wf,seq:Wf,sid:D,token:A,ts:Date.now(),uid:O+""})};let G,Z,Q=c[0];return Ea(async()=>{G=Date.now();const z=await Ca(Q,{data:U,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-G,z.code!==0){const Re=new ae(j.UNEXPECTED_RESPONSE,"image inspect ap error, code"+z.code,{retry:!0,responseTime:Z});throw R.error(Re.toString()),Re}const re=JSON.parse(z.json_body);if(re.code!==200){const Re=new ae(j.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(re.code,", reason: ").concat(re.reason),{code:re.code,responseTime:Z});throw R.error(Re.toString()),Re}if(!re.servers||!Array.isArray(re.servers)||re.servers.length===0){const Re=new ae(j.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:re.code,responseTime:Z});throw R.error(Re.toString()),Re}const he=W("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ee=W("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:re.servers.map(Re=>{let{address:Ct,wss:bt}=Re;if(Ct&&bt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(he,":").concat(Ee||bt)}).filter(Re=>!!Re),workerToken:re.workerToken,vid:re.vid,responseTime:Z}},(z,re)=>(qe.apworkerEvent(D,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(z.addressList),firstSuccess:re===0,responseTime:Z,serverIp:c[re%c.length]}),!1),(z,re)=>(qe.apworkerEvent(D,{success:!1,sc:z.data&&z.data.code||200,serviceName:V,responseTime:Z,serverIp:c[re%c.length]}),!!(z.code!==j.OPERATION_ABORTED&&z.code!==j.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(Q=c[(re+1)%c.length],!0)),m)}(i,t,n,r);this.emit(gr.STATE_CHANGE,Fo.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(gr.STATE_CHANGE,Fo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(vt.CONNECTED,async()=>{this.emit(gr.STATE_CHANGE,Fo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(vt.CLOSED,()=>{this._innerConnectionState<Fo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(vt.FAILED,()=>{this._innerConnectionState<Fo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(vt.RECONNECTING,()=>{this._innerConnectionState<Fo.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(vt.ON_MESSAGE,async t=>{this.emit(gr.STATE_CHANGE,Fo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new ae(j.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new ae(j.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=W("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(gr.STATE_CHANGE,Fo.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(gr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(vt.CONNECTED,async()=>{this.emit(gr.STATE_CHANGE,Fo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=jo.CONNECTED}),this.workerConnection.on(vt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=Aq(new Uint8Array(t.data));if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(gr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Ui(n=Object.keys(i)).call(n,(c,l)=>i[c]>i[l]?c:l,"porn"),o=Object.keys(i).find(c=>c===s);this.emit(gr.INSPECT_RESULT,o)}else this.emit(gr.INSPECT_RESULT,void 0,new ae(j.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(gr.INSPECT_RESULT,void 0,new ae(j.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(gr.INSPECT_RESULT,void 0,new ae(j.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(vt.CLOSED,()=>{this.connectionState=jo.CLOSED}),this.workerConnection.on(vt.FAILED,()=>{this.connectionState=jo.CLOSED}),this.workerConnection.on(vt.RECONNECTING,()=>{this.connectionState=this.connectionState===jo.CONNECTED?jo.RECONNECTING:jo.CONNECTING}),this.workerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(gr.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const t=Ts(this,gr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(gr.INSPECT_RESULT,void 0,new ae(j.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(gr.INSPECT_RESULT,void 0,new ae(j.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await cx(m,r,i),v=this.sequence+"-"+s+"-"+l+"-"+p+"-"+on(12,""),y={appId:r,cid:s,cname:i,deviceId:"",elapse:(D=Number(p-this.inspectStartTime),{low:D|=0,high:D>>31,unsigned:D>=0}),fileSize:E.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:M5(p),uid:l,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var D;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const A=Iq(y);if(A.byteLength<this.workerMessageLengthLimit){if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const O=function(V){for(var U=1;U<arguments.length;U++){var G=arguments[U]!=null?arguments[U]:{};U%2?A6(Object(G),!0).forEach(function(Z){x(V,Z,G[Z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(G)):A6(Object(G)).forEach(function(Z){Object.defineProperty(V,Z,Object.getOwnPropertyDescriptor(G,Z))})}return V}({},y);delete O.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(O))}return A}{const O=this.quality*this.qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ai.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=jo.CLOSED,this.emit(gr.STATE_CHANGE,Fo.CLOSED)}}const Uq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new ae(j.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new ae(j.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var s;if(!Oe(s=["supervise","moderation"]).call(s,i))throw new ae(j.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new ae(j.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Mq(t)}};var O6=S(Jr.Object.getOwnPropertySymbols),Vq=qt,jq=Zh.indexOf,Fq=gu,VI=je([].indexOf),N6=!!VI&&1/VI([1],1,-0)<0;Vq({target:"Array",proto:!0,forced:N6||!Fq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return N6?VI(this,e,t)||0:jq(this,e,t)}});var Bq=Qi("Array","indexOf"),Wq=q,Gq=Bq,jI=Array.prototype,Hq=function(e){var t=e.indexOf;return e===jI||Wq(jI,e)&&t===jI.indexOf?Gq:t},P6=S(Hq);function Kq(e,t){if(e==null)return{};var n,r,i=function(o,c){if(o==null)return{};var l={};for(var p in o)if({}.hasOwnProperty.call(o,p)){if(P6(c).call(c,p)!==-1)continue;l[p]=o[p]}return l}(e,t);if(O6){var s=O6(e);for(r=0;r<s.length;r++)n=s[r],P6(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let D6=class{get localCapabilities(){return Cn(this._localCapabilities)}get rtpCapabilities(){return Cn(this._rtpCapabilities)}get candidates(){return Cn(this._candidates)}get iceParameters(){return Cn(this._iceParameters)}get dtlsParameters(){return Cn(this._dtlsParameters)}constructor(e){x(this,"sessionDesc",void 0),x(this,"_localCapabilities",void 0),x(this,"_rtpCapabilities",void 0),x(this,"_candidates",void 0),x(this,"_iceParameters",void 0),x(this,"_dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname","o/i14u9pJrxRKAsu"),x(this,"firefoxSsrcMidMap",new Map),e=Cn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:c,videoCodec:l,audioCodec:p}=e;let m;this.setup=c,m=o===gi.RECEIVE_ONLY?Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const E=o===gi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=o===gi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=o===gi.RECEIVE_ONLY?i.send.videoCodecs:Hg(Be.VIDEO,E,v,l),D=o===gi.RECEIVE_ONLY?i.send.audioCodecs:Hg(Be.AUDIO,E,v,p);for(const A of m.mediaDescriptions)A.attributes.iceUfrag=t.iceUfrag,A.attributes.icePwd=t.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=r,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=y.map(O=>O.payloadType.toString(10)),A.attributes.payloads=y,A.attributes.extmaps=E.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=D.map(O=>O.payloadType.toString(10)),A.attributes.payloads=D,A.attributes.extmaps=E.audioExtensions,Bf(A));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return yd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=Gg(t,this.cname,W("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(s);if(c){if(Nn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(e,s,r);let p;return l===-1?(p=this.createOrRecycleSendMedia(e,s,o,"sendonly",r,i),this.updateBundleMids()):(p=Cn(this.sessionDesc.mediaDescriptions[l]),p.attributes.direction="sendonly",p.attributes.ssrcs=s,p.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(p,i)),Nn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let c,l=!1;o===-1?(l=!0,c=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(c=Cn(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),r.push({mid:c.attributes.mid,needCreateTransceiver:l})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:o,relatedPort:c,priority:l}=new RTCIceCandidate(e),p={foundation:t??"",componentId:"1",transport:n??"",priority:l?l+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some(m=>m.priority===p.priority&&m.connectionAddress===p.connectionAddress&&m.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=Hg(s,o,this.localCapabilities.send,s===Be.AUDIO?i:r),l=s===Be.VIDEO?o.videoExtensions:o.audioExtensions,p="".concat(++this.currentMidIndex);let m={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungRecvMediaDsec(m,e);const E=this.findFirstClosedMedia(s);if(E){const v=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Oe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Oe(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Nn()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Cn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,s){const o=this.rtpCapabilities.send,c=e===Be.VIDEO?o.videoCodecs:o.audioCodecs,l=e===Be.VIDEO?o.videoExtensions:o.audioExtensions;Nn()&&(i="".concat(++this.currentMidIndex));let p={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};p=this.mungSendMediaDesc(p,s);const m=this.findFirstClosedMedia(e);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(e,t,n){const r=Cn(e);return Vb(r),Ff(r,t),jb(r,t),wU(r),nT(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Cn(e);return nT(n,t,this.localCapabilities.recv),Bf(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Nn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const zq=["sdp"];var _n;function k6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let L6=(_n=class nm extends aU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),x(this,"direction",void 0),x(this,"name",void 0),x(this,"store",void 0),x(this,"spec",void 0),x(this,"peerConnection",void 0),x(this,"initialOffer",void 0),x(this,"transport",void 0),x(this,"statsFilter",void 0),x(this,"localCandidateCount",0),x(this,"_isInRestartIce",!1),x(this,"mutex",void 0),x(this,"onLocalCandidate",void 0),x(this,"remoteSDP",void 0),x(this,"pendingCandidates",[]),x(this,"localCapabilities",void 0),x(this,"isReady",!1),x(this,"restartCnt",0),x(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(nm.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??gi.SEND_ONLY,this.name=this.direction===gi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Yw(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await IU();if(this.localCapabilities=rT(n),t){const{sdp:r}=t,i=Kq(t,zq),s=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Wg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bo(E,m,"videoExtensions",v,y,D),Bo(E,m,"videoCodecs",v,y,D),Bo(E,m,"audioExtensions",v,y,D),Bo(E,m,"audioCodecs",v,y,D),W("RAISE_H264_BASELINE_PRIORITY")){const A=D.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]==="42001f");if(A!==-1){const O=D.videoCodecs.findIndex(V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(O<A){R.debug("raising H264 baseline profile priority");const V=D.videoCodecs[A];D.videoCodecs.splice(A,1),D.videoCodecs.splice(O,0,V)}O!==-1&&W("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(V=>!(V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:y,sendrecv:D}}({},{},r);this.remoteSDP=new D6({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=Id(o.sdp);await this.peerConnection.setLocalDescription(o);const l=await AU({},{},o.sdp);this.localCapabilities=rT(l);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),Fd(Fd({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Id(r.sdp);return this.initialOffer=r,Fd(Fd({},i),{},{sdp:r.sdp})}}catch(n){throw new ue(j.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,s=await AU({},{},n);this.remoteSDP=new D6({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ue(j.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return Js(function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=i.remoteSDP.receive(t,n,r);t.forEach((O,V)=>{if(c[V].needCreateTransceiver){const U=i.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});o.push(U),O._updateRtpTransceiver(U)}else{const U=i.peerConnection.getTransceivers().find(G=>G.mid===c[V].mid);if(!U)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[V].mid));o.push(U),O._updateRtpTransceiver(U)}}),Nn()&&W("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=c.map(O=>O.mid),p=yield jt(i.peerConnection.createOffer()),m=i.mungSendOfferSDP(p.sdp,t,l),E=Gi(m),v=l.map(O=>{const V=E.mediaDescriptions.find(U=>U.attributes.mid===O);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return TU(V,W("USE_PUB_RTX"))}),y=o.map((O,V)=>{const U=l[V];return{localSSRC:v[V],id:U}});yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(O){const V=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:V})),yield jt(i.stopSending(l,!0)),O}yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t));const D=i.remoteSDP.toString(),A=i.logSDPExchange(m,"offer","local","send");return A?.(D),yield jt(i.setRemoteDescription({type:"answer",sdp:D})),o.map((O,V)=>{const U=l[V];return{localSSRC:v[V],id:U}})}catch(o){throw o instanceof ue?o:new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(l=>{var p;l.direction="inactive",(p=l.stop)===null||p===void 0||p.call(l)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,s,t);p?.(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const c=this.remoteSDP.toString(),l=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,t);l?.(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===ph.Auto&&(this.store.p2pTransport=ph.SdRtn,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(nm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(nm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Id(n.sdp);return this.store.descriptionStart(),this.direction===gi.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===gi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Id(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ue(j.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Fd(Fd({},Ec),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Fd(Fd({},Ec),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Oe(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ig(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...nm.turnServerConfigToIceServers(t.turnServer.servers,n,r)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...nm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Oe(s=[ph.Relay,ph.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter(c=>c.tcpport);R.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(n){case ph.SdRtn:const c=t.filter(p=>{var m;return Oe(m=p.username).call(m,"glb:")&&p.turnServerURL==p.turnServerURL}),l=c.length>r?c[r]:c[0];l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(wd(l.turnServerURL),":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(wd(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;case ph.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(wd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(wd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t?.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){const s=r.address+":"+r.port,o=i.address+":"+i.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(yh(s)),", remote ").concat(JSON.stringify(yh(o))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:m,frameRate:E,scaleResolutionDownBy:v}=t._encoderConfig;m&&(s.maxBitrate=1e3*m),Oe(o=t._hints).call(o,rn.LOW_STREAM)&&(E&&(s.maxFramerate=as(E)),v&&v>=1&&(s.scaleResolutionDownBy=v))}if(W("DSCP_TYPE")&&ll()){var c;const m=W("DSCP_TYPE");Oe(c=["very-low","low","medium","high"]).call(c,m)&&(s.networkPriority=m)}const l=n.getParameters(),p=(r=l.encodings)===null||r===void 0?void 0:r[0];Nn()&&!p&&(i.encodings=[s]),p&&Object.assign(p,s),Object.assign(l,i),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof mn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Gi(t);return n.forEach((s,o)=>{const c=r[o],l=i.mediaDescriptions.find(p=>p.attributes.mid===c);l&&(Ff(l,s),bU(l,s,this.store.codec))}),yd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const p=t[l],m=n[l];if(m instanceof mn&&!Oe(r=m._hints).call(r,rn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,n){if(!Nn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof mn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof mn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Oe(n=t._hints).call(n,rn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async o=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const s=(i=Gi(n).mediaDescriptions.find(o=>o.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return s?.[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Oe(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=Gi(t),s=i.mediaDescriptions.find(o=>o.attributes.mid===n);return s&&r===Be.AUDIO&&s.media.mediaType==="audio"&&Bf(s),yd(i)}},Ye(_n.prototype,"establish",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"establish"),_n.prototype),Ye(_n.prototype,"connect",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"connect"),_n.prototype),Ye(_n.prototype,"receive",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"receive"),_n.prototype),Ye(_n.prototype,"mockReceive",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"mockReceive"),_n.prototype),Ye(_n.prototype,"stopReceiving",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"stopReceiving"),_n.prototype),Ye(_n.prototype,"restartICE",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"restartICE"),_n.prototype),Ye(_n.prototype,"close",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"close"),_n.prototype),Ye(_n.prototype,"updateEncoderConfig",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"updateEncoderConfig"),_n.prototype),Ye(_n.prototype,"updateSendParameters",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"updateSendParameters"),_n.prototype),Ye(_n.prototype,"replaceTrack",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"replaceTrack"),_n.prototype),Ye(_n.prototype,"muteLocal",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"muteLocal"),_n.prototype),Ye(_n.prototype,"unmuteLocal",[zo],Object.getOwnPropertyDescriptor(_n.prototype,"unmuteLocal"),_n.prototype),_n);function zo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}let ba=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var x6,M6,U6,V6,j6,F6,B6,W6,G6,H6,K6,Rn;function z6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function FT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Yq=(x6=Ia(ba.SEND_ONLY),M6=Ia(ba.SEND_ONLY),U6=Ia(),V6=Ia(ba.RECEIVE_ONLY),j6=Ia(ba.RECEIVE_ONLY),F6=Ia(ba.RECEIVE_ONLY),B6=Ia(ba.RECEIVE_ONLY),W6=Ia(ba.RECEIVE_ONLY),G6=Ia(ba.RECEIVE_ONLY),H6=Ia(),K6=Ia(ba.RECEIVE_ONLY),Rn=class extends bn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(et.StateChange,t,this._state)}constructor(e,t){super(),x(this,"isPlanB",!1),x(this,"store",void 0),x(this,"statsUploader",void 0),x(this,"sendConnection",void 0),x(this,"recvConnection",void 0),x(this,"localTrackMap",new Map),x(this,"remoteUserMap",new Map),x(this,"localDataChannels",[]),x(this,"pendingLocalTracks",[]),x(this,"pendingRemoteTracks",[]),x(this,"statsCollector",void 0),x(this,"dtlsFailedCount",0),x(this,"sendMutex",void 0),x(this,"recvMutex",void 0),x(this,"_state",Jt.Disconnected),x(this,"_restartStates",["disconnected","failed"]),x(this,"reconnectInterval",void 0),x(this,"uploadUnplinkStarted",!1),x(this,"uploadDownlinkStarted",!1),x(this,"uplinkStateUploadInterval",void 0),x(this,"downlinkStatsUploadInterval",void 0),x(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void i(new ue(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void r();const p=l.find(y=>y[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(l.map(y=>{let[,{id:D}]=y;return D}));let m=!1;var o,c;n.trackMediaType==="video"?m=!((o=this.localTrackMap.get(Te.LocalAudioTrack))===null||o===void 0||!o.track._muted):m=((c=this.localTrackMap.get(Te.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const E=this.createMuteMessage(l);await sn(this,et.RequestMuteLocal,E);const v=n.trackMediaType==="video"?Rd.MUTE_LOCAL_VIDEO:Rd.MUTE_LOCAL_AUDIO;await sn(this,et.RequestP2PMuteLocal,{action:v,message:E,isMuteAll:m}),r()}catch(l){i(l)}finally{s()}}),x(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void i(new ue(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const c=this.createUnmuteMessage(o),l=n.trackMediaType==="video"?Rd.UNMUTE_LOCAL_VIDEO:Rd.UNMUTE_LOCAL_AUDIO;await sn(this,et.RequestP2PMuteLocal,{action:l,message:c}),r()}catch(o){i(o)}finally{s()}}),x(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let o;typeof s=="boolean"&&s||(o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==Jt.Connected)return void r();const{id:p,track:m}=l;p&&(await this.sendConnection.updateSendParameters(p,m),await this.sendConnection.updateEncoderConfig(p,m),this.emit(et.UpdateVideoEncoder,m)),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}}),x(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Jt.Connected)return void r();const{id:c,track:l}=o;c&&await this.sendConnection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}}),x(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==Jt.Connected)return void r();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),p[0]===Te.LocalVideoTrack&&Ft().supportDualStreamEncoding){const m=this.localTrackMap.get(Te.LocalVideoLowTrack);if(m){const E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new Ve((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}r()}catch(p){i(p)}finally{var l;(l=o)===null||l===void 0||l()}}),x(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),x(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),x(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),x(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new l5(e),this.bindStatsUploaderEvents(),this.sendMutex=new jr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new jr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},W("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new L6(e,this.store,gi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Jt.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new L6(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new ue(j.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected}async addRemoteCandidate(e,t){if(t===gi.RECEIVE_ONLY){if(!this.sendConnection)throw new ue(j.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ue(j.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return Js(function*(){const i=yield jt(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Jt.Connected){r.throwIfTrackTypeNotMatch(e);const p=e.filter(m=>r.pendingLocalTracks.indexOf(m)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(p))}r.store.pubId=r.store.pubId+1,Gr.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));s.forEach(p=>{let{track:m,type:E}=p;const v=Date.now();r.store.publish(m.getTrackId(),E===Te.LocalAudioTrack?"audio":"video",v)}),r.bindLocalTrackEvents(s);const o=yield jt(r.sendConnection.send(s.map(p=>{let{track:m}=p;return m}),r.store.codec,r.store.audioCodec)),c=(yield jt(o.next())).value,l=r.createGatewayPublishMessage(s,c);try{yield l}catch(p){throw o.throw(p),p?.code===j.WS_ABORT&&s.forEach(m=>{let{track:E}=m;r.pendingLocalTracks.indexOf(E)===-1&&r.pendingLocalTracks.push(E)}),r.unbindLocalTrackEvents(s),p}yield jt(o.next()),s.forEach(p=>{let{type:m}=p;r.statsCollector.addLocalStats(m)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,c),s.forEach(p=>{let{track:m,type:E}=p;const v=Date.now();r.store.publish(m.getTrackId(),E===Te.LocalAudioTrack?"audio":"video",void 0,v)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Jt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Oe(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Jt.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s,ssrcs:o}]=r;const c={stream_type:jz(s,i),ssrcs:o};s._muted||!s._enabled?t.push(c):n.push(c)}),t.length>0&&t.forEach(r=>{sn(this,et.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{sn(this,et.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Js(function*(){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Dr(this,et.RequestRePublish,this.pendingLocalTracks),this.emit(et.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new ue(j.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===Be.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Df(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Pf(s,e.uid,e._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:v}=m;return E.uid===e.uid&&t===v});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(et.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new ue(j.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:c}=s;return t!==void 0?o.uid===e.uid&&t===c:o.uid===e.uid});if(r.forEach(s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||n||r.forEach(s=>{let{kind:o}=s;var c;if(o===Be.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(o===Be.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[o,{kind:c}]=s;var l,p;if(c===Be.VIDEO&&o._videoSSRC&&((l=this.recvConnection)===null||l===void 0||l.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===Be.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((p=o._videoTrack)===null||p===void 0||p._destroy(),o._videoTrack=void 0);else if(c===Be.AUDIO){var m;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((m=o._audioTrack)===null||m===void 0||m._destroy(),o._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:o}]=s;sn(this,et.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Be.VIDEO,Be.AUDIO].forEach(r=>{n.has(r)?sn(this,et.RequestP2PUnmuteRemote,r):sn(this,et.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ue(j.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Be.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t?.track instanceof $n){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Te.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Te.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Te.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Te.LocalAudioTrack),c=r?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(l=>l instanceof Ln),c=r?(s=this.localTrackMap.get(Te.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof mn);qe.publish(this.store.sessionId,{eventElapse:Gr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Be.VIDEO?n._videoSSRC:n._audioSSRC;i&&qe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Be.VIDEO,audio:r===Be.AUDIO,peerid:n.uid,subscribeRequestid:r===Be.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Gr.measureFromSubscribeStart(this.store.clientId,i)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new jr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new jr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e?.track instanceof $n){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Jt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof mn||t&&t.track instanceof Ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=th(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Te.LocalVideoTrack:Oe(t=r._hints).call(t,rn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Te.LocalAudioTrack:r instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Te.LocalVideoLowTrack:}}),this.emit(et.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(et.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===gi.SEND_ONLY){if(!this.sendConnection)throw new ue(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new ue(j.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await Dr(this,et.RequestP2PRestartICE,{direction:gi.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalAudioTrack),r=e.videoSend.find(y=>{var D;return y.ssrc===(t==null||(D=t.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),i=e.audioSend.find(y=>{var D;return y.ssrc===(n==null||(D=n.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!r||!i)return 1;const s=Ts(this,et.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,p=(l&&s?(l+s)/2:l||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t?.track;if(v&&v._encoderConfig&&v._hints.indexOf(rn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return $M[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===i),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const l=Ts(this,et.NeedSignalRTT),p=e.rtt,m=(p&&l?(p+l)/2:p||l)||0,E=o?o.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;E&&(y=.6*v*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ve((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=Ft(),s=this.getAllTracks();e=Ef(e=e.filter(l=>s.indexOf(l)===-1));let o=!1,c=!1;for(const l of e){if(l instanceof mn&&(this.localTrackMap.has(Te.LocalVideoTrack)||o?new ue(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Te.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(l,n);r.push({track:p,type:Te.LocalVideoLowTrack})}if(l instanceof Ln){const p=this.localTrackMap.get(Te.LocalAudioTrack);if(p){if(!(p.track instanceof $n))throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0)}else if(c){const m=r.find(E=>{let{type:v}=E;return v===Te.LocalAudioTrack});if(!(m.track instanceof $n))throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(l)}else{if(!i.webAudioMediaStreamDest||l instanceof $n||l._bypassWebAudio)r.push({track:l,type:Te.LocalAudioTrack});else{const m=new $n;m.addAudioTrack(l),r.push({track:m,type:Te.LocalAudioTrack})}c=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Ef(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Ln){const i=this.localTrackMap.get(Te.LocalAudioTrack);if(!i)continue;i.track instanceof $n?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,i]),i.track.close())):t.push([Te.LocalAudioTrack,i])}if(r instanceof mn){const i=this.localTrackMap.get(Te.LocalVideoTrack);if(!i)continue;t.push([Te.LocalVideoTrack,i]);const s=this.localTrackMap.get(Te.LocalVideoLowTrack);s&&t.push([Te.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.addListener(Ke.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof $n?e.trackList.forEach(n=>{n.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.off(Ke.GET_STATS,this.handleGetLocalVideoStats),n.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof $n?e.trackList.forEach(t=>{t.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ke.GET_STATS,this.handleGetLocalAudioStats),t.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ke.GET_STATS,this.handleGetLocalAudioStats),e.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Pf&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Df&&t.addListener(Ke.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ke.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Be.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Be.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,{track:o,type:c}=n;switch(c){case Te.LocalAudioTrack:s=Qt.Audio;break;case Te.LocalVideoTrack:s=Oe(i=o._hints).call(i,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:s=Qt.Low}return{kind:c===Te.LocalAudioTrack?Be.AUDIO:Be.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalVideoTrack:r=Oe(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(et.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Oe(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Rr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),qe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(et.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit($s.FIRST_FRAME_DECODED),qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&qe.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(et.ConnectionTypeChange,r),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(et.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===gi.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===gi.SEND_ONLY?this.restartICE(e):Dr(this,et.RequestP2PRestartICE,{direction:gi.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive||t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===Te.LocalVideoTrack)){const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof $n)return n.track.isActive&&t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===Te.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Oe(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Oe(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Be.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Be.VIDEO,ssrcId:r._videoSSRC}));case Be.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Be.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ve((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ve((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Ln){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await sn(this,et.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(et.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(et.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rr(Bw(this.dtlsFailedCount,qn)),this.emit(et.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof mn).length>1)throw new ue(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ln).length>1&&(e.some(t=>t instanceof Ln&&t._bypassWebAudio)||!Ft().webAudioMediaStreamDest))throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof mn&&this.pendingLocalTracks.some(n=>n instanceof mn))throw new ue(j.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ln&&this.pendingLocalTracks.some(n=>n instanceof Ln)&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ln&&n._bypassWebAudio)))throw new ue(j.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,r=FT(FT({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():rI(e,r);const s=on(8,"track-low-"),o=new mn(i,FT(FT({},n&&{scaleResolutionDownBy:Ub(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(fh.TRANSCEIVER_UPDATED,c=>{e._updateRtpTransceiver(c,wf.LOW_STREAM)}),o._hints.push(rn.LOW_STREAM),e.addListener(Ke.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(l=>l.userId===s.uid&&l.type==="video");qe.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Gr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ue(j.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ue(j.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ue(j.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ue(j.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ue(j.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ue(j.NOT_SUPPORTED)}async preConnect(e){throw new ue(j.NOT_SUPPORTED)}getEstablishParams(){throw new ue(j.NOT_SUPPORTED)}async reSubscribe(e){throw new ue(j.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new ue(j.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Te.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,wf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ye(Rn.prototype,"p2pConnect",[x6],Object.getOwnPropertyDescriptor(Rn.prototype,"p2pConnect"),Rn.prototype),Ye(Rn.prototype,"unpublish",[M6],Object.getOwnPropertyDescriptor(Rn.prototype,"unpublish"),Rn.prototype),Ye(Rn.prototype,"unpublishLowStream",[U6],Object.getOwnPropertyDescriptor(Rn.prototype,"unpublishLowStream"),Rn.prototype),Ye(Rn.prototype,"subscribe",[V6],Object.getOwnPropertyDescriptor(Rn.prototype,"subscribe"),Rn.prototype),Ye(Rn.prototype,"mockSubscribe",[j6],Object.getOwnPropertyDescriptor(Rn.prototype,"mockSubscribe"),Rn.prototype),Ye(Rn.prototype,"unsubscribe",[F6],Object.getOwnPropertyDescriptor(Rn.prototype,"unsubscribe"),Rn.prototype),Ye(Rn.prototype,"muteRemote",[B6],Object.getOwnPropertyDescriptor(Rn.prototype,"muteRemote"),Rn.prototype),Ye(Rn.prototype,"unmuteRemote",[W6],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteRemote"),Rn.prototype),Ye(Rn.prototype,"hasRemoteMediaWithLock",[G6],Object.getOwnPropertyDescriptor(Rn.prototype,"hasRemoteMediaWithLock"),Rn.prototype),Ye(Rn.prototype,"disconnectForReconnect",[H6],Object.getOwnPropertyDescriptor(Rn.prototype,"disconnectForReconnect"),Rn.prototype),Ye(Rn.prototype,"remoteMediaSsrcChanged",[K6],Object.getOwnPropertyDescriptor(Rn.prototype,"remoteMediaSsrcChanged"),Rn.prototype),Rn);function Ia(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(e){case ba.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}case ba.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l(),p()}}}},r}}class Dh extends bn{constructor(t,n){super(),x(this,"signal",void 0),x(this,"token",void 0),x(this,"tokenTimeout",void 0),x(this,"tokenInterval",void 0),x(this,"_sequence",0),x(this,"userMap",new Map),x(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===hn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*W("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,s){var o;if(this.userMap.size===0)return;const c=Array.from(rs(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??on(6,""),s=s??this._sequence++;const l={_id:i,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(c)};W("SHOW_P2P_LOG")&&R.debug("send message",l,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(l)).forEach(m=>{this.signal.request(ct.DATA_STREAM,{payload:Sd(this.encoder.encode(m))})});const p=new Ve((m,E)=>{const v=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),A),this.off(Uf.ABORT,D),R.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?E(new ue(j.INVALID_REMOTE_USER)):E(new ue(j.TIMEOUT))},W("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{v&&window.clearTimeout(v),this.off(Uf.ABORT,D),r&&m()},D=()=>{v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),A),E(new ue(j.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Uf.ABORT,D),this.once("res-@".concat(i,"_ack"),y);const A=(V,U)=>{O=!0,v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off(Uf.ABORT,D),V==="success"?m(U):E(new ue(j.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let O=!1;r||(this.once("res-@".concat(i),A),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{O||R.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(l))}))});try{return await p}catch(m){if(m.code===j.TIMEOUT)return await this.send(t,n,r,i,s);throw m}}onMessage(t){var n;const{_uid:r}=t;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Vn.CHECK)return;const{token:p}=t;i=new Map,s={uid:r,isStart:!0,token:p,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Pt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:p,total:m}=t,E=(o=i.get(p))!==null&&o!==void 0?o:[];if(E.push(t),i.has(p)||i.set(p,E),E.length!==m)return;{const v=th(E).call(E,(y,D)=>y.index-D.index).map(y=>y.payload).join("");i.delete(p),(t=JSON.parse(v))._uid=r}}const{_type:c,token:l}=t;if(Oe(n=[Vn.ACK,Vn.CHECK]).call(n,c))return c===Vn.CHECK&&this.handleCheckToken(s,l),void this.receiveMessage(t);l==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):R.debug('Receive unexpected message", '.concat(l,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:on(6,""),token:this.token,_type:Vn.CHECK};W("SHOW_P2P_LOG")&&R.debug("send message",t),this.signal.request(ct.DATA_STREAM,{payload:Sd(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Vn.ACK,token:this.token};W("SHOW_P2P_LOG")&&R.debug("send message",n),this.signal.request(ct.DATA_STREAM,{payload:Sd(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Vn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:E}=p;for(;m.has(E);){const v=m.get(E);m.delete(E),this.receiveMessage(v),p.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:i}=t,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:l}=s;if(i<l)return this.ack(t._id),void R.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));o.set(i,t),c&&i===l&&(this.receiveMessage(t),o.delete(l),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:s}=t;if(W("SHOW_P2P_LOG")&&R.debug("receive message",t),n){let o;switch(t._type!==Vn.ACK&&(i&&(o=JSON.parse(i)),this.ack(t._id)),t._type){case Vn.CANDIDATE:case Vn.CONTROL:this.signal.emit(r,o,s);break;case Vn.PUBLISH:case Vn.UNPUBLISH:case Vn.RESTART_ICE:case Vn.CALL:o.uid=s,Dr(this.signal,r,o).then(c=>{this.response(t._id,c)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Vn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Vn.RESPONSE:{const{success:c,message:l}=o;this.emit("res-@".concat(n),c?"success":"failed",l);break}}}}splitMessage(t){if(t.length<Dh.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=on(6,"");let s=0,o=800;const c=Math.ceil(t.length/o);for(;t.length>0;){s++;const l={id:i,index:s,total:c,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(l).length>Dh.MAX_MESSAGE_SIZE?o-=50:(n.push(l),t=t.slice(o))}return n.map(l=>JSON.stringify(l))}handleCheckToken(t,n){return t.token!==n?(R.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(n)),this.reset(t.uid)},W("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Dr(this.signal,Vn.CALL,void 0),n=await this.send(Vn.CALL,t);this.signal.emit(ht.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(Uf.ABORT),this.signal.emit(Pt.ON_USER_OFFLINE,{uid:r.uid,reason:pz.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(R.debug("change local token from ".concat(n," to ").concat(n)),this.token=on(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Uf.ABORT)}}x(Dh,"MAX_SIZE",1),x(Dh,"MAX_MESSAGE_SIZE",1024);class qq extends bn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===hn.CONNECTED?this.emit(ht.WS_CONNECTED):t===hn.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===hn.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),x(this,"_disconnectedReason",void 0),x(this,"_websocketReconnectReason",void 0),x(this,"_connectionState",hn.CLOSED),x(this,"reconnectToken",void 0),x(this,"p2pToken",void 0),x(this,"websocket",void 0),x(this,"openConnectionTime",void 0),x(this,"clientId",void 0),x(this,"lastMsgTime",Date.now()),x(this,"uploadCache",[]),x(this,"uploadCacheInterval",void 0),x(this,"rttRolling",new yL(5)),x(this,"pingpongTimer",void 0),x(this,"pingpongTimeoutCount",0),x(this,"joinResponse",void 0),x(this,"multiIpOption",void 0),x(this,"initError",void 0),x(this,"spec",void 0),x(this,"store",void 0),x(this,"_external_signal",void 0),x(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Pt.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Pt.MUTE_AUDIO:case Pt.MUTE_VIDEO:case Pt.ON_P2P_LOST:case Pt.ON_USER_ONLINE:return;case Pt.ON_USER_OFFLINE:const{uid:s}=i._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Xt.UID_BANNED);break;case 15:this.close(Xt.IP_BANNED);break;case 16:this.close(Xt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case nt.ERR_LICENSE_MISSING:this.close(Xt.LICENSE_MISSING);break;case nt.ERR_LICENSE_EXPIRED:this.close(Xt.LICENSE_EXPIRED);break;case nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xt.LICENSE_MINUTES_EXCEEDED);break;case nt.ERR_LICENSE_PERIOD_INVALID:this.close(Xt.LICENSE_PERIOD_INVALID);break;case nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xt.LICENSE_MULTIPLE_SDK_SERVICE);break;case nt.ERR_LICENSE_ILLEGAL:this.close(Xt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new xb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hn.CONNECTED&&this.reconnect("retry",Pr.OFFLINE)}),this.p2pToken=on(6,""),this._external_signal=new Dh(this,this.p2pToken)}async request(t,n,r,i){const s=on(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new Ve((D,A)=>{if(this.connectionState===hn.CONNECTED)return D();const O=()=>{this.off(ht.WS_CLOSED,V),D()},V=()=>{this.off(ht.WS_CONNECTED,O),A(new ue(j.WS_ABORT))};this.once(ht.WS_CONNECTED,O),this.once(ht.WS_CLOSED,V)});if(this.connectionState!==hn.CONNECTING&&this.connectionState!==hn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const p=new Ve((D,A)=>{let O=!1;const V=(G,Z)=>{O=!0,D({isSuccess:G==="success",message:Z||{}}),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.emit(ht.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),V);const U=()=>{A(new ue(j.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.off("res-@".concat(s),V)};this.once(ht.WS_CLOSED,U),this.once(ht.WS_RECONNECTING,U),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||O||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===hn.CLOSED||t===ct.LEAVE)throw new ue(j.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?D.throw():t===ct.JOIN||t===ct.REJOIN?null:(await l(),await this.request(t,n))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=jg(E),y=new ue(j.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:v.desc});return v.action==="success"?m.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===nt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pr.MULTI_IP)):this.reconnect(v.action,Pr.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ve(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ug.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ve((n,r)=>{this.once(ht.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ht.WS_CLOSED,()=>r(this.initError||new ue(j.WS_ABORT))),this.connectionState=hn.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Xt.LEAVE,this.connectionState=hn.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=on(6,""),this._external_signal.clear(),this._external_signal=new Dh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await Dr(this,ht.REQUEST_JOIN_INFO),n=await this.request(ct.JOIN,t);if(!n)return this.emit(ht.REPORT_JOIN_GATEWAY,j.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const r=uh(t.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||Oe(n=Object.values(Vn)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Pt.ON_DATA_STREAM,t)}catch{this.emit(Pt.ON_DATA_STREAM,t)}}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const n=jg(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xt.UID_BANNED),void this.close()):void this.reconnect(n.action,Pr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pr.TIMEOUT):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),W("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(vt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(vt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(vt.CLOSED,()=>{this.connectionState=hn.CLOSED}),this.websocket.on(vt.FAILED,()=>{this._disconnectedReason=Xt.NETWORK_ERROR,this.connectionState=hn.CLOSED}),this.websocket.on(vt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===hn.CONNECTED?this.connectionState=hn.RECONNECTING:this.connectionState=hn.CONNECTING}),this.websocket.on(vt.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(vt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ue&&t.code===j.UNEXPECTED_RESPONSE&&t.data.code===nt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Pr.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(vt.REQUEST_NEW_URLS,(t,n)=>{Dr(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Xq={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Yq(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new qq(n,t)}};function Y6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function q6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Y6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Jq{constructor(t){x(this,"sessionDesc",void 0),x(this,"localCapabilities",void 0),x(this,"rtpCapabilities",void 0),x(this,"candidates",void 0),x(this,"_originCandidates",void 0),x(this,"iceParameters",void 0),x(this,"dtlsParameters",void 0),x(this,"setup",void 0),x(this,"currentMidIndex",void 0),x(this,"cname",void 0),t=Cn(t);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:c,sdkCodec:l,cname:p}=t,m=Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=Cn(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=o,this.localCapabilities=c,this.cname=p;for(let E=0;E<m.mediaDescriptions.length;E++){const v=m.mediaDescriptions[E];if(v.attributes.iceUfrag=n.iceUfrag,v.attributes.icePwd=n.icePwd,v.attributes.fingerprints=r.fingerprints,v.attributes.candidates=i,v.attributes.setup=o,v.media.mediaType==="video"){v.media.fmts=s.videoCodecs.map(A=>A.payloadType.toString(10));const y=s.videoCodecs.filter(A=>{var O,V;return(O=A.rtpMap)===null||O===void 0?void 0:Oe(V=O.encodingName.toLowerCase()).call(V,l)}),D=s.videoCodecs.filter(A=>!Oe(y).call(y,A));v.attributes.payloads=[...y,...D],v.attributes.extmaps=s.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=s.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=s.audioCodecs,v.attributes.extmaps=s.audioExtensions),m.mediaDescriptions[E]=this.mungMediaDesc(v)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return yd(this.sessionDesc)}send(t,n,r){const{ssrcs:i,ssrcGroups:s}=Gg(n,this.cname),o=this.sessionDesc.mediaDescriptions.find(p=>t===Be.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio"),c=i[0].attributes.label,l=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(s),{id:c,mslabel:l}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],i=[],s=[];n.attributes.ssrcs.forEach(o=>{Oe(t).call(t,o.attributes.label||"")?s.push(o):r.push(o)}),n.attributes.ssrcGroups.forEach(o=>{var c;Oe(c=s.map(l=>l.ssrcId)).call(c,o.ssrcIds[0])||i.push(o)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((i,s)=>{const o=i._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===o.kind),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],i);this.sessionDesc.mediaDescriptions[c]=l})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(n.forEach(i=>{r.push(q6(q6({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),n.length!==0){switch(t){case Wr.TCP_RELAY:this.candidates=r;break;case Wr.UDP_TCP_RELAY:case Wr.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Cn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Cn(t);return Ff(r,n),jb(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const i=this.sessionDesc.mediaDescriptions.find(o=>t===Be.VIDEO?o.attributes.mid==="video":o.attributes.mid==="audio");if(i){const o=i.attributes.ssrcs.find(c=>c.attributes.label===n);var s;o&&(o.attributes.label=r,(s=o.attributes.msid)===null||s===void 0||s.replace(n,r))}}mungMediaDesc(t){const n=Cn(t);return Vb(n),function(r){const i=r.attributes.extmaps.find(s=>tT(s.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(s=>{const o=s.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");o!==-1&&s.rtcpFeedbacks.splice(o,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var an;function X6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function BT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X6(Object(n),!0).forEach(function(r){x(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Qq=(an=class CE extends cU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Oe(n=Object.keys(Dg)).call(n,t)}))]}constructor(t,n){super(t,n),x(this,"store",void 0),x(this,"peerConnection",void 0),x(this,"remoteSDP",void 0),x(this,"initialOffer",void 0),x(this,"statsFilter",void 0),x(this,"useRTX",!1),x(this,"localCapabilities",void 0),x(this,"localCandidateCount",0),x(this,"allCandidatesReceived",!1),x(this,"establishPromise",void 0),x(this,"mutex",void 0),this.store=n,this.mutex=new jr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(CE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Yw(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Id(t.sdp),r=Wg(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,BT(BT({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new ue(j.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Jq(BT(BT({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new ue(j.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return Js(function*(){const i=yield jt(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map(v=>r.peerConnection.addTrack(v._mediaStreamTrack)),o=yield jt(r.peerConnection.createOffer()),c=Gi(o.sdp),l=t.map(v=>{const y=v._mediaStreamTrack,D=c.mediaDescriptions.find(A=>A.attributes.mid===y.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,O,V){const U=A.attributes.ssrcs.filter(Z=>Z.attributes.label===O),G=A.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(G&&U.length>1){const Z=G.find(Q=>Q.ssrcIds.indexOf(U[0].ssrcId)!==-1);return Z?[{ssrcId:Z.ssrcIds[0],rtx:V?Z.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]}(D,y.id,r.useRTX)});let p;try{p=yield l}catch(v){throw s.forEach(y=>{Nr()&&y.replaceTrack(null),r.peerConnection.removeTrack(y)}),v}const m=r.mungSendOfferSDP(o.sdp,t);r.remoteSDP.receive(t,n,p);const E=r.remoteSDP.toString();return yield jt(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(r.applySendEncodings(s,t)),yield jt(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((v,y)=>{const D=v._mediaStreamTrack.id;return{localSSRC:l[y],id:D}})}catch(s){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{Nr()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,n,i),c=new Ve((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(s)))},1e4),y=D=>{const A=xt();if((A.name==="Safari"&&Number(A.version)===11||qr())&&D.track.id!==s&&D.streams[0].id===o){var O;const V=D.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,s,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(V)}if(D.track.id===s)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(D.track)};this.peerConnection.addEventListener("track",y)}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await c,id:s}}catch(s){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Nr()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(s=>s.active=!1),r.setParameters(i)}})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(Nr()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach(c=>c.active=!0),await s.setParameters(o)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Js(function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration;if(t===Wr.RELAY&&!i)return;if(i){const p=n.peerConnection.getConfiguration(),m=t===Wr.RELAY?"relay":"all";p.iceTransportPolicy!==m&&(R.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(m,"]")),p.iceTransportPolicy=m,n.peerConnection.setConfiguration(p))}t!==Wr.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Id(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString();yield jt(n.peerConnection.setLocalDescription(s)),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){R.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ue(j.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new ue(j.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ue(j.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Ig(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...CE.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...CE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(p=>{var m;return((m=p.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ft().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof mn)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(W("DSCP_TYPE")&&ll()){var o;const p=W("DSCP_TYPE");Oe(o=["very-low","low","medium","high"]).call(o,p)&&(s.networkPriority=p)}const c=n.getParameters(),l=(r=c.encodings)===null||r===void 0?void 0:r[0];l&&Object.assign(l,s),Object.assign(c,i),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await n.setParameters(c)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=Gi(t);return n.forEach((i,s)=>{const o=i._mediaStreamTrack,c=r.mediaDescriptions.find(l=>l.attributes.mid===o.kind);c&&Ff(c,i)}),yd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((s,o)=>{let{id:c,mslabel:l}=s;const{kind:p}=t[o];return new Ve((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),y=D=>{const A=xt();if(A.name==="Safari"&&Number(A.version)===11&&D.track.id!==c&&D.streams[0].id===l){var O;const V=D.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(p,c,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:V,id:c})}if(D.track.id===c)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:D.track,id:c})};this.peerConnection.addEventListener("track",y)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await Ve.all(n)}catch(n){throw new ue(j.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=CE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ye(an.prototype,"connect",[so],Object.getOwnPropertyDescriptor(an.prototype,"connect"),an.prototype),Ye(an.prototype,"stopSending",[so],Object.getOwnPropertyDescriptor(an.prototype,"stopSending"),an.prototype),Ye(an.prototype,"receive",[so],Object.getOwnPropertyDescriptor(an.prototype,"receive"),an.prototype),Ye(an.prototype,"stopReceiving",[so],Object.getOwnPropertyDescriptor(an.prototype,"stopReceiving"),an.prototype),Ye(an.prototype,"muteRemote",[so],Object.getOwnPropertyDescriptor(an.prototype,"muteRemote"),an.prototype),Ye(an.prototype,"unmuteRemote",[so],Object.getOwnPropertyDescriptor(an.prototype,"unmuteRemote"),an.prototype),Ye(an.prototype,"muteLocal",[so],Object.getOwnPropertyDescriptor(an.prototype,"muteLocal"),an.prototype),Ye(an.prototype,"unmuteLocal",[so],Object.getOwnPropertyDescriptor(an.prototype,"unmuteLocal"),an.prototype),Ye(an.prototype,"close",[so],Object.getOwnPropertyDescriptor(an.prototype,"close"),an.prototype),Ye(an.prototype,"updateEncoderConfig",[so],Object.getOwnPropertyDescriptor(an.prototype,"updateEncoderConfig"),an.prototype),Ye(an.prototype,"updateSendParameters",[so],Object.getOwnPropertyDescriptor(an.prototype,"updateSendParameters"),an.prototype),Ye(an.prototype,"replaceTrack",[so],Object.getOwnPropertyDescriptor(an.prototype,"replaceTrack"),an.prototype),Ye(an.prototype,"getRemoteSSRC",[so],Object.getOwnPropertyDescriptor(an.prototype,"getRemoteSSRC"),an.prototype),an);function so(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}const Zq={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Qq(n,t)}},$q={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(Vy.has(e)||!e.track)return;const n={track:e.track};if(cl()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=t.metadata&&t.metadata();l?function(p,m){const{chunk:E,controller:v}=m,y=Td.METADATA;E.data=function(D,A,O){const V=O.byteLength,U=V+Eb+KM,G=_b+gb+U,Z=new ArrayBuffer(D.byteLength+G),Q=new DataView(Z);Q.setUint8(0,HM),Q.setUint16(1,U),Q.setUint8(3,A),Q.setUint16(4,V);for(let re=0;re<V;re++)Q.setUint8(6+re,O[re]);const z=new Uint8Array(Q.buffer);return z.set(new Uint8Array(D),G),z.buffer}(E.data,y,p),v.enqueue(E)}(l,{chunk:o,controller:c}):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new Ve(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=o,await new Ve(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;if(c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id)R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(c.data.getMetadata){const p=t.metadata&&t.metadata();p&&s.port1.postMessage({metadata:p})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Vy.get(e);if(i){Vy.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){R.warning(c&&c.message)}}}Vy.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(Hy.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(cl()&&!qr()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");Iw(Wt.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(l,p,m){var E;const v=vb(new DataView(p.data));if(!v)return m.enqueue(p);const y=l.track.id;LK.set(y,l.track);const D=(E=v.tlv.find(Z=>Z.tag===Td.AUDIO_LEVEL))===null||E===void 0?void 0:E.value;let A=0;typeof D=="number"&&(A=127-D);const O=Math.round(Math.pow(10,A/60)-1),{selected:V,speaker:U}=function(Z,Q){let z=kf.get(Z);if(z||(z=function(re){const he=new YM;return kf.set(re,he),Sa||(Sa=new DK(W("TOPN_SILENCE_THRESHOLD")||500),Sa.on("ActiveSpeakerChanged",Ee=>{Ee!=null&&(By=Ee)})),Sa.addSpeakers([he]),he}(Z)),kf.size<=qM)return{selected:!0,speaker:z};if(!Sa)throw new Error("no active speaker detector");return Sa.levelChanged(z.id,Q),Eh=Sa.loudest.map(re=>re.id),By&&!Oe(Eh).call(Eh,By)&&Eh.length>=qM&&Eh.pop(),{selected:Oe(Eh).call(Eh,z.id)||z.id===By,speaker:z}}(l,O),G=function(Z,Q,z){const re=ya.get(Z)||new kK(Z,Q);return re.score=z,ya.set(Z,re),function(he){if(Wy.set(he,!0),!Gy)return void(Gy=Date.now());const Ee=Date.now();Ee-Gy>1e3&&(Wy.get(he)?Wy.set(he,!1):(XM(he),Wy.delete(he)),Gy=Ee)}(Z),re}(y,l.track,U.energyScore);G.addSample(V),G.active&&(p.data=v.frame.buffer,m.enqueue(p))}(e,o,c):t.enableMetadata||t.enablePts?function(l,p,m,E){const v=new DataView(l.data),y=v.getUint8(0);let D;if((128&y)!=0&&y!==71){const V=function(U){if(U.byteLength<=0)return[];const G=[];let Z=0;for(;Z<U.byteLength;){const z=(128&U.getUint8(Z))>>7,re=127&U.getUint8(Z);if(!(z&&Z+4<=U.byteLength)){Z++;break}{const he=U.getUint32(Z,!1),Ee=(16776192&he)>>10,Re=1023&he;G.push({pt:re,ts_offset:Ee,length:Re,data:new Uint8Array}),Z+=4}}let Q=U.byteLength-Z;for(const z of G){if(z.length>Q)return console.warn("Broken red payload"),[];z.length>0&&(z.data=new Uint8Array(U.buffer,U.byteOffset+Z,z.length),Z+=z.length,Q-=z.length)}if(Q>0){const z={pt:G.length>0?G[G.length-1].pt:0,ts_offset:0,length:Q,data:new Uint8Array(U.buffer,U.byteOffset+Z,Q)};G.push(z)}return G}(v);if(V.length>0){const U=function(G){let Z=0;for(let re=0;re<G.length;re++)Z+=re<G.length-1?4:1,Z+=G[re].length;const Q=new Uint8Array(Z);let z=0;for(let re=0;re<G.length;re++)if(re<G.length-1){const he=(2147483648|(127&G[re].pt)<<24|(262143&G[re].ts_offset)<<10|1023&G[re].length)>>>0;Q[z++]=he>>24&255,Q[z++]=he>>16&255,Q[z++]=he>>8&255,Q[z++]=255&he}else Q[z++]=127&G[re].pt;for(const re of G)Q.set(re.data,z),z+=re.length;return Q}(V.map(G=>{const Z=new Uint8Array(G.length);Z.set(G.data);const Q=vb(new DataView(Z.buffer));return Q!=null&&Q.frame&&(G.data=Q?.frame),D=Q,G}));l.data=U.buffer}}else D=vb(v),D&&(l.data=D.frame.buffer);if(p.enqueue(l),!D)return;const A=D.tlv.find(V=>V.tag===Td.METADATA);A&&m&&A.value instanceof Uint8Array&&m(A.value);const O=D.tlv.find(V=>V.tag===Td.AUDIO_64_BIT_PTS);O&&E&&O.value instanceof Uint8Array&&O.value.length==8&&E(new DataView(O.value.buffer).getBigUint64(0,!0))}(o,c,t.onMetadata,t.onPts):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new Ve(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=o,await new Ve(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(R.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.metadata&&n.onMetadata?n.onMetadata(c.data.metadata):c.data.pts&&n.onPts&&n.onPts(c.data.pts)},n.worker=i}function r(){e.track.removeEventListener("ended",r),function(i){const s=Hy.get(i);if(s){(function(l){const p=kf.get(l);p&&(kf.delete(l),Sa&&(Sa.removeSpeakers([p]),kf.size===0&&(Sa.destroy(),Sa=null)))})(i),XM(i.track.id),Hy.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){R.warning(l&&l.message)}}}(e)}Hy.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(Ky.has(e)||!e.track)return;const n={track:e.track};if(cl()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(c){return void R.error("create video-encoded-streams error",c&&c.message)}const s=[];t.on("sei-to-send",c=>{s.push(c)});const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const p=ZM(new Uint8Array(c.data)),m=s.shift();if(m){const E=function(v,y,D){switch(D){case Cb:return function(A,O){const V=QM(O),U=V.length,G=Math.floor(U/255),Z=U%255,Q=new Uint8Array(6+G+1+U+A.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=6,Q[5]=101;let z=0;for(;z<G;)Q[6+z]=255,z++;return Q[6+z]=Z,z++,Q.set(V,6+z),Q.set(new Uint8Array(A),6+z+U),Q.buffer}(v,y);case Rb:return function(A,O){const V=QM(O),U=V.length,G=Math.floor(U/255),Z=U%255,Q=new Uint8Array(7+G+1+U+1+A.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=78,Q[5]=1,Q[6]=101;let z=0;for(;z<G;)Q[7+z]=255,z++;return Q[7+z]=Z,z++,Q.set(V,7+z),z+=U,Q[7+z]=128,z++,Q.set(new Uint8Array(A),7+z),Q.buffer}(v,y);default:return null}}(c.data,m,p);E&&(c.data=E)}l.enqueue(c)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!Nr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new Ve(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=o,await new Ve(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),t.on("sei-to-send",c=>{s.port1.postMessage({sei:c})}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Ky.get(e);if(i){Ky.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){R.warning(c&&c.message)}}}Ky.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!e.track)return;if(Mg.has(e)){const i=Mg.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(cl()){if(!e.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void R.error("create video-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=function(p,m){switch(m){case Cb:return function(E){const v=new DataView(E.data);let y=0;for(;y+4<E.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===6){let D=y+6,A=0,O=0;for(;(O=v.getUint8(D++))===255;)A+=255;A+=O;const V=JM(E.data,D,A);return new Uint8Array(V)}y++}return null}(p);case Rb:return function(E){const v=new DataView(E.data);let y=0;for(;y+5<E.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===78&&v.getUint8(y+5)===1&&v.getUint8(y+6)===101){let D=y+7,A=0,O=0;for(;(O=v.getUint8(D++))===255;)A+=255;A+=O;const V=JM(E.data,D,A);return new Uint8Array(V)}y++}return null}(p);default:return null}}(o,ZM(new Uint8Array(o.data)));l&&n.onSei&&n.onSei(l),c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const i=Uy(),s=new MessageChannel;await new Ve(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=o,await new Ve(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(R.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.sei&&n.onSei&&n.onSei(c.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const s=Mg.get(i);if(s){Mg.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){R.warning(l&&l.message)}}})(e)}Mg.set(e,n),e.track.addEventListener("ended",r)}},eX={name:"InterceptFrame",create:()=>$q};qw(),$t("PROCESS_ID","process-".concat(on(8,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();R.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Sn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;va[r]=i,Sn[r]=i}})}catch(t){R.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(va.AREAS)&&va.AREAS.length>0&&Gb(va.AREAS,!0);const J6=(e,t,n)=>{R.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),$t(e,t,n)};Nd(Cq,!1),Nd(bq,!1),Nd(sY,!1),Nd(Uq,!1),Nd(Sq,!1),Nd(Xq,!1),Nd(Zq,!1),Nd(eX,!1);const Xn=function(e){const t=new bn,n=e,r={getListeners:t.getListeners.bind(t),on:(i,s)=>(function(o,c){o===Tc.SECURITY_POLICY_VIOLATION&&NV(c,!0)}(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return OV(OV({},n),r)}({__TRACK_LIST__:Rf,VERSION:Qs,BUILD:Qw,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:J6,getParameter:W,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let i;return Ft().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!n)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(t){throw new ae(j.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=qe.reportApiInvoke(null,{name:xn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Tn.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(s&&o&&c),t&&kw()&&Jk(75)&&new s().close()}catch(s){return R.error("check system requirement failed: ",s),!1}let n=!1;const r=xt();r.name===Wt.CHROME&&Number(r.version)>=58&&(_a.engine.name!=="WebKit"||function(){const s=xt();if(Sy()){if(s.os===dr.MAC_OS)return!0;if(s.os===dr.IOS){const o=_a.os.version&&_a.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Wt.FIREFOX&&Number(r.version)>=56||r.name===Wt.OPERA&&Number(r.version)>=45||r.name===Wt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(qr()||Lo())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||nL()||xt().name===Wt.QQ)&&(n=!0),R.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return As.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return As.getRecordingDevices(e)},getCameras:function(e){return As.getCamerasDevices(e)},getElectronScreenSources:JL,getPlaybackDevices:function(e){return As.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=on(5,"client-"),r=qe.reportApiInvoke(null,{id:n,name:xn.CREATE_CLIENT,options:[t],tag:Tn.TRACER});try{(function(i){ir(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ir(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&ir(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Cr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&dL(i.turnServer),i.httpRetryConfig!==void 0&&lL(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&lL(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return($k(16,0)||Nw(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",R.debug("browser not support vp9, force use vp8")),$t("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new oY(Go(Go({forceWaitGatewayResponse:!0},t),{},{role:Oe(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=W("CAMERA_CAPTURE_CONFIG"),n=on(8,"track-cam-"),r=qe.reportApiInvoke(null,{id:n,tag:Tn.TRACER,name:xn.CREATE_CAM_VIDEO_TRACK,options:[un({},e),t]});t&&(e.encoderConfig=t);const i=xy(e);let s=null;R.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await Is({video:i},n)).getVideoTracks()[0]||null}catch(c){throw r.onError(c),c}if(!s){const c=new ue(j.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(c),c.throw(R)}if(e.optimizationMode&&mb(n,s,e,Uo(e.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const c=Uo(e.encoderConfig);e.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}const o=new My(s,e,i,e.scalabiltyMode?Py(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(o.getTrackId()),R.info("create camera video success, trackId:",n),o},createCustomVideoTrack:function(e){const t=on(8,"track-cus-"),n=qe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});W("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new mn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Py(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[rn.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),R.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(v){return ox(v)}(t):void 0;n&&(t="auto");const r=on(8,"track-scr-v-"),i=qe.reportApiInvoke(null,{id:r,tag:Tn.TRACER,name:xn.CREATE_SCREEN_VIDEO_TRACK,options:[un({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=function(v){const y={};v.screenSourceType&&(y.mediaSource=v.screenSourceType),v.extensionId&&cl()&&(y.extensionId=v.extensionId);const{displaySurface:D,selfBrowserSurface:A,surfaceSwitching:O,systemAudio:V,preferCurrentTab:U}=v;(mf(107)||Aw(107)||Pw(93))&&(D&&(ir(D,"displaySurface",["browser","window","monitor"]),y.displaySurface=D),A?(ir(A,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=A):y.selfBrowserSurface="include",O&&(ir(O,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=O)),(mf(105)||Aw(105)||Pw(91))&&V&&(ir(V,"systemAudio",["exclude","include"]),y.systemAudio=V),(mf(94)||Aw(94)||Pw(80))&&U&&(y.preferCurrentTab=!0),v.electronScreenSourceId&&(y.sourceId=v.electronScreenSourceId);const G=v.encoderConfig?rb(v.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:G?G.width:void 0,maxHeight:G?G.height:void 0},G&&(G.frameRate&&(typeof G.frameRate=="number"?(y.mandatory.maxFrameRate=G.frameRate,y.mandatory.minFrameRate=G.frameRate):(y.mandatory.maxFrameRate=G.frameRate.max||G.frameRate.ideal||G.frameRate.exact||void 0,y.mandatory.minFrameRate=G.frameRate.min||G.frameRate.ideal||G.frameRate.exact||void 0),y.frameRate=G.frameRate),G.width&&(y.width=G.width),G.height&&(y.height=G.height)),y}(e);let o=null,c=null;const l=Ft();if(!l.supportShareAudio&&t==="enable"){const v=new ue(j.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(v),v.throw(R)}R.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const p=l.supportShareAudio&&t!=="disable";try{const v=await Is({screen:s,screenAudio:p?n||!0:void 0},r);o=v.getVideoTracks()[0]||null,c=v.getAudioTracks()[0]||null}catch(v){throw i.onError(v),v}if(!o){const v=new ue(j.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(v),v.throw(R)}if(!c&&t==="enable"){o&&o.stop();const v=new ue(j.SHARE_AUDIO_NOT_ALLOWED);return i.onError(v),v.throw(R)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(mb(r,o,e,e.encoderConfig&&rb(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const m=new mn(o,e.encoderConfig?rb(e.encoderConfig):{},e.scalabiltyMode?Py(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[rn.SCREEN_TRACK]);if(!c)return i.onSuccess(m.getTrackId()),R.info("create screen video track success","video:",m.getTrackId()),m;const E=new Ln(c,void 0,on(8,"track-scr-a-"),!1);return i.onSuccess([m.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",m.getTrackId(),"audio:",E.getTrackId()),[m,E]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=W("CAMERA_CAPTURE_CONFIG"),r=on(8,"track-mic-"),i=on(8,"track-cam-"),s=qe.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:Tn.TRACER,name:xn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const o=xy(t),c=ax(e);let l=null,p=null;R.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const v=await Is({audio:c,video:o},"".concat(r,"-").concat(i));l=v.getAudioTracks()[0],p=v.getVideoTracks()[0]}catch(v){throw s.onError(v),v}if(!l||!p){const v=new ue(j.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(v),v.throw(R)}if(t.optimizationMode&&mb(i,p,t,Uo(t.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const v=Uo(t.encoderConfig);t.encoderConfig=v,delete v.bitrateMax,delete v.bitrateMin}const m=new xg(l,e,c,r),E=new My(p,t,o,t.scalabiltyMode?Py(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([m.getTrackId(),E.getTrackId()]),R.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[m,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=on(8,"track-mic-"),n=qe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=ax(e);let i=null;R.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Is({audio:r},t)).getAudioTracks()[0]||null}catch(o){throw n.onError(o),o}if(!i){const o=new ue(j.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(o),o.throw(R)}const s=new xg(i,e,r,t);return n.onSuccess(s.getTrackId()),R.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=on(8,"track-cus-"),n=qe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Ln(e.mediaStreamTrack,e.encoderConfig?Dy(e.encoderConfig):{},t,!1);return R.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},o=on(8,"track-buf-"),c=qe.reportApiInvoke(null,{id:o,tag:Tn.TRACER,name:xn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(W("DISABLE_WEBAUDIO"))throw new ue(j.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);const l=i;if(!(i instanceof AudioBuffer))try{i=await async function(E,v){let y=null;if(typeof E=="string"){const A=Yx.get(E);if(A)return R.debug("use cached audio resource: ",E),A;try{y=(await Ea(()=>Ai.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(O){throw new ue(j.FETCH_AUDIO_FILE_FAILED,O.toString())}}else y=await new Ve((O,V)=>{const U=new FileReader;U.onload=G=>{G.target?O(G.target.result):V(new ue(j.READ_LOCAL_AUDIO_FILE_ERROR))},U.onerror=()=>{V(new ue(j.READ_LOCAL_AUDIO_FILE_ERROR))},U.readAsArrayBuffer(E)});const D=await function(A){const O=Of();return new Ve((V,U)=>{O.decodeAudioData(A,G=>{V(G)},G=>{U(new ue(j.DECODE_AUDIO_FILE_FAILED,G.toString()))})})}(y);return typeof E=="string"&&v&&Yx.set(E,D),D}(i,n)}catch(E){return c.onError(E),E.throw(R)}const p=new IK(i),m=new bK(l,p,r?Dy(r):{},o);return R.info("create buffer source audio track success, trackId:",o),c.onSuccess(m.getTrackId()),m},setAppType:function(e){if(R.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw R.debug("Invalid appType"),new ae(j.INVALID_PARAMS,"invalid app type",e);$t("APP_TYPE",Math.floor(e))},setLogLevel:function(e){R.setLogLevel(e)},enableLogUpload:function(){W("USE_NEW_LOG")?$t("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){W("USE_NEW_LOG")?$t("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new JU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ln||e instanceof Df)){const l=new ae(j.INVALID_TRACK,"the parameter is not a audio track");return n.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Ln?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,o=i;const c=Date.now();return new Ve(l=>{const p=setInterval(()=>{const m=e.getVolumeLevel();s=m>s?m:s,o=m<o?m:o;const E=s-o>1e-4,v=Date.now()-c;if(E||v>t){clearInterval(p);const y=E,D={duration:v,deviceLabel:r,maxVolumeLevel:s,result:y};R.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),n.onSuccess(D),l(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=qe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof mn||e instanceof Pf)){const E=new ae(j.INVALID_TRACK,"the parameter is not a video track");return n.onError(E),E.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof mn?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Nr()||Sy())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let c=0,l=0;try{const E=Date.now();c=await function(v,y,D,A){let O,V=0,U=null;return new Ve((G,Z)=>{function Q(){V>A&&O&&(O(),G(V));const z=D.getContext("2d");if(!z){const Ee=new ae(j.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(Ee.toString()),void Z(Ee)}z.drawImage(v,0,0,160,120);const re=z.getImageData(0,0,D.width,D.height),he=Math.floor(re.data.length/3);if(U){for(let Ee=0;Ee<he;Ee+=3)if(re.data[Ee]!==U[Ee])return V+=1,void(U=re.data);U=re.data}else U=re.data}setTimeout(()=>{O&&(O(),G(V))},y),O=cb(()=>{Q()},30)})}(s,t,o,4),l=Date.now()-E}catch(E){throw n.onError(E),E}zz===Wt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const p=c>4,m={duration:l,changedPicNum:c,deviceLabel:r,result:p};return R.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),p},setArea:Gb,audioElementPlayCenter:Oi,resumeAudioContext:function(){Oi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){cY.processExternalMediaAEC(e)},registerExtensions:function(e){const t=W("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Oe(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=R.extLog,r.reporter.hookApiInvoke=qe.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=W(i)})}),J6("PLUGIN_INFO",t)},ChannelMediaRelayError:xf,ChannelMediaRelayEvent:hl,ChannelMediaRelayState:Ki,RemoteStreamFallbackType:vK,RemoteStreamType:EK,ConnectionDisconnectedReason:Xt,AudienceLatencyLevelType:XH,AREAS:zt,preload:async function(e,t,n,r){return S5(e,t,n,r)}});return Object.defineProperties(Xn,{onAudioAutoplayFailed:{get:()=>Os.onAudioAutoplayFailed,set:e=>{Os.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Os.onAutoplayFailed,set:e=>{Os.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Xn._onSecurityPolicyViolation,set(e){Xn._onSecurityPolicyViolation=e,NV(e)}},__CLIENT_LIST__:{get:()=>W("SHOW_GLOBAL_CLIENT_LIST")?vh:[]}}),As.on(mh.CAMERA_DEVICE_CHANGED,e=>{R.info("camera device changed",JSON.stringify(e)),Xn.onCameraChanged&&Xn.onCameraChanged(e),Xn.safeEmit(Tc.CAMERA_CHANGED,e)}),As.on(mh.RECORDING_DEVICE_CHANGED,e=>{R.info("microphone device changed",JSON.stringify(e)),Xn.onMicrophoneChanged&&Xn.onMicrophoneChanged(e),Xn.safeEmit(Tc.MICROPHONE_CHANGED,e)}),As.on(mh.PLAYOUT_DEVICE_CHANGED,e=>{R.debug("playout device changed",JSON.stringify(e)),Xn.onPlaybackDeviceChanged&&Xn.onPlaybackDeviceChanged(e),Xn.safeEmit(Tc.PLAYBACK_DEVICE_CHANGED,e)}),Oi.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Os.onAudioAutoplayFailed&&Os.onAudioAutoplayFailed()},en.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Os.onAudioAutoplayFailed&&Os.onAudioAutoplayFailed(),Xn.safeEmit(Tc.AUTOPLAY_FAILED)}),en.on(br.STATE_CHANGE,(e,t)=>{R.info("audio context state changed: ".concat(t," => ").concat(e)),Xn.onAudioContextStateChanged&&Xn.onAudioContextStateChanged(e,t),Xn.safeEmit(Tc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Gn.on(gf.NETWORK_STATE_CHANGE,(e,t)=>{R.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Xn),Xn})}(l0)),l0.exports}var rne=nne();const yE=g0(rne);class ine{client=null;callState={isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}};callbacks={};currentChannelInfo=null;isJoining=!1;inactivityTimer=null;lastActivityTime=Date.now();INACTIVITY_TIMEOUT=300*1e3;isRenewingToken=!1;microphoneRetryCount=0;MAX_MICROPHONE_RETRY=2;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=3;isReconnecting=!1;constructor(){yE.setLogLevel(4);try{yE.enableLogUpload(!1)}catch{}try{yE.setLogLevel(2)}catch{}}setCallbacks(h){this.callbacks={...this.callbacks,...h}}getCallState(){return{...this.callState}}async joinChannel(h){if(!this.isJoining)try{this.isJoining=!0,(this.callState.isConnecting||this.callState.isConnected||this.client)&&(await this.forceLeaveChannel(),await new Promise(f=>setTimeout(f,200))),this.callState.isConnecting=!0,this.currentChannelInfo=h,this.client&&(this.client=null),this.client=yE.createClient({mode:"rtc",codec:"vp8"});try{this.client.enableDualStream}catch{}this.setupEventListeners(),await this.createLocalAudioTrack(),await this.client.join(h.appId,h.channelName,h.token,h.uid),this.callState.localAudioTrack?await this.client.publish([this.callState.localAudioTrack]):console.error("       "),this.callState.isConnected=!0,this.callState.isConnecting=!1,this.callbacks.onCallStarted?.(),this.startInactivityTimer(),this.isJoining=!1}catch(f){throw console.error(" Agora   :",f),this.callState.isConnecting=!1,this.isJoining=!1,this.callbacks.onError?.(f),f}}async forceLeaveChannel(){try{if(this.callState.localAudioTrack){try{this.client&&await this.client.unpublish([this.callState.localAudioTrack])}catch{}try{this.callState.localAudioTrack.stop(),this.callState.localAudioTrack.close()}catch{}this.callState.localAudioTrack=null}if(this.client){try{try{typeof this.client.enableLogUpload=="function"&&this.client.enableLogUpload(!1)}catch{}const h=this.client.leave(),f=new Promise((g,S)=>setTimeout(()=>S(new Error("Leave timeout")),3e3));await Promise.race([h,f])}catch{}this.client=null}this.stopInactivityTimer(),this.callState.isConnected=!1,this.callState.isConnecting=!1,this.callState.connectionState="DISCONNECTED",this.callState.remoteAudioTrack=null,this.currentChannelInfo=null,this.isJoining=!1,await new Promise(h=>setTimeout(h,100))}catch(h){console.error("    :",h),this.stopInactivityTimer(),this.callState.isConnected=!1,this.callState.isConnecting=!1,this.callState.connectionState="DISCONNECTED",this.callState.localAudioTrack=null,this.callState.remoteAudioTrack=null,this.currentChannelInfo=null,this.client=null,this.isJoining=!1}}startInactivityTimer(){this.stopInactivityTimer(),this.lastActivityTime=Date.now(),this.inactivityTimer=setInterval(()=>{Date.now()-this.lastActivityTime>=this.INACTIVITY_TIMEOUT&&(console.warn(" 5      ( )"),this.handleInactivityTimeout())},3e4)}stopInactivityTimer(){this.inactivityTimer&&(clearInterval(this.inactivityTimer),this.inactivityTimer=null)}updateActivity(){this.lastActivityTime=Date.now()}async handleInactivityTimeout(){try{console.warn("   -   "),this.callbacks.onError?.(new Error("     .")),await this.leaveChannel()}catch(h){console.error("   :",h)}}async leaveChannel(){try{if(this.stopInactivityTimer(),this.callState.localAudioTrack&&this.client){try{await this.client.unpublish([this.callState.localAudioTrack])}catch(h){console.error("      :",h)}this.callState.localAudioTrack.stop(),this.callState.localAudioTrack.close(),this.callState.localAudioTrack=null}if(this.callState.remoteAudioTrack&&(this.callState.remoteAudioTrack.stop(),this.callState.remoteAudioTrack=null),this.client){try{try{typeof this.client.enableLogUpload=="function"&&this.client.enableLogUpload(!1)}catch{}await this.client.leave()}catch(h){console.error("   :",h)}this.client=null}this.callState={isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},this.isJoining=!1,this.currentChannelInfo=null,this.callbacks.onCallEnded?.()}catch(h){throw console.error("Agora   :",h),this.callbacks.onError?.(h),h}}async toggleMute(){try{if(!this.callState.localAudioTrack)throw new Error("   .");const h=!this.callState.isMuted;return await this.callState.localAudioTrack.setMuted(h),this.callState.isMuted=h,h}catch(h){throw console.error("  :",h),this.callbacks.onError?.(h),h}}async setMuted(h){try{if(!this.callState.localAudioTrack)throw new Error("   .");await this.callState.localAudioTrack.setMuted(h),this.callState.isMuted=h}catch(f){throw console.error("   :",f),this.callbacks.onError?.(f),f}}async toggleSpeaker(){try{const h=!this.callState.isSpeakerOn;return this.callState.remoteAudioTrack&&await this.callState.remoteAudioTrack.setVolume(h?100:0),this.callState.isSpeakerOn=h,h}catch(h){throw console.error("  :",h),this.callbacks.onError?.(h),h}}async setVolume(h){try{if(h<0||h>100)throw new Error(" 0-100   .");this.callState.volume=h,this.callState.remoteAudioTrack&&await this.callState.remoteAudioTrack.setVolume(h)}catch(f){throw console.error("  :",f),this.callbacks.onError?.(f),f}}async createLocalAudioTrack(){try{this.callState.localAudioTrack=await yE.createMicrophoneAudioTrack({encoderConfig:"music_standard",AEC:!0,ANS:!0,AGC:!0}),this.microphoneRetryCount=0}catch(h){if(console.error("    :",h),h instanceof Error&&(h.message.includes("Permission denied")||h.message.includes("NotAllowedError")||h.message.includes("PERMISSION_DENIED"))&&(console.error("   "),this.callbacks.onMicrophonePermissionDenied?.(),this.microphoneRetryCount<this.MAX_MICROPHONE_RETRY))return this.microphoneRetryCount++,console.warn(`    ... (${this.microphoneRetryCount}/${this.MAX_MICROPHONE_RETRY})`),await new Promise(f=>setTimeout(f,3e3)),this.createLocalAudioTrack();throw h}}setupEventListeners(){this.client&&(this.client.on("connection-state-change",(h,f,g)=>{this.callState.connectionState=h,this.callbacks.onConnectionStateChange?.(h),h==="DISCONNECTED"&&(this.callState.isConnected=!1,g==="LEAVE"?(this.reconnectAttempts=0,this.isReconnecting=!1):(console.error("    :",g),this.handleUnexpectedDisconnection(g)))}),this.client.on("user-joined",h=>{this.callbacks.onUserJoined?.(h.uid.toString())}),this.client.on("user-left",(h,f)=>{this.callbacks.onUserLeft?.(h.uid.toString())}),this.client.on("user-published",async(h,f)=>{if(f==="audio"){await this.client.subscribe(h,f);const g=h.audioTrack;g&&(g.play(),this.updateActivity())}}),this.client.on("user-unpublished",(h,f)=>{f==="audio"&&this.callbacks.onAudioTrackUnsubscribed?.(h.uid.toString())}),this.client.on("user-audio-track-subscribed",(h,f)=>{this.callState.remoteAudioTrack=f,this.callbacks.onAudioTrackSubscribed?.(h.uid.toString(),f),this.updateActivity()}),this.client.on("token-privilege-will-expire",()=>{console.warn(" Agora RTC  30   -  "),!this.isRenewingToken&&(this.isRenewingToken=!0,this.callbacks.onTokenPrivilegeWillExpire?.())}),this.client.on("token-privilege-did-expire",()=>{console.error(" Agora RTC   -   "),this.callbacks.onTokenPrivilegeDidExpire?.()}),this.client.on("network-quality",h=>{const f={uplinkNetworkQuality:h.uplinkNetworkQuality,downlinkNetworkQuality:h.downlinkNetworkQuality};this.callState.networkQuality=f,this.callbacks.onNetworkQualityChange?.(f)}),this.client.on("exception",h=>{console.error(" Agora SDK  :",h);const f=String(h.code||"");f==="FRAMERATE_INPUT_TOO_LOW"||f==="FRAMERATE_SENT_TOO_LOW"||f==="SEND_VIDEO_BITRATE_TOO_LOW"||f==="RECV_VIDEO_DECODE_FAILED"||this.callbacks.onException?.({code:f,msg:String(h.msg||""),uid:String(h.uid||"unknown")})}))}getNetworkQualityLabel(h){return{0:"",1:"",2:"",3:"",4:"",5:"",6:""}[h]}async handleUnexpectedDisconnection(h){if(!this.isReconnecting){if(this.reconnectAttempts>=this.MAX_RECONNECT_ATTEMPTS){console.error(`    (${this.MAX_RECONNECT_ATTEMPTS}) `),this.callbacks.onError?.(new Error("    .  ."));return}this.isReconnecting=!0,this.reconnectAttempts++,console.warn(`   ... (${this.reconnectAttempts}/${this.MAX_RECONNECT_ATTEMPTS})`);try{await new Promise(f=>setTimeout(f,2e3)),this.currentChannelInfo&&this.client&&(await this.client.join(this.currentChannelInfo.appId,this.currentChannelInfo.channelName,this.currentChannelInfo.token,this.currentChannelInfo.uid),this.callState.localAudioTrack&&await this.client.publish([this.callState.localAudioTrack]),this.callState.isConnected=!0,this.isReconnecting=!1,console.log("  "))}catch(f){console.error("  :",f),this.isReconnecting=!1,this.reconnectAttempts<this.MAX_RECONNECT_ATTEMPTS?(console.warn(" 3   ..."),setTimeout(()=>{this.handleUnexpectedDisconnection(h)},3e3)):this.callbacks.onError?.(new Error("  .    ."))}}}async getCallStatistics(){try{if(!this.client)return console.warn(" Agora     "),null;const h=await this.client.getRTCStats();let f=null;if(this.callState.localAudioTrack)try{f=this.callState.localAudioTrack.getStats()}catch{}let g=null;if(this.callState.remoteAudioTrack)try{g=this.callState.remoteAudioTrack.getStats()}catch{}return{duration:h.Duration||0,sendBytes:h.SendBytes,receiveBytes:h.RecvBytes,sendBitrate:h.SendBitrate,receiveBitrate:h.RecvBitrate,audioSendBytes:f?.sendBytes,audioReceiveBytes:g?.receiveBytes,audioSendBitrate:f?.sendBitrate,audioReceiveBitrate:g?.receiveBitrate,sendPacketsLost:f?.sendPacketsLost,receivePacketsLost:g?.receivePacketsLost,userCount:h.UserCount,lastNetworkQuality:{...this.callState.networkQuality}}}catch(h){return console.error("    :",h),null}}async renewToken(h){try{if(!this.client)throw new Error("Agora   .");await this.client.renewToken(h),this.currentChannelInfo&&(this.currentChannelInfo.token=h),this.isRenewingToken=!1}catch(f){throw this.isRenewingToken=!1,console.error(" Agora RTC   :",f),f}}getCurrentChannelInfo(){return this.currentChannelInfo?{...this.currentChannelInfo}:null}async destroy(){try{await this.leaveChannel(),this.callbacks={}}catch(h){console.error("Agora   :",h)}}}let r1=null;const sne=()=>(r1||(r1=new ine),r1),J1=()=>{const{callId:u,matchingId:h,partner:f,agoraChannelInfo:g,isInCall:S,isConnecting:C,callStartTime:I,agoraState:N,error:k,startCall:M,endCall:F,updateConnectingState:B,updateAgoraState:q,setError:K,clearPartner:ie}=sj(),X=ee.useRef(new Set),te=3600*1e3,ce=ee.useRef(null);ee.useEffect(()=>{},[f]);const $=sne(),le=x0(),ne=UE(),de=ee.useCallback(async()=>{try{if(!u){console.error(" callId    ");return}const{getStoredToken:Xe}=await s0(async()=>{const{getStoredToken:De}=await Promise.resolve().then(()=>QT);return{getStoredToken:De}},void 0),We=Xe();We&&ne.setToken(We);const Ae=await ne.renewRtcToken(u);await $.renewToken(Ae.rtcToken)}catch(Xe){console.error(" RTC   :",Xe),K("   .      .")}},[u,ne,$,K]),be=ee.useCallback(async()=>{console.error(" RTC   -   "),K("    .");try{await $.leaveChannel(),F()}catch(Xe){console.error("     :",Xe)}},[K,$,F]),Se=ee.useCallback(()=>{ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{console.warn("   (60)  -   ( )"),K("  (60)    ."),je()},te)},[K]),fe=ee.useCallback(()=>{ce.current&&(clearTimeout(ce.current),ce.current=null)},[]),ye=ee.useCallback(async Xe=>{try{if(Xe.callId&&X.current.has(Xe.callId)||S||C)return;Xe.callId&&X.current.add(Xe.callId),M(Xe),B(!0);const We={onConnectionStateChange:De=>{q($.getCallState())},onUserJoined:De=>{},onTokenPrivilegeWillExpire:()=>{de()},onTokenPrivilegeDidExpire:()=>{console.error(" RTC   -  "),be()},onNetworkQualityChange:De=>{q($.getCallState()),De.uplinkNetworkQuality>=5||De.downlinkNetworkQuality>=5},onException:De=>{console.error(" Agora SDK :",De),(De.code==="DEVICE_NOT_FOUND"||De.code==="UNEXPECTED_ERROR")&&K(`   : ${De.msg}`)},onMicrophonePermissionDenied:()=>{console.error("   "),K("  .     .")},onUserLeft:De=>{const ze=sj.getState();if(ze.partner?.id&&String(De)===String(ze.partner.id)){if(ze.callId&&ze.partner.id)try{le.sendCallEndNotification(ze.callId,ze.partner.id)}catch(me){console.error("   WebSocket   :",me)}$.leaveChannel().catch(me=>{console.error("Agora   :",me)}),F()}},onAudioTrackSubscribed:(De,ze)=>{q($.getCallState())},onAudioTrackUnsubscribed:De=>{q($.getCallState())},onCallStarted:()=>{B(!1),q($.getCallState()),Se()},onCallEnded:()=>{F()},onError:De=>{console.error("Agora :",De),K(De.message)}};$.setCallbacks(We);const Ae={appId:"27a8d306ea82463f81a2fbc033c7570c",channelName:Xe.channelName,token:Xe.rtcToken,uid:String(Xe.agoraUid)};try{await $.joinChannel(Ae)}catch(De){throw console.error(" Agora   :",De),De}}catch(We){console.error("  :",We),K(We instanceof Error?We.message:"  ."),B(!1)}},[$,M,B,q,F,K,S,C,Se,de,be]),je=ee.useCallback(async()=>{try{if(!u)return;const Xe=f;let We=null;try{We=await $.getCallStatistics()}catch(Ae){console.error("     ():",Ae)}if(await $.leaveChannel(),We)try{const{getStoredToken:Ae}=await s0(async()=>{const{getStoredToken:yt}=await Promise.resolve().then(()=>QT);return{getStoredToken:yt}},void 0),De=Ae();De&&ne.setToken(De);const ze=We.lastNetworkQuality?.uplinkNetworkQuality||0,me=We.lastNetworkQuality?.downlinkNetworkQuality||0,ke=yt=>yt===0?"":yt<=2?"":yt===3?"":yt===4?"":"",at=`: ${ke(ze)}, : ${ke(me)}`,ot=(We.sendBytes||0)+(We.receiveBytes||0),Ot=Number((ot/(1024*1024)).toFixed(2)),Gt=Number(((ze+me)/2).toFixed(1));await ne.sendCallStatistics(u,{duration:We.duration||0,sendBytes:We.sendBytes||0,receiveBytes:We.receiveBytes||0,sendBitrate:We.sendBitrate||0,receiveBitrate:We.receiveBitrate||0,audioSendBytes:We.audioSendBytes||0,audioReceiveBytes:We.audioReceiveBytes||0,uplinkNetworkQuality:ze,downlinkNetworkQuality:me,networkQualityDescription:at,totalDataUsageMB:Ot,averageNetworkQuality:Gt})}catch{}try{const{getStoredToken:Ae}=await s0(async()=>{const{getStoredToken:ze}=await Promise.resolve().then(()=>QT);return{getStoredToken:ze}},void 0),De=Ae();De&&ne.setToken(De),await ne.leaveChannel(u)}catch(Ae){console.error(" 4.   API  :",Ae)}try{const{getStoredToken:Ae}=await s0(async()=>{const{getStoredToken:ze}=await Promise.resolve().then(()=>QT);return{getStoredToken:ze}},void 0),De=Ae();De&&ne.setToken(De),await ne.endCall(u)}catch(Ae){Ae instanceof Error&&Ae.message.includes("  ")||console.error(" 5.   API  :",Ae)}if(Xe?.id)if(!le.getConnectionState().isConnected)console.error(" WebSocket   -   ");else try{le.sendCallEndNotification(u,Xe.id)}catch(De){console.error("   WebSocket   :",De)}fe(),$.setCallbacks({}),F(),await new Promise(Ae=>setTimeout(Ae,100))}catch(Xe){console.error("  :",Xe),K(Xe instanceof Error?Xe.message:"  .")}},[$,F,K,u,ne,f,le,fe]),Je=ee.useCallback(async()=>{try{await $.toggleMute(),q($.getCallState())}catch(Xe){console.error("  :",Xe),K(Xe instanceof Error?Xe.message:"  .")}},[$,q,K]),Ue=ee.useCallback(async()=>{try{await $.toggleSpeaker(),q($.getCallState())}catch(Xe){console.error("  :",Xe),K(Xe instanceof Error?Xe.message:"  .")}},[$,q,K]),xe=ee.useCallback(async Xe=>{try{await $.setVolume(Xe),q($.getCallState())}catch(We){console.error("  :",We),K(We instanceof Error?We.message:"  .")}},[$,q,K]),Ge=ee.useCallback(()=>I?Math.floor((Date.now()-I.getTime())/1e3):0,[I]),dt=ee.useCallback(Xe=>{Xe.type==="call_end"&&Xe.callId===u&&(fe(),$.leaveChannel().catch(We=>{}),F())},[u,$,F,fe]);return ee.useEffect(()=>(le.onCallEndNotificationCallback(dt),()=>{}),[le,dt]),ee.useEffect(()=>()=>{fe()},[fe]),{callId:u,matchingId:h,partner:f,agoraChannelInfo:g,isInCall:S,isConnecting:C,agoraState:N,error:k,callDuration:Ge(),handleCallStart:ye,handleEndCall:je,toggleMute:Je,toggleSpeaker:Ue,setVolume:xe,setError:K,clearPartner:ie}};function _F({selectedCategory:u,onCancel:h,onConnected:f}){const[g,S]=ee.useState(""),{queuePosition:C}=X1(),{isInCall:I,isConnecting:N,error:k,handleCallStart:M}=J1(),F=x0(),B=ee.useRef(new Set),q=30*1e3,K=ee.useRef(null);ee.useEffect(()=>{const te=setInterval(()=>{S(ce=>ce==="..."?"":ce+".")},500);return()=>clearInterval(te)},[]),ee.useEffect(()=>{I&&!N&&f()},[I,N,f]);const ie=ee.useCallback(te=>{te.callId&&B.current.has(te.callId)||I||N||(te.callId&&B.current.add(te.callId),M(te))},[M,I,N]),X=ee.useCallback(te=>{},[]);return ee.useEffect(()=>(F.onCallStartNotificationCallback(ie),F.onMatchingNotificationCallback(X),()=>{}),[F,ie,X]),ee.useEffect(()=>(N&&!I?K.current=setTimeout(()=>{console.warn("   (30) -   ( )"),alert("   .  ."),h()},q):K.current&&(clearTimeout(K.current),K.current=null),()=>{K.current&&(clearTimeout(K.current),K.current=null)}),[N,I,h]),ee.useEffect(()=>{k&&console.error("  :",k)},[k]),P.jsxs("div",{className:"min-h-screen flex flex-col relative safe-area-page pt-6",style:{background:`linear-gradient(0deg, rgba(120, 90, 0, 0.20) 0%, rgba(120, 90, 0, 0.20) 100%), 
                    radial-gradient(138.99% 139.71% at 10.56% -25.76%, rgba(235, 161, 0, 0.80) 0%, rgba(245, 69, 53, 0.80) 100%)`},children:[P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx("div",{className:"bg-white px-4 py-2 rounded",children:P.jsxs("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:[" : ",pF(u)]})})}),P.jsx("div",{className:"flex justify-center mt-16",children:P.jsx("h1",{className:"text-white font-pretendard text-4xl font-medium",children:"  "})}),P.jsx("div",{className:"flex justify-center mt-20",children:P.jsx("div",{className:"relative",children:P.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 65 65",fill:"none",className:"animate-spin",style:{transform:"rotate(-90deg)"},children:[P.jsx("mask",{id:"path-1-inside-1_6652_403",fill:"white",children:P.jsx("path",{d:"M32.0187 0.000213623C49.7021 0.000213623 64.0374 14.3355 64.0374 32.0189C64.0374 49.7023 49.7021 64.0376 32.0187 64.0376C14.3353 64.0376 0 49.7023 0 32.0189C0 14.3355 14.3353 0.000213623 32.0187 0.000213623Z"})}),P.jsx("path",{d:"M32.0187 0.000213623L32.0187 9.339C44.5445 9.339 54.6986 19.4931 54.6986 32.0189L64.0374 32.0189H73.3762C73.3762 9.1778 54.8598 -9.33857 32.0187 -9.33857V0.000213623ZM64.0374 32.0189L54.6986 32.0189C54.6986 44.5447 44.5445 54.6988 32.0187 54.6988V64.0376V73.3764C54.8598 73.3764 73.3762 54.86 73.3762 32.0189H64.0374ZM32.0187 64.0376V54.6988C19.4929 54.6988 9.33879 44.5447 9.33879 32.0189H0H-9.33879C-9.33879 54.86 9.17759 73.3764 32.0187 73.3764V64.0376ZM0 32.0189H9.33879C9.33879 19.4931 19.4929 9.339 32.0187 9.339L32.0187 0.000213623V-9.33857C9.17759 -9.33857 -9.33879 9.1778 -9.33879 32.0189H0Z",fill:"url(#gradient)",mask:"url(#path-1-inside-1_6652_403)"}),P.jsx("defs",{children:P.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[P.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0)"}),P.jsx("stop",{offset:"100%",stopColor:"rgba(255,255,255,1)"})]})})]})})}),P.jsx("div",{className:"flex-1 flex items-center justify-center px-5",children:P.jsx("div",{className:"text-center",children:P.jsxs("p",{className:"text-white font-crimson text-2xl md:text-3xl font-bold leading-9",children:["   ",P.jsx("br",{})," ",g]})})}),P.jsx("div",{className:"px-5 pb-8 md:pb-12",children:P.jsx("div",{className:"h-20 md:h-24 relative",children:P.jsx("button",{onClick:h,className:"w-full h-14 md:h-16 bg-white rounded-lg font-crimson text-xl md:text-2xl font-bold text-orange-500 hover:bg-gray-50 transition-colors",children:""})})})]})}function gF({selectedCategory:u,onEndCall:h}){const[f,g]=ee.useState(0),{partner:S,agoraState:C,callDuration:I,isInCall:N,handleEndCall:k,toggleSpeaker:M,setError:F,error:B}=J1();ee.useEffect(()=>{},[S]),ee.useEffect(()=>{!N&&S&&setTimeout(()=>{h()},100)},[N,S,h]),ee.useEffect(()=>{const te=$=>{if(N)return $.preventDefault(),$.returnValue="  .   ?",$.returnValue},ce=()=>{N&&k().catch($=>{console.error("     :",$)})};return window.addEventListener("beforeunload",te),window.addEventListener("unload",ce),()=>{window.removeEventListener("beforeunload",te),window.removeEventListener("unload",ce)}},[N,k]);const q=te=>{const ce=Math.floor(te/60),$=te%60;return`${ce.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`},K=async()=>{try{await k(),h()}catch(te){console.error("  :",te),te instanceof Error&&te.message.includes("  ")?h():F("  .")}};ee.useEffect(()=>{const te=setInterval(()=>{g(ce=>(ce+1)%5)},200);return()=>clearInterval(te)},[]);const X=(te=>te===0?{color:"text-gray-400",bars:0,label:""}:te===1||te===2?{color:"text-green-400",bars:3,label:""}:te===3?{color:"text-yellow-400",bars:2,label:""}:te===4?{color:"text-orange-400",bars:1,label:""}:{color:"text-red-400",bars:1,label:""})(C.networkQuality?.downlinkNetworkQuality||0);return P.jsxs("div",{className:"min-h-screen flex flex-col relative safe-area-page pt-6",style:{background:`linear-gradient(0deg, rgba(120, 90, 0, 0.20) 0%, rgba(120, 90, 0, 0.20) 100%), 
                    radial-gradient(138.99% 139.71% at 10.56% -25.76%, rgba(235, 161, 0, 0.80) 0%, rgba(245, 69, 53, 0.80) 100%)`},children:[P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx("div",{className:"bg-white px-4 py-2 rounded",children:P.jsxs("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:[" : ",pF(u)]})})}),P.jsx("div",{className:"absolute top-20 right-8",children:P.jsxs("div",{className:"flex items-center gap-2 bg-black bg-opacity-30 px-3 py-2 rounded-full",children:[P.jsxs("div",{className:"flex items-end gap-0.5 h-4",children:[P.jsx("div",{className:`w-1 h-2 rounded-sm ${X.bars>=1?X.color:"bg-gray-600"}`}),P.jsx("div",{className:`w-1 h-3 rounded-sm ${X.bars>=2?X.color:"bg-gray-600"}`}),P.jsx("div",{className:`w-1 h-4 rounded-sm ${X.bars>=3?X.color:"bg-gray-600"}`})]}),(C.networkQuality?.downlinkNetworkQuality||0)>=4&&P.jsx("span",{className:`text-xs font-pretendard ${X.color}`,children:X.label})]})}),P.jsxs("div",{className:"flex flex-col items-center justify-center mt-8 gap-1",children:[P.jsxs("div",{className:"flex items-center gap-1",children:[P.jsx("span",{className:"text-white font-crimson text-3xl font-bold",children:S?.nickname||""}),P.jsx("span",{className:"text-white font-pretendard text-3xl font-normal",children:""})]}),P.jsx("span",{className:"text-white font-pretendard text-4xl font-normal",children:""})]}),P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx("div",{className:"w-32 h-32 rounded-3xl bg-orange-100 flex items-center justify-center",children:P.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",children:[P.jsx("path",{d:"M40.294 41.162C46.589 41.162 51.696 36.055 51.696 29.76C51.696 23.465 46.589 18.358 40.294 18.358C34 18.358 28.893 23.465 28.893 29.76C28.893 36.055 34 41.162 40.294 41.162Z",fill:"#EE9049"}),P.jsx("path",{d:"M40.2927 44.504C25.6233 44.504 19.9185 54.507 19.9185 59.1582C19.9185 63.8094 32.0641 65.0489 40.2927 65.0489C48.5213 65.0489 60.6669 63.8094 60.6669 59.1582C60.6669 54.507 54.9621 44.504 40.2927 44.504Z",fill:"#EE9049"})]})})}),P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx("span",{className:"text-white font-crimson text-2xl font-normal",children:q(I)})}),P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx("div",{className:"flex items-center justify-center gap-2",children:[0,1,2,3,4].map(te=>P.jsx("div",{className:`w-2 h-2 bg-white rounded-full transition-opacity duration-200 ${f===te?"opacity-100":"opacity-40"}`},te))})}),B&&P.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50",children:P.jsx("div",{className:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg max-w-md",children:P.jsx("p",{className:"text-center font-pretendard",children:B})})}),P.jsx("div",{className:"flex-1 flex items-end justify-center pb-16",children:P.jsxs("div",{className:"flex items-center justify-between w-80",children:[P.jsxs("div",{className:"flex flex-col items-center gap-4",children:[P.jsx("button",{onClick:M,className:`w-20 h-20 rounded-full flex items-center justify-center transition-colors ${C.isSpeakerOn?"bg-white bg-opacity-20":"bg-red-500 bg-opacity-50"}`,children:P.jsx("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",children:P.jsx("path",{d:"M23.1549 16.3334C22.4369 16.3334 21.8549 15.7513 21.8549 15.0334C21.8549 14.3154 22.4369 13.7334 23.1549 13.7334H26.7C27.418 13.7334 28 14.3154 28 15.0334C28 15.7513 27.418 16.3334 26.7 16.3334H23.1549ZM24.5798 26.9517C24.1486 27.5287 23.3292 27.6426 22.757 27.205L19.8968 25.0174C19.3336 24.5866 19.2219 23.7829 19.6464 23.2149C20.0776 22.638 20.8968 22.5242 21.4689 22.9617L24.3293 25.1491C24.8925 25.5798 25.0042 26.3836 24.5798 26.9517ZM21.4037 7.03847C20.8315 7.47612 20.0121 7.36225 19.5809 6.78516C19.1564 6.21715 19.2681 5.41337 19.8313 4.9826L22.6915 2.79506C23.2637 2.35741 24.0832 2.47128 24.5144 3.04838C24.9388 3.61639 24.8271 4.42017 24.2639 4.85093L21.4037 7.03847ZM3 19.3667C1.89543 19.3667 1 18.4713 1 17.3667V12.7C1 11.5955 1.89543 10.7 3 10.7H7.3087L12.8842 5.01477C13.5113 4.37534 14.5982 4.81934 14.5982 5.71495V24.3518C14.5982 25.2474 13.5113 25.6914 12.8842 25.052L7.3087 19.3667H3Z",fill:"white"})})}),P.jsx("span",{className:"text-white font-crimson text-lg font-bold",children:""})]}),P.jsxs("div",{className:"flex flex-col items-center gap-4",children:[P.jsx("button",{onClick:K,className:"w-20 h-20 rounded-full bg-red-500 flex items-center justify-center",children:P.jsx("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",children:P.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.8823 14.9998L24.2533 7.62879C24.7727 7.10936 24.7727 6.26593 24.2533 5.7465C23.7339 5.22708 22.8904 5.22708 22.371 5.7465L15 13.1175L7.629 5.7465C7.10958 5.22708 6.26615 5.22708 5.74672 5.7465C5.22729 6.26593 5.22729 7.10936 5.74672 7.62879L13.1177 14.9998L5.74672 22.3708C5.22729 22.8902 5.22729 23.7336 5.74672 24.2531C6.26615 24.7725 7.10958 24.7725 7.629 24.2531L15 16.8821L22.371 24.2531C22.8904 24.7725 23.7339 24.7725 24.2533 24.2531C24.7727 23.7336 24.7727 22.8902 24.2533 22.3708L16.8823 14.9998Z",fill:"white"})})}),P.jsx("span",{className:"text-white font-crimson text-lg font-bold",children:" "})]})]})})]})}function EF({selectedCategory:u,onCallAgain:h,onSelectInterests:f,onGoHome:g}){const[S,C]=ee.useState(null),[I,N]=ee.useState(!1),[k,M]=ee.useState(!1),{partner:F,clearPartner:B,callId:q}=J1(),K=UE();ee.useEffect(()=>{},[F,q]);const ie=async()=>{if(!S||!q){console.error("   callId .");return}N(!0);try{const X={call_id:parseInt(q),feedback_type:S==="good"?"POSITIVE":"NEGATIVE",negative:S==="bad",positive:S==="good"},te=uo();if(te)K.setToken(te);else throw new Error("  .  .");await K.submitEvaluation(X),M(!0),B(),setTimeout(()=>{M(!1),g()},2e3)}catch(X){console.error("   :",X),alert("  .  .")}finally{N(!1)}};return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col relative safe-area-page",children:[k&&P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:P.jsxs("div",{className:"bg-white rounded-2xl p-8 mx-4 max-w-sm w-full text-center",children:[P.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:P.jsx("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",className:"text-green-600",children:P.jsx("path",{d:"M26.6667 8L11.3333 23.3333L5.33334 17.3333",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:" !"}),P.jsxs("p",{className:"text-gray-600",children:[S==="good"?"":""," ."]})]})}),P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx("h1",{className:"text-orange-500 font-crimson text-2xl font-bold",children:" "})}),P.jsxs("div",{className:"flex flex-col items-center justify-center mt-8 gap-3",children:[P.jsxs("div",{className:"flex items-center gap-1",children:[P.jsx("span",{className:"text-gray-900 font-crimson text-4xl font-bold",children:F?.nickname||""}),P.jsx("span",{className:"text-gray-900 font-pretendard text-4xl font-normal",children:""})]}),P.jsx("span",{className:"text-gray-900 font-pretendard text-4xl font-normal",children:" ?"})]}),P.jsxs("div",{className:"flex gap-4 px-5 mt-12",children:[P.jsxs("button",{onClick:()=>C("bad"),className:`flex-1 h-36 rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all ${S==="bad"?"border-orange-400 bg-orange-50":"border-gray-300 bg-gray-100"}`,children:[P.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",fill:"none",children:[P.jsx("path",{d:"M7.5 40C6.16667 40 5 39.5 4 38.5C3 37.5 2.5 36.3333 2.5 35V30C2.5 29.7083 2.53125 29.3958 2.59375 29.0625C2.65625 28.7292 2.75 28.4167 2.875 28.125L10.375 10.5C10.75 9.66667 11.375 8.95833 12.25 8.375C13.125 7.79167 14.0417 7.5 15 7.5H35C36.375 7.5 37.5521 7.98958 38.5312 8.96875C39.5104 9.94792 40 11.125 40 12.5V37.9375C40 38.6042 39.8646 39.2396 39.5938 39.8438C39.3229 40.4479 38.9583 40.9792 38.5 41.4375L24.9375 54.9375C24.3125 55.5208 23.5729 55.875 22.7188 56C21.8646 56.125 21.0417 55.9792 20.25 55.5625C19.4583 55.1458 18.8854 54.5625 18.5312 53.8125C18.1771 53.0625 18.1042 52.2917 18.3125 51.5L21.125 40H7.5ZM50 7.5C51.375 7.5 52.5521 7.98958 53.5312 8.96875C54.5104 9.94792 55 11.125 55 12.5V35C55 36.375 54.5104 37.5521 53.5312 38.5313C52.5521 39.5104 51.375 40 50 40C48.625 40 47.4479 39.5104 46.4688 38.5313C45.4896 37.5521 45 36.375 45 35V12.5C45 11.125 45.4896 9.94792 46.4688 8.96875C47.4479 7.98958 48.625 7.5 50 7.5Z",fill:"url(#paint0_radial_bad)"}),P.jsx("defs",{children:P.jsxs("radialGradient",{id:"paint0_radial_bad",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(36 -44 104.92 102.906 15.5 59.5)",gradientUnits:"userSpaceOnUse",children:[P.jsx("stop",{stopColor:"#5D5D5D"}),P.jsx("stop",{offset:"1",stopColor:"#9E9B9B"})]})})]}),P.jsx("span",{className:"text-gray-900 font-crimson text-2xl font-bold",children:""})]}),P.jsxs("button",{onClick:()=>C("good"),className:`flex-1 h-36 rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all ${S==="good"?"border-orange-400 bg-orange-50":"border-gray-300 bg-gray-100"}`,children:[P.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",fill:"none",children:[P.jsx("path",{d:"M27.3539 51.2033C28.9615 52.2656 31.037 52.2656 32.6446 51.2033C37.7481 47.8307 48.8704 39.7751 53.6589 30.7582C59.9748 18.8635 52.558 7 42.7566 7C37.1687 7 33.8065 9.91945 31.9478 12.4288C30.9687 13.7511 29.0328 13.7511 28.0522 12.4288C26.1935 9.91945 22.8313 7 17.2434 7C7.44202 7 0.0252047 18.8635 6.34108 30.7582C11.1281 39.7736 22.2504 47.8307 27.3539 51.2033Z",fill:"url(#paint0_radial_good)"}),P.jsx("defs",{children:P.jsxs("radialGradient",{id:"paint0_radial_good",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(-18.5 26.5 -68.601 -50.7338 45.5 16.5)",gradientUnits:"userSpaceOnUse",children:[P.jsx("stop",{stopColor:"#E35241"}),P.jsx("stop",{offset:"1",stopColor:"#FF8B76"})]})})]}),P.jsx("span",{className:"text-gray-900 font-crimson text-2xl font-bold",children:""})]})]}),P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx("p",{className:"text-gray-500 font-crimson text-xl",children:"   "})}),P.jsx("div",{className:"flex justify-center mt-6 px-5",children:P.jsx("button",{onClick:ie,disabled:!S||I,className:`w-full max-w-sm h-14 rounded-lg font-crimson text-xl font-bold transition-all ${S&&!I?"bg-gradient-to-r from-yellow-300 to-red-gradient text-white hover:opacity-90":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:I?" ...":" "})}),P.jsx("div",{className:"flex-1 flex items-end pb-8",children:P.jsx("div",{className:"w-full px-5",children:P.jsxs("div",{className:"flex gap-2",children:[P.jsx("button",{onClick:()=>{B(),h()},className:"flex-1 h-14 border border-orange-500 rounded-lg flex items-center justify-center bg-white",children:P.jsx("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:" "})}),P.jsx("button",{onClick:()=>{B(),f()},className:"flex-1 h-14 bg-orange-500 rounded-lg flex items-center justify-center",children:P.jsx("span",{className:"text-white font-crimson text-xl font-bold",children:" "})})]})})})]})}function vF({onBack:u,onNavigateToActivity:h,onNavigateToProfileEdit:f,onNavigateToComingSoon:g,onNavigateToSupport:S,onLogout:C}){const I=[{id:"subscription",title:" ",icon:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M12 13.9L13.5 15.05C13.6833 15.2 13.8833 15.2042 14.1 15.0625C14.3167 14.9208 14.3833 14.7333 14.3 14.5L13.7 12.6L15.375 11.3C15.5583 11.15 15.6083 10.9625 15.525 10.7375C15.4417 10.5125 15.2833 10.4 15.05 10.4H13.1L12.475 8.475C12.3917 8.24167 12.2333 8.125 12 8.125C11.7667 8.125 11.6083 8.24167 11.525 8.475L10.9 10.4H8.925C8.69167 10.4 8.5375 10.5125 8.4625 10.7375C8.3875 10.9625 8.44167 11.15 8.625 11.3L10.25 12.6L9.65 14.525C9.56667 14.7583 9.625 14.9458 9.825 15.0875C10.025 15.2292 10.225 15.225 10.425 15.075L12 13.9ZM4 20C3.45 20 2.97917 19.8042 2.5875 19.4125C2.19583 19.0208 2 18.55 2 18V14.625C2 14.4417 2.05833 14.2833 2.175 14.15C2.29167 14.0167 2.44167 13.9333 2.625 13.9C3.025 13.7667 3.35417 13.525 3.6125 13.175C3.87083 12.825 4 12.4333 4 12C4 11.5667 3.87083 11.175 3.6125 10.825C3.35417 10.475 3.025 10.2333 2.625 10.1C2.44167 10.0667 2.29167 9.98333 2.175 9.85C2.05833 9.71667 2 9.55833 2 9.375V6C2 5.45 2.19583 4.97917 2.5875 4.5875C2.97917 4.19583 3.45 4 4 4H20C20.55 4 21.0208 4.19583 21.4125 4.5875C21.8042 4.97917 22 5.45 22 6V9.375C22 9.55833 21.9417 9.71667 21.825 9.85C21.7083 9.98333 21.5583 10.0667 21.375 10.1C20.975 10.2333 20.6458 10.475 20.3875 10.825C20.1292 11.175 20 11.5667 20 12C20 12.4333 20.1292 12.825 20.3875 13.175C20.6458 13.525 20.975 13.7667 21.375 13.9C21.5583 13.9333 21.7083 14.0167 21.825 14.15C21.9417 14.2833 22 14.4417 22 14.625V18C22 18.55 21.8042 19.0208 21.4125 19.4125C21.0208 19.8042 20.55 20 20 20H4Z",fill:"#EA8C4B"})})},{id:"activity",title:"  ",icon:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M6 22C5.16667 22 4.45833 21.7083 3.875 21.125C3.29167 20.5417 3 19.8333 3 19V18C3 17.45 3.19583 16.9792 3.5875 16.5875C3.97917 16.1958 4.45 16 5 16H6V4C6 3.45 6.19583 2.97917 6.5875 2.5875C6.97917 2.19583 7.45 2 8 2H19C19.55 2 20.0208 2.19583 20.4125 2.5875C20.8042 2.97917 21 3.45 21 4V19C21 19.8333 20.7083 20.5417 20.125 21.125C19.5417 21.7083 18.8333 22 18 22H6ZM18 20C18.2833 20 18.5208 19.9042 18.7125 19.7125C18.9042 19.5208 19 19.2833 19 19V4H8V16H15C15.55 16 16.0208 16.1958 16.4125 16.5875C16.8042 16.9792 17 17.45 17 18V19C17 19.2833 17.0958 19.5208 17.2875 19.7125C17.4792 19.9042 17.7167 20 18 20ZM10 9C9.71667 9 9.47917 8.90417 9.2875 8.7125C9.09583 8.52083 9 8.28333 9 8C9 7.71667 9.09583 7.47917 9.2875 7.2875C9.47917 7.09583 9.71667 7 10 7H17C17.2833 7 17.5208 7.09583 17.7125 7.2875C17.9042 7.47917 18 7.71667 18 8C18 8.28333 17.9042 8.52083 17.7125 8.7125C17.5208 8.90417 17.2833 9 17 9H10ZM10 12C9.71667 12 9.47917 11.9042 9.2875 11.7125C9.09583 11.5208 9 11.2833 9 11C9 10.7167 9.09583 10.4792 9.2875 10.2875C9.47917 10.0958 9.71667 10 10 10H17C17.2833 10 17.5208 10.0958 17.7125 10.2875C17.9042 10.4792 18 10.7167 18 11C18 11.2833 17.9042 11.5208 17.7125 11.7125C17.5208 11.9042 17.2833 12 17 12H10Z",fill:"#EA8C4B"})})},{id:"notifications",title:" ",icon:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M13 12.5999V8.9999C13 8.71657 12.9042 8.47907 12.7125 8.2874C12.5209 8.09574 12.2834 7.9999 12 7.9999C11.7167 7.9999 11.4792 8.09574 11.2875 8.2874C11.0959 8.47907 11 8.71657 11 8.9999V12.9749C11 13.1082 11.025 13.2374 11.075 13.3624C11.125 13.4874 11.2 13.5999 11.3 13.6999L14.1 16.4999C14.2834 16.6832 14.5167 16.7749 14.8 16.7749C15.0834 16.7749 15.3167 16.6832 15.5 16.4999C15.6834 16.3166 15.775 16.0832 15.775 15.7999C15.775 15.5166 15.6834 15.2832 15.5 15.0999L13 12.5999ZM12 21.9999C10.75 21.9999 9.57919 21.7624 8.48752 21.2874C7.39586 20.8124 6.44586 20.1707 5.63752 19.3624C4.82919 18.5541 4.18752 17.6041 3.71252 16.5124C3.23752 15.4207 3.00002 14.2499 3.00002 12.9999C3.00002 11.7499 3.23752 10.5791 3.71252 9.4874C4.18752 8.39574 4.82919 7.44574 5.63752 6.6374C6.44586 5.82907 7.39586 5.1874 8.48752 4.7124C9.57919 4.2374 10.75 3.9999 12 3.9999C13.25 3.9999 14.4209 4.2374 15.5125 4.7124C16.6042 5.1874 17.5542 5.82907 18.3625 6.6374C19.1709 7.44574 19.8125 8.39574 20.2875 9.4874C20.7625 10.5791 21 11.7499 21 12.9999C21 14.2499 20.7625 15.4207 20.2875 16.5124C19.8125 17.6041 19.1709 18.5541 18.3625 19.3624C17.5542 20.1707 16.6042 20.8124 15.5125 21.2874C14.4209 21.7624 13.25 21.9999 12 21.9999ZM2.05002 7.2999C1.86669 7.11657 1.77502 6.88324 1.77502 6.5999C1.77502 6.31657 1.86669 6.08324 2.05002 5.8999L4.90002 3.0499C5.08336 2.86657 5.31669 2.7749 5.60002 2.7749C5.88336 2.7749 6.11669 2.86657 6.30002 3.0499C6.48336 3.23324 6.57502 3.46657 6.57502 3.7499C6.57502 4.03324 6.48336 4.26657 6.30002 4.4499L3.45002 7.2999C3.26669 7.48324 3.03336 7.5749 2.75002 7.5749C2.46669 7.5749 2.23336 7.48324 2.05002 7.2999ZM21.95 7.2999C21.7667 7.48324 21.5334 7.5749 21.25 7.5749C20.9667 7.5749 20.7334 7.48324 20.55 7.2999L17.7 4.4499C17.5167 4.26657 17.425 4.03324 17.425 3.7499C17.425 3.46657 17.5167 3.23324 17.7 3.0499C17.8834 2.86657 18.1167 2.7749 18.4 2.7749C18.6834 2.7749 18.9167 2.86657 19.1 3.0499L21.95 5.8999C22.1334 6.08324 22.225 6.31657 22.225 6.5999C22.225 6.88324 22.1334 7.11657 21.95 7.2999Z",fill:"#EA8C4B"})})},{id:"support",title:"",icon:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M11.75 19H11.5C9.13333 19 7.125 18.175 5.475 16.525C3.825 14.875 3 12.8667 3 10.5C3 8.13333 3.825 6.125 5.475 4.475C7.125 2.825 9.13333 2 11.5 2C12.6833 2 13.7875 2.22083 14.8125 2.6625C15.8375 3.10417 16.7375 3.7125 17.5125 4.4875C18.2875 5.2625 18.8958 6.1625 19.3375 7.1875C19.7792 8.2125 20 9.31667 20 10.5C20 12.7333 19.3708 14.8083 18.1125 16.725C16.8542 18.6417 15.2667 20.1417 13.35 21.225C13.1833 21.3083 13.0167 21.3542 12.85 21.3625C12.6833 21.3708 12.5333 21.3333 12.4 21.25C12.2667 21.1667 12.15 21.0583 12.05 20.925C11.95 20.7917 11.8917 20.6333 11.875 20.45L11.75 19ZM11.475 15.975C11.7583 15.975 12 15.875 12.2 15.675C12.4 15.475 12.5 15.2333 12.5 14.95C12.5 14.6667 12.4 14.425 12.2 14.225C12 14.025 11.7583 13.925 11.475 13.925C11.1917 13.925 10.95 14.025 10.75 14.225C10.55 14.425 10.45 14.6667 10.45 14.95C10.45 15.2333 10.55 15.475 10.75 15.675C10.95 15.875 11.1917 15.975 11.475 15.975ZM9.3 8.375C9.48333 8.45833 9.66667 8.4625 9.85 8.3875C10.0333 8.3125 10.1833 8.19167 10.3 8.025C10.45 7.825 10.625 7.67083 10.825 7.5625C11.025 7.45417 11.25 7.4 11.5 7.4C11.9 7.4 12.225 7.5125 12.475 7.7375C12.725 7.9625 12.85 8.25 12.85 8.6C12.85 8.81667 12.7875 9.03333 12.6625 9.25C12.5375 9.46667 12.3167 9.73333 12 10.05C11.5833 10.4167 11.275 10.7625 11.075 11.0875C10.875 11.4125 10.775 11.7417 10.775 12.075C10.775 12.275 10.8458 12.4458 10.9875 12.5875C11.1292 12.7292 11.3 12.8 11.5 12.8C11.7 12.8 11.8667 12.725 12 12.575C12.1333 12.425 12.2333 12.25 12.3 12.05C12.3833 11.7667 12.5333 11.5083 12.75 11.275C12.9667 11.0417 13.1667 10.8333 13.35 10.65C13.7 10.3 13.9625 9.95 14.1375 9.6C14.3125 9.25 14.4 8.9 14.4 8.55C14.4 7.78333 14.1375 7.16667 13.6125 6.7C13.0875 6.23333 12.3833 6 11.5 6C10.9667 6 10.475 6.12917 10.025 6.3875C9.575 6.64583 9.20833 7 8.925 7.45C8.825 7.63333 8.8125 7.8125 8.8875 7.9875C8.9625 8.1625 9.1 8.29167 9.3 8.375Z",fill:"#EA8C4B"})})},{id:"profile-edit",title:" ",icon:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"#EA8C4B"})})}],N=k=>{k==="activity"?h():k==="profile-edit"?f():k==="subscription"?g(" "):k==="notifications"?g(" "):k==="support"&&S()};return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[P.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[P.jsx("button",{onClick:u,className:"p-1",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),P.jsx("div",{className:"w-6"})]}),P.jsxs("div",{className:"flex-1 px-5 py-5",children:[P.jsx("div",{className:"flex flex-col gap-4",children:I.map(k=>P.jsxs("button",{onClick:()=>N(k.id),className:"flex items-center justify-between p-6 border border-gray-200 rounded-2xl bg-white hover:bg-gray-50 transition-colors",children:[P.jsxs("div",{className:"flex flex-col items-start gap-2",children:[k.icon,P.jsx("span",{className:"text-gray-800 font-crimson text-2xl font-semibold",children:k.title})]}),P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M8 5L15 12L8 19",stroke:"#BFC2C0",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]},k.id))}),P.jsx("div",{className:"mt-8",children:P.jsxs("button",{onClick:C,className:"w-full flex items-center justify-center gap-2 p-4 border border-red-200 rounded-2xl bg-red-50 hover:bg-red-100 transition-colors",children:[P.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[P.jsx("path",{d:"M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),P.jsx("path",{d:"M16 17L21 12L16 7",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),P.jsx("path",{d:"M21 12H9",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),P.jsx("span",{className:"text-red-600 font-crimson text-lg font-semibold",children:""})]})})]})]})}function SF({onBack:u}){const[h,f]=ee.useState(null),[g,S]=ee.useState(!0),[C,I]=ee.useState(null);ee.useEffect(()=>{(async()=>{try{S(!0),I(null);const B=UE(),q=uo();if(!q)throw new Error(" .");B.setToken(q);const K=await B.getActivityStats();f(K)}catch(B){console.error("   :",B),I(B instanceof Error?B.message:"    .")}finally{S(!1)}})()},[]);const N=F=>{if(F===0)return"1 ";const B=Math.floor(F/60),q=F%60;return B===0?`${q}`:q===0?`${B}`:`${B} ${q}`},M=(()=>{if(!h)return{level:"NEW",displayName:""};const{callCount:F,totalDurationMinutes:B}=h.weeklyStats;return F>=3||B>=90?{level:"EXCELLENT",displayName:""}:F>=1?{level:"GOOD",displayName:""}:{level:"NEW",displayName:""}})();return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[P.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[P.jsx("button",{onClick:u,className:"p-1",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:"  "}),P.jsx("div",{className:"w-6"})]}),P.jsxs("div",{className:"flex-1 px-5 py-5",children:[g&&P.jsx("div",{className:"flex items-center justify-center h-64",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),P.jsx("p",{className:"text-gray-600 font-pretendard",children:"   ..."})]})}),C&&!g&&P.jsx("div",{className:"flex items-center justify-center h-64",children:P.jsxs("div",{className:"text-center",children:[P.jsx("p",{className:"text-red-500 font-pretendard mb-4",children:C}),P.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-orange-500 text-white rounded-lg font-pretendard",children:" "})]})}),!g&&!C&&h&&P.jsxs(P.Fragment,{children:[P.jsx("div",{className:"text-center mb-8",children:P.jsx("h2",{className:"text-gray-800 font-pretendard text-3xl font-medium",children:" ?"})}),P.jsx("div",{className:"flex justify-center mb-16",children:P.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 px-10 py-3 rounded-xl border-2 border-white/50",style:{background:M.level==="EXCELLENT"?"linear-gradient(93deg, #F4BC41 0.31%, #E26155 100.05%)":M.level==="GOOD"?"linear-gradient(93deg, #4B9FE1 0.31%, #6CC4A1 100.05%)":"linear-gradient(93deg, #FCD34D 0.31%, #F59E0B 100.05%)"},children:[P.jsx("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",children:P.jsx("path",{d:"M9.33333 14.4V9.33333H6.66667V10.6667C6.66667 11.5111 6.91111 12.2722 7.4 12.95C7.88889 13.6278 8.53333 14.1111 9.33333 14.4ZM22.6667 14.4C23.4667 14.1111 24.1111 13.6278 24.6 12.95C25.0889 12.2722 25.3333 11.5111 25.3333 10.6667V9.33333H22.6667V14.4ZM14.6667 25.3333V21.2C13.5778 20.9556 12.6056 20.4944 11.75 19.8167C10.8944 19.1389 10.2667 18.2889 9.86667 17.2667C8.2 17.0667 6.80556 16.3389 5.68333 15.0833C4.56111 13.8278 4 12.3556 4 10.6667V9.33333C4 8.6 4.26111 7.97222 4.78333 7.45C5.30556 6.92778 5.93333 6.66667 6.66667 6.66667H9.33333C9.33333 5.93333 9.59444 5.30556 10.1167 4.78333C10.6389 4.26111 11.2667 4 12 4H20C20.7333 4 21.3611 4.26111 21.8833 4.78333C22.4056 5.30556 22.6667 5.93333 22.6667 6.66667H25.3333C26.0667 6.66667 26.6944 6.92778 27.2167 7.45C27.7389 7.97222 28 8.6 28 9.33333V10.6667C28 12.3556 27.4389 13.8278 26.3167 15.0833C25.1944 16.3389 23.8 17.0667 22.1333 17.2667C21.7333 18.2889 21.1056 19.1389 20.25 19.8167C19.3944 20.4944 18.4222 20.9556 17.3333 21.2V25.3333H21.3333C21.7111 25.3333 22.0278 25.4611 22.2833 25.7167C22.5389 25.9722 22.6667 26.2889 22.6667 26.6667C22.6667 27.0444 22.5389 27.3611 22.2833 27.6167C22.0278 27.8722 21.7111 28 21.3333 28H10.6667C10.2889 28 9.97222 27.8722 9.71667 27.6167C9.46111 27.3611 9.33333 27.0444 9.33333 26.6667C9.33333 26.2889 9.46111 25.9722 9.71667 25.7167C9.97222 25.4611 10.2889 25.3333 10.6667 25.3333H14.6667Z",fill:"white"})}),P.jsx("span",{className:"text-white font-crimson text-xl font-bold",children:M.displayName})]})}),P.jsxs("div",{className:"mb-8",children:[P.jsx("h3",{className:"text-orange-500 font-crimson text-2xl font-bold mb-4",children:"  "}),P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M19.95 21C17.8667 21 15.8083 20.5458 13.775 19.6375C11.7417 18.7292 9.89167 17.4417 8.225 15.775C6.55833 14.1083 5.27083 12.2583 4.3625 10.225C3.45417 8.19167 3 6.13333 3 4.05C3 3.75 3.1 3.5 3.3 3.3C3.5 3.1 3.75 3 4.05 3H8.1C8.33333 3 8.54167 3.07917 8.725 3.2375C8.90833 3.39583 9.01667 3.58333 9.05 3.8L9.7 7.3C9.73333 7.56667 9.725 7.79167 9.675 7.975C9.625 8.15833 9.53333 8.31667 9.4 8.45L6.975 10.9C7.30833 11.5167 7.70417 12.1125 8.1625 12.6875C8.62083 13.2625 9.125 13.8167 9.675 14.35C10.1917 14.8667 10.7333 15.3458 11.3 15.7875C11.8667 16.2292 12.4667 16.6333 13.1 17L15.45 14.65C15.6 14.5 15.7958 14.3875 16.0375 14.3125C16.2792 14.2375 16.5167 14.2167 16.75 14.25L20.2 14.95C20.4333 15.0167 20.625 15.1375 20.775 15.3125C20.925 15.4875 21 15.6833 21 15.9V19.95C21 20.25 20.9 20.5 20.7 20.7C20.5 20.9 20.25 21 19.95 21Z",fill:"#3C3F3D"})}),P.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),P.jsxs("span",{className:"text-gray-800 font-crimson text-xl",children:[h.weeklyStats.callCount,""]})]}),P.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M13 11.6V8C13 7.71667 12.9042 7.47917 12.7125 7.2875C12.5208 7.09583 12.2833 7 12 7C11.7167 7 11.4792 7.09583 11.2875 7.2875C11.0958 7.47917 11 7.71667 11 8V11.975C11 12.1083 11.025 12.2375 11.075 12.3625C11.125 12.4875 11.2 12.6 11.3 12.7L14.6 16C14.7833 16.1833 15.0167 16.275 15.3 16.275C15.5833 16.275 15.8167 16.1833 16 16C16.1833 15.8167 16.275 15.5833 16.275 15.3C16.275 15.0167 16.1833 14.7833 16 14.6L13 11.6ZM12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C13.3833 2 14.6833 2.2625 15.9 2.7875C17.1167 3.3125 18.175 4.025 19.075 4.925C19.975 5.825 20.6875 6.88333 21.2125 8.1C21.7375 9.31667 22 10.6167 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22Z",fill:"#3C3F3D"})}),P.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),P.jsx("span",{className:"text-gray-800 font-crimson text-xl",children:N(h.weeklyStats.totalDurationMinutes)})]})]})]}),P.jsxs("div",{children:[P.jsx("h3",{className:"text-orange-500 font-crimson text-2xl font-bold mb-4",children:"  "}),P.jsxs("div",{className:"space-y-4",children:[P.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M19.95 21C17.8667 21 15.8083 20.5458 13.775 19.6375C11.7417 18.7292 9.89167 17.4417 8.225 15.775C6.55833 14.1083 5.27083 12.2583 4.3625 10.225C3.45417 8.19167 3 6.13333 3 4.05C3 3.75 3.1 3.5 3.3 3.3C3.5 3.1 3.75 3 4.05 3H8.1C8.33333 3 8.54167 3.07917 8.725 3.2375C8.90833 3.39583 9.01667 3.58333 9.05 3.8L9.7 7.3C9.73333 7.56667 9.725 7.79167 9.675 7.975C9.625 8.15833 9.53333 8.31667 9.4 8.45L6.975 10.9C7.30833 11.5167 7.70417 12.1125 8.1625 12.6875C8.62083 13.2625 9.125 13.8167 9.675 14.35C10.1917 14.8667 10.7333 15.3458 11.3 15.7875C11.8667 16.2292 12.4667 16.6333 13.1 17L15.45 14.65C15.6 14.5 15.7958 14.3875 16.0375 14.3125C16.2792 14.2375 16.5167 14.2167 16.75 14.25L20.2 14.95C20.4333 15.0167 20.625 15.1375 20.775 15.3125C20.925 15.4875 21 15.6833 21 15.9V19.95C21 20.25 20.9 20.5 20.7 20.7C20.5 20.9 20.25 21 19.95 21Z",fill:"#3C3F3D"})}),P.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),P.jsxs("span",{className:"text-gray-800 font-crimson text-xl",children:[h.quarterlyStats.callCount,""]})]}),P.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M13 11.6V8C13 7.71667 12.9042 7.47917 12.7125 7.2875C12.5208 7.09583 12.2833 7 12 7C11.7167 7 11.4792 7.09583 11.2875 7.2875C11.0958 7.47917 11 7.71667 11 8V11.975C11 12.1083 11.025 12.2375 11.075 12.3625C11.125 12.4875 11.2 12.6 11.3 12.7L14.6 16C14.7833 16.1833 15.0167 16.275 15.3 16.275C15.5833 16.275 15.8167 16.1833 16 16C16.1833 15.8167 16.275 15.5833 16.275 15.3C16.275 15.0167 16.1833 14.7833 16 14.6L13 11.6ZM12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C13.3833 2 14.6833 2.2625 15.9 2.7875C17.1167 3.3125 18.175 4.025 19.075 4.925C19.975 5.825 20.6875 6.88333 21.2125 8.1C21.7375 9.31667 22 10.6167 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22Z",fill:"#3C3F3D"})}),P.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),P.jsx("span",{className:"text-gray-800 font-crimson text-xl",children:N(h.quarterlyStats.totalDurationMinutes)})]})]})]}),P.jsx("div",{className:"mt-8 flex justify-center",children:P.jsx("button",{onClick:u,className:"w-full max-w-sm h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:""})})]})]})]})}function yF({onBack:u}){const[h,f]=ee.useState([]),[g,S]=ee.useState(!0),[C,I]=ee.useState(null),[N,k]=ee.useState(1),[M,F]=ee.useState(1),[B,q]=ee.useState(!1),K=async(ce=1)=>{try{S(!0),I(null);const $=UE(),le=uo();if(!le)throw new Error(" .");$.setToken(le);const ne=await $.getCallHistory({page:ce,limit:20,period:"all"});f(ne.calls),k(ne.pagination.currentPage),F(ne.pagination.totalPages),q(ne.pagination.hasNext)}catch($){console.error("   :",$),I($ instanceof Error?$.message:"    .")}finally{S(!1)}};ee.useEffect(()=>{K(1)},[]);const ie=ce=>{const $=new Date(ce),le=$.getMonth()+1,ne=$.getDate(),de=$.getHours().toString().padStart(2,"0"),be=$.getMinutes().toString().padStart(2,"0");return`${le}/${ne} ${de}:${be}`},X=ce=>{if(ce===0)return"1 ";const $=Math.floor(ce/60),le=ce%60;return $===0?`${le}`:le===0?`${$}`:`${$} ${le}`},te=ce=>{ce<1||ce>M||(K(ce),window.scrollTo({top:0,behavior:"smooth"}))};return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[P.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[P.jsx("button",{onClick:u,className:"p-1",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:" "}),P.jsx("div",{className:"w-6"})]}),P.jsxs("div",{className:"flex-1 px-5 py-5",children:[g&&P.jsx("div",{className:"flex items-center justify-center h-64",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),P.jsx("p",{className:"text-gray-600 font-pretendard",children:"   ..."})]})}),C&&!g&&P.jsx("div",{className:"flex items-center justify-center h-64",children:P.jsxs("div",{className:"text-center",children:[P.jsx("p",{className:"text-red-500 font-pretendard mb-4",children:C}),P.jsx("button",{onClick:()=>K(N),className:"px-4 py-2 bg-orange-500 text-white rounded-lg font-pretendard",children:" "})]})}),!g&&!C&&P.jsx(P.Fragment,{children:h.length===0?P.jsx("div",{className:"flex items-center justify-center h-64",children:P.jsxs("div",{className:"text-center",children:[P.jsx("p",{className:"text-gray-500 font-pretendard text-lg",children:"   "}),P.jsx("p",{className:"text-gray-400 font-pretendard text-sm mt-2",children:"  !"})]})}):P.jsxs(P.Fragment,{children:[P.jsx("div",{className:"space-y-3",children:h.map(ce=>P.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-100 hover:bg-gray-100 transition-colors",children:[P.jsxs("div",{className:"flex items-center justify-between mb-2",children:[P.jsxs("div",{className:"flex items-center gap-2",children:[P.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:P.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"#EE9049"})})}),P.jsxs("div",{className:"ml-1",children:[P.jsx("p",{className:"text-gray-800 font-crimson text-lg font-semibold",children:ce.partnerNickname}),P.jsx("p",{className:"text-gray-500 font-pretendard text-xs",children:ie(ce.startedAt)})]})]}),P.jsx("div",{className:"text-right",children:P.jsx("p",{className:"text-orange-500 font-crimson text-base font-semibold",children:X(ce.durationMinutes)})})]}),P.jsx("div",{className:"flex items-center gap-2 ml-[52px]",children:P.jsx("div",{className:"px-3 py-1 bg-white rounded-full border border-orange-200",children:P.jsx("span",{className:"text-orange-500 font-pretendard text-sm",children:ce.categoryName})})})]},ce.callId))}),M>1&&P.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8",children:[P.jsx("button",{onClick:()=>te(N-1),disabled:N===1,className:`px-4 py-2 rounded-lg font-pretendard ${N===1?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600"}`,children:""}),P.jsxs("span",{className:"text-gray-700 font-pretendard",children:[N," / ",M]}),P.jsx("button",{onClick:()=>te(N+1),disabled:!B,className:`px-4 py-2 rounded-lg font-pretendard ${B?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:""})]})]})})]})]})}function TF({featureName:u,onBack:h}){const f=jh(),g=D0(),C=new URLSearchParams(g.search).get("feature"),I=u||C||" ",N=()=>{h?h():f(-1)};return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[P.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[P.jsx("button",{onClick:N,className:"p-1",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:I}),P.jsx("div",{className:"w-6"})]}),P.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"mb-8",children:P.jsx("div",{className:"w-32 h-32 mx-auto bg-orange-100 rounded-full flex items-center justify-center",children:P.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z",fill:"#EA8C4B"})})})}),P.jsx("h2",{className:"text-gray-900 font-crimson text-3xl font-bold mb-4",children:" "}),P.jsxs("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-2",children:[I,"()   ."]}),P.jsx("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-8",children:"    ."}),P.jsx("div",{className:"bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-8",children:P.jsxs("p",{className:"text-orange-600 font-pretendard text-base leading-relaxed",children:["    ",P.jsx("br",{}),"  . "]})}),P.jsx("button",{onClick:N,className:"w-full max-w-sm h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:""})]})})]})}function CF({onBack:u}){const h="chingoohaja@gmail.com",f=()=>{navigator.clipboard.writeText(h),alert("  !")},g=()=>{window.location.href=`mailto:${h}`};return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[P.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[P.jsx("button",{onClick:u,className:"p-1",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),P.jsx("div",{className:"w-6"})]}),P.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:P.jsxs("div",{className:"text-center w-full max-w-md",children:[P.jsx("div",{className:"mb-8",children:P.jsx("div",{className:"w-32 h-32 mx-auto bg-orange-100 rounded-full flex items-center justify-center",children:P.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z",fill:"#EA8C4B"})})})}),P.jsx("h2",{className:"text-gray-900 font-crimson text-3xl font-bold mb-4",children:""}),P.jsxs("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-8",children:["    ?",P.jsx("br",{}),"  ."]}),P.jsxs("div",{className:"bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-6",children:[P.jsx("p",{className:"text-gray-700 font-pretendard text-sm mb-3",children:" "}),P.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[P.jsx("p",{className:"text-orange-600 font-crimson text-xl font-bold",children:h}),P.jsx("button",{onClick:f,className:"p-2 hover:bg-orange-100 rounded-lg transition-colors",title:"",children:P.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#EA8C4B",strokeWidth:"2",children:[P.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),P.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})})]}),P.jsx("p",{className:"text-gray-500 font-pretendard text-sm",children:"  . "})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsx("button",{onClick:g,className:"w-full h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:" "}),P.jsx("button",{onClick:u,className:"w-full h-14 bg-white border-2 border-gray-200 text-gray-700 font-crimson text-xl font-semibold rounded-lg hover:bg-gray-50 transition-colors",children:""})]}),P.jsx("div",{className:"mt-8",children:P.jsxs("p",{className:"text-gray-500 font-pretendard text-sm leading-relaxed",children:["   :  09:00 - 18:00",P.jsx("br",{}),"(   )"]})})]})})]})}function one(){const[u,h]=ee.useState(!1),[f,g]=ee.useState(!0),[S,C]=ee.useState("home"),[I,N]=ee.useState(null),[k,M]=ee.useState(!1),[F,B]=ee.useState(!1),[q,K]=ee.useState(!1),[ie,X]=ee.useState(!1),[te,ce]=ee.useState(!1),[$,le]=ee.useState(""),ne=jh();ee.useEffect(()=>{(()=>{try{const Ot=H1(),Gt=DE();if(h(Ot),Ot&&Gt)if(Gt.is_new_user||!Gt.is_profile_complete){ne("/profile-setup",{replace:!0});return}else return}catch(Ot){console.error("Error checking auth status:",Ot),h(!1)}finally{g(!1)}})()},[ne]),ee.useEffect(()=>{!f&&!u&&ne("/login",{replace:!0})},[f,u,ne]);const de=async()=>{try{await Z8(),h(!1),C("home"),N(null),M(!1),B(!1),ne("/login",{replace:!0})}catch(ot){console.error("   :",ot),h(!1),C("home"),N(null),M(!1),B(!1),ne("/login",{replace:!0})}},be=ot=>{N(ot),C("connecting")},Se=()=>{C("home"),N(null)},fe=()=>{C("inCall")},ye=()=>{C("evaluation")},je=()=>{C("connecting")},Je=()=>{C("home"),N(null)},Ue=()=>{C("home"),N(null)},xe=()=>{M(!0)},Ge=()=>{M(!1)},dt=()=>{B(!0)},Xe=()=>{K(!0)},We=()=>{M(!1),ne("/profile-setup")},Ae=()=>{B(!1)},De=()=>{K(!1)},ze=ot=>{le(ot),X(!0),M(!1)},me=()=>{X(!1),M(!0)},ke=()=>{ce(!0),M(!1)},at=()=>{ce(!1),M(!0)};return f?P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx("div",{className:"min-h-screen bg-grey-50 flex items-center justify-center safe-area-page",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-orange-accent border-t-transparent rounded-full mx-auto mb-4"}),P.jsx("p",{className:"text-grey-900 font-crimson text-lg",children:" ..."})]})})}):P.jsx("div",{className:"max-w-md mx-auto",children:u?te?P.jsx(CF,{onBack:at}):ie?P.jsx(TF,{featureName:$,onBack:me}):q?P.jsx(yF,{onBack:De}):F?P.jsx(SF,{onBack:Ae}):k?P.jsx(vF,{onBack:Ge,onNavigateToActivity:dt,onNavigateToProfileEdit:We,onNavigateToComingSoon:ze,onNavigateToSupport:ke,onLogout:de}):S==="connecting"?P.jsx(_F,{selectedCategory:I,onCancel:Se,onConnected:fe}):S==="inCall"?P.jsx(gF,{selectedCategory:I,onEndCall:ye}):S==="evaluation"?P.jsx(EF,{selectedCategory:I,onCallAgain:je,onSelectInterests:Je,onGoHome:Ue}):P.jsx(Zte,{onStartCall:be,onOpenSettings:xe,onOpenCallHistory:Xe}):null})}const ane=()=>{const u=D0();return ee.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",u.pathname)},[u.pathname]),P.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 safe-area-page",children:P.jsxs("div",{className:"text-center",children:[P.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),P.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),P.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};function cne({onLogin:u,onSignUp:h}){const[f,g]=ee.useState(""),[S,C]=ee.useState(""),I=()=>{f.trim()&&S.trim()?u():alert("  .")},N=async k=>{try{await q8(k)}catch(M){lt.error("   :",M),alert("  .  .")}};return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center safe-area-page",children:[P.jsx("div",{className:"mt-4 md:mt-16 mb-8 md:mb-12",children:P.jsxs("svg",{width:"103",height:"32",viewBox:"0 0 103 32",fill:"none",children:[P.jsx("path",{d:"M77.7015 8.50968V5.22002H91.1165V8.50968H86.4656V10.9904C86.4656 12.1229 86.358 13.1206 86.143 14.0374C87.3527 15.6822 90.1218 18.2439 92.1111 19.2955L90.5519 22.666C88.7776 21.7492 86.3043 19.5921 84.7719 17.4619C84.4493 18.0012 84.0998 18.5135 83.7234 19.0528C82.7019 20.5089 80.4168 22.666 78.8844 23.448L76.6799 20.3471C77.5671 19.8887 79.0995 18.6753 80.1748 17.4619C81.8954 15.5474 82.5406 13.7408 82.5406 11.1252V8.50968H77.7015ZM93.6435 4.06055H97.5416V12.3386H101.117V16.0328H97.5416V27.223H93.6435V4.06055Z",fill:"black"}),P.jsx("path",{d:"M59.194 12.0688C63.0115 12.0688 65.7805 14.4956 65.7805 18.1358C65.7805 21.776 63.0115 24.1759 59.194 24.1759C55.3496 24.1759 52.6344 21.803 52.6344 18.1358C52.6344 14.4956 55.3496 12.0688 59.194 12.0688ZM68.3613 27.2229V4.06039H72.2595V12.5542H75.835V16.2483H72.2595V27.2229H68.3613ZM51.5859 7.40398H57.3659L56.9627 3.97949H61.6135L61.2103 7.40398H66.7752V10.6667H51.5859V7.40398ZM59.194 15.0889C57.4197 15.0889 56.2099 16.2214 56.2099 18.1358C56.2099 20.0773 57.4197 21.1559 59.194 21.1559C60.9683 21.1559 62.1781 20.0503 62.1781 18.1358C62.1781 16.2214 60.9683 15.0889 59.194 15.0889Z",fill:"black"}),P.jsx("path",{d:"M26.5189 16.491H41.1436C41.4393 15.2776 41.7351 13.3631 41.9233 11.4486C42.0308 10.3431 42.0846 8.99485 42.1114 7.75448H29.2611V4.41089H46.1709C46.1978 6.97251 46.1171 9.02181 45.902 11.152C45.6601 13.1474 45.1762 15.2506 44.7729 16.491H49.2894V19.8346H39.9339V28.2205H35.7669V19.8346H26.5189V16.491Z",fill:"black"}),P.jsx("path",{d:"M7.0167 3.35938H11.56L11.2643 6.13672H15.8614V9.39942H11.2374V10.0196C11.2374 10.6667 11.1299 11.2869 10.9417 11.8801C12.5816 13.0935 15.0011 14.253 16.3991 14.6575L15.4582 18.028C13.7107 17.6236 11.103 16.1405 9.38246 14.6036C9.05985 15.008 8.68348 15.3855 8.30711 15.763C6.88228 17.1382 4.78535 18.3786 3.0648 18.8639L1.80127 15.4664C2.82285 15.0889 4.3821 14.3609 5.43056 13.498C6.77474 12.3925 7.3393 11.3678 7.3393 10.0196V9.39942H2.47336V6.13672H7.28553L7.0167 3.35938ZM9.62441 19.565V24.5534H22.7974V27.9779H5.67251V19.565H9.62441ZM18.5767 4.06045H22.4748V20.8593H18.5767V4.06045Z",fill:"black"})]})}),P.jsxs("div",{className:"w-full max-w-sm md:max-w-md lg:max-w-lg xl:max-w-xl px-5 space-y-4 md:space-y-6",children:[P.jsx("div",{className:"relative",children:P.jsx("input",{type:"text",value:f,onChange:k=>g(k.target.value),placeholder:" ",className:"w-full h-12 md:h-14 px-4 border border-border-gray rounded-lg font-noto text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent"})}),P.jsx("div",{className:"relative",children:P.jsx("input",{type:"password",value:S,onChange:k=>C(k.target.value),placeholder:" ",className:"w-full h-12 md:h-14 px-4 border border-border-gray rounded-lg font-noto text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent"})}),P.jsx("div",{className:"pt-4",children:P.jsx("button",{onClick:I,className:"w-full h-14 md:h-16 bg-login-button text-white font-noto text-xl md:text-2xl font-bold rounded-lg hover:bg-opacity-90 transition-colors",children:""})}),P.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4",children:[P.jsx("button",{onClick:h,className:"text-text-gray font-pretendard text-lg md:text-xl underline hover:text-gray-600",children:""}),P.jsx("div",{className:"w-px h-4 bg-divider"}),P.jsx("button",{className:"text-text-gray font-pretendard text-lg md:text-xl underline hover:text-gray-600",children:" "})]}),P.jsxs("div",{className:"flex items-center justify-center pt-8 pb-4",children:[P.jsx("div",{className:"flex-1 h-px bg-border-gray"}),P.jsx("span",{className:"px-4 text-text-gray font-noto text-base md:text-lg",children:" "}),P.jsx("div",{className:"flex-1 h-px bg-border-gray"})]}),P.jsxs("div",{className:"space-y-3",children:[P.jsxs("button",{onClick:()=>N("kakao"),className:"w-full h-12 md:h-14 bg-kakao border border-border-gray rounded-lg flex items-center justify-center gap-2 hover:bg-opacity-90 transition-colors",children:[P.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4c65144d6cea6e4262f91c38a6a5875303193496?width=48",alt:"Kakao",className:"w-6 h-6"}),P.jsx("span",{className:"text-gray-800 font-noto text-base md:text-lg font-bold",children:" "})]}),P.jsxs("button",{onClick:()=>N("google"),className:"w-full h-12 md:h-14 bg-white border border-border-gray rounded-lg flex items-center justify-center gap-2 hover:bg-gray-50 transition-colors",children:[P.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[P.jsx("path",{d:"M11.9977 10.3621V13.8467H16.8402C16.6276 14.9674 15.9895 15.9163 15.0324 16.5543L17.9527 18.8202C19.6541 17.2497 20.6357 14.9429 20.6357 12.2026C20.6357 11.5646 20.5785 10.9511 20.4721 10.3622L11.9977 10.3621Z",fill:"#4285F4"}),P.jsx("path",{d:"M6.95517 13.7107L6.29655 14.2149L3.96521 16.0308C5.44578 18.9674 8.48034 20.9961 11.9977 20.9961C14.4271 20.9961 16.4639 20.1944 17.9527 18.8202L15.0324 16.5543C14.2308 17.0942 13.2083 17.4214 11.9977 17.4214C9.65824 17.4214 7.67056 15.8427 6.95885 13.7159L6.95517 13.7107Z",fill:"#34A853"}),P.jsx("path",{d:"M3.96517 7.96533C3.3517 9.17592 3 10.542 3 11.998C3 13.454 3.3517 14.8201 3.96517 16.0307C3.96517 16.0388 6.9591 13.7076 6.9591 13.7076C6.77914 13.1677 6.67277 12.5951 6.67277 11.9979C6.67277 11.4007 6.77914 10.8281 6.9591 10.2883L3.96517 7.96533Z",fill:"#FBBC05"}),P.jsx("path",{d:"M11.9979 6.58283C13.3231 6.58283 14.501 7.0409 15.4417 7.92435L18.0183 5.34769C16.4559 3.89167 14.4274 3 11.9979 3C8.48052 3 5.44578 5.02045 3.96521 7.96526L6.95905 10.2884C7.67066 8.16156 9.65842 6.58283 11.9979 6.58283Z",fill:"#EA4335"})]}),P.jsx("span",{className:"text-gray-800 font-noto text-base md:text-lg font-bold",children:" "})]})]})]})]})}function lne({onBack:u,onSignUp:h}){const[f,g]=ee.useState(""),[S,C]=ee.useState(""),I=()=>{f.trim()&&S.trim()?h():alert("  .")};return P.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page",children:[P.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[P.jsx("button",{onClick:u,className:"p-1",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),P.jsx("div",{className:"w-6"})]}),P.jsxs("div",{className:"flex-1 px-5 py-5",children:[P.jsx("div",{className:"mb-8",children:P.jsxs("h2",{className:"text-black font-crimson text-2xl font-bold leading-8",children:["  ",P.jsx("br",{})," "]})}),P.jsxs("div",{className:"space-y-6",children:[P.jsxs("div",{className:"space-y-2",children:[P.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:""}),P.jsx("div",{className:"relative",children:P.jsx("input",{type:"text",value:f,onChange:N=>g(N.target.value),placeholder:" ",className:"w-full h-14 px-4 border border-gray-200 rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})})]}),P.jsxs("div",{className:"space-y-2",children:[P.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:""}),P.jsx("div",{className:"relative",children:P.jsx("input",{type:"password",value:S,onChange:N=>C(N.target.value),placeholder:" ",className:"w-full h-14 px-4 border border-gray-200 rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})})]})]})]}),P.jsx("div",{className:"px-5 pb-8",children:P.jsx("button",{onClick:I,className:"w-full h-14 bg-orange-500 text-white font-crimson text-xl font-bold rounded-lg hover:bg-orange-600 transition-colors",children:""})})]})}function dne(){const[u,h]=ee.useState("loading"),[f,g]=ee.useState(""),[S,C]=ee.useState(null),I=jh(),N=ee.useRef(!1);return ee.useEffect(()=>{if(N.current){console.log(" OAuth    .   .");return}return N.current=!0,console.log(" OAuth   "),(async()=>{try{const M=await X8();M?(console.log(" OAuth   "),h("success"),C(M.data.user_info),M.data.user_info.is_new_user||!M.data.user_info.is_profile_complete?setTimeout(()=>{I("/profile-setup")},2e3):setTimeout(()=>{I("/")},2e3)):(console.log(" OAuth   ,  "),I("/"))}catch(M){console.error(" OAuth   :",M),h("error"),g(M instanceof Error?M.message:"    ."),setTimeout(()=>{I("/login")},3e3)}})(),()=>{console.log(" OAuth   cleanup")}},[]),u==="loading"?P.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button mx-auto mb-4"}),P.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:"  ..."}),P.jsx("p",{className:"text-gray-600",children:" ."})]})}):u==="success"?P.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:P.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),P.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:" !"}),P.jsx("p",{className:"text-gray-600 mb-4",children:"!  ."}),P.jsx("p",{className:"text-sm text-gray-500",children:S?.is_new_user||!S?.is_profile_complete?"   ...":"  ..."})]})}):u==="error"?P.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:P.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),P.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:" "}),P.jsx("p",{className:"text-gray-600 mb-4",children:f}),P.jsx("p",{className:"text-sm text-gray-500",children:"  ..."})]})}):null}function une(){const[u,h]=ee.useState(null),[f,g]=ee.useState(""),[S,C]=ee.useState(""),[I,N]=ee.useState(""),[k,M]=ee.useState(""),[F,B]=ee.useState(""),[q,K]=ee.useState(!1),[ie,X]=ee.useState(!1),[te,ce]=ee.useState(!1),[$,le]=ee.useState(!1),ne=jh(),de=()=>{X(!0),setTimeout(()=>{ne("/",{replace:!0})},2e3)},be=()=>{if(!u)return;const ye={id:u.id,is_profile_complete:!0,is_new_user:!1};localStorage.setItem("user_info",JSON.stringify(ye))};ee.useEffect(()=>{(async()=>{try{const je=DE(),Ue=(await K1()).data;h(Ue),g(Ue.nickname||"");const xe=Ue.is_new_user??je?.is_new_user??!1;if(!xe&&(Ue.gender&&C(Ue.gender),Ue.birth)){const[Ge,dt,Xe]=Ue.birth.split("-");N(Ge),M(dt),B(Xe)}xe&&ce(!0)}catch(je){if(console.error("   :",je),je instanceof Error&&je.message.includes(" ")){alert(" .  ."),ne("/login");return}const Je=DE();if(!Je){ne("/login");return}const Ue={id:Je.id,email:"",nickname:"",is_new_user:Je.is_new_user,is_profile_complete:Je.is_profile_complete};h(Ue),g(""),Ue.is_new_user&&ce(!0)}})()},[ne]);const Se=()=>{le(!0),ce(!1)},fe=async()=>{if(!f.trim()){alert(" .");return}if(!S){alert(" .");return}if(!I||!k||!F){alert("  .");return}const ye=parseInt(I),je=parseInt(k),Je=parseInt(F),Ue=new Date().getFullYear();if(ye<1900||ye>Ue){alert("  .");return}if(je<1||je>12){alert("  .");return}if(Je<1||Je>31){alert("  .");return}const xe=`${I}-${k.padStart(2,"0")}-${F.padStart(2,"0")}`,Ge=u&&f!==u.nickname,dt=u&&S!==u.gender,Xe=u&&xe!==u.birth,We={};if(Ge&&(We.nickname=f),dt&&(We.gender=S),Xe&&(We.birth=xe),Object.keys(We).length===0){be(),de();return}K(!0);try{await $8(We),be(),de()}catch(Ae){if(console.error("  :",Ae),Ae instanceof Error&&Ae.message.includes(" ")){alert(" .  ."),ne("/login");return}alert("  .  .")}finally{K(!1)}};return u?P.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center relative safe-area-page","aria-busy":ie,children:[te&&P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4",role:"dialog","aria-modal":"true","aria-labelledby":"consent-title",children:P.jsxs("div",{className:"bg-white rounded-2xl p-6 md:p-8 max-w-md w-full max-h-[80vh] overflow-y-auto",children:[P.jsx("h2",{id:"consent-title",className:"text-xl md:text-2xl font-crimson font-bold text-gray-900 mb-4",children:"    "}),P.jsxs("div",{className:"space-y-4 mb-6 text-gray-700",children:[P.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[P.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"1.   "}),P.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[P.jsx("li",{children:" : , , , "}),P.jsx("li",{children:" :   ,  "})]})]}),P.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[P.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"2.     "}),P.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[P.jsx("li",{children:"    "}),P.jsx("li",{children:"    "}),P.jsx("li",{children:"   "}),P.jsx("li",{children:"  "})]})]}),P.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[P.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"3.     "}),P.jsx("p",{className:"text-sm",children:"   ,    . ,          ."})]})]}),P.jsx("div",{className:"pt-2",children:P.jsx("button",{onClick:Se,className:"w-full h-14 bg-login-button text-white font-crimson text-lg font-bold rounded-lg hover:bg-opacity-90 transition-colors",children:""})})]})}),ie&&P.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"profile-save-title","aria-describedby":"profile-save-desc",children:P.jsxs("div",{className:"bg-white rounded-lg p-6 mx-4 text-center",children:[P.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:P.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:P.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),P.jsx("h3",{id:"profile-save-title",className:"text-lg font-semibold text-gray-900 mb-2",children:" !"}),P.jsx("p",{id:"profile-save-desc",className:"text-gray-600",children:"    ..."})]})}),P.jsx("div",{className:"w-full max-w-sm md:max-w-md px-5 pt-4 pb-6",children:P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("button",{onClick:()=>{u.is_new_user?ne("/"):ne("/settings")},className:"p-2 -ml-2",children:P.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:P.jsx("path",{d:"M15 18L9 12L15 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),P.jsx("h1",{className:"text-lg font-crimson font-bold text-gray-900",children:" "}),P.jsx("div",{className:"w-10"})]})}),P.jsxs("div",{className:"w-full max-w-sm md:max-w-md px-5 space-y-6",children:[P.jsxs("div",{className:"text-center py-4",children:[P.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:u.is_new_user?"!":" "}),P.jsx("p",{className:"text-gray-600",children:u.is_new_user?"    .":"  ."})]}),P.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),P.jsx("p",{className:"text-gray-900",children:u.email})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),P.jsx("input",{type:"text",value:f,onChange:ye=>g(ye.target.value),placeholder:" ",disabled:u?.is_new_user&&!$,className:"w-full h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),P.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[P.jsx("button",{type:"button",onClick:()=>C("MALE"),disabled:u?.is_new_user&&!$,className:`h-12 md:h-14 px-4 border rounded-lg font-crimson text-lg md:text-xl transition-all ${S==="MALE"?"border-login-button bg-login-button/10 text-login-button":"border-border-gray text-gray-700 hover:border-login-button/50"} disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50`,children:""}),P.jsx("button",{type:"button",onClick:()=>C("FEMALE"),disabled:u?.is_new_user&&!$,className:`h-12 md:h-14 px-4 border rounded-lg font-crimson text-lg md:text-xl transition-all ${S==="FEMALE"?"border-login-button bg-login-button/10 text-login-button":"border-border-gray text-gray-700 hover:border-login-button/50"} disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50`,children:""})]})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),P.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[P.jsx("input",{type:"number",value:I,onChange:ye=>N(ye.target.value),placeholder:"(4)",min:"1900",max:new Date().getFullYear(),disabled:u?.is_new_user&&!$,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"}),P.jsx("input",{type:"number",value:k,onChange:ye=>M(ye.target.value),placeholder:"",min:"1",max:"12",disabled:u?.is_new_user&&!$,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"}),P.jsx("input",{type:"number",value:F,onChange:ye=>B(ye.target.value),placeholder:"",min:"1",max:"31",disabled:u?.is_new_user&&!$,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]}),P.jsx("div",{className:"pt-4",children:P.jsx("button",{onClick:fe,disabled:q||!f.trim()||!S||!I||!k||!F||ie,className:"w-full h-14 md:h-16 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl md:text-2xl font-bold rounded-lg hover:opacity-90 transition-opacity disabled:bg-gray-300 disabled:bg-none disabled:cursor-not-allowed",children:q?" ...":" "})})]})]}):P.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center safe-area-page",children:P.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button"})})}function Tl({children:u,requireProfileComplete:h=!1}){const[f,g]=ee.useState(!0),[S,C]=ee.useState(null),I=jh();return ee.useEffect(()=>{(()=>{try{const k=H1(),M=DE();if(!k||!M){I("/login");return}if(C(M),h&&(!M.is_profile_complete||M.is_new_user)){I("/profile-setup");return}g(!1)}catch(k){console.error("  :",k),I("/login")}})()},[I,h]),f?P.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button mx-auto mb-4"}),P.jsx("p",{className:"text-gray-600",children:"  ..."})]})}):P.jsx(P.Fragment,{children:u})}const hne=new j$,pne=()=>{const u=jh(),{categoryId:h,cancelMatching:f,resetMatching:g,status:S,matchingId:C}=X1(),I=ee.useRef(null),[N,k]=ee.useState(!1);ee.useEffect(()=>{(async()=>{await eF(),k(!0)})()},[]),ee.useEffect(()=>{const be=I.current;be!==null&&be!==S&&(S==="matched"&&C?u("/call-connected"):(S==="cancelled"||S==="timeout")&&u("/")),I.current=S},[S,C,u]);const M=be=>{if(!be)return null;const Se=Object.values(_0).find(fe=>fe.id===be);return Se?Se.name:null},F=async()=>{try{await f()}catch(be){console.error("  :",be)}finally{u("/")}},B=()=>{u("/call-connected")},q=()=>{u("/call-evaluation")},K=()=>{u("/")},ie=()=>{u("/")},X=()=>{u("/")},te=()=>{u("/my-activity")},ce=()=>{u("/profile-setup")},$=be=>{u(`/coming-soon?feature=${encodeURIComponent(be)}`)},le=()=>{u("/support")},ne=async()=>{u("/login")},de=()=>{u("/")};return N?P.jsx("div",{className:"w-full min-h-screen max-w-md mx-auto bg-white relative overflow-x-hidden",children:P.jsxs(kee,{children:[P.jsx(cs,{path:"/",element:P.jsx(one,{})}),P.jsx(cs,{path:"/login",element:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(cne,{onLogin:()=>{},onSignUp:()=>{}})})}),P.jsx(cs,{path:"/signup",element:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(lne,{onBack:()=>{},onSignUp:()=>{}})})}),P.jsx(cs,{path:"/oauth/callback",element:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(dne,{})})}),P.jsx(cs,{path:"/profile-setup",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(une,{})})})}),P.jsx(cs,{path:"/connecting-call",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(_F,{selectedCategory:M(h),onCancel:F,onConnected:B})})})}),P.jsx(cs,{path:"/call-connected",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(gF,{selectedCategory:M(h),onEndCall:q})})})}),P.jsx(cs,{path:"/call-evaluation",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(EF,{selectedCategory:M(h),onCallAgain:K,onSelectInterests:ie,onGoHome:de})})})}),P.jsx(cs,{path:"/my-activity",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(SF,{onBack:X})})})}),P.jsx(cs,{path:"/call-history",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(yF,{onBack:X})})})}),P.jsx(cs,{path:"/settings",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(vF,{onBack:X,onNavigateToActivity:te,onNavigateToProfileEdit:ce,onNavigateToComingSoon:$,onNavigateToSupport:le,onLogout:ne})})})}),P.jsx(cs,{path:"/coming-soon",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(TF,{})})})}),P.jsx(cs,{path:"/support",element:P.jsx(Tl,{children:P.jsx("div",{className:"max-w-md mx-auto",children:P.jsx(CF,{onBack:X})})})}),P.jsx(cs,{path:"*",element:P.jsx(ane,{})})]})}):P.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:P.jsxs("div",{className:"text-center",children:[P.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),P.jsx("p",{className:"text-gray-600",children:" ..."})]})})},fne=()=>P.jsx(B$,{client:hne,children:P.jsxs(m$,{children:[P.jsx(JJ,{}),P.jsx(NQ,{}),P.jsx(Mee,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:P.jsx(pne,{})})]})});ZJ.createRoot(document.getElementById("root")).render(P.jsx(fne,{}));
