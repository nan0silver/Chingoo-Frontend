function dX(u,h){for(var f=0;f<h.length;f++){const g=h[f];if(typeof g!="string"&&!Array.isArray(g)){for(const S in g)if(S!=="default"&&!(S in u)){const T=Object.getOwnPropertyDescriptor(g,S);T&&Object.defineProperty(u,S,T.get?T:{enumerable:!0,get:()=>g[S]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))g(S);new MutationObserver(S=>{for(const T of S)if(T.type==="childList")for(const R of T.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&g(R)}).observe(document,{childList:!0,subtree:!0});function f(S){const T={};return S.integrity&&(T.integrity=S.integrity),S.referrerPolicy&&(T.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?T.credentials="include":S.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function g(S){if(S.ep)return;S.ep=!0;const T=f(S);fetch(S.href,T)}})();function S0(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var GI={exports:{}},yE={},HI={exports:{}},En={},n4;function uX(){if(n4)return En;n4=1;/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u=Symbol.for("react.element"),h=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),R=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),B=Symbol.iterator;function Y(_e){return _e===null||typeof _e!="object"?null:(_e=B&&_e[B]||_e["@@iterator"],typeof _e=="function"?_e:null)}var H={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},re=Object.assign,X={};function te(_e,De,ct){this.props=_e,this.context=De,this.refs=X,this.updater=ct||H}te.prototype.isReactComponent={},te.prototype.setState=function(_e,De){if(typeof _e!="object"&&typeof _e!="function"&&_e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_e,De,"setState")},te.prototype.forceUpdate=function(_e){this.updater.enqueueForceUpdate(this,_e,"forceUpdate")};function ce(){}ce.prototype=te.prototype;function $(_e,De,ct){this.props=_e,this.context=De,this.refs=X,this.updater=ct||H}var le=$.prototype=new ce;le.constructor=$,re(le,te.prototype),le.isPureReactComponent=!0;var ne=Array.isArray,ue=Object.prototype.hasOwnProperty,Pe={current:null},he={key:!0,ref:!0,__self:!0,__source:!0};function de(_e,De,ct){var at,Ot={},Gt=null,yt=null;if(De!=null)for(at in De.ref!==void 0&&(yt=De.ref),De.key!==void 0&&(Gt=""+De.key),De)ue.call(De,at)&&!he.hasOwnProperty(at)&&(Ot[at]=De[at]);var pn=arguments.length-2;if(pn===1)Ot.children=ct;else if(1<pn){for(var vn=Array(pn),or=0;or<pn;or++)vn[or]=arguments[or+2];Ot.children=vn}if(_e&&_e.defaultProps)for(at in pn=_e.defaultProps,pn)Ot[at]===void 0&&(Ot[at]=pn[at]);return{$$typeof:u,type:_e,key:Gt,ref:yt,props:Ot,_owner:Pe.current}}function ye(_e,De){return{$$typeof:u,type:_e.type,key:De,ref:_e.ref,props:_e.props,_owner:_e._owner}}function Me(_e){return typeof _e=="object"&&_e!==null&&_e.$$typeof===u}function Je(_e){var De={"=":"=0",":":"=2"};return"$"+_e.replace(/[=:]/g,function(ct){return De[ct]})}var Ve=/\/+/g;function xe(_e,De){return typeof _e=="object"&&_e!==null&&_e.key!=null?Je(""+_e.key):De.toString(36)}function He(_e,De,ct,at,Ot){var Gt=typeof _e;(Gt==="undefined"||Gt==="boolean")&&(_e=null);var yt=!1;if(_e===null)yt=!0;else switch(Gt){case"string":case"number":yt=!0;break;case"object":switch(_e.$$typeof){case u:case h:yt=!0}}if(yt)return yt=_e,Ot=Ot(yt),_e=at===""?"."+xe(yt,0):at,ne(Ot)?(ct="",_e!=null&&(ct=_e.replace(Ve,"$&/")+"/"),He(Ot,De,ct,"",function(or){return or})):Ot!=null&&(Me(Ot)&&(Ot=ye(Ot,ct+(!Ot.key||yt&&yt.key===Ot.key?"":(""+Ot.key).replace(Ve,"$&/")+"/")+_e)),De.push(Ot)),1;if(yt=0,at=at===""?".":at+":",ne(_e))for(var pn=0;pn<_e.length;pn++){Gt=_e[pn];var vn=at+xe(Gt,pn);yt+=He(Gt,De,ct,vn,Ot)}else if(vn=Y(_e),typeof vn=="function")for(_e=vn.call(_e),pn=0;!(Gt=_e.next()).done;)Gt=Gt.value,vn=at+xe(Gt,pn++),yt+=He(Gt,De,ct,vn,Ot);else if(Gt==="object")throw De=String(_e),Error("Objects are not valid as a React child (found: "+(De==="[object Object]"?"object with keys {"+Object.keys(_e).join(", ")+"}":De)+"). If you meant to render a collection of children, use an array instead.");return yt}function dt(_e,De,ct){if(_e==null)return _e;var at=[],Ot=0;return He(_e,at,"","",function(Gt){return De.call(ct,Gt,Ot++)}),at}function Qe(_e){if(_e._status===-1){var De=_e._result;De=De(),De.then(function(ct){(_e._status===0||_e._status===-1)&&(_e._status=1,_e._result=ct)},function(ct){(_e._status===0||_e._status===-1)&&(_e._status=2,_e._result=ct)}),_e._status===-1&&(_e._status=0,_e._result=De)}if(_e._status===1)return _e._result.default;throw _e._result}var Ge={current:null},Ie={transition:null},ke={ReactCurrentDispatcher:Ge,ReactCurrentBatchConfig:Ie,ReactCurrentOwner:Pe};function Ye(){throw Error("act(...) is not supported in production builds of React.")}return En.Children={map:dt,forEach:function(_e,De,ct){dt(_e,function(){De.apply(this,arguments)},ct)},count:function(_e){var De=0;return dt(_e,function(){De++}),De},toArray:function(_e){return dt(_e,function(De){return De})||[]},only:function(_e){if(!Me(_e))throw Error("React.Children.only expected to receive a single React element child.");return _e}},En.Component=te,En.Fragment=f,En.Profiler=S,En.PureComponent=$,En.StrictMode=g,En.Suspense=k,En.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ke,En.act=Ye,En.cloneElement=function(_e,De,ct){if(_e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+_e+".");var at=re({},_e.props),Ot=_e.key,Gt=_e.ref,yt=_e._owner;if(De!=null){if(De.ref!==void 0&&(Gt=De.ref,yt=Pe.current),De.key!==void 0&&(Ot=""+De.key),_e.type&&_e.type.defaultProps)var pn=_e.type.defaultProps;for(vn in De)ue.call(De,vn)&&!he.hasOwnProperty(vn)&&(at[vn]=De[vn]===void 0&&pn!==void 0?pn[vn]:De[vn])}var vn=arguments.length-2;if(vn===1)at.children=ct;else if(1<vn){pn=Array(vn);for(var or=0;or<vn;or++)pn[or]=arguments[or+2];at.children=pn}return{$$typeof:u,type:_e.type,key:Ot,ref:Gt,props:at,_owner:yt}},En.createContext=function(_e){return _e={$$typeof:R,_currentValue:_e,_currentValue2:_e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},_e.Provider={$$typeof:T,_context:_e},_e.Consumer=_e},En.createElement=de,En.createFactory=function(_e){var De=de.bind(null,_e);return De.type=_e,De},En.createRef=function(){return{current:null}},En.forwardRef=function(_e){return{$$typeof:N,render:_e}},En.isValidElement=Me,En.lazy=function(_e){return{$$typeof:U,_payload:{_status:-1,_result:_e},_init:Qe}},En.memo=function(_e,De){return{$$typeof:x,type:_e,compare:De===void 0?null:De}},En.startTransition=function(_e){var De=Ie.transition;Ie.transition={};try{_e()}finally{Ie.transition=De}},En.unstable_act=Ye,En.useCallback=function(_e,De){return Ge.current.useCallback(_e,De)},En.useContext=function(_e){return Ge.current.useContext(_e)},En.useDebugValue=function(){},En.useDeferredValue=function(_e){return Ge.current.useDeferredValue(_e)},En.useEffect=function(_e,De){return Ge.current.useEffect(_e,De)},En.useId=function(){return Ge.current.useId()},En.useImperativeHandle=function(_e,De,ct){return Ge.current.useImperativeHandle(_e,De,ct)},En.useInsertionEffect=function(_e,De){return Ge.current.useInsertionEffect(_e,De)},En.useLayoutEffect=function(_e,De){return Ge.current.useLayoutEffect(_e,De)},En.useMemo=function(_e,De){return Ge.current.useMemo(_e,De)},En.useReducer=function(_e,De,ct){return Ge.current.useReducer(_e,De,ct)},En.useRef=function(_e){return Ge.current.useRef(_e)},En.useState=function(_e){return Ge.current.useState(_e)},En.useSyncExternalStore=function(_e,De,ct){return Ge.current.useSyncExternalStore(_e,De,ct)},En.useTransition=function(){return Ge.current.useTransition()},En.version="18.3.1",En}var r4;function RA(){return r4||(r4=1,HI.exports=uX()),HI.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i4;function hX(){if(i4)return yE;i4=1;var u=RA(),h=Symbol.for("react.element"),f=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,S=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,T={key:!0,ref:!0,__self:!0,__source:!0};function R(N,k,x){var U,B={},Y=null,H=null;x!==void 0&&(Y=""+x),k.key!==void 0&&(Y=""+k.key),k.ref!==void 0&&(H=k.ref);for(U in k)g.call(k,U)&&!T.hasOwnProperty(U)&&(B[U]=k[U]);if(N&&N.defaultProps)for(U in k=N.defaultProps,k)B[U]===void 0&&(B[U]=k[U]);return{$$typeof:h,type:N,key:Y,ref:H,props:B,_owner:S.current}}return yE.Fragment=f,yE.jsx=R,yE.jsxs=R,yE}var s4;function pX(){return s4||(s4=1,GI.exports=hX()),GI.exports}var O=pX(),ee=RA();const st=S0(ee),pj=dX({__proto__:null,default:st},[ee]),fX=1,mX=1e6;let KI=0;function _X(){return KI=(KI+1)%Number.MAX_SAFE_INTEGER,KI.toString()}const zI=new Map,o4=u=>{if(zI.has(u))return;const h=setTimeout(()=>{zI.delete(u),AE({type:"REMOVE_TOAST",toastId:u})},mX);zI.set(u,h)},gX=(u,h)=>{switch(h.type){case"ADD_TOAST":return{...u,toasts:[h.toast,...u.toasts].slice(0,fX)};case"UPDATE_TOAST":return{...u,toasts:u.toasts.map(f=>f.id===h.toast.id?{...f,...h.toast}:f)};case"DISMISS_TOAST":{const{toastId:f}=h;return f?o4(f):u.toasts.forEach(g=>{o4(g.id)}),{...u,toasts:u.toasts.map(g=>g.id===f||f===void 0?{...g,open:!1}:g)}}case"REMOVE_TOAST":return h.toastId===void 0?{...u,toasts:[]}:{...u,toasts:u.toasts.filter(f=>f.id!==h.toastId)}}},l0=[];let d0={toasts:[]};function AE(u){d0=gX(d0,u),l0.forEach(h=>{h(d0)})}function EX({...u}){const h=_X(),f=S=>AE({type:"UPDATE_TOAST",toast:{...S,id:h}}),g=()=>AE({type:"DISMISS_TOAST",toastId:h});return AE({type:"ADD_TOAST",toast:{...u,id:h,open:!0,onOpenChange:S=>{S||g()}}}),{id:h,dismiss:g,update:f}}function vX(){const[u,h]=ee.useState(d0);return ee.useEffect(()=>(l0.push(h),()=>{const f=l0.indexOf(h);f>-1&&l0.splice(f,1)}),[u]),{...u,toast:EX,dismiss:f=>AE({type:"DISMISS_TOAST",toastId:f})}}var YI={exports:{}},Ds={},qI={exports:{}},XI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a4;function SX(){return a4||(a4=1,function(u){function h(Ie,ke){var Ye=Ie.length;Ie.push(ke);e:for(;0<Ye;){var _e=Ye-1>>>1,De=Ie[_e];if(0<S(De,ke))Ie[_e]=ke,Ie[Ye]=De,Ye=_e;else break e}}function f(Ie){return Ie.length===0?null:Ie[0]}function g(Ie){if(Ie.length===0)return null;var ke=Ie[0],Ye=Ie.pop();if(Ye!==ke){Ie[0]=Ye;e:for(var _e=0,De=Ie.length,ct=De>>>1;_e<ct;){var at=2*(_e+1)-1,Ot=Ie[at],Gt=at+1,yt=Ie[Gt];if(0>S(Ot,Ye))Gt<De&&0>S(yt,Ot)?(Ie[_e]=yt,Ie[Gt]=Ye,_e=Gt):(Ie[_e]=Ot,Ie[at]=Ye,_e=at);else if(Gt<De&&0>S(yt,Ye))Ie[_e]=yt,Ie[Gt]=Ye,_e=Gt;else break e}}return ke}function S(Ie,ke){var Ye=Ie.sortIndex-ke.sortIndex;return Ye!==0?Ye:Ie.id-ke.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;u.unstable_now=function(){return T.now()}}else{var R=Date,N=R.now();u.unstable_now=function(){return R.now()-N}}var k=[],x=[],U=1,B=null,Y=3,H=!1,re=!1,X=!1,te=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(Ie){for(var ke=f(x);ke!==null;){if(ke.callback===null)g(x);else if(ke.startTime<=Ie)g(x),ke.sortIndex=ke.expirationTime,h(k,ke);else break;ke=f(x)}}function ne(Ie){if(X=!1,le(Ie),!re)if(f(k)!==null)re=!0,Qe(ue);else{var ke=f(x);ke!==null&&Ge(ne,ke.startTime-Ie)}}function ue(Ie,ke){re=!1,X&&(X=!1,ce(de),de=-1),H=!0;var Ye=Y;try{for(le(ke),B=f(k);B!==null&&(!(B.expirationTime>ke)||Ie&&!Je());){var _e=B.callback;if(typeof _e=="function"){B.callback=null,Y=B.priorityLevel;var De=_e(B.expirationTime<=ke);ke=u.unstable_now(),typeof De=="function"?B.callback=De:B===f(k)&&g(k),le(ke)}else g(k);B=f(k)}if(B!==null)var ct=!0;else{var at=f(x);at!==null&&Ge(ne,at.startTime-ke),ct=!1}return ct}finally{B=null,Y=Ye,H=!1}}var Pe=!1,he=null,de=-1,ye=5,Me=-1;function Je(){return!(u.unstable_now()-Me<ye)}function Ve(){if(he!==null){var Ie=u.unstable_now();Me=Ie;var ke=!0;try{ke=he(!0,Ie)}finally{ke?xe():(Pe=!1,he=null)}}else Pe=!1}var xe;if(typeof $=="function")xe=function(){$(Ve)};else if(typeof MessageChannel<"u"){var He=new MessageChannel,dt=He.port2;He.port1.onmessage=Ve,xe=function(){dt.postMessage(null)}}else xe=function(){te(Ve,0)};function Qe(Ie){he=Ie,Pe||(Pe=!0,xe())}function Ge(Ie,ke){de=te(function(){Ie(u.unstable_now())},ke)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Ie){Ie.callback=null},u.unstable_continueExecution=function(){re||H||(re=!0,Qe(ue))},u.unstable_forceFrameRate=function(Ie){0>Ie||125<Ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ye=0<Ie?Math.floor(1e3/Ie):5},u.unstable_getCurrentPriorityLevel=function(){return Y},u.unstable_getFirstCallbackNode=function(){return f(k)},u.unstable_next=function(Ie){switch(Y){case 1:case 2:case 3:var ke=3;break;default:ke=Y}var Ye=Y;Y=ke;try{return Ie()}finally{Y=Ye}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function(Ie,ke){switch(Ie){case 1:case 2:case 3:case 4:case 5:break;default:Ie=3}var Ye=Y;Y=Ie;try{return ke()}finally{Y=Ye}},u.unstable_scheduleCallback=function(Ie,ke,Ye){var _e=u.unstable_now();switch(typeof Ye=="object"&&Ye!==null?(Ye=Ye.delay,Ye=typeof Ye=="number"&&0<Ye?_e+Ye:_e):Ye=_e,Ie){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=Ye+De,Ie={id:U++,callback:ke,priorityLevel:Ie,startTime:Ye,expirationTime:De,sortIndex:-1},Ye>_e?(Ie.sortIndex=Ye,h(x,Ie),f(k)===null&&Ie===f(x)&&(X?(ce(de),de=-1):X=!0,Ge(ne,Ye-_e))):(Ie.sortIndex=De,h(k,Ie),re||H||(re=!0,Qe(ue))),Ie},u.unstable_shouldYield=Je,u.unstable_wrapCallback=function(Ie){var ke=Y;return function(){var Ye=Y;Y=ke;try{return Ie.apply(this,arguments)}finally{Y=Ye}}}}(XI)),XI}var c4;function yX(){return c4||(c4=1,qI.exports=SX()),qI.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l4;function TX(){if(l4)return Ds;l4=1;var u=RA(),h=yX();function f(a){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+a,_=1;_<arguments.length;_++)d+="&args[]="+encodeURIComponent(arguments[_]);return"Minified React error #"+a+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g=new Set,S={};function T(a,d){R(a,d),R(a+"Capture",d)}function R(a,d){for(S[a]=d,a=0;a<d.length;a++)g.add(d[a])}var N=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),k=Object.prototype.hasOwnProperty,x=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,U={},B={};function Y(a){return k.call(B,a)?!0:k.call(U,a)?!1:x.test(a)?B[a]=!0:(U[a]=!0,!1)}function H(a,d,_,C){if(_!==null&&_.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return C?!1:_!==null?!_.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function re(a,d,_,C){if(d===null||typeof d>"u"||H(a,d,_,C))return!0;if(C)return!1;if(_!==null)switch(_.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function X(a,d,_,C,I,L,q){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=C,this.attributeNamespace=I,this.mustUseProperty=_,this.propertyName=a,this.type=d,this.sanitizeURL=L,this.removeEmptyString=q}var te={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){te[a]=new X(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var d=a[0];te[d]=new X(d,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){te[a]=new X(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){te[a]=new X(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){te[a]=new X(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){te[a]=new X(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){te[a]=new X(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){te[a]=new X(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){te[a]=new X(a,5,!1,a.toLowerCase(),null,!1,!1)});var ce=/[\-:]([a-z])/g;function $(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var d=a.replace(ce,$);te[d]=new X(d,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var d=a.replace(ce,$);te[d]=new X(d,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var d=a.replace(ce,$);te[d]=new X(d,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){te[a]=new X(a,1,!1,a.toLowerCase(),null,!1,!1)}),te.xlinkHref=new X("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){te[a]=new X(a,1,!1,a.toLowerCase(),null,!0,!0)});function le(a,d,_,C){var I=te.hasOwnProperty(d)?te[d]:null;(I!==null?I.type!==0:C||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(re(d,_,I,C)&&(_=null),C||I===null?Y(d)&&(_===null?a.removeAttribute(d):a.setAttribute(d,""+_)):I.mustUseProperty?a[I.propertyName]=_===null?I.type===3?!1:"":_:(d=I.attributeName,C=I.attributeNamespace,_===null?a.removeAttribute(d):(I=I.type,_=I===3||I===4&&_===!0?"":""+_,C?a.setAttributeNS(C,d,_):a.setAttribute(d,_))))}var ne=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ue=Symbol.for("react.element"),Pe=Symbol.for("react.portal"),he=Symbol.for("react.fragment"),de=Symbol.for("react.strict_mode"),ye=Symbol.for("react.profiler"),Me=Symbol.for("react.provider"),Je=Symbol.for("react.context"),Ve=Symbol.for("react.forward_ref"),xe=Symbol.for("react.suspense"),He=Symbol.for("react.suspense_list"),dt=Symbol.for("react.memo"),Qe=Symbol.for("react.lazy"),Ge=Symbol.for("react.offscreen"),Ie=Symbol.iterator;function ke(a){return a===null||typeof a!="object"?null:(a=Ie&&a[Ie]||a["@@iterator"],typeof a=="function"?a:null)}var Ye=Object.assign,_e;function De(a){if(_e===void 0)try{throw Error()}catch(_){var d=_.stack.trim().match(/\n( *(at )?)/);_e=d&&d[1]||""}return`
`+_e+a}var ct=!1;function at(a,d){if(!a||ct)return"";ct=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(Le){var C=Le}Reflect.construct(a,[],d)}else{try{d.call()}catch(Le){C=Le}a.call(d.prototype)}else{try{throw Error()}catch(Le){C=Le}a()}}catch(Le){if(Le&&C&&typeof Le.stack=="string"){for(var I=Le.stack.split(`
`),L=C.stack.split(`
`),q=I.length-1,oe=L.length-1;1<=q&&0<=oe&&I[q]!==L[oe];)oe--;for(;1<=q&&0<=oe;q--,oe--)if(I[q]!==L[oe]){if(q!==1||oe!==1)do if(q--,oe--,0>oe||I[q]!==L[oe]){var me=`
`+I[q].replace(" at new "," at ");return a.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",a.displayName)),me}while(1<=q&&0<=oe);break}}}finally{ct=!1,Error.prepareStackTrace=_}return(a=a?a.displayName||a.name:"")?De(a):""}function Ot(a){switch(a.tag){case 5:return De(a.type);case 16:return De("Lazy");case 13:return De("Suspense");case 19:return De("SuspenseList");case 0:case 2:case 15:return a=at(a.type,!1),a;case 11:return a=at(a.type.render,!1),a;case 1:return a=at(a.type,!0),a;default:return""}}function Gt(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case he:return"Fragment";case Pe:return"Portal";case ye:return"Profiler";case de:return"StrictMode";case xe:return"Suspense";case He:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case Je:return(a.displayName||"Context")+".Consumer";case Me:return(a._context.displayName||"Context")+".Provider";case Ve:var d=a.render;return a=a.displayName,a||(a=d.displayName||d.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case dt:return d=a.displayName||null,d!==null?d:Gt(a.type)||"Memo";case Qe:d=a._payload,a=a._init;try{return Gt(a(d))}catch{}}return null}function yt(a){var d=a.type;switch(a.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=d.render,a=a.displayName||a.name||"",d.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gt(d);case 8:return d===de?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function pn(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function vn(a){var d=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function or(a){var d=vn(a)?"checked":"value",_=Object.getOwnPropertyDescriptor(a.constructor.prototype,d),C=""+a[d];if(!a.hasOwnProperty(d)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var I=_.get,L=_.set;return Object.defineProperty(a,d,{configurable:!0,get:function(){return I.call(this)},set:function(q){C=""+q,L.call(this,q)}}),Object.defineProperty(a,d,{enumerable:_.enumerable}),{getValue:function(){return C},setValue:function(q){C=""+q},stopTracking:function(){a._valueTracker=null,delete a[d]}}}}function hs(a){a._valueTracker||(a._valueTracker=or(a))}function Ua(a){if(!a)return!1;var d=a._valueTracker;if(!d)return!0;var _=d.getValue(),C="";return a&&(C=vn(a)?a.checked?"true":"false":a.value),a=C,a!==_?(d.setValue(a),!0):!1}function zr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function eu(a,d){var _=d.checked;return Ye({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:_??a._wrapperState.initialChecked})}function Bh(a,d){var _=d.defaultValue==null?"":d.defaultValue,C=d.checked!=null?d.checked:d.defaultChecked;_=pn(d.value!=null?d.value:_),a._wrapperState={initialChecked:C,initialValue:_,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function ps(a,d){d=d.checked,d!=null&&le(a,"checked",d,!1)}function tu(a,d){ps(a,d);var _=pn(d.value),C=d.type;if(_!=null)C==="number"?(_===0&&a.value===""||a.value!=_)&&(a.value=""+_):a.value!==""+_&&(a.value=""+_);else if(C==="submit"||C==="reset"){a.removeAttribute("value");return}d.hasOwnProperty("value")?Qr(a,d.type,_):d.hasOwnProperty("defaultValue")&&Qr(a,d.type,pn(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(a.defaultChecked=!!d.defaultChecked)}function fr(a,d,_){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var C=d.type;if(!(C!=="submit"&&C!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+a._wrapperState.initialValue,_||d===a.value||(a.value=d),a.defaultValue=d}_=a.name,_!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,_!==""&&(a.name=_)}function Qr(a,d,_){(d!=="number"||zr(a.ownerDocument)!==a)&&(_==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+_&&(a.defaultValue=""+_))}var fo=Array.isArray;function Di(a,d,_,C){if(a=a.options,d){d={};for(var I=0;I<_.length;I++)d["$"+_[I]]=!0;for(_=0;_<a.length;_++)I=d.hasOwnProperty("$"+a[_].value),a[_].selected!==I&&(a[_].selected=I),I&&C&&(a[_].defaultSelected=!0)}else{for(_=""+pn(_),d=null,I=0;I<a.length;I++){if(a[I].value===_){a[I].selected=!0,C&&(a[I].defaultSelected=!0);return}d!==null||a[I].disabled||(d=a[I])}d!==null&&(d.selected=!0)}}function bl(a,d){if(d.dangerouslySetInnerHTML!=null)throw Error(f(91));return Ye({},d,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Ms(a,d){var _=d.value;if(_==null){if(_=d.children,d=d.defaultValue,_!=null){if(d!=null)throw Error(f(92));if(fo(_)){if(1<_.length)throw Error(f(93));_=_[0]}d=_}d==null&&(d=""),_=d}a._wrapperState={initialValue:pn(_)}}function Or(a,d){var _=pn(d.value),C=pn(d.defaultValue);_!=null&&(_=""+_,_!==a.value&&(a.value=_),d.defaultValue==null&&a.defaultValue!==_&&(a.defaultValue=_)),C!=null&&(a.defaultValue=""+C)}function nu(a){var d=a.textContent;d===a._wrapperState.initialValue&&d!==""&&d!==null&&(a.value=d)}function li(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yr(a,d){return a==null||a==="http://www.w3.org/1999/xhtml"?li(d):a==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Uc,Il=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,_,C,I){MSApp.execUnsafeLocalFunction(function(){return a(d,_,C,I)})}:a}(function(a,d){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=d;else{for(Uc=Uc||document.createElement("div"),Uc.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Uc.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}});function Us(a,d){if(d){var _=a.firstChild;if(_&&_===a.lastChild&&_.nodeType===3){_.nodeValue=d;return}}a.textContent=d}var Va={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ru=["Webkit","ms","Moz","O"];Object.keys(Va).forEach(function(a){ru.forEach(function(d){d=d+a.charAt(0).toUpperCase()+a.substring(1),Va[d]=Va[a]})});function Vc(a,d,_){return d==null||typeof d=="boolean"||d===""?"":_||typeof d!="number"||d===0||Va.hasOwnProperty(a)&&Va[a]?(""+d).trim():d+"px"}function Ti(a,d){a=a.style;for(var _ in d)if(d.hasOwnProperty(_)){var C=_.indexOf("--")===0,I=Vc(_,d[_],C);_==="float"&&(_="cssFloat"),C?a.setProperty(_,I):a[_]=I}}var iu=Ye({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mo(a,d){if(d){if(iu[a]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(f(137,a));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(f(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(f(61))}if(d.style!=null&&typeof d.style!="object")throw Error(f(62))}}function su(a,d){if(a.indexOf("-")===-1)return typeof d.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _o=null;function jc(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Al=null,ja=null,go=null;function Vs(a){if(a=Iu(a)){if(typeof Al!="function")throw Error(f(280));var d=a.stateNode;d&&(d=cp(d),Al(a.stateNode,a.type,d))}}function Fa(a){ja?go?go.push(a):go=[a]:ja=a}function Kt(){if(ja){var a=ja,d=go;if(go=ja=null,Vs(a),d)for(a=0;a<d.length;a++)Vs(d[a])}}function fn(a,d){return a(d)}function Fn(){}var Ci=!1;function Li(a,d,_){if(Ci)return a(d,_);Ci=!0;try{return fn(a,d,_)}finally{Ci=!1,(ja!==null||go!==null)&&(Fn(),Kt())}}function Bn(a,d){var _=a.stateNode;if(_===null)return null;var C=cp(_);if(C===null)return null;_=C[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(a=a.type,C=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!C;break e;default:a=!1}if(a)return null;if(_&&typeof _!="function")throw Error(f(231,d,typeof _));return _}var js=!1;if(N)try{var $r={};Object.defineProperty($r,"passive",{get:function(){js=!0}}),window.addEventListener("test",$r,$r),window.removeEventListener("test",$r,$r)}catch{js=!1}function Xi(a,d,_,C,I,L,q,oe,me){var Le=Array.prototype.slice.call(arguments,3);try{d.apply(_,Le)}catch(Ze){this.onError(Ze)}}var Ol=!1,ou=null,au=!1,vm=null,HE={onError:function(a){Ol=!0,ou=a}};function KE(a,d,_,C,I,L,q,oe,me){Ol=!1,ou=null,Xi.apply(HE,arguments)}function j0(a,d,_,C,I,L,q,oe,me){if(KE.apply(this,arguments),Ol){if(Ol){var Le=ou;Ol=!1,ou=null}else throw Error(f(198));au||(au=!0,vm=Le)}}function Fc(a){var d=a,_=a;if(a.alternate)for(;d.return;)d=d.return;else{a=d;do d=a,(d.flags&4098)!==0&&(_=d.return),a=d.return;while(a)}return d.tag===3?_:null}function zE(a){if(a.tag===13){var d=a.memoizedState;if(d===null&&(a=a.alternate,a!==null&&(d=a.memoizedState)),d!==null)return d.dehydrated}return null}function Sm(a){if(Fc(a)!==a)throw Error(f(188))}function YE(a){var d=a.alternate;if(!d){if(d=Fc(a),d===null)throw Error(f(188));return d!==a?null:a}for(var _=a,C=d;;){var I=_.return;if(I===null)break;var L=I.alternate;if(L===null){if(C=I.return,C!==null){_=C;continue}break}if(I.child===L.child){for(L=I.child;L;){if(L===_)return Sm(I),a;if(L===C)return Sm(I),d;L=L.sibling}throw Error(f(188))}if(_.return!==C.return)_=I,C=L;else{for(var q=!1,oe=I.child;oe;){if(oe===_){q=!0,_=I,C=L;break}if(oe===C){q=!0,C=I,_=L;break}oe=oe.sibling}if(!q){for(oe=L.child;oe;){if(oe===_){q=!0,_=L,C=I;break}if(oe===C){q=!0,C=L,_=I;break}oe=oe.sibling}if(!q)throw Error(f(189))}}if(_.alternate!==C)throw Error(f(190))}if(_.tag!==3)throw Error(f(188));return _.stateNode.current===_?a:d}function Wh(a){return a=YE(a),a!==null?ym(a):null}function ym(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var d=ym(a);if(d!==null)return d;a=a.sibling}return null}var Bc=h.unstable_scheduleCallback,qE=h.unstable_cancelCallback,F0=h.unstable_shouldYield,Eo=h.unstable_requestPaint,Sr=h.unstable_now,B0=h.unstable_getCurrentPriorityLevel,mr=h.unstable_ImmediatePriority,XE=h.unstable_UserBlockingPriority,Gh=h.unstable_NormalPriority,W0=h.unstable_LowPriority,JE=h.unstable_IdlePriority,Nl=null,vo=null;function QE(a){if(vo&&typeof vo.onCommitFiberRoot=="function")try{vo.onCommitFiberRoot(Nl,a,void 0,(a.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:Pl,G0=Math.log,H0=Math.LN2;function Pl(a){return a>>>=0,a===0?32:31-(G0(a)/H0|0)|0}var kl=64,Hh=4194304;function An(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Kh(a,d){var _=a.pendingLanes;if(_===0)return 0;var C=0,I=a.suspendedLanes,L=a.pingedLanes,q=_&268435455;if(q!==0){var oe=q&~I;oe!==0?C=An(oe):(L&=q,L!==0&&(C=An(L)))}else q=_&~I,q!==0?C=An(q):L!==0&&(C=An(L));if(C===0)return 0;if(d!==0&&d!==C&&(d&I)===0&&(I=C&-C,L=d&-d,I>=L||I===16&&(L&4194240)!==0))return d;if((C&4)!==0&&(C|=_&16),d=a.entangledLanes,d!==0)for(a=a.entanglements,d&=C;0<d;)_=31-Fs(d),I=1<<_,C|=a[_],d&=~I;return C}function $E(a,d){switch(a){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ZE(a,d){for(var _=a.suspendedLanes,C=a.pingedLanes,I=a.expirationTimes,L=a.pendingLanes;0<L;){var q=31-Fs(L),oe=1<<q,me=I[q];me===-1?((oe&_)===0||(oe&C)!==0)&&(I[q]=$E(oe,d)):me<=d&&(a.expiredLanes|=oe),L&=~oe}}function Tm(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function ev(){var a=kl;return kl<<=1,(kl&4194240)===0&&(kl=64),a}function Cm(a){for(var d=[],_=0;31>_;_++)d.push(a);return d}function cu(a,d,_){a.pendingLanes|=d,d!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,d=31-Fs(d),a[d]=_}function K0(a,d){var _=a.pendingLanes&~d;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=d,a.mutableReadLanes&=d,a.entangledLanes&=d,d=a.entanglements;var C=a.eventTimes;for(a=a.expirationTimes;0<_;){var I=31-Fs(_),L=1<<I;d[I]=0,C[I]=-1,a[I]=-1,_&=~L}}function wm(a,d){var _=a.entangledLanes|=d;for(a=a.entanglements;_;){var C=31-Fs(_),I=1<<C;I&d|a[C]&d&&(a[C]|=d),_&=~I}}var On=0;function Rm(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var zh,bm,Yh,tv,Im,Am=!1,qh=[],Ba=null,Wa=null,Ga=null,lu=new Map,du=new Map,Ha=[],nv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rv(a,d){switch(a){case"focusin":case"focusout":Ba=null;break;case"dragenter":case"dragleave":Wa=null;break;case"mouseover":case"mouseout":Ga=null;break;case"pointerover":case"pointerout":lu.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":du.delete(d.pointerId)}}function uu(a,d,_,C,I,L){return a===null||a.nativeEvent!==L?(a={blockedOn:d,domEventName:_,eventSystemFlags:C,nativeEvent:L,targetContainers:[I]},d!==null&&(d=Iu(d),d!==null&&bm(d)),a):(a.eventSystemFlags|=C,d=a.targetContainers,I!==null&&d.indexOf(I)===-1&&d.push(I),a)}function z0(a,d,_,C,I){switch(d){case"focusin":return Ba=uu(Ba,a,d,_,C,I),!0;case"dragenter":return Wa=uu(Wa,a,d,_,C,I),!0;case"mouseover":return Ga=uu(Ga,a,d,_,C,I),!0;case"pointerover":var L=I.pointerId;return lu.set(L,uu(lu.get(L)||null,a,d,_,C,I)),!0;case"gotpointercapture":return L=I.pointerId,du.set(L,uu(du.get(L)||null,a,d,_,C,I)),!0}return!1}function Dl(a){var d=Hc(a.target);if(d!==null){var _=Fc(d);if(_!==null){if(d=_.tag,d===13){if(d=zE(_),d!==null){a.blockedOn=d,Im(a.priority,function(){Yh(_)});return}}else if(d===3&&_.stateNode.current.memoizedState.isDehydrated){a.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Xh(a){if(a.blockedOn!==null)return!1;for(var d=a.targetContainers;0<d.length;){var _=Om(a.domEventName,a.eventSystemFlags,d[0],a.nativeEvent);if(_===null){_=a.nativeEvent;var C=new _.constructor(_.type,_);_o=C,_.target.dispatchEvent(C),_o=null}else return d=Iu(_),d!==null&&bm(d),a.blockedOn=_,!1;d.shift()}return!0}function iv(a,d,_){Xh(a)&&_.delete(d)}function Y0(){Am=!1,Ba!==null&&Xh(Ba)&&(Ba=null),Wa!==null&&Xh(Wa)&&(Wa=null),Ga!==null&&Xh(Ga)&&(Ga=null),lu.forEach(iv),du.forEach(iv)}function hu(a,d){a.blockedOn===d&&(a.blockedOn=null,Am||(Am=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,Y0)))}function Ll(a){function d(I){return hu(I,a)}if(0<qh.length){hu(qh[0],a);for(var _=1;_<qh.length;_++){var C=qh[_];C.blockedOn===a&&(C.blockedOn=null)}}for(Ba!==null&&hu(Ba,a),Wa!==null&&hu(Wa,a),Ga!==null&&hu(Ga,a),lu.forEach(d),du.forEach(d),_=0;_<Ha.length;_++)C=Ha[_],C.blockedOn===a&&(C.blockedOn=null);for(;0<Ha.length&&(_=Ha[0],_.blockedOn===null);)Dl(_),_.blockedOn===null&&Ha.shift()}var xl=ne.ReactCurrentBatchConfig,Jh=!0;function q0(a,d,_,C){var I=On,L=xl.transition;xl.transition=null;try{On=1,xi(a,d,_,C)}finally{On=I,xl.transition=L}}function Ka(a,d,_,C){var I=On,L=xl.transition;xl.transition=null;try{On=4,xi(a,d,_,C)}finally{On=I,xl.transition=L}}function xi(a,d,_,C){if(Jh){var I=Om(a,d,_,C);if(I===null)Xm(a,d,C,pu,_),rv(a,C);else if(z0(I,a,d,_,C))C.stopPropagation();else if(rv(a,C),d&4&&-1<nv.indexOf(a)){for(;I!==null;){var L=Iu(I);if(L!==null&&zh(L),L=Om(a,d,_,C),L===null&&Xm(a,d,C,pu,_),L===I)break;I=L}I!==null&&C.stopPropagation()}else Xm(a,d,C,null,_)}}var pu=null;function Om(a,d,_,C){if(pu=null,a=jc(C),a=Hc(a),a!==null)if(d=Fc(a),d===null)a=null;else if(_=d.tag,_===13){if(a=zE(d),a!==null)return a;a=null}else if(_===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;a=null}else d!==a&&(a=null);return pu=a,null}function sv(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(B0()){case mr:return 1;case XE:return 4;case Gh:case W0:return 16;case JE:return 536870912;default:return 16}default:return 16}}var za=null,Zr=null,Qh=null;function ov(){if(Qh)return Qh;var a,d=Zr,_=d.length,C,I="value"in za?za.value:za.textContent,L=I.length;for(a=0;a<_&&d[a]===I[a];a++);var q=_-a;for(C=1;C<=q&&d[_-C]===I[L-C];C++);return Qh=I.slice(a,1<C?1-C:void 0)}function $h(a){var d=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&d===13&&(a=13)):a=d,a===10&&(a=13),32<=a||a===13?a:0}function Wc(){return!0}function Nm(){return!1}function Ji(a){function d(_,C,I,L,q){this._reactName=_,this._targetInst=I,this.type=C,this.nativeEvent=L,this.target=q,this.currentTarget=null;for(var oe in a)a.hasOwnProperty(oe)&&(_=a[oe],this[oe]=_?_(L):L[oe]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Wc:Nm,this.isPropagationStopped=Nm,this}return Ye(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=Wc)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=Wc)},persist:function(){},isPersistent:Wc}),d}var Ya={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pm=Ji(Ya),Gc=Ye({},Ya,{view:0,detail:0}),km=Ji(Gc),fu,Dm,mu,So=Ye({},Gc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xm,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==mu&&(mu&&a.type==="mousemove"?(fu=a.screenX-mu.screenX,Dm=a.screenY-mu.screenY):Dm=fu=0,mu=a),fu)},movementY:function(a){return"movementY"in a?a.movementY:Dm}}),Ml=Ji(So),X0=Ye({},So,{dataTransfer:0}),J0=Ji(X0),Q0=Ye({},Gc,{relatedTarget:0}),Lm=Ji(Q0),$0=Ye({},Ya,{animationName:0,elapsedTime:0,pseudoElement:0}),Ul=Ji($0),Z0=Ye({},Ya,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Vl=Ji(Z0),av=Ye({},Ya,{data:0}),cv=Ji(av),qt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nC(a){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(a):(a=tC[a])?!!d[a]:!1}function xm(){return nC}var Mm=Ye({},Gc,{key:function(a){if(a.key){var d=qt[a.key]||a.key;if(d!=="Unidentified")return d}return a.type==="keypress"?(a=$h(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?eC[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xm,charCode:function(a){return a.type==="keypress"?$h(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?$h(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),rC=Ji(Mm),iC=Ye({},So,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lv=Ji(iC),Um=Ye({},Gc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xm}),sC=Ji(Um),oC=Ye({},Ya,{propertyName:0,elapsedTime:0,pseudoElement:0}),dv=Ji(oC),aC=Ye({},So,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),qa=Ji(aC),cC=[9,13,27,32],Vm=N&&"CompositionEvent"in window,_u=null;N&&"documentMode"in document&&(_u=document.documentMode);var uv=N&&"TextEvent"in window&&!_u,Zh=N&&(!Vm||_u&&8<_u&&11>=_u),hv=" ",pv=!1;function fv(a,d){switch(a){case"keyup":return cC.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qi(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var jl=!1;function lC(a,d){switch(a){case"compositionend":return Qi(d);case"keypress":return d.which!==32?null:(pv=!0,hv);case"textInput":return a=d.data,a===hv&&pv?null:a;default:return null}}function dC(a,d){if(jl)return a==="compositionend"||!Vm&&fv(a,d)?(a=ov(),Qh=Zr=za=null,jl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Zh&&d.locale!=="ko"?null:d.data;default:return null}}var uC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jm(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d==="input"?!!uC[a.type]:d==="textarea"}function mv(a,d,_,C){Fa(C),d=Cu(d,"onChange"),0<d.length&&(_=new Pm("onChange","change",null,_,C),a.push({event:_,listeners:d}))}var gu=null,Fl=null;function Fm(a){bv(a,0)}function ep(a){var d=Yl(a);if(Ua(d))return a}function hC(a,d){if(a==="change")return d}var Eu=!1;if(N){var Bm;if(N){var Wm="oninput"in document;if(!Wm){var _v=document.createElement("div");_v.setAttribute("oninput","return;"),Wm=typeof _v.oninput=="function"}Bm=Wm}else Bm=!1;Eu=Bm&&(!document.documentMode||9<document.documentMode)}function Jo(){gu&&(gu.detachEvent("onpropertychange",gv),Fl=gu=null)}function gv(a){if(a.propertyName==="value"&&ep(Fl)){var d=[];mv(d,Fl,a,jc(a)),Li(Fm,d)}}function pC(a,d,_){a==="focusin"?(Jo(),gu=d,Fl=_,gu.attachEvent("onpropertychange",gv)):a==="focusout"&&Jo()}function Mi(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return ep(Fl)}function fC(a,d){if(a==="click")return ep(d)}function mC(a,d){if(a==="input"||a==="change")return ep(d)}function _C(a,d){return a===d&&(a!==0||1/a===1/d)||a!==a&&d!==d}var Bs=typeof Object.is=="function"?Object.is:_C;function Bl(a,d){if(Bs(a,d))return!0;if(typeof a!="object"||a===null||typeof d!="object"||d===null)return!1;var _=Object.keys(a),C=Object.keys(d);if(_.length!==C.length)return!1;for(C=0;C<_.length;C++){var I=_[C];if(!k.call(d,I)||!Bs(a[I],d[I]))return!1}return!0}function Ev(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function vv(a,d){var _=Ev(a);a=0;for(var C;_;){if(_.nodeType===3){if(C=a+_.textContent.length,a<=d&&C>=d)return{node:_,offset:d-a};a=C}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=Ev(_)}}function Sv(a,d){return a&&d?a===d?!0:a&&a.nodeType===3?!1:d&&d.nodeType===3?Sv(a,d.parentNode):"contains"in a?a.contains(d):a.compareDocumentPosition?!!(a.compareDocumentPosition(d)&16):!1:!1}function Gm(){for(var a=window,d=zr();d instanceof a.HTMLIFrameElement;){try{var _=typeof d.contentWindow.location.href=="string"}catch{_=!1}if(_)a=d.contentWindow;else break;d=zr(a.document)}return d}function Hm(a){var d=a&&a.nodeName&&a.nodeName.toLowerCase();return d&&(d==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||d==="textarea"||a.contentEditable==="true")}function gC(a){var d=Gm(),_=a.focusedElem,C=a.selectionRange;if(d!==_&&_&&_.ownerDocument&&Sv(_.ownerDocument.documentElement,_)){if(C!==null&&Hm(_)){if(d=C.start,a=C.end,a===void 0&&(a=d),"selectionStart"in _)_.selectionStart=d,_.selectionEnd=Math.min(a,_.value.length);else if(a=(d=_.ownerDocument||document)&&d.defaultView||window,a.getSelection){a=a.getSelection();var I=_.textContent.length,L=Math.min(C.start,I);C=C.end===void 0?L:Math.min(C.end,I),!a.extend&&L>C&&(I=C,C=L,L=I),I=vv(_,L);var q=vv(_,C);I&&q&&(a.rangeCount!==1||a.anchorNode!==I.node||a.anchorOffset!==I.offset||a.focusNode!==q.node||a.focusOffset!==q.offset)&&(d=d.createRange(),d.setStart(I.node,I.offset),a.removeAllRanges(),L>C?(a.addRange(d),a.extend(q.node,q.offset)):(d.setEnd(q.node,q.offset),a.addRange(d)))}}for(d=[],a=_;a=a.parentNode;)a.nodeType===1&&d.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<d.length;_++)a=d[_],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var Km=N&&"documentMode"in document&&11>=document.documentMode,Xa=null,zm=null,Ae=null,Ym=!1;function yv(a,d,_){var C=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Ym||Xa==null||Xa!==zr(C)||(C=Xa,"selectionStart"in C&&Hm(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),Ae&&Bl(Ae,C)||(Ae=C,C=Cu(zm,"onSelect"),0<C.length&&(d=new Pm("onSelect","select",null,d,_),a.push({event:d,listeners:C}),d.target=Xa)))}function tp(a,d){var _={};return _[a.toLowerCase()]=d.toLowerCase(),_["Webkit"+a]="webkit"+d,_["Moz"+a]="moz"+d,_}var Wl={animationend:tp("Animation","AnimationEnd"),animationiteration:tp("Animation","AnimationIteration"),animationstart:tp("Animation","AnimationStart"),transitionend:tp("Transition","TransitionEnd")},np={},qm={};N&&(qm=document.createElement("div").style,"AnimationEvent"in window||(delete Wl.animationend.animation,delete Wl.animationiteration.animation,delete Wl.animationstart.animation),"TransitionEvent"in window||delete Wl.transitionend.transition);function rp(a){if(np[a])return np[a];if(!Wl[a])return a;var d=Wl[a],_;for(_ in d)if(d.hasOwnProperty(_)&&_ in qm)return np[a]=d[_];return a}var Tv=rp("animationend"),Cv=rp("animationiteration"),vu=rp("animationstart"),Gl=rp("transitionend"),wv=new Map,Rv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ws(a,d){wv.set(a,d),T(d,[a])}for(var Su=0;Su<Rv.length;Su++){var Hl=Rv[Su],EC=Hl.toLowerCase(),vC=Hl[0].toUpperCase()+Hl.slice(1);Ws(EC,"on"+vC)}Ws(Tv,"onAnimationEnd"),Ws(Cv,"onAnimationIteration"),Ws(vu,"onAnimationStart"),Ws("dblclick","onDoubleClick"),Ws("focusin","onFocus"),Ws("focusout","onBlur"),Ws(Gl,"onTransitionEnd"),R("onMouseEnter",["mouseout","mouseover"]),R("onMouseLeave",["mouseout","mouseover"]),R("onPointerEnter",["pointerout","pointerover"]),R("onPointerLeave",["pointerout","pointerover"]),T("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),T("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),T("onBeforeInput",["compositionend","keypress","textInput","paste"]),T("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),T("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),T("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SC=new Set("cancel close invalid load scroll toggle".split(" ").concat(yu));function ip(a,d,_){var C=a.type||"unknown-event";a.currentTarget=_,j0(C,d,void 0,a),a.currentTarget=null}function bv(a,d){d=(d&4)!==0;for(var _=0;_<a.length;_++){var C=a[_],I=C.event;C=C.listeners;e:{var L=void 0;if(d)for(var q=C.length-1;0<=q;q--){var oe=C[q],me=oe.instance,Le=oe.currentTarget;if(oe=oe.listener,me!==L&&I.isPropagationStopped())break e;ip(I,oe,Le),L=me}else for(q=0;q<C.length;q++){if(oe=C[q],me=oe.instance,Le=oe.currentTarget,oe=oe.listener,me!==L&&I.isPropagationStopped())break e;ip(I,oe,Le),L=me}}}if(au)throw a=vm,au=!1,vm=null,a}function zn(a,d){var _=d[Zm];_===void 0&&(_=d[Zm]=new Set);var C=a+"__bubble";_.has(C)||(Iv(d,a,2,!1),_.add(C))}function Ui(a,d,_){var C=0;d&&(C|=4),Iv(_,a,C,d)}var sp="_reactListening"+Math.random().toString(36).slice(2);function Qo(a){if(!a[sp]){a[sp]=!0,g.forEach(function(_){_!=="selectionchange"&&(SC.has(_)||Ui(_,!1,a),Ui(_,!0,a))});var d=a.nodeType===9?a:a.ownerDocument;d===null||d[sp]||(d[sp]=!0,Ui("selectionchange",!1,d))}}function Iv(a,d,_,C){switch(sv(d)){case 1:var I=q0;break;case 4:I=Ka;break;default:I=xi}_=I.bind(null,d,_,a),I=void 0,!js||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(I=!0),C?I!==void 0?a.addEventListener(d,_,{capture:!0,passive:I}):a.addEventListener(d,_,!0):I!==void 0?a.addEventListener(d,_,{passive:I}):a.addEventListener(d,_,!1)}function Xm(a,d,_,C,I){var L=C;if((d&1)===0&&(d&2)===0&&C!==null)e:for(;;){if(C===null)return;var q=C.tag;if(q===3||q===4){var oe=C.stateNode.containerInfo;if(oe===I||oe.nodeType===8&&oe.parentNode===I)break;if(q===4)for(q=C.return;q!==null;){var me=q.tag;if((me===3||me===4)&&(me=q.stateNode.containerInfo,me===I||me.nodeType===8&&me.parentNode===I))return;q=q.return}for(;oe!==null;){if(q=Hc(oe),q===null)return;if(me=q.tag,me===5||me===6){C=L=q;continue e}oe=oe.parentNode}}C=C.return}Li(function(){var Le=L,Ze=jc(_),et=[];e:{var $e=wv.get(a);if($e!==void 0){var _t=Pm,Tt=a;switch(a){case"keypress":if($h(_)===0)break e;case"keydown":case"keyup":_t=rC;break;case"focusin":Tt="focus",_t=Lm;break;case"focusout":Tt="blur",_t=Lm;break;case"beforeblur":case"afterblur":_t=Lm;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_t=Ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_t=J0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_t=sC;break;case Tv:case Cv:case vu:_t=Ul;break;case Gl:_t=dv;break;case"scroll":_t=km;break;case"wheel":_t=qa;break;case"copy":case"cut":case"paste":_t=Vl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_t=lv}var wt=(d&4)!==0,lr=!wt&&a==="scroll",Ce=wt?$e!==null?$e+"Capture":null:$e;wt=[];for(var ge=Le,Oe;ge!==null;){Oe=ge;var nt=Oe.stateNode;if(Oe.tag===5&&nt!==null&&(Oe=nt,Ce!==null&&(nt=Bn(ge,Ce),nt!=null&&wt.push(Tu(ge,nt,Oe)))),lr)break;ge=ge.return}0<wt.length&&($e=new _t($e,Tt,null,_,Ze),et.push({event:$e,listeners:wt}))}}if((d&7)===0){e:{if($e=a==="mouseover"||a==="pointerover",_t=a==="mouseout"||a==="pointerout",$e&&_!==_o&&(Tt=_.relatedTarget||_.fromElement)&&(Hc(Tt)||Tt[$o]))break e;if((_t||$e)&&($e=Ze.window===Ze?Ze:($e=Ze.ownerDocument)?$e.defaultView||$e.parentWindow:window,_t?(Tt=_.relatedTarget||_.toElement,_t=Le,Tt=Tt?Hc(Tt):null,Tt!==null&&(lr=Fc(Tt),Tt!==lr||Tt.tag!==5&&Tt.tag!==6)&&(Tt=null)):(_t=null,Tt=Le),_t!==Tt)){if(wt=Ml,nt="onMouseLeave",Ce="onMouseEnter",ge="mouse",(a==="pointerout"||a==="pointerover")&&(wt=lv,nt="onPointerLeave",Ce="onPointerEnter",ge="pointer"),lr=_t==null?$e:Yl(_t),Oe=Tt==null?$e:Yl(Tt),$e=new wt(nt,ge+"leave",_t,_,Ze),$e.target=lr,$e.relatedTarget=Oe,nt=null,Hc(Ze)===Le&&(wt=new wt(Ce,ge+"enter",Tt,_,Ze),wt.target=Oe,wt.relatedTarget=lr,nt=wt),lr=nt,_t&&Tt)t:{for(wt=_t,Ce=Tt,ge=0,Oe=wt;Oe;Oe=Kl(Oe))ge++;for(Oe=0,nt=Ce;nt;nt=Kl(nt))Oe++;for(;0<ge-Oe;)wt=Kl(wt),ge--;for(;0<Oe-ge;)Ce=Kl(Ce),Oe--;for(;ge--;){if(wt===Ce||Ce!==null&&wt===Ce.alternate)break t;wt=Kl(wt),Ce=Kl(Ce)}wt=null}else wt=null;_t!==null&&Av(et,$e,_t,wt,!1),Tt!==null&&lr!==null&&Av(et,lr,Tt,wt,!0)}}e:{if($e=Le?Yl(Le):window,_t=$e.nodeName&&$e.nodeName.toLowerCase(),_t==="select"||_t==="input"&&$e.type==="file")var Rt=hC;else if(jm($e))if(Eu)Rt=mC;else{Rt=Mi;var kt=pC}else(_t=$e.nodeName)&&_t.toLowerCase()==="input"&&($e.type==="checkbox"||$e.type==="radio")&&(Rt=fC);if(Rt&&(Rt=Rt(a,Le))){mv(et,Rt,_,Ze);break e}kt&&kt(a,$e,Le),a==="focusout"&&(kt=$e._wrapperState)&&kt.controlled&&$e.type==="number"&&Qr($e,"number",$e.value)}switch(kt=Le?Yl(Le):window,a){case"focusin":(jm(kt)||kt.contentEditable==="true")&&(Xa=kt,zm=Le,Ae=null);break;case"focusout":Ae=zm=Xa=null;break;case"mousedown":Ym=!0;break;case"contextmenu":case"mouseup":case"dragend":Ym=!1,yv(et,_,Ze);break;case"selectionchange":if(Km)break;case"keydown":case"keyup":yv(et,_,Ze)}var Dt;if(Vm)e:{switch(a){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else jl?fv(a,_)&&(Vt="onCompositionEnd"):a==="keydown"&&_.keyCode===229&&(Vt="onCompositionStart");Vt&&(Zh&&_.locale!=="ko"&&(jl||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&jl&&(Dt=ov()):(za=Ze,Zr="value"in za?za.value:za.textContent,jl=!0)),kt=Cu(Le,Vt),0<kt.length&&(Vt=new cv(Vt,a,null,_,Ze),et.push({event:Vt,listeners:kt}),Dt?Vt.data=Dt:(Dt=Qi(_),Dt!==null&&(Vt.data=Dt)))),(Dt=uv?lC(a,_):dC(a,_))&&(Le=Cu(Le,"onBeforeInput"),0<Le.length&&(Ze=new cv("onBeforeInput","beforeinput",null,_,Ze),et.push({event:Ze,listeners:Le}),Ze.data=Dt))}bv(et,d)})}function Tu(a,d,_){return{instance:a,listener:d,currentTarget:_}}function Cu(a,d){for(var _=d+"Capture",C=[];a!==null;){var I=a,L=I.stateNode;I.tag===5&&L!==null&&(I=L,L=Bn(a,_),L!=null&&C.unshift(Tu(a,L,I)),L=Bn(a,d),L!=null&&C.push(Tu(a,L,I))),a=a.return}return C}function Kl(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Av(a,d,_,C,I){for(var L=d._reactName,q=[];_!==null&&_!==C;){var oe=_,me=oe.alternate,Le=oe.stateNode;if(me!==null&&me===C)break;oe.tag===5&&Le!==null&&(oe=Le,I?(me=Bn(_,L),me!=null&&q.unshift(Tu(_,me,oe))):I||(me=Bn(_,L),me!=null&&q.push(Tu(_,me,oe)))),_=_.return}q.length!==0&&a.push({event:d,listeners:q})}var yC=/\r\n?/g,Jm=/\u0000|\uFFFD/g;function Ov(a){return(typeof a=="string"?a:""+a).replace(yC,`
`).replace(Jm,"")}function wu(a,d,_){if(d=Ov(d),Ov(a)!==d&&_)throw Error(f(425))}function Ru(){}var Qm=null,op=null;function zl(a,d){return a==="textarea"||a==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var $m=typeof setTimeout=="function"?setTimeout:void 0,TC=typeof clearTimeout=="function"?clearTimeout:void 0,Nv=typeof Promise=="function"?Promise:void 0,CC=typeof queueMicrotask=="function"?queueMicrotask:typeof Nv<"u"?function(a){return Nv.resolve(null).then(a).catch(wC)}:$m;function wC(a){setTimeout(function(){throw a})}function ap(a,d){var _=d,C=0;do{var I=_.nextSibling;if(a.removeChild(_),I&&I.nodeType===8)if(_=I.data,_==="/$"){if(C===0){a.removeChild(I),Ll(d);return}C--}else _!=="$"&&_!=="$?"&&_!=="$!"||C++;_=I}while(_);Ll(d)}function yo(a){for(;a!=null;a=a.nextSibling){var d=a.nodeType;if(d===1||d===3)break;if(d===8){if(d=a.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return a}function Pv(a){a=a.previousSibling;for(var d=0;a;){if(a.nodeType===8){var _=a.data;if(_==="$"||_==="$!"||_==="$?"){if(d===0)return a;d--}else _==="/$"&&d++}a=a.previousSibling}return null}var Ja=Math.random().toString(36).slice(2),To="__reactFiber$"+Ja,bu="__reactProps$"+Ja,$o="__reactContainer$"+Ja,Zm="__reactEvents$"+Ja,RC="__reactListeners$"+Ja,bC="__reactHandles$"+Ja;function Hc(a){var d=a[To];if(d)return d;for(var _=a.parentNode;_;){if(d=_[$o]||_[To]){if(_=d.alternate,d.child!==null||_!==null&&_.child!==null)for(a=Pv(a);a!==null;){if(_=a[To])return _;a=Pv(a)}return d}a=_,_=a.parentNode}return null}function Iu(a){return a=a[To]||a[$o],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Yl(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(f(33))}function cp(a){return a[bu]||null}var e_=[],Zo=-1;function Gs(a){return{current:a}}function Wn(a){0>Zo||(a.current=e_[Zo],e_[Zo]=null,Zo--)}function Yn(a,d){Zo++,e_[Zo]=a.current,a.current=d}var Qa={},di=Gs(Qa),wi=Gs(!1),$a=Qa;function Za(a,d){var _=a.type.contextTypes;if(!_)return Qa;var C=a.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===d)return C.__reactInternalMemoizedMaskedChildContext;var I={},L;for(L in _)I[L]=d[L];return C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=d,a.__reactInternalMemoizedMaskedChildContext=I),I}function Vi(a){return a=a.childContextTypes,a!=null}function lp(){Wn(wi),Wn(di)}function ql(a,d,_){if(di.current!==Qa)throw Error(f(168));Yn(di,d),Yn(wi,_)}function kv(a,d,_){var C=a.stateNode;if(d=d.childContextTypes,typeof C.getChildContext!="function")return _;C=C.getChildContext();for(var I in C)if(!(I in d))throw Error(f(108,yt(a)||"Unknown",I));return Ye({},_,C)}function dp(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Qa,$a=di.current,Yn(di,a),Yn(wi,wi.current),!0}function Dv(a,d,_){var C=a.stateNode;if(!C)throw Error(f(169));_?(a=kv(a,d,$a),C.__reactInternalMemoizedMergedChildContext=a,Wn(wi),Wn(di),Yn(di,a)):Wn(wi),Yn(wi,_)}var ea=null,up=!1,t_=!1;function n_(a){ea===null?ea=[a]:ea.push(a)}function IC(a){up=!0,n_(a)}function ec(){if(!t_&&ea!==null){t_=!0;var a=0,d=On;try{var _=ea;for(On=1;a<_.length;a++){var C=_[a];do C=C(!0);while(C!==null)}ea=null,up=!1}catch(I){throw ea!==null&&(ea=ea.slice(a+1)),Bc(mr,ec),I}finally{On=d,t_=!1}}return null}var Xl=[],tc=0,hp=null,pp=0,Ri=[],fs=0,Kc=null,ta=1,na="";function zc(a,d){Xl[tc++]=pp,Xl[tc++]=hp,hp=a,pp=d}function Lv(a,d,_){Ri[fs++]=ta,Ri[fs++]=na,Ri[fs++]=Kc,Kc=a;var C=ta;a=na;var I=32-Fs(C)-1;C&=~(1<<I),_+=1;var L=32-Fs(d)+I;if(30<L){var q=I-I%5;L=(C&(1<<q)-1).toString(32),C>>=q,I-=q,ta=1<<32-Fs(d)+I|_<<I|C,na=L+a}else ta=1<<L|_<<I|C,na=a}function Jl(a){a.return!==null&&(zc(a,1),Lv(a,1,0))}function fp(a){for(;a===hp;)hp=Xl[--tc],Xl[tc]=null,pp=Xl[--tc],Xl[tc]=null;for(;a===Kc;)Kc=Ri[--fs],Ri[fs]=null,na=Ri[--fs],Ri[fs]=null,ta=Ri[--fs],Ri[fs]=null}var $i=null,Zi=null,$n=!1,Hs=null;function xv(a,d){var _=vs(5,null,null,0);_.elementType="DELETED",_.stateNode=d,_.return=a,d=a.deletions,d===null?(a.deletions=[_],a.flags|=16):d.push(_)}function Mv(a,d){switch(a.tag){case 5:var _=a.type;return d=d.nodeType!==1||_.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(a.stateNode=d,$i=a,Zi=yo(d.firstChild),!0):!1;case 6:return d=a.pendingProps===""||d.nodeType!==3?null:d,d!==null?(a.stateNode=d,$i=a,Zi=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(_=Kc!==null?{id:ta,overflow:na}:null,a.memoizedState={dehydrated:d,treeContext:_,retryLane:1073741824},_=vs(18,null,null,0),_.stateNode=d,_.return=a,a.child=_,$i=a,Zi=null,!0):!1;default:return!1}}function Au(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Ou(a){if($n){var d=Zi;if(d){var _=d;if(!Mv(a,d)){if(Au(a))throw Error(f(418));d=yo(_.nextSibling);var C=$i;d&&Mv(a,d)?xv(C,_):(a.flags=a.flags&-4097|2,$n=!1,$i=a)}}else{if(Au(a))throw Error(f(418));a.flags=a.flags&-4097|2,$n=!1,$i=a}}}function r_(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;$i=a}function Ql(a){if(a!==$i)return!1;if(!$n)return r_(a),$n=!0,!1;var d;if((d=a.tag!==3)&&!(d=a.tag!==5)&&(d=a.type,d=d!=="head"&&d!=="body"&&!zl(a.type,a.memoizedProps)),d&&(d=Zi)){if(Au(a))throw i_(),Error(f(418));for(;d;)xv(a,d),d=yo(d.nextSibling)}if(r_(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(f(317));e:{for(a=a.nextSibling,d=0;a;){if(a.nodeType===8){var _=a.data;if(_==="/$"){if(d===0){Zi=yo(a.nextSibling);break e}d--}else _!=="$"&&_!=="$!"&&_!=="$?"||d++}a=a.nextSibling}Zi=null}}else Zi=$i?yo(a.stateNode.nextSibling):null;return!0}function i_(){for(var a=Zi;a;)a=yo(a.nextSibling)}function Yc(){Zi=$i=null,$n=!1}function $l(a){Hs===null?Hs=[a]:Hs.push(a)}var Nu=ne.ReactCurrentBatchConfig;function Pu(a,d,_){if(a=_.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(_._owner){if(_=_._owner,_){if(_.tag!==1)throw Error(f(309));var C=_.stateNode}if(!C)throw Error(f(147,a));var I=C,L=""+a;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===L?d.ref:(d=function(q){var oe=I.refs;q===null?delete oe[L]:oe[L]=q},d._stringRef=L,d)}if(typeof a!="string")throw Error(f(284));if(!_._owner)throw Error(f(290,a))}return a}function mp(a,d){throw a=Object.prototype.toString.call(d),Error(f(31,a==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":a))}function s_(a){var d=a._init;return d(a._payload)}function Uv(a){function d(Ce,ge){if(a){var Oe=Ce.deletions;Oe===null?(Ce.deletions=[ge],Ce.flags|=16):Oe.push(ge)}}function _(Ce,ge){if(!a)return null;for(;ge!==null;)d(Ce,ge),ge=ge.sibling;return null}function C(Ce,ge){for(Ce=new Map;ge!==null;)ge.key!==null?Ce.set(ge.key,ge):Ce.set(ge.index,ge),ge=ge.sibling;return Ce}function I(Ce,ge){return Ce=pc(Ce,ge),Ce.index=0,Ce.sibling=null,Ce}function L(Ce,ge,Oe){return Ce.index=Oe,a?(Oe=Ce.alternate,Oe!==null?(Oe=Oe.index,Oe<ge?(Ce.flags|=2,ge):Oe):(Ce.flags|=2,ge)):(Ce.flags|=1048576,ge)}function q(Ce){return a&&Ce.alternate===null&&(Ce.flags|=2),Ce}function oe(Ce,ge,Oe,nt){return ge===null||ge.tag!==6?(ge=Kp(Oe,Ce.mode,nt),ge.return=Ce,ge):(ge=I(ge,Oe),ge.return=Ce,ge)}function me(Ce,ge,Oe,nt){var Rt=Oe.type;return Rt===he?Ze(Ce,ge,Oe.props.children,nt,Oe.key):ge!==null&&(ge.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Qe&&s_(Rt)===ge.type)?(nt=I(ge,Oe.props),nt.ref=Pu(Ce,ge,Oe),nt.return=Ce,nt):(nt=dd(Oe.type,Oe.key,Oe.props,null,Ce.mode,nt),nt.ref=Pu(Ce,ge,Oe),nt.return=Ce,nt)}function Le(Ce,ge,Oe,nt){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Oe.containerInfo||ge.stateNode.implementation!==Oe.implementation?(ge=ud(Oe,Ce.mode,nt),ge.return=Ce,ge):(ge=I(ge,Oe.children||[]),ge.return=Ce,ge)}function Ze(Ce,ge,Oe,nt,Rt){return ge===null||ge.tag!==7?(ge=fc(Oe,Ce.mode,nt,Rt),ge.return=Ce,ge):(ge=I(ge,Oe),ge.return=Ce,ge)}function et(Ce,ge,Oe){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=Kp(""+ge,Ce.mode,Oe),ge.return=Ce,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case ue:return Oe=dd(ge.type,ge.key,ge.props,null,Ce.mode,Oe),Oe.ref=Pu(Ce,null,ge),Oe.return=Ce,Oe;case Pe:return ge=ud(ge,Ce.mode,Oe),ge.return=Ce,ge;case Qe:var nt=ge._init;return et(Ce,nt(ge._payload),Oe)}if(fo(ge)||ke(ge))return ge=fc(ge,Ce.mode,Oe,null),ge.return=Ce,ge;mp(Ce,ge)}return null}function $e(Ce,ge,Oe,nt){var Rt=ge!==null?ge.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return Rt!==null?null:oe(Ce,ge,""+Oe,nt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case ue:return Oe.key===Rt?me(Ce,ge,Oe,nt):null;case Pe:return Oe.key===Rt?Le(Ce,ge,Oe,nt):null;case Qe:return Rt=Oe._init,$e(Ce,ge,Rt(Oe._payload),nt)}if(fo(Oe)||ke(Oe))return Rt!==null?null:Ze(Ce,ge,Oe,nt,null);mp(Ce,Oe)}return null}function _t(Ce,ge,Oe,nt,Rt){if(typeof nt=="string"&&nt!==""||typeof nt=="number")return Ce=Ce.get(Oe)||null,oe(ge,Ce,""+nt,Rt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case ue:return Ce=Ce.get(nt.key===null?Oe:nt.key)||null,me(ge,Ce,nt,Rt);case Pe:return Ce=Ce.get(nt.key===null?Oe:nt.key)||null,Le(ge,Ce,nt,Rt);case Qe:var kt=nt._init;return _t(Ce,ge,Oe,kt(nt._payload),Rt)}if(fo(nt)||ke(nt))return Ce=Ce.get(Oe)||null,Ze(ge,Ce,nt,Rt,null);mp(ge,nt)}return null}function Tt(Ce,ge,Oe,nt){for(var Rt=null,kt=null,Dt=ge,Vt=ge=0,jr=null;Dt!==null&&Vt<Oe.length;Vt++){Dt.index>Vt?(jr=Dt,Dt=null):jr=Dt.sibling;var Rn=$e(Ce,Dt,Oe[Vt],nt);if(Rn===null){Dt===null&&(Dt=jr);break}a&&Dt&&Rn.alternate===null&&d(Ce,Dt),ge=L(Rn,ge,Vt),kt===null?Rt=Rn:kt.sibling=Rn,kt=Rn,Dt=jr}if(Vt===Oe.length)return _(Ce,Dt),$n&&zc(Ce,Vt),Rt;if(Dt===null){for(;Vt<Oe.length;Vt++)Dt=et(Ce,Oe[Vt],nt),Dt!==null&&(ge=L(Dt,ge,Vt),kt===null?Rt=Dt:kt.sibling=Dt,kt=Dt);return $n&&zc(Ce,Vt),Rt}for(Dt=C(Ce,Dt);Vt<Oe.length;Vt++)jr=_t(Dt,Ce,Vt,Oe[Vt],nt),jr!==null&&(a&&jr.alternate!==null&&Dt.delete(jr.key===null?Vt:jr.key),ge=L(jr,ge,Vt),kt===null?Rt=jr:kt.sibling=jr,kt=jr);return a&&Dt.forEach(function(Ao){return d(Ce,Ao)}),$n&&zc(Ce,Vt),Rt}function wt(Ce,ge,Oe,nt){var Rt=ke(Oe);if(typeof Rt!="function")throw Error(f(150));if(Oe=Rt.call(Oe),Oe==null)throw Error(f(151));for(var kt=Rt=null,Dt=ge,Vt=ge=0,jr=null,Rn=Oe.next();Dt!==null&&!Rn.done;Vt++,Rn=Oe.next()){Dt.index>Vt?(jr=Dt,Dt=null):jr=Dt.sibling;var Ao=$e(Ce,Dt,Rn.value,nt);if(Ao===null){Dt===null&&(Dt=jr);break}a&&Dt&&Ao.alternate===null&&d(Ce,Dt),ge=L(Ao,ge,Vt),kt===null?Rt=Ao:kt.sibling=Ao,kt=Ao,Dt=jr}if(Rn.done)return _(Ce,Dt),$n&&zc(Ce,Vt),Rt;if(Dt===null){for(;!Rn.done;Vt++,Rn=Oe.next())Rn=et(Ce,Rn.value,nt),Rn!==null&&(ge=L(Rn,ge,Vt),kt===null?Rt=Rn:kt.sibling=Rn,kt=Rn);return $n&&zc(Ce,Vt),Rt}for(Dt=C(Ce,Dt);!Rn.done;Vt++,Rn=Oe.next())Rn=_t(Dt,Ce,Vt,Rn.value,nt),Rn!==null&&(a&&Rn.alternate!==null&&Dt.delete(Rn.key===null?Vt:Rn.key),ge=L(Rn,ge,Vt),kt===null?Rt=Rn:kt.sibling=Rn,kt=Rn);return a&&Dt.forEach(function(HC){return d(Ce,HC)}),$n&&zc(Ce,Vt),Rt}function lr(Ce,ge,Oe,nt){if(typeof Oe=="object"&&Oe!==null&&Oe.type===he&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case ue:e:{for(var Rt=Oe.key,kt=ge;kt!==null;){if(kt.key===Rt){if(Rt=Oe.type,Rt===he){if(kt.tag===7){_(Ce,kt.sibling),ge=I(kt,Oe.props.children),ge.return=Ce,Ce=ge;break e}}else if(kt.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Qe&&s_(Rt)===kt.type){_(Ce,kt.sibling),ge=I(kt,Oe.props),ge.ref=Pu(Ce,kt,Oe),ge.return=Ce,Ce=ge;break e}_(Ce,kt);break}else d(Ce,kt);kt=kt.sibling}Oe.type===he?(ge=fc(Oe.props.children,Ce.mode,nt,Oe.key),ge.return=Ce,Ce=ge):(nt=dd(Oe.type,Oe.key,Oe.props,null,Ce.mode,nt),nt.ref=Pu(Ce,ge,Oe),nt.return=Ce,Ce=nt)}return q(Ce);case Pe:e:{for(kt=Oe.key;ge!==null;){if(ge.key===kt)if(ge.tag===4&&ge.stateNode.containerInfo===Oe.containerInfo&&ge.stateNode.implementation===Oe.implementation){_(Ce,ge.sibling),ge=I(ge,Oe.children||[]),ge.return=Ce,Ce=ge;break e}else{_(Ce,ge);break}else d(Ce,ge);ge=ge.sibling}ge=ud(Oe,Ce.mode,nt),ge.return=Ce,Ce=ge}return q(Ce);case Qe:return kt=Oe._init,lr(Ce,ge,kt(Oe._payload),nt)}if(fo(Oe))return Tt(Ce,ge,Oe,nt);if(ke(Oe))return wt(Ce,ge,Oe,nt);mp(Ce,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"?(Oe=""+Oe,ge!==null&&ge.tag===6?(_(Ce,ge.sibling),ge=I(ge,Oe),ge.return=Ce,Ce=ge):(_(Ce,ge),ge=Kp(Oe,Ce.mode,nt),ge.return=Ce,Ce=ge),q(Ce)):_(Ce,ge)}return lr}var Zl=Uv(!0),o_=Uv(!1),_p=Gs(null),gp=null,ed=null,a_=null;function c_(){a_=ed=gp=null}function l_(a){var d=_p.current;Wn(_p),a._currentValue=d}function Ep(a,d,_){for(;a!==null;){var C=a.alternate;if((a.childLanes&d)!==d?(a.childLanes|=d,C!==null&&(C.childLanes|=d)):C!==null&&(C.childLanes&d)!==d&&(C.childLanes|=d),a===_)break;a=a.return}}function Ks(a,d){gp=a,a_=ed=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&d)!==0&&(Fi=!0),a.firstContext=null)}function ms(a){var d=a._currentValue;if(a_!==a)if(a={context:a,memoizedValue:d,next:null},ed===null){if(gp===null)throw Error(f(308));ed=a,gp.dependencies={lanes:0,firstContext:a}}else ed=ed.next=a;return d}var qc=null;function d_(a){qc===null?qc=[a]:qc.push(a)}function u_(a,d,_,C){var I=d.interleaved;return I===null?(_.next=_,d_(d)):(_.next=I.next,I.next=_),d.interleaved=_,ra(a,C)}function ra(a,d){a.lanes|=d;var _=a.alternate;for(_!==null&&(_.lanes|=d),_=a,a=a.return;a!==null;)a.childLanes|=d,_=a.alternate,_!==null&&(_.childLanes|=d),_=a,a=a.return;return _.tag===3?_.stateNode:null}var ia=!1;function h_(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Vv(a,d){a=a.updateQueue,d.updateQueue===a&&(d.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function sa(a,d){return{eventTime:a,lane:d,tag:0,payload:null,callback:null,next:null}}function zs(a,d,_){var C=a.updateQueue;if(C===null)return null;if(C=C.shared,(ln&2)!==0){var I=C.pending;return I===null?d.next=d:(d.next=I.next,I.next=d),C.pending=d,ra(a,_)}return I=C.interleaved,I===null?(d.next=d,d_(C)):(d.next=I.next,I.next=d),C.interleaved=d,ra(a,_)}function vp(a,d,_){if(d=d.updateQueue,d!==null&&(d=d.shared,(_&4194240)!==0)){var C=d.lanes;C&=a.pendingLanes,_|=C,d.lanes=_,wm(a,_)}}function jv(a,d){var _=a.updateQueue,C=a.alternate;if(C!==null&&(C=C.updateQueue,_===C)){var I=null,L=null;if(_=_.firstBaseUpdate,_!==null){do{var q={eventTime:_.eventTime,lane:_.lane,tag:_.tag,payload:_.payload,callback:_.callback,next:null};L===null?I=L=q:L=L.next=q,_=_.next}while(_!==null);L===null?I=L=d:L=L.next=d}else I=L=d;_={baseState:C.baseState,firstBaseUpdate:I,lastBaseUpdate:L,shared:C.shared,effects:C.effects},a.updateQueue=_;return}a=_.lastBaseUpdate,a===null?_.firstBaseUpdate=d:a.next=d,_.lastBaseUpdate=d}function Sp(a,d,_,C){var I=a.updateQueue;ia=!1;var L=I.firstBaseUpdate,q=I.lastBaseUpdate,oe=I.shared.pending;if(oe!==null){I.shared.pending=null;var me=oe,Le=me.next;me.next=null,q===null?L=Le:q.next=Le,q=me;var Ze=a.alternate;Ze!==null&&(Ze=Ze.updateQueue,oe=Ze.lastBaseUpdate,oe!==q&&(oe===null?Ze.firstBaseUpdate=Le:oe.next=Le,Ze.lastBaseUpdate=me))}if(L!==null){var et=I.baseState;q=0,Ze=Le=me=null,oe=L;do{var $e=oe.lane,_t=oe.eventTime;if((C&$e)===$e){Ze!==null&&(Ze=Ze.next={eventTime:_t,lane:0,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null});e:{var Tt=a,wt=oe;switch($e=d,_t=_,wt.tag){case 1:if(Tt=wt.payload,typeof Tt=="function"){et=Tt.call(_t,et,$e);break e}et=Tt;break e;case 3:Tt.flags=Tt.flags&-65537|128;case 0:if(Tt=wt.payload,$e=typeof Tt=="function"?Tt.call(_t,et,$e):Tt,$e==null)break e;et=Ye({},et,$e);break e;case 2:ia=!0}}oe.callback!==null&&oe.lane!==0&&(a.flags|=64,$e=I.effects,$e===null?I.effects=[oe]:$e.push(oe))}else _t={eventTime:_t,lane:$e,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},Ze===null?(Le=Ze=_t,me=et):Ze=Ze.next=_t,q|=$e;if(oe=oe.next,oe===null){if(oe=I.shared.pending,oe===null)break;$e=oe,oe=$e.next,$e.next=null,I.lastBaseUpdate=$e,I.shared.pending=null}}while(!0);if(Ze===null&&(me=et),I.baseState=me,I.firstBaseUpdate=Le,I.lastBaseUpdate=Ze,d=I.shared.interleaved,d!==null){I=d;do q|=I.lane,I=I.next;while(I!==d)}else L===null&&(I.shared.lanes=0);nl|=q,a.lanes=q,a.memoizedState=et}}function Fv(a,d,_){if(a=d.effects,d.effects=null,a!==null)for(d=0;d<a.length;d++){var C=a[d],I=C.callback;if(I!==null){if(C.callback=null,C=_,typeof I!="function")throw Error(f(191,I));I.call(C)}}}var ku={},Co=Gs(ku),Xc=Gs(ku),Du=Gs(ku);function nc(a){if(a===ku)throw Error(f(174));return a}function p_(a,d){switch(Yn(Du,d),Yn(Xc,a),Yn(Co,ku),a=d.nodeType,a){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:Yr(null,"");break;default:a=a===8?d.parentNode:d,d=a.namespaceURI||null,a=a.tagName,d=Yr(d,a)}Wn(Co),Yn(Co,d)}function Jc(){Wn(Co),Wn(Xc),Wn(Du)}function Bv(a){nc(Du.current);var d=nc(Co.current),_=Yr(d,a.type);d!==_&&(Yn(Xc,a),Yn(Co,_))}function f_(a){Xc.current===a&&(Wn(Co),Wn(Xc))}var ar=Gs(0);function yp(a){for(var d=a;d!==null;){if(d.tag===13){var _=d.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||_.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var m_=[];function __(){for(var a=0;a<m_.length;a++)m_[a]._workInProgressVersionPrimary=null;m_.length=0}var Lu=ne.ReactCurrentDispatcher,g_=ne.ReactCurrentBatchConfig,Qc=0,rr=null,Mr=null,yr=null,xu=!1,oa=!1,Mu=0,AC=0;function ui(){throw Error(f(321))}function E_(a,d){if(d===null)return!1;for(var _=0;_<d.length&&_<a.length;_++)if(!Bs(a[_],d[_]))return!1;return!0}function td(a,d,_,C,I,L){if(Qc=L,rr=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Lu.current=a===null||a.memoizedState===null?NC:Jv,a=_(C,I),oa){L=0;do{if(oa=!1,Mu=0,25<=L)throw Error(f(301));L+=1,yr=Mr=null,d.updateQueue=null,Lu.current=PC,a=_(C,I)}while(oa)}if(Lu.current=rd,d=Mr!==null&&Mr.next!==null,Qc=0,yr=Mr=rr=null,xu=!1,d)throw Error(f(300));return a}function v_(){var a=Mu!==0;return Mu=0,a}function Ys(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yr===null?rr.memoizedState=yr=a:yr=yr.next=a,yr}function ji(){if(Mr===null){var a=rr.alternate;a=a!==null?a.memoizedState:null}else a=Mr.next;var d=yr===null?rr.memoizedState:yr.next;if(d!==null)yr=d,Mr=a;else{if(a===null)throw Error(f(310));Mr=a,a={memoizedState:Mr.memoizedState,baseState:Mr.baseState,baseQueue:Mr.baseQueue,queue:Mr.queue,next:null},yr===null?rr.memoizedState=yr=a:yr=yr.next=a}return yr}function $c(a,d){return typeof d=="function"?d(a):d}function S_(a){var d=ji(),_=d.queue;if(_===null)throw Error(f(311));_.lastRenderedReducer=a;var C=Mr,I=C.baseQueue,L=_.pending;if(L!==null){if(I!==null){var q=I.next;I.next=L.next,L.next=q}C.baseQueue=I=L,_.pending=null}if(I!==null){L=I.next,C=C.baseState;var oe=q=null,me=null,Le=L;do{var Ze=Le.lane;if((Qc&Ze)===Ze)me!==null&&(me=me.next={lane:0,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null}),C=Le.hasEagerState?Le.eagerState:a(C,Le.action);else{var et={lane:Ze,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null};me===null?(oe=me=et,q=C):me=me.next=et,rr.lanes|=Ze,nl|=Ze}Le=Le.next}while(Le!==null&&Le!==L);me===null?q=C:me.next=oe,Bs(C,d.memoizedState)||(Fi=!0),d.memoizedState=C,d.baseState=q,d.baseQueue=me,_.lastRenderedState=C}if(a=_.interleaved,a!==null){I=a;do L=I.lane,rr.lanes|=L,nl|=L,I=I.next;while(I!==a)}else I===null&&(_.lanes=0);return[d.memoizedState,_.dispatch]}function y_(a){var d=ji(),_=d.queue;if(_===null)throw Error(f(311));_.lastRenderedReducer=a;var C=_.dispatch,I=_.pending,L=d.memoizedState;if(I!==null){_.pending=null;var q=I=I.next;do L=a(L,q.action),q=q.next;while(q!==I);Bs(L,d.memoizedState)||(Fi=!0),d.memoizedState=L,d.baseQueue===null&&(d.baseState=L),_.lastRenderedState=L}return[L,C]}function Wv(){}function Gv(a,d){var _=rr,C=ji(),I=d(),L=!Bs(C.memoizedState,I);if(L&&(C.memoizedState=I,Fi=!0),C=C.queue,wp(Kv.bind(null,_,C,a),[a]),C.getSnapshot!==d||L||yr!==null&&yr.memoizedState.tag&1){if(_.flags|=2048,aa(9,Uu.bind(null,_,C,I,d),void 0,null),Ur===null)throw Error(f(349));(Qc&30)!==0||Hv(_,d,I)}return I}function Hv(a,d,_){a.flags|=16384,a={getSnapshot:d,value:_},d=rr.updateQueue,d===null?(d={lastEffect:null,stores:null},rr.updateQueue=d,d.stores=[a]):(_=d.stores,_===null?d.stores=[a]:_.push(a))}function Uu(a,d,_,C){d.value=_,d.getSnapshot=C,Zc(d)&&Tp(a)}function Kv(a,d,_){return _(function(){Zc(d)&&Tp(a)})}function Zc(a){var d=a.getSnapshot;a=a.value;try{var _=d();return!Bs(a,_)}catch{return!0}}function Tp(a){var d=ra(a,1);d!==null&&ns(d,a,1,-1)}function Vu(a){var d=Ys();return typeof a=="function"&&(a=a()),d.memoizedState=d.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$c,lastRenderedState:a},d.queue=a,a=a.dispatch=el.bind(null,rr,a),[d.memoizedState,a]}function aa(a,d,_,C){return a={tag:a,create:d,destroy:_,deps:C,next:null},d=rr.updateQueue,d===null?(d={lastEffect:null,stores:null},rr.updateQueue=d,d.lastEffect=a.next=a):(_=d.lastEffect,_===null?d.lastEffect=a.next=a:(C=_.next,_.next=a,a.next=C,d.lastEffect=a)),a}function ju(){return ji().memoizedState}function Cp(a,d,_,C){var I=Ys();rr.flags|=a,I.memoizedState=aa(1|d,_,void 0,C===void 0?null:C)}function Fu(a,d,_,C){var I=ji();C=C===void 0?null:C;var L=void 0;if(Mr!==null){var q=Mr.memoizedState;if(L=q.destroy,C!==null&&E_(C,q.deps)){I.memoizedState=aa(d,_,L,C);return}}rr.flags|=a,I.memoizedState=aa(1|d,_,L,C)}function zv(a,d){return Cp(8390656,8,a,d)}function wp(a,d){return Fu(2048,8,a,d)}function Yv(a,d){return Fu(4,2,a,d)}function qv(a,d){return Fu(4,4,a,d)}function Rp(a,d){if(typeof d=="function")return a=a(),d(a),function(){d(null)};if(d!=null)return a=a(),d.current=a,function(){d.current=null}}function bp(a,d,_){return _=_!=null?_.concat([a]):null,Fu(4,4,Rp.bind(null,d,a),_)}function T_(){}function Xv(a,d){var _=ji();d=d===void 0?null:d;var C=_.memoizedState;return C!==null&&d!==null&&E_(d,C[1])?C[0]:(_.memoizedState=[a,d],a)}function C_(a,d){var _=ji();d=d===void 0?null:d;var C=_.memoizedState;return C!==null&&d!==null&&E_(d,C[1])?C[0]:(a=a(),_.memoizedState=[a,d],a)}function Ip(a,d,_){return(Qc&21)===0?(a.baseState&&(a.baseState=!1,Fi=!0),a.memoizedState=_):(Bs(_,d)||(_=ev(),rr.lanes|=_,nl|=_,a.baseState=!0),d)}function OC(a,d){var _=On;On=_!==0&&4>_?_:4,a(!0);var C=g_.transition;g_.transition={};try{a(!1),d()}finally{On=_,g_.transition=C}}function qs(){return ji().memoizedState}function nd(a,d,_){var C=lc(a);if(_={lane:C,action:_,hasEagerState:!1,eagerState:null,next:null},w_(a))R_(d,_);else if(_=u_(a,d,_,C),_!==null){var I=Ii();ns(_,a,C,I),rc(_,d,C)}}function el(a,d,_){var C=lc(a),I={lane:C,action:_,hasEagerState:!1,eagerState:null,next:null};if(w_(a))R_(d,I);else{var L=a.alternate;if(a.lanes===0&&(L===null||L.lanes===0)&&(L=d.lastRenderedReducer,L!==null))try{var q=d.lastRenderedState,oe=L(q,_);if(I.hasEagerState=!0,I.eagerState=oe,Bs(oe,q)){var me=d.interleaved;me===null?(I.next=I,d_(d)):(I.next=me.next,me.next=I),d.interleaved=I;return}}catch{}finally{}_=u_(a,d,I,C),_!==null&&(I=Ii(),ns(_,a,C,I),rc(_,d,C))}}function w_(a){var d=a.alternate;return a===rr||d!==null&&d===rr}function R_(a,d){oa=xu=!0;var _=a.pending;_===null?d.next=d:(d.next=_.next,_.next=d),a.pending=d}function rc(a,d,_){if((_&4194240)!==0){var C=d.lanes;C&=a.pendingLanes,_|=C,d.lanes=_,wm(a,_)}}var rd={readContext:ms,useCallback:ui,useContext:ui,useEffect:ui,useImperativeHandle:ui,useInsertionEffect:ui,useLayoutEffect:ui,useMemo:ui,useReducer:ui,useRef:ui,useState:ui,useDebugValue:ui,useDeferredValue:ui,useTransition:ui,useMutableSource:ui,useSyncExternalStore:ui,useId:ui,unstable_isNewReconciler:!1},NC={readContext:ms,useCallback:function(a,d){return Ys().memoizedState=[a,d===void 0?null:d],a},useContext:ms,useEffect:zv,useImperativeHandle:function(a,d,_){return _=_!=null?_.concat([a]):null,Cp(4194308,4,Rp.bind(null,d,a),_)},useLayoutEffect:function(a,d){return Cp(4194308,4,a,d)},useInsertionEffect:function(a,d){return Cp(4,2,a,d)},useMemo:function(a,d){var _=Ys();return d=d===void 0?null:d,a=a(),_.memoizedState=[a,d],a},useReducer:function(a,d,_){var C=Ys();return d=_!==void 0?_(d):d,C.memoizedState=C.baseState=d,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:d},C.queue=a,a=a.dispatch=nd.bind(null,rr,a),[C.memoizedState,a]},useRef:function(a){var d=Ys();return a={current:a},d.memoizedState=a},useState:Vu,useDebugValue:T_,useDeferredValue:function(a){return Ys().memoizedState=a},useTransition:function(){var a=Vu(!1),d=a[0];return a=OC.bind(null,a[1]),Ys().memoizedState=a,[d,a]},useMutableSource:function(){},useSyncExternalStore:function(a,d,_){var C=rr,I=Ys();if($n){if(_===void 0)throw Error(f(407));_=_()}else{if(_=d(),Ur===null)throw Error(f(349));(Qc&30)!==0||Hv(C,d,_)}I.memoizedState=_;var L={value:_,getSnapshot:d};return I.queue=L,zv(Kv.bind(null,C,L,a),[a]),C.flags|=2048,aa(9,Uu.bind(null,C,L,_,d),void 0,null),_},useId:function(){var a=Ys(),d=Ur.identifierPrefix;if($n){var _=na,C=ta;_=(C&~(1<<32-Fs(C)-1)).toString(32)+_,d=":"+d+"R"+_,_=Mu++,0<_&&(d+="H"+_.toString(32)),d+=":"}else _=AC++,d=":"+d+"r"+_.toString(32)+":";return a.memoizedState=d},unstable_isNewReconciler:!1},Jv={readContext:ms,useCallback:Xv,useContext:ms,useEffect:wp,useImperativeHandle:bp,useInsertionEffect:Yv,useLayoutEffect:qv,useMemo:C_,useReducer:S_,useRef:ju,useState:function(){return S_($c)},useDebugValue:T_,useDeferredValue:function(a){var d=ji();return Ip(d,Mr.memoizedState,a)},useTransition:function(){var a=S_($c)[0],d=ji().memoizedState;return[a,d]},useMutableSource:Wv,useSyncExternalStore:Gv,useId:qs,unstable_isNewReconciler:!1},PC={readContext:ms,useCallback:Xv,useContext:ms,useEffect:wp,useImperativeHandle:bp,useInsertionEffect:Yv,useLayoutEffect:qv,useMemo:C_,useReducer:y_,useRef:ju,useState:function(){return y_($c)},useDebugValue:T_,useDeferredValue:function(a){var d=ji();return Mr===null?d.memoizedState=a:Ip(d,Mr.memoizedState,a)},useTransition:function(){var a=y_($c)[0],d=ji().memoizedState;return[a,d]},useMutableSource:Wv,useSyncExternalStore:Gv,useId:qs,unstable_isNewReconciler:!1};function _s(a,d){if(a&&a.defaultProps){d=Ye({},d),a=a.defaultProps;for(var _ in a)d[_]===void 0&&(d[_]=a[_]);return d}return d}function Ap(a,d,_,C){d=a.memoizedState,_=_(C,d),_=_==null?d:Ye({},d,_),a.memoizedState=_,a.lanes===0&&(a.updateQueue.baseState=_)}var Op={isMounted:function(a){return(a=a._reactInternals)?Fc(a)===a:!1},enqueueSetState:function(a,d,_){a=a._reactInternals;var C=Ii(),I=lc(a),L=sa(C,I);L.payload=d,_!=null&&(L.callback=_),d=zs(a,L,I),d!==null&&(ns(d,a,I,C),vp(d,a,I))},enqueueReplaceState:function(a,d,_){a=a._reactInternals;var C=Ii(),I=lc(a),L=sa(C,I);L.tag=1,L.payload=d,_!=null&&(L.callback=_),d=zs(a,L,I),d!==null&&(ns(d,a,I,C),vp(d,a,I))},enqueueForceUpdate:function(a,d){a=a._reactInternals;var _=Ii(),C=lc(a),I=sa(_,C);I.tag=2,d!=null&&(I.callback=d),d=zs(a,I,C),d!==null&&(ns(d,a,C,_),vp(d,a,C))}};function ca(a,d,_,C,I,L,q){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(C,L,q):d.prototype&&d.prototype.isPureReactComponent?!Bl(_,C)||!Bl(I,L):!0}function Qv(a,d,_){var C=!1,I=Qa,L=d.contextType;return typeof L=="object"&&L!==null?L=ms(L):(I=Vi(d)?$a:di.current,C=d.contextTypes,L=(C=C!=null)?Za(a,I):Qa),d=new d(_,L),a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Op,a.stateNode=d,d._reactInternals=a,C&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=I,a.__reactInternalMemoizedMaskedChildContext=L),d}function $v(a,d,_,C){a=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(_,C),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(_,C),d.state!==a&&Op.enqueueReplaceState(d,d.state,null)}function b_(a,d,_,C){var I=a.stateNode;I.props=_,I.state=a.memoizedState,I.refs={},h_(a);var L=d.contextType;typeof L=="object"&&L!==null?I.context=ms(L):(L=Vi(d)?$a:di.current,I.context=Za(a,L)),I.state=a.memoizedState,L=d.getDerivedStateFromProps,typeof L=="function"&&(Ap(a,d,L,_),I.state=a.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(d=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),d!==I.state&&Op.enqueueReplaceState(I,I.state,null),Sp(a,_,I,C),I.state=a.memoizedState),typeof I.componentDidMount=="function"&&(a.flags|=4194308)}function id(a,d){try{var _="",C=d;do _+=Ot(C),C=C.return;while(C);var I=_}catch(L){I=`
Error generating stack: `+L.message+`
`+L.stack}return{value:a,source:d,stack:I,digest:null}}function Np(a,d,_){return{value:a,source:null,stack:_??null,digest:d??null}}function I_(a,d){try{console.error(d.value)}catch(_){setTimeout(function(){throw _})}}var A_=typeof WeakMap=="function"?WeakMap:Map;function O_(a,d,_){_=sa(-1,_),_.tag=3,_.payload={element:null};var C=d.value;return _.callback=function(){pi||(pi=!0,q_=C),I_(a,d)},_}function Zv(a,d,_){_=sa(-1,_),_.tag=3;var C=a.type.getDerivedStateFromError;if(typeof C=="function"){var I=d.value;_.payload=function(){return C(I)},_.callback=function(){I_(a,d)}}var L=a.stateNode;return L!==null&&typeof L.componentDidCatch=="function"&&(_.callback=function(){I_(a,d),typeof C!="function"&&(ac===null?ac=new Set([this]):ac.add(this));var q=d.stack;this.componentDidCatch(d.value,{componentStack:q!==null?q:""})}),_}function N_(a,d,_){var C=a.pingCache;if(C===null){C=a.pingCache=new A_;var I=new Set;C.set(d,I)}else I=C.get(d),I===void 0&&(I=new Set,C.set(d,I));I.has(_)||(I.add(_),a=gS.bind(null,a,d,_),d.then(a,a))}function eS(a){do{var d;if((d=a.tag===13)&&(d=a.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return a;a=a.return}while(a!==null);return null}function tS(a,d,_,C,I){return(a.mode&1)===0?(a===d?a.flags|=65536:(a.flags|=128,_.flags|=131072,_.flags&=-52805,_.tag===1&&(_.alternate===null?_.tag=17:(d=sa(-1,1),d.tag=2,zs(_,d,1))),_.lanes|=1),a):(a.flags|=65536,a.lanes=I,a)}var kC=ne.ReactCurrentOwner,Fi=!1;function bi(a,d,_,C){d.child=a===null?o_(d,null,_,C):Zl(d,a.child,_,C)}function nS(a,d,_,C,I){_=_.render;var L=d.ref;return Ks(d,I),C=td(a,d,_,C,L,I),_=v_(),a!==null&&!Fi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~I,la(a,d,I)):($n&&_&&Jl(d),d.flags|=1,bi(a,d,C,I),d.child)}function rS(a,d,_,C,I){if(a===null){var L=_.type;return typeof L=="function"&&!ig(L)&&L.defaultProps===void 0&&_.compare===null&&_.defaultProps===void 0?(d.tag=15,d.type=L,P_(a,d,L,C,I)):(a=dd(_.type,null,C,d,d.mode,I),a.ref=d.ref,a.return=d,d.child=a)}if(L=a.child,(a.lanes&I)===0){var q=L.memoizedProps;if(_=_.compare,_=_!==null?_:Bl,_(q,C)&&a.ref===d.ref)return la(a,d,I)}return d.flags|=1,a=pc(L,C),a.ref=d.ref,a.return=d,d.child=a}function P_(a,d,_,C,I){if(a!==null){var L=a.memoizedProps;if(Bl(L,C)&&a.ref===d.ref)if(Fi=!1,d.pendingProps=C=L,(a.lanes&I)!==0)(a.flags&131072)!==0&&(Fi=!0);else return d.lanes=a.lanes,la(a,d,I)}return k_(a,d,_,C,I)}function wo(a,d,_){var C=d.pendingProps,I=C.children,L=a!==null?a.memoizedState:null;if(C.mode==="hidden")if((d.mode&1)===0)d.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yn(sd,ts),ts|=_;else{if((_&1073741824)===0)return a=L!==null?L.baseLanes|_:_,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:a,cachePool:null,transitions:null},d.updateQueue=null,Yn(sd,ts),ts|=a,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=L!==null?L.baseLanes:_,Yn(sd,ts),ts|=C}else L!==null?(C=L.baseLanes|_,d.memoizedState=null):C=_,Yn(sd,ts),ts|=C;return bi(a,d,I,_),d.child}function iS(a,d){var _=d.ref;(a===null&&_!==null||a!==null&&a.ref!==_)&&(d.flags|=512,d.flags|=2097152)}function k_(a,d,_,C,I){var L=Vi(_)?$a:di.current;return L=Za(d,L),Ks(d,I),_=td(a,d,_,C,L,I),C=v_(),a!==null&&!Fi?(d.updateQueue=a.updateQueue,d.flags&=-2053,a.lanes&=~I,la(a,d,I)):($n&&C&&Jl(d),d.flags|=1,bi(a,d,_,I),d.child)}function sS(a,d,_,C,I){if(Vi(_)){var L=!0;dp(d)}else L=!1;if(Ks(d,I),d.stateNode===null)Dp(a,d),Qv(d,_,C),b_(d,_,C,I),C=!0;else if(a===null){var q=d.stateNode,oe=d.memoizedProps;q.props=oe;var me=q.context,Le=_.contextType;typeof Le=="object"&&Le!==null?Le=ms(Le):(Le=Vi(_)?$a:di.current,Le=Za(d,Le));var Ze=_.getDerivedStateFromProps,et=typeof Ze=="function"||typeof q.getSnapshotBeforeUpdate=="function";et||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(oe!==C||me!==Le)&&$v(d,q,C,Le),ia=!1;var $e=d.memoizedState;q.state=$e,Sp(d,C,q,I),me=d.memoizedState,oe!==C||$e!==me||wi.current||ia?(typeof Ze=="function"&&(Ap(d,_,Ze,C),me=d.memoizedState),(oe=ia||ca(d,_,oe,C,$e,me,Le))?(et||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(d.flags|=4194308)):(typeof q.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=C,d.memoizedState=me),q.props=C,q.state=me,q.context=Le,C=oe):(typeof q.componentDidMount=="function"&&(d.flags|=4194308),C=!1)}else{q=d.stateNode,Vv(a,d),oe=d.memoizedProps,Le=d.type===d.elementType?oe:_s(d.type,oe),q.props=Le,et=d.pendingProps,$e=q.context,me=_.contextType,typeof me=="object"&&me!==null?me=ms(me):(me=Vi(_)?$a:di.current,me=Za(d,me));var _t=_.getDerivedStateFromProps;(Ze=typeof _t=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(oe!==et||$e!==me)&&$v(d,q,C,me),ia=!1,$e=d.memoizedState,q.state=$e,Sp(d,C,q,I);var Tt=d.memoizedState;oe!==et||$e!==Tt||wi.current||ia?(typeof _t=="function"&&(Ap(d,_,_t,C),Tt=d.memoizedState),(Le=ia||ca(d,_,Le,C,$e,Tt,me)||!1)?(Ze||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(C,Tt,me),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(C,Tt,me)),typeof q.componentDidUpdate=="function"&&(d.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof q.componentDidUpdate!="function"||oe===a.memoizedProps&&$e===a.memoizedState||(d.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||oe===a.memoizedProps&&$e===a.memoizedState||(d.flags|=1024),d.memoizedProps=C,d.memoizedState=Tt),q.props=C,q.state=Tt,q.context=me,C=Le):(typeof q.componentDidUpdate!="function"||oe===a.memoizedProps&&$e===a.memoizedState||(d.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||oe===a.memoizedProps&&$e===a.memoizedState||(d.flags|=1024),C=!1)}return D_(a,d,_,C,L,I)}function D_(a,d,_,C,I,L){iS(a,d);var q=(d.flags&128)!==0;if(!C&&!q)return I&&Dv(d,_,!1),la(a,d,L);C=d.stateNode,kC.current=d;var oe=q&&typeof _.getDerivedStateFromError!="function"?null:C.render();return d.flags|=1,a!==null&&q?(d.child=Zl(d,a.child,null,L),d.child=Zl(d,null,oe,L)):bi(a,d,oe,L),d.memoizedState=C.state,I&&Dv(d,_,!0),d.child}function oS(a){var d=a.stateNode;d.pendingContext?ql(a,d.pendingContext,d.pendingContext!==d.context):d.context&&ql(a,d.context,!1),p_(a,d.containerInfo)}function aS(a,d,_,C,I){return Yc(),$l(I),d.flags|=256,bi(a,d,_,C),d.child}var Bu={dehydrated:null,treeContext:null,retryLane:0};function L_(a){return{baseLanes:a,cachePool:null,transitions:null}}function cS(a,d,_){var C=d.pendingProps,I=ar.current,L=!1,q=(d.flags&128)!==0,oe;if((oe=q)||(oe=a!==null&&a.memoizedState===null?!1:(I&2)!==0),oe?(L=!0,d.flags&=-129):(a===null||a.memoizedState!==null)&&(I|=1),Yn(ar,I&1),a===null)return Ou(d),a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((d.mode&1)===0?d.lanes=1:a.data==="$!"?d.lanes=8:d.lanes=1073741824,null):(q=C.children,a=C.fallback,L?(C=d.mode,L=d.child,q={mode:"hidden",children:q},(C&1)===0&&L!==null?(L.childLanes=0,L.pendingProps=q):L=$u(q,C,0,null),a=fc(a,C,_,null),L.return=d,a.return=d,L.sibling=a,d.child=L,d.child.memoizedState=L_(_),d.memoizedState=Bu,a):x_(d,q));if(I=a.memoizedState,I!==null&&(oe=I.dehydrated,oe!==null))return DC(a,d,q,C,oe,I,_);if(L){L=C.fallback,q=d.mode,I=a.child,oe=I.sibling;var me={mode:"hidden",children:C.children};return(q&1)===0&&d.child!==I?(C=d.child,C.childLanes=0,C.pendingProps=me,d.deletions=null):(C=pc(I,me),C.subtreeFlags=I.subtreeFlags&14680064),oe!==null?L=pc(oe,L):(L=fc(L,q,_,null),L.flags|=2),L.return=d,C.return=d,C.sibling=L,d.child=C,C=L,L=d.child,q=a.child.memoizedState,q=q===null?L_(_):{baseLanes:q.baseLanes|_,cachePool:null,transitions:q.transitions},L.memoizedState=q,L.childLanes=a.childLanes&~_,d.memoizedState=Bu,C}return L=a.child,a=L.sibling,C=pc(L,{mode:"visible",children:C.children}),(d.mode&1)===0&&(C.lanes=_),C.return=d,C.sibling=null,a!==null&&(_=d.deletions,_===null?(d.deletions=[a],d.flags|=16):_.push(a)),d.child=C,d.memoizedState=null,C}function x_(a,d){return d=$u({mode:"visible",children:d},a.mode,0,null),d.return=a,a.child=d}function Pp(a,d,_,C){return C!==null&&$l(C),Zl(d,a.child,null,_),a=x_(d,d.pendingProps.children),a.flags|=2,d.memoizedState=null,a}function DC(a,d,_,C,I,L,q){if(_)return d.flags&256?(d.flags&=-257,C=Np(Error(f(422))),Pp(a,d,q,C)):d.memoizedState!==null?(d.child=a.child,d.flags|=128,null):(L=C.fallback,I=d.mode,C=$u({mode:"visible",children:C.children},I,0,null),L=fc(L,I,q,null),L.flags|=2,C.return=d,L.return=d,C.sibling=L,d.child=C,(d.mode&1)!==0&&Zl(d,a.child,null,q),d.child.memoizedState=L_(q),d.memoizedState=Bu,L);if((d.mode&1)===0)return Pp(a,d,q,null);if(I.data==="$!"){if(C=I.nextSibling&&I.nextSibling.dataset,C)var oe=C.dgst;return C=oe,L=Error(f(419)),C=Np(L,C,void 0),Pp(a,d,q,C)}if(oe=(q&a.childLanes)!==0,Fi||oe){if(C=Ur,C!==null){switch(q&-q){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=(I&(C.suspendedLanes|q))!==0?0:I,I!==0&&I!==L.retryLane&&(L.retryLane=I,ra(a,I),ns(C,a,I,-1))}return cd(),C=Np(Error(f(421))),Pp(a,d,q,C)}return I.data==="$?"?(d.flags|=128,d.child=a.child,d=BC.bind(null,a),I._reactRetry=d,null):(a=L.treeContext,Zi=yo(I.nextSibling),$i=d,$n=!0,Hs=null,a!==null&&(Ri[fs++]=ta,Ri[fs++]=na,Ri[fs++]=Kc,ta=a.id,na=a.overflow,Kc=d),d=x_(d,C.children),d.flags|=4096,d)}function lS(a,d,_){a.lanes|=d;var C=a.alternate;C!==null&&(C.lanes|=d),Ep(a.return,d,_)}function kp(a,d,_,C,I){var L=a.memoizedState;L===null?a.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:C,tail:_,tailMode:I}:(L.isBackwards=d,L.rendering=null,L.renderingStartTime=0,L.last=C,L.tail=_,L.tailMode=I)}function M_(a,d,_){var C=d.pendingProps,I=C.revealOrder,L=C.tail;if(bi(a,d,C.children,_),C=ar.current,(C&2)!==0)C=C&1|2,d.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=d.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&lS(a,_,d);else if(a.tag===19)lS(a,_,d);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===d)break e;for(;a.sibling===null;){if(a.return===null||a.return===d)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}C&=1}if(Yn(ar,C),(d.mode&1)===0)d.memoizedState=null;else switch(I){case"forwards":for(_=d.child,I=null;_!==null;)a=_.alternate,a!==null&&yp(a)===null&&(I=_),_=_.sibling;_=I,_===null?(I=d.child,d.child=null):(I=_.sibling,_.sibling=null),kp(d,!1,I,_,L);break;case"backwards":for(_=null,I=d.child,d.child=null;I!==null;){if(a=I.alternate,a!==null&&yp(a)===null){d.child=I;break}a=I.sibling,I.sibling=_,_=I,I=a}kp(d,!0,_,null,L);break;case"together":kp(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Dp(a,d){(d.mode&1)===0&&a!==null&&(a.alternate=null,d.alternate=null,d.flags|=2)}function la(a,d,_){if(a!==null&&(d.dependencies=a.dependencies),nl|=d.lanes,(_&d.childLanes)===0)return null;if(a!==null&&d.child!==a.child)throw Error(f(153));if(d.child!==null){for(a=d.child,_=pc(a,a.pendingProps),d.child=_,_.return=d;a.sibling!==null;)a=a.sibling,_=_.sibling=pc(a,a.pendingProps),_.return=d;_.sibling=null}return d.child}function Lp(a,d,_){switch(d.tag){case 3:oS(d),Yc();break;case 5:Bv(d);break;case 1:Vi(d.type)&&dp(d);break;case 4:p_(d,d.stateNode.containerInfo);break;case 10:var C=d.type._context,I=d.memoizedProps.value;Yn(_p,C._currentValue),C._currentValue=I;break;case 13:if(C=d.memoizedState,C!==null)return C.dehydrated!==null?(Yn(ar,ar.current&1),d.flags|=128,null):(_&d.child.childLanes)!==0?cS(a,d,_):(Yn(ar,ar.current&1),a=la(a,d,_),a!==null?a.sibling:null);Yn(ar,ar.current&1);break;case 19:if(C=(_&d.childLanes)!==0,(a.flags&128)!==0){if(C)return M_(a,d,_);d.flags|=128}if(I=d.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),Yn(ar,ar.current),C)break;return null;case 22:case 23:return d.lanes=0,wo(a,d,_)}return la(a,d,_)}var xp,Mp,Wu,U_;xp=function(a,d){for(var _=d.child;_!==null;){if(_.tag===5||_.tag===6)a.appendChild(_.stateNode);else if(_.tag!==4&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===d)break;for(;_.sibling===null;){if(_.return===null||_.return===d)return;_=_.return}_.sibling.return=_.return,_=_.sibling}},Mp=function(){},Wu=function(a,d,_,C){var I=a.memoizedProps;if(I!==C){a=d.stateNode,nc(Co.current);var L=null;switch(_){case"input":I=eu(a,I),C=eu(a,C),L=[];break;case"select":I=Ye({},I,{value:void 0}),C=Ye({},C,{value:void 0}),L=[];break;case"textarea":I=bl(a,I),C=bl(a,C),L=[];break;default:typeof I.onClick!="function"&&typeof C.onClick=="function"&&(a.onclick=Ru)}mo(_,C);var q;_=null;for(Le in I)if(!C.hasOwnProperty(Le)&&I.hasOwnProperty(Le)&&I[Le]!=null)if(Le==="style"){var oe=I[Le];for(q in oe)oe.hasOwnProperty(q)&&(_||(_={}),_[q]="")}else Le!=="dangerouslySetInnerHTML"&&Le!=="children"&&Le!=="suppressContentEditableWarning"&&Le!=="suppressHydrationWarning"&&Le!=="autoFocus"&&(S.hasOwnProperty(Le)?L||(L=[]):(L=L||[]).push(Le,null));for(Le in C){var me=C[Le];if(oe=I?.[Le],C.hasOwnProperty(Le)&&me!==oe&&(me!=null||oe!=null))if(Le==="style")if(oe){for(q in oe)!oe.hasOwnProperty(q)||me&&me.hasOwnProperty(q)||(_||(_={}),_[q]="");for(q in me)me.hasOwnProperty(q)&&oe[q]!==me[q]&&(_||(_={}),_[q]=me[q])}else _||(L||(L=[]),L.push(Le,_)),_=me;else Le==="dangerouslySetInnerHTML"?(me=me?me.__html:void 0,oe=oe?oe.__html:void 0,me!=null&&oe!==me&&(L=L||[]).push(Le,me)):Le==="children"?typeof me!="string"&&typeof me!="number"||(L=L||[]).push(Le,""+me):Le!=="suppressContentEditableWarning"&&Le!=="suppressHydrationWarning"&&(S.hasOwnProperty(Le)?(me!=null&&Le==="onScroll"&&zn("scroll",a),L||oe===me||(L=[])):(L=L||[]).push(Le,me))}_&&(L=L||[]).push("style",_);var Le=L;(d.updateQueue=Le)&&(d.flags|=4)}},U_=function(a,d,_,C){_!==C&&(d.flags|=4)};function Gu(a,d){if(!$n)switch(a.tailMode){case"hidden":d=a.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?a.tail=null:_.sibling=null;break;case"collapsed":_=a.tail;for(var C=null;_!==null;)_.alternate!==null&&(C=_),_=_.sibling;C===null?d||a.tail===null?a.tail=null:a.tail.sibling=null:C.sibling=null}}function ei(a){var d=a.alternate!==null&&a.alternate.child===a.child,_=0,C=0;if(d)for(var I=a.child;I!==null;)_|=I.lanes|I.childLanes,C|=I.subtreeFlags&14680064,C|=I.flags&14680064,I.return=a,I=I.sibling;else for(I=a.child;I!==null;)_|=I.lanes|I.childLanes,C|=I.subtreeFlags,C|=I.flags,I.return=a,I=I.sibling;return a.subtreeFlags|=C,a.childLanes=_,d}function Up(a,d,_){var C=d.pendingProps;switch(fp(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ei(d),null;case 1:return Vi(d.type)&&lp(),ei(d),null;case 3:return C=d.stateNode,Jc(),Wn(wi),Wn(di),__(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(a===null||a.child===null)&&(Ql(d)?d.flags|=4:a===null||a.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Hs!==null&&(J_(Hs),Hs=null))),Mp(a,d),ei(d),null;case 5:f_(d);var I=nc(Du.current);if(_=d.type,a!==null&&d.stateNode!=null)Wu(a,d,_,C,I),a.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!C){if(d.stateNode===null)throw Error(f(166));return ei(d),null}if(a=nc(Co.current),Ql(d)){C=d.stateNode,_=d.type;var L=d.memoizedProps;switch(C[To]=d,C[bu]=L,a=(d.mode&1)!==0,_){case"dialog":zn("cancel",C),zn("close",C);break;case"iframe":case"object":case"embed":zn("load",C);break;case"video":case"audio":for(I=0;I<yu.length;I++)zn(yu[I],C);break;case"source":zn("error",C);break;case"img":case"image":case"link":zn("error",C),zn("load",C);break;case"details":zn("toggle",C);break;case"input":Bh(C,L),zn("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!L.multiple},zn("invalid",C);break;case"textarea":Ms(C,L),zn("invalid",C)}mo(_,L),I=null;for(var q in L)if(L.hasOwnProperty(q)){var oe=L[q];q==="children"?typeof oe=="string"?C.textContent!==oe&&(L.suppressHydrationWarning!==!0&&wu(C.textContent,oe,a),I=["children",oe]):typeof oe=="number"&&C.textContent!==""+oe&&(L.suppressHydrationWarning!==!0&&wu(C.textContent,oe,a),I=["children",""+oe]):S.hasOwnProperty(q)&&oe!=null&&q==="onScroll"&&zn("scroll",C)}switch(_){case"input":hs(C),fr(C,L,!0);break;case"textarea":hs(C),nu(C);break;case"select":case"option":break;default:typeof L.onClick=="function"&&(C.onclick=Ru)}C=I,d.updateQueue=C,C!==null&&(d.flags|=4)}else{q=I.nodeType===9?I:I.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=li(_)),a==="http://www.w3.org/1999/xhtml"?_==="script"?(a=q.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof C.is=="string"?a=q.createElement(_,{is:C.is}):(a=q.createElement(_),_==="select"&&(q=a,C.multiple?q.multiple=!0:C.size&&(q.size=C.size))):a=q.createElementNS(a,_),a[To]=d,a[bu]=C,xp(a,d,!1,!1),d.stateNode=a;e:{switch(q=su(_,C),_){case"dialog":zn("cancel",a),zn("close",a),I=C;break;case"iframe":case"object":case"embed":zn("load",a),I=C;break;case"video":case"audio":for(I=0;I<yu.length;I++)zn(yu[I],a);I=C;break;case"source":zn("error",a),I=C;break;case"img":case"image":case"link":zn("error",a),zn("load",a),I=C;break;case"details":zn("toggle",a),I=C;break;case"input":Bh(a,C),I=eu(a,C),zn("invalid",a);break;case"option":I=C;break;case"select":a._wrapperState={wasMultiple:!!C.multiple},I=Ye({},C,{value:void 0}),zn("invalid",a);break;case"textarea":Ms(a,C),I=bl(a,C),zn("invalid",a);break;default:I=C}mo(_,I),oe=I;for(L in oe)if(oe.hasOwnProperty(L)){var me=oe[L];L==="style"?Ti(a,me):L==="dangerouslySetInnerHTML"?(me=me?me.__html:void 0,me!=null&&Il(a,me)):L==="children"?typeof me=="string"?(_!=="textarea"||me!=="")&&Us(a,me):typeof me=="number"&&Us(a,""+me):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(S.hasOwnProperty(L)?me!=null&&L==="onScroll"&&zn("scroll",a):me!=null&&le(a,L,me,q))}switch(_){case"input":hs(a),fr(a,C,!1);break;case"textarea":hs(a),nu(a);break;case"option":C.value!=null&&a.setAttribute("value",""+pn(C.value));break;case"select":a.multiple=!!C.multiple,L=C.value,L!=null?Di(a,!!C.multiple,L,!1):C.defaultValue!=null&&Di(a,!!C.multiple,C.defaultValue,!0);break;default:typeof I.onClick=="function"&&(a.onclick=Ru)}switch(_){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}}C&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return ei(d),null;case 6:if(a&&d.stateNode!=null)U_(a,d,a.memoizedProps,C);else{if(typeof C!="string"&&d.stateNode===null)throw Error(f(166));if(_=nc(Du.current),nc(Co.current),Ql(d)){if(C=d.stateNode,_=d.memoizedProps,C[To]=d,(L=C.nodeValue!==_)&&(a=$i,a!==null))switch(a.tag){case 3:wu(C.nodeValue,_,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&wu(C.nodeValue,_,(a.mode&1)!==0)}L&&(d.flags|=4)}else C=(_.nodeType===9?_:_.ownerDocument).createTextNode(C),C[To]=d,d.stateNode=C}return ei(d),null;case 13:if(Wn(ar),C=d.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if($n&&Zi!==null&&(d.mode&1)!==0&&(d.flags&128)===0)i_(),Yc(),d.flags|=98560,L=!1;else if(L=Ql(d),C!==null&&C.dehydrated!==null){if(a===null){if(!L)throw Error(f(318));if(L=d.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(f(317));L[To]=d}else Yc(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;ei(d),L=!1}else Hs!==null&&(J_(Hs),Hs=null),L=!0;if(!L)return d.flags&65536?d:null}return(d.flags&128)!==0?(d.lanes=_,d):(C=C!==null,C!==(a!==null&&a.memoizedState!==null)&&C&&(d.child.flags|=8192,(d.mode&1)!==0&&(a===null||(ar.current&1)!==0?Vr===0&&(Vr=3):cd())),d.updateQueue!==null&&(d.flags|=4),ei(d),null);case 4:return Jc(),Mp(a,d),a===null&&Qo(d.stateNode.containerInfo),ei(d),null;case 10:return l_(d.type._context),ei(d),null;case 17:return Vi(d.type)&&lp(),ei(d),null;case 19:if(Wn(ar),L=d.memoizedState,L===null)return ei(d),null;if(C=(d.flags&128)!==0,q=L.rendering,q===null)if(C)Gu(L,!1);else{if(Vr!==0||a!==null&&(a.flags&128)!==0)for(a=d.child;a!==null;){if(q=yp(a),q!==null){for(d.flags|=128,Gu(L,!1),C=q.updateQueue,C!==null&&(d.updateQueue=C,d.flags|=4),d.subtreeFlags=0,C=_,_=d.child;_!==null;)L=_,a=C,L.flags&=14680066,q=L.alternate,q===null?(L.childLanes=0,L.lanes=a,L.child=null,L.subtreeFlags=0,L.memoizedProps=null,L.memoizedState=null,L.updateQueue=null,L.dependencies=null,L.stateNode=null):(L.childLanes=q.childLanes,L.lanes=q.lanes,L.child=q.child,L.subtreeFlags=0,L.deletions=null,L.memoizedProps=q.memoizedProps,L.memoizedState=q.memoizedState,L.updateQueue=q.updateQueue,L.type=q.type,a=q.dependencies,L.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),_=_.sibling;return Yn(ar,ar.current&1|2),d.child}a=a.sibling}L.tail!==null&&Sr()>gs&&(d.flags|=128,C=!0,Gu(L,!1),d.lanes=4194304)}else{if(!C)if(a=yp(q),a!==null){if(d.flags|=128,C=!0,_=a.updateQueue,_!==null&&(d.updateQueue=_,d.flags|=4),Gu(L,!0),L.tail===null&&L.tailMode==="hidden"&&!q.alternate&&!$n)return ei(d),null}else 2*Sr()-L.renderingStartTime>gs&&_!==1073741824&&(d.flags|=128,C=!0,Gu(L,!1),d.lanes=4194304);L.isBackwards?(q.sibling=d.child,d.child=q):(_=L.last,_!==null?_.sibling=q:d.child=q,L.last=q)}return L.tail!==null?(d=L.tail,L.rendering=d,L.tail=d.sibling,L.renderingStartTime=Sr(),d.sibling=null,_=ar.current,Yn(ar,C?_&1|2:_&1),d):(ei(d),null);case 22:case 23:return Ju(),C=d.memoizedState!==null,a!==null&&a.memoizedState!==null!==C&&(d.flags|=8192),C&&(d.mode&1)!==0?(ts&1073741824)!==0&&(ei(d),d.subtreeFlags&6&&(d.flags|=8192)):ei(d),null;case 24:return null;case 25:return null}throw Error(f(156,d.tag))}function LC(a,d){switch(fp(d),d.tag){case 1:return Vi(d.type)&&lp(),a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 3:return Jc(),Wn(wi),Wn(di),__(),a=d.flags,(a&65536)!==0&&(a&128)===0?(d.flags=a&-65537|128,d):null;case 5:return f_(d),null;case 13:if(Wn(ar),a=d.memoizedState,a!==null&&a.dehydrated!==null){if(d.alternate===null)throw Error(f(340));Yc()}return a=d.flags,a&65536?(d.flags=a&-65537|128,d):null;case 19:return Wn(ar),null;case 4:return Jc(),null;case 10:return l_(d.type._context),null;case 22:case 23:return Ju(),null;case 24:return null;default:return null}}var Hu=!1,ti=!1,xC=typeof WeakSet=="function"?WeakSet:Set,Et=null;function tl(a,d){var _=a.ref;if(_!==null)if(typeof _=="function")try{_(null)}catch(C){cr(a,d,C)}else _.current=null}function V_(a,d,_){try{_()}catch(C){cr(a,d,C)}}var dS=!1;function MC(a,d){if(Qm=Jh,a=Gm(),Hm(a)){if("selectionStart"in a)var _={start:a.selectionStart,end:a.selectionEnd};else e:{_=(_=a.ownerDocument)&&_.defaultView||window;var C=_.getSelection&&_.getSelection();if(C&&C.rangeCount!==0){_=C.anchorNode;var I=C.anchorOffset,L=C.focusNode;C=C.focusOffset;try{_.nodeType,L.nodeType}catch{_=null;break e}var q=0,oe=-1,me=-1,Le=0,Ze=0,et=a,$e=null;t:for(;;){for(var _t;et!==_||I!==0&&et.nodeType!==3||(oe=q+I),et!==L||C!==0&&et.nodeType!==3||(me=q+C),et.nodeType===3&&(q+=et.nodeValue.length),(_t=et.firstChild)!==null;)$e=et,et=_t;for(;;){if(et===a)break t;if($e===_&&++Le===I&&(oe=q),$e===L&&++Ze===C&&(me=q),(_t=et.nextSibling)!==null)break;et=$e,$e=et.parentNode}et=_t}_=oe===-1||me===-1?null:{start:oe,end:me}}else _=null}_=_||{start:0,end:0}}else _=null;for(op={focusedElem:a,selectionRange:_},Jh=!1,Et=d;Et!==null;)if(d=Et,a=d.child,(d.subtreeFlags&1028)!==0&&a!==null)a.return=d,Et=a;else for(;Et!==null;){d=Et;try{var Tt=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if(Tt!==null){var wt=Tt.memoizedProps,lr=Tt.memoizedState,Ce=d.stateNode,ge=Ce.getSnapshotBeforeUpdate(d.elementType===d.type?wt:_s(d.type,wt),lr);Ce.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Oe=d.stateNode.containerInfo;Oe.nodeType===1?Oe.textContent="":Oe.nodeType===9&&Oe.documentElement&&Oe.removeChild(Oe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(f(163))}}catch(nt){cr(d,d.return,nt)}if(a=d.sibling,a!==null){a.return=d.return,Et=a;break}Et=d.return}return Tt=dS,dS=!1,Tt}function ic(a,d,_){var C=d.updateQueue;if(C=C!==null?C.lastEffect:null,C!==null){var I=C=C.next;do{if((I.tag&a)===a){var L=I.destroy;I.destroy=void 0,L!==void 0&&V_(d,_,L)}I=I.next}while(I!==C)}}function Vp(a,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var _=d=d.next;do{if((_.tag&a)===a){var C=_.create;_.destroy=C()}_=_.next}while(_!==d)}}function j_(a){var d=a.ref;if(d!==null){var _=a.stateNode;switch(a.tag){case 5:a=_;break;default:a=_}typeof d=="function"?d(a):d.current=a}}function uS(a){var d=a.alternate;d!==null&&(a.alternate=null,uS(d)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(d=a.stateNode,d!==null&&(delete d[To],delete d[bu],delete d[Zm],delete d[RC],delete d[bC])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function F_(a){return a.tag===5||a.tag===3||a.tag===4}function hS(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||F_(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function B_(a,d,_){var C=a.tag;if(C===5||C===6)a=a.stateNode,d?_.nodeType===8?_.parentNode.insertBefore(a,d):_.insertBefore(a,d):(_.nodeType===8?(d=_.parentNode,d.insertBefore(a,_)):(d=_,d.appendChild(a)),_=_._reactRootContainer,_!=null||d.onclick!==null||(d.onclick=Ru));else if(C!==4&&(a=a.child,a!==null))for(B_(a,d,_),a=a.sibling;a!==null;)B_(a,d,_),a=a.sibling}function Ku(a,d,_){var C=a.tag;if(C===5||C===6)a=a.stateNode,d?_.insertBefore(a,d):_.appendChild(a);else if(C!==4&&(a=a.child,a!==null))for(Ku(a,d,_),a=a.sibling;a!==null;)Ku(a,d,_),a=a.sibling}var ni=null,es=!1;function sc(a,d,_){for(_=_.child;_!==null;)W_(a,d,_),_=_.sibling}function W_(a,d,_){if(vo&&typeof vo.onCommitFiberUnmount=="function")try{vo.onCommitFiberUnmount(Nl,_)}catch{}switch(_.tag){case 5:ti||tl(_,d);case 6:var C=ni,I=es;ni=null,sc(a,d,_),ni=C,es=I,ni!==null&&(es?(a=ni,_=_.stateNode,a.nodeType===8?a.parentNode.removeChild(_):a.removeChild(_)):ni.removeChild(_.stateNode));break;case 18:ni!==null&&(es?(a=ni,_=_.stateNode,a.nodeType===8?ap(a.parentNode,_):a.nodeType===1&&ap(a,_),Ll(a)):ap(ni,_.stateNode));break;case 4:C=ni,I=es,ni=_.stateNode.containerInfo,es=!0,sc(a,d,_),ni=C,es=I;break;case 0:case 11:case 14:case 15:if(!ti&&(C=_.updateQueue,C!==null&&(C=C.lastEffect,C!==null))){I=C=C.next;do{var L=I,q=L.destroy;L=L.tag,q!==void 0&&((L&2)!==0||(L&4)!==0)&&V_(_,d,q),I=I.next}while(I!==C)}sc(a,d,_);break;case 1:if(!ti&&(tl(_,d),C=_.stateNode,typeof C.componentWillUnmount=="function"))try{C.props=_.memoizedProps,C.state=_.memoizedState,C.componentWillUnmount()}catch(oe){cr(_,d,oe)}sc(a,d,_);break;case 21:sc(a,d,_);break;case 22:_.mode&1?(ti=(C=ti)||_.memoizedState!==null,sc(a,d,_),ti=C):sc(a,d,_);break;default:sc(a,d,_)}}function pS(a){var d=a.updateQueue;if(d!==null){a.updateQueue=null;var _=a.stateNode;_===null&&(_=a.stateNode=new xC),d.forEach(function(C){var I=ld.bind(null,a,C);_.has(C)||(_.add(C),C.then(I,I))})}}function Xs(a,d){var _=d.deletions;if(_!==null)for(var C=0;C<_.length;C++){var I=_[C];try{var L=a,q=d,oe=q;e:for(;oe!==null;){switch(oe.tag){case 5:ni=oe.stateNode,es=!1;break e;case 3:ni=oe.stateNode.containerInfo,es=!0;break e;case 4:ni=oe.stateNode.containerInfo,es=!0;break e}oe=oe.return}if(ni===null)throw Error(f(160));W_(L,q,I),ni=null,es=!1;var me=I.alternate;me!==null&&(me.return=null),I.return=null}catch(Le){cr(I,d,Le)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)G_(d,a),d=d.sibling}function G_(a,d){var _=a.alternate,C=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(Xs(d,a),Ro(a),C&4){try{ic(3,a,a.return),Vp(3,a)}catch(wt){cr(a,a.return,wt)}try{ic(5,a,a.return)}catch(wt){cr(a,a.return,wt)}}break;case 1:Xs(d,a),Ro(a),C&512&&_!==null&&tl(_,_.return);break;case 5:if(Xs(d,a),Ro(a),C&512&&_!==null&&tl(_,_.return),a.flags&32){var I=a.stateNode;try{Us(I,"")}catch(wt){cr(a,a.return,wt)}}if(C&4&&(I=a.stateNode,I!=null)){var L=a.memoizedProps,q=_!==null?_.memoizedProps:L,oe=a.type,me=a.updateQueue;if(a.updateQueue=null,me!==null)try{oe==="input"&&L.type==="radio"&&L.name!=null&&ps(I,L),su(oe,q);var Le=su(oe,L);for(q=0;q<me.length;q+=2){var Ze=me[q],et=me[q+1];Ze==="style"?Ti(I,et):Ze==="dangerouslySetInnerHTML"?Il(I,et):Ze==="children"?Us(I,et):le(I,Ze,et,Le)}switch(oe){case"input":tu(I,L);break;case"textarea":Or(I,L);break;case"select":var $e=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!L.multiple;var _t=L.value;_t!=null?Di(I,!!L.multiple,_t,!1):$e!==!!L.multiple&&(L.defaultValue!=null?Di(I,!!L.multiple,L.defaultValue,!0):Di(I,!!L.multiple,L.multiple?[]:"",!1))}I[bu]=L}catch(wt){cr(a,a.return,wt)}}break;case 6:if(Xs(d,a),Ro(a),C&4){if(a.stateNode===null)throw Error(f(162));I=a.stateNode,L=a.memoizedProps;try{I.nodeValue=L}catch(wt){cr(a,a.return,wt)}}break;case 3:if(Xs(d,a),Ro(a),C&4&&_!==null&&_.memoizedState.isDehydrated)try{Ll(d.containerInfo)}catch(wt){cr(a,a.return,wt)}break;case 4:Xs(d,a),Ro(a);break;case 13:Xs(d,a),Ro(a),I=a.child,I.flags&8192&&(L=I.memoizedState!==null,I.stateNode.isHidden=L,!L||I.alternate!==null&&I.alternate.memoizedState!==null||(Y_=Sr())),C&4&&pS(a);break;case 22:if(Ze=_!==null&&_.memoizedState!==null,a.mode&1?(ti=(Le=ti)||Ze,Xs(d,a),ti=Le):Xs(d,a),Ro(a),C&8192){if(Le=a.memoizedState!==null,(a.stateNode.isHidden=Le)&&!Ze&&(a.mode&1)!==0)for(Et=a,Ze=a.child;Ze!==null;){for(et=Et=Ze;Et!==null;){switch($e=Et,_t=$e.child,$e.tag){case 0:case 11:case 14:case 15:ic(4,$e,$e.return);break;case 1:tl($e,$e.return);var Tt=$e.stateNode;if(typeof Tt.componentWillUnmount=="function"){C=$e,_=$e.return;try{d=C,Tt.props=d.memoizedProps,Tt.state=d.memoizedState,Tt.componentWillUnmount()}catch(wt){cr(C,_,wt)}}break;case 5:tl($e,$e.return);break;case 22:if($e.memoizedState!==null){jp(et);continue}}_t!==null?(_t.return=$e,Et=_t):jp(et)}Ze=Ze.sibling}e:for(Ze=null,et=a;;){if(et.tag===5){if(Ze===null){Ze=et;try{I=et.stateNode,Le?(L=I.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none"):(oe=et.stateNode,me=et.memoizedProps.style,q=me!=null&&me.hasOwnProperty("display")?me.display:null,oe.style.display=Vc("display",q))}catch(wt){cr(a,a.return,wt)}}}else if(et.tag===6){if(Ze===null)try{et.stateNode.nodeValue=Le?"":et.memoizedProps}catch(wt){cr(a,a.return,wt)}}else if((et.tag!==22&&et.tag!==23||et.memoizedState===null||et===a)&&et.child!==null){et.child.return=et,et=et.child;continue}if(et===a)break e;for(;et.sibling===null;){if(et.return===null||et.return===a)break e;Ze===et&&(Ze=null),et=et.return}Ze===et&&(Ze=null),et.sibling.return=et.return,et=et.sibling}}break;case 19:Xs(d,a),Ro(a),C&4&&pS(a);break;case 21:break;default:Xs(d,a),Ro(a)}}function Ro(a){var d=a.flags;if(d&2){try{e:{for(var _=a.return;_!==null;){if(F_(_)){var C=_;break e}_=_.return}throw Error(f(160))}switch(C.tag){case 5:var I=C.stateNode;C.flags&32&&(Us(I,""),C.flags&=-33);var L=hS(a);Ku(a,L,I);break;case 3:case 4:var q=C.stateNode.containerInfo,oe=hS(a);B_(a,oe,q);break;default:throw Error(f(161))}}catch(me){cr(a,a.return,me)}a.flags&=-3}d&4096&&(a.flags&=-4097)}function UC(a,d,_){Et=a,H_(a)}function H_(a,d,_){for(var C=(a.mode&1)!==0;Et!==null;){var I=Et,L=I.child;if(I.tag===22&&C){var q=I.memoizedState!==null||Hu;if(!q){var oe=I.alternate,me=oe!==null&&oe.memoizedState!==null||ti;oe=Hu;var Le=ti;if(Hu=q,(ti=me)&&!Le)for(Et=I;Et!==null;)q=Et,me=q.child,q.tag===22&&q.memoizedState!==null?fS(I):me!==null?(me.return=q,Et=me):fS(I);for(;L!==null;)Et=L,H_(L),L=L.sibling;Et=I,Hu=oe,ti=Le}K_(a)}else(I.subtreeFlags&8772)!==0&&L!==null?(L.return=I,Et=L):K_(a)}}function K_(a){for(;Et!==null;){var d=Et;if((d.flags&8772)!==0){var _=d.alternate;try{if((d.flags&8772)!==0)switch(d.tag){case 0:case 11:case 15:ti||Vp(5,d);break;case 1:var C=d.stateNode;if(d.flags&4&&!ti)if(_===null)C.componentDidMount();else{var I=d.elementType===d.type?_.memoizedProps:_s(d.type,_.memoizedProps);C.componentDidUpdate(I,_.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var L=d.updateQueue;L!==null&&Fv(d,L,C);break;case 3:var q=d.updateQueue;if(q!==null){if(_=null,d.child!==null)switch(d.child.tag){case 5:_=d.child.stateNode;break;case 1:_=d.child.stateNode}Fv(d,q,_)}break;case 5:var oe=d.stateNode;if(_===null&&d.flags&4){_=oe;var me=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":me.autoFocus&&_.focus();break;case"img":me.src&&(_.src=me.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var Le=d.alternate;if(Le!==null){var Ze=Le.memoizedState;if(Ze!==null){var et=Ze.dehydrated;et!==null&&Ll(et)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(f(163))}ti||d.flags&512&&j_(d)}catch($e){cr(d,d.return,$e)}}if(d===a){Et=null;break}if(_=d.sibling,_!==null){_.return=d.return,Et=_;break}Et=d.return}}function jp(a){for(;Et!==null;){var d=Et;if(d===a){Et=null;break}var _=d.sibling;if(_!==null){_.return=d.return,Et=_;break}Et=d.return}}function fS(a){for(;Et!==null;){var d=Et;try{switch(d.tag){case 0:case 11:case 15:var _=d.return;try{Vp(4,d)}catch(me){cr(d,_,me)}break;case 1:var C=d.stateNode;if(typeof C.componentDidMount=="function"){var I=d.return;try{C.componentDidMount()}catch(me){cr(d,I,me)}}var L=d.return;try{j_(d)}catch(me){cr(d,L,me)}break;case 5:var q=d.return;try{j_(d)}catch(me){cr(d,q,me)}}}catch(me){cr(d,d.return,me)}if(d===a){Et=null;break}var oe=d.sibling;if(oe!==null){oe.return=d.return,Et=oe;break}Et=d.return}}var VC=Math.ceil,oc=ne.ReactCurrentDispatcher,Fp=ne.ReactCurrentOwner,hi=ne.ReactCurrentBatchConfig,ln=0,Ur=null,_r=null,Nr=0,ts=0,sd=Gs(0),Vr=0,od=null,nl=0,Bp=0,z_=0,rl=null,Tr=null,Y_=0,gs=1/0,bo=null,pi=!1,q_=null,ac=null,zu=!1,cc=null,Yu=0,ad=0,X_=null,qu=-1,Wp=0;function Ii(){return(ln&6)!==0?Sr():qu!==-1?qu:qu=Sr()}function lc(a){return(a.mode&1)===0?1:(ln&2)!==0&&Nr!==0?Nr&-Nr:Nu.transition!==null?(Wp===0&&(Wp=ev()),Wp):(a=On,a!==0||(a=window.event,a=a===void 0?16:sv(a.type)),a)}function ns(a,d,_,C){if(50<ad)throw ad=0,X_=null,Error(f(185));cu(a,_,C),((ln&2)===0||a!==Ur)&&(a===Ur&&((ln&2)===0&&(Bp|=_),Vr===4&&dc(a,Nr)),fi(a,C),_===1&&ln===0&&(d.mode&1)===0&&(gs=Sr()+500,up&&ec()))}function fi(a,d){var _=a.callbackNode;ZE(a,d);var C=Kh(a,a===Ur?Nr:0);if(C===0)_!==null&&qE(_),a.callbackNode=null,a.callbackPriority=0;else if(d=C&-C,a.callbackPriority!==d){if(_!=null&&qE(_),d===1)a.tag===0?IC(Gp.bind(null,a)):n_(Gp.bind(null,a)),CC(function(){(ln&6)===0&&ec()}),_=null;else{switch(Rm(C)){case 1:_=mr;break;case 4:_=XE;break;case 16:_=Gh;break;case 536870912:_=JE;break;default:_=Gh}_=ng(_,mS.bind(null,a))}a.callbackPriority=d,a.callbackNode=_}}function mS(a,d){if(qu=-1,Wp=0,(ln&6)!==0)throw Error(f(327));var _=a.callbackNode;if(hc()&&a.callbackNode!==_)return null;var C=Kh(a,a===Ur?Nr:0);if(C===0)return null;if((C&30)!==0||(C&a.expiredLanes)!==0||d)d=Qu(a,C);else{d=C;var I=ln;ln|=2;var L=$_();(Ur!==a||Nr!==d)&&(bo=null,gs=Sr()+500,da(a,d));do try{FC();break}catch(oe){Q_(a,oe)}while(!0);c_(),oc.current=L,ln=I,_r!==null?d=0:(Ur=null,Nr=0,d=Vr)}if(d!==0){if(d===2&&(I=Tm(a),I!==0&&(C=I,d=Xu(a,I))),d===1)throw _=od,da(a,0),dc(a,C),fi(a,Sr()),_;if(d===6)dc(a,C);else{if(I=a.current.alternate,(C&30)===0&&!_S(I)&&(d=Qu(a,C),d===2&&(L=Tm(a),L!==0&&(C=L,d=Xu(a,L))),d===1))throw _=od,da(a,0),dc(a,C),fi(a,Sr()),_;switch(a.finishedWork=I,a.finishedLanes=C,d){case 0:case 1:throw Error(f(345));case 2:Es(a,Tr,bo);break;case 3:if(dc(a,C),(C&130023424)===C&&(d=Y_+500-Sr(),10<d)){if(Kh(a,0)!==0)break;if(I=a.suspendedLanes,(I&C)!==C){Ii(),a.pingedLanes|=a.suspendedLanes&I;break}a.timeoutHandle=$m(Es.bind(null,a,Tr,bo),d);break}Es(a,Tr,bo);break;case 4:if(dc(a,C),(C&4194240)===C)break;for(d=a.eventTimes,I=-1;0<C;){var q=31-Fs(C);L=1<<q,q=d[q],q>I&&(I=q),C&=~L}if(C=I,C=Sr()-C,C=(120>C?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*VC(C/1960))-C,10<C){a.timeoutHandle=$m(Es.bind(null,a,Tr,bo),C);break}Es(a,Tr,bo);break;case 5:Es(a,Tr,bo);break;default:throw Error(f(329))}}}return fi(a,Sr()),a.callbackNode===_?mS.bind(null,a):null}function Xu(a,d){var _=rl;return a.current.memoizedState.isDehydrated&&(da(a,d).flags|=256),a=Qu(a,d),a!==2&&(d=Tr,Tr=_,d!==null&&J_(d)),a}function J_(a){Tr===null?Tr=a:Tr.push.apply(Tr,a)}function _S(a){for(var d=a;;){if(d.flags&16384){var _=d.updateQueue;if(_!==null&&(_=_.stores,_!==null))for(var C=0;C<_.length;C++){var I=_[C],L=I.getSnapshot;I=I.value;try{if(!Bs(L(),I))return!1}catch{return!1}}}if(_=d.child,d.subtreeFlags&16384&&_!==null)_.return=d,d=_;else{if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function dc(a,d){for(d&=~z_,d&=~Bp,a.suspendedLanes|=d,a.pingedLanes&=~d,a=a.expirationTimes;0<d;){var _=31-Fs(d),C=1<<_;a[_]=-1,d&=~C}}function Gp(a){if((ln&6)!==0)throw Error(f(327));hc();var d=Kh(a,0);if((d&1)===0)return fi(a,Sr()),null;var _=Qu(a,d);if(a.tag!==0&&_===2){var C=Tm(a);C!==0&&(d=C,_=Xu(a,C))}if(_===1)throw _=od,da(a,0),dc(a,d),fi(a,Sr()),_;if(_===6)throw Error(f(345));return a.finishedWork=a.current.alternate,a.finishedLanes=d,Es(a,Tr,bo),fi(a,Sr()),null}function il(a,d){var _=ln;ln|=1;try{return a(d)}finally{ln=_,ln===0&&(gs=Sr()+500,up&&ec())}}function uc(a){cc!==null&&cc.tag===0&&(ln&6)===0&&hc();var d=ln;ln|=1;var _=hi.transition,C=On;try{if(hi.transition=null,On=1,a)return a()}finally{On=C,hi.transition=_,ln=d,(ln&6)===0&&ec()}}function Ju(){ts=sd.current,Wn(sd)}function da(a,d){a.finishedWork=null,a.finishedLanes=0;var _=a.timeoutHandle;if(_!==-1&&(a.timeoutHandle=-1,TC(_)),_r!==null)for(_=_r.return;_!==null;){var C=_;switch(fp(C),C.tag){case 1:C=C.type.childContextTypes,C!=null&&lp();break;case 3:Jc(),Wn(wi),Wn(di),__();break;case 5:f_(C);break;case 4:Jc();break;case 13:Wn(ar);break;case 19:Wn(ar);break;case 10:l_(C.type._context);break;case 22:case 23:Ju()}_=_.return}if(Ur=a,_r=a=pc(a.current,null),Nr=ts=d,Vr=0,od=null,z_=Bp=nl=0,Tr=rl=null,qc!==null){for(d=0;d<qc.length;d++)if(_=qc[d],C=_.interleaved,C!==null){_.interleaved=null;var I=C.next,L=_.pending;if(L!==null){var q=L.next;L.next=I,C.next=q}_.pending=C}qc=null}return a}function Q_(a,d){do{var _=_r;try{if(c_(),Lu.current=rd,xu){for(var C=rr.memoizedState;C!==null;){var I=C.queue;I!==null&&(I.pending=null),C=C.next}xu=!1}if(Qc=0,yr=Mr=rr=null,oa=!1,Mu=0,Fp.current=null,_===null||_.return===null){Vr=1,od=d,_r=null;break}e:{var L=a,q=_.return,oe=_,me=d;if(d=Nr,oe.flags|=32768,me!==null&&typeof me=="object"&&typeof me.then=="function"){var Le=me,Ze=oe,et=Ze.tag;if((Ze.mode&1)===0&&(et===0||et===11||et===15)){var $e=Ze.alternate;$e?(Ze.updateQueue=$e.updateQueue,Ze.memoizedState=$e.memoizedState,Ze.lanes=$e.lanes):(Ze.updateQueue=null,Ze.memoizedState=null)}var _t=eS(q);if(_t!==null){_t.flags&=-257,tS(_t,q,oe,L,d),_t.mode&1&&N_(L,Le,d),d=_t,me=Le;var Tt=d.updateQueue;if(Tt===null){var wt=new Set;wt.add(me),d.updateQueue=wt}else Tt.add(me);break e}else{if((d&1)===0){N_(L,Le,d),cd();break e}me=Error(f(426))}}else if($n&&oe.mode&1){var lr=eS(q);if(lr!==null){(lr.flags&65536)===0&&(lr.flags|=256),tS(lr,q,oe,L,d),$l(id(me,oe));break e}}L=me=id(me,oe),Vr!==4&&(Vr=2),rl===null?rl=[L]:rl.push(L),L=q;do{switch(L.tag){case 3:L.flags|=65536,d&=-d,L.lanes|=d;var Ce=O_(L,me,d);jv(L,Ce);break e;case 1:oe=me;var ge=L.type,Oe=L.stateNode;if((L.flags&128)===0&&(typeof ge.getDerivedStateFromError=="function"||Oe!==null&&typeof Oe.componentDidCatch=="function"&&(ac===null||!ac.has(Oe)))){L.flags|=65536,d&=-d,L.lanes|=d;var nt=Zv(L,oe,d);jv(L,nt);break e}}L=L.return}while(L!==null)}eg(_)}catch(Rt){d=Rt,_r===_&&_!==null&&(_r=_=_.return);continue}break}while(!0)}function $_(){var a=oc.current;return oc.current=rd,a===null?rd:a}function cd(){(Vr===0||Vr===3||Vr===2)&&(Vr=4),Ur===null||(nl&268435455)===0&&(Bp&268435455)===0||dc(Ur,Nr)}function Qu(a,d){var _=ln;ln|=2;var C=$_();(Ur!==a||Nr!==d)&&(bo=null,da(a,d));do try{jC();break}catch(I){Q_(a,I)}while(!0);if(c_(),ln=_,oc.current=C,_r!==null)throw Error(f(261));return Ur=null,Nr=0,Vr}function jC(){for(;_r!==null;)Z_(_r)}function FC(){for(;_r!==null&&!F0();)Z_(_r)}function Z_(a){var d=vS(a.alternate,a,ts);a.memoizedProps=a.pendingProps,d===null?eg(a):_r=d,Fp.current=null}function eg(a){var d=a;do{var _=d.alternate;if(a=d.return,(d.flags&32768)===0){if(_=Up(_,d,ts),_!==null){_r=_;return}}else{if(_=LC(_,d),_!==null){_.flags&=32767,_r=_;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{Vr=6,_r=null;return}}if(d=d.sibling,d!==null){_r=d;return}_r=d=a}while(d!==null);Vr===0&&(Vr=5)}function Es(a,d,_){var C=On,I=hi.transition;try{hi.transition=null,On=1,tg(a,d,_,C)}finally{hi.transition=I,On=C}return null}function tg(a,d,_,C){do hc();while(cc!==null);if((ln&6)!==0)throw Error(f(327));_=a.finishedWork;var I=a.finishedLanes;if(_===null)return null;if(a.finishedWork=null,a.finishedLanes=0,_===a.current)throw Error(f(177));a.callbackNode=null,a.callbackPriority=0;var L=_.lanes|_.childLanes;if(K0(a,L),a===Ur&&(_r=Ur=null,Nr=0),(_.subtreeFlags&2064)===0&&(_.flags&2064)===0||zu||(zu=!0,ng(Gh,function(){return hc(),null})),L=(_.flags&15990)!==0,(_.subtreeFlags&15990)!==0||L){L=hi.transition,hi.transition=null;var q=On;On=1;var oe=ln;ln|=4,Fp.current=null,MC(a,_),G_(_,a),gC(op),Jh=!!Qm,op=Qm=null,a.current=_,UC(_),Eo(),ln=oe,On=q,hi.transition=L}else a.current=_;if(zu&&(zu=!1,cc=a,Yu=I),L=a.pendingLanes,L===0&&(ac=null),QE(_.stateNode),fi(a,Sr()),d!==null)for(C=a.onRecoverableError,_=0;_<d.length;_++)I=d[_],C(I.value,{componentStack:I.stack,digest:I.digest});if(pi)throw pi=!1,a=q_,q_=null,a;return(Yu&1)!==0&&a.tag!==0&&hc(),L=a.pendingLanes,(L&1)!==0?a===X_?ad++:(ad=0,X_=a):ad=0,ec(),null}function hc(){if(cc!==null){var a=Rm(Yu),d=hi.transition,_=On;try{if(hi.transition=null,On=16>a?16:a,cc===null)var C=!1;else{if(a=cc,cc=null,Yu=0,(ln&6)!==0)throw Error(f(331));var I=ln;for(ln|=4,Et=a.current;Et!==null;){var L=Et,q=L.child;if((Et.flags&16)!==0){var oe=L.deletions;if(oe!==null){for(var me=0;me<oe.length;me++){var Le=oe[me];for(Et=Le;Et!==null;){var Ze=Et;switch(Ze.tag){case 0:case 11:case 15:ic(8,Ze,L)}var et=Ze.child;if(et!==null)et.return=Ze,Et=et;else for(;Et!==null;){Ze=Et;var $e=Ze.sibling,_t=Ze.return;if(uS(Ze),Ze===Le){Et=null;break}if($e!==null){$e.return=_t,Et=$e;break}Et=_t}}}var Tt=L.alternate;if(Tt!==null){var wt=Tt.child;if(wt!==null){Tt.child=null;do{var lr=wt.sibling;wt.sibling=null,wt=lr}while(wt!==null)}}Et=L}}if((L.subtreeFlags&2064)!==0&&q!==null)q.return=L,Et=q;else e:for(;Et!==null;){if(L=Et,(L.flags&2048)!==0)switch(L.tag){case 0:case 11:case 15:ic(9,L,L.return)}var Ce=L.sibling;if(Ce!==null){Ce.return=L.return,Et=Ce;break e}Et=L.return}}var ge=a.current;for(Et=ge;Et!==null;){q=Et;var Oe=q.child;if((q.subtreeFlags&2064)!==0&&Oe!==null)Oe.return=q,Et=Oe;else e:for(q=ge;Et!==null;){if(oe=Et,(oe.flags&2048)!==0)try{switch(oe.tag){case 0:case 11:case 15:Vp(9,oe)}}catch(Rt){cr(oe,oe.return,Rt)}if(oe===q){Et=null;break e}var nt=oe.sibling;if(nt!==null){nt.return=oe.return,Et=nt;break e}Et=oe.return}}if(ln=I,ec(),vo&&typeof vo.onPostCommitFiberRoot=="function")try{vo.onPostCommitFiberRoot(Nl,a)}catch{}C=!0}return C}finally{On=_,hi.transition=d}}return!1}function Hp(a,d,_){d=id(_,d),d=O_(a,d,1),a=zs(a,d,1),d=Ii(),a!==null&&(cu(a,1,d),fi(a,d))}function cr(a,d,_){if(a.tag===3)Hp(a,a,_);else for(;d!==null;){if(d.tag===3){Hp(d,a,_);break}else if(d.tag===1){var C=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(ac===null||!ac.has(C))){a=id(_,a),a=Zv(d,a,1),d=zs(d,a,1),a=Ii(),d!==null&&(cu(d,1,a),fi(d,a));break}}d=d.return}}function gS(a,d,_){var C=a.pingCache;C!==null&&C.delete(d),d=Ii(),a.pingedLanes|=a.suspendedLanes&_,Ur===a&&(Nr&_)===_&&(Vr===4||Vr===3&&(Nr&130023424)===Nr&&500>Sr()-Y_?da(a,0):z_|=_),fi(a,d)}function ES(a,d){d===0&&((a.mode&1)===0?d=1:(d=Hh,Hh<<=1,(Hh&130023424)===0&&(Hh=4194304)));var _=Ii();a=ra(a,d),a!==null&&(cu(a,d,_),fi(a,_))}function BC(a){var d=a.memoizedState,_=0;d!==null&&(_=d.retryLane),ES(a,_)}function ld(a,d){var _=0;switch(a.tag){case 13:var C=a.stateNode,I=a.memoizedState;I!==null&&(_=I.retryLane);break;case 19:C=a.stateNode;break;default:throw Error(f(314))}C!==null&&C.delete(d),ES(a,_)}var vS;vS=function(a,d,_){if(a!==null)if(a.memoizedProps!==d.pendingProps||wi.current)Fi=!0;else{if((a.lanes&_)===0&&(d.flags&128)===0)return Fi=!1,Lp(a,d,_);Fi=(a.flags&131072)!==0}else Fi=!1,$n&&(d.flags&1048576)!==0&&Lv(d,pp,d.index);switch(d.lanes=0,d.tag){case 2:var C=d.type;Dp(a,d),a=d.pendingProps;var I=Za(d,di.current);Ks(d,_),I=td(null,d,C,a,I,_);var L=v_();return d.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,Vi(C)?(L=!0,dp(d)):L=!1,d.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,h_(d),I.updater=Op,d.stateNode=I,I._reactInternals=d,b_(d,C,a,_),d=D_(null,d,C,!0,L,_)):(d.tag=0,$n&&L&&Jl(d),bi(null,d,I,_),d=d.child),d;case 16:C=d.elementType;e:{switch(Dp(a,d),a=d.pendingProps,I=C._init,C=I(C._payload),d.type=C,I=d.tag=WC(C),a=_s(C,a),I){case 0:d=k_(null,d,C,a,_);break e;case 1:d=sS(null,d,C,a,_);break e;case 11:d=nS(null,d,C,a,_);break e;case 14:d=rS(null,d,C,_s(C.type,a),_);break e}throw Error(f(306,C,""))}return d;case 0:return C=d.type,I=d.pendingProps,I=d.elementType===C?I:_s(C,I),k_(a,d,C,I,_);case 1:return C=d.type,I=d.pendingProps,I=d.elementType===C?I:_s(C,I),sS(a,d,C,I,_);case 3:e:{if(oS(d),a===null)throw Error(f(387));C=d.pendingProps,L=d.memoizedState,I=L.element,Vv(a,d),Sp(d,C,null,_);var q=d.memoizedState;if(C=q.element,L.isDehydrated)if(L={element:C,isDehydrated:!1,cache:q.cache,pendingSuspenseBoundaries:q.pendingSuspenseBoundaries,transitions:q.transitions},d.updateQueue.baseState=L,d.memoizedState=L,d.flags&256){I=id(Error(f(423)),d),d=aS(a,d,C,_,I);break e}else if(C!==I){I=id(Error(f(424)),d),d=aS(a,d,C,_,I);break e}else for(Zi=yo(d.stateNode.containerInfo.firstChild),$i=d,$n=!0,Hs=null,_=o_(d,null,C,_),d.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(Yc(),C===I){d=la(a,d,_);break e}bi(a,d,C,_)}d=d.child}return d;case 5:return Bv(d),a===null&&Ou(d),C=d.type,I=d.pendingProps,L=a!==null?a.memoizedProps:null,q=I.children,zl(C,I)?q=null:L!==null&&zl(C,L)&&(d.flags|=32),iS(a,d),bi(a,d,q,_),d.child;case 6:return a===null&&Ou(d),null;case 13:return cS(a,d,_);case 4:return p_(d,d.stateNode.containerInfo),C=d.pendingProps,a===null?d.child=Zl(d,null,C,_):bi(a,d,C,_),d.child;case 11:return C=d.type,I=d.pendingProps,I=d.elementType===C?I:_s(C,I),nS(a,d,C,I,_);case 7:return bi(a,d,d.pendingProps,_),d.child;case 8:return bi(a,d,d.pendingProps.children,_),d.child;case 12:return bi(a,d,d.pendingProps.children,_),d.child;case 10:e:{if(C=d.type._context,I=d.pendingProps,L=d.memoizedProps,q=I.value,Yn(_p,C._currentValue),C._currentValue=q,L!==null)if(Bs(L.value,q)){if(L.children===I.children&&!wi.current){d=la(a,d,_);break e}}else for(L=d.child,L!==null&&(L.return=d);L!==null;){var oe=L.dependencies;if(oe!==null){q=L.child;for(var me=oe.firstContext;me!==null;){if(me.context===C){if(L.tag===1){me=sa(-1,_&-_),me.tag=2;var Le=L.updateQueue;if(Le!==null){Le=Le.shared;var Ze=Le.pending;Ze===null?me.next=me:(me.next=Ze.next,Ze.next=me),Le.pending=me}}L.lanes|=_,me=L.alternate,me!==null&&(me.lanes|=_),Ep(L.return,_,d),oe.lanes|=_;break}me=me.next}}else if(L.tag===10)q=L.type===d.type?null:L.child;else if(L.tag===18){if(q=L.return,q===null)throw Error(f(341));q.lanes|=_,oe=q.alternate,oe!==null&&(oe.lanes|=_),Ep(q,_,d),q=L.sibling}else q=L.child;if(q!==null)q.return=L;else for(q=L;q!==null;){if(q===d){q=null;break}if(L=q.sibling,L!==null){L.return=q.return,q=L;break}q=q.return}L=q}bi(a,d,I.children,_),d=d.child}return d;case 9:return I=d.type,C=d.pendingProps.children,Ks(d,_),I=ms(I),C=C(I),d.flags|=1,bi(a,d,C,_),d.child;case 14:return C=d.type,I=_s(C,d.pendingProps),I=_s(C.type,I),rS(a,d,C,I,_);case 15:return P_(a,d,d.type,d.pendingProps,_);case 17:return C=d.type,I=d.pendingProps,I=d.elementType===C?I:_s(C,I),Dp(a,d),d.tag=1,Vi(C)?(a=!0,dp(d)):a=!1,Ks(d,_),Qv(d,C,I),b_(d,C,I,_),D_(null,d,C,!0,a,_);case 19:return M_(a,d,_);case 22:return wo(a,d,_)}throw Error(f(156,d.tag))};function ng(a,d){return Bc(a,d)}function rg(a,d,_,C){this.tag=a,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(a,d,_,C){return new rg(a,d,_,C)}function ig(a){return a=a.prototype,!(!a||!a.isReactComponent)}function WC(a){if(typeof a=="function")return ig(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Ve)return 11;if(a===dt)return 14}return 2}function pc(a,d){var _=a.alternate;return _===null?(_=vs(a.tag,d,a.key,a.mode),_.elementType=a.elementType,_.type=a.type,_.stateNode=a.stateNode,_.alternate=a,a.alternate=_):(_.pendingProps=d,_.type=a.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=a.flags&14680064,_.childLanes=a.childLanes,_.lanes=a.lanes,_.child=a.child,_.memoizedProps=a.memoizedProps,_.memoizedState=a.memoizedState,_.updateQueue=a.updateQueue,d=a.dependencies,_.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},_.sibling=a.sibling,_.index=a.index,_.ref=a.ref,_}function dd(a,d,_,C,I,L){var q=2;if(C=a,typeof a=="function")ig(a)&&(q=1);else if(typeof a=="string")q=5;else e:switch(a){case he:return fc(_.children,I,L,d);case de:q=8,I|=8;break;case ye:return a=vs(12,_,d,I|2),a.elementType=ye,a.lanes=L,a;case xe:return a=vs(13,_,d,I),a.elementType=xe,a.lanes=L,a;case He:return a=vs(19,_,d,I),a.elementType=He,a.lanes=L,a;case Ge:return $u(_,I,L,d);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Me:q=10;break e;case Je:q=9;break e;case Ve:q=11;break e;case dt:q=14;break e;case Qe:q=16,C=null;break e}throw Error(f(130,a==null?a:typeof a,""))}return d=vs(q,_,d,I),d.elementType=a,d.type=C,d.lanes=L,d}function fc(a,d,_,C){return a=vs(7,a,C,d),a.lanes=_,a}function $u(a,d,_,C){return a=vs(22,a,C,d),a.elementType=Ge,a.lanes=_,a.stateNode={isHidden:!1},a}function Kp(a,d,_){return a=vs(6,a,null,d),a.lanes=_,a}function ud(a,d,_){return d=vs(4,a.children!==null?a.children:[],a.key,d),d.lanes=_,d.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},d}function sg(a,d,_,C,I){this.tag=d,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cm(0),this.expirationTimes=Cm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cm(0),this.identifierPrefix=C,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function hd(a,d,_,C,I,L,q,oe,me){return a=new sg(a,d,_,oe,me),d===1?(d=1,L===!0&&(d|=8)):d=0,L=vs(3,null,null,d),a.current=L,L.stateNode=a,L.memoizedState={element:C,isDehydrated:_,cache:null,transitions:null,pendingSuspenseBoundaries:null},h_(L),a}function zp(a,d,_){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pe,key:C==null?null:""+C,children:a,containerInfo:d,implementation:_}}function og(a){if(!a)return Qa;a=a._reactInternals;e:{if(Fc(a)!==a||a.tag!==1)throw Error(f(170));var d=a;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(Vi(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(f(171))}if(a.tag===1){var _=a.type;if(Vi(_))return kv(a,_,d)}return d}function sl(a,d,_,C,I,L,q,oe,me){return a=hd(_,C,!0,a,I,L,q,oe,me),a.context=og(null),_=a.current,C=Ii(),I=lc(_),L=sa(C,I),L.callback=d??null,zs(_,L,I),a.current.lanes=I,cu(a,I,C),fi(a,C),a}function Io(a,d,_,C){var I=d.current,L=Ii(),q=lc(I);return _=og(_),d.context===null?d.context=_:d.pendingContext=_,d=sa(L,q),d.payload={element:a},C=C===void 0?null:C,C!==null&&(d.callback=C),a=zs(I,d,q),a!==null&&(ns(a,I,q,L),vp(a,I,q)),q}function Yp(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function pd(a,d){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var _=a.retryLane;a.retryLane=_!==0&&_<d?_:d}}function ag(a,d){pd(a,d),(a=a.alternate)&&pd(a,d)}function GC(){return null}var SS=typeof reportError=="function"?reportError:function(a){console.error(a)};function cg(a){this._internalRoot=a}Zu.prototype.render=cg.prototype.render=function(a){var d=this._internalRoot;if(d===null)throw Error(f(409));Io(a,d,null,null)},Zu.prototype.unmount=cg.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var d=a.containerInfo;uc(function(){Io(null,a,null,null)}),d[$o]=null}};function Zu(a){this._internalRoot=a}Zu.prototype.unstable_scheduleHydration=function(a){if(a){var d=tv();a={blockedOn:null,target:a,priority:d};for(var _=0;_<Ha.length&&d!==0&&d<Ha[_].priority;_++);Ha.splice(_,0,a),_===0&&Dl(a)}};function eh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function th(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function yS(){}function TS(a,d,_,C,I){if(I){if(typeof C=="function"){var L=C;C=function(){var Le=Yp(q);L.call(Le)}}var q=sl(d,C,a,0,null,!1,!1,"",yS);return a._reactRootContainer=q,a[$o]=q.current,Qo(a.nodeType===8?a.parentNode:a),uc(),q}for(;I=a.lastChild;)a.removeChild(I);if(typeof C=="function"){var oe=C;C=function(){var Le=Yp(me);oe.call(Le)}}var me=hd(a,0,!1,null,null,!1,!1,"",yS);return a._reactRootContainer=me,a[$o]=me.current,Qo(a.nodeType===8?a.parentNode:a),uc(function(){Io(d,me,_,C)}),me}function qp(a,d,_,C,I){var L=_._reactRootContainer;if(L){var q=L;if(typeof I=="function"){var oe=I;I=function(){var me=Yp(q);oe.call(me)}}Io(d,q,a,I)}else q=TS(_,d,a,I,C);return Yp(q)}zh=function(a){switch(a.tag){case 3:var d=a.stateNode;if(d.current.memoizedState.isDehydrated){var _=An(d.pendingLanes);_!==0&&(wm(d,_|1),fi(d,Sr()),(ln&6)===0&&(gs=Sr()+500,ec()))}break;case 13:uc(function(){var C=ra(a,1);if(C!==null){var I=Ii();ns(C,a,1,I)}}),ag(a,1)}},bm=function(a){if(a.tag===13){var d=ra(a,134217728);if(d!==null){var _=Ii();ns(d,a,134217728,_)}ag(a,134217728)}},Yh=function(a){if(a.tag===13){var d=lc(a),_=ra(a,d);if(_!==null){var C=Ii();ns(_,a,d,C)}ag(a,d)}},tv=function(){return On},Im=function(a,d){var _=On;try{return On=a,d()}finally{On=_}},Al=function(a,d,_){switch(d){case"input":if(tu(a,_),d=_.name,_.type==="radio"&&d!=null){for(_=a;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<_.length;d++){var C=_[d];if(C!==a&&C.form===a.form){var I=cp(C);if(!I)throw Error(f(90));Ua(C),tu(C,I)}}}break;case"textarea":Or(a,_);break;case"select":d=_.value,d!=null&&Di(a,!!_.multiple,d,!1)}},fn=il,Fn=uc;var nh={usingClientEntryPoint:!1,Events:[Iu,Yl,cp,Fa,Kt,il]},Bi={findFiberByHostInstance:Hc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CS={bundleType:Bi.bundleType,version:Bi.version,rendererPackageName:Bi.rendererPackageName,rendererConfig:Bi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ne.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Wh(a),a===null?null:a.stateNode},findFiberByHostInstance:Bi.findFiberByHostInstance||GC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xp.isDisabled&&Xp.supportsFiber)try{Nl=Xp.inject(CS),vo=Xp}catch{}}return Ds.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nh,Ds.createPortal=function(a,d){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eh(d))throw Error(f(200));return zp(a,d,null,_)},Ds.createRoot=function(a,d){if(!eh(a))throw Error(f(299));var _=!1,C="",I=SS;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(C=d.identifierPrefix),d.onRecoverableError!==void 0&&(I=d.onRecoverableError)),d=hd(a,1,!1,null,null,_,!1,C,I),a[$o]=d.current,Qo(a.nodeType===8?a.parentNode:a),new cg(d)},Ds.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var d=a._reactInternals;if(d===void 0)throw typeof a.render=="function"?Error(f(188)):(a=Object.keys(a).join(","),Error(f(268,a)));return a=Wh(d),a=a===null?null:a.stateNode,a},Ds.flushSync=function(a){return uc(a)},Ds.hydrate=function(a,d,_){if(!th(d))throw Error(f(200));return qp(null,a,d,!0,_)},Ds.hydrateRoot=function(a,d,_){if(!eh(a))throw Error(f(405));var C=_!=null&&_.hydratedSources||null,I=!1,L="",q=SS;if(_!=null&&(_.unstable_strictMode===!0&&(I=!0),_.identifierPrefix!==void 0&&(L=_.identifierPrefix),_.onRecoverableError!==void 0&&(q=_.onRecoverableError)),d=sl(d,null,a,1,_??null,I,!1,L,q),a[$o]=d.current,Qo(a),C)for(a=0;a<C.length;a++)_=C[a],I=_._getVersion,I=I(_._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[_,I]:d.mutableSourceEagerHydrationData.push(_,I);return new Zu(d)},Ds.render=function(a,d,_){if(!th(d))throw Error(f(200));return qp(null,a,d,!1,_)},Ds.unmountComponentAtNode=function(a){if(!th(a))throw Error(f(40));return a._reactRootContainer?(uc(function(){qp(null,null,a,!1,function(){a._reactRootContainer=null,a[$o]=null})}),!0):!1},Ds.unstable_batchedUpdates=il,Ds.unstable_renderSubtreeIntoContainer=function(a,d,_,C){if(!th(_))throw Error(f(200));if(a==null||a._reactInternals===void 0)throw Error(f(38));return qp(a,d,_,!1,C)},Ds.version="18.3.1-next-f1338f8080-20240426",Ds}var d4;function fj(){if(d4)return YI.exports;d4=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(h){console.error(h)}}return u(),YI.exports=TX(),YI.exports}var y0=fj();const mj=S0(y0);function ai(u,h,{checkForDefaultPrevented:f=!0}={}){return function(S){if(u?.(S),f===!1||!S.defaultPrevented)return h?.(S)}}function u4(u,h){if(typeof u=="function")return u(h);u!=null&&(u.current=h)}function _j(...u){return h=>{let f=!1;const g=u.map(S=>{const T=u4(S,h);return!f&&typeof T=="function"&&(f=!0),T});if(f)return()=>{for(let S=0;S<g.length;S++){const T=g[S];typeof T=="function"?T():u4(u[S],null)}}}}function La(...u){return ee.useCallback(_j(...u),u)}function T0(u,h=[]){let f=[];function g(T,R){const N=ee.createContext(R),k=f.length;f=[...f,R];const x=B=>{const{scope:Y,children:H,...re}=B,X=Y?.[u]?.[k]||N,te=ee.useMemo(()=>re,Object.values(re));return O.jsx(X.Provider,{value:te,children:H})};x.displayName=T+"Provider";function U(B,Y){const H=Y?.[u]?.[k]||N,re=ee.useContext(H);if(re)return re;if(R!==void 0)return R;throw new Error(`\`${B}\` must be used within \`${T}\``)}return[x,U]}const S=()=>{const T=f.map(R=>ee.createContext(R));return function(N){const k=N?.[u]||T;return ee.useMemo(()=>({[`__scope${u}`]:{...N,[u]:k}}),[N,k])}};return S.scopeName=u,[g,CX(S,...h)]}function CX(...u){const h=u[0];if(u.length===1)return h;const f=()=>{const g=u.map(S=>({useScope:S(),scopeName:S.scopeName}));return function(T){const R=g.reduce((N,{useScope:k,scopeName:x})=>{const B=k(T)[`__scope${x}`];return{...N,...B}},{});return ee.useMemo(()=>({[`__scope${h.scopeName}`]:R}),[R])}};return f.scopeName=h.scopeName,f}function aA(u){const h=wX(u),f=ee.forwardRef((g,S)=>{const{children:T,...R}=g,N=ee.Children.toArray(T),k=N.find(bX);if(k){const x=k.props.children,U=N.map(B=>B===k?ee.Children.count(x)>1?ee.Children.only(null):ee.isValidElement(x)?x.props.children:null:B);return O.jsx(h,{...R,ref:S,children:ee.isValidElement(x)?ee.cloneElement(x,void 0,U):null})}return O.jsx(h,{...R,ref:S,children:T})});return f.displayName=`${u}.Slot`,f}function wX(u){const h=ee.forwardRef((f,g)=>{const{children:S,...T}=f;if(ee.isValidElement(S)){const R=AX(S),N=IX(T,S.props);return S.type!==ee.Fragment&&(N.ref=g?_j(g,R):R),ee.cloneElement(S,N)}return ee.Children.count(S)>1?ee.Children.only(null):null});return h.displayName=`${u}.SlotClone`,h}var gj=Symbol("radix.slottable");function RX(u){const h=({children:f})=>O.jsx(O.Fragment,{children:f});return h.displayName=`${u}.Slottable`,h.__radixId=gj,h}function bX(u){return ee.isValidElement(u)&&typeof u.type=="function"&&"__radixId"in u.type&&u.type.__radixId===gj}function IX(u,h){const f={...h};for(const g in h){const S=u[g],T=h[g];/^on[A-Z]/.test(g)?S&&T?f[g]=(...N)=>{const k=T(...N);return S(...N),k}:S&&(f[g]=S):g==="style"?f[g]={...S,...T}:g==="className"&&(f[g]=[S,T].filter(Boolean).join(" "))}return{...u,...f}}function AX(u){let h=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning;return f?u.ref:(h=Object.getOwnPropertyDescriptor(u,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning,f?u.props.ref:u.props.ref||u.ref)}function OX(u){const h=u+"CollectionProvider",[f,g]=T0(h),[S,T]=f(h,{collectionRef:{current:null},itemMap:new Map}),R=X=>{const{scope:te,children:ce}=X,$=st.useRef(null),le=st.useRef(new Map).current;return O.jsx(S,{scope:te,itemMap:le,collectionRef:$,children:ce})};R.displayName=h;const N=u+"CollectionSlot",k=aA(N),x=st.forwardRef((X,te)=>{const{scope:ce,children:$}=X,le=T(N,ce),ne=La(te,le.collectionRef);return O.jsx(k,{ref:ne,children:$})});x.displayName=N;const U=u+"CollectionItemSlot",B="data-radix-collection-item",Y=aA(U),H=st.forwardRef((X,te)=>{const{scope:ce,children:$,...le}=X,ne=st.useRef(null),ue=La(te,ne),Pe=T(U,ce);return st.useEffect(()=>(Pe.itemMap.set(ne,{ref:ne,...le}),()=>void Pe.itemMap.delete(ne))),O.jsx(Y,{[B]:"",ref:ue,children:$})});H.displayName=U;function re(X){const te=T(u+"CollectionConsumer",X);return st.useCallback(()=>{const $=te.collectionRef.current;if(!$)return[];const le=Array.from($.querySelectorAll(`[${B}]`));return Array.from(te.itemMap.values()).sort((Pe,he)=>le.indexOf(Pe.ref.current)-le.indexOf(he.ref.current))},[te.collectionRef,te.itemMap])}return[{Provider:R,Slot:x,ItemSlot:H},re,g]}var NX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xs=NX.reduce((u,h)=>{const f=aA(`Primitive.${h}`),g=ee.forwardRef((S,T)=>{const{asChild:R,...N}=S,k=R?f:h;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),O.jsx(k,{...N,ref:T})});return g.displayName=`Primitive.${h}`,{...u,[h]:g}},{});function Ej(u,h){u&&y0.flushSync(()=>u.dispatchEvent(h))}function qd(u){const h=ee.useRef(u);return ee.useEffect(()=>{h.current=u}),ee.useMemo(()=>(...f)=>h.current?.(...f),[])}function PX(u,h=globalThis?.document){const f=qd(u);ee.useEffect(()=>{const g=S=>{S.key==="Escape"&&f(S)};return h.addEventListener("keydown",g,{capture:!0}),()=>h.removeEventListener("keydown",g,{capture:!0})},[f,h])}var kX="DismissableLayer",cA="dismissableLayer.update",DX="dismissableLayer.pointerDownOutside",LX="dismissableLayer.focusOutside",h4,vj=ee.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),bA=ee.forwardRef((u,h)=>{const{disableOutsidePointerEvents:f=!1,onEscapeKeyDown:g,onPointerDownOutside:S,onFocusOutside:T,onInteractOutside:R,onDismiss:N,...k}=u,x=ee.useContext(vj),[U,B]=ee.useState(null),Y=U?.ownerDocument??globalThis?.document,[,H]=ee.useState({}),re=La(h,he=>B(he)),X=Array.from(x.layers),[te]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),ce=X.indexOf(te),$=U?X.indexOf(U):-1,le=x.layersWithOutsidePointerEventsDisabled.size>0,ne=$>=ce,ue=MX(he=>{const de=he.target,ye=[...x.branches].some(Me=>Me.contains(de));!ne||ye||(S?.(he),R?.(he),he.defaultPrevented||N?.())},Y),Pe=UX(he=>{const de=he.target;[...x.branches].some(Me=>Me.contains(de))||(T?.(he),R?.(he),he.defaultPrevented||N?.())},Y);return PX(he=>{$===x.layers.size-1&&(g?.(he),!he.defaultPrevented&&N&&(he.preventDefault(),N()))},Y),ee.useEffect(()=>{if(U)return f&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(h4=Y.body.style.pointerEvents,Y.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(U)),x.layers.add(U),p4(),()=>{f&&x.layersWithOutsidePointerEventsDisabled.size===1&&(Y.body.style.pointerEvents=h4)}},[U,Y,f,x]),ee.useEffect(()=>()=>{U&&(x.layers.delete(U),x.layersWithOutsidePointerEventsDisabled.delete(U),p4())},[U,x]),ee.useEffect(()=>{const he=()=>H({});return document.addEventListener(cA,he),()=>document.removeEventListener(cA,he)},[]),O.jsx(xs.div,{...k,ref:re,style:{pointerEvents:le?ne?"auto":"none":void 0,...u.style},onFocusCapture:ai(u.onFocusCapture,Pe.onFocusCapture),onBlurCapture:ai(u.onBlurCapture,Pe.onBlurCapture),onPointerDownCapture:ai(u.onPointerDownCapture,ue.onPointerDownCapture)})});bA.displayName=kX;var xX="DismissableLayerBranch",Sj=ee.forwardRef((u,h)=>{const f=ee.useContext(vj),g=ee.useRef(null),S=La(h,g);return ee.useEffect(()=>{const T=g.current;if(T)return f.branches.add(T),()=>{f.branches.delete(T)}},[f.branches]),O.jsx(xs.div,{...u,ref:S})});Sj.displayName=xX;function MX(u,h=globalThis?.document){const f=qd(u),g=ee.useRef(!1),S=ee.useRef(()=>{});return ee.useEffect(()=>{const T=N=>{if(N.target&&!g.current){let k=function(){yj(DX,f,x,{discrete:!0})};const x={originalEvent:N};N.pointerType==="touch"?(h.removeEventListener("click",S.current),S.current=k,h.addEventListener("click",S.current,{once:!0})):k()}else h.removeEventListener("click",S.current);g.current=!1},R=window.setTimeout(()=>{h.addEventListener("pointerdown",T)},0);return()=>{window.clearTimeout(R),h.removeEventListener("pointerdown",T),h.removeEventListener("click",S.current)}},[h,f]),{onPointerDownCapture:()=>g.current=!0}}function UX(u,h=globalThis?.document){const f=qd(u),g=ee.useRef(!1);return ee.useEffect(()=>{const S=T=>{T.target&&!g.current&&yj(LX,f,{originalEvent:T},{discrete:!1})};return h.addEventListener("focusin",S),()=>h.removeEventListener("focusin",S)},[h,f]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function p4(){const u=new CustomEvent(cA);document.dispatchEvent(u)}function yj(u,h,f,{discrete:g}){const S=f.originalEvent.target,T=new CustomEvent(u,{bubbles:!1,cancelable:!0,detail:f});h&&S.addEventListener(u,h,{once:!0}),g?Ej(S,T):S.dispatchEvent(T)}var VX=bA,jX=Sj,Xd=globalThis?.document?ee.useLayoutEffect:()=>{},FX="Portal",Tj=ee.forwardRef((u,h)=>{const{container:f,...g}=u,[S,T]=ee.useState(!1);Xd(()=>T(!0),[]);const R=f||S&&globalThis?.document?.body;return R?mj.createPortal(O.jsx(xs.div,{...g,ref:h}),R):null});Tj.displayName=FX;function BX(u,h){return ee.useReducer((f,g)=>h[f][g]??f,u)}var IA=u=>{const{present:h,children:f}=u,g=WX(h),S=typeof f=="function"?f({present:g.isPresent}):ee.Children.only(f),T=La(g.ref,GX(S));return typeof f=="function"||g.isPresent?ee.cloneElement(S,{ref:T}):null};IA.displayName="Presence";function WX(u){const[h,f]=ee.useState(),g=ee.useRef(null),S=ee.useRef(u),T=ee.useRef("none"),R=u?"mounted":"unmounted",[N,k]=BX(R,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ee.useEffect(()=>{const x=qT(g.current);T.current=N==="mounted"?x:"none"},[N]),Xd(()=>{const x=g.current,U=S.current;if(U!==u){const Y=T.current,H=qT(x);u?k("MOUNT"):H==="none"||x?.display==="none"?k("UNMOUNT"):k(U&&Y!==H?"ANIMATION_OUT":"UNMOUNT"),S.current=u}},[u,k]),Xd(()=>{if(h){let x;const U=h.ownerDocument.defaultView??window,B=H=>{const X=qT(g.current).includes(H.animationName);if(H.target===h&&X&&(k("ANIMATION_END"),!S.current)){const te=h.style.animationFillMode;h.style.animationFillMode="forwards",x=U.setTimeout(()=>{h.style.animationFillMode==="forwards"&&(h.style.animationFillMode=te)})}},Y=H=>{H.target===h&&(T.current=qT(g.current))};return h.addEventListener("animationstart",Y),h.addEventListener("animationcancel",B),h.addEventListener("animationend",B),()=>{U.clearTimeout(x),h.removeEventListener("animationstart",Y),h.removeEventListener("animationcancel",B),h.removeEventListener("animationend",B)}}else k("ANIMATION_END")},[h,k]),{isPresent:["mounted","unmountSuspended"].includes(N),ref:ee.useCallback(x=>{g.current=x?getComputedStyle(x):null,f(x)},[])}}function qT(u){return u?.animationName||"none"}function GX(u){let h=Object.getOwnPropertyDescriptor(u.props,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning;return f?u.ref:(h=Object.getOwnPropertyDescriptor(u,"ref")?.get,f=h&&"isReactWarning"in h&&h.isReactWarning,f?u.props.ref:u.props.ref||u.ref)}var HX=pj[" useInsertionEffect ".trim().toString()]||Xd;function KX({prop:u,defaultProp:h,onChange:f=()=>{},caller:g}){const[S,T,R]=zX({defaultProp:h,onChange:f}),N=u!==void 0,k=N?u:S;{const U=ee.useRef(u!==void 0);ee.useEffect(()=>{const B=U.current;B!==N&&console.warn(`${g} is changing from ${B?"controlled":"uncontrolled"} to ${N?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),U.current=N},[N,g])}const x=ee.useCallback(U=>{if(N){const B=YX(U)?U(u):U;B!==u&&R.current?.(B)}else T(U)},[N,u,T,R]);return[k,x]}function zX({defaultProp:u,onChange:h}){const[f,g]=ee.useState(u),S=ee.useRef(f),T=ee.useRef(h);return HX(()=>{T.current=h},[h]),ee.useEffect(()=>{S.current!==f&&(T.current?.(f),S.current=f)},[f,S]),[f,g,T]}function YX(u){return typeof u=="function"}var qX=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),XX="VisuallyHidden",C0=ee.forwardRef((u,h)=>O.jsx(xs.span,{...u,ref:h,style:{...qX,...u.style}}));C0.displayName=XX;var JX=C0,AA="ToastProvider",[OA,QX,$X]=OX("Toast"),[Cj,Ine]=T0("Toast",[$X]),[ZX,w0]=Cj(AA),wj=u=>{const{__scopeToast:h,label:f="Notification",duration:g=5e3,swipeDirection:S="right",swipeThreshold:T=50,children:R}=u,[N,k]=ee.useState(null),[x,U]=ee.useState(0),B=ee.useRef(!1),Y=ee.useRef(!1);return f.trim()||console.error(`Invalid prop \`label\` supplied to \`${AA}\`. Expected non-empty \`string\`.`),O.jsx(OA.Provider,{scope:h,children:O.jsx(ZX,{scope:h,label:f,duration:g,swipeDirection:S,swipeThreshold:T,toastCount:x,viewport:N,onViewportChange:k,onToastAdd:ee.useCallback(()=>U(H=>H+1),[]),onToastRemove:ee.useCallback(()=>U(H=>H-1),[]),isFocusedToastEscapeKeyDownRef:B,isClosePausedRef:Y,children:R})})};wj.displayName=AA;var Rj="ToastViewport",eJ=["F8"],lA="toast.viewportPause",dA="toast.viewportResume",bj=ee.forwardRef((u,h)=>{const{__scopeToast:f,hotkey:g=eJ,label:S="Notifications ({hotkey})",...T}=u,R=w0(Rj,f),N=QX(f),k=ee.useRef(null),x=ee.useRef(null),U=ee.useRef(null),B=ee.useRef(null),Y=La(h,B,R.onViewportChange),H=g.join("+").replace(/Key/g,"").replace(/Digit/g,""),re=R.toastCount>0;ee.useEffect(()=>{const te=ce=>{g.length!==0&&g.every(le=>ce[le]||ce.code===le)&&B.current?.focus()};return document.addEventListener("keydown",te),()=>document.removeEventListener("keydown",te)},[g]),ee.useEffect(()=>{const te=k.current,ce=B.current;if(re&&te&&ce){const $=()=>{if(!R.isClosePausedRef.current){const Pe=new CustomEvent(lA);ce.dispatchEvent(Pe),R.isClosePausedRef.current=!0}},le=()=>{if(R.isClosePausedRef.current){const Pe=new CustomEvent(dA);ce.dispatchEvent(Pe),R.isClosePausedRef.current=!1}},ne=Pe=>{!te.contains(Pe.relatedTarget)&&le()},ue=()=>{te.contains(document.activeElement)||le()};return te.addEventListener("focusin",$),te.addEventListener("focusout",ne),te.addEventListener("pointermove",$),te.addEventListener("pointerleave",ue),window.addEventListener("blur",$),window.addEventListener("focus",le),()=>{te.removeEventListener("focusin",$),te.removeEventListener("focusout",ne),te.removeEventListener("pointermove",$),te.removeEventListener("pointerleave",ue),window.removeEventListener("blur",$),window.removeEventListener("focus",le)}}},[re,R.isClosePausedRef]);const X=ee.useCallback(({tabbingDirection:te})=>{const $=N().map(le=>{const ne=le.ref.current,ue=[ne,...pJ(ne)];return te==="forwards"?ue:ue.reverse()});return(te==="forwards"?$.reverse():$).flat()},[N]);return ee.useEffect(()=>{const te=B.current;if(te){const ce=$=>{const le=$.altKey||$.ctrlKey||$.metaKey;if($.key==="Tab"&&!le){const ue=document.activeElement,Pe=$.shiftKey;if($.target===te&&Pe){x.current?.focus();return}const ye=X({tabbingDirection:Pe?"backwards":"forwards"}),Me=ye.findIndex(Je=>Je===ue);JI(ye.slice(Me+1))?$.preventDefault():Pe?x.current?.focus():U.current?.focus()}};return te.addEventListener("keydown",ce),()=>te.removeEventListener("keydown",ce)}},[N,X]),O.jsxs(jX,{ref:k,role:"region","aria-label":S.replace("{hotkey}",H),tabIndex:-1,style:{pointerEvents:re?void 0:"none"},children:[re&&O.jsx(uA,{ref:x,onFocusFromOutsideViewport:()=>{const te=X({tabbingDirection:"forwards"});JI(te)}}),O.jsx(OA.Slot,{scope:f,children:O.jsx(xs.ol,{tabIndex:-1,...T,ref:Y})}),re&&O.jsx(uA,{ref:U,onFocusFromOutsideViewport:()=>{const te=X({tabbingDirection:"backwards"});JI(te)}})]})});bj.displayName=Rj;var Ij="ToastFocusProxy",uA=ee.forwardRef((u,h)=>{const{__scopeToast:f,onFocusFromOutsideViewport:g,...S}=u,T=w0(Ij,f);return O.jsx(C0,{"aria-hidden":!0,tabIndex:0,...S,ref:h,style:{position:"fixed"},onFocus:R=>{const N=R.relatedTarget;!T.viewport?.contains(N)&&g()}})});uA.displayName=Ij;var VE="Toast",tJ="toast.swipeStart",nJ="toast.swipeMove",rJ="toast.swipeCancel",iJ="toast.swipeEnd",Aj=ee.forwardRef((u,h)=>{const{forceMount:f,open:g,defaultOpen:S,onOpenChange:T,...R}=u,[N,k]=KX({prop:g,defaultProp:S??!0,onChange:T,caller:VE});return O.jsx(IA,{present:f||N,children:O.jsx(aJ,{open:N,...R,ref:h,onClose:()=>k(!1),onPause:qd(u.onPause),onResume:qd(u.onResume),onSwipeStart:ai(u.onSwipeStart,x=>{x.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ai(u.onSwipeMove,x=>{const{x:U,y:B}=x.detail.delta;x.currentTarget.setAttribute("data-swipe","move"),x.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${U}px`),x.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${B}px`)}),onSwipeCancel:ai(u.onSwipeCancel,x=>{x.currentTarget.setAttribute("data-swipe","cancel"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),x.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ai(u.onSwipeEnd,x=>{const{x:U,y:B}=x.detail.delta;x.currentTarget.setAttribute("data-swipe","end"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),x.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${U}px`),x.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${B}px`),k(!1)})})})});Aj.displayName=VE;var[sJ,oJ]=Cj(VE,{onClose(){}}),aJ=ee.forwardRef((u,h)=>{const{__scopeToast:f,type:g="foreground",duration:S,open:T,onClose:R,onEscapeKeyDown:N,onPause:k,onResume:x,onSwipeStart:U,onSwipeMove:B,onSwipeCancel:Y,onSwipeEnd:H,...re}=u,X=w0(VE,f),[te,ce]=ee.useState(null),$=La(h,He=>ce(He)),le=ee.useRef(null),ne=ee.useRef(null),ue=S||X.duration,Pe=ee.useRef(0),he=ee.useRef(ue),de=ee.useRef(0),{onToastAdd:ye,onToastRemove:Me}=X,Je=qd(()=>{te?.contains(document.activeElement)&&X.viewport?.focus(),R()}),Ve=ee.useCallback(He=>{!He||He===1/0||(window.clearTimeout(de.current),Pe.current=new Date().getTime(),de.current=window.setTimeout(Je,He))},[Je]);ee.useEffect(()=>{const He=X.viewport;if(He){const dt=()=>{Ve(he.current),x?.()},Qe=()=>{const Ge=new Date().getTime()-Pe.current;he.current=he.current-Ge,window.clearTimeout(de.current),k?.()};return He.addEventListener(lA,Qe),He.addEventListener(dA,dt),()=>{He.removeEventListener(lA,Qe),He.removeEventListener(dA,dt)}}},[X.viewport,ue,k,x,Ve]),ee.useEffect(()=>{T&&!X.isClosePausedRef.current&&Ve(ue)},[T,ue,X.isClosePausedRef,Ve]),ee.useEffect(()=>(ye(),()=>Me()),[ye,Me]);const xe=ee.useMemo(()=>te?xj(te):null,[te]);return X.viewport?O.jsxs(O.Fragment,{children:[xe&&O.jsx(cJ,{__scopeToast:f,role:"status","aria-live":g==="foreground"?"assertive":"polite","aria-atomic":!0,children:xe}),O.jsx(sJ,{scope:f,onClose:Je,children:y0.createPortal(O.jsx(OA.ItemSlot,{scope:f,children:O.jsx(VX,{asChild:!0,onEscapeKeyDown:ai(N,()=>{X.isFocusedToastEscapeKeyDownRef.current||Je(),X.isFocusedToastEscapeKeyDownRef.current=!1}),children:O.jsx(xs.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":T?"open":"closed","data-swipe-direction":X.swipeDirection,...re,ref:$,style:{userSelect:"none",touchAction:"none",...u.style},onKeyDown:ai(u.onKeyDown,He=>{He.key==="Escape"&&(N?.(He.nativeEvent),He.nativeEvent.defaultPrevented||(X.isFocusedToastEscapeKeyDownRef.current=!0,Je()))}),onPointerDown:ai(u.onPointerDown,He=>{He.button===0&&(le.current={x:He.clientX,y:He.clientY})}),onPointerMove:ai(u.onPointerMove,He=>{if(!le.current)return;const dt=He.clientX-le.current.x,Qe=He.clientY-le.current.y,Ge=!!ne.current,Ie=["left","right"].includes(X.swipeDirection),ke=["left","up"].includes(X.swipeDirection)?Math.min:Math.max,Ye=Ie?ke(0,dt):0,_e=Ie?0:ke(0,Qe),De=He.pointerType==="touch"?10:2,ct={x:Ye,y:_e},at={originalEvent:He,delta:ct};Ge?(ne.current=ct,XT(nJ,B,at,{discrete:!1})):f4(ct,X.swipeDirection,De)?(ne.current=ct,XT(tJ,U,at,{discrete:!1}),He.target.setPointerCapture(He.pointerId)):(Math.abs(dt)>De||Math.abs(Qe)>De)&&(le.current=null)}),onPointerUp:ai(u.onPointerUp,He=>{const dt=ne.current,Qe=He.target;if(Qe.hasPointerCapture(He.pointerId)&&Qe.releasePointerCapture(He.pointerId),ne.current=null,le.current=null,dt){const Ge=He.currentTarget,Ie={originalEvent:He,delta:dt};f4(dt,X.swipeDirection,X.swipeThreshold)?XT(iJ,H,Ie,{discrete:!0}):XT(rJ,Y,Ie,{discrete:!0}),Ge.addEventListener("click",ke=>ke.preventDefault(),{once:!0})}})})})}),X.viewport)})]}):null}),cJ=u=>{const{__scopeToast:h,children:f,...g}=u,S=w0(VE,h),[T,R]=ee.useState(!1),[N,k]=ee.useState(!1);return uJ(()=>R(!0)),ee.useEffect(()=>{const x=window.setTimeout(()=>k(!0),1e3);return()=>window.clearTimeout(x)},[]),N?null:O.jsx(Tj,{asChild:!0,children:O.jsx(C0,{...g,children:T&&O.jsxs(O.Fragment,{children:[S.label," ",f]})})})},lJ="ToastTitle",Oj=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u;return O.jsx(xs.div,{...g,ref:h})});Oj.displayName=lJ;var dJ="ToastDescription",Nj=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u;return O.jsx(xs.div,{...g,ref:h})});Nj.displayName=dJ;var Pj="ToastAction",kj=ee.forwardRef((u,h)=>{const{altText:f,...g}=u;return f.trim()?O.jsx(Lj,{altText:f,asChild:!0,children:O.jsx(NA,{...g,ref:h})}):(console.error(`Invalid prop \`altText\` supplied to \`${Pj}\`. Expected non-empty \`string\`.`),null)});kj.displayName=Pj;var Dj="ToastClose",NA=ee.forwardRef((u,h)=>{const{__scopeToast:f,...g}=u,S=oJ(Dj,f);return O.jsx(Lj,{asChild:!0,children:O.jsx(xs.button,{type:"button",...g,ref:h,onClick:ai(u.onClick,S.onClose)})})});NA.displayName=Dj;var Lj=ee.forwardRef((u,h)=>{const{__scopeToast:f,altText:g,...S}=u;return O.jsx(xs.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":g||void 0,...S,ref:h})});function xj(u){const h=[];return Array.from(u.childNodes).forEach(g=>{if(g.nodeType===g.TEXT_NODE&&g.textContent&&h.push(g.textContent),hJ(g)){const S=g.ariaHidden||g.hidden||g.style.display==="none",T=g.dataset.radixToastAnnounceExclude==="";if(!S)if(T){const R=g.dataset.radixToastAnnounceAlt;R&&h.push(R)}else h.push(...xj(g))}}),h}function XT(u,h,f,{discrete:g}){const S=f.originalEvent.currentTarget,T=new CustomEvent(u,{bubbles:!0,cancelable:!0,detail:f});h&&S.addEventListener(u,h,{once:!0}),g?Ej(S,T):S.dispatchEvent(T)}var f4=(u,h,f=0)=>{const g=Math.abs(u.x),S=Math.abs(u.y),T=g>S;return h==="left"||h==="right"?T&&g>f:!T&&S>f};function uJ(u=()=>{}){const h=qd(u);Xd(()=>{let f=0,g=0;return f=window.requestAnimationFrame(()=>g=window.requestAnimationFrame(h)),()=>{window.cancelAnimationFrame(f),window.cancelAnimationFrame(g)}},[h])}function hJ(u){return u.nodeType===u.ELEMENT_NODE}function pJ(u){const h=[],f=document.createTreeWalker(u,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const S=g.tagName==="INPUT"&&g.type==="hidden";return g.disabled||g.hidden||S?NodeFilter.FILTER_SKIP:g.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;f.nextNode();)h.push(f.currentNode);return h}function JI(u){const h=document.activeElement;return u.some(f=>f===h?!0:(f.focus(),document.activeElement!==h))}var fJ=wj,Mj=bj,Uj=Aj,Vj=Oj,jj=Nj,Fj=kj,Bj=NA;function Wj(u){var h,f,g="";if(typeof u=="string"||typeof u=="number")g+=u;else if(typeof u=="object")if(Array.isArray(u)){var S=u.length;for(h=0;h<S;h++)u[h]&&(f=Wj(u[h]))&&(g&&(g+=" "),g+=f)}else for(f in u)u[f]&&(g&&(g+=" "),g+=f);return g}function Gj(){for(var u,h,f=0,g="",S=arguments.length;f<S;f++)(u=arguments[f])&&(h=Wj(u))&&(g&&(g+=" "),g+=h);return g}const m4=u=>typeof u=="boolean"?`${u}`:u===0?"0":u,_4=Gj,mJ=(u,h)=>f=>{var g;if(h?.variants==null)return _4(u,f?.class,f?.className);const{variants:S,defaultVariants:T}=h,R=Object.keys(S).map(x=>{const U=f?.[x],B=T?.[x];if(U===null)return null;const Y=m4(U)||m4(B);return S[x][Y]}),N=f&&Object.entries(f).reduce((x,U)=>{let[B,Y]=U;return Y===void 0||(x[B]=Y),x},{}),k=h==null||(g=h.compoundVariants)===null||g===void 0?void 0:g.reduce((x,U)=>{let{class:B,className:Y,...H}=U;return Object.entries(H).every(re=>{let[X,te]=re;return Array.isArray(te)?te.includes({...T,...N}[X]):{...T,...N}[X]===te})?[...x,B,Y]:x},[]);return _4(u,R,k,f?.class,f?.className)};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _J=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),gJ=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(h,f,g)=>g?g.toUpperCase():f.toLowerCase()),g4=u=>{const h=gJ(u);return h.charAt(0).toUpperCase()+h.slice(1)},Hj=(...u)=>u.filter((h,f,g)=>!!h&&h.trim()!==""&&g.indexOf(h)===f).join(" ").trim(),EJ=u=>{for(const h in u)if(h.startsWith("aria-")||h==="role"||h==="title")return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var vJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SJ=ee.forwardRef(({color:u="currentColor",size:h=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:S="",children:T,iconNode:R,...N},k)=>ee.createElement("svg",{ref:k,...vJ,width:h,height:h,stroke:u,strokeWidth:g?Number(f)*24/Number(h):f,className:Hj("lucide",S),...!T&&!EJ(N)&&{"aria-hidden":"true"},...N},[...R.map(([x,U])=>ee.createElement(x,U)),...Array.isArray(T)?T:[T]]));/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PA=(u,h)=>{const f=ee.forwardRef(({className:g,...S},T)=>ee.createElement(SJ,{ref:T,iconNode:h,className:Hj(`lucide-${_J(g4(u))}`,`lucide-${u}`,g),...S}));return f.displayName=g4(u),f};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yJ=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Kj=PA("eye-off",yJ);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TJ=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],zj=PA("eye",TJ);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CJ=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],wJ=PA("x",CJ),kA="-",RJ=u=>{const h=IJ(u),{conflictingClassGroups:f,conflictingClassGroupModifiers:g}=u;return{getClassGroupId:R=>{const N=R.split(kA);return N[0]===""&&N.length!==1&&N.shift(),Yj(N,h)||bJ(R)},getConflictingClassGroupIds:(R,N)=>{const k=f[R]||[];return N&&g[R]?[...k,...g[R]]:k}}},Yj=(u,h)=>{if(u.length===0)return h.classGroupId;const f=u[0],g=h.nextPart.get(f),S=g?Yj(u.slice(1),g):void 0;if(S)return S;if(h.validators.length===0)return;const T=u.join(kA);return h.validators.find(({validator:R})=>R(T))?.classGroupId},E4=/^\[(.+)\]$/,bJ=u=>{if(E4.test(u)){const h=E4.exec(u)[1],f=h?.substring(0,h.indexOf(":"));if(f)return"arbitrary.."+f}},IJ=u=>{const{theme:h,prefix:f}=u,g={nextPart:new Map,validators:[]};return OJ(Object.entries(u.classGroups),f).forEach(([T,R])=>{hA(R,g,T,h)}),g},hA=(u,h,f,g)=>{u.forEach(S=>{if(typeof S=="string"){const T=S===""?h:v4(h,S);T.classGroupId=f;return}if(typeof S=="function"){if(AJ(S)){hA(S(g),h,f,g);return}h.validators.push({validator:S,classGroupId:f});return}Object.entries(S).forEach(([T,R])=>{hA(R,v4(h,T),f,g)})})},v4=(u,h)=>{let f=u;return h.split(kA).forEach(g=>{f.nextPart.has(g)||f.nextPart.set(g,{nextPart:new Map,validators:[]}),f=f.nextPart.get(g)}),f},AJ=u=>u.isThemeGetter,OJ=(u,h)=>h?u.map(([f,g])=>{const S=g.map(T=>typeof T=="string"?h+T:typeof T=="object"?Object.fromEntries(Object.entries(T).map(([R,N])=>[h+R,N])):T);return[f,S]}):u,NJ=u=>{if(u<1)return{get:()=>{},set:()=>{}};let h=0,f=new Map,g=new Map;const S=(T,R)=>{f.set(T,R),h++,h>u&&(h=0,g=f,f=new Map)};return{get(T){let R=f.get(T);if(R!==void 0)return R;if((R=g.get(T))!==void 0)return S(T,R),R},set(T,R){f.has(T)?f.set(T,R):S(T,R)}}},qj="!",PJ=u=>{const{separator:h,experimentalParseClassName:f}=u,g=h.length===1,S=h[0],T=h.length,R=N=>{const k=[];let x=0,U=0,B;for(let te=0;te<N.length;te++){let ce=N[te];if(x===0){if(ce===S&&(g||N.slice(te,te+T)===h)){k.push(N.slice(U,te)),U=te+T;continue}if(ce==="/"){B=te;continue}}ce==="["?x++:ce==="]"&&x--}const Y=k.length===0?N:N.substring(U),H=Y.startsWith(qj),re=H?Y.substring(1):Y,X=B&&B>U?B-U:void 0;return{modifiers:k,hasImportantModifier:H,baseClassName:re,maybePostfixModifierPosition:X}};return f?N=>f({className:N,parseClassName:R}):R},kJ=u=>{if(u.length<=1)return u;const h=[];let f=[];return u.forEach(g=>{g[0]==="["?(h.push(...f.sort(),g),f=[]):f.push(g)}),h.push(...f.sort()),h},DJ=u=>({cache:NJ(u.cacheSize),parseClassName:PJ(u),...RJ(u)}),LJ=/\s+/,xJ=(u,h)=>{const{parseClassName:f,getClassGroupId:g,getConflictingClassGroupIds:S}=h,T=[],R=u.trim().split(LJ);let N="";for(let k=R.length-1;k>=0;k-=1){const x=R[k],{modifiers:U,hasImportantModifier:B,baseClassName:Y,maybePostfixModifierPosition:H}=f(x);let re=!!H,X=g(re?Y.substring(0,H):Y);if(!X){if(!re){N=x+(N.length>0?" "+N:N);continue}if(X=g(Y),!X){N=x+(N.length>0?" "+N:N);continue}re=!1}const te=kJ(U).join(":"),ce=B?te+qj:te,$=ce+X;if(T.includes($))continue;T.push($);const le=S(X,re);for(let ne=0;ne<le.length;++ne){const ue=le[ne];T.push(ce+ue)}N=x+(N.length>0?" "+N:N)}return N};function MJ(){let u=0,h,f,g="";for(;u<arguments.length;)(h=arguments[u++])&&(f=Xj(h))&&(g&&(g+=" "),g+=f);return g}const Xj=u=>{if(typeof u=="string")return u;let h,f="";for(let g=0;g<u.length;g++)u[g]&&(h=Xj(u[g]))&&(f&&(f+=" "),f+=h);return f};function UJ(u,...h){let f,g,S,T=R;function R(k){const x=h.reduce((U,B)=>B(U),u());return f=DJ(x),g=f.cache.get,S=f.cache.set,T=N,N(k)}function N(k){const x=g(k);if(x)return x;const U=xJ(k,f);return S(k,U),U}return function(){return T(MJ.apply(null,arguments))}}const hr=u=>{const h=f=>f[u]||[];return h.isThemeGetter=!0,h},Jj=/^\[(?:([a-z-]+):)?(.+)\]$/i,VJ=/^\d+\/\d+$/,jJ=new Set(["px","full","screen"]),FJ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,BJ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,WJ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,GJ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,HJ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Tl=u=>im(u)||jJ.has(u)||VJ.test(u),Bd=u=>dm(u,"length",$J),im=u=>!!u&&!Number.isNaN(Number(u)),QI=u=>dm(u,"number",im),TE=u=>!!u&&Number.isInteger(Number(u)),KJ=u=>u.endsWith("%")&&im(u.slice(0,-1)),cn=u=>Jj.test(u),Wd=u=>FJ.test(u),zJ=new Set(["length","size","percentage"]),YJ=u=>dm(u,zJ,Qj),qJ=u=>dm(u,"position",Qj),XJ=new Set(["image","url"]),JJ=u=>dm(u,XJ,eQ),QJ=u=>dm(u,"",ZJ),CE=()=>!0,dm=(u,h,f)=>{const g=Jj.exec(u);return g?g[1]?typeof h=="string"?g[1]===h:h.has(g[1]):f(g[2]):!1},$J=u=>BJ.test(u)&&!WJ.test(u),Qj=()=>!1,ZJ=u=>GJ.test(u),eQ=u=>HJ.test(u),tQ=()=>{const u=hr("colors"),h=hr("spacing"),f=hr("blur"),g=hr("brightness"),S=hr("borderColor"),T=hr("borderRadius"),R=hr("borderSpacing"),N=hr("borderWidth"),k=hr("contrast"),x=hr("grayscale"),U=hr("hueRotate"),B=hr("invert"),Y=hr("gap"),H=hr("gradientColorStops"),re=hr("gradientColorStopPositions"),X=hr("inset"),te=hr("margin"),ce=hr("opacity"),$=hr("padding"),le=hr("saturate"),ne=hr("scale"),ue=hr("sepia"),Pe=hr("skew"),he=hr("space"),de=hr("translate"),ye=()=>["auto","contain","none"],Me=()=>["auto","hidden","clip","visible","scroll"],Je=()=>["auto",cn,h],Ve=()=>[cn,h],xe=()=>["",Tl,Bd],He=()=>["auto",im,cn],dt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Qe=()=>["solid","dashed","dotted","double","none"],Ge=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ie=()=>["start","end","center","between","around","evenly","stretch"],ke=()=>["","0",cn],Ye=()=>["auto","avoid","all","avoid-page","page","left","right","column"],_e=()=>[im,cn];return{cacheSize:500,separator:":",theme:{colors:[CE],spacing:[Tl,Bd],blur:["none","",Wd,cn],brightness:_e(),borderColor:[u],borderRadius:["none","","full",Wd,cn],borderSpacing:Ve(),borderWidth:xe(),contrast:_e(),grayscale:ke(),hueRotate:_e(),invert:ke(),gap:Ve(),gradientColorStops:[u],gradientColorStopPositions:[KJ,Bd],inset:Je(),margin:Je(),opacity:_e(),padding:Ve(),saturate:_e(),scale:_e(),sepia:ke(),skew:_e(),space:Ve(),translate:Ve()},classGroups:{aspect:[{aspect:["auto","square","video",cn]}],container:["container"],columns:[{columns:[Wd]}],"break-after":[{"break-after":Ye()}],"break-before":[{"break-before":Ye()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...dt(),cn]}],overflow:[{overflow:Me()}],"overflow-x":[{"overflow-x":Me()}],"overflow-y":[{"overflow-y":Me()}],overscroll:[{overscroll:ye()}],"overscroll-x":[{"overscroll-x":ye()}],"overscroll-y":[{"overscroll-y":ye()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[X]}],"inset-x":[{"inset-x":[X]}],"inset-y":[{"inset-y":[X]}],start:[{start:[X]}],end:[{end:[X]}],top:[{top:[X]}],right:[{right:[X]}],bottom:[{bottom:[X]}],left:[{left:[X]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",TE,cn]}],basis:[{basis:Je()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",cn]}],grow:[{grow:ke()}],shrink:[{shrink:ke()}],order:[{order:["first","last","none",TE,cn]}],"grid-cols":[{"grid-cols":[CE]}],"col-start-end":[{col:["auto",{span:["full",TE,cn]},cn]}],"col-start":[{"col-start":He()}],"col-end":[{"col-end":He()}],"grid-rows":[{"grid-rows":[CE]}],"row-start-end":[{row:["auto",{span:[TE,cn]},cn]}],"row-start":[{"row-start":He()}],"row-end":[{"row-end":He()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",cn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",cn]}],gap:[{gap:[Y]}],"gap-x":[{"gap-x":[Y]}],"gap-y":[{"gap-y":[Y]}],"justify-content":[{justify:["normal",...Ie()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ie(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ie(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[$]}],px:[{px:[$]}],py:[{py:[$]}],ps:[{ps:[$]}],pe:[{pe:[$]}],pt:[{pt:[$]}],pr:[{pr:[$]}],pb:[{pb:[$]}],pl:[{pl:[$]}],m:[{m:[te]}],mx:[{mx:[te]}],my:[{my:[te]}],ms:[{ms:[te]}],me:[{me:[te]}],mt:[{mt:[te]}],mr:[{mr:[te]}],mb:[{mb:[te]}],ml:[{ml:[te]}],"space-x":[{"space-x":[he]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[he]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",cn,h]}],"min-w":[{"min-w":[cn,h,"min","max","fit"]}],"max-w":[{"max-w":[cn,h,"none","full","min","max","fit","prose",{screen:[Wd]},Wd]}],h:[{h:[cn,h,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[cn,h,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[cn,h,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[cn,h,"auto","min","max","fit"]}],"font-size":[{text:["base",Wd,Bd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",QI]}],"font-family":[{font:[CE]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",cn]}],"line-clamp":[{"line-clamp":["none",im,QI]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Tl,cn]}],"list-image":[{"list-image":["none",cn]}],"list-style-type":[{list:["none","disc","decimal",cn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[u]}],"placeholder-opacity":[{"placeholder-opacity":[ce]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[u]}],"text-opacity":[{"text-opacity":[ce]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Qe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Tl,Bd]}],"underline-offset":[{"underline-offset":["auto",Tl,cn]}],"text-decoration-color":[{decoration:[u]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ve()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",cn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",cn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ce]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...dt(),qJ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",YJ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},JJ]}],"bg-color":[{bg:[u]}],"gradient-from-pos":[{from:[re]}],"gradient-via-pos":[{via:[re]}],"gradient-to-pos":[{to:[re]}],"gradient-from":[{from:[H]}],"gradient-via":[{via:[H]}],"gradient-to":[{to:[H]}],rounded:[{rounded:[T]}],"rounded-s":[{"rounded-s":[T]}],"rounded-e":[{"rounded-e":[T]}],"rounded-t":[{"rounded-t":[T]}],"rounded-r":[{"rounded-r":[T]}],"rounded-b":[{"rounded-b":[T]}],"rounded-l":[{"rounded-l":[T]}],"rounded-ss":[{"rounded-ss":[T]}],"rounded-se":[{"rounded-se":[T]}],"rounded-ee":[{"rounded-ee":[T]}],"rounded-es":[{"rounded-es":[T]}],"rounded-tl":[{"rounded-tl":[T]}],"rounded-tr":[{"rounded-tr":[T]}],"rounded-br":[{"rounded-br":[T]}],"rounded-bl":[{"rounded-bl":[T]}],"border-w":[{border:[N]}],"border-w-x":[{"border-x":[N]}],"border-w-y":[{"border-y":[N]}],"border-w-s":[{"border-s":[N]}],"border-w-e":[{"border-e":[N]}],"border-w-t":[{"border-t":[N]}],"border-w-r":[{"border-r":[N]}],"border-w-b":[{"border-b":[N]}],"border-w-l":[{"border-l":[N]}],"border-opacity":[{"border-opacity":[ce]}],"border-style":[{border:[...Qe(),"hidden"]}],"divide-x":[{"divide-x":[N]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[N]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ce]}],"divide-style":[{divide:Qe()}],"border-color":[{border:[S]}],"border-color-x":[{"border-x":[S]}],"border-color-y":[{"border-y":[S]}],"border-color-s":[{"border-s":[S]}],"border-color-e":[{"border-e":[S]}],"border-color-t":[{"border-t":[S]}],"border-color-r":[{"border-r":[S]}],"border-color-b":[{"border-b":[S]}],"border-color-l":[{"border-l":[S]}],"divide-color":[{divide:[S]}],"outline-style":[{outline:["",...Qe()]}],"outline-offset":[{"outline-offset":[Tl,cn]}],"outline-w":[{outline:[Tl,Bd]}],"outline-color":[{outline:[u]}],"ring-w":[{ring:xe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[u]}],"ring-opacity":[{"ring-opacity":[ce]}],"ring-offset-w":[{"ring-offset":[Tl,Bd]}],"ring-offset-color":[{"ring-offset":[u]}],shadow:[{shadow:["","inner","none",Wd,QJ]}],"shadow-color":[{shadow:[CE]}],opacity:[{opacity:[ce]}],"mix-blend":[{"mix-blend":[...Ge(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ge()}],filter:[{filter:["","none"]}],blur:[{blur:[f]}],brightness:[{brightness:[g]}],contrast:[{contrast:[k]}],"drop-shadow":[{"drop-shadow":["","none",Wd,cn]}],grayscale:[{grayscale:[x]}],"hue-rotate":[{"hue-rotate":[U]}],invert:[{invert:[B]}],saturate:[{saturate:[le]}],sepia:[{sepia:[ue]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[f]}],"backdrop-brightness":[{"backdrop-brightness":[g]}],"backdrop-contrast":[{"backdrop-contrast":[k]}],"backdrop-grayscale":[{"backdrop-grayscale":[x]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[U]}],"backdrop-invert":[{"backdrop-invert":[B]}],"backdrop-opacity":[{"backdrop-opacity":[ce]}],"backdrop-saturate":[{"backdrop-saturate":[le]}],"backdrop-sepia":[{"backdrop-sepia":[ue]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[R]}],"border-spacing-x":[{"border-spacing-x":[R]}],"border-spacing-y":[{"border-spacing-y":[R]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",cn]}],duration:[{duration:_e()}],ease:[{ease:["linear","in","out","in-out",cn]}],delay:[{delay:_e()}],animate:[{animate:["none","spin","ping","pulse","bounce",cn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ne]}],"scale-x":[{"scale-x":[ne]}],"scale-y":[{"scale-y":[ne]}],rotate:[{rotate:[TE,cn]}],"translate-x":[{"translate-x":[de]}],"translate-y":[{"translate-y":[de]}],"skew-x":[{"skew-x":[Pe]}],"skew-y":[{"skew-y":[Pe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",cn]}],accent:[{accent:["auto",u]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",cn]}],"caret-color":[{caret:[u]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ve()}],"scroll-mx":[{"scroll-mx":Ve()}],"scroll-my":[{"scroll-my":Ve()}],"scroll-ms":[{"scroll-ms":Ve()}],"scroll-me":[{"scroll-me":Ve()}],"scroll-mt":[{"scroll-mt":Ve()}],"scroll-mr":[{"scroll-mr":Ve()}],"scroll-mb":[{"scroll-mb":Ve()}],"scroll-ml":[{"scroll-ml":Ve()}],"scroll-p":[{"scroll-p":Ve()}],"scroll-px":[{"scroll-px":Ve()}],"scroll-py":[{"scroll-py":Ve()}],"scroll-ps":[{"scroll-ps":Ve()}],"scroll-pe":[{"scroll-pe":Ve()}],"scroll-pt":[{"scroll-pt":Ve()}],"scroll-pr":[{"scroll-pr":Ve()}],"scroll-pb":[{"scroll-pb":Ve()}],"scroll-pl":[{"scroll-pl":Ve()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",cn]}],fill:[{fill:[u,"none"]}],"stroke-w":[{stroke:[Tl,Bd,QI]}],stroke:[{stroke:[u,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},nQ=UJ(tQ);function Fh(...u){return nQ(Gj(u))}const rQ=fJ,$j=ee.forwardRef(({className:u,...h},f)=>O.jsx(Mj,{ref:f,className:Fh("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",u),...h}));$j.displayName=Mj.displayName;const iQ=mJ("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Zj=ee.forwardRef(({className:u,variant:h,...f},g)=>O.jsx(Uj,{ref:g,className:Fh(iQ({variant:h}),u),...f}));Zj.displayName=Uj.displayName;const sQ=ee.forwardRef(({className:u,...h},f)=>O.jsx(Fj,{ref:f,className:Fh("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",u),...h}));sQ.displayName=Fj.displayName;const e8=ee.forwardRef(({className:u,...h},f)=>O.jsx(Bj,{ref:f,className:Fh("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",u),"toast-close":"",...h,children:O.jsx(wJ,{className:"h-4 w-4"})}));e8.displayName=Bj.displayName;const t8=ee.forwardRef(({className:u,...h},f)=>O.jsx(Vj,{ref:f,className:Fh("text-sm font-semibold",u),...h}));t8.displayName=Vj.displayName;const n8=ee.forwardRef(({className:u,...h},f)=>O.jsx(jj,{ref:f,className:Fh("text-sm opacity-90",u),...h}));n8.displayName=jj.displayName;function oQ(){const{toasts:u}=vX();return O.jsxs(rQ,{children:[u.map(function({id:h,title:f,description:g,action:S,...T}){return O.jsxs(Zj,{...T,children:[O.jsxs("div",{className:"grid gap-1",children:[f&&O.jsx(t8,{children:f}),g&&O.jsx(n8,{children:g})]}),S,O.jsx(e8,{})]},h)}),O.jsx($j,{})]})}var JT={},S4;function aQ(){if(S4)return JT;S4=1;var u=fj();return JT.createRoot=u.createRoot,JT.hydrateRoot=u.hydrateRoot,JT}var cQ=aQ(),lQ=(u,h,f,g,S,T,R,N)=>{let k=document.documentElement,x=["light","dark"];function U(H){(Array.isArray(u)?u:[u]).forEach(re=>{let X=re==="class",te=X&&T?S.map(ce=>T[ce]||ce):S;X?(k.classList.remove(...te),k.classList.add(T&&T[H]?T[H]:H)):k.setAttribute(re,H)}),B(H)}function B(H){N&&x.includes(H)&&(k.style.colorScheme=H)}function Y(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(g)U(g);else try{let H=localStorage.getItem(h)||f,re=R&&H==="system"?Y():H;U(re)}catch{}},dQ=ee.createContext(void 0),uQ={setTheme:u=>{},themes:[]},hQ=()=>{var u;return(u=ee.useContext(dQ))!=null?u:uQ};ee.memo(({forcedTheme:u,storageKey:h,attribute:f,enableSystem:g,enableColorScheme:S,defaultTheme:T,value:R,themes:N,nonce:k,scriptProps:x})=>{let U=JSON.stringify([f,h,T,u,N,R,g,S]).slice(1,-1);return ee.createElement("script",{...x,suppressHydrationWarning:!0,nonce:typeof window>"u"?k:"",dangerouslySetInnerHTML:{__html:`(${lQ.toString()})(${U})`}})});var pQ=u=>{switch(u){case"success":return _Q;case"info":return EQ;case"warning":return gQ;case"error":return vQ;default:return null}},fQ=Array(12).fill(0),mQ=({visible:u,className:h})=>st.createElement("div",{className:["sonner-loading-wrapper",h].filter(Boolean).join(" "),"data-visible":u},st.createElement("div",{className:"sonner-spinner"},fQ.map((f,g)=>st.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${g}`})))),_Q=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),gQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),EQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),vQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},st.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),SQ=st.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},st.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),st.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),yQ=()=>{let[u,h]=st.useState(document.hidden);return st.useEffect(()=>{let f=()=>{h(document.hidden)};return document.addEventListener("visibilitychange",f),()=>window.removeEventListener("visibilitychange",f)},[]),u},pA=1,TQ=class{constructor(){this.subscribe=u=>(this.subscribers.push(u),()=>{let h=this.subscribers.indexOf(u);this.subscribers.splice(h,1)}),this.publish=u=>{this.subscribers.forEach(h=>h(u))},this.addToast=u=>{this.publish(u),this.toasts=[...this.toasts,u]},this.create=u=>{var h;let{message:f,...g}=u,S=typeof u?.id=="number"||((h=u.id)==null?void 0:h.length)>0?u.id:pA++,T=this.toasts.find(N=>N.id===S),R=u.dismissible===void 0?!0:u.dismissible;return this.dismissedToasts.has(S)&&this.dismissedToasts.delete(S),T?this.toasts=this.toasts.map(N=>N.id===S?(this.publish({...N,...u,id:S,title:f}),{...N,...u,id:S,dismissible:R,title:f}):N):this.addToast({title:f,...g,dismissible:R,id:S}),S},this.dismiss=u=>(this.dismissedToasts.add(u),u||this.toasts.forEach(h=>{this.subscribers.forEach(f=>f({id:h.id,dismiss:!0}))}),this.subscribers.forEach(h=>h({id:u,dismiss:!0})),u),this.message=(u,h)=>this.create({...h,message:u}),this.error=(u,h)=>this.create({...h,message:u,type:"error"}),this.success=(u,h)=>this.create({...h,type:"success",message:u}),this.info=(u,h)=>this.create({...h,type:"info",message:u}),this.warning=(u,h)=>this.create({...h,type:"warning",message:u}),this.loading=(u,h)=>this.create({...h,type:"loading",message:u}),this.promise=(u,h)=>{if(!h)return;let f;h.loading!==void 0&&(f=this.create({...h,promise:u,type:"loading",message:h.loading,description:typeof h.description!="function"?h.description:void 0}));let g=u instanceof Promise?u:u(),S=f!==void 0,T,R=g.then(async k=>{if(T=["resolve",k],st.isValidElement(k))S=!1,this.create({id:f,type:"default",message:k});else if(wQ(k)&&!k.ok){S=!1;let x=typeof h.error=="function"?await h.error(`HTTP error! status: ${k.status}`):h.error,U=typeof h.description=="function"?await h.description(`HTTP error! status: ${k.status}`):h.description;this.create({id:f,type:"error",message:x,description:U})}else if(h.success!==void 0){S=!1;let x=typeof h.success=="function"?await h.success(k):h.success,U=typeof h.description=="function"?await h.description(k):h.description;this.create({id:f,type:"success",message:x,description:U})}}).catch(async k=>{if(T=["reject",k],h.error!==void 0){S=!1;let x=typeof h.error=="function"?await h.error(k):h.error,U=typeof h.description=="function"?await h.description(k):h.description;this.create({id:f,type:"error",message:x,description:U})}}).finally(()=>{var k;S&&(this.dismiss(f),f=void 0),(k=h.finally)==null||k.call(h)}),N=()=>new Promise((k,x)=>R.then(()=>T[0]==="reject"?x(T[1]):k(T[1])).catch(x));return typeof f!="string"&&typeof f!="number"?{unwrap:N}:Object.assign(f,{unwrap:N})},this.custom=(u,h)=>{let f=h?.id||pA++;return this.create({jsx:u(f),id:f,...h}),f},this.getActiveToasts=()=>this.toasts.filter(u=>!this.dismissedToasts.has(u.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Ls=new TQ,CQ=(u,h)=>{let f=h?.id||pA++;return Ls.addToast({title:u,...h,id:f}),f},wQ=u=>u&&typeof u=="object"&&"ok"in u&&typeof u.ok=="boolean"&&"status"in u&&typeof u.status=="number",RQ=CQ,bQ=()=>Ls.toasts,IQ=()=>Ls.getActiveToasts();Object.assign(RQ,{success:Ls.success,info:Ls.info,warning:Ls.warning,error:Ls.error,custom:Ls.custom,message:Ls.message,promise:Ls.promise,dismiss:Ls.dismiss,loading:Ls.loading},{getHistory:bQ,getToasts:IQ});function AQ(u,{insertAt:h}={}){if(typeof document>"u")return;let f=document.head||document.getElementsByTagName("head")[0],g=document.createElement("style");g.type="text/css",h==="top"&&f.firstChild?f.insertBefore(g,f.firstChild):f.appendChild(g),g.styleSheet?g.styleSheet.cssText=u:g.appendChild(document.createTextNode(u))}AQ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function QT(u){return u.label!==void 0}var OQ=3,NQ="32px",PQ="16px",y4=4e3,kQ=356,DQ=14,LQ=20,xQ=200;function Pa(...u){return u.filter(Boolean).join(" ")}function MQ(u){let[h,f]=u.split("-"),g=[];return h&&g.push(h),f&&g.push(f),g}var UQ=u=>{var h,f,g,S,T,R,N,k,x,U,B;let{invert:Y,toast:H,unstyled:re,interacting:X,setHeights:te,visibleToasts:ce,heights:$,index:le,toasts:ne,expanded:ue,removeToast:Pe,defaultRichColors:he,closeButton:de,style:ye,cancelButtonStyle:Me,actionButtonStyle:Je,className:Ve="",descriptionClassName:xe="",duration:He,position:dt,gap:Qe,loadingIcon:Ge,expandByDefault:Ie,classNames:ke,icons:Ye,closeButtonAriaLabel:_e="Close toast",pauseWhenPageIsHidden:De}=u,[ct,at]=st.useState(null),[Ot,Gt]=st.useState(null),[yt,pn]=st.useState(!1),[vn,or]=st.useState(!1),[hs,Ua]=st.useState(!1),[zr,eu]=st.useState(!1),[Bh,ps]=st.useState(!1),[tu,fr]=st.useState(0),[Qr,fo]=st.useState(0),Di=st.useRef(H.duration||He||y4),bl=st.useRef(null),Ms=st.useRef(null),Or=le===0,nu=le+1<=ce,li=H.type,Yr=H.dismissible!==!1,Uc=H.className||"",Il=H.descriptionClassName||"",Us=st.useMemo(()=>$.findIndex(Kt=>Kt.toastId===H.id)||0,[$,H.id]),Va=st.useMemo(()=>{var Kt;return(Kt=H.closeButton)!=null?Kt:de},[H.closeButton,de]),ru=st.useMemo(()=>H.duration||He||y4,[H.duration,He]),Vc=st.useRef(0),Ti=st.useRef(0),iu=st.useRef(0),mo=st.useRef(null),[su,_o]=dt.split("-"),jc=st.useMemo(()=>$.reduce((Kt,fn,Fn)=>Fn>=Us?Kt:Kt+fn.height,0),[$,Us]),Al=yQ(),ja=H.invert||Y,go=li==="loading";Ti.current=st.useMemo(()=>Us*Qe+jc,[Us,jc]),st.useEffect(()=>{Di.current=ru},[ru]),st.useEffect(()=>{pn(!0)},[]),st.useEffect(()=>{let Kt=Ms.current;if(Kt){let fn=Kt.getBoundingClientRect().height;return fo(fn),te(Fn=>[{toastId:H.id,height:fn,position:H.position},...Fn]),()=>te(Fn=>Fn.filter(Ci=>Ci.toastId!==H.id))}},[te,H.id]),st.useLayoutEffect(()=>{if(!yt)return;let Kt=Ms.current,fn=Kt.style.height;Kt.style.height="auto";let Fn=Kt.getBoundingClientRect().height;Kt.style.height=fn,fo(Fn),te(Ci=>Ci.find(Li=>Li.toastId===H.id)?Ci.map(Li=>Li.toastId===H.id?{...Li,height:Fn}:Li):[{toastId:H.id,height:Fn,position:H.position},...Ci])},[yt,H.title,H.description,te,H.id]);let Vs=st.useCallback(()=>{or(!0),fr(Ti.current),te(Kt=>Kt.filter(fn=>fn.toastId!==H.id)),setTimeout(()=>{Pe(H)},xQ)},[H,Pe,te,Ti]);st.useEffect(()=>{if(H.promise&&li==="loading"||H.duration===1/0||H.type==="loading")return;let Kt;return ue||X||De&&Al?(()=>{if(iu.current<Vc.current){let fn=new Date().getTime()-Vc.current;Di.current=Di.current-fn}iu.current=new Date().getTime()})():Di.current!==1/0&&(Vc.current=new Date().getTime(),Kt=setTimeout(()=>{var fn;(fn=H.onAutoClose)==null||fn.call(H,H),Vs()},Di.current)),()=>clearTimeout(Kt)},[ue,X,H,li,De,Al,Vs]),st.useEffect(()=>{H.delete&&Vs()},[Vs,H.delete]);function Fa(){var Kt,fn,Fn;return Ye!=null&&Ye.loading?st.createElement("div",{className:Pa(ke?.loader,(Kt=H?.classNames)==null?void 0:Kt.loader,"sonner-loader"),"data-visible":li==="loading"},Ye.loading):Ge?st.createElement("div",{className:Pa(ke?.loader,(fn=H?.classNames)==null?void 0:fn.loader,"sonner-loader"),"data-visible":li==="loading"},Ge):st.createElement(mQ,{className:Pa(ke?.loader,(Fn=H?.classNames)==null?void 0:Fn.loader),visible:li==="loading"})}return st.createElement("li",{tabIndex:0,ref:Ms,className:Pa(Ve,Uc,ke?.toast,(h=H?.classNames)==null?void 0:h.toast,ke?.default,ke?.[li],(f=H?.classNames)==null?void 0:f[li]),"data-sonner-toast":"","data-rich-colors":(g=H.richColors)!=null?g:he,"data-styled":!(H.jsx||H.unstyled||re),"data-mounted":yt,"data-promise":!!H.promise,"data-swiped":Bh,"data-removed":vn,"data-visible":nu,"data-y-position":su,"data-x-position":_o,"data-index":le,"data-front":Or,"data-swiping":hs,"data-dismissible":Yr,"data-type":li,"data-invert":ja,"data-swipe-out":zr,"data-swipe-direction":Ot,"data-expanded":!!(ue||Ie&&yt),style:{"--index":le,"--toasts-before":le,"--z-index":ne.length-le,"--offset":`${vn?tu:Ti.current}px`,"--initial-height":Ie?"auto":`${Qr}px`,...ye,...H.style},onDragEnd:()=>{Ua(!1),at(null),mo.current=null},onPointerDown:Kt=>{go||!Yr||(bl.current=new Date,fr(Ti.current),Kt.target.setPointerCapture(Kt.pointerId),Kt.target.tagName!=="BUTTON"&&(Ua(!0),mo.current={x:Kt.clientX,y:Kt.clientY}))},onPointerUp:()=>{var Kt,fn,Fn,Ci;if(zr||!Yr)return;mo.current=null;let Li=Number(((Kt=Ms.current)==null?void 0:Kt.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Bn=Number(((fn=Ms.current)==null?void 0:fn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),js=new Date().getTime()-((Fn=bl.current)==null?void 0:Fn.getTime()),$r=ct==="x"?Li:Bn,Xi=Math.abs($r)/js;if(Math.abs($r)>=LQ||Xi>.11){fr(Ti.current),(Ci=H.onDismiss)==null||Ci.call(H,H),Gt(ct==="x"?Li>0?"right":"left":Bn>0?"down":"up"),Vs(),eu(!0),ps(!1);return}Ua(!1),at(null)},onPointerMove:Kt=>{var fn,Fn,Ci,Li;if(!mo.current||!Yr||((fn=window.getSelection())==null?void 0:fn.toString().length)>0)return;let Bn=Kt.clientY-mo.current.y,js=Kt.clientX-mo.current.x,$r=(Fn=u.swipeDirections)!=null?Fn:MQ(dt);!ct&&(Math.abs(js)>1||Math.abs(Bn)>1)&&at(Math.abs(js)>Math.abs(Bn)?"x":"y");let Xi={x:0,y:0};ct==="y"?($r.includes("top")||$r.includes("bottom"))&&($r.includes("top")&&Bn<0||$r.includes("bottom")&&Bn>0)&&(Xi.y=Bn):ct==="x"&&($r.includes("left")||$r.includes("right"))&&($r.includes("left")&&js<0||$r.includes("right")&&js>0)&&(Xi.x=js),(Math.abs(Xi.x)>0||Math.abs(Xi.y)>0)&&ps(!0),(Ci=Ms.current)==null||Ci.style.setProperty("--swipe-amount-x",`${Xi.x}px`),(Li=Ms.current)==null||Li.style.setProperty("--swipe-amount-y",`${Xi.y}px`)}},Va&&!H.jsx?st.createElement("button",{"aria-label":_e,"data-disabled":go,"data-close-button":!0,onClick:go||!Yr?()=>{}:()=>{var Kt;Vs(),(Kt=H.onDismiss)==null||Kt.call(H,H)},className:Pa(ke?.closeButton,(S=H?.classNames)==null?void 0:S.closeButton)},(T=Ye?.close)!=null?T:SQ):null,H.jsx||ee.isValidElement(H.title)?H.jsx?H.jsx:typeof H.title=="function"?H.title():H.title:st.createElement(st.Fragment,null,li||H.icon||H.promise?st.createElement("div",{"data-icon":"",className:Pa(ke?.icon,(R=H?.classNames)==null?void 0:R.icon)},H.promise||H.type==="loading"&&!H.icon?H.icon||Fa():null,H.type!=="loading"?H.icon||Ye?.[li]||pQ(li):null):null,st.createElement("div",{"data-content":"",className:Pa(ke?.content,(N=H?.classNames)==null?void 0:N.content)},st.createElement("div",{"data-title":"",className:Pa(ke?.title,(k=H?.classNames)==null?void 0:k.title)},typeof H.title=="function"?H.title():H.title),H.description?st.createElement("div",{"data-description":"",className:Pa(xe,Il,ke?.description,(x=H?.classNames)==null?void 0:x.description)},typeof H.description=="function"?H.description():H.description):null),ee.isValidElement(H.cancel)?H.cancel:H.cancel&&QT(H.cancel)?st.createElement("button",{"data-button":!0,"data-cancel":!0,style:H.cancelButtonStyle||Me,onClick:Kt=>{var fn,Fn;QT(H.cancel)&&Yr&&((Fn=(fn=H.cancel).onClick)==null||Fn.call(fn,Kt),Vs())},className:Pa(ke?.cancelButton,(U=H?.classNames)==null?void 0:U.cancelButton)},H.cancel.label):null,ee.isValidElement(H.action)?H.action:H.action&&QT(H.action)?st.createElement("button",{"data-button":!0,"data-action":!0,style:H.actionButtonStyle||Je,onClick:Kt=>{var fn,Fn;QT(H.action)&&((Fn=(fn=H.action).onClick)==null||Fn.call(fn,Kt),!Kt.defaultPrevented&&Vs())},className:Pa(ke?.actionButton,(B=H?.classNames)==null?void 0:B.actionButton)},H.action.label):null))};function T4(){if(typeof window>"u"||typeof document>"u")return"ltr";let u=document.documentElement.getAttribute("dir");return u==="auto"||!u?window.getComputedStyle(document.documentElement).direction:u}function VQ(u,h){let f={};return[u,h].forEach((g,S)=>{let T=S===1,R=T?"--mobile-offset":"--offset",N=T?PQ:NQ;function k(x){["top","right","bottom","left"].forEach(U=>{f[`${R}-${U}`]=typeof x=="number"?`${x}px`:x})}typeof g=="number"||typeof g=="string"?k(g):typeof g=="object"?["top","right","bottom","left"].forEach(x=>{g[x]===void 0?f[`${R}-${x}`]=N:f[`${R}-${x}`]=typeof g[x]=="number"?`${g[x]}px`:g[x]}):k(N)}),f}var jQ=ee.forwardRef(function(u,h){let{invert:f,position:g="bottom-right",hotkey:S=["altKey","KeyT"],expand:T,closeButton:R,className:N,offset:k,mobileOffset:x,theme:U="light",richColors:B,duration:Y,style:H,visibleToasts:re=OQ,toastOptions:X,dir:te=T4(),gap:ce=DQ,loadingIcon:$,icons:le,containerAriaLabel:ne="Notifications",pauseWhenPageIsHidden:ue}=u,[Pe,he]=st.useState([]),de=st.useMemo(()=>Array.from(new Set([g].concat(Pe.filter(De=>De.position).map(De=>De.position)))),[Pe,g]),[ye,Me]=st.useState([]),[Je,Ve]=st.useState(!1),[xe,He]=st.useState(!1),[dt,Qe]=st.useState(U!=="system"?U:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ge=st.useRef(null),Ie=S.join("+").replace(/Key/g,"").replace(/Digit/g,""),ke=st.useRef(null),Ye=st.useRef(!1),_e=st.useCallback(De=>{he(ct=>{var at;return(at=ct.find(Ot=>Ot.id===De.id))!=null&&at.delete||Ls.dismiss(De.id),ct.filter(({id:Ot})=>Ot!==De.id)})},[]);return st.useEffect(()=>Ls.subscribe(De=>{if(De.dismiss){he(ct=>ct.map(at=>at.id===De.id?{...at,delete:!0}:at));return}setTimeout(()=>{mj.flushSync(()=>{he(ct=>{let at=ct.findIndex(Ot=>Ot.id===De.id);return at!==-1?[...ct.slice(0,at),{...ct[at],...De},...ct.slice(at+1)]:[De,...ct]})})})}),[]),st.useEffect(()=>{if(U!=="system"){Qe(U);return}if(U==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Qe("dark"):Qe("light")),typeof window>"u")return;let De=window.matchMedia("(prefers-color-scheme: dark)");try{De.addEventListener("change",({matches:ct})=>{Qe(ct?"dark":"light")})}catch{De.addListener(({matches:at})=>{try{Qe(at?"dark":"light")}catch(Ot){console.error(Ot)}})}},[U]),st.useEffect(()=>{Pe.length<=1&&Ve(!1)},[Pe]),st.useEffect(()=>{let De=ct=>{var at,Ot;S.every(Gt=>ct[Gt]||ct.code===Gt)&&(Ve(!0),(at=Ge.current)==null||at.focus()),ct.code==="Escape"&&(document.activeElement===Ge.current||(Ot=Ge.current)!=null&&Ot.contains(document.activeElement))&&Ve(!1)};return document.addEventListener("keydown",De),()=>document.removeEventListener("keydown",De)},[S]),st.useEffect(()=>{if(Ge.current)return()=>{ke.current&&(ke.current.focus({preventScroll:!0}),ke.current=null,Ye.current=!1)}},[Ge.current]),st.createElement("section",{ref:h,"aria-label":`${ne} ${Ie}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},de.map((De,ct)=>{var at;let[Ot,Gt]=De.split("-");return Pe.length?st.createElement("ol",{key:De,dir:te==="auto"?T4():te,tabIndex:-1,ref:Ge,className:N,"data-sonner-toaster":!0,"data-theme":dt,"data-y-position":Ot,"data-lifted":Je&&Pe.length>1&&!T,"data-x-position":Gt,style:{"--front-toast-height":`${((at=ye[0])==null?void 0:at.height)||0}px`,"--width":`${kQ}px`,"--gap":`${ce}px`,...H,...VQ(k,x)},onBlur:yt=>{Ye.current&&!yt.currentTarget.contains(yt.relatedTarget)&&(Ye.current=!1,ke.current&&(ke.current.focus({preventScroll:!0}),ke.current=null))},onFocus:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||Ye.current||(Ye.current=!0,ke.current=yt.relatedTarget)},onMouseEnter:()=>Ve(!0),onMouseMove:()=>Ve(!0),onMouseLeave:()=>{xe||Ve(!1)},onDragEnd:()=>Ve(!1),onPointerDown:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||He(!0)},onPointerUp:()=>He(!1)},Pe.filter(yt=>!yt.position&&ct===0||yt.position===De).map((yt,pn)=>{var vn,or;return st.createElement(UQ,{key:yt.id,icons:le,index:pn,toast:yt,defaultRichColors:B,duration:(vn=X?.duration)!=null?vn:Y,className:X?.className,descriptionClassName:X?.descriptionClassName,invert:f,visibleToasts:re,closeButton:(or=X?.closeButton)!=null?or:R,interacting:xe,position:De,style:X?.style,unstyled:X?.unstyled,classNames:X?.classNames,cancelButtonStyle:X?.cancelButtonStyle,actionButtonStyle:X?.actionButtonStyle,removeToast:_e,toasts:Pe.filter(hs=>hs.position==yt.position),heights:ye.filter(hs=>hs.position==yt.position),setHeights:Me,expandByDefault:T,gap:ce,loadingIcon:$,expanded:Je,pauseWhenPageIsHidden:ue,swipeDirections:u.swipeDirections})})):null}))});const FQ=({...u})=>{const{theme:h="system"}=hQ();return O.jsx(jQ,{theme:h,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...u})},BQ=["top","right","bottom","left"],Jd=Math.min,lo=Math.max,p0=Math.round,$T=Math.floor,Lc=u=>({x:u,y:u}),WQ={left:"right",right:"left",bottom:"top",top:"bottom"},GQ={start:"end",end:"start"};function fA(u,h,f){return lo(u,Jd(h,f))}function wl(u,h){return typeof u=="function"?u(h):u}function Rl(u){return u.split("-")[0]}function um(u){return u.split("-")[1]}function DA(u){return u==="x"?"y":"x"}function LA(u){return u==="y"?"height":"width"}const HQ=new Set(["top","bottom"]);function Dc(u){return HQ.has(Rl(u))?"y":"x"}function xA(u){return DA(Dc(u))}function KQ(u,h,f){f===void 0&&(f=!1);const g=um(u),S=xA(u),T=LA(S);let R=S==="x"?g===(f?"end":"start")?"right":"left":g==="start"?"bottom":"top";return h.reference[T]>h.floating[T]&&(R=f0(R)),[R,f0(R)]}function zQ(u){const h=f0(u);return[mA(u),h,mA(h)]}function mA(u){return u.replace(/start|end/g,h=>GQ[h])}const C4=["left","right"],w4=["right","left"],YQ=["top","bottom"],qQ=["bottom","top"];function XQ(u,h,f){switch(u){case"top":case"bottom":return f?h?w4:C4:h?C4:w4;case"left":case"right":return h?YQ:qQ;default:return[]}}function JQ(u,h,f,g){const S=um(u);let T=XQ(Rl(u),f==="start",g);return S&&(T=T.map(R=>R+"-"+S),h&&(T=T.concat(T.map(mA)))),T}function f0(u){return u.replace(/left|right|bottom|top/g,h=>WQ[h])}function QQ(u){return{top:0,right:0,bottom:0,left:0,...u}}function r8(u){return typeof u!="number"?QQ(u):{top:u,right:u,bottom:u,left:u}}function m0(u){const{x:h,y:f,width:g,height:S}=u;return{width:g,height:S,top:f,left:h,right:h+g,bottom:f+S,x:h,y:f}}function R4(u,h,f){let{reference:g,floating:S}=u;const T=Dc(h),R=xA(h),N=LA(R),k=Rl(h),x=T==="y",U=g.x+g.width/2-S.width/2,B=g.y+g.height/2-S.height/2,Y=g[N]/2-S[N]/2;let H;switch(k){case"top":H={x:U,y:g.y-S.height};break;case"bottom":H={x:U,y:g.y+g.height};break;case"right":H={x:g.x+g.width,y:B};break;case"left":H={x:g.x-S.width,y:B};break;default:H={x:g.x,y:g.y}}switch(um(h)){case"start":H[R]-=Y*(f&&x?-1:1);break;case"end":H[R]+=Y*(f&&x?-1:1);break}return H}const $Q=async(u,h,f)=>{const{placement:g="bottom",strategy:S="absolute",middleware:T=[],platform:R}=f,N=T.filter(Boolean),k=await(R.isRTL==null?void 0:R.isRTL(h));let x=await R.getElementRects({reference:u,floating:h,strategy:S}),{x:U,y:B}=R4(x,g,k),Y=g,H={},re=0;for(let X=0;X<N.length;X++){const{name:te,fn:ce}=N[X],{x:$,y:le,data:ne,reset:ue}=await ce({x:U,y:B,initialPlacement:g,placement:Y,strategy:S,middlewareData:H,rects:x,platform:R,elements:{reference:u,floating:h}});U=$??U,B=le??B,H={...H,[te]:{...H[te],...ne}},ue&&re<=50&&(re++,typeof ue=="object"&&(ue.placement&&(Y=ue.placement),ue.rects&&(x=ue.rects===!0?await R.getElementRects({reference:u,floating:h,strategy:S}):ue.rects),{x:U,y:B}=R4(x,Y,k)),X=-1)}return{x:U,y:B,placement:Y,strategy:S,middlewareData:H}};async function OE(u,h){var f;h===void 0&&(h={});const{x:g,y:S,platform:T,rects:R,elements:N,strategy:k}=u,{boundary:x="clippingAncestors",rootBoundary:U="viewport",elementContext:B="floating",altBoundary:Y=!1,padding:H=0}=wl(h,u),re=r8(H),te=N[Y?B==="floating"?"reference":"floating":B],ce=m0(await T.getClippingRect({element:(f=await(T.isElement==null?void 0:T.isElement(te)))==null||f?te:te.contextElement||await(T.getDocumentElement==null?void 0:T.getDocumentElement(N.floating)),boundary:x,rootBoundary:U,strategy:k})),$=B==="floating"?{x:g,y:S,width:R.floating.width,height:R.floating.height}:R.reference,le=await(T.getOffsetParent==null?void 0:T.getOffsetParent(N.floating)),ne=await(T.isElement==null?void 0:T.isElement(le))?await(T.getScale==null?void 0:T.getScale(le))||{x:1,y:1}:{x:1,y:1},ue=m0(T.convertOffsetParentRelativeRectToViewportRelativeRect?await T.convertOffsetParentRelativeRectToViewportRelativeRect({elements:N,rect:$,offsetParent:le,strategy:k}):$);return{top:(ce.top-ue.top+re.top)/ne.y,bottom:(ue.bottom-ce.bottom+re.bottom)/ne.y,left:(ce.left-ue.left+re.left)/ne.x,right:(ue.right-ce.right+re.right)/ne.x}}const ZQ=u=>({name:"arrow",options:u,async fn(h){const{x:f,y:g,placement:S,rects:T,platform:R,elements:N,middlewareData:k}=h,{element:x,padding:U=0}=wl(u,h)||{};if(x==null)return{};const B=r8(U),Y={x:f,y:g},H=xA(S),re=LA(H),X=await R.getDimensions(x),te=H==="y",ce=te?"top":"left",$=te?"bottom":"right",le=te?"clientHeight":"clientWidth",ne=T.reference[re]+T.reference[H]-Y[H]-T.floating[re],ue=Y[H]-T.reference[H],Pe=await(R.getOffsetParent==null?void 0:R.getOffsetParent(x));let he=Pe?Pe[le]:0;(!he||!await(R.isElement==null?void 0:R.isElement(Pe)))&&(he=N.floating[le]||T.floating[re]);const de=ne/2-ue/2,ye=he/2-X[re]/2-1,Me=Jd(B[ce],ye),Je=Jd(B[$],ye),Ve=Me,xe=he-X[re]-Je,He=he/2-X[re]/2+de,dt=fA(Ve,He,xe),Qe=!k.arrow&&um(S)!=null&&He!==dt&&T.reference[re]/2-(He<Ve?Me:Je)-X[re]/2<0,Ge=Qe?He<Ve?He-Ve:He-xe:0;return{[H]:Y[H]+Ge,data:{[H]:dt,centerOffset:He-dt-Ge,...Qe&&{alignmentOffset:Ge}},reset:Qe}}}),e$=function(u){return u===void 0&&(u={}),{name:"flip",options:u,async fn(h){var f,g;const{placement:S,middlewareData:T,rects:R,initialPlacement:N,platform:k,elements:x}=h,{mainAxis:U=!0,crossAxis:B=!0,fallbackPlacements:Y,fallbackStrategy:H="bestFit",fallbackAxisSideDirection:re="none",flipAlignment:X=!0,...te}=wl(u,h);if((f=T.arrow)!=null&&f.alignmentOffset)return{};const ce=Rl(S),$=Dc(N),le=Rl(N)===N,ne=await(k.isRTL==null?void 0:k.isRTL(x.floating)),ue=Y||(le||!X?[f0(N)]:zQ(N)),Pe=re!=="none";!Y&&Pe&&ue.push(...JQ(N,X,re,ne));const he=[N,...ue],de=await OE(h,te),ye=[];let Me=((g=T.flip)==null?void 0:g.overflows)||[];if(U&&ye.push(de[ce]),B){const He=KQ(S,R,ne);ye.push(de[He[0]],de[He[1]])}if(Me=[...Me,{placement:S,overflows:ye}],!ye.every(He=>He<=0)){var Je,Ve;const He=(((Je=T.flip)==null?void 0:Je.index)||0)+1,dt=he[He];if(dt&&(!(B==="alignment"?$!==Dc(dt):!1)||Me.every(Ie=>Dc(Ie.placement)===$?Ie.overflows[0]>0:!0)))return{data:{index:He,overflows:Me},reset:{placement:dt}};let Qe=(Ve=Me.filter(Ge=>Ge.overflows[0]<=0).sort((Ge,Ie)=>Ge.overflows[1]-Ie.overflows[1])[0])==null?void 0:Ve.placement;if(!Qe)switch(H){case"bestFit":{var xe;const Ge=(xe=Me.filter(Ie=>{if(Pe){const ke=Dc(Ie.placement);return ke===$||ke==="y"}return!0}).map(Ie=>[Ie.placement,Ie.overflows.filter(ke=>ke>0).reduce((ke,Ye)=>ke+Ye,0)]).sort((Ie,ke)=>Ie[1]-ke[1])[0])==null?void 0:xe[0];Ge&&(Qe=Ge);break}case"initialPlacement":Qe=N;break}if(S!==Qe)return{reset:{placement:Qe}}}return{}}}};function b4(u,h){return{top:u.top-h.height,right:u.right-h.width,bottom:u.bottom-h.height,left:u.left-h.width}}function I4(u){return BQ.some(h=>u[h]>=0)}const t$=function(u){return u===void 0&&(u={}),{name:"hide",options:u,async fn(h){const{rects:f}=h,{strategy:g="referenceHidden",...S}=wl(u,h);switch(g){case"referenceHidden":{const T=await OE(h,{...S,elementContext:"reference"}),R=b4(T,f.reference);return{data:{referenceHiddenOffsets:R,referenceHidden:I4(R)}}}case"escaped":{const T=await OE(h,{...S,altBoundary:!0}),R=b4(T,f.floating);return{data:{escapedOffsets:R,escaped:I4(R)}}}default:return{}}}}},i8=new Set(["left","top"]);async function n$(u,h){const{placement:f,platform:g,elements:S}=u,T=await(g.isRTL==null?void 0:g.isRTL(S.floating)),R=Rl(f),N=um(f),k=Dc(f)==="y",x=i8.has(R)?-1:1,U=T&&k?-1:1,B=wl(h,u);let{mainAxis:Y,crossAxis:H,alignmentAxis:re}=typeof B=="number"?{mainAxis:B,crossAxis:0,alignmentAxis:null}:{mainAxis:B.mainAxis||0,crossAxis:B.crossAxis||0,alignmentAxis:B.alignmentAxis};return N&&typeof re=="number"&&(H=N==="end"?re*-1:re),k?{x:H*U,y:Y*x}:{x:Y*x,y:H*U}}const r$=function(u){return u===void 0&&(u=0),{name:"offset",options:u,async fn(h){var f,g;const{x:S,y:T,placement:R,middlewareData:N}=h,k=await n$(h,u);return R===((f=N.offset)==null?void 0:f.placement)&&(g=N.arrow)!=null&&g.alignmentOffset?{}:{x:S+k.x,y:T+k.y,data:{...k,placement:R}}}}},i$=function(u){return u===void 0&&(u={}),{name:"shift",options:u,async fn(h){const{x:f,y:g,placement:S}=h,{mainAxis:T=!0,crossAxis:R=!1,limiter:N={fn:te=>{let{x:ce,y:$}=te;return{x:ce,y:$}}},...k}=wl(u,h),x={x:f,y:g},U=await OE(h,k),B=Dc(Rl(S)),Y=DA(B);let H=x[Y],re=x[B];if(T){const te=Y==="y"?"top":"left",ce=Y==="y"?"bottom":"right",$=H+U[te],le=H-U[ce];H=fA($,H,le)}if(R){const te=B==="y"?"top":"left",ce=B==="y"?"bottom":"right",$=re+U[te],le=re-U[ce];re=fA($,re,le)}const X=N.fn({...h,[Y]:H,[B]:re});return{...X,data:{x:X.x-f,y:X.y-g,enabled:{[Y]:T,[B]:R}}}}}},s$=function(u){return u===void 0&&(u={}),{options:u,fn(h){const{x:f,y:g,placement:S,rects:T,middlewareData:R}=h,{offset:N=0,mainAxis:k=!0,crossAxis:x=!0}=wl(u,h),U={x:f,y:g},B=Dc(S),Y=DA(B);let H=U[Y],re=U[B];const X=wl(N,h),te=typeof X=="number"?{mainAxis:X,crossAxis:0}:{mainAxis:0,crossAxis:0,...X};if(k){const le=Y==="y"?"height":"width",ne=T.reference[Y]-T.floating[le]+te.mainAxis,ue=T.reference[Y]+T.reference[le]-te.mainAxis;H<ne?H=ne:H>ue&&(H=ue)}if(x){var ce,$;const le=Y==="y"?"width":"height",ne=i8.has(Rl(S)),ue=T.reference[B]-T.floating[le]+(ne&&((ce=R.offset)==null?void 0:ce[B])||0)+(ne?0:te.crossAxis),Pe=T.reference[B]+T.reference[le]+(ne?0:(($=R.offset)==null?void 0:$[B])||0)-(ne?te.crossAxis:0);re<ue?re=ue:re>Pe&&(re=Pe)}return{[Y]:H,[B]:re}}}},o$=function(u){return u===void 0&&(u={}),{name:"size",options:u,async fn(h){var f,g;const{placement:S,rects:T,platform:R,elements:N}=h,{apply:k=()=>{},...x}=wl(u,h),U=await OE(h,x),B=Rl(S),Y=um(S),H=Dc(S)==="y",{width:re,height:X}=T.floating;let te,ce;B==="top"||B==="bottom"?(te=B,ce=Y===(await(R.isRTL==null?void 0:R.isRTL(N.floating))?"start":"end")?"left":"right"):(ce=B,te=Y==="end"?"top":"bottom");const $=X-U.top-U.bottom,le=re-U.left-U.right,ne=Jd(X-U[te],$),ue=Jd(re-U[ce],le),Pe=!h.middlewareData.shift;let he=ne,de=ue;if((f=h.middlewareData.shift)!=null&&f.enabled.x&&(de=le),(g=h.middlewareData.shift)!=null&&g.enabled.y&&(he=$),Pe&&!Y){const Me=lo(U.left,0),Je=lo(U.right,0),Ve=lo(U.top,0),xe=lo(U.bottom,0);H?de=re-2*(Me!==0||Je!==0?Me+Je:lo(U.left,U.right)):he=X-2*(Ve!==0||xe!==0?Ve+xe:lo(U.top,U.bottom))}await k({...h,availableWidth:de,availableHeight:he});const ye=await R.getDimensions(N.floating);return re!==ye.width||X!==ye.height?{reset:{rects:!0}}:{}}}};function R0(){return typeof window<"u"}function hm(u){return s8(u)?(u.nodeName||"").toLowerCase():"#document"}function ho(u){var h;return(u==null||(h=u.ownerDocument)==null?void 0:h.defaultView)||window}function Mc(u){var h;return(h=(s8(u)?u.ownerDocument:u.document)||window.document)==null?void 0:h.documentElement}function s8(u){return R0()?u instanceof Node||u instanceof ho(u).Node:!1}function xa(u){return R0()?u instanceof Element||u instanceof ho(u).Element:!1}function xc(u){return R0()?u instanceof HTMLElement||u instanceof ho(u).HTMLElement:!1}function A4(u){return!R0()||typeof ShadowRoot>"u"?!1:u instanceof ShadowRoot||u instanceof ho(u).ShadowRoot}const a$=new Set(["inline","contents"]);function jE(u){const{overflow:h,overflowX:f,overflowY:g,display:S}=Ma(u);return/auto|scroll|overlay|hidden|clip/.test(h+g+f)&&!a$.has(S)}const c$=new Set(["table","td","th"]);function l$(u){return c$.has(hm(u))}const d$=[":popover-open",":modal"];function b0(u){return d$.some(h=>{try{return u.matches(h)}catch{return!1}})}const u$=["transform","translate","scale","rotate","perspective"],h$=["transform","translate","scale","rotate","perspective","filter"],p$=["paint","layout","strict","content"];function MA(u){const h=UA(),f=xa(u)?Ma(u):u;return u$.some(g=>f[g]?f[g]!=="none":!1)||(f.containerType?f.containerType!=="normal":!1)||!h&&(f.backdropFilter?f.backdropFilter!=="none":!1)||!h&&(f.filter?f.filter!=="none":!1)||h$.some(g=>(f.willChange||"").includes(g))||p$.some(g=>(f.contain||"").includes(g))}function f$(u){let h=Qd(u);for(;xc(h)&&!om(h);){if(MA(h))return h;if(b0(h))return null;h=Qd(h)}return null}function UA(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const m$=new Set(["html","body","#document"]);function om(u){return m$.has(hm(u))}function Ma(u){return ho(u).getComputedStyle(u)}function I0(u){return xa(u)?{scrollLeft:u.scrollLeft,scrollTop:u.scrollTop}:{scrollLeft:u.scrollX,scrollTop:u.scrollY}}function Qd(u){if(hm(u)==="html")return u;const h=u.assignedSlot||u.parentNode||A4(u)&&u.host||Mc(u);return A4(h)?h.host:h}function o8(u){const h=Qd(u);return om(h)?u.ownerDocument?u.ownerDocument.body:u.body:xc(h)&&jE(h)?h:o8(h)}function NE(u,h,f){var g;h===void 0&&(h=[]),f===void 0&&(f=!0);const S=o8(u),T=S===((g=u.ownerDocument)==null?void 0:g.body),R=ho(S);if(T){const N=_A(R);return h.concat(R,R.visualViewport||[],jE(S)?S:[],N&&f?NE(N):[])}return h.concat(S,NE(S,[],f))}function _A(u){return u.parent&&Object.getPrototypeOf(u.parent)?u.frameElement:null}function a8(u){const h=Ma(u);let f=parseFloat(h.width)||0,g=parseFloat(h.height)||0;const S=xc(u),T=S?u.offsetWidth:f,R=S?u.offsetHeight:g,N=p0(f)!==T||p0(g)!==R;return N&&(f=T,g=R),{width:f,height:g,$:N}}function VA(u){return xa(u)?u:u.contextElement}function sm(u){const h=VA(u);if(!xc(h))return Lc(1);const f=h.getBoundingClientRect(),{width:g,height:S,$:T}=a8(h);let R=(T?p0(f.width):f.width)/g,N=(T?p0(f.height):f.height)/S;return(!R||!Number.isFinite(R))&&(R=1),(!N||!Number.isFinite(N))&&(N=1),{x:R,y:N}}const _$=Lc(0);function c8(u){const h=ho(u);return!UA()||!h.visualViewport?_$:{x:h.visualViewport.offsetLeft,y:h.visualViewport.offsetTop}}function g$(u,h,f){return h===void 0&&(h=!1),!f||h&&f!==ho(u)?!1:h}function jh(u,h,f,g){h===void 0&&(h=!1),f===void 0&&(f=!1);const S=u.getBoundingClientRect(),T=VA(u);let R=Lc(1);h&&(g?xa(g)&&(R=sm(g)):R=sm(u));const N=g$(T,f,g)?c8(T):Lc(0);let k=(S.left+N.x)/R.x,x=(S.top+N.y)/R.y,U=S.width/R.x,B=S.height/R.y;if(T){const Y=ho(T),H=g&&xa(g)?ho(g):g;let re=Y,X=_A(re);for(;X&&g&&H!==re;){const te=sm(X),ce=X.getBoundingClientRect(),$=Ma(X),le=ce.left+(X.clientLeft+parseFloat($.paddingLeft))*te.x,ne=ce.top+(X.clientTop+parseFloat($.paddingTop))*te.y;k*=te.x,x*=te.y,U*=te.x,B*=te.y,k+=le,x+=ne,re=ho(X),X=_A(re)}}return m0({width:U,height:B,x:k,y:x})}function jA(u,h){const f=I0(u).scrollLeft;return h?h.left+f:jh(Mc(u)).left+f}function l8(u,h,f){f===void 0&&(f=!1);const g=u.getBoundingClientRect(),S=g.left+h.scrollLeft-(f?0:jA(u,g)),T=g.top+h.scrollTop;return{x:S,y:T}}function E$(u){let{elements:h,rect:f,offsetParent:g,strategy:S}=u;const T=S==="fixed",R=Mc(g),N=h?b0(h.floating):!1;if(g===R||N&&T)return f;let k={scrollLeft:0,scrollTop:0},x=Lc(1);const U=Lc(0),B=xc(g);if((B||!B&&!T)&&((hm(g)!=="body"||jE(R))&&(k=I0(g)),xc(g))){const H=jh(g);x=sm(g),U.x=H.x+g.clientLeft,U.y=H.y+g.clientTop}const Y=R&&!B&&!T?l8(R,k,!0):Lc(0);return{width:f.width*x.x,height:f.height*x.y,x:f.x*x.x-k.scrollLeft*x.x+U.x+Y.x,y:f.y*x.y-k.scrollTop*x.y+U.y+Y.y}}function v$(u){return Array.from(u.getClientRects())}function S$(u){const h=Mc(u),f=I0(u),g=u.ownerDocument.body,S=lo(h.scrollWidth,h.clientWidth,g.scrollWidth,g.clientWidth),T=lo(h.scrollHeight,h.clientHeight,g.scrollHeight,g.clientHeight);let R=-f.scrollLeft+jA(u);const N=-f.scrollTop;return Ma(g).direction==="rtl"&&(R+=lo(h.clientWidth,g.clientWidth)-S),{width:S,height:T,x:R,y:N}}function y$(u,h){const f=ho(u),g=Mc(u),S=f.visualViewport;let T=g.clientWidth,R=g.clientHeight,N=0,k=0;if(S){T=S.width,R=S.height;const x=UA();(!x||x&&h==="fixed")&&(N=S.offsetLeft,k=S.offsetTop)}return{width:T,height:R,x:N,y:k}}const T$=new Set(["absolute","fixed"]);function C$(u,h){const f=jh(u,!0,h==="fixed"),g=f.top+u.clientTop,S=f.left+u.clientLeft,T=xc(u)?sm(u):Lc(1),R=u.clientWidth*T.x,N=u.clientHeight*T.y,k=S*T.x,x=g*T.y;return{width:R,height:N,x:k,y:x}}function O4(u,h,f){let g;if(h==="viewport")g=y$(u,f);else if(h==="document")g=S$(Mc(u));else if(xa(h))g=C$(h,f);else{const S=c8(u);g={x:h.x-S.x,y:h.y-S.y,width:h.width,height:h.height}}return m0(g)}function d8(u,h){const f=Qd(u);return f===h||!xa(f)||om(f)?!1:Ma(f).position==="fixed"||d8(f,h)}function w$(u,h){const f=h.get(u);if(f)return f;let g=NE(u,[],!1).filter(N=>xa(N)&&hm(N)!=="body"),S=null;const T=Ma(u).position==="fixed";let R=T?Qd(u):u;for(;xa(R)&&!om(R);){const N=Ma(R),k=MA(R);!k&&N.position==="fixed"&&(S=null),(T?!k&&!S:!k&&N.position==="static"&&!!S&&T$.has(S.position)||jE(R)&&!k&&d8(u,R))?g=g.filter(U=>U!==R):S=N,R=Qd(R)}return h.set(u,g),g}function R$(u){let{element:h,boundary:f,rootBoundary:g,strategy:S}=u;const R=[...f==="clippingAncestors"?b0(h)?[]:w$(h,this._c):[].concat(f),g],N=R[0],k=R.reduce((x,U)=>{const B=O4(h,U,S);return x.top=lo(B.top,x.top),x.right=Jd(B.right,x.right),x.bottom=Jd(B.bottom,x.bottom),x.left=lo(B.left,x.left),x},O4(h,N,S));return{width:k.right-k.left,height:k.bottom-k.top,x:k.left,y:k.top}}function b$(u){const{width:h,height:f}=a8(u);return{width:h,height:f}}function I$(u,h,f){const g=xc(h),S=Mc(h),T=f==="fixed",R=jh(u,!0,T,h);let N={scrollLeft:0,scrollTop:0};const k=Lc(0);function x(){k.x=jA(S)}if(g||!g&&!T)if((hm(h)!=="body"||jE(S))&&(N=I0(h)),g){const H=jh(h,!0,T,h);k.x=H.x+h.clientLeft,k.y=H.y+h.clientTop}else S&&x();T&&!g&&S&&x();const U=S&&!g&&!T?l8(S,N):Lc(0),B=R.left+N.scrollLeft-k.x-U.x,Y=R.top+N.scrollTop-k.y-U.y;return{x:B,y:Y,width:R.width,height:R.height}}function $I(u){return Ma(u).position==="static"}function N4(u,h){if(!xc(u)||Ma(u).position==="fixed")return null;if(h)return h(u);let f=u.offsetParent;return Mc(u)===f&&(f=f.ownerDocument.body),f}function u8(u,h){const f=ho(u);if(b0(u))return f;if(!xc(u)){let S=Qd(u);for(;S&&!om(S);){if(xa(S)&&!$I(S))return S;S=Qd(S)}return f}let g=N4(u,h);for(;g&&l$(g)&&$I(g);)g=N4(g,h);return g&&om(g)&&$I(g)&&!MA(g)?f:g||f$(u)||f}const A$=async function(u){const h=this.getOffsetParent||u8,f=this.getDimensions,g=await f(u.floating);return{reference:I$(u.reference,await h(u.floating),u.strategy),floating:{x:0,y:0,width:g.width,height:g.height}}};function O$(u){return Ma(u).direction==="rtl"}const N$={convertOffsetParentRelativeRectToViewportRelativeRect:E$,getDocumentElement:Mc,getClippingRect:R$,getOffsetParent:u8,getElementRects:A$,getClientRects:v$,getDimensions:b$,getScale:sm,isElement:xa,isRTL:O$};function h8(u,h){return u.x===h.x&&u.y===h.y&&u.width===h.width&&u.height===h.height}function P$(u,h){let f=null,g;const S=Mc(u);function T(){var N;clearTimeout(g),(N=f)==null||N.disconnect(),f=null}function R(N,k){N===void 0&&(N=!1),k===void 0&&(k=1),T();const x=u.getBoundingClientRect(),{left:U,top:B,width:Y,height:H}=x;if(N||h(),!Y||!H)return;const re=$T(B),X=$T(S.clientWidth-(U+Y)),te=$T(S.clientHeight-(B+H)),ce=$T(U),le={rootMargin:-re+"px "+-X+"px "+-te+"px "+-ce+"px",threshold:lo(0,Jd(1,k))||1};let ne=!0;function ue(Pe){const he=Pe[0].intersectionRatio;if(he!==k){if(!ne)return R();he?R(!1,he):g=setTimeout(()=>{R(!1,1e-7)},1e3)}he===1&&!h8(x,u.getBoundingClientRect())&&R(),ne=!1}try{f=new IntersectionObserver(ue,{...le,root:S.ownerDocument})}catch{f=new IntersectionObserver(ue,le)}f.observe(u)}return R(!0),T}function k$(u,h,f,g){g===void 0&&(g={});const{ancestorScroll:S=!0,ancestorResize:T=!0,elementResize:R=typeof ResizeObserver=="function",layoutShift:N=typeof IntersectionObserver=="function",animationFrame:k=!1}=g,x=VA(u),U=S||T?[...x?NE(x):[],...NE(h)]:[];U.forEach(ce=>{S&&ce.addEventListener("scroll",f,{passive:!0}),T&&ce.addEventListener("resize",f)});const B=x&&N?P$(x,f):null;let Y=-1,H=null;R&&(H=new ResizeObserver(ce=>{let[$]=ce;$&&$.target===x&&H&&(H.unobserve(h),cancelAnimationFrame(Y),Y=requestAnimationFrame(()=>{var le;(le=H)==null||le.observe(h)})),f()}),x&&!k&&H.observe(x),H.observe(h));let re,X=k?jh(u):null;k&&te();function te(){const ce=jh(u);X&&!h8(X,ce)&&f(),X=ce,re=requestAnimationFrame(te)}return f(),()=>{var ce;U.forEach($=>{S&&$.removeEventListener("scroll",f),T&&$.removeEventListener("resize",f)}),B?.(),(ce=H)==null||ce.disconnect(),H=null,k&&cancelAnimationFrame(re)}}const D$=r$,L$=i$,x$=e$,M$=o$,U$=t$,P4=ZQ,V$=s$,j$=(u,h,f)=>{const g=new Map,S={platform:N$,...f},T={...S.platform,_c:g};return $Q(u,h,{...S,platform:T})};var F$=typeof document<"u",B$=function(){},u0=F$?ee.useLayoutEffect:B$;function _0(u,h){if(u===h)return!0;if(typeof u!=typeof h)return!1;if(typeof u=="function"&&u.toString()===h.toString())return!0;let f,g,S;if(u&&h&&typeof u=="object"){if(Array.isArray(u)){if(f=u.length,f!==h.length)return!1;for(g=f;g--!==0;)if(!_0(u[g],h[g]))return!1;return!0}if(S=Object.keys(u),f=S.length,f!==Object.keys(h).length)return!1;for(g=f;g--!==0;)if(!{}.hasOwnProperty.call(h,S[g]))return!1;for(g=f;g--!==0;){const T=S[g];if(!(T==="_owner"&&u.$$typeof)&&!_0(u[T],h[T]))return!1}return!0}return u!==u&&h!==h}function p8(u){return typeof window>"u"?1:(u.ownerDocument.defaultView||window).devicePixelRatio||1}function k4(u,h){const f=p8(u);return Math.round(h*f)/f}function ZI(u){const h=ee.useRef(u);return u0(()=>{h.current=u}),h}function W$(u){u===void 0&&(u={});const{placement:h="bottom",strategy:f="absolute",middleware:g=[],platform:S,elements:{reference:T,floating:R}={},transform:N=!0,whileElementsMounted:k,open:x}=u,[U,B]=ee.useState({x:0,y:0,strategy:f,placement:h,middlewareData:{},isPositioned:!1}),[Y,H]=ee.useState(g);_0(Y,g)||H(g);const[re,X]=ee.useState(null),[te,ce]=ee.useState(null),$=ee.useCallback(Ie=>{Ie!==Pe.current&&(Pe.current=Ie,X(Ie))},[]),le=ee.useCallback(Ie=>{Ie!==he.current&&(he.current=Ie,ce(Ie))},[]),ne=T||re,ue=R||te,Pe=ee.useRef(null),he=ee.useRef(null),de=ee.useRef(U),ye=k!=null,Me=ZI(k),Je=ZI(S),Ve=ZI(x),xe=ee.useCallback(()=>{if(!Pe.current||!he.current)return;const Ie={placement:h,strategy:f,middleware:Y};Je.current&&(Ie.platform=Je.current),j$(Pe.current,he.current,Ie).then(ke=>{const Ye={...ke,isPositioned:Ve.current!==!1};He.current&&!_0(de.current,Ye)&&(de.current=Ye,y0.flushSync(()=>{B(Ye)}))})},[Y,h,f,Je,Ve]);u0(()=>{x===!1&&de.current.isPositioned&&(de.current.isPositioned=!1,B(Ie=>({...Ie,isPositioned:!1})))},[x]);const He=ee.useRef(!1);u0(()=>(He.current=!0,()=>{He.current=!1}),[]),u0(()=>{if(ne&&(Pe.current=ne),ue&&(he.current=ue),ne&&ue){if(Me.current)return Me.current(ne,ue,xe);xe()}},[ne,ue,xe,Me,ye]);const dt=ee.useMemo(()=>({reference:Pe,floating:he,setReference:$,setFloating:le}),[$,le]),Qe=ee.useMemo(()=>({reference:ne,floating:ue}),[ne,ue]),Ge=ee.useMemo(()=>{const Ie={position:f,left:0,top:0};if(!Qe.floating)return Ie;const ke=k4(Qe.floating,U.x),Ye=k4(Qe.floating,U.y);return N?{...Ie,transform:"translate("+ke+"px, "+Ye+"px)",...p8(Qe.floating)>=1.5&&{willChange:"transform"}}:{position:f,left:ke,top:Ye}},[f,N,Qe.floating,U.x,U.y]);return ee.useMemo(()=>({...U,update:xe,refs:dt,elements:Qe,floatingStyles:Ge}),[U,xe,dt,Qe,Ge])}const G$=u=>{function h(f){return{}.hasOwnProperty.call(f,"current")}return{name:"arrow",options:u,fn(f){const{element:g,padding:S}=typeof u=="function"?u(f):u;return g&&h(g)?g.current!=null?P4({element:g.current,padding:S}).fn(f):{}:g?P4({element:g,padding:S}).fn(f):{}}}},H$=(u,h)=>({...D$(u),options:[u,h]}),K$=(u,h)=>({...L$(u),options:[u,h]}),z$=(u,h)=>({...V$(u),options:[u,h]}),Y$=(u,h)=>({...x$(u),options:[u,h]}),q$=(u,h)=>({...M$(u),options:[u,h]}),X$=(u,h)=>({...U$(u),options:[u,h]}),J$=(u,h)=>({...G$(u),options:[u,h]});var Q$="Arrow",f8=ee.forwardRef((u,h)=>{const{children:f,width:g=10,height:S=5,...T}=u;return O.jsx(xs.svg,{...T,ref:h,width:g,height:S,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:u.asChild?f:O.jsx("polygon",{points:"0,0 30,0 15,10"})})});f8.displayName=Q$;var $$=f8;function Z$(u){const[h,f]=ee.useState(void 0);return Xd(()=>{if(u){f({width:u.offsetWidth,height:u.offsetHeight});const g=new ResizeObserver(S=>{if(!Array.isArray(S)||!S.length)return;const T=S[0];let R,N;if("borderBoxSize"in T){const k=T.borderBoxSize,x=Array.isArray(k)?k[0]:k;R=x.inlineSize,N=x.blockSize}else R=u.offsetWidth,N=u.offsetHeight;f({width:R,height:N})});return g.observe(u,{box:"border-box"}),()=>g.unobserve(u)}else f(void 0)},[u]),h}var m8="Popper",[_8,g8]=T0(m8),[Ane,E8]=_8(m8),v8="PopperAnchor",S8=ee.forwardRef((u,h)=>{const{__scopePopper:f,virtualRef:g,...S}=u,T=E8(v8,f),R=ee.useRef(null),N=La(h,R);return ee.useEffect(()=>{T.onAnchorChange(g?.current||R.current)}),g?null:O.jsx(xs.div,{...S,ref:N})});S8.displayName=v8;var FA="PopperContent",[eZ,tZ]=_8(FA),y8=ee.forwardRef((u,h)=>{const{__scopePopper:f,side:g="bottom",sideOffset:S=0,align:T="center",alignOffset:R=0,arrowPadding:N=0,avoidCollisions:k=!0,collisionBoundary:x=[],collisionPadding:U=0,sticky:B="partial",hideWhenDetached:Y=!1,updatePositionStrategy:H="optimized",onPlaced:re,...X}=u,te=E8(FA,f),[ce,$]=ee.useState(null),le=La(h,yt=>$(yt)),[ne,ue]=ee.useState(null),Pe=Z$(ne),he=Pe?.width??0,de=Pe?.height??0,ye=g+(T!=="center"?"-"+T:""),Me=typeof U=="number"?U:{top:0,right:0,bottom:0,left:0,...U},Je=Array.isArray(x)?x:[x],Ve=Je.length>0,xe={padding:Me,boundary:Je.filter(rZ),altBoundary:Ve},{refs:He,floatingStyles:dt,placement:Qe,isPositioned:Ge,middlewareData:Ie}=W$({strategy:"fixed",placement:ye,whileElementsMounted:(...yt)=>k$(...yt,{animationFrame:H==="always"}),elements:{reference:te.anchor},middleware:[H$({mainAxis:S+de,alignmentAxis:R}),k&&K$({mainAxis:!0,crossAxis:!1,limiter:B==="partial"?z$():void 0,...xe}),k&&Y$({...xe}),q$({...xe,apply:({elements:yt,rects:pn,availableWidth:vn,availableHeight:or})=>{const{width:hs,height:Ua}=pn.reference,zr=yt.floating.style;zr.setProperty("--radix-popper-available-width",`${vn}px`),zr.setProperty("--radix-popper-available-height",`${or}px`),zr.setProperty("--radix-popper-anchor-width",`${hs}px`),zr.setProperty("--radix-popper-anchor-height",`${Ua}px`)}}),ne&&J$({element:ne,padding:N}),iZ({arrowWidth:he,arrowHeight:de}),Y&&X$({strategy:"referenceHidden",...xe})]}),[ke,Ye]=w8(Qe),_e=qd(re);Xd(()=>{Ge&&_e?.()},[Ge,_e]);const De=Ie.arrow?.x,ct=Ie.arrow?.y,at=Ie.arrow?.centerOffset!==0,[Ot,Gt]=ee.useState();return Xd(()=>{ce&&Gt(window.getComputedStyle(ce).zIndex)},[ce]),O.jsx("div",{ref:He.setFloating,"data-radix-popper-content-wrapper":"",style:{...dt,transform:Ge?dt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ot,"--radix-popper-transform-origin":[Ie.transformOrigin?.x,Ie.transformOrigin?.y].join(" "),...Ie.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:u.dir,children:O.jsx(eZ,{scope:f,placedSide:ke,onArrowChange:ue,arrowX:De,arrowY:ct,shouldHideArrow:at,children:O.jsx(xs.div,{"data-side":ke,"data-align":Ye,...X,ref:le,style:{...X.style,animation:Ge?void 0:"none"}})})})});y8.displayName=FA;var T8="PopperArrow",nZ={top:"bottom",right:"left",bottom:"top",left:"right"},C8=ee.forwardRef(function(h,f){const{__scopePopper:g,...S}=h,T=tZ(T8,g),R=nZ[T.placedSide];return O.jsx("span",{ref:T.onArrowChange,style:{position:"absolute",left:T.arrowX,top:T.arrowY,[R]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[T.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[T.placedSide],visibility:T.shouldHideArrow?"hidden":void 0},children:O.jsx($$,{...S,ref:f,style:{...S.style,display:"block"}})})});C8.displayName=T8;function rZ(u){return u!==null}var iZ=u=>({name:"transformOrigin",options:u,fn(h){const{placement:f,rects:g,middlewareData:S}=h,R=S.arrow?.centerOffset!==0,N=R?0:u.arrowWidth,k=R?0:u.arrowHeight,[x,U]=w8(f),B={start:"0%",center:"50%",end:"100%"}[U],Y=(S.arrow?.x??0)+N/2,H=(S.arrow?.y??0)+k/2;let re="",X="";return x==="bottom"?(re=R?B:`${Y}px`,X=`${-k}px`):x==="top"?(re=R?B:`${Y}px`,X=`${g.floating.height+k}px`):x==="right"?(re=`${-k}px`,X=R?B:`${H}px`):x==="left"&&(re=`${g.floating.width+k}px`,X=R?B:`${H}px`),{data:{x:re,y:X}}}});function w8(u){const[h,f="center"]=u.split("-");return[h,f]}var sZ=S8,oZ=y8,aZ=C8,[A0,One]=T0("Tooltip",[g8]),BA=g8(),R8="TooltipProvider",cZ=700,D4="tooltip.open",[lZ,b8]=A0(R8),I8=u=>{const{__scopeTooltip:h,delayDuration:f=cZ,skipDelayDuration:g=300,disableHoverableContent:S=!1,children:T}=u,R=ee.useRef(!0),N=ee.useRef(!1),k=ee.useRef(0);return ee.useEffect(()=>{const x=k.current;return()=>window.clearTimeout(x)},[]),O.jsx(lZ,{scope:h,isOpenDelayedRef:R,delayDuration:f,onOpen:ee.useCallback(()=>{window.clearTimeout(k.current),R.current=!1},[]),onClose:ee.useCallback(()=>{window.clearTimeout(k.current),k.current=window.setTimeout(()=>R.current=!0,g)},[g]),isPointerInTransitRef:N,onPointerInTransitChange:ee.useCallback(x=>{N.current=x},[]),disableHoverableContent:S,children:T})};I8.displayName=R8;var A8="Tooltip",[Nne,O0]=A0(A8),gA="TooltipTrigger",dZ=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,...g}=u,S=O0(gA,f),T=b8(gA,f),R=BA(f),N=ee.useRef(null),k=La(h,N,S.onTriggerChange),x=ee.useRef(!1),U=ee.useRef(!1),B=ee.useCallback(()=>x.current=!1,[]);return ee.useEffect(()=>()=>document.removeEventListener("pointerup",B),[B]),O.jsx(sZ,{asChild:!0,...R,children:O.jsx(xs.button,{"aria-describedby":S.open?S.contentId:void 0,"data-state":S.stateAttribute,...g,ref:k,onPointerMove:ai(u.onPointerMove,Y=>{Y.pointerType!=="touch"&&!U.current&&!T.isPointerInTransitRef.current&&(S.onTriggerEnter(),U.current=!0)}),onPointerLeave:ai(u.onPointerLeave,()=>{S.onTriggerLeave(),U.current=!1}),onPointerDown:ai(u.onPointerDown,()=>{S.open&&S.onClose(),x.current=!0,document.addEventListener("pointerup",B,{once:!0})}),onFocus:ai(u.onFocus,()=>{x.current||S.onOpen()}),onBlur:ai(u.onBlur,S.onClose),onClick:ai(u.onClick,S.onClose)})})});dZ.displayName=gA;var uZ="TooltipPortal",[Pne,hZ]=A0(uZ,{forceMount:void 0}),am="TooltipContent",O8=ee.forwardRef((u,h)=>{const f=hZ(am,u.__scopeTooltip),{forceMount:g=f.forceMount,side:S="top",...T}=u,R=O0(am,u.__scopeTooltip);return O.jsx(IA,{present:g||R.open,children:R.disableHoverableContent?O.jsx(N8,{side:S,...T,ref:h}):O.jsx(pZ,{side:S,...T,ref:h})})}),pZ=ee.forwardRef((u,h)=>{const f=O0(am,u.__scopeTooltip),g=b8(am,u.__scopeTooltip),S=ee.useRef(null),T=La(h,S),[R,N]=ee.useState(null),{trigger:k,onClose:x}=f,U=S.current,{onPointerInTransitChange:B}=g,Y=ee.useCallback(()=>{N(null),B(!1)},[B]),H=ee.useCallback((re,X)=>{const te=re.currentTarget,ce={x:re.clientX,y:re.clientY},$=EZ(ce,te.getBoundingClientRect()),le=vZ(ce,$),ne=SZ(X.getBoundingClientRect()),ue=TZ([...le,...ne]);N(ue),B(!0)},[B]);return ee.useEffect(()=>()=>Y(),[Y]),ee.useEffect(()=>{if(k&&U){const re=te=>H(te,U),X=te=>H(te,k);return k.addEventListener("pointerleave",re),U.addEventListener("pointerleave",X),()=>{k.removeEventListener("pointerleave",re),U.removeEventListener("pointerleave",X)}}},[k,U,H,Y]),ee.useEffect(()=>{if(R){const re=X=>{const te=X.target,ce={x:X.clientX,y:X.clientY},$=k?.contains(te)||U?.contains(te),le=!yZ(ce,R);$?Y():le&&(Y(),x())};return document.addEventListener("pointermove",re),()=>document.removeEventListener("pointermove",re)}},[k,U,R,x,Y]),O.jsx(N8,{...u,ref:T})}),[fZ,mZ]=A0(A8,{isInside:!1}),_Z=RX("TooltipContent"),N8=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,children:g,"aria-label":S,onEscapeKeyDown:T,onPointerDownOutside:R,...N}=u,k=O0(am,f),x=BA(f),{onClose:U}=k;return ee.useEffect(()=>(document.addEventListener(D4,U),()=>document.removeEventListener(D4,U)),[U]),ee.useEffect(()=>{if(k.trigger){const B=Y=>{Y.target?.contains(k.trigger)&&U()};return window.addEventListener("scroll",B,{capture:!0}),()=>window.removeEventListener("scroll",B,{capture:!0})}},[k.trigger,U]),O.jsx(bA,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:T,onPointerDownOutside:R,onFocusOutside:B=>B.preventDefault(),onDismiss:U,children:O.jsxs(oZ,{"data-state":k.stateAttribute,...x,...N,ref:h,style:{...N.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[O.jsx(_Z,{children:g}),O.jsx(fZ,{scope:f,isInside:!0,children:O.jsx(JX,{id:k.contentId,role:"tooltip",children:S||g})})]})})});O8.displayName=am;var P8="TooltipArrow",gZ=ee.forwardRef((u,h)=>{const{__scopeTooltip:f,...g}=u,S=BA(f);return mZ(P8,f).isInside?null:O.jsx(aZ,{...S,...g,ref:h})});gZ.displayName=P8;function EZ(u,h){const f=Math.abs(h.top-u.y),g=Math.abs(h.bottom-u.y),S=Math.abs(h.right-u.x),T=Math.abs(h.left-u.x);switch(Math.min(f,g,S,T)){case T:return"left";case S:return"right";case f:return"top";case g:return"bottom";default:throw new Error("unreachable")}}function vZ(u,h,f=5){const g=[];switch(h){case"top":g.push({x:u.x-f,y:u.y+f},{x:u.x+f,y:u.y+f});break;case"bottom":g.push({x:u.x-f,y:u.y-f},{x:u.x+f,y:u.y-f});break;case"left":g.push({x:u.x+f,y:u.y-f},{x:u.x+f,y:u.y+f});break;case"right":g.push({x:u.x-f,y:u.y-f},{x:u.x-f,y:u.y+f});break}return g}function SZ(u){const{top:h,right:f,bottom:g,left:S}=u;return[{x:S,y:h},{x:f,y:h},{x:f,y:g},{x:S,y:g}]}function yZ(u,h){const{x:f,y:g}=u;let S=!1;for(let T=0,R=h.length-1;T<h.length;R=T++){const N=h[T],k=h[R],x=N.x,U=N.y,B=k.x,Y=k.y;U>g!=Y>g&&f<(B-x)*(g-U)/(Y-U)+x&&(S=!S)}return S}function TZ(u){const h=u.slice();return h.sort((f,g)=>f.x<g.x?-1:f.x>g.x?1:f.y<g.y?-1:f.y>g.y?1:0),CZ(h)}function CZ(u){if(u.length<=1)return u.slice();const h=[];for(let g=0;g<u.length;g++){const S=u[g];for(;h.length>=2;){const T=h[h.length-1],R=h[h.length-2];if((T.x-R.x)*(S.y-R.y)>=(T.y-R.y)*(S.x-R.x))h.pop();else break}h.push(S)}h.pop();const f=[];for(let g=u.length-1;g>=0;g--){const S=u[g];for(;f.length>=2;){const T=f[f.length-1],R=f[f.length-2];if((T.x-R.x)*(S.y-R.y)>=(T.y-R.y)*(S.x-R.x))f.pop();else break}f.push(S)}return f.pop(),h.length===1&&f.length===1&&h[0].x===f[0].x&&h[0].y===f[0].y?h:h.concat(f)}var wZ=I8,k8=O8;const RZ=wZ,bZ=ee.forwardRef(({className:u,sideOffset:h=4,...f},g)=>O.jsx(k8,{ref:g,sideOffset:h,className:Fh("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",u),...f}));bZ.displayName=k8.displayName;var N0=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(u){return this.listeners.add(u),this.onSubscribe(),()=>{this.listeners.delete(u),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},P0=typeof window>"u"||"Deno"in globalThis;function Da(){}function IZ(u,h){return typeof u=="function"?u(h):u}function AZ(u){return typeof u=="number"&&u>=0&&u!==1/0}function OZ(u,h){return Math.max(u+(h||0)-Date.now(),0)}function EA(u,h){return typeof u=="function"?u(h):u}function NZ(u,h){return typeof u=="function"?u(h):u}function L4(u,h){const{type:f="all",exact:g,fetchStatus:S,predicate:T,queryKey:R,stale:N}=u;if(R){if(g){if(h.queryHash!==WA(R,h.options))return!1}else if(!kE(h.queryKey,R))return!1}if(f!=="all"){const k=h.isActive();if(f==="active"&&!k||f==="inactive"&&k)return!1}return!(typeof N=="boolean"&&h.isStale()!==N||S&&S!==h.state.fetchStatus||T&&!T(h))}function x4(u,h){const{exact:f,status:g,predicate:S,mutationKey:T}=u;if(T){if(!h.options.mutationKey)return!1;if(f){if(PE(h.options.mutationKey)!==PE(T))return!1}else if(!kE(h.options.mutationKey,T))return!1}return!(g&&h.state.status!==g||S&&!S(h))}function WA(u,h){return(h?.queryKeyHashFn||PE)(u)}function PE(u){return JSON.stringify(u,(h,f)=>vA(f)?Object.keys(f).sort().reduce((g,S)=>(g[S]=f[S],g),{}):f)}function kE(u,h){return u===h?!0:typeof u!=typeof h?!1:u&&h&&typeof u=="object"&&typeof h=="object"?Object.keys(h).every(f=>kE(u[f],h[f])):!1}function D8(u,h){if(u===h)return u;const f=M4(u)&&M4(h);if(f||vA(u)&&vA(h)){const g=f?u:Object.keys(u),S=g.length,T=f?h:Object.keys(h),R=T.length,N=f?[]:{},k=new Set(g);let x=0;for(let U=0;U<R;U++){const B=f?U:T[U];(!f&&k.has(B)||f)&&u[B]===void 0&&h[B]===void 0?(N[B]=void 0,x++):(N[B]=D8(u[B],h[B]),N[B]===u[B]&&u[B]!==void 0&&x++)}return S===R&&x===S?u:N}return h}function M4(u){return Array.isArray(u)&&u.length===Object.keys(u).length}function vA(u){if(!U4(u))return!1;const h=u.constructor;if(h===void 0)return!0;const f=h.prototype;return!(!U4(f)||!f.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(u)!==Object.prototype)}function U4(u){return Object.prototype.toString.call(u)==="[object Object]"}function PZ(u){return new Promise(h=>{setTimeout(h,u)})}function kZ(u,h,f){return typeof f.structuralSharing=="function"?f.structuralSharing(u,h):f.structuralSharing!==!1?D8(u,h):h}function DZ(u,h,f=0){const g=[...u,h];return f&&g.length>f?g.slice(1):g}function LZ(u,h,f=0){const g=[h,...u];return f&&g.length>f?g.slice(0,-1):g}var GA=Symbol();function L8(u,h){return!u.queryFn&&h?.initialPromise?()=>h.initialPromise:!u.queryFn||u.queryFn===GA?()=>Promise.reject(new Error(`Missing queryFn: '${u.queryHash}'`)):u.queryFn}var xZ=class extends N0{#e;#t;#n;constructor(){super(),this.#n=u=>{if(!P0&&window.addEventListener){const h=()=>u();return window.addEventListener("visibilitychange",h,!1),()=>{window.removeEventListener("visibilitychange",h)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(h=>{typeof h=="boolean"?this.setFocused(h):this.onFocus()})}setFocused(u){this.#e!==u&&(this.#e=u,this.onFocus())}onFocus(){const u=this.isFocused();this.listeners.forEach(h=>{h(u)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},x8=new xZ,MZ=class extends N0{#e=!0;#t;#n;constructor(){super(),this.#n=u=>{if(!P0&&window.addEventListener){const h=()=>u(!0),f=()=>u(!1);return window.addEventListener("online",h,!1),window.addEventListener("offline",f,!1),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",f)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(this.setOnline.bind(this))}setOnline(u){this.#e!==u&&(this.#e=u,this.listeners.forEach(f=>{f(u)}))}isOnline(){return this.#e}},g0=new MZ;function UZ(){let u,h;const f=new Promise((S,T)=>{u=S,h=T});f.status="pending",f.catch(()=>{});function g(S){Object.assign(f,S),delete f.resolve,delete f.reject}return f.resolve=S=>{g({status:"fulfilled",value:S}),u(S)},f.reject=S=>{g({status:"rejected",reason:S}),h(S)},f}function VZ(u){return Math.min(1e3*2**u,3e4)}function M8(u){return(u??"online")==="online"?g0.isOnline():!0}var U8=class extends Error{constructor(u){super("CancelledError"),this.revert=u?.revert,this.silent=u?.silent}};function e1(u){return u instanceof U8}function V8(u){let h=!1,f=0,g=!1,S;const T=UZ(),R=X=>{g||(Y(new U8(X)),u.abort?.())},N=()=>{h=!0},k=()=>{h=!1},x=()=>x8.isFocused()&&(u.networkMode==="always"||g0.isOnline())&&u.canRun(),U=()=>M8(u.networkMode)&&u.canRun(),B=X=>{g||(g=!0,u.onSuccess?.(X),S?.(),T.resolve(X))},Y=X=>{g||(g=!0,u.onError?.(X),S?.(),T.reject(X))},H=()=>new Promise(X=>{S=te=>{(g||x())&&X(te)},u.onPause?.()}).then(()=>{S=void 0,g||u.onContinue?.()}),re=()=>{if(g)return;let X;const te=f===0?u.initialPromise:void 0;try{X=te??u.fn()}catch(ce){X=Promise.reject(ce)}Promise.resolve(X).then(B).catch(ce=>{if(g)return;const $=u.retry??(P0?0:3),le=u.retryDelay??VZ,ne=typeof le=="function"?le(f,ce):le,ue=$===!0||typeof $=="number"&&f<$||typeof $=="function"&&$(f,ce);if(h||!ue){Y(ce);return}f++,u.onFail?.(f,ce),PZ(ne).then(()=>x()?void 0:H()).then(()=>{h?Y(ce):re()})})};return{promise:T,cancel:R,continue:()=>(S?.(),T),cancelRetry:N,continueRetry:k,canStart:U,start:()=>(U()?re():H().then(re),T)}}var jZ=u=>setTimeout(u,0);function FZ(){let u=[],h=0,f=N=>{N()},g=N=>{N()},S=jZ;const T=N=>{h?u.push(N):S(()=>{f(N)})},R=()=>{const N=u;u=[],N.length&&S(()=>{g(()=>{N.forEach(k=>{f(k)})})})};return{batch:N=>{let k;h++;try{k=N()}finally{h--,h||R()}return k},batchCalls:N=>(...k)=>{T(()=>{N(...k)})},schedule:T,setNotifyFunction:N=>{f=N},setBatchNotifyFunction:N=>{g=N},setScheduler:N=>{S=N}}}var ls=FZ(),j8=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),AZ(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(u){this.gcTime=Math.max(this.gcTime||0,u??(P0?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},BZ=class extends j8{#e;#t;#n;#i;#r;#o;#a;constructor(u){super(),this.#a=!1,this.#o=u.defaultOptions,this.setOptions(u.options),this.observers=[],this.#i=u.client,this.#n=this.#i.getQueryCache(),this.queryKey=u.queryKey,this.queryHash=u.queryHash,this.#e=GZ(this.options),this.state=u.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(u){this.options={...this.#o,...u},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(u,h){const f=kZ(this.state.data,u,this.options);return this.#s({data:f,type:"success",dataUpdatedAt:h?.updatedAt,manual:h?.manual}),f}setState(u,h){this.#s({type:"setState",state:u,setStateOptions:h})}cancel(u){const h=this.#r?.promise;return this.#r?.cancel(u),h?h.then(Da).catch(Da):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(u=>NZ(u.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===GA||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(u=>EA(u.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(u=>u.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(u=0){return this.state.data===void 0?!0:u==="static"?!1:this.state.isInvalidated?!0:!OZ(this.state.dataUpdatedAt,u)}onFocus(){this.observers.find(h=>h.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(h=>h.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(u){this.observers.includes(u)||(this.observers.push(u),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:u}))}removeObserver(u){this.observers.includes(u)&&(this.observers=this.observers.filter(h=>h!==u),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:u}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}fetch(u,h){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&h?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(u&&this.setOptions(u),!this.options.queryFn){const k=this.observers.find(x=>x.options.queryFn);k&&this.setOptions(k.options)}const f=new AbortController,g=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(this.#a=!0,f.signal)})},S=()=>{const k=L8(this.options,h),U=(()=>{const B={client:this.#i,queryKey:this.queryKey,meta:this.meta};return g(B),B})();return this.#a=!1,this.options.persister?this.options.persister(k,U,this):k(U)},R=(()=>{const k={fetchOptions:h,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:S};return g(k),k})();this.options.behavior?.onFetch(R,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==R.fetchOptions?.meta)&&this.#s({type:"fetch",meta:R.fetchOptions?.meta});const N=k=>{e1(k)&&k.silent||this.#s({type:"error",error:k}),e1(k)||(this.#n.config.onError?.(k,this),this.#n.config.onSettled?.(this.state.data,k,this)),this.scheduleGc()};return this.#r=V8({initialPromise:h?.initialPromise,fn:R.fetchFn,abort:f.abort.bind(f),onSuccess:k=>{if(k===void 0){N(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(k)}catch(x){N(x);return}this.#n.config.onSuccess?.(k,this),this.#n.config.onSettled?.(k,this.state.error,this),this.scheduleGc()},onError:N,onFail:(k,x)=>{this.#s({type:"failed",failureCount:k,error:x})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:R.options.retry,retryDelay:R.options.retryDelay,networkMode:R.options.networkMode,canRun:()=>!0}),this.#r.start()}#s(u){const h=f=>{switch(u.type){case"failed":return{...f,fetchFailureCount:u.failureCount,fetchFailureReason:u.error};case"pause":return{...f,fetchStatus:"paused"};case"continue":return{...f,fetchStatus:"fetching"};case"fetch":return{...f,...WZ(f.data,this.options),fetchMeta:u.meta??null};case"success":return this.#t=void 0,{...f,data:u.data,dataUpdateCount:f.dataUpdateCount+1,dataUpdatedAt:u.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!u.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const g=u.error;return e1(g)&&g.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...f,error:g,errorUpdateCount:f.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:f.fetchFailureCount+1,fetchFailureReason:g,fetchStatus:"idle",status:"error"};case"invalidate":return{...f,isInvalidated:!0};case"setState":return{...f,...u.state}}};this.state=h(this.state),ls.batch(()=>{this.observers.forEach(f=>{f.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:u})})}};function WZ(u,h){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:M8(h.networkMode)?"fetching":"paused",...u===void 0&&{error:null,status:"pending"}}}function GZ(u){const h=typeof u.initialData=="function"?u.initialData():u.initialData,f=h!==void 0,g=f?typeof u.initialDataUpdatedAt=="function"?u.initialDataUpdatedAt():u.initialDataUpdatedAt:0;return{data:h,dataUpdateCount:0,dataUpdatedAt:f?g??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:f?"success":"pending",fetchStatus:"idle"}}var HZ=class extends N0{constructor(u={}){super(),this.config=u,this.#e=new Map}#e;build(u,h,f){const g=h.queryKey,S=h.queryHash??WA(g,h);let T=this.get(S);return T||(T=new BZ({client:u,queryKey:g,queryHash:S,options:u.defaultQueryOptions(h),state:f,defaultOptions:u.getQueryDefaults(g)}),this.add(T)),T}add(u){this.#e.has(u.queryHash)||(this.#e.set(u.queryHash,u),this.notify({type:"added",query:u}))}remove(u){const h=this.#e.get(u.queryHash);h&&(u.destroy(),h===u&&this.#e.delete(u.queryHash),this.notify({type:"removed",query:u}))}clear(){ls.batch(()=>{this.getAll().forEach(u=>{this.remove(u)})})}get(u){return this.#e.get(u)}getAll(){return[...this.#e.values()]}find(u){const h={exact:!0,...u};return this.getAll().find(f=>L4(h,f))}findAll(u={}){const h=this.getAll();return Object.keys(u).length>0?h.filter(f=>L4(u,f)):h}notify(u){ls.batch(()=>{this.listeners.forEach(h=>{h(u)})})}onFocus(){ls.batch(()=>{this.getAll().forEach(u=>{u.onFocus()})})}onOnline(){ls.batch(()=>{this.getAll().forEach(u=>{u.onOnline()})})}},KZ=class extends j8{#e;#t;#n;constructor(u){super(),this.mutationId=u.mutationId,this.#t=u.mutationCache,this.#e=[],this.state=u.state||zZ(),this.setOptions(u.options),this.scheduleGc()}setOptions(u){this.options=u,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(u){this.#e.includes(u)||(this.#e.push(u),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:u}))}removeObserver(u){this.#e=this.#e.filter(h=>h!==u),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:u})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(u){const h=()=>{this.#i({type:"continue"})};this.#n=V8({fn:()=>this.options.mutationFn?this.options.mutationFn(u):Promise.reject(new Error("No mutationFn found")),onFail:(S,T)=>{this.#i({type:"failed",failureCount:S,error:T})},onPause:()=>{this.#i({type:"pause"})},onContinue:h,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const f=this.state.status==="pending",g=!this.#n.canStart();try{if(f)h();else{this.#i({type:"pending",variables:u,isPaused:g}),await this.#t.config.onMutate?.(u,this);const T=await this.options.onMutate?.(u);T!==this.state.context&&this.#i({type:"pending",context:T,variables:u,isPaused:g})}const S=await this.#n.start();return await this.#t.config.onSuccess?.(S,u,this.state.context,this),await this.options.onSuccess?.(S,u,this.state.context),await this.#t.config.onSettled?.(S,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(S,null,u,this.state.context),this.#i({type:"success",data:S}),S}catch(S){try{throw await this.#t.config.onError?.(S,u,this.state.context,this),await this.options.onError?.(S,u,this.state.context),await this.#t.config.onSettled?.(void 0,S,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,S,u,this.state.context),S}finally{this.#i({type:"error",error:S})}}finally{this.#t.runNext(this)}}#i(u){const h=f=>{switch(u.type){case"failed":return{...f,failureCount:u.failureCount,failureReason:u.error};case"pause":return{...f,isPaused:!0};case"continue":return{...f,isPaused:!1};case"pending":return{...f,context:u.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:u.isPaused,status:"pending",variables:u.variables,submittedAt:Date.now()};case"success":return{...f,data:u.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...f,data:void 0,error:u.error,failureCount:f.failureCount+1,failureReason:u.error,isPaused:!1,status:"error"}}};this.state=h(this.state),ls.batch(()=>{this.#e.forEach(f=>{f.onMutationUpdate(u)}),this.#t.notify({mutation:this,type:"updated",action:u})})}};function zZ(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var YZ=class extends N0{constructor(u={}){super(),this.config=u,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(u,h,f){const g=new KZ({mutationCache:this,mutationId:++this.#n,options:u.defaultMutationOptions(h),state:f});return this.add(g),g}add(u){this.#e.add(u);const h=ZT(u);if(typeof h=="string"){const f=this.#t.get(h);f?f.push(u):this.#t.set(h,[u])}this.notify({type:"added",mutation:u})}remove(u){if(this.#e.delete(u)){const h=ZT(u);if(typeof h=="string"){const f=this.#t.get(h);if(f)if(f.length>1){const g=f.indexOf(u);g!==-1&&f.splice(g,1)}else f[0]===u&&this.#t.delete(h)}}this.notify({type:"removed",mutation:u})}canRun(u){const h=ZT(u);if(typeof h=="string"){const g=this.#t.get(h)?.find(S=>S.state.status==="pending");return!g||g===u}else return!0}runNext(u){const h=ZT(u);return typeof h=="string"?this.#t.get(h)?.find(g=>g!==u&&g.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){ls.batch(()=>{this.#e.forEach(u=>{this.notify({type:"removed",mutation:u})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(u){const h={exact:!0,...u};return this.getAll().find(f=>x4(h,f))}findAll(u={}){return this.getAll().filter(h=>x4(u,h))}notify(u){ls.batch(()=>{this.listeners.forEach(h=>{h(u)})})}resumePausedMutations(){const u=this.getAll().filter(h=>h.state.isPaused);return ls.batch(()=>Promise.all(u.map(h=>h.continue().catch(Da))))}};function ZT(u){return u.options.scope?.id}function V4(u){return{onFetch:(h,f)=>{const g=h.options,S=h.fetchOptions?.meta?.fetchMore?.direction,T=h.state.data?.pages||[],R=h.state.data?.pageParams||[];let N={pages:[],pageParams:[]},k=0;const x=async()=>{let U=!1;const B=re=>{Object.defineProperty(re,"signal",{enumerable:!0,get:()=>(h.signal.aborted?U=!0:h.signal.addEventListener("abort",()=>{U=!0}),h.signal)})},Y=L8(h.options,h.fetchOptions),H=async(re,X,te)=>{if(U)return Promise.reject();if(X==null&&re.pages.length)return Promise.resolve(re);const $=(()=>{const Pe={client:h.client,queryKey:h.queryKey,pageParam:X,direction:te?"backward":"forward",meta:h.options.meta};return B(Pe),Pe})(),le=await Y($),{maxPages:ne}=h.options,ue=te?LZ:DZ;return{pages:ue(re.pages,le,ne),pageParams:ue(re.pageParams,X,ne)}};if(S&&T.length){const re=S==="backward",X=re?qZ:j4,te={pages:T,pageParams:R},ce=X(g,te);N=await H(te,ce,re)}else{const re=u??T.length;do{const X=k===0?R[0]??g.initialPageParam:j4(g,N);if(k>0&&X==null)break;N=await H(N,X),k++}while(k<re)}return N};h.options.persister?h.fetchFn=()=>h.options.persister?.(x,{client:h.client,queryKey:h.queryKey,meta:h.options.meta,signal:h.signal},f):h.fetchFn=x}}}function j4(u,{pages:h,pageParams:f}){const g=h.length-1;return h.length>0?u.getNextPageParam(h[g],h,f[g],f):void 0}function qZ(u,{pages:h,pageParams:f}){return h.length>0?u.getPreviousPageParam?.(h[0],h,f[0],f):void 0}var XZ=class{#e;#t;#n;#i;#r;#o;#a;#s;constructor(u={}){this.#e=u.queryCache||new HZ,this.#t=u.mutationCache||new YZ,this.#n=u.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=x8.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=g0.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(u){return this.#e.findAll({...u,fetchStatus:"fetching"}).length}isMutating(u){return this.#t.findAll({...u,status:"pending"}).length}getQueryData(u){const h=this.defaultQueryOptions({queryKey:u});return this.#e.get(h.queryHash)?.state.data}ensureQueryData(u){const h=this.defaultQueryOptions(u),f=this.#e.build(this,h),g=f.state.data;return g===void 0?this.fetchQuery(u):(u.revalidateIfStale&&f.isStaleByTime(EA(h.staleTime,f))&&this.prefetchQuery(h),Promise.resolve(g))}getQueriesData(u){return this.#e.findAll(u).map(({queryKey:h,state:f})=>{const g=f.data;return[h,g]})}setQueryData(u,h,f){const g=this.defaultQueryOptions({queryKey:u}),T=this.#e.get(g.queryHash)?.state.data,R=IZ(h,T);if(R!==void 0)return this.#e.build(this,g).setData(R,{...f,manual:!0})}setQueriesData(u,h,f){return ls.batch(()=>this.#e.findAll(u).map(({queryKey:g})=>[g,this.setQueryData(g,h,f)]))}getQueryState(u){const h=this.defaultQueryOptions({queryKey:u});return this.#e.get(h.queryHash)?.state}removeQueries(u){const h=this.#e;ls.batch(()=>{h.findAll(u).forEach(f=>{h.remove(f)})})}resetQueries(u,h){const f=this.#e;return ls.batch(()=>(f.findAll(u).forEach(g=>{g.reset()}),this.refetchQueries({type:"active",...u},h)))}cancelQueries(u,h={}){const f={revert:!0,...h},g=ls.batch(()=>this.#e.findAll(u).map(S=>S.cancel(f)));return Promise.all(g).then(Da).catch(Da)}invalidateQueries(u,h={}){return ls.batch(()=>(this.#e.findAll(u).forEach(f=>{f.invalidate()}),u?.refetchType==="none"?Promise.resolve():this.refetchQueries({...u,type:u?.refetchType??u?.type??"active"},h)))}refetchQueries(u,h={}){const f={...h,cancelRefetch:h.cancelRefetch??!0},g=ls.batch(()=>this.#e.findAll(u).filter(S=>!S.isDisabled()&&!S.isStatic()).map(S=>{let T=S.fetch(void 0,f);return f.throwOnError||(T=T.catch(Da)),S.state.fetchStatus==="paused"?Promise.resolve():T}));return Promise.all(g).then(Da)}fetchQuery(u){const h=this.defaultQueryOptions(u);h.retry===void 0&&(h.retry=!1);const f=this.#e.build(this,h);return f.isStaleByTime(EA(h.staleTime,f))?f.fetch(h):Promise.resolve(f.state.data)}prefetchQuery(u){return this.fetchQuery(u).then(Da).catch(Da)}fetchInfiniteQuery(u){return u.behavior=V4(u.pages),this.fetchQuery(u)}prefetchInfiniteQuery(u){return this.fetchInfiniteQuery(u).then(Da).catch(Da)}ensureInfiniteQueryData(u){return u.behavior=V4(u.pages),this.ensureQueryData(u)}resumePausedMutations(){return g0.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(u){this.#n=u}setQueryDefaults(u,h){this.#i.set(PE(u),{queryKey:u,defaultOptions:h})}getQueryDefaults(u){const h=[...this.#i.values()],f={};return h.forEach(g=>{kE(u,g.queryKey)&&Object.assign(f,g.defaultOptions)}),f}setMutationDefaults(u,h){this.#r.set(PE(u),{mutationKey:u,defaultOptions:h})}getMutationDefaults(u){const h=[...this.#r.values()],f={};return h.forEach(g=>{kE(u,g.mutationKey)&&Object.assign(f,g.defaultOptions)}),f}defaultQueryOptions(u){if(u._defaulted)return u;const h={...this.#n.queries,...this.getQueryDefaults(u.queryKey),...u,_defaulted:!0};return h.queryHash||(h.queryHash=WA(h.queryKey,h)),h.refetchOnReconnect===void 0&&(h.refetchOnReconnect=h.networkMode!=="always"),h.throwOnError===void 0&&(h.throwOnError=!!h.suspense),!h.networkMode&&h.persister&&(h.networkMode="offlineFirst"),h.queryFn===GA&&(h.enabled=!1),h}defaultMutationOptions(u){return u?._defaulted?u:{...this.#n.mutations,...u?.mutationKey&&this.getMutationDefaults(u.mutationKey),...u,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},JZ=ee.createContext(void 0),QZ=({client:u,children:h})=>(ee.useEffect(()=>(u.mount(),()=>{u.unmount()}),[u]),O.jsx(JZ.Provider,{value:u,children:h}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function DE(){return DE=Object.assign?Object.assign.bind():function(u){for(var h=1;h<arguments.length;h++){var f=arguments[h];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])}return u},DE.apply(this,arguments)}var zd;(function(u){u.Pop="POP",u.Push="PUSH",u.Replace="REPLACE"})(zd||(zd={}));const F4="popstate";function $Z(u){u===void 0&&(u={});function h(g,S){let{pathname:T,search:R,hash:N}=g.location;return SA("",{pathname:T,search:R,hash:N},S.state&&S.state.usr||null,S.state&&S.state.key||"default")}function f(g,S){return typeof S=="string"?S:B8(S)}return eee(h,f,null,u)}function ci(u,h){if(u===!1||u===null||typeof u>"u")throw new Error(h)}function F8(u,h){if(!u){typeof console<"u"&&console.warn(h);try{throw new Error(h)}catch{}}}function ZZ(){return Math.random().toString(36).substr(2,8)}function B4(u,h){return{usr:u.state,key:u.key,idx:h}}function SA(u,h,f,g){return f===void 0&&(f=null),DE({pathname:typeof u=="string"?u:u.pathname,search:"",hash:""},typeof h=="string"?pm(h):h,{state:f,key:h&&h.key||g||ZZ()})}function B8(u){let{pathname:h="/",search:f="",hash:g=""}=u;return f&&f!=="?"&&(h+=f.charAt(0)==="?"?f:"?"+f),g&&g!=="#"&&(h+=g.charAt(0)==="#"?g:"#"+g),h}function pm(u){let h={};if(u){let f=u.indexOf("#");f>=0&&(h.hash=u.substr(f),u=u.substr(0,f));let g=u.indexOf("?");g>=0&&(h.search=u.substr(g),u=u.substr(0,g)),u&&(h.pathname=u)}return h}function eee(u,h,f,g){g===void 0&&(g={});let{window:S=document.defaultView,v5Compat:T=!1}=g,R=S.history,N=zd.Pop,k=null,x=U();x==null&&(x=0,R.replaceState(DE({},R.state,{idx:x}),""));function U(){return(R.state||{idx:null}).idx}function B(){N=zd.Pop;let te=U(),ce=te==null?null:te-x;x=te,k&&k({action:N,location:X.location,delta:ce})}function Y(te,ce){N=zd.Push;let $=SA(X.location,te,ce);x=U()+1;let le=B4($,x),ne=X.createHref($);try{R.pushState(le,"",ne)}catch(ue){if(ue instanceof DOMException&&ue.name==="DataCloneError")throw ue;S.location.assign(ne)}T&&k&&k({action:N,location:X.location,delta:1})}function H(te,ce){N=zd.Replace;let $=SA(X.location,te,ce);x=U();let le=B4($,x),ne=X.createHref($);R.replaceState(le,"",ne),T&&k&&k({action:N,location:X.location,delta:0})}function re(te){let ce=S.location.origin!=="null"?S.location.origin:S.location.href,$=typeof te=="string"?te:B8(te);return $=$.replace(/ $/,"%20"),ci(ce,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,ce)}let X={get action(){return N},get location(){return u(S,R)},listen(te){if(k)throw new Error("A history only accepts one active listener");return S.addEventListener(F4,B),k=te,()=>{S.removeEventListener(F4,B),k=null}},createHref(te){return h(S,te)},createURL:re,encodeLocation(te){let ce=re(te);return{pathname:ce.pathname,search:ce.search,hash:ce.hash}},push:Y,replace:H,go(te){return R.go(te)}};return X}var W4;(function(u){u.data="data",u.deferred="deferred",u.redirect="redirect",u.error="error"})(W4||(W4={}));function tee(u,h,f){return f===void 0&&(f="/"),nee(u,h,f)}function nee(u,h,f,g){let S=typeof h=="string"?pm(h):h,T=H8(S.pathname||"/",f);if(T==null)return null;let R=W8(u);ree(R);let N=null;for(let k=0;N==null&&k<R.length;++k){let x=mee(T);N=hee(R[k],x)}return N}function W8(u,h,f,g){h===void 0&&(h=[]),f===void 0&&(f=[]),g===void 0&&(g="");let S=(T,R,N)=>{let k={relativePath:N===void 0?T.path||"":N,caseSensitive:T.caseSensitive===!0,childrenIndex:R,route:T};k.relativePath.startsWith("/")&&(ci(k.relativePath.startsWith(g),'Absolute route path "'+k.relativePath+'" nested under path '+('"'+g+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),k.relativePath=k.relativePath.slice(g.length));let x=Vh([g,k.relativePath]),U=f.concat(k);T.children&&T.children.length>0&&(ci(T.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),W8(T.children,h,U,x)),!(T.path==null&&!T.index)&&h.push({path:x,score:dee(x,T.index),routesMeta:U})};return u.forEach((T,R)=>{var N;if(T.path===""||!((N=T.path)!=null&&N.includes("?")))S(T,R);else for(let k of G8(T.path))S(T,R,k)}),h}function G8(u){let h=u.split("/");if(h.length===0)return[];let[f,...g]=h,S=f.endsWith("?"),T=f.replace(/\?$/,"");if(g.length===0)return S?[T,""]:[T];let R=G8(g.join("/")),N=[];return N.push(...R.map(k=>k===""?T:[T,k].join("/"))),S&&N.push(...R),N.map(k=>u.startsWith("/")&&k===""?"/":k)}function ree(u){u.sort((h,f)=>h.score!==f.score?f.score-h.score:uee(h.routesMeta.map(g=>g.childrenIndex),f.routesMeta.map(g=>g.childrenIndex)))}const iee=/^:[\w-]+$/,see=3,oee=2,aee=1,cee=10,lee=-2,G4=u=>u==="*";function dee(u,h){let f=u.split("/"),g=f.length;return f.some(G4)&&(g+=lee),h&&(g+=oee),f.filter(S=>!G4(S)).reduce((S,T)=>S+(iee.test(T)?see:T===""?aee:cee),g)}function uee(u,h){return u.length===h.length&&u.slice(0,-1).every((g,S)=>g===h[S])?u[u.length-1]-h[h.length-1]:0}function hee(u,h,f){let{routesMeta:g}=u,S={},T="/",R=[];for(let N=0;N<g.length;++N){let k=g[N],x=N===g.length-1,U=T==="/"?h:h.slice(T.length)||"/",B=pee({path:k.relativePath,caseSensitive:k.caseSensitive,end:x},U),Y=k.route;if(!B)return null;Object.assign(S,B.params),R.push({params:S,pathname:Vh([T,B.pathname]),pathnameBase:yee(Vh([T,B.pathnameBase])),route:Y}),B.pathnameBase!=="/"&&(T=Vh([T,B.pathnameBase]))}return R}function pee(u,h){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[f,g]=fee(u.path,u.caseSensitive,u.end),S=h.match(f);if(!S)return null;let T=S[0],R=T.replace(/(.)\/+$/,"$1"),N=S.slice(1);return{params:g.reduce((x,U,B)=>{let{paramName:Y,isOptional:H}=U;if(Y==="*"){let X=N[B]||"";R=T.slice(0,T.length-X.length).replace(/(.)\/+$/,"$1")}const re=N[B];return H&&!re?x[Y]=void 0:x[Y]=(re||"").replace(/%2F/g,"/"),x},{}),pathname:T,pathnameBase:R,pattern:u}}function fee(u,h,f){h===void 0&&(h=!1),f===void 0&&(f=!0),F8(u==="*"||!u.endsWith("*")||u.endsWith("/*"),'Route path "'+u+'" will be treated as if it were '+('"'+u.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+u.replace(/\*$/,"/*")+'".'));let g=[],S="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(R,N,k)=>(g.push({paramName:N,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return u.endsWith("*")?(g.push({paramName:"*"}),S+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):f?S+="\\/*$":u!==""&&u!=="/"&&(S+="(?:(?=\\/|$))"),[new RegExp(S,h?void 0:"i"),g]}function mee(u){try{return u.split("/").map(h=>decodeURIComponent(h).replace(/\//g,"%2F")).join("/")}catch(h){return F8(!1,'The URL path "'+u+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+h+").")),u}}function H8(u,h){if(h==="/")return u;if(!u.toLowerCase().startsWith(h.toLowerCase()))return null;let f=h.endsWith("/")?h.length-1:h.length,g=u.charAt(f);return g&&g!=="/"?null:u.slice(f)||"/"}function _ee(u,h){h===void 0&&(h="/");let{pathname:f,search:g="",hash:S=""}=typeof u=="string"?pm(u):u;return{pathname:f?f.startsWith("/")?f:gee(f,h):h,search:Tee(g),hash:Cee(S)}}function gee(u,h){let f=h.replace(/\/+$/,"").split("/");return u.split("/").forEach(S=>{S===".."?f.length>1&&f.pop():S!=="."&&f.push(S)}),f.length>1?f.join("/"):"/"}function t1(u,h,f,g){return"Cannot include a '"+u+"' character in a manually specified "+("`to."+h+"` field ["+JSON.stringify(g)+"].  Please separate it out to the ")+("`to."+f+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Eee(u){return u.filter((h,f)=>f===0||h.route.path&&h.route.path.length>0)}function vee(u,h){let f=Eee(u);return h?f.map((g,S)=>S===f.length-1?g.pathname:g.pathnameBase):f.map(g=>g.pathnameBase)}function See(u,h,f,g){g===void 0&&(g=!1);let S;typeof u=="string"?S=pm(u):(S=DE({},u),ci(!S.pathname||!S.pathname.includes("?"),t1("?","pathname","search",S)),ci(!S.pathname||!S.pathname.includes("#"),t1("#","pathname","hash",S)),ci(!S.search||!S.search.includes("#"),t1("#","search","hash",S)));let T=u===""||S.pathname==="",R=T?"/":S.pathname,N;if(R==null)N=f;else{let B=h.length-1;if(!g&&R.startsWith("..")){let Y=R.split("/");for(;Y[0]==="..";)Y.shift(),B-=1;S.pathname=Y.join("/")}N=B>=0?h[B]:"/"}let k=_ee(S,N),x=R&&R!=="/"&&R.endsWith("/"),U=(T||R===".")&&f.endsWith("/");return!k.pathname.endsWith("/")&&(x||U)&&(k.pathname+="/"),k}const Vh=u=>u.join("/").replace(/\/\/+/g,"/"),yee=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),Tee=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,Cee=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function wee(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}const K8=["post","put","patch","delete"];new Set(K8);const Ree=["get",...K8];new Set(Ree);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function LE(){return LE=Object.assign?Object.assign.bind():function(u){for(var h=1;h<arguments.length;h++){var f=arguments[h];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(u[g]=f[g])}return u},LE.apply(this,arguments)}const HA=ee.createContext(null),bee=ee.createContext(null),k0=ee.createContext(null),D0=ee.createContext(null),fm=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),z8=ee.createContext(null);function L0(){return ee.useContext(D0)!=null}function x0(){return L0()||ci(!1),ee.useContext(D0).location}function Y8(u){ee.useContext(k0).static||ee.useLayoutEffect(u)}function $d(){let{isDataRoute:u}=ee.useContext(fm);return u?jee():Iee()}function Iee(){L0()||ci(!1);let u=ee.useContext(HA),{basename:h,future:f,navigator:g}=ee.useContext(k0),{matches:S}=ee.useContext(fm),{pathname:T}=x0(),R=JSON.stringify(vee(S,f.v7_relativeSplatPath)),N=ee.useRef(!1);return Y8(()=>{N.current=!0}),ee.useCallback(function(x,U){if(U===void 0&&(U={}),!N.current)return;if(typeof x=="number"){g.go(x);return}let B=See(x,JSON.parse(R),T,U.relative==="path");u==null&&h!=="/"&&(B.pathname=B.pathname==="/"?h:Vh([h,B.pathname])),(U.replace?g.replace:g.push)(B,U.state,U)},[h,g,R,T,u])}function Aee(u,h){return Oee(u,h)}function Oee(u,h,f,g){L0()||ci(!1);let{navigator:S}=ee.useContext(k0),{matches:T}=ee.useContext(fm),R=T[T.length-1],N=R?R.params:{};R&&R.pathname;let k=R?R.pathnameBase:"/";R&&R.route;let x=x0(),U;if(h){var B;let te=typeof h=="string"?pm(h):h;k==="/"||(B=te.pathname)!=null&&B.startsWith(k)||ci(!1),U=te}else U=x;let Y=U.pathname||"/",H=Y;if(k!=="/"){let te=k.replace(/^\//,"").split("/");H="/"+Y.replace(/^\//,"").split("/").slice(te.length).join("/")}let re=tee(u,{pathname:H}),X=Lee(re&&re.map(te=>Object.assign({},te,{params:Object.assign({},N,te.params),pathname:Vh([k,S.encodeLocation?S.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?k:Vh([k,S.encodeLocation?S.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),T,f,g);return h&&X?ee.createElement(D0.Provider,{value:{location:LE({pathname:"/",search:"",hash:"",state:null,key:"default"},U),navigationType:zd.Pop}},X):X}function Nee(){let u=Vee(),h=wee(u)?u.status+" "+u.statusText:u instanceof Error?u.message:JSON.stringify(u),f=u instanceof Error?u.stack:null,S={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},h),f?ee.createElement("pre",{style:S},f):null,null)}const Pee=ee.createElement(Nee,null);class kee extends ee.Component{constructor(h){super(h),this.state={location:h.location,revalidation:h.revalidation,error:h.error}}static getDerivedStateFromError(h){return{error:h}}static getDerivedStateFromProps(h,f){return f.location!==h.location||f.revalidation!=="idle"&&h.revalidation==="idle"?{error:h.error,location:h.location,revalidation:h.revalidation}:{error:h.error!==void 0?h.error:f.error,location:f.location,revalidation:h.revalidation||f.revalidation}}componentDidCatch(h,f){console.error("React Router caught the following error during render",h,f)}render(){return this.state.error!==void 0?ee.createElement(fm.Provider,{value:this.props.routeContext},ee.createElement(z8.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Dee(u){let{routeContext:h,match:f,children:g}=u,S=ee.useContext(HA);return S&&S.static&&S.staticContext&&(f.route.errorElement||f.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=f.route.id),ee.createElement(fm.Provider,{value:h},g)}function Lee(u,h,f,g){var S;if(h===void 0&&(h=[]),f===void 0&&(f=null),g===void 0&&(g=null),u==null){var T;if(!f)return null;if(f.errors)u=f.matches;else if((T=g)!=null&&T.v7_partialHydration&&h.length===0&&!f.initialized&&f.matches.length>0)u=f.matches;else return null}let R=u,N=(S=f)==null?void 0:S.errors;if(N!=null){let U=R.findIndex(B=>B.route.id&&N?.[B.route.id]!==void 0);U>=0||ci(!1),R=R.slice(0,Math.min(R.length,U+1))}let k=!1,x=-1;if(f&&g&&g.v7_partialHydration)for(let U=0;U<R.length;U++){let B=R[U];if((B.route.HydrateFallback||B.route.hydrateFallbackElement)&&(x=U),B.route.id){let{loaderData:Y,errors:H}=f,re=B.route.loader&&Y[B.route.id]===void 0&&(!H||H[B.route.id]===void 0);if(B.route.lazy||re){k=!0,x>=0?R=R.slice(0,x+1):R=[R[0]];break}}}return R.reduceRight((U,B,Y)=>{let H,re=!1,X=null,te=null;f&&(H=N&&B.route.id?N[B.route.id]:void 0,X=B.route.errorElement||Pee,k&&(x<0&&Y===0?(Fee("route-fallback"),re=!0,te=null):x===Y&&(re=!0,te=B.route.hydrateFallbackElement||null)));let ce=h.concat(R.slice(0,Y+1)),$=()=>{let le;return H?le=X:re?le=te:B.route.Component?le=ee.createElement(B.route.Component,null):B.route.element?le=B.route.element:le=U,ee.createElement(Dee,{match:B,routeContext:{outlet:U,matches:ce,isDataRoute:f!=null},children:le})};return f&&(B.route.ErrorBoundary||B.route.errorElement||Y===0)?ee.createElement(kee,{location:f.location,revalidation:f.revalidation,component:X,error:H,children:$(),routeContext:{outlet:null,matches:ce,isDataRoute:!0}}):$()},null)}var q8=function(u){return u.UseBlocker="useBlocker",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u}(q8||{}),X8=function(u){return u.UseBlocker="useBlocker",u.UseLoaderData="useLoaderData",u.UseActionData="useActionData",u.UseRouteError="useRouteError",u.UseNavigation="useNavigation",u.UseRouteLoaderData="useRouteLoaderData",u.UseMatches="useMatches",u.UseRevalidator="useRevalidator",u.UseNavigateStable="useNavigate",u.UseRouteId="useRouteId",u}(X8||{});function xee(u){let h=ee.useContext(HA);return h||ci(!1),h}function Mee(u){let h=ee.useContext(bee);return h||ci(!1),h}function Uee(u){let h=ee.useContext(fm);return h||ci(!1),h}function J8(u){let h=Uee(),f=h.matches[h.matches.length-1];return f.route.id||ci(!1),f.route.id}function Vee(){var u;let h=ee.useContext(z8),f=Mee(),g=J8();return h!==void 0?h:(u=f.errors)==null?void 0:u[g]}function jee(){let{router:u}=xee(q8.UseNavigateStable),h=J8(X8.UseNavigateStable),f=ee.useRef(!1);return Y8(()=>{f.current=!0}),ee.useCallback(function(S,T){T===void 0&&(T={}),f.current&&(typeof S=="number"?u.navigate(S):u.navigate(S,LE({fromRouteId:h},T)))},[u,h])}const H4={};function Fee(u,h,f){H4[u]||(H4[u]=!0)}function Bee(u,h){u?.v7_startTransition,u?.v7_relativeSplatPath}function cs(u){ci(!1)}function Wee(u){let{basename:h="/",children:f=null,location:g,navigationType:S=zd.Pop,navigator:T,static:R=!1,future:N}=u;L0()&&ci(!1);let k=h.replace(/^\/*/,"/"),x=ee.useMemo(()=>({basename:k,navigator:T,static:R,future:LE({v7_relativeSplatPath:!1},N)}),[k,N,T,R]);typeof g=="string"&&(g=pm(g));let{pathname:U="/",search:B="",hash:Y="",state:H=null,key:re="default"}=g,X=ee.useMemo(()=>{let te=H8(U,k);return te==null?null:{location:{pathname:te,search:B,hash:Y,state:H,key:re},navigationType:S}},[k,U,B,Y,H,re,S]);return X==null?null:ee.createElement(k0.Provider,{value:x},ee.createElement(D0.Provider,{children:f,value:X}))}function Gee(u){let{children:h,location:f}=u;return Aee(yA(h),f)}new Promise(()=>{});function yA(u,h){h===void 0&&(h=[]);let f=[];return ee.Children.forEach(u,(g,S)=>{if(!ee.isValidElement(g))return;let T=[...h,S];if(g.type===ee.Fragment){f.push.apply(f,yA(g.props.children,T));return}g.type!==cs&&ci(!1),!g.props.index||!g.props.children||ci(!1);let R={id:g.props.id||T.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:g.props.ErrorBoundary!=null||g.props.errorElement!=null,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(R.children=yA(g.props.children,T)),f.push(R)}),f}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Hee="6";try{window.__reactRouterVersion=Hee}catch{}const Kee="startTransition",K4=pj[Kee];function zee(u){let{basename:h,children:f,future:g,window:S}=u,T=ee.useRef();T.current==null&&(T.current=$Z({window:S,v5Compat:!0}));let R=T.current,[N,k]=ee.useState({action:R.action,location:R.location}),{v7_startTransition:x}=g||{},U=ee.useCallback(B=>{x&&K4?K4(()=>k(B)):k(B)},[k,x]);return ee.useLayoutEffect(()=>R.listen(U),[R,U]),ee.useEffect(()=>Bee(g),[g]),ee.createElement(Wee,{basename:h,children:f,location:N.location,navigationType:N.action,navigator:R,future:g})}var z4;(function(u){u.UseScrollRestoration="useScrollRestoration",u.UseSubmit="useSubmit",u.UseSubmitFetcher="useSubmitFetcher",u.UseFetcher="useFetcher",u.useViewTransitionState="useViewTransitionState"})(z4||(z4={}));var Y4;(function(u){u.UseFetcher="useFetcher",u.UseFetchers="useFetchers",u.UseScrollRestoration="useScrollRestoration"})(Y4||(Y4={}));/*! Capacitor: https://capacitorjs.com/ - MIT License */var cm;(function(u){u.Unimplemented="UNIMPLEMENTED",u.Unavailable="UNAVAILABLE"})(cm||(cm={}));class n1 extends Error{constructor(h,f,g){super(h),this.message=h,this.code=f,this.data=g}}const Yee=u=>{var h,f;return u?.androidBridge?"android":!((f=(h=u?.webkit)===null||h===void 0?void 0:h.messageHandlers)===null||f===void 0)&&f.bridge?"ios":"web"},qee=u=>{const h=u.CapacitorCustomPlatform||null,f=u.Capacitor||{},g=f.Plugins=f.Plugins||{},S=()=>h!==null?h.name:Yee(u),T=()=>S()!=="web",R=B=>{const Y=x.get(B);return!!(Y?.platforms.has(S())||N(B))},N=B=>{var Y;return(Y=f.PluginHeaders)===null||Y===void 0?void 0:Y.find(H=>H.name===B)},k=B=>u.console.error(B),x=new Map,U=(B,Y={})=>{const H=x.get(B);if(H)return console.warn(`Capacitor plugin "${B}" already registered. Cannot register plugins twice.`),H.proxy;const re=S(),X=N(B);let te;const ce=async()=>(!te&&re in Y?te=typeof Y[re]=="function"?te=await Y[re]():te=Y[re]:h!==null&&!te&&"web"in Y&&(te=typeof Y.web=="function"?te=await Y.web():te=Y.web),te),$=(de,ye)=>{var Me,Je;if(X){const Ve=X?.methods.find(xe=>ye===xe.name);if(Ve)return Ve.rtype==="promise"?xe=>f.nativePromise(B,ye.toString(),xe):(xe,He)=>f.nativeCallback(B,ye.toString(),xe,He);if(de)return(Me=de[ye])===null||Me===void 0?void 0:Me.bind(de)}else{if(de)return(Je=de[ye])===null||Je===void 0?void 0:Je.bind(de);throw new n1(`"${B}" plugin is not implemented on ${re}`,cm.Unimplemented)}},le=de=>{let ye;const Me=(...Je)=>{const Ve=ce().then(xe=>{const He=$(xe,de);if(He){const dt=He(...Je);return ye=dt?.remove,dt}else throw new n1(`"${B}.${de}()" is not implemented on ${re}`,cm.Unimplemented)});return de==="addListener"&&(Ve.remove=async()=>ye()),Ve};return Me.toString=()=>`${de.toString()}() { [capacitor code] }`,Object.defineProperty(Me,"name",{value:de,writable:!1,configurable:!1}),Me},ne=le("addListener"),ue=le("removeListener"),Pe=(de,ye)=>{const Me=ne({eventName:de},ye),Je=async()=>{const xe=await Me;ue({eventName:de,callbackId:xe},ye)},Ve=new Promise(xe=>Me.then(()=>xe({remove:Je})));return Ve.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Je()},Ve},he=new Proxy({},{get(de,ye){switch(ye){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return X?Pe:ne;case"removeListener":return ue;default:return le(ye)}}});return g[B]=he,x.set(B,{name:B,proxy:he,platforms:new Set([...Object.keys(Y),...X?[re]:[]])}),he};return f.convertFileSrc||(f.convertFileSrc=B=>B),f.getPlatform=S,f.handleError=k,f.isNativePlatform=T,f.isPluginAvailable=R,f.registerPlugin=U,f.Exception=n1,f.DEBUG=!!f.DEBUG,f.isLoggingEnabled=!!f.isLoggingEnabled,f},Xee=u=>u.Capacitor=qee(u),lm=Xee(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}),mm=lm.registerPlugin;class Q8{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(h,f){let g=!1;this.listeners[h]||(this.listeners[h]=[],g=!0),this.listeners[h].push(f);const T=this.windowListeners[h];T&&!T.registered&&this.addWindowListener(T),g&&this.sendRetainedArgumentsForEvent(h);const R=async()=>this.removeListener(h,f);return Promise.resolve({remove:R})}async removeAllListeners(){this.listeners={};for(const h in this.windowListeners)this.removeWindowListener(this.windowListeners[h]);this.windowListeners={}}notifyListeners(h,f,g){const S=this.listeners[h];if(!S){if(g){let T=this.retainedEventArguments[h];T||(T=[]),T.push(f),this.retainedEventArguments[h]=T}return}S.forEach(T=>T(f))}hasListeners(h){var f;return!!(!((f=this.listeners[h])===null||f===void 0)&&f.length)}registerWindowListener(h,f){this.windowListeners[f]={registered:!1,windowEventName:h,pluginEventName:f,handler:g=>{this.notifyListeners(f,g)}}}unimplemented(h="not implemented"){return new lm.Exception(h,cm.Unimplemented)}unavailable(h="not available"){return new lm.Exception(h,cm.Unavailable)}async removeListener(h,f){const g=this.listeners[h];if(!g)return;const S=g.indexOf(f);this.listeners[h].splice(S,1),this.listeners[h].length||this.removeWindowListener(this.windowListeners[h])}addWindowListener(h){window.addEventListener(h.windowEventName,h.handler),h.registered=!0}removeWindowListener(h){h&&(window.removeEventListener(h.windowEventName,h.handler),h.registered=!1)}sendRetainedArgumentsForEvent(h){const f=this.retainedEventArguments[h];f&&(delete this.retainedEventArguments[h],f.forEach(g=>{this.notifyListeners(h,g)}))}}const q4=u=>encodeURIComponent(u).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),X4=u=>u.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Jee extends Q8{async getCookies(){const h=document.cookie,f={};return h.split(";").forEach(g=>{if(g.length<=0)return;let[S,T]=g.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");S=X4(S).trim(),T=X4(T).trim(),f[S]=T}),f}async setCookie(h){try{const f=q4(h.key),g=q4(h.value),S=`; expires=${(h.expires||"").replace("expires=","")}`,T=(h.path||"/").replace("path=",""),R=h.url!=null&&h.url.length>0?`domain=${h.url}`:"";document.cookie=`${f}=${g||""}${S}; path=${T}; ${R};`}catch(f){return Promise.reject(f)}}async deleteCookie(h){try{document.cookie=`${h.key}=; Max-Age=0`}catch(f){return Promise.reject(f)}}async clearCookies(){try{const h=document.cookie.split(";")||[];for(const f of h)document.cookie=f.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(h){return Promise.reject(h)}}async clearAllCookies(){try{await this.clearCookies()}catch(h){return Promise.reject(h)}}}mm("CapacitorCookies",{web:()=>new Jee});const Qee=async u=>new Promise((h,f)=>{const g=new FileReader;g.onload=()=>{const S=g.result;h(S.indexOf(",")>=0?S.split(",")[1]:S)},g.onerror=S=>f(S),g.readAsDataURL(u)}),$ee=(u={})=>{const h=Object.keys(u);return Object.keys(u).map(S=>S.toLocaleLowerCase()).reduce((S,T,R)=>(S[T]=u[h[R]],S),{})},Zee=(u,h=!0)=>u?Object.entries(u).reduce((g,S)=>{const[T,R]=S;let N,k;return Array.isArray(R)?(k="",R.forEach(x=>{N=h?encodeURIComponent(x):x,k+=`${T}=${N}&`}),k.slice(0,-1)):(N=h?encodeURIComponent(R):R,k=`${T}=${N}`),`${g}&${k}`},"").substr(1):null,ete=(u,h={})=>{const f=Object.assign({method:u.method||"GET",headers:u.headers},h),S=$ee(u.headers)["content-type"]||"";if(typeof u.data=="string")f.body=u.data;else if(S.includes("application/x-www-form-urlencoded")){const T=new URLSearchParams;for(const[R,N]of Object.entries(u.data||{}))T.set(R,N);f.body=T.toString()}else if(S.includes("multipart/form-data")||u.data instanceof FormData){const T=new FormData;if(u.data instanceof FormData)u.data.forEach((N,k)=>{T.append(k,N)});else for(const N of Object.keys(u.data))T.append(N,u.data[N]);f.body=T;const R=new Headers(f.headers);R.delete("content-type"),f.headers=R}else(S.includes("application/json")||typeof u.data=="object")&&(f.body=JSON.stringify(u.data));return f};class tte extends Q8{async request(h){const f=ete(h,h.webFetchExtra),g=Zee(h.params,h.shouldEncodeUrlParams),S=g?`${h.url}?${g}`:h.url,T=await fetch(S,f),R=T.headers.get("content-type")||"";let{responseType:N="text"}=T.ok?h:{};R.includes("application/json")&&(N="json");let k,x;switch(N){case"arraybuffer":case"blob":x=await T.blob(),k=await Qee(x);break;case"json":k=await T.json();break;case"document":case"text":default:k=await T.text()}const U={};return T.headers.forEach((B,Y)=>{U[Y]=B}),{data:k,headers:U,status:T.status,url:T.url}}async get(h){return this.request(Object.assign(Object.assign({},h),{method:"GET"}))}async post(h){return this.request(Object.assign(Object.assign({},h),{method:"POST"}))}async put(h){return this.request(Object.assign(Object.assign({},h),{method:"PUT"}))}async patch(h){return this.request(Object.assign(Object.assign({},h),{method:"PATCH"}))}async delete(h){return this.request(Object.assign(Object.assign({},h),{method:"DELETE"}))}}mm("CapacitorHttp",{web:()=>new tte});const nte="modulepreload",rte=function(u){return"/"+u},J4={},Yd=function(h,f,g){let S=Promise.resolve();if(f&&f.length>0){let k=function(x){return Promise.all(x.map(U=>Promise.resolve(U).then(B=>({status:"fulfilled",value:B}),B=>({status:"rejected",reason:B}))))};document.getElementsByTagName("link");const R=document.querySelector("meta[property=csp-nonce]"),N=R?.nonce||R?.getAttribute("nonce");S=k(f.map(x=>{if(x=rte(x),x in J4)return;J4[x]=!0;const U=x.endsWith(".css"),B=U?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${B}`))return;const Y=document.createElement("link");if(Y.rel=U?"stylesheet":nte,U||(Y.as="script"),Y.crossOrigin="",Y.href=x,N&&Y.setAttribute("nonce",N),document.head.appendChild(Y),U)return new Promise((H,re)=>{Y.addEventListener("load",H),Y.addEventListener("error",()=>re(new Error(`Unable to preload CSS for ${x}`)))})}))}function T(R){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=R,window.dispatchEvent(N),!N.defaultPrevented)throw R}return S.then(R=>{for(const N of R||[])N.status==="rejected"&&T(N.reason);return h().catch(T)})},e0=mm("Browser",{web:()=>Yd(()=>import("./web-xhSiRDX7.js"),[]).then(u=>new u.BrowserWeb)}),ite=mm("App",{web:()=>Yd(()=>import("./web-DZeneVBw.js"),[]).then(u=>new u.AppWeb)}),ste=mm("KakaoLoginPlugin",{web:()=>Yd(()=>import("./web-CECmXW2k.js"),[]).then(u=>new u.KakaoLoginPluginWeb)}),Q4=mm("GoogleAuth",{web:()=>Yd(()=>import("./web-UgpMyCeD.js"),[]).then(u=>new u.GoogleAuthWeb)}),ote=u=>"<URL>",ate=u=>u?"<TOKEN>":"<EMPTY>",$8=u=>{if(!u)return"Unknown error";let h=u instanceof Error?u.message:String(u);return h=h.replace(/https?:\/\/[^\s'"]+/g,"<URL>"),h},KA=u=>{if(!u||typeof u!="object")return u;const h={...u},f=["url","authorization_url","token","access_token","refresh_token","code","state","code_verifier","code_challenge"];for(const g of f)g in h&&(g.includes("url")?h[g]="<URL>":h[g]="<REDACTED>");return h},cte=(...u)=>{const h=u.map(f=>typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?KA(f):f);console.log(...h)},lte=(...u)=>{const h=u.map(f=>f instanceof Error?$8(f):typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?KA(f):f);console.error(...h)},dte=(...u)=>{const h=u.map(f=>typeof f=="string"?/https?:\/\//.test(f)?f.replace(/https?:\/\/[^\s'"]+/g,"<URL>"):f:typeof f=="object"?KA(f):f);console.warn(...h)},ute=(u,h,f)=>{},hte=(u,h,f,g)=>{},pte=(u,h)=>{},Fe={log:cte,error:lte,warn:dte,apiRequest:ute,apiResponse:hte,debugGroup:pte,maskUrl:ote,maskToken:ate,maskErrorMessage:$8},po=()=>{if(console.log("  URL:",window.location.href),console.log("  Origin:",window.location.origin),console.log(" Capacitor Native:",lm.isNativePlatform()),lm.isNativePlatform())return console.log("   -   "),"https://silverld.site/api";const u="http://localhost:8080/api";return console.log("  -  :",u),String(u).replace(/\/$/,"")};let zA=null,wE=!1,TA=[];const pr={STATE:"oauth_state",CODE_VERIFIER:"oauth_code_verifier",PROVIDER:"oauth_provider",USER_INFO:"user_info"},_m=(u,h)=>{zA=u,Fe.log(" Access token   ")},YA=()=>zA,CA=()=>{zA=null,Fe.log("  access token  ")},fte=u=>{TA.push(u)},r1=u=>{TA.forEach(h=>h(u)),TA=[]},Z8=async u=>{try{const h={email:u.email.trim(),password:u.password,real_name:u.real_name.trim()};Fe.apiRequest("POST","/v1/auth/signup");const f=new AbortController,g=setTimeout(()=>f.abort(),3e4);let S;try{S=await fetch(`${po()}/v1/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include",signal:f.signal})}finally{clearTimeout(g)}const T=await S.text();if(!S.ok){Fe.error("  :",{status:S.status,statusText:S.statusText});let k=" .";try{const x=JSON.parse(T);Fe.error("   :",x),k=x.message||k,x.errors&&x.errors.length>0&&(k=x.errors.map(B=>B.message).join(", ")||k)}catch(x){Fe.error("   :",x),Fe.error(" :",T),T?k=T:k=` . ( : ${S.status})`}throw new Error(k)}let R;try{R=JSON.parse(T)}catch(k){throw Fe.error("  :",k),new Error("     .")}_m(R.data.access_token,R.data.expires_in);const N={id:R.data.user_info.id,is_new_user:R.data.user_info.is_new_user,is_profile_complete:R.data.user_info.is_profile_complete};return localStorage.setItem(pr.USER_INFO,JSON.stringify(N)),Fe.log("  "),R}catch(h){throw Fe.error(" :",h),h}},eF=async u=>{try{const h={email:u.email.trim(),password:u.password};Fe.apiRequest("POST","/v1/auth/login");const f=new AbortController,g=setTimeout(()=>f.abort(),3e4);let S;try{S=await fetch(`${po()}/v1/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include",signal:f.signal})}finally{clearTimeout(g)}const T=await S.text();if(!S.ok){Fe.error("  :",{status:S.status,statusText:S.statusText});let k=" .";try{const x=JSON.parse(T);Fe.error("   :",x),k=x.message||k,x.errors&&x.errors.length>0&&(k=x.errors.map(B=>B.message).join(", ")||k)}catch(x){Fe.error("   :",x),Fe.error(" :",T),T?k=T:k=` . ( : ${S.status})`}throw new Error(k)}let R;try{R=JSON.parse(T)}catch(k){throw Fe.error("  :",k),new Error("     .")}_m(R.data.access_token,R.data.expires_in);const N={id:R.data.user_info.id,is_new_user:R.data.user_info.is_new_user,is_profile_complete:R.data.user_info.is_profile_complete};return localStorage.setItem(pr.USER_INFO,JSON.stringify(N)),Fe.log("  "),R}catch(h){throw Fe.error(" :",h),h}},tF=async(u,h="web")=>{try{const f=`${po()}/v1/auth/oauth/${u}/config?platform=${h}`;Fe.apiRequest("GET",`/v1/auth/oauth/${u}/config?platform=${h}`);const g=new AbortController,S=setTimeout(()=>g.abort(),3e4);let T;try{T=await fetch(f,{signal:g.signal})}finally{clearTimeout(S)}if(!T.ok){const R=T.headers.get("content-type");if(R&&R.includes("application/json")){const N=await T.json();throw new Error(N.message||"OAuth   .")}else{const N=await T.text();throw Fe.error("  :",N),new Error(`    . (${T.status})`)}}return await T.json()}catch(f){throw Fe.error("OAuth   :",f),f}},nF=async u=>{try{const h=lm.isNativePlatform(),f=h?"mobile":"web";Fe.log(`   (: ${f})`,u);const g=await tF(u,f);if(sessionStorage.setItem(pr.STATE,g.data.state),sessionStorage.setItem(pr.CODE_VERIFIER,g.data.code_verifier),sessionStorage.setItem(pr.PROVIDER,u),sessionStorage.setItem("oauth_redirect_uri",g.data.redirect_uri),h)if(u==="kakao"){Fe.log(":    ");try{const S=await ste.goLogin();Fe.log("  :",S);const T=await sF(S.accessToken);T&&(Fe.log("    "),window.dispatchEvent(new CustomEvent("oauth-login-success",{detail:{userInfo:T.data.user_info}})))}catch(S){throw Fe.error("  :",S),window.dispatchEvent(new CustomEvent("oauth-login-error",{detail:{error:S instanceof Error?S.message:"    ."}})),S}}else if(u==="google"){Fe.log(":    ");try{await Q4.initialize({scopes:["profile","email"]}),Fe.log("   ");const S=await Q4.signIn();if(Fe.log("  :",{hasIdToken:!!S.authentication?.idToken,hasAccessToken:!!S.authentication?.accessToken,email:S.email,id:S.id}),!S.authentication?.idToken)throw Fe.error("  :",S),new Error(" ID   .");const T=await iF(S.authentication.idToken);T&&(Fe.log("    "),window.dispatchEvent(new CustomEvent("oauth-login-success",{detail:{userInfo:T.data.user_info}})))}catch(S){Fe.error("  :",S);let T="   ",R={};if(S instanceof Error)T=S.message,R={message:S.message,stack:S.stack,name:S.name};else if(typeof S=="string")T=S,R={message:S};else if(S&&typeof S=="object")try{T=JSON.stringify(S),R=S}catch{T=String(S),R={raw:String(S)}}throw Fe.error("   :",R),Fe.error("   :",T),window.dispatchEvent(new CustomEvent("oauth-login-error",{detail:{error:S instanceof Error?S.message:"    ."}})),S}}else Fe.log(": In-App Browser OAuth  ",u),await e0.open({url:g.data.authorization_url,windowName:"_self"}),window.oauthDeepLinkListenerRegistered||(window.oauthDeepLinkListenerRegistered=!0,ite.addListener("appUrlOpen",async S=>{Fe.log("Deep Link :",S.url);try{const T=new URL(S.url),R=T.searchParams.get("code"),N=T.searchParams.get("state"),k=T.searchParams.get("error");if(k)throw Fe.error("OAuth :",k),await e0.close(),new Error(`OAuth    : ${k}`);if(R&&N){await e0.close();const x=sessionStorage.getItem(pr.STATE),U=sessionStorage.getItem(pr.CODE_VERIFIER),B=sessionStorage.getItem(pr.PROVIDER),Y=sessionStorage.getItem("oauth_redirect_uri"),H=["google","kakao","naver"].find(X=>X===B);if(!H||!x||!U||!Y)throw new Error("OAuth   .  .");if(N!==x)throw new Error("OAuth state  .   .");const re=await qA(H,R,N,U,Y);re&&(Fe.log("  OAuth  "),window.dispatchEvent(new CustomEvent("oauth-login-success",{detail:{userInfo:re.data.user_info}})))}}catch(T){throw Fe.error("Deep Link  :",T),await e0.close(),window.dispatchEvent(new CustomEvent("oauth-login-error",{detail:{error:T instanceof Error?T.message:"    ."}})),T}}));else Fe.log(":  "),window.location.href=g.data.authorization_url}catch(h){throw Fe.error("   :",h),h}},rF=async()=>{const u=new URLSearchParams(window.location.search),h=u.get("code"),f=u.get("state"),g=u.get("error");if(Fe.log("OAuth  :",{code_length:h?.length??0,state_length:f?.length??0,has_error:!!g}),g)throw Fe.error("OAuth :",g),new Error(`OAuth    : ${g}`);if(!h||!f)return null;const S=sessionStorage.getItem(pr.STATE),T=sessionStorage.getItem(pr.CODE_VERIFIER),R=sessionStorage.getItem(pr.PROVIDER),N=["google","kakao","naver"].find(x=>x===R);if(!N)throw sessionStorage.removeItem(pr.STATE),sessionStorage.removeItem(pr.CODE_VERIFIER),sessionStorage.removeItem(pr.PROVIDER),new Error("  OAuth .  .");if(!S||!T||!N)throw new Error("OAuth   .  .");if(f!==S)throw new Error("OAuth state  .   .");const k=sessionStorage.getItem("oauth_redirect_uri");return await qA(N,h,f,T,k||void 0)},iF=async u=>{try{Fe.log("     ");const h={google_id_token:u,device_info:`${navigator.platform} - ${navigator.userAgent.split(" ")[0]}`};Fe.log("  :",{provider:"google",google_token_length:u?.length||0});const f=new AbortController,g=setTimeout(()=>{Fe.error("      (60 )"),f.abort()},6e4),S=Date.now();Fe.apiRequest("POST","/v1/auth/oauth/google/native");let T;try{T=await fetch(`${po()}/v1/auth/oauth/google/native`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include",signal:f.signal});const k=Date.now()-S;Fe.log(`     : ${k}ms`)}catch(k){const x=Date.now()-S;throw Fe.error(`     : ${x}ms`,k),k}finally{clearTimeout(g)}if(!T.ok){Fe.error("    :",{status:T.status,statusText:T.statusText});const k=T.headers.get("content-type");if(k&&k.includes("application/json")){const x=await T.json();throw Fe.error("   :",x),new Error(x.message||" .")}else{const x=await T.text();throw Fe.error("   :",x),new Error(` : ${T.status} ${T.statusText}`)}}const R=await T.json();_m(R.data.access_token,R.data.expires_in);const N={id:R.data.user_info.id,is_new_user:R.data.user_info.is_new_user,is_profile_complete:R.data.user_info.is_profile_complete};return localStorage.setItem(pr.USER_INFO,JSON.stringify(N)),R}catch(h){throw Fe.error("    :",h),h}},sF=async u=>{try{Fe.log("     ");const h={kakao_access_token:u,device_info:`${navigator.platform} - ${navigator.userAgent.split(" ")[0]}`};Fe.log("  :",{provider:"kakao",kakao_token_length:u?.length||0});const f=new AbortController,g=setTimeout(()=>{Fe.error("      (60 )"),f.abort()},6e4),S=Date.now();Fe.apiRequest("POST","/v1/auth/oauth/kakao/native");let T;try{T=await fetch(`${po()}/v1/auth/oauth/kakao/native`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include",signal:f.signal});const k=Date.now()-S;Fe.log(`     : ${k}ms`)}catch(k){const x=Date.now()-S;throw Fe.error(`     : ${x}ms`,k),k}finally{clearTimeout(g)}if(!T.ok){Fe.error("    :",{status:T.status,statusText:T.statusText});const k=T.headers.get("content-type");if(k&&k.includes("application/json")){const x=await T.json();throw Fe.error("   :",x),new Error(x.message||" .")}else{const x=await T.text();throw Fe.error("   :",x),new Error(` : ${T.status} ${T.statusText}`)}}const R=await T.json();_m(R.data.access_token,R.data.expires_in);const N={id:R.data.user_info.id,is_new_user:R.data.user_info.is_new_user,is_profile_complete:R.data.user_info.is_profile_complete};return localStorage.setItem(pr.USER_INFO,JSON.stringify(N)),R}catch(h){throw Fe.error("    :",h),h}},qA=async(u,h,f,g,S)=>{try{const T={code:h,state:f,code_verifier:g,redirect_uri:S,device_info:`${navigator.platform} - ${navigator.userAgent.split(" ")[0]}`};Fe.log("  :",{provider:u,code_length:h?.length||0,state_length:f?.length||0,code_verifier_length:g?.length||0,device_info_length:T.device_info?.length||0});const R=new AbortController,N=setTimeout(()=>{Fe.error(" OAuth   (60 )"),R.abort()},6e4),k=Date.now();Fe.apiRequest("POST",`/v1/auth/oauth/${u}`);let x;try{x=await fetch(`${po()}/v1/auth/oauth/${u}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T),credentials:"include",signal:R.signal});const Y=Date.now()-k;Fe.log(` OAuth   : ${Y}ms`)}catch(Y){const H=Date.now()-k;throw Fe.error(` OAuth   : ${H}ms`,Y),Y}finally{clearTimeout(N)}if(!x.ok){Fe.error("OAuth   :",{status:x.status,statusText:x.statusText});const Y=x.headers.get("content-type");if(Y&&Y.includes("application/json")){const H=await x.json();throw Fe.error("   :",H),Fe.debugGroup("  ",{provider:u,error_code:H.code,error_message:H.message,timestamp:H.timestamp,status:x.status,errors:H.errors||[]}),new Error(H.message||" .")}else{const H=await x.text();throw Fe.error("   :",H),new Error(` : ${x.status} ${x.statusText}`)}}const U=await x.json();_m(U.data.access_token,U.data.expires_in);const B={id:U.data.user_info.id,is_new_user:U.data.user_info.is_new_user,is_profile_complete:U.data.user_info.is_profile_complete};return localStorage.setItem(pr.USER_INFO,JSON.stringify(B)),sessionStorage.removeItem(pr.STATE),sessionStorage.removeItem(pr.CODE_VERIFIER),sessionStorage.removeItem(pr.PROVIDER),U}catch(T){throw Fe.error("   :",T),T}},uo=(u="access_token")=>u==="access_token"?YA():null,xE=()=>{const u=localStorage.getItem(pr.USER_INFO);if(!u)return null;try{return JSON.parse(u)}catch(h){return Fe.error("   :",h),null}},oF=async()=>{try{const u=uo("access_token"),h={"Content-Type":"application/json"};u&&(h.Authorization=`Bearer ${u}`);const f={logout_all:!0};Fe.apiRequest("POST","/v1/auth/logout",f);const g=new AbortController,S=setTimeout(()=>g.abort(),1e4);let T;try{T=await fetch(`${po()}/v1/auth/logout`,{method:"POST",headers:h,body:JSON.stringify(f),credentials:"include",signal:g.signal})}finally{clearTimeout(S)}if(!T.ok)if((T.headers.get("content-type")||"").includes("application/json")){const k=await T.json();throw Fe.error(" API :",k),new Error(` : ${k.message||T.statusText}`)}else{const k=await T.text();throw Fe.error(" API ():",k),new Error(` : ${T.status} ${T.statusText}`)}const R=await T.json();Fe.apiResponse("POST","/v1/auth/logout",T.status,R)}catch(u){throw Fe.error("    :",u),u}},aF=async()=>{try{await oF()}catch(u){Fe.error("  ,   :",u)}finally{try{CA(),localStorage.removeItem(pr.USER_INFO),sessionStorage.removeItem(pr.STATE),sessionStorage.removeItem(pr.CODE_VERIFIER),sessionStorage.removeItem(pr.PROVIDER),Fe.log("  ")}catch(u){Fe.error("    :",u)}}},XA=()=>YA()?(Fe.log(" :  "),!0):(Fe.log(" :  "),!1),JA=async()=>{try{const u=uo("access_token");if(!u)throw new Error("  .");Fe.apiRequest("GET","/v1/auth/me");const h=new AbortController,f=setTimeout(()=>h.abort(),1e4);let g=await fetch(`${po()}/v1/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},credentials:"include",signal:h.signal});if(clearTimeout(f),g.status===401){Fe.log("   401  ,    ...");const T=await yi();if(T){Fe.log("   ,    ...");const R=new AbortController,N=setTimeout(()=>R.abort(),1e4);g=await fetch(`${po()}/v1/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${T}`,"Content-Type":"application/json"},credentials:"include",signal:R.signal}),clearTimeout(N),Fe.log(`     : ${g.status}`)}else throw Fe.error("   "),new Error(" .  .")}if(!g.ok)if((g.headers.get("content-type")||"").includes("application/json")){const R=await g.json();throw Fe.error("  API :",R),new Error(`  : ${R.message||g.statusText}`)}else{const R=await g.text();throw Fe.error("  API ():",R),new Error(`  : ${g.status} ${g.statusText}`)}const S=await g.json();return Fe.apiResponse("GET","/v1/auth/me",g.status,S),S}catch(u){throw Fe.error("     :",u),u}},cF=async u=>{try{const h=uo("access_token");if(!h)throw new Error("  .");const f=u;Fe.apiRequest("PUT","/v1/users/profile",f);const g=new AbortController,S=setTimeout(()=>g.abort(),1e4);let T=await fetch(`${po()}/v1/users/profile`,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(f),credentials:"include",signal:g.signal});if(clearTimeout(S),T.status===401){Fe.log("   401  ,    ...");const N=await yi();if(N){Fe.log("   ,    ...");const k=new AbortController,x=setTimeout(()=>k.abort(),1e4);T=await fetch(`${po()}/v1/users/profile`,{method:"PUT",headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"},body:JSON.stringify(f),credentials:"include",signal:k.signal}),clearTimeout(x),Fe.log(`     : ${T.status}`)}else throw Fe.error("   "),new Error(" .  .")}if(!T.ok)if((T.headers.get("content-type")||"").includes("application/json")){const k=await T.json();throw Fe.error("  API :",k),new Error(`  : ${k.message||T.statusText}`)}else{const k=await T.text();throw Fe.error("  API ():",k),new Error(`  : ${T.status} ${T.statusText}`)}const R=await T.json();return Fe.apiResponse("PUT","/v1/users/profile",T.status,R),R}catch(h){throw Fe.error("    :",h),h}},lF=async()=>{try{return Fe.log("  :   ..."),YA()?(Fe.log("     -  "),!0):await yi()?(Fe.log("   :   "),!0):(Fe.log("  :  refresh token  ( )"),!1)}catch(u){return Fe.error("   :",u),!1}},yi=async()=>{if(wE)return Fe.log("     - ..."),new Promise(u=>{fte(h=>{u(h)})});try{wE=!0,Fe.log("   ...");const u=new AbortController,h=setTimeout(()=>u.abort(),1e4);let f;try{Fe.apiRequest("POST","/v1/auth/refresh"),f=await fetch(`${po()}/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:""}),credentials:"include",signal:u.signal}),Fe.log(`   API  : ${f.status}`)}finally{clearTimeout(h)}if(!f.ok){if(f.status===401)return Fe.warn("   ."),CA(),wE=!1,r1(""),null;throw Fe.error(`   : ${f.status} ${f.statusText}`),new Error(`  : ${f.status}`)}const g=await f.json();return Fe.log("    :",g),_m(g.data.access_token,g.data.expires_in),Fe.log("  access_token   "),Fe.log("   "),wE=!1,r1(g.data.access_token),g.data.access_token}catch(u){return wE=!1,r1(""),u instanceof Error&&u.name==="AbortError"?Fe.error("   :",u):Fe.error("   :",u),CA(),null}},t0=Object.freeze(Object.defineProperty({__proto__:null,getApiUrl:po,getOAuthConfig:tF,getStoredToken:uo,getStoredUserInfo:xE,getUserProfile:JA,initializeAuth:lF,isAuthenticated:XA,login:eF,logout:aF,logoutFromServer:oF,processGoogleNativeLogin:iF,processKakaoNativeLogin:sF,processOAuthCallback:rF,processSocialLogin:qA,refreshToken:yi,signup:Z8,startSocialLogin:nF,updateUserProfile:cF},Symbol.toStringTag,{value:"Module"})),$4=u=>{let h;const f=new Set,g=(x,U)=>{const B=typeof x=="function"?x(h):x;if(!Object.is(B,h)){const Y=h;h=U??(typeof B!="object"||B===null)?B:Object.assign({},h,B),f.forEach(H=>H(h,Y))}},S=()=>h,N={setState:g,getState:S,getInitialState:()=>k,subscribe:x=>(f.add(x),()=>f.delete(x))},k=h=u(g,S,N);return N},mte=u=>u?$4(u):$4,_te=u=>u;function gte(u,h=_te){const f=st.useSyncExternalStore(u.subscribe,st.useCallback(()=>h(u.getState()),[u,h]),st.useCallback(()=>h(u.getInitialState()),[u,h]));return st.useDebugValue(f),f}const Z4=u=>{const h=mte(u),f=g=>gte(h,g);return Object.assign(f,h),f},dF=u=>u?Z4(u):Z4,e3={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"27a8d306ea82463f81a2fbc033c7570c",VITE_API_BASE_URL:"http://localhost:8080/api",VITE_API_BASE_URL_MOBILE:"https://silverld.site/api",VITE_API_BASE_URL_WEB:"http://localhost:8080/api",VITE_CAPACITOR_NAVIGATION_DOMAINS:"https://silverld.site/*,https://kauth.kakao.com/*,https://accounts.google.com/*,https://nid.naver.com/*,http://localhost:8080/*,http://127.0.0.1:8080/*",VITE_DOMAIN_MOBILE:"https://silverld.site",VITE_DOMAIN_WEB:"http://localhost:8080",VITE_KAKAO_NATIVE_APP_KEY:"aa1e70c80567cbfe9b5dfa111ca97ab5",VITE_OAUTH_CALLBACK_MOBILE:"https://silverld.site/oauth/callback?mobile=true",VITE_OAUTH_CALLBACK_WEB:"http://localhost:8080/oauth/callback",VITE_PUBLIC_BUILDER_KEY:"__BUILDER_PUBLIC_KEY__",VITE_WS_BASE_URL:"http://localhost:8080/ws",VITE_WS_BASE_URL_MOBILE:"https://silverld.site/ws",VITE_WS_BASE_URL_WEB:"http://localhost:8080/ws"},ME=new Map,n0=u=>{const h=ME.get(u);return h?Object.fromEntries(Object.entries(h.stores).map(([f,g])=>[f,g.getState()])):{}},Ete=(u,h,f)=>{if(u===void 0)return{type:"untracked",connection:h.connect(f)};const g=ME.get(f.name);if(g)return{type:"tracked",store:u,...g};const S={connection:h.connect(f),stores:{}};return ME.set(f.name,S),{type:"tracked",store:u,...S}},vte=(u,h)=>{if(h===void 0)return;const f=ME.get(u);f&&(delete f.stores[h],Object.keys(f.stores).length===0&&ME.delete(u))},Ste=u=>{var h,f;if(!u)return;const g=u.split(`
`),S=g.findIndex(R=>R.includes("api.setState"));if(S<0)return;const T=((h=g[S+1])==null?void 0:h.trim())||"";return(f=/.+ (.+) .+/.exec(T))==null?void 0:f[1]},yte=(u,h={})=>(f,g,S)=>{const{enabled:T,anonymousActionType:R,store:N,...k}=h;let x;try{x=(T??(e3?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!x)return u(f,g,S);const{connection:U,...B}=Ete(N,x,k);let Y=!0;S.setState=(X,te,ce)=>{const $=f(X,te);if(!Y)return $;const le=ce===void 0?{type:R||Ste(new Error().stack)||"anonymous"}:typeof ce=="string"?{type:ce}:ce;return N===void 0?(U?.send(le,g()),$):(U?.send({...le,type:`${N}/${le.type}`},{...n0(k.name),[N]:S.getState()}),$)},S.devtools={cleanup:()=>{U&&typeof U.unsubscribe=="function"&&U.unsubscribe(),vte(k.name,N)}};const H=(...X)=>{const te=Y;Y=!1,f(...X),Y=te},re=u(S.setState,g,S);if(B.type==="untracked"?U?.init(re):(B.stores[B.store]=S,U?.init(Object.fromEntries(Object.entries(B.stores).map(([X,te])=>[X,X===B.store?re:te.getState()])))),S.dispatchFromDevtools&&typeof S.dispatch=="function"){let X=!1;const te=S.dispatch;S.dispatch=(...ce)=>{(e3?"production":void 0)!=="production"&&ce[0].type==="__setState"&&!X&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),X=!0),te(...ce)}}return U.subscribe(X=>{var te;switch(X.type){case"ACTION":if(typeof X.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return i1(X.payload,ce=>{if(ce.type==="__setState"){if(N===void 0){H(ce.state);return}Object.keys(ce.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const $=ce.state[N];if($==null)return;JSON.stringify(S.getState())!==JSON.stringify($)&&H($);return}S.dispatchFromDevtools&&typeof S.dispatch=="function"&&S.dispatch(ce)});case"DISPATCH":switch(X.payload.type){case"RESET":return H(re),N===void 0?U?.init(S.getState()):U?.init(n0(k.name));case"COMMIT":if(N===void 0){U?.init(S.getState());return}return U?.init(n0(k.name));case"ROLLBACK":return i1(X.state,ce=>{if(N===void 0){H(ce),U?.init(S.getState());return}H(ce[N]),U?.init(n0(k.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return i1(X.state,ce=>{if(N===void 0){H(ce);return}JSON.stringify(S.getState())!==JSON.stringify(ce[N])&&H(ce[N])});case"IMPORT_STATE":{const{nextLiftedState:ce}=X.payload,$=(te=ce.computedStates.slice(-1)[0])==null?void 0:te.state;if(!$)return;H(N===void 0?$:$[N]),U?.send(null,ce);return}case"PAUSE_RECORDING":return Y=!Y}return}}),re},Tte=yte,i1=(u,h)=>{let f;try{f=JSON.parse(u)}catch(g){console.error("[zustand devtools middleware] Could not parse the received json",g)}f!==void 0&&h(f)};function Cte(u,h){let f;try{f=u()}catch{return}return{getItem:S=>{var T;const R=k=>k===null?null:JSON.parse(k,void 0),N=(T=f.getItem(S))!=null?T:null;return N instanceof Promise?N.then(R):R(N)},setItem:(S,T)=>f.setItem(S,JSON.stringify(T,void 0)),removeItem:S=>f.removeItem(S)}}const wA=u=>h=>{try{const f=u(h);return f instanceof Promise?f:{then(g){return wA(g)(f)},catch(g){return this}}}catch(f){return{then(g){return this},catch(g){return wA(g)(f)}}}},wte=(u,h)=>(f,g,S)=>{let T={storage:Cte(()=>localStorage),partialize:X=>X,version:0,merge:(X,te)=>({...te,...X}),...h},R=!1;const N=new Set,k=new Set;let x=T.storage;if(!x)return u((...X)=>{console.warn(`[zustand persist middleware] Unable to update item '${T.name}', the given storage is currently unavailable.`),f(...X)},g,S);const U=()=>{const X=T.partialize({...g()});return x.setItem(T.name,{state:X,version:T.version})},B=S.setState;S.setState=(X,te)=>(B(X,te),U());const Y=u((...X)=>(f(...X),U()),g,S);S.getInitialState=()=>Y;let H;const re=()=>{var X,te;if(!x)return;R=!1,N.forEach($=>{var le;return $((le=g())!=null?le:Y)});const ce=((te=T.onRehydrateStorage)==null?void 0:te.call(T,(X=g())!=null?X:Y))||void 0;return wA(x.getItem.bind(x))(T.name).then($=>{if($)if(typeof $.version=="number"&&$.version!==T.version){if(T.migrate){const le=T.migrate($.state,$.version);return le instanceof Promise?le.then(ne=>[!0,ne]):[!0,le]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,$.state];return[!1,void 0]}).then($=>{var le;const[ne,ue]=$;if(H=T.merge(ue,(le=g())!=null?le:Y),f(H,!0),ne)return U()}).then(()=>{ce?.(H,void 0),H=g(),R=!0,k.forEach($=>$(H))}).catch($=>{ce?.(void 0,$)})};return S.persist={setOptions:X=>{T={...T,...X},X.storage&&(x=X.storage)},clearStorage:()=>{x?.removeItem(T.name)},getOptions:()=>T,rehydrate:()=>re(),hasHydrated:()=>R,onHydrate:X=>(N.add(X),()=>{N.delete(X)}),onFinishHydration:X=>(k.add(X),()=>{k.delete(X)})},T.skipHydration||re(),H||Y},Rte=wte,bte="http://localhost:8080/api".replace(/\/$/,""),Qn=u=>{const h={"Content-Type":"application/json"};return u&&(h.Authorization=`Bearer ${u}`),h},co=async u=>{if(!u.ok){Fe.error(` API  : ${u.status} ${u.statusText}`);const h=await u.json().catch(f=>(Fe.error(" JSON  :",f),{message:"    ."}));throw Fe.error("   :",h),new Error(h.message||`HTTP ${u.status}: ${u.statusText}`)}return u.json()};class Ite{baseUrl;token;constructor(h=bte){this.baseUrl=h}setToken(h){this.token=h}clearToken(){this.token=void 0}async joinMatching(h){if(!this.token)throw new Error("  .");const f=`${this.baseUrl}/v1/calls/match`;try{let g=await fetch(f,{method:"POST",headers:Qn(this.token),body:JSON.stringify(h)});if(g.status===401){const T=await yi();if(T)this.token=T,g=await fetch(f,{method:"POST",headers:Qn(T),body:JSON.stringify(h)});else throw new Error(" .  .")}const S=await co(g);if(!S.data)throw new Error(S.message||"  .");return S.data}catch(g){throw console.error("  :",g),g instanceof Error?g:new Error("    .")}}async getMatchingStatus(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/status`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/status`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async cancelMatching(h){if(!this.token)throw new Error("  .");try{let f=await fetch(`${this.baseUrl}/v1/calls/match`,{method:"DELETE",headers:Qn(this.token),body:JSON.stringify({queue_id:h})});if(f.status===401){const g=await yi();if(g)this.token=g,f=await fetch(`${this.baseUrl}/v1/calls/match`,{method:"DELETE",headers:Qn(g),body:JSON.stringify({queue_id:h})});else throw new Error(" .  .")}}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async getActiveCategories(){try{let h=await fetch(`${this.baseUrl}/v1/categories/active`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/categories/active`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data.categories}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async getCategory(h){try{let f=await fetch(`${this.baseUrl}/v1/categories/${h}`,{method:"GET",headers:Qn(this.token)});if(f.status===401){const S=await yi();if(S)this.token=S,f=await fetch(`${this.baseUrl}/v1/categories/${h}`,{method:"GET",headers:Qn(S)});else throw new Error(" .  .")}const g=await co(f);if(!g.success||!g.data)throw new Error(g.message||"   .");return g.data}catch(f){throw console.error("   :",f),f instanceof Error?f:new Error("     .")}}async getQueuePosition(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/queue/position`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/queue/position`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async sendCallStatistics(h,f){if(!this.token)throw new Error("  .");try{const g=`${this.baseUrl}/v1/calls/${h}/statistics`;Fe.apiRequest("POST",`/v1/calls/${h}/statistics`,f);let S=await fetch(g,{method:"POST",headers:Qn(this.token),credentials:"include",body:JSON.stringify(f)});if(S.status===401){const R=await yi();if(R)this.token=R,S=await fetch(g,{method:"POST",headers:Qn(R),credentials:"include",body:JSON.stringify(f)});else throw new Error(" .  .")}if(S.status===204||S.ok)return;const T=await co(S)}catch(g){Fe.error("     ():",g)}}async renewRtcToken(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/renew-token`;Fe.apiRequest("POST",`/v1/calls/${h}/renew-token`,{});let g=await fetch(f,{method:"POST",headers:Qn(this.token),credentials:"include"});if(g.status===401){const T=await yi();if(T)this.token=T,g=await fetch(f,{method:"POST",headers:Qn(T),credentials:"include"});else throw new Error(" .  .")}const S=await co(g);if(!S.data||!S.data.rtcToken)throw new Error(S.message||"RTC   .");return S.data}catch(f){throw Fe.error("RTC   :",f),f instanceof Error?f:new Error("RTC   .")}}async getActivityStats(h){if(!this.token)throw new Error("  .");try{const f=h?`?period=${h}`:"",g=`${this.baseUrl}/v1/users/me/activity-stats${f}`;Fe.apiRequest("GET",`/v1/users/me/activity-stats${f}`,{});let S=await fetch(g,{method:"GET",headers:Qn(this.token),credentials:"include"});if(S.status===401){const N=await yi();if(N)this.token=N,S=await fetch(g,{method:"GET",headers:Qn(N),credentials:"include"});else throw new Error(" .  .")}const T=await co(S);return{weeklyStats:{callCount:T.data.weekly_stats.call_count,totalDurationMinutes:T.data.weekly_stats.total_duration_minutes,startDate:T.data.weekly_stats.start_date,endDate:T.data.weekly_stats.end_date},quarterlyStats:{callCount:T.data.quarterly_stats.call_count,totalDurationMinutes:T.data.quarterly_stats.total_duration_minutes,startDate:T.data.quarterly_stats.start_date,endDate:T.data.quarterly_stats.end_date,quarter:T.data.quarterly_stats.quarter},additionalStats:{averageCallDurationMinutes:T.data.additional_stats.average_call_duration_minutes,mostUsedCategory:T.data.additional_stats.most_used_category,totalDataUsageMb:T.data.additional_stats.total_data_usage_mb,averageNetworkQuality:T.data.additional_stats.average_network_quality}}}catch(f){throw Fe.error("   :",f),f instanceof Error?f:new Error("   .")}}async getCallHistory(h){if(!this.token)throw new Error("  .");try{const f=new URLSearchParams;h?.page&&f.append("page",String(h.page)),h?.limit&&f.append("limit",String(h.limit)),h?.period&&f.append("period",h.period);const g=f.toString(),S=`${this.baseUrl}/v1/users/me/call-history${g?`?${g}`:""}`;Fe.apiRequest("GET",`/v1/users/me/call-history?${g}`,{});let T=await fetch(S,{method:"GET",headers:Qn(this.token),credentials:"include"});if(T.status===401){const k=await yi();if(k)this.token=k,T=await fetch(S,{method:"GET",headers:Qn(k),credentials:"include"});else throw new Error(" .  .")}const R=await co(T);return{calls:R.data.calls.map(k=>({callId:k.call_id,partnerId:k.partner_id,partnerNickname:k.partner_nickname,categoryId:k.category_id,categoryName:k.category_name,startedAt:k.started_at,endedAt:k.ended_at,durationMinutes:k.duration_minutes,averageNetworkQuality:k.average_network_quality,totalDataUsageMB:k.total_data_usage_mb})),pagination:{currentPage:R.data.pagination.current_page,totalPages:R.data.pagination.total_pages,totalCount:R.data.pagination.total_count,hasNext:R.data.pagination.has_next}}}catch(f){throw Fe.error("   :",f),f instanceof Error?f:new Error("   .")}}async getMatchingStats(){if(!this.token)throw new Error("  .");try{let h=await fetch(`${this.baseUrl}/v1/calls/match/stats`,{method:"GET",headers:Qn(this.token)});if(h.status===401){const g=await yi();if(g)this.token=g,h=await fetch(`${this.baseUrl}/v1/calls/match/stats`,{method:"GET",headers:Qn(g)});else throw new Error(" .  .")}const f=await co(h);if(!f.success||!f.data)throw new Error(f.message||"   .");return f.data}catch(h){throw console.error("   :",h),h instanceof Error?h:new Error("     .")}}async leaveChannel(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/channel/leave`;Fe.apiRequest("POST",`/v1/calls/${h}/channel/leave`);let g=await fetch(f,{method:"POST",headers:Qn(this.token)});if(g.status===401){const S=await yi();if(S)this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S)});else throw new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async endCall(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/calls/${h}/end`;Fe.apiRequest("POST",`/v1/calls/${h}/end`);let g=await fetch(f,{method:"POST",headers:Qn(this.token)});if(g.status===401){const S=await yi();if(S)this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S)});else throw new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}async submitEvaluation(h){if(!this.token)throw new Error("  .");try{const f=`${this.baseUrl}/v1/evaluations`;Fe.apiRequest("POST","/v1/evaluations",h);let g=await fetch(f,{method:"POST",headers:Qn(this.token),body:JSON.stringify(h)});if(console.log(`   API    : ${g.status}`),g.status===401){console.log("   401  ,    ...");const S=await yi();if(S)console.log("   ,    ..."),this.token=S,g=await fetch(f,{method:"POST",headers:Qn(S),body:JSON.stringify(h)}),console.log(`     : ${g.status}`);else throw console.error("   "),new Error(" .  .")}await co(g),console.log("   API  ")}catch(f){throw console.error("  :",f),f instanceof Error?f:new Error("    .")}}}let s1=null;const FE=()=>(s1||(s1=new Ite),s1),Gd=FE();var o1={exports:{}},r0={},t3;function Ate(){return t3||(t3=1,globalThis.crypto&&globalThis.crypto.getRandomValues?r0.randomBytes=function(u){var h=new Uint8Array(u);return globalThis.crypto.getRandomValues(h),h}:r0.randomBytes=function(u){for(var h=new Array(u),f=0;f<u;f++)h[f]=Math.floor(Math.random()*256);return h}),r0}var a1,n3;function gm(){if(n3)return a1;n3=1;var u=Ate(),h="abcdefghijklmnopqrstuvwxyz012345";return a1={string:function(f){for(var g=h.length,S=u.randomBytes(f),T=[],R=0;R<f;R++)T.push(h.substr(S[R]%g,1));return T.join("")},number:function(f){return Math.floor(Math.random()*f)},numberString:function(f){var g=(""+(f-1)).length,S=new Array(g+1).join("0");return(S+this.number(f)).slice(-g)}},a1}var r3;function Zd(){return r3||(r3=1,function(u){var h=gm(),f={},g=!1,S=globalThis.chrome&&globalThis.chrome.app&&globalThis.chrome.app.runtime;u.exports={attachEvent:function(R,N){typeof globalThis.addEventListener<"u"?globalThis.addEventListener(R,N,!1):globalThis.document&&globalThis.attachEvent&&(globalThis.document.attachEvent("on"+R,N),globalThis.attachEvent("on"+R,N))},detachEvent:function(R,N){typeof globalThis.addEventListener<"u"?globalThis.removeEventListener(R,N,!1):globalThis.document&&globalThis.detachEvent&&(globalThis.document.detachEvent("on"+R,N),globalThis.detachEvent("on"+R,N))},unloadAdd:function(R){if(S)return null;var N=h.string(8);return f[N]=R,g&&setTimeout(this.triggerUnloadCallbacks,0),N},unloadDel:function(R){R in f&&delete f[R]},triggerUnloadCallbacks:function(){for(var R in f)f[R](),delete f[R]}};var T=function(){g||(g=!0,u.exports.triggerUnloadCallbacks())};S||u.exports.attachEvent("unload",T)}(o1)),o1.exports}var c1,i3;function Ote(){return i3||(i3=1,c1=function(h,f){if(f=f.split(":")[0],h=+h,!h)return!1;switch(f){case"http":case"ws":return h!==80;case"https":case"wss":return h!==443;case"ftp":return h!==21;case"gopher":return h!==70;case"file":return!1}return h!==0}),c1}var i0={},s3;function Nte(){if(s3)return i0;s3=1;var u=Object.prototype.hasOwnProperty,h;function f(R){try{return decodeURIComponent(R.replace(/\+/g," "))}catch{return null}}function g(R){try{return encodeURIComponent(R)}catch{return null}}function S(R){for(var N=/([^=?#&]+)=?([^&]*)/g,k={},x;x=N.exec(R);){var U=f(x[1]),B=f(x[2]);U===null||B===null||U in k||(k[U]=B)}return k}function T(R,N){N=N||"";var k=[],x,U;typeof N!="string"&&(N="?");for(U in R)if(u.call(R,U)){if(x=R[U],!x&&(x===null||x===h||isNaN(x))&&(x=""),U=g(U),x=g(x),U===null||x===null)continue;k.push(U+"="+x)}return k.length?N+k.join("&"):""}return i0.stringify=T,i0.parse=S,i0}var l1,o3;function uF(){if(o3)return l1;o3=1;var u=Ote(),h=Nte(),f=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,g=/[\n\r\t]/g,S=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,T=/:\d+$/,R=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,N=/^[a-zA-Z]:/;function k($){return($||"").toString().replace(f,"")}var x=[["#","hash"],["?","query"],function(le,ne){return Y(ne.protocol)?le.replace(/\\/g,"/"):le},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],U={hash:1,query:1};function B($){var le;typeof window<"u"?le=window:typeof globalThis<"u"?le=globalThis:typeof self<"u"?le=self:le={};var ne=le.location||{};$=$||ne;var ue={},Pe=typeof $,he;if($.protocol==="blob:")ue=new X(unescape($.pathname),{});else if(Pe==="string"){ue=new X($,{});for(he in U)delete ue[he]}else if(Pe==="object"){for(he in $)he in U||(ue[he]=$[he]);ue.slashes===void 0&&(ue.slashes=S.test($.href))}return ue}function Y($){return $==="file:"||$==="ftp:"||$==="http:"||$==="https:"||$==="ws:"||$==="wss:"}function H($,le){$=k($),$=$.replace(g,""),le=le||{};var ne=R.exec($),ue=ne[1]?ne[1].toLowerCase():"",Pe=!!ne[2],he=!!ne[3],de=0,ye;return Pe?he?(ye=ne[2]+ne[3]+ne[4],de=ne[2].length+ne[3].length):(ye=ne[2]+ne[4],de=ne[2].length):he?(ye=ne[3]+ne[4],de=ne[3].length):ye=ne[4],ue==="file:"?de>=2&&(ye=ye.slice(2)):Y(ue)?ye=ne[4]:ue?Pe&&(ye=ye.slice(2)):de>=2&&Y(le.protocol)&&(ye=ne[4]),{protocol:ue,slashes:Pe||Y(ue),slashesCount:de,rest:ye}}function re($,le){if($==="")return le;for(var ne=(le||"/").split("/").slice(0,-1).concat($.split("/")),ue=ne.length,Pe=ne[ue-1],he=!1,de=0;ue--;)ne[ue]==="."?ne.splice(ue,1):ne[ue]===".."?(ne.splice(ue,1),de++):de&&(ue===0&&(he=!0),ne.splice(ue,1),de--);return he&&ne.unshift(""),(Pe==="."||Pe==="..")&&ne.push(""),ne.join("/")}function X($,le,ne){if($=k($),$=$.replace(g,""),!(this instanceof X))return new X($,le,ne);var ue,Pe,he,de,ye,Me,Je=x.slice(),Ve=typeof le,xe=this,He=0;for(Ve!=="object"&&Ve!=="string"&&(ne=le,le=null),ne&&typeof ne!="function"&&(ne=h.parse),le=B(le),Pe=H($||"",le),ue=!Pe.protocol&&!Pe.slashes,xe.slashes=Pe.slashes||ue&&le.slashes,xe.protocol=Pe.protocol||le.protocol||"",$=Pe.rest,(Pe.protocol==="file:"&&(Pe.slashesCount!==2||N.test($))||!Pe.slashes&&(Pe.protocol||Pe.slashesCount<2||!Y(xe.protocol)))&&(Je[3]=[/(.*)/,"pathname"]);He<Je.length;He++){if(de=Je[He],typeof de=="function"){$=de($,xe);continue}he=de[0],Me=de[1],he!==he?xe[Me]=$:typeof he=="string"?(ye=he==="@"?$.lastIndexOf(he):$.indexOf(he),~ye&&(typeof de[2]=="number"?(xe[Me]=$.slice(0,ye),$=$.slice(ye+de[2])):(xe[Me]=$.slice(ye),$=$.slice(0,ye)))):(ye=he.exec($))&&(xe[Me]=ye[1],$=$.slice(0,ye.index)),xe[Me]=xe[Me]||ue&&de[3]&&le[Me]||"",de[4]&&(xe[Me]=xe[Me].toLowerCase())}ne&&(xe.query=ne(xe.query)),ue&&le.slashes&&xe.pathname.charAt(0)!=="/"&&(xe.pathname!==""||le.pathname!=="")&&(xe.pathname=re(xe.pathname,le.pathname)),xe.pathname.charAt(0)!=="/"&&Y(xe.protocol)&&(xe.pathname="/"+xe.pathname),u(xe.port,xe.protocol)||(xe.host=xe.hostname,xe.port=""),xe.username=xe.password="",xe.auth&&(ye=xe.auth.indexOf(":"),~ye?(xe.username=xe.auth.slice(0,ye),xe.username=encodeURIComponent(decodeURIComponent(xe.username)),xe.password=xe.auth.slice(ye+1),xe.password=encodeURIComponent(decodeURIComponent(xe.password))):xe.username=encodeURIComponent(decodeURIComponent(xe.auth)),xe.auth=xe.password?xe.username+":"+xe.password:xe.username),xe.origin=xe.protocol!=="file:"&&Y(xe.protocol)&&xe.host?xe.protocol+"//"+xe.host:"null",xe.href=xe.toString()}function te($,le,ne){var ue=this;switch($){case"query":typeof le=="string"&&le.length&&(le=(ne||h.parse)(le)),ue[$]=le;break;case"port":ue[$]=le,u(le,ue.protocol)?le&&(ue.host=ue.hostname+":"+le):(ue.host=ue.hostname,ue[$]="");break;case"hostname":ue[$]=le,ue.port&&(le+=":"+ue.port),ue.host=le;break;case"host":ue[$]=le,T.test(le)?(le=le.split(":"),ue.port=le.pop(),ue.hostname=le.join(":")):(ue.hostname=le,ue.port="");break;case"protocol":ue.protocol=le.toLowerCase(),ue.slashes=!ne;break;case"pathname":case"hash":if(le){var Pe=$==="pathname"?"/":"#";ue[$]=le.charAt(0)!==Pe?Pe+le:le}else ue[$]=le;break;case"username":case"password":ue[$]=encodeURIComponent(le);break;case"auth":var he=le.indexOf(":");~he?(ue.username=le.slice(0,he),ue.username=encodeURIComponent(decodeURIComponent(ue.username)),ue.password=le.slice(he+1),ue.password=encodeURIComponent(decodeURIComponent(ue.password))):ue.username=encodeURIComponent(decodeURIComponent(le))}for(var de=0;de<x.length;de++){var ye=x[de];ye[4]&&(ue[ye[1]]=ue[ye[1]].toLowerCase())}return ue.auth=ue.password?ue.username+":"+ue.password:ue.username,ue.origin=ue.protocol!=="file:"&&Y(ue.protocol)&&ue.host?ue.protocol+"//"+ue.host:"null",ue.href=ue.toString(),ue}function ce($){(!$||typeof $!="function")&&($=h.stringify);var le,ne=this,ue=ne.host,Pe=ne.protocol;Pe&&Pe.charAt(Pe.length-1)!==":"&&(Pe+=":");var he=Pe+(ne.protocol&&ne.slashes||Y(ne.protocol)?"//":"");return ne.username?(he+=ne.username,ne.password&&(he+=":"+ne.password),he+="@"):ne.password?(he+=":"+ne.password,he+="@"):ne.protocol!=="file:"&&Y(ne.protocol)&&!ue&&ne.pathname!=="/"&&(he+="@"),(ue[ue.length-1]===":"||T.test(ne.hostname)&&!ne.port)&&(ue+=":"),he+=ue+ne.pathname,le=typeof ne.query=="object"?$(ne.query):ne.query,le&&(he+=le.charAt(0)!=="?"?"?"+le:le),ne.hash&&(he+=ne.hash),he}return X.prototype={set:te,toString:ce},X.extractProtocol=H,X.location=B,X.trimLeft=k,X.qs=h,l1=X,l1}var d1,a3;function Xo(){if(a3)return d1;a3=1;var u=uF();return d1={getOrigin:function(h){if(!h)return null;var f=new u(h);if(f.protocol==="file:")return null;var g=f.port;return g||(g=f.protocol==="https:"?"443":"80"),f.protocol+"//"+f.hostname+":"+g},isOriginEqual:function(h,f){var g=this.getOrigin(h)===this.getOrigin(f);return g},isSchemeEqual:function(h,f){return h.split(":")[0]===f.split(":")[0]},addPath:function(h,f){var g=h.split("?");return g[0]+f+(g[1]?"?"+g[1]:"")},addQuery:function(h,f){return h+(h.indexOf("?")===-1?"?"+f:"&"+f)},isLoopbackAddr:function(h){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(h)||/^\[::1\]$/.test(h)}},d1}var s0={exports:{}},c3;function Un(){return c3||(c3=1,typeof Object.create=="function"?s0.exports=function(h,f){f&&(h.super_=f,h.prototype=Object.create(f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}))}:s0.exports=function(h,f){if(f){h.super_=f;var g=function(){};g.prototype=f.prototype,h.prototype=new g,h.prototype.constructor=h}}),s0.exports}var u1={},h1,l3;function hF(){if(l3)return h1;l3=1;function u(){this._listeners={}}return u.prototype.addEventListener=function(h,f){h in this._listeners||(this._listeners[h]=[]);var g=this._listeners[h];g.indexOf(f)===-1&&(g=g.concat([f])),this._listeners[h]=g},u.prototype.removeEventListener=function(h,f){var g=this._listeners[h];if(g){var S=g.indexOf(f);if(S!==-1){g.length>1?this._listeners[h]=g.slice(0,S).concat(g.slice(S+1)):delete this._listeners[h];return}}},u.prototype.dispatchEvent=function(){var h=arguments[0],f=h.type,g=arguments.length===1?[h]:Array.apply(null,arguments);if(this["on"+f]&&this["on"+f].apply(this,g),f in this._listeners)for(var S=this._listeners[f],T=0;T<S.length;T++)S[T].apply(this,g)},h1=u,h1}var d3;function us(){if(d3)return u1;d3=1;var u=Un(),h=hF();function f(){h.call(this)}return u(f,h),f.prototype.removeAllListeners=function(g){g?delete this._listeners[g]:this._listeners={}},f.prototype.once=function(g,S){var T=this,R=!1;function N(){T.removeListener(g,N),R||(R=!0,S.apply(this,arguments))}this.on(g,N)},f.prototype.emit=function(){var g=arguments[0],S=this._listeners[g];if(S){for(var T=arguments.length,R=new Array(T-1),N=1;N<T;N++)R[N-1]=arguments[N];for(var k=0;k<S.length;k++)S[k].apply(this,R)}},f.prototype.on=f.prototype.addListener=h.prototype.addEventListener,f.prototype.removeListener=h.prototype.removeEventListener,u1.EventEmitter=f,u1}var o0={exports:{}},u3;function Pte(){if(u3)return o0.exports;u3=1;var u=globalThis.WebSocket||globalThis.MozWebSocket;return u?o0.exports=function(f){return new u(f)}:o0.exports=void 0,o0.exports}var p1,h3;function kte(){if(h3)return p1;h3=1;var u=Zd(),h=Xo(),f=Un(),g=us().EventEmitter,S=Pte(),T=function(){};function R(N,k,x){if(!R.enabled())throw new Error("Transport created when disabled");g.call(this);var U=this,B=h.addPath(N,"/websocket");B.slice(0,5)==="https"?B="wss"+B.slice(5):B="ws"+B.slice(4),this.url=B,this.ws=new S(this.url,[],x),this.ws.onmessage=function(Y){T("message event",Y.data),U.emit("message",Y.data)},this.unloadRef=u.unloadAdd(function(){U.ws.close()}),this.ws.onclose=function(Y){T("close event",Y.code,Y.reason),U.emit("close",Y.code,Y.reason),U._cleanup()},this.ws.onerror=function(Y){U.emit("close",1006,"WebSocket connection broken"),U._cleanup()}}return f(R,g),R.prototype.send=function(N){var k="["+N+"]";this.ws.send(k)},R.prototype.close=function(){var N=this.ws;this._cleanup(),N&&N.close()},R.prototype._cleanup=function(){var N=this.ws;N&&(N.onmessage=N.onclose=N.onerror=null),u.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},R.enabled=function(){return!!S},R.transportName="websocket",R.roundTrips=2,p1=R,p1}var f1,p3;function Dte(){if(p3)return f1;p3=1;var u=Un(),h=us().EventEmitter,f=function(){};function g(S,T){h.call(this),this.sendBuffer=[],this.sender=T,this.url=S}return u(g,h),g.prototype.send=function(S){this.sendBuffer.push(S),this.sendStop||this.sendSchedule()},g.prototype.sendScheduleWait=function(){var S=this,T;this.sendStop=function(){S.sendStop=null,clearTimeout(T)},T=setTimeout(function(){S.sendStop=null,S.sendSchedule()},25)},g.prototype.sendSchedule=function(){f("sendSchedule",this.sendBuffer.length);var S=this;if(this.sendBuffer.length>0){var T="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,T,function(R){S.sendStop=null,R?(S.emit("close",R.code||1006,"Sending error: "+R),S.close()):S.sendScheduleWait()}),this.sendBuffer=[]}},g.prototype._cleanup=function(){this.removeAllListeners()},g.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},f1=g,f1}var m1,f3;function Lte(){if(f3)return m1;f3=1;var u=Un(),h=us().EventEmitter,f=function(){};function g(S,T,R){h.call(this),this.Receiver=S,this.receiveUrl=T,this.AjaxObject=R,this._scheduleReceiver()}return u(g,h),g.prototype._scheduleReceiver=function(){var S=this,T=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);T.on("message",function(R){S.emit("message",R)}),T.once("close",function(R,N){f("close",R,N,S.pollIsClosing),S.poll=T=null,S.pollIsClosing||(N==="network"?S._scheduleReceiver():(S.emit("close",R||1006,N),S.removeAllListeners()))})},g.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},m1=g,m1}var _1,m3;function pF(){if(m3)return _1;m3=1;var u=Un(),h=Xo(),f=Dte(),g=Lte();function S(T,R,N,k,x){var U=h.addPath(T,R),B=this;f.call(this,T,N),this.poll=new g(k,U,x),this.poll.on("message",function(Y){B.emit("message",Y)}),this.poll.once("close",function(Y,H){B.poll=null,B.emit("close",Y,H),B.close()})}return u(S,f),S.prototype.close=function(){f.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},_1=S,_1}var g1,_3;function Em(){if(_3)return g1;_3=1;var u=Un(),h=Xo(),f=pF();function g(T){return function(R,N,k){var x={};typeof N=="string"&&(x.headers={"Content-type":"text/plain"});var U=h.addPath(R,"/xhr_send"),B=new T("POST",U,N,x);return B.once("finish",function(Y){if(B=null,Y!==200&&Y!==204)return k(new Error("http status "+Y));k()}),function(){B.close(),B=null;var Y=new Error("Aborted");Y.code=1e3,k(Y)}}}function S(T,R,N,k){f.call(this,T,R,g(k),N,k)}return u(S,f),g1=S,g1}var E1,g3;function M0(){if(g3)return E1;g3=1;var u=Un(),h=us().EventEmitter;function f(g,S){h.call(this);var T=this;this.bufferPosition=0,this.xo=new S("POST",g,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(R,N){T._chunkHandler(R,N),T.xo=null;var k=R===200?"network":"permanent";T.emit("close",null,k),T._cleanup()})}return u(f,h),f.prototype._chunkHandler=function(g,S){if(!(g!==200||!S))for(var T=-1;;this.bufferPosition+=T+1){var R=S.slice(this.bufferPosition);if(T=R.indexOf(`
`),T===-1)break;var N=R.slice(0,T);N&&this.emit("message",N)}},f.prototype._cleanup=function(){this.removeAllListeners()},f.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},E1=f,E1}var v1,E3;function fF(){if(E3)return v1;E3=1;var u=us().EventEmitter,h=Un(),f=Zd(),g=Xo(),S=globalThis.XMLHttpRequest,T=function(){};function R(x,U,B,Y){var H=this;u.call(this),setTimeout(function(){H._start(x,U,B,Y)},0)}h(R,u),R.prototype._start=function(x,U,B,Y){var H=this;try{this.xhr=new S}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}U=g.addQuery(U,"t="+ +new Date),this.unloadRef=f.unloadAdd(function(){H._cleanup(!0)});try{this.xhr.open(x,U,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){T("xhr timeout"),H.emit("finish",0,""),H._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!Y||!Y.noCredentials)&&R.supportsCORS&&(this.xhr.withCredentials=!0),Y&&Y.headers)for(var re in Y.headers)this.xhr.setRequestHeader(re,Y.headers[re]);this.xhr.onreadystatechange=function(){if(H.xhr){var X=H.xhr,te,ce;switch(T("readyState",X.readyState),X.readyState){case 3:try{ce=X.status,te=X.responseText}catch{}ce===1223&&(ce=204),ce===200&&te&&te.length>0&&H.emit("chunk",ce,te);break;case 4:ce=X.status,ce===1223&&(ce=204),(ce===12005||ce===12029)&&(ce=0),T("finish",ce,X.responseText),H.emit("finish",ce,X.responseText),H._cleanup(!1);break}}};try{H.xhr.send(B)}catch{H.emit("finish",0,""),H._cleanup(!1)}},R.prototype._cleanup=function(x){if(this.xhr){if(this.removeAllListeners(),f.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),x)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},R.prototype.close=function(){this._cleanup(!0)},R.enabled=!!S;var N=["Active"].concat("Object").join("X");!R.enabled&&N in globalThis&&(S=function(){try{return new globalThis[N]("Microsoft.XMLHTTP")}catch{return null}},R.enabled=!!new S);var k=!1;try{k="withCredentials"in new S}catch{}return R.supportsCORS=k,v1=R,v1}var S1,v3;function U0(){if(v3)return S1;v3=1;var u=Un(),h=fF();function f(g,S,T,R){h.call(this,g,S,T,R)}return u(f,h),f.enabled=h.enabled&&h.supportsCORS,S1=f,S1}var y1,S3;function BE(){if(S3)return y1;S3=1;var u=Un(),h=fF();function f(g,S,T){h.call(this,g,S,T,{noCredentials:!0})}return u(f,h),f.enabled=h.enabled,y1=f,y1}var T1,y3;function WE(){return y3||(y3=1,T1={isOpera:function(){return globalThis.navigator&&/opera/i.test(globalThis.navigator.userAgent)},isKonqueror:function(){return globalThis.navigator&&/konqueror/i.test(globalThis.navigator.userAgent)},hasDomain:function(){if(!globalThis.document)return!0;try{return!!globalThis.document.domain}catch{return!1}}}),T1}var C1,T3;function xte(){if(T3)return C1;T3=1;var u=Un(),h=Em(),f=M0(),g=U0(),S=BE(),T=WE();function R(N){if(!S.enabled&&!g.enabled)throw new Error("Transport created when disabled");h.call(this,N,"/xhr_streaming",f,g)}return u(R,h),R.enabled=function(N){return N.nullOrigin||T.isOpera()?!1:g.enabled},R.transportName="xhr-streaming",R.roundTrips=2,R.needBody=!!globalThis.document,C1=R,C1}var w1,C3;function QA(){if(C3)return w1;C3=1;var u=us().EventEmitter,h=Un(),f=Zd(),g=WE(),S=Xo(),T=function(){};function R(N,k,x){var U=this;u.call(this),setTimeout(function(){U._start(N,k,x)},0)}return h(R,u),R.prototype._start=function(N,k,x){var U=this,B=new globalThis.XDomainRequest;k=S.addQuery(k,"t="+ +new Date),B.onerror=function(){U._error()},B.ontimeout=function(){U._error()},B.onprogress=function(){T("progress",B.responseText),U.emit("chunk",200,B.responseText)},B.onload=function(){U.emit("finish",200,B.responseText),U._cleanup(!1)},this.xdr=B,this.unloadRef=f.unloadAdd(function(){U._cleanup(!0)});try{this.xdr.open(N,k),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(x)}catch{this._error()}},R.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},R.prototype._cleanup=function(N){if(this.xdr){if(this.removeAllListeners(),f.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,N)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},R.prototype.close=function(){this._cleanup(!0)},R.enabled=!!(globalThis.XDomainRequest&&g.hasDomain()),w1=R,w1}var R1,w3;function mF(){if(w3)return R1;w3=1;var u=Un(),h=Em(),f=M0(),g=QA();function S(T){if(!g.enabled)throw new Error("Transport created when disabled");h.call(this,T,"/xhr_streaming",f,g)}return u(S,h),S.enabled=function(T){return T.cookie_needed||T.nullOrigin?!1:g.enabled&&T.sameScheme},S.transportName="xdr-streaming",S.roundTrips=2,R1=S,R1}var b1,R3;function _F(){return R3||(R3=1,b1=globalThis.EventSource),b1}var I1,b3;function Mte(){if(b3)return I1;b3=1;var u=Un(),h=us().EventEmitter,f=_F(),g=function(){};function S(T){h.call(this);var R=this,N=this.es=new f(T);N.onmessage=function(k){g("message",k.data),R.emit("message",decodeURI(k.data))},N.onerror=function(k){g("error",N.readyState);var x=N.readyState!==2?"network":"permanent";R._cleanup(),R._close(x)}}return u(S,h),S.prototype.abort=function(){this._cleanup(),this._close("user")},S.prototype._cleanup=function(){var T=this.es;T&&(T.onmessage=T.onerror=null,T.close(),this.es=null)},S.prototype._close=function(T){var R=this;setTimeout(function(){R.emit("close",null,T),R.removeAllListeners()},200)},I1=S,I1}var A1,I3;function A3(){if(I3)return A1;I3=1;var u=Un(),h=Em(),f=Mte(),g=U0(),S=_F();function T(R){if(!T.enabled())throw new Error("Transport created when disabled");h.call(this,R,"/eventsource",f,g)}return u(T,h),T.enabled=function(){return!!S},T.transportName="eventsource",T.roundTrips=2,A1=T,A1}var O1,O3;function gF(){return O3||(O3=1,O1="1.6.1"),O1}var N1={exports:{}},N3;function GE(){return N3||(N3=1,function(u){var h=Zd(),f=WE();u.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){u.exports.WPrefix in globalThis||(globalThis[u.exports.WPrefix]={})},postMessage:function(g,S){globalThis.parent!==globalThis&&globalThis.parent.postMessage(JSON.stringify({windowId:u.exports.currentWindowId,type:g,data:S||""}),"*")},createIframe:function(g,S){var T=globalThis.document.createElement("iframe"),R,N,k=function(){clearTimeout(R);try{T.onload=null}catch{}T.onerror=null},x=function(){T&&(k(),setTimeout(function(){T&&T.parentNode.removeChild(T),T=null},0),h.unloadDel(N))},U=function(Y){T&&(x(),S(Y))},B=function(Y,H){setTimeout(function(){try{T&&T.contentWindow&&T.contentWindow.postMessage(Y,H)}catch{}},0)};return T.src=g,T.style.display="none",T.style.position="absolute",T.onerror=function(){U("onerror")},T.onload=function(){clearTimeout(R),R=setTimeout(function(){U("onload timeout")},2e3)},globalThis.document.body.appendChild(T),R=setTimeout(function(){U("timeout")},15e3),N=h.unloadAdd(x),{post:B,cleanup:x,loaded:k}},createHtmlfile:function(g,S){var T=["Active"].concat("Object").join("X"),R=new globalThis[T]("htmlfile"),N,k,x,U=function(){clearTimeout(N),x.onerror=null},B=function(){R&&(U(),h.unloadDel(k),x.parentNode.removeChild(x),x=R=null,CollectGarbage())},Y=function(X){R&&(B(),S(X))},H=function(X,te){try{setTimeout(function(){x&&x.contentWindow&&x.contentWindow.postMessage(X,te)},0)}catch{}};R.open(),R.write('<html><script>document.domain="'+globalThis.document.domain+'";<\/script></html>'),R.close(),R.parentWindow[u.exports.WPrefix]=globalThis[u.exports.WPrefix];var re=R.createElement("div");return R.body.appendChild(re),x=R.createElement("iframe"),re.appendChild(x),x.src=g,x.onerror=function(){Y("onerror")},N=setTimeout(function(){Y("timeout")},15e3),k=h.unloadAdd(B),{post:H,cleanup:B,loaded:U}}},u.exports.iframeEnabled=!1,globalThis.document&&(u.exports.iframeEnabled=(typeof globalThis.postMessage=="function"||typeof globalThis.postMessage=="object")&&!f.isKonqueror())}(N1)),N1.exports}var P1,P3;function EF(){if(P3)return P1;P3=1;var u=Un(),h=us().EventEmitter,f=gF(),g=Xo(),S=GE(),T=Zd(),R=gm(),N=function(){};function k(x,U,B){if(!k.enabled())throw new Error("Transport created when disabled");h.call(this);var Y=this;this.origin=g.getOrigin(B),this.baseUrl=B,this.transUrl=U,this.transport=x,this.windowId=R.string(8);var H=g.addPath(B,"/iframe.html")+"#"+this.windowId;this.iframeObj=S.createIframe(H,function(re){Y.emit("close",1006,"Unable to load an iframe ("+re+")"),Y.close()}),this.onmessageCallback=this._message.bind(this),T.attachEvent("message",this.onmessageCallback)}return u(k,h),k.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){T.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},k.prototype._message=function(x){if(N("message",x.data),!g.isOriginEqual(x.origin,this.origin)){N("not same origin",x.origin,this.origin);return}var U;try{U=JSON.parse(x.data)}catch{N("bad json",x.data);return}if(U.windowId!==this.windowId){N("mismatched window id",U.windowId,this.windowId);return}switch(U.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([f,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",U.data);break;case"c":var B;try{B=JSON.parse(U.data)}catch{N("bad json",U.data);return}this.emit("close",B[0],B[1]),this.close();break}},k.prototype.postMessage=function(x,U){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:x,data:U||""}),this.origin)},k.prototype.send=function(x){this.postMessage("m",x)},k.enabled=function(){return S.iframeEnabled},k.transportName="iframe",k.roundTrips=2,P1=k,P1}var k1,k3;function $A(){return k3||(k3=1,k1={isObject:function(u){var h=typeof u;return h==="function"||h==="object"&&!!u},extend:function(u){if(!this.isObject(u))return u;for(var h,f,g=1,S=arguments.length;g<S;g++){h=arguments[g];for(f in h)Object.prototype.hasOwnProperty.call(h,f)&&(u[f]=h[f])}return u}}),k1}var D1,D3;function L1(){if(D3)return D1;D3=1;var u=Un(),h=EF(),f=$A();return D1=function(g){function S(T,R){h.call(this,g.transportName,T,R)}return u(S,h),S.enabled=function(T,R){if(!globalThis.document)return!1;var N=f.extend({},R);return N.sameOrigin=!0,g.enabled(N)&&h.enabled()},S.transportName="iframe-"+g.transportName,S.needBody=!0,S.roundTrips=h.roundTrips+g.roundTrips-1,S.facadeTransport=g,S},D1}var x1,L3;function Ute(){if(L3)return x1;L3=1;var u=Un(),h=GE(),f=Xo(),g=us().EventEmitter,S=gm(),T=function(){};function R(k){g.call(this);var x=this;h.polluteGlobalNamespace(),this.id="a"+S.string(6),k=f.addQuery(k,"c="+decodeURIComponent(h.WPrefix+"."+this.id)),T("using htmlfile",R.htmlfileEnabled);var U=R.htmlfileEnabled?h.createHtmlfile:h.createIframe;globalThis[h.WPrefix][this.id]={start:function(){x.iframeObj.loaded()},message:function(B){x.emit("message",B)},stop:function(){x._cleanup(),x._close("network")}},this.iframeObj=U(k,function(){x._cleanup(),x._close("permanent")})}u(R,g),R.prototype.abort=function(){this._cleanup(),this._close("user")},R.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete globalThis[h.WPrefix][this.id]},R.prototype._close=function(k){this.emit("close",null,k),this.removeAllListeners()},R.htmlfileEnabled=!1;var N=["Active"].concat("Object").join("X");if(N in globalThis)try{R.htmlfileEnabled=!!new globalThis[N]("htmlfile")}catch{}return R.enabled=R.htmlfileEnabled||h.iframeEnabled,x1=R,x1}var M1,x3;function M3(){if(x3)return M1;x3=1;var u=Un(),h=Ute(),f=BE(),g=Em();function S(T){if(!h.enabled)throw new Error("Transport created when disabled");g.call(this,T,"/htmlfile",h,f)}return u(S,g),S.enabled=function(T){return h.enabled&&T.sameOrigin},S.transportName="htmlfile",S.roundTrips=2,M1=S,M1}var U1,U3;function V3(){if(U3)return U1;U3=1;var u=Un(),h=Em(),f=M0(),g=U0(),S=BE();function T(R){if(!S.enabled&&!g.enabled)throw new Error("Transport created when disabled");h.call(this,R,"/xhr",f,g)}return u(T,h),T.enabled=function(R){return R.nullOrigin?!1:S.enabled&&R.sameOrigin?!0:g.enabled},T.transportName="xhr-polling",T.roundTrips=2,U1=T,U1}var V1,j3;function Vte(){if(j3)return V1;j3=1;var u=Un(),h=Em(),f=mF(),g=M0(),S=QA();function T(R){if(!S.enabled)throw new Error("Transport created when disabled");h.call(this,R,"/xhr",g,S)}return u(T,h),T.enabled=f.enabled,T.transportName="xdr-polling",T.roundTrips=2,V1=T,V1}var j1,F3;function jte(){if(F3)return j1;F3=1;var u=GE(),h=gm(),f=WE(),g=Xo(),S=Un(),T=us().EventEmitter,R=function(){};function N(k){var x=this;T.call(this),u.polluteGlobalNamespace(),this.id="a"+h.string(6);var U=g.addQuery(k,"c="+encodeURIComponent(u.WPrefix+"."+this.id));globalThis[u.WPrefix][this.id]=this._callback.bind(this),this._createScript(U),this.timeoutId=setTimeout(function(){x._abort(new Error("JSONP script loaded abnormally (timeout)"))},N.timeout)}return S(N,T),N.prototype.abort=function(){if(globalThis[u.WPrefix][this.id]){var k=new Error("JSONP user aborted read");k.code=1e3,this._abort(k)}},N.timeout=35e3,N.scriptErrorTimeout=1e3,N.prototype._callback=function(k){this._cleanup(),!this.aborting&&(k&&this.emit("message",k),this.emit("close",null,"network"),this.removeAllListeners())},N.prototype._abort=function(k){this._cleanup(),this.aborting=!0,this.emit("close",k.code,k.message),this.removeAllListeners()},N.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var k=this.script;k.parentNode.removeChild(k),k.onreadystatechange=k.onerror=k.onload=k.onclick=null,this.script=null}delete globalThis[u.WPrefix][this.id]},N.prototype._scriptError=function(){var k=this;this.errorTimer||(this.errorTimer=setTimeout(function(){k.loadedOkay||k._abort(new Error("JSONP script loaded abnormally (onerror)"))},N.scriptErrorTimeout))},N.prototype._createScript=function(k){var x=this,U=this.script=globalThis.document.createElement("script"),B;if(U.id="a"+h.string(8),U.src=k,U.type="text/javascript",U.charset="UTF-8",U.onerror=this._scriptError.bind(this),U.onload=function(){x._abort(new Error("JSONP script loaded abnormally (onload)"))},U.onreadystatechange=function(){if(R("onreadystatechange",U.readyState),/loaded|closed/.test(U.readyState)){if(U&&U.htmlFor&&U.onclick){x.loadedOkay=!0;try{U.onclick()}catch{}}U&&x._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof U.async>"u"&&globalThis.document.attachEvent)if(f.isOpera())B=this.script2=globalThis.document.createElement("script"),B.text="try{var a = document.getElementById('"+U.id+"'); if(a)a.onerror();}catch(x){};",U.async=B.async=!1;else{try{U.htmlFor=U.id,U.event="onclick"}catch{}U.async=!0}typeof U.async<"u"&&(U.async=!0);var Y=globalThis.document.getElementsByTagName("head")[0];Y.insertBefore(U,Y.firstChild),B&&Y.insertBefore(B,Y.firstChild)},j1=N,j1}var F1,B3;function Fte(){if(B3)return F1;B3=1;var u=gm(),h=Xo(),f=function(){},g,S;function T(N){try{return globalThis.document.createElement('<iframe name="'+N+'">')}catch{var k=globalThis.document.createElement("iframe");return k.name=N,k}}function R(){g=globalThis.document.createElement("form"),g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",S=globalThis.document.createElement("textarea"),S.name="d",g.appendChild(S),globalThis.document.body.appendChild(g)}return F1=function(N,k,x){g||R();var U="a"+u.string(8);g.target=U,g.action=h.addQuery(h.addPath(N,"/jsonp_send"),"i="+U);var B=T(U);B.id=U,B.style.display="none",g.appendChild(B);try{S.value=k}catch{}g.submit();var Y=function(H){B.onerror&&(B.onreadystatechange=B.onerror=B.onload=null,setTimeout(function(){B.parentNode.removeChild(B),B=null},500),S.value="",x(H))};return B.onerror=function(){Y()},B.onload=function(){Y()},B.onreadystatechange=function(H){f("onreadystatechange",U,B.readyState),B.readyState==="complete"&&Y()},function(){Y(new Error("Aborted"))}},F1}var B1,W3;function Bte(){if(W3)return B1;W3=1;var u=Un(),h=pF(),f=jte(),g=Fte();function S(T){if(!S.enabled())throw new Error("Transport created when disabled");h.call(this,T,"/jsonp",g,f)}return u(S,h),S.enabled=function(){return!!globalThis.document},S.transportName="jsonp-polling",S.roundTrips=1,S.needBody=!0,B1=S,B1}var W1,G3;function Wte(){return G3||(G3=1,W1=[kte(),xte(),mF(),A3(),L1()(A3()),M3(),L1()(M3()),V3(),Vte(),L1()(V3()),Bte()]),W1}var H3={},K3;function Gte(){if(K3)return H3;K3=1;var u=Array.prototype,h=Object.prototype,f=Function.prototype,g=String.prototype,S=u.slice,T=h.toString,R=function(he){return h.toString.call(he)==="[object Function]"},N=function(de){return T.call(de)==="[object Array]"},k=function(de){return T.call(de)==="[object String]"},x=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),U;x?U=function(he,de,ye,Me){!Me&&de in he||Object.defineProperty(he,de,{configurable:!0,enumerable:!1,writable:!0,value:ye})}:U=function(he,de,ye,Me){!Me&&de in he||(he[de]=ye)};var B=function(he,de,ye){for(var Me in de)h.hasOwnProperty.call(de,Me)&&U(he,Me,de[Me],ye)},Y=function(he){if(he==null)throw new TypeError("can't convert "+he+" to object");return Object(he)};function H(he){var de=+he;return de!==de?de=0:de!==0&&de!==1/0&&de!==-1/0&&(de=(de>0||-1)*Math.floor(Math.abs(de))),de}function re(he){return he>>>0}function X(){}B(f,{bind:function(de){var ye=this;if(!R(ye))throw new TypeError("Function.prototype.bind called on incompatible "+ye);for(var Me=S.call(arguments,1),Je=function(){if(this instanceof dt){var Qe=ye.apply(this,Me.concat(S.call(arguments)));return Object(Qe)===Qe?Qe:this}else return ye.apply(de,Me.concat(S.call(arguments)))},Ve=Math.max(0,ye.length-Me.length),xe=[],He=0;He<Ve;He++)xe.push("$"+He);var dt=Function("binder","return function ("+xe.join(",")+"){ return binder.apply(this, arguments); }")(Je);return ye.prototype&&(X.prototype=ye.prototype,dt.prototype=new X,X.prototype=null),dt}}),B(Array,{isArray:N});var te=Object("a"),ce=te[0]!=="a"||!(0 in te),$=function(de){var ye=!0,Me=!0;return de&&(de.call("foo",function(Je,Ve,xe){typeof xe!="object"&&(ye=!1)}),de.call([1],function(){Me=typeof this=="string"},"x")),!!de&&ye&&Me};B(u,{forEach:function(de){var ye=Y(this),Me=ce&&k(this)?this.split(""):ye,Je=arguments[1],Ve=-1,xe=Me.length>>>0;if(!R(de))throw new TypeError;for(;++Ve<xe;)Ve in Me&&de.call(Je,Me[Ve],Ve,ye)}},!$(u.forEach));var le=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;B(u,{indexOf:function(de){var ye=ce&&k(this)?this.split(""):Y(this),Me=ye.length>>>0;if(!Me)return-1;var Je=0;for(arguments.length>1&&(Je=H(arguments[1])),Je=Je>=0?Je:Math.max(0,Me+Je);Je<Me;Je++)if(Je in ye&&ye[Je]===de)return Je;return-1}},le);var ne=g.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var he=/()??/.exec("")[1]===void 0;g.split=function(de,ye){var Me=this;if(de===void 0&&ye===0)return[];if(T.call(de)!=="[object RegExp]")return ne.call(this,de,ye);var Je=[],Ve=(de.ignoreCase?"i":"")+(de.multiline?"m":"")+(de.extended?"x":"")+(de.sticky?"y":""),xe=0,He,dt,Qe,Ge;for(de=new RegExp(de.source,Ve+"g"),Me+="",he||(He=new RegExp("^"+de.source+"$(?!\\s)",Ve)),ye=ye===void 0?-1>>>0:re(ye);(dt=de.exec(Me))&&(Qe=dt.index+dt[0].length,!(Qe>xe&&(Je.push(Me.slice(xe,dt.index)),!he&&dt.length>1&&dt[0].replace(He,function(){for(var Ie=1;Ie<arguments.length-2;Ie++)arguments[Ie]===void 0&&(dt[Ie]=void 0)}),dt.length>1&&dt.index<Me.length&&u.push.apply(Je,dt.slice(1)),Ge=dt[0].length,xe=Qe,Je.length>=ye)));)de.lastIndex===dt.index&&de.lastIndex++;return xe===Me.length?(Ge||!de.test(""))&&Je.push(""):Je.push(Me.slice(xe)),Je.length>ye?Je.slice(0,ye):Je}}():"0".split(void 0,0).length&&(g.split=function(de,ye){return de===void 0&&ye===0?[]:ne.call(this,de,ye)});var ue=g.substr,Pe="".substr&&"0b".substr(-1)!=="b";return B(g,{substr:function(de,ye){return ue.call(this,de<0&&(de=this.length+de)<0?0:de,ye)}},Pe),H3}var G1,z3;function Hte(){if(z3)return G1;z3=1;var u=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h,f=function(g){var S,T={},R=[];for(S=0;S<65536;S++)R.push(String.fromCharCode(S));return g.lastIndex=0,R.join("").replace(g,function(N){return T[N]="\\u"+("0000"+N.charCodeAt(0).toString(16)).slice(-4),""}),g.lastIndex=0,T};return G1={quote:function(g){var S=JSON.stringify(g);return u.lastIndex=0,u.test(S)?(h||(h=f(u)),S.replace(u,function(T){return h[T]})):S}},G1}var H1,Y3;function Kte(){if(Y3)return H1;Y3=1;var u=function(){};return H1=function(h){return{filterToEnabled:function(f,g){var S={main:[],facade:[]};return f?typeof f=="string"&&(f=[f]):f=[],h.forEach(function(T){if(T&&!(T.transportName==="websocket"&&g.websocket===!1)){if(f.length&&f.indexOf(T.transportName)===-1){u("not in whitelist",T.transportName);return}T.enabled(g)?(u("enabled",T.transportName),S.main.push(T),T.facadeTransport&&S.facade.push(T.facadeTransport)):u("disabled",T.transportName)}}),S}}},H1}var K1,q3;function zte(){if(q3)return K1;q3=1;var u={};return["log","debug","warn"].forEach(function(h){var f;try{f=globalThis.console&&globalThis.console[h]&&globalThis.console[h].apply}catch{}u[h]=f?function(){return globalThis.console[h].apply(globalThis.console,arguments)}:h==="log"?function(){}:u.log}),K1=u,K1}var z1,X3;function ZA(){if(X3)return z1;X3=1;function u(h){this.type=h}return u.prototype.initEvent=function(h,f,g){return this.type=h,this.bubbles=f,this.cancelable=g,this.timeStamp=+new Date,this},u.prototype.stopPropagation=function(){},u.prototype.preventDefault=function(){},u.CAPTURING_PHASE=1,u.AT_TARGET=2,u.BUBBLING_PHASE=3,z1=u,z1}var Y1,J3;function vF(){return J3||(J3=1,Y1=globalThis.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}),Y1}var q1,Q3;function Yte(){if(Q3)return q1;Q3=1;var u=Un(),h=ZA();function f(){h.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return u(f,h),q1=f,q1}var X1,$3;function qte(){if($3)return X1;$3=1;var u=Un(),h=ZA();function f(g){h.call(this),this.initEvent("message",!1,!1),this.data=g}return u(f,h),X1=f,X1}var J1,Z3;function Xte(){if(Z3)return J1;Z3=1;var u=us().EventEmitter,h=Un();function f(){var g=this;u.call(this),this.to=setTimeout(function(){g.emit("finish",200,"{}")},f.timeout)}return h(f,u),f.prototype.close=function(){clearTimeout(this.to)},f.timeout=2e3,J1=f,J1}var Q1,ej;function SF(){if(ej)return Q1;ej=1;var u=us().EventEmitter,h=Un(),f=$A();function g(S,T){u.call(this);var R=this,N=+new Date;this.xo=new T("GET",S),this.xo.once("finish",function(k,x){var U,B;if(k===200){if(B=+new Date-N,x)try{U=JSON.parse(x)}catch{}f.isObject(U)||(U={})}R.emit("finish",U,B),R.removeAllListeners()})}return h(g,u),g.prototype.close=function(){this.removeAllListeners(),this.xo.close()},Q1=g,Q1}var $1,tj;function yF(){if(tj)return $1;tj=1;var u=Un(),h=us().EventEmitter,f=BE(),g=SF();function S(T){var R=this;h.call(this),this.ir=new g(T,f),this.ir.once("finish",function(N,k){R.ir=null,R.emit("message",JSON.stringify([N,k]))})}return u(S,h),S.transportName="iframe-info-receiver",S.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},$1=S,$1}var Z1,nj;function Jte(){if(nj)return Z1;nj=1;var u=us().EventEmitter,h=Un(),f=Zd(),g=EF(),S=yF();function T(R,N){var k=this;u.call(this);var x=function(){var U=k.ifr=new g(S.transportName,N,R);U.once("message",function(B){if(B){var Y;try{Y=JSON.parse(B)}catch{k.emit("finish"),k.close();return}var H=Y[0],re=Y[1];k.emit("finish",H,re)}k.close()}),U.once("close",function(){k.emit("finish"),k.close()})};globalThis.document.body?x():f.attachEvent("load",x)}return h(T,u),T.enabled=function(){return g.enabled()},T.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},Z1=T,Z1}var eA,rj;function Qte(){if(rj)return eA;rj=1;var u=us().EventEmitter,h=Un(),f=Xo(),g=QA(),S=U0(),T=BE(),R=Xte(),N=Jte(),k=SF();function x(U,B){var Y=this;u.call(this),setTimeout(function(){Y.doXhr(U,B)},0)}return h(x,u),x._getReceiver=function(U,B,Y){return Y.sameOrigin?new k(B,T):S.enabled?new k(B,S):g.enabled&&Y.sameScheme?new k(B,g):N.enabled()?new N(U,B):new k(B,R)},x.prototype.doXhr=function(U,B){var Y=this,H=f.addPath(U,"/info");this.xo=x._getReceiver(U,H,B),this.timeoutRef=setTimeout(function(){Y._cleanup(!1),Y.emit("finish")},x.timeout),this.xo.once("finish",function(re,X){Y._cleanup(!0),Y.emit("finish",re,X)})},x.prototype._cleanup=function(U){clearTimeout(this.timeoutRef),this.timeoutRef=null,!U&&this.xo&&this.xo.close(),this.xo=null},x.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},x.timeout=8e3,eA=x,eA}var tA,ij;function $te(){if(ij)return tA;ij=1;var u=GE();function h(f){this._transport=f,f.on("message",this._transportMessage.bind(this)),f.on("close",this._transportClose.bind(this))}return h.prototype._transportClose=function(f,g){u.postMessage("c",JSON.stringify([f,g]))},h.prototype._transportMessage=function(f){u.postMessage("t",f)},h.prototype._send=function(f){this._transport.send(f)},h.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},tA=h,tA}var nA,sj;function Zte(){if(sj)return nA;sj=1;var u=Xo(),h=Zd(),f=$te(),g=yF(),S=GE(),T=vF(),R=function(){};return nA=function(N,k){var x={};k.forEach(function(B){B.facadeTransport&&(x[B.facadeTransport.transportName]=B.facadeTransport)}),x[g.transportName]=g;var U;N.bootstrap_iframe=function(){var B;S.currentWindowId=T.hash.slice(1);var Y=function(H){if(H.source===parent&&(typeof U>"u"&&(U=H.origin),H.origin===U)){var re;try{re=JSON.parse(H.data)}catch{R("bad json",H.data);return}if(re.windowId===S.currentWindowId)switch(re.type){case"s":var X;try{X=JSON.parse(re.data)}catch{R("bad json",re.data);break}var te=X[0],ce=X[1],$=X[2],le=X[3];if(te!==N.version)throw new Error('Incompatible SockJS! Main site uses: "'+te+'", the iframe: "'+N.version+'".');if(!u.isOriginEqual($,T.href)||!u.isOriginEqual(le,T.href))throw new Error("Can't connect to different domain from within an iframe. ("+T.href+", "+$+", "+le+")");B=new f(new x[ce]($,le));break;case"m":B._send(re.data);break;case"c":B&&B._close(),B=null;break}}};h.attachEvent("message",Y),S.postMessage("s")}},nA}var rA,oj;function ene(){if(oj)return rA;oj=1,Gte();var u=uF(),h=Un(),f=gm(),g=Hte(),S=Xo(),T=Zd(),R=Kte(),N=$A(),k=WE(),x=zte(),U=ZA(),B=hF(),Y=vF(),H=Yte(),re=qte(),X=Qte(),te=function(){},ce;function $(ne,ue,Pe){if(!(this instanceof $))return new $(ne,ue,Pe);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");B.call(this),this.readyState=$.CONNECTING,this.extensions="",this.protocol="",Pe=Pe||{},Pe.protocols_whitelist&&x.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=Pe.transports,this._transportOptions=Pe.transportOptions||{},this._timeout=Pe.timeout||0;var he=Pe.sessionId||8;if(typeof he=="function")this._generateSessionId=he;else if(typeof he=="number")this._generateSessionId=function(){return f.string(he)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=Pe.server||f.numberString(1e3);var de=new u(ne);if(!de.host||!de.protocol)throw new SyntaxError("The URL '"+ne+"' is invalid");if(de.hash)throw new SyntaxError("The URL must not contain a fragment");if(de.protocol!=="http:"&&de.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+de.protocol+"' is not allowed.");var ye=de.protocol==="https:";if(Y.protocol==="https:"&&!ye&&!S.isLoopbackAddr(de.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");ue?Array.isArray(ue)||(ue=[ue]):ue=[];var Me=ue.sort();Me.forEach(function(Ve,xe){if(!Ve)throw new SyntaxError("The protocols entry '"+Ve+"' is invalid.");if(xe<Me.length-1&&Ve===Me[xe+1])throw new SyntaxError("The protocols entry '"+Ve+"' is duplicated.")});var Je=S.getOrigin(Y.href);this._origin=Je?Je.toLowerCase():null,de.set("pathname",de.pathname.replace(/\/+$/,"")),this.url=de.href,te("using url",this.url),this._urlInfo={nullOrigin:!k.hasDomain(),sameOrigin:S.isOriginEqual(this.url,Y.href),sameScheme:S.isSchemeEqual(this.url,Y.href)},this._ir=new X(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}h($,B);function le(ne){return ne===1e3||ne>=3e3&&ne<=4999}return $.prototype.close=function(ne,ue){if(ne&&!le(ne))throw new Error("InvalidAccessError: Invalid code");if(ue&&ue.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===$.CLOSING||this.readyState===$.CLOSED)){var Pe=!0;this._close(ne||1e3,ue||"Normal closure",Pe)}},$.prototype.send=function(ne){if(typeof ne!="string"&&(ne=""+ne),this.readyState===$.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===$.OPEN&&this._transport.send(g.quote(ne))},$.version=gF(),$.CONNECTING=0,$.OPEN=1,$.CLOSING=2,$.CLOSED=3,$.prototype._receiveInfo=function(ne,ue){if(this._ir=null,!ne){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(ue),this._transUrl=ne.base_url?ne.base_url:this.url,ne=N.extend(ne,this._urlInfo);var Pe=ce.filterToEnabled(this._transportsWhitelist,ne);this._transports=Pe.main,te(this._transports.length+" enabled transports"),this._connect()},$.prototype._connect=function(){for(var ne=this._transports.shift();ne;ne=this._transports.shift()){if(te("attempt",ne.transportName),ne.needBody&&(!globalThis.document.body||typeof globalThis.document.readyState<"u"&&globalThis.document.readyState!=="complete"&&globalThis.document.readyState!=="interactive")){this._transports.unshift(ne),T.attachEvent("load",this._connect.bind(this));return}var ue=Math.max(this._timeout,this._rto*ne.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),ue);var Pe=S.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),he=this._transportOptions[ne.transportName],de=new ne(Pe,this._transUrl,he);de.on("message",this._transportMessage.bind(this)),de.once("close",this._transportClose.bind(this)),de.transportName=ne.transportName,this._transport=de;return}this._close(2e3,"All transports failed",!1)},$.prototype._transportTimeout=function(){this.readyState===$.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},$.prototype._transportMessage=function(ne){var ue=this,Pe=ne.slice(0,1),he=ne.slice(1),de;switch(Pe){case"o":this._open();return;case"h":this.dispatchEvent(new U("heartbeat")),te("heartbeat",this.transport);return}if(he)try{de=JSON.parse(he)}catch{}if(!(typeof de>"u"))switch(Pe){case"a":Array.isArray(de)&&de.forEach(function(ye){te("message",ue.transport),ue.dispatchEvent(new re(ye))});break;case"m":te("message",this.transport),this.dispatchEvent(new re(de));break;case"c":Array.isArray(de)&&de.length===2&&this._close(de[0],de[1],!0);break}},$.prototype._transportClose=function(ne,ue){if(te("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!le(ne)&&ne!==2e3&&this.readyState===$.CONNECTING){this._connect();return}this._close(ne,ue)},$.prototype._open=function(){te("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===$.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=$.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new U("open")),te("connected",this.transport)):this._close(1006,"Server lost session")},$.prototype._close=function(ne,ue,Pe){te("_close",this.transport,ne,ue,Pe,this.readyState);var he=!1;if(this._ir&&(he=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===$.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=$.CLOSING,setTimeout((function(){this.readyState=$.CLOSED,he&&this.dispatchEvent(new U("error"));var de=new H("close");de.wasClean=Pe||!1,de.code=ne||1e3,de.reason=ue,this.dispatchEvent(de),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},$.prototype.countRTO=function(ne){return ne>100?4*ne:300+ne},rA=function(ne){return ce=R(ne),Zte()($,ne),$},rA}var iA,aj;function tne(){if(aj)return iA;aj=1;var u=Wte();return iA=ene()(u),"_sockjs_onload"in globalThis&&setTimeout(globalThis._sockjs_onload,1),iA}var nne=tne();const rne=S0(nne);function ine(u,h){u.terminate=function(){const f=()=>{};this.onerror=f,this.onmessage=f,this.onopen=f;const g=new Date,S=Math.random().toString().substring(2,8),T=this.onclose;this.onclose=R=>{const N=new Date().getTime()-g.getTime();h(`Discarded socket (#${S})  closed after ${N}ms, with code/reason: ${R.code}/${R.reason}`)},this.close(),T?.call(u,{code:4001,reason:`Quick discarding socket (#${S}) without waiting for the shutdown sequence.`,wasClean:!1})}}const bE={LF:`
`,NULL:"\0"};class Hd{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(h){const{command:f,headers:g,body:S,binaryBody:T,escapeHeaderValues:R,skipContentLengthHeader:N}=h;this.command=f,this.headers=Object.assign({},g||{}),T?(this._binaryBody=T,this.isBinaryBody=!0):(this._body=S||"",this.isBinaryBody=!1),this.escapeHeaderValues=R||!1,this.skipContentLengthHeader=N||!1}static fromRawFrame(h,f){const g={},S=T=>T.replace(/^\s+|\s+$/g,"");for(const T of h.headers.reverse()){T.indexOf(":");const R=S(T[0]);let N=S(T[1]);f&&h.command!=="CONNECT"&&h.command!=="CONNECTED"&&(N=Hd.hdrValueUnEscape(N)),g[R]=N}return new Hd({command:h.command,headers:g,binaryBody:h.binaryBody,escapeHeaderValues:f})}toString(){return this.serializeCmdAndHeaders()}serialize(){const h=this.serializeCmdAndHeaders();return this.isBinaryBody?Hd.toUnit8Array(h,this._binaryBody).buffer:h+this._body+bE.NULL}serializeCmdAndHeaders(){const h=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const f of Object.keys(this.headers||{})){const g=this.headers[f];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?h.push(`${f}:${Hd.hdrValueEscape(`${g}`)}`):h.push(`${f}:${g}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&h.push(`content-length:${this.bodyLength()}`),h.join(bE.LF)+bE.LF+bE.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const h=this.binaryBody;return h?h.length:0}static sizeOfUTF8(h){return h?new TextEncoder().encode(h).length:0}static toUnit8Array(h,f){const g=new TextEncoder().encode(h),S=new Uint8Array([0]),T=new Uint8Array(g.length+f.length+S.length);return T.set(g),T.set(f,g.length),T.set(S,g.length+f.length),T}static marshall(h){return new Hd(h).serialize()}static hdrValueEscape(h){return h.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(h){return h.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const cj=0,a0=10,c0=13,sne=58;class one{constructor(h,f){this.onFrame=h,this.onIncomingPing=f,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(h,f=!1){let g;if(typeof h=="string"?g=this._encoder.encode(h):g=new Uint8Array(h),f&&g[g.length-1]!==0){const S=new Uint8Array(g.length+1);S.set(g,0),S[g.length]=0,g=S}for(let S=0;S<g.length;S++){const T=g[S];this._onByte(T)}}_collectFrame(h){if(h!==cj&&h!==c0){if(h===a0){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(h)}}_collectCommand(h){if(h!==c0){if(h===a0){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(h)}}_collectHeaders(h){if(h!==c0){if(h===a0){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(h)}}_reinjectByte(h){this._onByte(h)}_collectHeaderKey(h){if(h===sne){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(h)}_collectHeaderValue(h){if(h!==c0){if(h===a0){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(h)}}_setupCollectBody(){const h=this._results.headers.filter(f=>f[0]==="content-length")[0];h?(this._bodyBytesRemaining=parseInt(h[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(h){if(h===cj){this._retrievedBody();return}this._consumeByte(h)}_collectBodyFixedSize(h){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(h)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(h){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",h)}this._initState()}_consumeByte(h){this._token.push(h)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const h=new Uint8Array(this._token);return this._token=[],h}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var Kd;(function(u){u[u.CONNECTING=0]="CONNECTING",u[u.OPEN=1]="OPEN",u[u.CLOSING=2]="CLOSING",u[u.CLOSED=3]="CLOSED"})(Kd||(Kd={}));var ka;(function(u){u[u.ACTIVE=0]="ACTIVE",u[u.DEACTIVATING=1]="DEACTIVATING",u[u.INACTIVE=2]="INACTIVE"})(ka||(ka={}));var E0;(function(u){u[u.LINEAR=0]="LINEAR",u[u.EXPONENTIAL=1]="EXPONENTIAL"})(E0||(E0={}));var UE;(function(u){u.Interval="interval",u.Worker="worker"})(UE||(UE={}));class ane{constructor(h,f=UE.Interval,g){this._interval=h,this._strategy=f,this._debug=g,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(h){this.stop(),this.shouldUseWorker()?this.runWorker(h):this.runInterval(h)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===UE.Worker}runWorker(h){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=f=>h(f.data))}runInterval(h){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const f=Date.now();this._timer=setInterval(()=>{h(Date.now()-f)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class ds{constructor(h){this.versions=h}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(h=>`v${h.replace(".","")}.stomp`)}}ds.V1_0="1.0";ds.V1_1="1.1";ds.V1_2="1.2";ds.default=new ds([ds.V1_2,ds.V1_1,ds.V1_0]);class cne{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(h,f,g){this._client=h,this._webSocket=f,this._connected=!1,this._serverFrameHandlers={CONNECTED:S=>{this.debug(`connected to server ${S.headers.server}`),this._connected=!0,this._connectedVersion=S.headers.version,this._connectedVersion===ds.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(S.headers),this.onConnect(S)},MESSAGE:S=>{const T=S.headers.subscription,R=this._subscriptions[T]||this.onUnhandledMessage,N=S,k=this,x=this._connectedVersion===ds.V1_2?N.headers.ack:N.headers["message-id"];N.ack=(U={})=>k.ack(x,T,U),N.nack=(U={})=>k.nack(x,T,U),R(N)},RECEIPT:S=>{const T=this._receiptWatchers[S.headers["receipt-id"]];T?(T(S),delete this._receiptWatchers[S.headers["receipt-id"]]):this.onUnhandledReceipt(S)},ERROR:S=>{this.onStompError(S)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=g.debug,this.stompVersions=g.stompVersions,this.connectHeaders=g.connectHeaders,this.disconnectHeaders=g.disconnectHeaders,this.heartbeatIncoming=g.heartbeatIncoming,this.heartbeatToleranceMultiplier=g.heartbeatGracePeriods,this.heartbeatOutgoing=g.heartbeatOutgoing,this.splitLargeFrames=g.splitLargeFrames,this.maxWebSocketChunkSize=g.maxWebSocketChunkSize,this.forceBinaryWSFrames=g.forceBinaryWSFrames,this.logRawCommunication=g.logRawCommunication,this.appendMissingNULLonIncoming=g.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=g.discardWebsocketOnCommFailure,this.onConnect=g.onConnect,this.onDisconnect=g.onDisconnect,this.onStompError=g.onStompError,this.onWebSocketClose=g.onWebSocketClose,this.onWebSocketError=g.onWebSocketError,this.onUnhandledMessage=g.onUnhandledMessage,this.onUnhandledReceipt=g.onUnhandledReceipt,this.onUnhandledFrame=g.onUnhandledFrame,this.onHeartbeatReceived=g.onHeartbeatReceived,this.onHeartbeatLost=g.onHeartbeatLost}start(){const h=new one(f=>{const g=Hd.fromRawFrame(f,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${g}`),(this._serverFrameHandlers[g.command]||this.onUnhandledFrame)(g)},()=>{this.debug("<<< PONG"),this.onHeartbeatReceived()});this._webSocket.onmessage=f=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const g=f.data instanceof ArrayBuffer?new TextDecoder().decode(f.data):f.data;this.debug(`<<< ${g}`)}h.parseChunk(f.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=f=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(f)},this._webSocket.onerror=f=>{this.onWebSocketError(f)},this._webSocket.onopen=()=>{const f=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),f["accept-version"]=this.stompVersions.supportedVersions(),f["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:f})}}_setupHeartbeat(h){if(h.version!==ds.V1_1&&h.version!==ds.V1_2||!h["heart-beat"])return;const[f,g]=h["heart-beat"].split(",").map(S=>parseInt(S,10));if(this.heartbeatOutgoing!==0&&g!==0){const S=Math.max(this.heartbeatOutgoing,g);this.debug(`send PING every ${S}ms`),this._pinger=new ane(S,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===Kd.OPEN&&(this._webSocket.send(bE.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&f!==0){const S=Math.max(this.heartbeatIncoming,f);this.debug(`check PONG every ${S}ms`),this._ponger=setInterval(()=>{const T=Date.now()-this._lastServerActivityTS;T>S*this.heartbeatToleranceMultiplier&&(this.debug(`did not receive server activity for the last ${T}ms`),this.onHeartbeatLost(),this._closeOrDiscardWebsocket())},S)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===Kd.CONNECTING||this._webSocket.readyState===Kd.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&ine(this._webSocket,h=>this.debug(h)),this._webSocket.terminate()}_transmit(h){const{command:f,headers:g,body:S,binaryBody:T,skipContentLengthHeader:R}=h,N=new Hd({command:f,headers:g,body:S,binaryBody:T,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:R});let k=N.serialize();if(this.logRawCommunication?this.debug(`>>> ${k}`):this.debug(`>>> ${N}`),this.forceBinaryWSFrames&&typeof k=="string"&&(k=new TextEncoder().encode(k)),typeof k!="string"||!this.splitLargeFrames)this._webSocket.send(k);else{let x=k;for(;x.length>0;){const U=x.substring(0,this.maxWebSocketChunkSize);x=x.substring(this.maxWebSocketChunkSize),this._webSocket.send(U),this.debug(`chunk sent = ${U.length}, remaining = ${x.length}`)}}}dispose(){if(this.connected)try{const h=Object.assign({},this.disconnectHeaders);h.receipt||(h.receipt=`close-${this._counter++}`),this.watchForReceipt(h.receipt,f=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(f)}),this._transmit({command:"DISCONNECT",headers:h})}catch(h){this.debug(`Ignoring error during disconnect ${h}`)}else(this._webSocket.readyState===Kd.CONNECTING||this._webSocket.readyState===Kd.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(h){const{destination:f,headers:g,body:S,binaryBody:T,skipContentLengthHeader:R}=h,N=Object.assign({destination:f},g);this._transmit({command:"SEND",headers:N,body:S,binaryBody:T,skipContentLengthHeader:R})}watchForReceipt(h,f){this._receiptWatchers[h]=f}subscribe(h,f,g={}){g=Object.assign({},g),g.id||(g.id=`sub-${this._counter++}`),g.destination=h,this._subscriptions[g.id]=f,this._transmit({command:"SUBSCRIBE",headers:g});const S=this;return{id:g.id,unsubscribe(T){return S.unsubscribe(g.id,T)}}}unsubscribe(h,f={}){f=Object.assign({},f),delete this._subscriptions[h],f.id=h,this._transmit({command:"UNSUBSCRIBE",headers:f})}begin(h){const f=h||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:f}});const g=this;return{id:f,commit(){g.commit(f)},abort(){g.abort(f)}}}commit(h){this._transmit({command:"COMMIT",headers:{transaction:h}})}abort(h){this._transmit({command:"ABORT",headers:{transaction:h}})}ack(h,f,g={}){g=Object.assign({},g),this._connectedVersion===ds.V1_2?g.id=h:g["message-id"]=h,g.subscription=f,this._transmit({command:"ACK",headers:g})}nack(h,f,g={}){return g=Object.assign({},g),this._connectedVersion===ds.V1_2?g.id=h:g["message-id"]=h,g.subscription=f,this._transmit({command:"NACK",headers:g})}}class lne{get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(h){this._disconnectHeaders=h,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===ka.ACTIVE}_changeState(h){this.state=h,this.onChangeState(h)}constructor(h={}){this.stompVersions=ds.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=900*1e3,this.reconnectTimeMode=E0.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatToleranceMultiplier=2,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=UE.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=ka.INACTIVE;const f=()=>{};this.debug=f,this.beforeConnect=f,this.onConnect=f,this.onDisconnect=f,this.onUnhandledMessage=f,this.onUnhandledReceipt=f,this.onUnhandledFrame=f,this.onHeartbeatReceived=f,this.onHeartbeatLost=f,this.onStompError=f,this.onWebSocketClose=f,this.onWebSocketError=f,this.logRawCommunication=!1,this.onChangeState=f,this.connectHeaders={},this._disconnectHeaders={},this.configure(h)}configure(h){Object.assign(this,h),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const h=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(ka.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===ka.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{h()})):h()}async _connect(){if(await this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const h=this._createWebSocket();this._stompHandler=new cne(this,h,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatGracePeriods:this.heartbeatToleranceMultiplier,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:f=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(f)},onDisconnect:f=>{this.onDisconnect(f)},onStompError:f=>{this.onStompError(f)},onWebSocketClose:f=>{this._stompHandler=void 0,this.state===ka.DEACTIVATING&&this._changeState(ka.INACTIVE),this.onWebSocketClose(f),this.active&&this._schedule_reconnect()},onWebSocketError:f=>{this.onWebSocketError(f)},onUnhandledMessage:f=>{this.onUnhandledMessage(f)},onUnhandledReceipt:f=>{this.onUnhandledReceipt(f)},onUnhandledFrame:f=>{this.onUnhandledFrame(f)},onHeartbeatReceived:()=>{this.onHeartbeatReceived()},onHeartbeatLost:()=>{this.onHeartbeatLost()}}),this._stompHandler.start()}_createWebSocket(){let h;if(this.webSocketFactory)h=this.webSocketFactory();else if(this.brokerURL)h=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return h.binaryType="arraybuffer",h}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===E0.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}async deactivate(h={}){const f=h.force||!1,g=this.active;let S;if(this.state===ka.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(ka.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==Kd.CLOSED){const T=this._stompHandler.onWebSocketClose;S=new Promise((R,N)=>{this._stompHandler.onWebSocketClose=k=>{T(k),R()}})}else return this._changeState(ka.INACTIVE),Promise.resolve();return f?this._stompHandler?.discardWebsocket():g&&this._disposeStompHandler(),S}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(h){this._checkConnection(),this._stompHandler.publish(h)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(h,f){this._checkConnection(),this._stompHandler.watchForReceipt(h,f)}subscribe(h,f,g={}){return this._checkConnection(),this._stompHandler.subscribe(h,f,g)}unsubscribe(h,f={}){this._checkConnection(),this._stompHandler.unsubscribe(h,f)}begin(h){return this._checkConnection(),this._stompHandler.begin(h)}commit(h){this._checkConnection(),this._stompHandler.commit(h)}abort(h){this._checkConnection(),this._stompHandler.abort(h)}ack(h,f,g={}){this._checkConnection(),this._stompHandler.ack(h,f,g)}nack(h,f,g={}){this._checkConnection(),this._stompHandler.nack(h,f,g)}}class dne{client=null;subscriptions=new Map;connectionState={isConnected:!1,isConnecting:!1,reconnectAttempts:0,maxReconnectAttempts:5};onConnectionStateChangeCallbacks=[];onMatchingNotificationCallbacks=[];onCallStartNotificationCallbacks=[];onCallEndNotificationCallbacks=[];onErrorCallbacks=[];constructor(){}setupClient(h){const f="http://localhost:8080/ws";console.log(" WebSocket URL:",f),Fe.log(" WebSocket  ");const g=new rne(f);this.client=new lne({webSocketFactory:()=>g,debug:S=>{console.log("STOMP Debug:",S)},reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),this.client.onConnect=S=>{console.log(" WebSocket  :",S),console.log("  :",S.headers),console.log("  :",S.body),this.connectionState={...this.connectionState,isConnected:!0,isConnecting:!1,reconnectAttempts:0,lastConnected:new Date().toISOString()},this.onConnectionStateChangeCallbacks.forEach(T=>T(this.connectionState)),console.log("   "),this.subscribeToQueues(),setTimeout(()=>{this.logSubscriptionStatus()},100)},this.client.onStompError=S=>{console.error(" STOMP :",S),console.error("  :",S.headers),console.error("  :",S.body),this.connectionState={...this.connectionState,isConnected:!1,isConnecting:!1},this.onConnectionStateChangeCallbacks.forEach(R=>R(this.connectionState));const T=`WebSocket  : ${S.headers.message||"   "}`;this.onErrorCallbacks.forEach(R=>R(T))},this.client.onDisconnect=()=>{console.log("WebSocket  "),this.connectionState={...this.connectionState,isConnected:!1,isConnecting:!1},this.onConnectionStateChangeCallbacks.forEach(S=>S(this.connectionState))}}async connect(h){if(this.connectionState.isConnected||this.connectionState.isConnecting){console.log("    .");return}try{console.log(" WebSocket   "),this.connectionState={...this.connectionState,isConnecting:!0},this.onConnectionStateChangeCallbacks.forEach(f=>f(this.connectionState)),this.client||(console.log(" WebSocket  "),this.setupClient(h)),this.client.connectHeaders={Authorization:`Bearer ${h}`},console.log(" JWT    (URL + )"),console.log(" STOMP   "),await this.client.activate(),console.log(" STOMP   ")}catch(f){console.error(" WebSocket  :",f),this.connectionState={...this.connectionState,isConnecting:!1,reconnectAttempts:this.connectionState.reconnectAttempts+1},this.onConnectionStateChangeCallbacks.forEach(S=>S(this.connectionState));const g=` : ${f instanceof Error?f.message:"   "}`;throw this.onErrorCallbacks.forEach(S=>S(g)),f}}disconnect(){this.client&&this.connectionState.isConnected&&(this.unsubscribeFromQueues(),this.client.deactivate())}subscribeToQueues(){if(!this.client||!this.connectionState.isConnected){console.warn(" WebSocket    ");return}console.log("    -  :",{isConnected:this.connectionState.isConnected,clientExists:!!this.client}),console.log(" /user/queue/matching  ");const h=this.client.subscribe("/user/queue/matching",S=>{try{console.log(" [] WebSocket   (/user/queue/matching):",S.body);const T=JSON.parse(S.body);console.log(" []   :",T),console.log(" []  :",{type:T.type,matchingId:T.matchingId,matchedUser:T.matchedUser,message:T.message,timestamp:T.timestamp}),console.log(` [] ${this.onMatchingNotificationCallbacks.length}  `),this.onMatchingNotificationCallbacks.forEach(R=>R(T))}catch(T){console.error(" []   :",T),console.error(" []  :",S.body);const R="     .";this.onErrorCallbacks.forEach(N=>N(R))}});console.log(" /user/queue/call-start  ");const f=this.client.subscribe("/user/queue/call-start",S=>{try{console.log(" [] WebSocket   (/user/queue/call-start):",S.body);const T=JSON.parse(S.body);console.log(" []   :",T),console.log(" []  :",{type:T.type,callId:T.callId,matchingId:T.matchingId,partnerId:T.partnerId,partnerNickname:T.partnerNickname,channelName:T.channelName,agoraUid:T.agoraUid,timestamp:T.timestamp}),console.log(` [] ${this.onCallStartNotificationCallbacks.length}  `),this.onCallStartNotificationCallbacks.forEach(R=>R(T))}catch(T){console.error(" []   :",T),console.error(" []  :",S.body);const R="      .";this.onErrorCallbacks.forEach(N=>N(R))}});console.log(" /user/queue/call-end  ");const g=this.client.subscribe("/user/queue/call-end",S=>{try{console.log(" [] WebSocket   (/user/queue/call-end):",S.body);const T=JSON.parse(S.body);console.log(" []   :",T),console.log(" []  :",{type:T.type,callId:T.callId,partnerId:T.partnerId,timestamp:T.timestamp}),console.log(` [] ${this.onCallEndNotificationCallbacks.length}  `),this.onCallEndNotificationCallbacks.forEach(R=>R(T))}catch(T){console.error(" []   :",T),console.error(" []  :",S.body);const R="      .";this.onErrorCallbacks.forEach(N=>N(R))}});this.subscriptions.set("matching",h),this.subscriptions.set("call-start",f),this.subscriptions.set("call-end",g),console.log("   :",{matchingSubscribed:this.subscriptions.has("matching"),callStartSubscribed:this.subscriptions.has("call-start"),callEndSubscribed:this.subscriptions.has("call-end"),totalSubscriptions:this.subscriptions.size})}unsubscribeFromQueues(){this.subscriptions.forEach((h,f)=>{h.unsubscribe(),console.log(` : ${f}`)}),this.subscriptions.clear()}onConnectionStateChangeCallback(h){this.onConnectionStateChangeCallbacks.includes(h)||(this.onConnectionStateChangeCallbacks.push(h),console.log(`      ( ${this.onConnectionStateChangeCallbacks.length})`))}onMatchingNotificationCallback(h){this.onMatchingNotificationCallbacks.includes(h)||(this.onMatchingNotificationCallbacks.push(h),console.log(`     ( ${this.onMatchingNotificationCallbacks.length})`))}onCallStartNotificationCallback(h){this.onCallStartNotificationCallbacks.includes(h)||(this.onCallStartNotificationCallbacks.push(h),console.log(`      ( ${this.onCallStartNotificationCallbacks.length})`))}onCallEndNotificationCallback(h){this.onCallEndNotificationCallbacks.includes(h)||(this.onCallEndNotificationCallbacks.push(h),console.log(`      ( ${this.onCallEndNotificationCallbacks.length})`))}onErrorCallback(h){this.onErrorCallbacks.includes(h)||(this.onErrorCallbacks.push(h),console.log(`    ( ${this.onErrorCallbacks.length})`))}sendMessage(h,f){if(!this.client||!this.connectionState.isConnected)throw console.error(" WebSocket   -   "),new Error("WebSocket  .");try{this.client.publish({destination:h,body:JSON.stringify(f)}),console.log(" WebSocket   ")}catch(g){throw console.error(" WebSocket   :",g),g}}sendCallEndNotification(h,f){const g={type:"call_end",callId:h,partnerId:f,timestamp:new Date().toISOString()},S=`/app/call-end/${f}`;this.sendMessage(S,g)}getConnectionState(){return{...this.connectionState}}isConnected(){return this.connectionState.isConnected}getSubscriptionStatus(){const h={};return this.subscriptions.forEach((f,g)=>{h[g]=!0}),h}logSubscriptionStatus(){console.log(" WebSocket  :",{isConnected:this.connectionState.isConnected,subscriptions:this.getSubscriptionStatus(),totalSubscriptions:this.subscriptions.size,lastConnected:this.connectionState.lastConnected})}async reconnect(h){if(this.connectionState.reconnectAttempts>=this.connectionState.maxReconnectAttempts)throw new Error("    .");console.log(`  ${this.connectionState.reconnectAttempts+1}/${this.connectionState.maxReconnectAttempts}`),this.disconnect(),this.client=null,await new Promise(f=>setTimeout(f,2e3)),await this.connect(h)}destroy(){this.disconnect(),this.subscriptions.clear(),this.client=null,this.onConnectionStateChangeCallbacks=[],this.onMatchingNotificationCallbacks=[],this.onCallStartNotificationCallbacks=[],this.onCallEndNotificationCallbacks=[],this.onErrorCallbacks=[],console.log(" WebSocket   ")}}let sA=null;const V0=()=>(sA||(sA=new dne),sA),nm=V0(),lj={status:"idle",matchingId:void 0,categoryId:void 0,location:void 0,queuePosition:void 0,estimatedWaitTime:void 0,matchedUser:void 0,connectionState:{isConnected:!1,isConnecting:!1,reconnectAttempts:0,maxReconnectAttempts:5},categories:[],error:void 0,createdAt:void 0,updatedAt:void 0},eO=dF()(Tte(Rte((u,h)=>({...lj,startMatching:async f=>{try{u({error:null,status:"waiting"});const g=uo();if(!g)throw new Error("  .");Gd.setToken(g);const S=await Gd.joinMatching(f);u({matchingId:S.queue_id,status:S.queue_status.toLowerCase(),categoryId:S.category_id,queuePosition:S.queue_position,estimatedWaitTime:Math.ceil(S.estimated_wait_time_seconds/60),createdAt:S.created_at,updatedAt:new Date().toISOString()});const T=V0(),R=T.getConnectionState();if(!h().connectionState.isConnected||!R.isConnected)try{await h().connectWebSocket()}catch{}else{const N=T.getSubscriptionStatus();if(Object.keys(N).length===0)try{await h().connectWebSocket()}catch{}}}catch(g){const S=g instanceof Error?g.message:"    .";throw u({error:S,status:"idle"}),g}},cancelMatching:async()=>{try{u({error:null});const f=uo();if(!f)throw new Error("  .");const{matchingId:g}=h();if(!g)throw new Error("  .");Gd.setToken(f),await Gd.cancelMatching(g),u({status:"cancelled",updatedAt:new Date().toISOString()})}catch(f){const g=f instanceof Error?f.message:"    .";throw u({error:g}),f}},refreshMatchingStatus:async()=>{try{u({error:null});const f=uo();if(!f)throw new Error("  .");Gd.setToken(f);const g=await Gd.getMatchingStatus();h().setMatchingStatus(g)}catch(f){const g=f instanceof Error?f.message:"     .";throw u({error:g}),f}},loadCategories:async()=>{try{u({error:null});const f=uo();Gd.setToken(f||void 0);const g=await Gd.getActiveCategories();u({categories:g})}catch(f){const g=f instanceof Error?f.message:"     .";throw u({error:g}),f}},connectWebSocket:async()=>{try{const f=uo();if(!f)throw new Error("  .");u({error:null,connectionState:{...h().connectionState,isConnecting:!0}}),nm.onConnectionStateChangeCallback(g=>{h().setConnectionState(g)}),nm.onMatchingNotificationCallback(g=>{h().handleMatchingNotification(g)}),nm.onCallStartNotificationCallback(g=>{h().handleCallStartNotification(g)}),nm.onErrorCallback(g=>{h().setError(g)}),await nm.connect(f)}catch(f){console.error(" connectWebSocket :",f);const g=f instanceof Error?f.message:"WebSocket    .";throw u({error:g,connectionState:{...h().connectionState,isConnecting:!1}}),f}},disconnectWebSocket:()=>{nm.disconnect(),u({connectionState:{...h().connectionState,isConnected:!1,isConnecting:!1}})},setMatchingStatus:f=>{u({status:f.status,queuePosition:f.queuePosition,estimatedWaitTime:f.estimatedWaitTime,categoryId:f.categoryId,location:f.location,matchedUser:f.matchedUser,updatedAt:new Date().toISOString()})},setConnectionState:f=>{u({connectionState:{...h().connectionState,...f}})},setError:f=>{u({error:f})},setCategories:f=>{u({categories:f})},handleMatchingNotification:f=>{switch(h(),f.type){case"position_update":u({queuePosition:f.queuePosition,estimatedWaitTime:f.estimatedWaitTime,updatedAt:new Date().toISOString()});break;case"matched":u({status:"matched",matchedUser:f.matchedUser,updatedAt:new Date().toISOString()});break;case"cancelled":u({status:"cancelled",updatedAt:new Date().toISOString()});break;case"timeout":u({status:"timeout",updatedAt:new Date().toISOString()});break}},handleCallStartNotification:f=>{u({updatedAt:new Date().toISOString()})},resetMatching:()=>{u({...lj,categories:h().categories,connectionState:h().connectionState})}}),{name:"matching-store",partialize:u=>({categories:u.categories,connectionState:u.connectionState})}),{name:"matching-store"})),v0={HOBBY:{id:1,name:"",icon:"hobby.png"},CHILDREN:{id:2,name:"",icon:"children.png"},SPOUSE:{id:3,name:"",icon:"marriage.png"},MEMORIES:{id:4,name:"",icon:"memories.png"},STRESS:{id:5,name:"",icon:"stress.png"},REQUEST:{id:0,name:"",icon:"plus.png"}};function TF(u){if(u==null)return"  ";const h=typeof u=="string"?parseInt(u):u;if(!isNaN(h))return Object.values(v0).find(T=>T.id===h)?.name||"  ";const f=String(u).toUpperCase();return v0[f]?.name||String(u)}function une({isOpen:u,onClose:h,onSubmit:f}){const[g,S]=ee.useState(""),[T,R]=ee.useState(!1),N=async()=>{if(!g.trim()){alert("  .");return}if(g.trim().length<2){alert("   2  .");return}R(!0);try{await f(g.trim()),S(""),h()}catch(U){console.error("  :",U)}finally{R(!1)}},k=()=>{T||(S(""),h())},x=U=>{U.key==="Enter"&&!T&&N()};return u?O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4",onClick:k,children:O.jsxs("div",{className:"bg-white rounded-2xl p-6 md:p-8 max-w-md w-full",onClick:U=>U.stopPropagation(),children:[O.jsx("h2",{className:"text-xl md:text-2xl font-crimson font-bold text-gray-900 mb-3",children:" "}),O.jsxs("p",{className:"text-gray-600 font-pretendard text-sm md:text-base mb-6",children:["   .",O.jsx("br",{}),"     ."]}),O.jsx("input",{type:"text",value:g,onChange:U=>S(U.target.value),onKeyPress:x,placeholder:": , , ,  ",maxLength:20,disabled:T,className:"w-full px-4 py-3 border border-gray-300 rounded-lg font-pretendard text-base focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed mb-6"}),O.jsxs("div",{className:"flex gap-3",children:[O.jsx("button",{onClick:k,disabled:T,className:"flex-1 py-3 border-2 border-gray-300 text-gray-700 font-crimson text-lg font-semibold rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:""}),O.jsx("button",{onClick:N,disabled:T||!g.trim(),className:"flex-1 py-3 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-lg font-semibold rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed",children:T?" ...":""})]})]})}):null}function hne({onStartCall:u,onOpenSettings:h,onOpenCallHistory:f}){const g=$d(),{startMatching:S,status:T,error:R}=eO(),[N,k]=ee.useState(null),[x,U]=ee.useState(!1),[B,Y]=ee.useState(" "),[H,re]=ee.useState(!0),[X,te]=ee.useState(!1),[ce,$]=ee.useState(!1),[le,ne]=ee.useState(!1);ee.useEffect(()=>{let ye=!0;return(async()=>{try{re(!0);const Je=await JA();ye&&Y(Je.data.nickname)}catch(Je){console.error("   :",Je),Je instanceof Error&&Je.message.includes(" ")&&console.warn("    ")}finally{ye&&re(!1)}})(),()=>{ye=!1}},[]);const ue=Object.values(v0).map(ye=>({id:ye.id.toString(),name:ye.name,icon:ye.id===0?O.jsx("div",{className:"w-full h-full flex items-center justify-center",children:O.jsxs("svg",{className:"w-16 h-16 xs:w-14 xs:h-14",viewBox:"0 0 64 64",fill:"none",preserveAspectRatio:"xMidYMid meet",children:[O.jsx("circle",{cx:"32",cy:"32",r:"30",fill:"#FFDAB9"}),O.jsx("path",{d:"M32 16V48M16 32H48",stroke:"#EF4444",strokeWidth:"6",strokeLinecap:"round"})]})}):O.jsx("div",{className:"w-full h-full flex items-center justify-center",children:O.jsx("img",{src:`/icons/${ye.icon}`,alt:ye.name,className:"w-16 h-16 xs:w-12 xs:h-12 object-contain"})})})),Pe=async()=>{if(!(!N||X))try{te(!0),await S({category_id:parseInt(N)}),g("/connecting-call")}catch(ye){console.error("   :",ye)}finally{te(!1)}},he=ye=>{if(ye==="0"){$(!0);return}k(ye)},de=async ye=>{try{const Me=uo();if(!Me){alert(" .");return}const Je="http://localhost:8080/api".replace(/\/$/,""),Ve={category_name:ye},xe=await fetch(`${Je}/v1/categories/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Me}`},credentials:"include",body:JSON.stringify(Ve)});if(!xe.ok){const dt=await xe.json().catch(()=>({}));throw new Error(dt.message||"  .")}const He=await xe.json();ne(!0),setTimeout(()=>{ne(!1)},2e3)}catch(Me){throw console.error("  :",Me),alert(Me instanceof Error?Me.message:"  .  ."),Me}};return O.jsxs("div",{className:"min-h-screen bg-grey-50 flex flex-col safe-area-page font-noto",children:[O.jsx(une,{isOpen:ce,onClose:()=>$(!1),onSubmit:de}),le&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"category-request-success-title","aria-describedby":"category-request-success-desc",children:O.jsxs("div",{className:"bg-white rounded-lg p-6 mx-4 text-center",children:[O.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),O.jsx("h3",{id:"category-request-success-title",className:"text-lg font-semibold text-gray-900 mb-2",children:"  !"}),O.jsx("p",{id:"category-request-success-desc",className:"text-gray-600",children:"  ."})]})}),O.jsxs("div",{className:"flex items-center justify-between px-8 py-4",children:[O.jsx("div",{className:"flex items-center",children:O.jsxs("svg",{width:"90",height:"28",viewBox:"0 0 90 28",fill:"none",children:[O.jsx("path",{d:"M67.8945 7.44597V4.56752H79.6163V7.44597H75.5525V9.61661C75.5525 10.6076 75.4585 11.4805 75.2706 12.2827C76.3276 13.722 78.7472 15.9634 80.4855 16.8835L79.123 19.8328C77.5726 19.0306 75.4115 17.1431 74.0726 15.2792C73.7907 15.751 73.4853 16.1993 73.1564 16.6712C72.2638 17.9453 70.2671 19.8328 68.9281 20.517L67.0019 17.8037C67.7771 17.4026 69.116 16.3409 70.0557 15.2792C71.5591 13.604 72.1228 12.0232 72.1228 9.73458V7.44597H67.8945ZM81.8244 3.55298H85.2306V10.7963H88.3548V14.0287H85.2306V23.8201H81.8244V3.55298Z",fill:"black"}),O.jsx("path",{d:"M51.7229 10.5604C55.0586 10.5604 57.4781 12.6838 57.4781 15.869C57.4781 19.0542 55.0586 21.154 51.7229 21.154C48.3638 21.154 45.9912 19.0778 45.9912 15.869C45.9912 12.6838 48.3638 10.5604 51.7229 10.5604ZM59.7332 23.8201V3.55296H63.1393V10.985H66.2636V14.2174H63.1393V23.8201H59.7332ZM45.0751 6.4786H50.1255L49.7732 3.48218H53.8371L53.4847 6.4786H58.3472V9.33347H45.0751V6.4786ZM51.7229 13.2029C50.1725 13.2029 49.1155 14.1938 49.1155 15.869C49.1155 17.5677 50.1725 18.5115 51.7229 18.5115C53.2733 18.5115 54.3304 17.5441 54.3304 15.869C54.3304 14.1938 53.2733 13.2029 51.7229 13.2029Z",fill:"black"}),O.jsx("path",{d:"M23.1718 14.4297H35.9507C36.2091 13.368 36.4675 11.6928 36.6319 10.0176C36.7259 9.05028 36.7729 7.87058 36.7963 6.78526H25.5679V3.85962H40.3434C40.3669 6.10104 40.2964 7.89418 40.1085 9.7581C39.8971 11.504 39.4743 13.3444 39.1219 14.4297H43.0683V17.3553H34.8936V24.693H31.2526V17.3553H23.1718V14.4297Z",fill:"black"}),O.jsx("path",{d:"M6.13102 2.93945H10.1009L9.84253 5.36963H13.8594V8.22449H9.81904V8.76715C9.81904 9.3334 9.72508 9.87606 9.56065 10.3951C10.9936 11.4569 13.1077 12.4714 14.3292 12.8253L13.5071 15.7745C11.9802 15.4206 9.70159 14.123 8.19819 12.7781C7.91631 13.132 7.58744 13.4623 7.25857 13.7927C6.01357 14.9959 4.18131 16.0813 2.67791 16.5059L1.57385 13.5331C2.46649 13.2028 3.82895 12.5658 4.74508 11.8108C5.91961 10.8434 6.41291 9.94684 6.41291 8.76715V8.22449H2.16112V5.36963H6.36593L6.13102 2.93945ZM8.40961 17.1194V21.4843H19.92V24.4807H4.95649V17.1194H8.40961ZM16.232 3.5529H19.6381V18.2519H16.232V3.5529Z",fill:"black"})]})}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("button",{type:"button",onClick:f,className:"px-3 py-1 border-2 border-orange-accent text-orange-accent font-crimson text-sm font-bold rounded hover:bg-orange-50 transition-colors",children:" "}),O.jsx("button",{type:"button",onClick:h,className:"p-3",title:"",children:O.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:[O.jsx("path",{d:"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z",stroke:"#EA8C4B",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),O.jsx("path",{d:"M19.4 15C19.2669 15.3016 19.2272 15.6362 19.286 15.9606C19.3448 16.285 19.4995 16.5843 19.73 16.82L19.79 16.88C19.976 17.0657 20.1235 17.2863 20.2241 17.5291C20.3248 17.7719 20.3766 18.0322 20.3766 18.295C20.3766 18.5578 20.3248 18.8181 20.2241 19.0609C20.1235 19.3037 19.976 19.5243 19.79 19.71C19.6043 19.896 19.3837 20.0435 19.1409 20.1441C18.8981 20.2448 18.6378 20.2966 18.375 20.2966C18.1122 20.2966 17.8519 20.2448 17.6091 20.1441C17.3663 20.0435 17.1457 19.896 16.96 19.71L16.9 19.65C16.6643 19.4195 16.365 19.2648 16.0406 19.206C15.7162 19.1472 15.3816 19.1869 15.08 19.32C14.7842 19.4468 14.532 19.6572 14.3543 19.9255C14.1766 20.1938 14.0813 20.5082 14.08 20.83V21C14.08 21.5304 13.8693 22.0391 13.4942 22.4142C13.1191 22.7893 12.6104 23 12.08 23C11.5496 23 11.0409 22.7893 10.6658 22.4142C10.2907 22.0391 10.08 21.5304 10.08 21V20.91C10.0723 20.579 9.96512 20.258 9.77251 19.9887C9.5799 19.7194 9.31074 19.5143 9 19.4C8.69838 19.2669 8.36381 19.2272 8.03941 19.286C7.71502 19.3448 7.41568 19.4995 7.18 19.73L7.12 19.79C6.93425 19.976 6.71368 20.1235 6.47088 20.2241C6.22808 20.3248 5.96783 20.3766 5.705 20.3766C5.44217 20.3766 5.18192 20.3248 4.93912 20.2241C4.69632 20.1235 4.47575 19.976 4.29 19.79C4.10405 19.6043 3.95653 19.3837 3.85588 19.1409C3.75523 18.8981 3.70343 18.6378 3.70343 18.375C3.70343 18.1122 3.75523 17.8519 3.85588 17.6091C3.95653 17.3663 4.10405 17.1457 4.29 16.96L4.35 16.9C4.58054 16.6643 4.73519 16.365 4.794 16.0406C4.85282 15.7162 4.81312 15.3816 4.68 15.08C4.55324 14.7842 4.34276 14.532 4.07447 14.3543C3.80618 14.1766 3.49179 14.0813 3.17 14.08H3C2.46957 14.08 1.96086 13.8693 1.58579 13.4942C1.21071 13.1191 1 12.6104 1 12.08C1 11.5496 1.21071 11.0409 1.58579 10.6658C1.96086 10.2907 2.46957 10.08 3 10.08H3.09C3.42099 10.0723 3.742 9.96512 4.0113 9.77251C4.28059 9.5799 4.48572 9.31074 4.6 9C4.73312 8.69838 4.77282 8.36381 4.714 8.03941C4.65519 7.71502 4.50054 7.41568 4.27 7.18L4.21 7.12C4.02405 6.93425 3.87653 6.71368 3.77588 6.47088C3.67523 6.22808 3.62343 5.96783 3.62343 5.705C3.62343 5.44217 3.67523 5.18192 3.77588 4.93912C3.87653 4.69632 4.02405 4.47575 4.21 4.29C4.39575 4.10405 4.61632 3.95653 4.85912 3.85588C5.10192 3.75523 5.36217 3.70343 5.625 3.70343C5.88783 3.70343 6.14808 3.75523 6.39088 3.85588C6.63368 3.95653 6.85425 4.10405 7.04 4.29L7.1 4.35C7.33568 4.58054 7.63502 4.73519 7.95941 4.794C8.28381 4.85282 8.61838 4.81312 8.92 4.68H9C9.29577 4.55324 9.54802 4.34276 9.72569 4.07447C9.90337 3.80618 9.99872 3.49179 10 3.17V3C10 2.46957 10.2107 1.96086 10.5858 1.58579C10.9609 1.21071 11.4696 1 12 1C12.5304 1 13.0391 1.21071 13.4142 1.58579C13.7893 1.96086 14 2.46957 14 3V3.09C14.0013 3.41179 14.0966 3.72618 14.2743 3.99447C14.452 4.26276 14.7042 4.47324 15 4.6C15.3016 4.73312 15.6362 4.77282 15.9606 4.714C16.285 4.65519 16.5843 4.50054 16.82 4.27L16.88 4.21C17.0657 4.02405 17.2863 3.87653 17.5291 3.77588C17.7719 3.67523 18.0322 3.62343 18.295 3.62343C18.5578 3.62343 18.8181 3.67523 19.0609 3.77588C19.3037 3.87653 19.5243 4.02405 19.71 4.21C19.896 4.39575 20.0435 4.61632 20.1441 4.85912C20.2448 5.10192 20.2966 5.36217 20.2966 5.625C20.2966 5.88783 20.2448 6.14808 20.1441 6.39088C20.0435 6.63368 19.896 6.85425 19.71 7.04L19.65 7.1C19.4195 7.33568 19.2648 7.63502 19.206 7.95941C19.1472 8.28381 19.1869 8.61838 19.32 8.92V9C19.4468 9.29577 19.6572 9.54802 19.9255 9.72569C20.1938 9.90337 20.5082 9.99872 20.83 10H21C21.5304 10 22.0391 10.2107 22.4142 10.5858C22.7893 10.9609 23 11.4696 23 12C23 12.5304 22.7893 13.0391 22.4142 13.4142C22.0391 13.7893 21.5304 14 21 14H20.91C20.5882 14.0013 20.2738 14.0966 20.0055 14.2743C19.7372 14.452 19.5268 14.7042 19.4 15V15Z",stroke:"#EA8C4B",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),O.jsx("div",{className:"px-8 mb-6",children:O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("div",{className:"relative",children:O.jsx("button",{onClick:()=>U(!x),className:"flex items-center gap-1 px-3 py-1 bg-white border border-grey-100 rounded",children:O.jsx("span",{className:"text-orange-accent font-crimson text-lg font-semibold",children:H?" ...":B})})}),O.jsx("span",{className:"text-grey-900 font-crimson text-lg font-bold",children:""})]})}),O.jsx("div",{className:"px-8 mb-8",children:O.jsx("h2",{className:"text-grey-900 font-crimson text-xl font-bold",children:"   !"})}),O.jsx("div",{className:"px-8",children:O.jsx("div",{className:"grid grid-cols-2 gap-6 mb-8",children:ue.map(ye=>O.jsx("button",{onClick:()=>he(ye.id),disabled:X,className:`relative h-32 border border-grey-100 rounded-2xl flex items-center justify-center px-4 xs:px-2 overflow-hidden transition-colors hover:shadow-md ${ye.id==="0"?"bg-orange-50":"bg-white"} ${N===ye.id?"border-orange-accent bg-orange-accent/5":""} ${X?"opacity-50 cursor-not-allowed":""}`,children:O.jsxs("div",{className:"flex items-center justify-center gap-3 xs:justify-between xs:w-full",children:[O.jsx("span",{className:"text-grey-900 font-crimson text-2xl xs:text-1.5xl font-bold whitespace-nowrap text-center pl-4",children:ye.name}),O.jsx("div",{className:"w-20 xs:w-16 flex items-center justify-center flex-shrink-0 pr-4",children:ye.icon})]})},ye.id))})}),R&&O.jsx("div",{className:"px-8 mb-4",children:O.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:O.jsx("p",{className:"text-red-600 font-crimson text-sm",children:R})})}),O.jsx("div",{className:"px-8 pb-12",children:O.jsx("div",{className:"h-24 relative",children:O.jsx("button",{onClick:Pe,disabled:!N||X,className:`w-full h-16 rounded-lg font-crimson text-2xl font-semibold text-white transition-all ${N&&!X?"bg-gradient-to-r from-yellow-300 to-red-gradient shadow-lg":"bg-gray-400 opacity-50 cursor-not-allowed"}`,children:X?" ...":" "})})})]})}const dj={callId:null,matchingId:null,partner:null,agoraChannelInfo:null,isInCall:!1,isConnecting:!1,callStartTime:null,agoraState:{isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},error:null},uj=dF((u,h)=>({...dj,startCall:f=>{const g={id:String(f.partnerId),nickname:f.partnerNickname};u({callId:String(f.callId),matchingId:f.matchingId||null,partner:g,agoraChannelInfo:null,isInCall:!0,callStartTime:new Date,error:null})},endCall:()=>{const f=h();u({callId:f.callId,matchingId:null,partner:f.partner,agoraChannelInfo:null,isInCall:!1,isConnecting:!1,callStartTime:null,agoraState:{isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},error:null})},updateConnectingState:f=>{u({isConnecting:f})},updateAgoraState:f=>{u({agoraState:f})},setError:f=>{u({error:f})},reset:()=>{u(dj)},clearPartner:()=>{u({partner:null,callId:null})}}));var h0={exports:{}},pne=h0.exports,hj;function fne(){return hj||(hj=1,function(u,h){(function(f,g){u.exports=g()})(pne,function(){function f(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function S(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var T=function(e){try{return!!e()}catch{return!0}},R=!T(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),N=R,k=Function.prototype,x=k.call,U=N&&k.bind.bind(x,x),B=N?U:function(e){return function(){return x.apply(e,arguments)}},Y=B({}.isPrototypeOf),H=function(e){return e&&e.Math===Math&&e},re=H(typeof globalThis=="object"&&globalThis)||H(typeof window=="object"&&window)||H(typeof self=="object"&&self)||H(typeof g=="object"&&g)||H(typeof g=="object"&&g)||function(){return this}()||Function("return this")(),X=R,te=Function.prototype,ce=te.apply,$=te.call,le=typeof Reflect=="object"&&Reflect.apply||(X?$.bind(ce):function(){return $.apply(ce,arguments)}),ne=B,ue=ne({}.toString),Pe=ne("".slice),he=function(e){return Pe(ue(e),8,-1)},de=he,ye=B,Me=function(e){if(de(e)==="Function")return ye(e)},Je=typeof document=="object"&&document.all,Ve=Je===void 0&&Je!==void 0?function(e){return typeof e=="function"||e===Je}:function(e){return typeof e=="function"},xe={},He=!T(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),dt=R,Qe=Function.prototype.call,Ge=dt?Qe.bind(Qe):function(){return Qe.apply(Qe,arguments)},Ie={},ke={}.propertyIsEnumerable,Ye=Object.getOwnPropertyDescriptor,_e=Ye&&!ke.call({1:2},1);Ie.f=_e?function(e){var t=Ye(this,e);return!!t&&t.enumerable}:ke;var De,ct,at=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ot=T,Gt=he,yt=Object,pn=B("".split),vn=Ot(function(){return!yt("z").propertyIsEnumerable(0)})?function(e){return Gt(e)==="String"?pn(e,""):yt(e)}:yt,or=function(e){return e==null},hs=or,Ua=TypeError,zr=function(e){if(hs(e))throw new Ua("Can't call method on "+e);return e},eu=vn,Bh=zr,ps=function(e){return eu(Bh(e))},tu=Ve,fr=function(e){return typeof e=="object"?e!==null:tu(e)},Qr={},fo=Qr,Di=re,bl=Ve,Ms=function(e){return bl(e)?e:void 0},Or=function(e,t){return arguments.length<2?Ms(fo[e])||Ms(Di[e]):fo[e]&&fo[e][t]||Di[e]&&Di[e][t]},nu=re.navigator,li=nu&&nu.userAgent,Yr=li?String(li):"",Uc=re,Il=Yr,Us=Uc.process,Va=Uc.Deno,ru=Us&&Us.versions||Va&&Va.version,Vc=ru&&ru.v8;Vc&&(ct=(De=Vc.split("."))[0]>0&&De[0]<4?1:+(De[0]+De[1])),!ct&&Il&&(!(De=Il.match(/Edge\/(\d+)/))||De[1]>=74)&&(De=Il.match(/Chrome\/(\d+)/))&&(ct=+De[1]);var Ti=ct,iu=Ti,mo=T,su=re.String,_o=!!Object.getOwnPropertySymbols&&!mo(function(){var e=Symbol("symbol detection");return!su(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&iu&&iu<41}),jc=_o&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Al=Or,ja=Ve,go=Y,Vs=Object,Fa=jc?function(e){return typeof e=="symbol"}:function(e){var t=Al("Symbol");return ja(t)&&go(t.prototype,Vs(e))},Kt=String,fn=function(e){try{return Kt(e)}catch{return"Object"}},Fn=Ve,Ci=fn,Li=TypeError,Bn=function(e){if(Fn(e))return e;throw new Li(Ci(e)+" is not a function")},js=Bn,$r=or,Xi=function(e,t){var n=e[t];return $r(n)?void 0:js(n)},Ol=Ge,ou=Ve,au=fr,vm=TypeError,HE={exports:{}},KE=re,j0=Object.defineProperty,Fc=re,zE=function(e,t){try{j0(KE,e,{value:t,configurable:!0,writable:!0})}catch{KE[e]=t}return t},Sm="__core-js_shared__",YE=HE.exports=Fc[Sm]||zE(Sm,{});(YE.versions||(YE.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Wh=HE.exports,ym=Wh,Bc=function(e,t){return ym[e]||(ym[e]=t||{})},qE=zr,F0=Object,Eo=function(e){return F0(qE(e))},Sr=Eo,B0=B({}.hasOwnProperty),mr=Object.hasOwn||function(e,t){return B0(Sr(e),t)},XE=B,Gh=0,W0=Math.random(),JE=XE(1 .toString),Nl=function(e){return"Symbol("+(e===void 0?"":e)+")_"+JE(++Gh+W0,36)},vo=Bc,QE=mr,Fs=Nl,G0=_o,H0=jc,Pl=re.Symbol,kl=vo("wks"),Hh=H0?Pl.for||Pl:Pl&&Pl.withoutSetter||Fs,An=function(e){return QE(kl,e)||(kl[e]=G0&&QE(Pl,e)?Pl[e]:Hh("Symbol."+e)),kl[e]},Kh=Ge,$E=fr,ZE=Fa,Tm=Xi,ev=function(e,t){var n,r;if(ou(n=e.toString)&&!au(r=Ol(n,e))||ou(n=e.valueOf)&&!au(r=Ol(n,e)))return r;throw new vm("Can't convert object to primitive value")},Cm=TypeError,cu=An("toPrimitive"),K0=function(e,t){if(!$E(e)||ZE(e))return e;var n,r=Tm(e,cu);if(r){if(n=Kh(r,e,t),!$E(n)||ZE(n))return n;throw new Cm("Can't convert object to primitive value")}return ev(e)},wm=Fa,On=function(e){var t=K0(e,"string");return wm(t)?t:t+""},Rm=fr,zh=re.document,bm=Rm(zh)&&Rm(zh.createElement),Yh=function(e){return bm?zh.createElement(e):{}},tv=Yh,Im=!He&&!T(function(){return Object.defineProperty(tv("div"),"a",{get:function(){return 7}}).a!==7}),Am=He,qh=Ge,Ba=Ie,Wa=at,Ga=ps,lu=On,du=mr,Ha=Im,nv=Object.getOwnPropertyDescriptor;xe.f=Am?nv:function(e,t){if(e=Ga(e),t=lu(t),Ha)try{return nv(e,t)}catch{}if(du(e,t))return Wa(!qh(Ba.f,e,t),e[t])};var rv=T,uu=Ve,z0=/#|\.prototype\./,Dl=function(e,t){var n=iv[Xh(e)];return n===hu||n!==Y0&&(uu(t)?rv(t):!!t)},Xh=Dl.normalize=function(e){return String(e).replace(z0,".").toLowerCase()},iv=Dl.data={},Y0=Dl.NATIVE="N",hu=Dl.POLYFILL="P",Ll=Dl,xl=Bn,Jh=R,q0=Me(Me.bind),Ka=function(e,t){return xl(e),t===void 0?e:Jh?q0(e,t):function(){return e.apply(t,arguments)}},xi={},pu=He&&T(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Om=fr,sv=String,za=TypeError,Zr=function(e){if(Om(e))return e;throw new za(sv(e)+" is not an object")},Qh=He,ov=Im,$h=pu,Wc=Zr,Nm=On,Ji=TypeError,Ya=Object.defineProperty,Pm=Object.getOwnPropertyDescriptor,Gc="enumerable",km="configurable",fu="writable";xi.f=Qh?$h?function(e,t,n){if(Wc(e),t=Nm(t),Wc(n),typeof e=="function"&&t==="prototype"&&"value"in n&&fu in n&&!n[fu]){var r=Pm(e,t);r&&r[fu]&&(e[t]=n.value,n={configurable:km in n?n[km]:r[km],enumerable:Gc in n?n[Gc]:r[Gc],writable:!1})}return Ya(e,t,n)}:Ya:function(e,t,n){if(Wc(e),t=Nm(t),Wc(n),ov)try{return Ya(e,t,n)}catch{}if("get"in n||"set"in n)throw new Ji("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Dm=xi,mu=at,So=He?function(e,t,n){return Dm.f(e,t,mu(1,n))}:function(e,t,n){return e[t]=n,e},Ml=re,X0=le,J0=Me,Q0=Ve,Lm=xe.f,$0=Ll,Ul=Qr,Z0=Ka,Vl=So,av=mr,cv=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return X0(e,this,arguments)};return t.prototype=e.prototype,t},qt=function(e,t){var n,r,i,s,o,c,l,p,m,E=e.target,v=e.global,y=e.stat,D=e.proto,A=v?Ml:y?Ml[E]:Ml[E]&&Ml[E].prototype,P=v?Ul:Ul[E]||Vl(Ul,E,{})[E],j=P.prototype;for(s in t)r=!(n=$0(v?s:E+(y?".":"#")+s,e.forced))&&A&&av(A,s),c=P[s],r&&(l=e.dontCallGetSet?(m=Lm(A,s))&&m.value:A[s]),o=r&&l?l:t[s],(n||D||typeof c!=typeof o)&&(p=e.bind&&r?Z0(o,Ml):e.wrap&&r?cv(o):D&&Q0(o)?J0(o):o,(e.sham||o&&o.sham||c&&c.sham)&&Vl(p,"sham",!0),Vl(P,s,p),D&&(av(Ul,i=E+"Prototype")||Vl(Ul,i,{}),Vl(Ul[i],s,o),e.real&&j&&(n||!j[s])&&Vl(j,s,o)))},eC=Math.ceil,tC=Math.floor,nC=Math.trunc||function(e){var t=+e;return(t>0?tC:eC)(t)},xm=nC,Mm=function(e){var t=+e;return t!=t||t===0?0:xm(t)},rC=Mm,iC=Math.max,lv=Math.min,Um=function(e,t){var n=rC(e);return n<0?iC(n+t,0):lv(n,t)},sC=Mm,oC=Math.min,dv=function(e){var t=sC(e);return t>0?oC(t,9007199254740991):0},aC=dv,qa=function(e){return aC(e.length)},cC=ps,Vm=Um,_u=qa,uv=function(e){return function(t,n,r){var i=cC(t),s=_u(i);if(s===0)return!e&&-1;var o,c=Vm(r,s);if(e&&n!=n){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},Zh={includes:uv(!0),indexOf:uv(!1)},hv=Zh.includes;qt({target:"Array",proto:!0,forced:T(function(){return!Array(1).includes()})},{includes:function(e){return hv(this,e,arguments.length>1?arguments[1]:void 0)}});var pv=re,fv=Qr,Qi=function(e,t){var n=fv[e+"Prototype"],r=n&&n[t];if(r)return r;var i=pv[e],s=i&&i.prototype;return s&&s[t]},jl=Qi("Array","includes"),lC=fr,dC=he,uC=An("match"),jm=function(e){var t;return lC(e)&&((t=e[uC])!==void 0?!!t:dC(e)==="RegExp")},mv=jm,gu=TypeError,Fl={};Fl[An("toStringTag")]="z";var Fm=String(Fl)==="[object z]",ep=Fm,hC=Ve,Eu=he,Bm=An("toStringTag"),Wm=Object,_v=Eu(function(){return arguments}())==="Arguments",Jo=ep?Eu:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(i,s){try{return i[s]}catch{}}(t=Wm(e),Bm))=="string"?n:_v?Eu(t):(r=Eu(t))==="Object"&&hC(t.callee)?"Arguments":r},gv=Jo,pC=String,Mi=function(e){if(gv(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return pC(e)},fC=An("match"),mC=qt,_C=function(e){if(mv(e))throw new gu("The method doesn't accept regular expressions");return e},Bs=zr,Bl=Mi,Ev=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[fC]=!1,"/./"[e](t)}catch{}}return!1},vv=B("".indexOf);mC({target:"String",proto:!0,forced:!Ev("includes")},{includes:function(e){return!!~vv(Bl(Bs(this)),Bl(_C(e)),arguments.length>1?arguments[1]:void 0)}});var Sv=Qi("String","includes"),Gm=Y,Hm=jl,gC=Sv,Km=Array.prototype,Xa=String.prototype,zm=function(e){var t=e.includes;return e===Km||Gm(Km,e)&&t===Km.includes?Hm:typeof e=="string"||e===Xa||Gm(Xa,e)&&t===Xa.includes?gC:t},Ae=S(zm),Ym=Bn,yv=Eo,tp=vn,Wl=qa,np=TypeError,qm="Reduce of empty array with no initial value",rp=function(e){return function(t,n,r,i){var s=yv(t),o=tp(s),c=Wl(s);if(Ym(n),c===0&&r<2)throw new np(qm);var l=e?c-1:0,p=e?-1:1;if(r<2)for(;;){if(l in o){i=o[l],l+=p;break}if(l+=p,e?l<0:c<=l)throw new np(qm)}for(;e?l>=0:c>l;l+=p)l in o&&(i=n(i,o[l],l,s));return i}},Tv={left:rp(!1)},Cv=T,vu=function(e,t){var n=[][e];return!!n&&Cv(function(){n.call(null,t||function(){return 1},1)})},Gl=re,wv=Yr,Rv=he,Ws=function(e){return wv.slice(0,e.length)===e},Su=Ws("Bun/")?"BUN":Ws("Cloudflare-Workers")?"CLOUDFLARE":Ws("Deno/")?"DENO":Ws("Node.js/")?"NODE":Gl.Bun&&typeof Bun.version=="string"?"BUN":Gl.Deno&&typeof Deno.version=="object"?"DENO":Rv(Gl.process)==="process"?"NODE":Gl.window&&Gl.document?"BROWSER":"REST",Hl=Su==="NODE",EC=Tv.left;qt({target:"Array",proto:!0,forced:!Hl&&Ti>79&&Ti<83||!vu("reduce")},{reduce:function(e){var t=arguments.length;return EC(this,e,t,t>1?arguments[1]:void 0)}});var vC=Qi("Array","reduce"),yu=Y,SC=vC,ip=Array.prototype,bv=function(e){var t=e.reduce;return e===ip||yu(ip,e)&&t===ip.reduce?SC:t},zn=bv,Ui=S(zn),sp=he,Qo=Array.isArray||function(e){return sp(e)==="Array"},Iv=qt,Xm=Qo,Tu=B([].reverse),Cu=[1,2];Iv({target:"Array",proto:!0,forced:String(Cu)===String(Cu.reverse())},{reverse:function(){return Xm(this)&&(this.length=this.length),Tu(this)}});var Kl=Qi("Array","reverse"),Av=Y,yC=Kl,Jm=Array.prototype,Ov=function(e){var t=e.reverse;return e===Jm||Av(Jm,e)&&t===Jm.reverse?yC:t},wu=Ov,Ru=S(wu),Qm=Nl,op=Bc("keys"),zl=function(e){return op[e]||(op[e]=Qm(e))},$m=!T(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),TC=mr,Nv=Ve,CC=Eo,wC=$m,ap=zl("IE_PROTO"),yo=Object,Pv=yo.prototype,Ja=wC?yo.getPrototypeOf:function(e){var t=CC(e);if(TC(t,ap))return t[ap];var n=t.constructor;return Nv(n)&&t instanceof n?n.prototype:t instanceof yo?Pv:null},To=B,bu=Bn,$o=fr,Zm=function(e){return $o(e)||e===null},RC=String,bC=TypeError,Hc=function(e,t,n){try{return To(bu(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},Iu=fr,Yl=zr,cp=function(e){if(Zm(e))return e;throw new bC("Can't set "+RC(e)+" as a prototype")},e_=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Hc(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,i){return Yl(r),cp(i),Iu(r)&&(t?e(r,i):r.__proto__=i),r}}():void 0),Zo={},Gs={},Wn=mr,Yn=ps,Qa=Zh.indexOf,di=Gs,wi=B([].push),$a=function(e,t){var n,r=Yn(e),i=0,s=[];for(n in r)!Wn(di,n)&&Wn(r,n)&&wi(s,n);for(;t.length>i;)Wn(r,n=t[i++])&&(~Qa(s,n)||wi(s,n));return s},Za=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Vi=$a,lp=Za.concat("length","prototype");Zo.f=Object.getOwnPropertyNames||function(e){return Vi(e,lp)};var ql={};ql.f=Object.getOwnPropertySymbols;var kv=Or,dp=Zo,Dv=ql,ea=Zr,up=B([].concat),t_=kv("Reflect","ownKeys")||function(e){var t=dp.f(ea(e)),n=Dv.f;return n?up(t,n(e)):t},n_=mr,IC=t_,ec=xe,Xl=xi,tc={},hp=$a,pp=Za,Ri=Object.keys||function(e){return hp(e,pp)},fs=He,Kc=pu,ta=xi,na=Zr,zc=ps,Lv=Ri;tc.f=fs&&!Kc?Object.defineProperties:function(e,t){na(e);for(var n,r=zc(t),i=Lv(t),s=i.length,o=0;s>o;)ta.f(e,n=i[o++],r[n]);return e};var Jl,fp=Or("document","documentElement"),$i=Zr,Zi=tc,$n=Za,Hs=Gs,xv=fp,Mv=Yh,Au="prototype",Ou="script",r_=zl("IE_PROTO"),Ql=function(){},i_=function(e){return"<"+Ou+">"+e+"</"+Ou+">"},Yc=function(e){e.write(i_("")),e.close();var t=e.parentWindow.Object;return e=null,t},$l=function(){try{Jl=new ActiveXObject("htmlfile")}catch{}var e,t,n;$l=typeof document<"u"?document.domain&&Jl?Yc(Jl):(t=Mv("iframe"),n="java"+Ou+":",t.style.display="none",xv.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(i_("document.F=Object")),e.close(),e.F):Yc(Jl);for(var r=$n.length;r--;)delete $l[Au][$n[r]];return $l()};Hs[r_]=!0;var Nu=Object.create||function(e,t){var n;return e!==null?(Ql[Au]=$i(e),n=new Ql,Ql[Au]=null,n[r_]=e):n=$l(),t===void 0?n:Zi.f(n,t)},Pu=fr,mp=So,s_=Error,Uv=B("".replace),Zl=String(new s_("zxcasd").stack),o_=/\n\s*at [^:]*:[^\n]*/,_p=o_.test(Zl),gp=at,ed=!T(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",gp(1,7)),e.stack!==7)}),a_=So,c_=function(e,t){if(_p&&typeof e=="string"&&!s_.prepareStackTrace)for(;t--;)e=Uv(e,o_,"");return e},l_=ed,Ep=Error.captureStackTrace,Ks={},ms=Ks,qc=An("iterator"),d_=Array.prototype,u_=function(e){return e!==void 0&&(ms.Array===e||d_[qc]===e)},ra=Jo,ia=Xi,h_=or,Vv=Ks,sa=An("iterator"),zs=function(e){if(!h_(e))return ia(e,sa)||ia(e,"@@iterator")||Vv[ra(e)]},vp=Ge,jv=Bn,Sp=Zr,Fv=fn,ku=zs,Co=TypeError,Xc=function(e,t){var n=arguments.length<2?ku(e):t;if(jv(n))return Sp(vp(n,e));throw new Co(Fv(e)+" is not iterable")},Du=Ge,nc=Zr,p_=Xi,Jc=function(e,t,n){var r,i;nc(e);try{if(!(r=p_(e,"return"))){if(t==="throw")throw n;return n}r=Du(r,e)}catch(s){i=!0,r=s}if(t==="throw")throw n;if(i)throw r;return nc(r),n},Bv=Ka,f_=Ge,ar=Zr,yp=fn,m_=u_,__=qa,Lu=Y,g_=Xc,Qc=zs,rr=Jc,Mr=TypeError,yr=function(e,t){this.stopped=e,this.result=t},xu=yr.prototype,oa=function(e,t,n){var r,i,s,o,c,l,p,m=n&&n.that,E=!(!n||!n.AS_ENTRIES),v=!(!n||!n.IS_RECORD),y=!(!n||!n.IS_ITERATOR),D=!(!n||!n.INTERRUPTED),A=Bv(t,m),P=function(V){return r&&rr(r,"normal",V),new yr(!0,V)},j=function(V){return E?(ar(V),D?A(V[0],V[1],P):A(V[0],V[1])):D?A(V,P):A(V)};if(v)r=e.iterator;else if(y)r=e;else{if(!(i=Qc(e)))throw new Mr(yp(e)+" is not iterable");if(m_(i)){for(s=0,o=__(e);o>s;s++)if((c=j(e[s]))&&Lu(xu,c))return c;return new yr(!1)}r=g_(e,i)}for(l=v?e.next:r.next;!(p=f_(l,r)).done;){try{c=j(p.value)}catch(V){rr(r,"throw",V)}if(typeof c=="object"&&c&&Lu(xu,c))return c}return new yr(!1)},Mu=Mi,AC=qt,ui=Y,E_=Ja,td=e_,v_=function(e,t,n){for(var r=IC(t),i=Xl.f,s=ec.f,o=0;o<r.length;o++){var c=r[o];n_(e,c)||n&&n_(n,c)||i(e,c,s(t,c))}},Ys=Nu,ji=So,$c=at,S_=function(e,t){Pu(t)&&"cause"in t&&mp(e,"cause",t.cause)},y_=function(e,t,n,r){l_&&(Ep?Ep(e,t):a_(e,"stack",c_(n,r)))},Wv=oa,Gv=function(e,t){return e===void 0?arguments.length<2?"":t:Mu(e)},Hv=An("toStringTag"),Uu=Error,Kv=[].push,Zc=function(e,t){var n,r=ui(Tp,this);td?n=td(new Uu,r?E_(this):Tp):(n=r?this:Ys(Tp),ji(n,Hv,"Error")),t!==void 0&&ji(n,"message",Gv(t)),y_(n,Zc,n.stack,1),arguments.length>2&&S_(n,arguments[2]);var i=[];return Wv(e,Kv,{that:i}),ji(n,"errors",i),n};td?td(Zc,Uu):v_(Zc,Uu,{name:!0});var Tp=Zc.prototype=Ys(Uu.prototype,{constructor:$c(1,Zc),message:$c(1,""),name:$c(1,"AggregateError")});AC({global:!0},{AggregateError:Zc});var Vu,aa,ju,Cp=Ve,Fu=re.WeakMap,zv=Cp(Fu)&&/native code/.test(String(Fu)),wp=re,Yv=fr,qv=So,Rp=mr,bp=Wh,T_=zl,Xv=Gs,C_="Object already initialized",Ip=wp.TypeError,OC=wp.WeakMap;if(zv||bp.state){var qs=bp.state||(bp.state=new OC);qs.get=qs.get,qs.has=qs.has,qs.set=qs.set,Vu=function(e,t){if(qs.has(e))throw new Ip(C_);return t.facade=e,qs.set(e,t),t},aa=function(e){return qs.get(e)||{}},ju=function(e){return qs.has(e)}}else{var nd=T_("state");Xv[nd]=!0,Vu=function(e,t){if(Rp(e,nd))throw new Ip(C_);return t.facade=e,qv(e,nd,t),t},aa=function(e){return Rp(e,nd)?e[nd]:{}},ju=function(e){return Rp(e,nd)}}var el,w_,R_,rc={set:Vu,get:aa,has:ju,enforce:function(e){return ju(e)?aa(e):Vu(e,{})},getterFor:function(e){return function(t){var n;if(!Yv(t)||(n=aa(t)).type!==e)throw new Ip("Incompatible receiver, "+e+" required");return n}}},rd=He,NC=mr,Jv=Function.prototype,PC=rd&&Object.getOwnPropertyDescriptor,_s=NC(Jv,"name"),Ap={PROPER:_s&&(function(){}).name==="something",CONFIGURABLE:_s&&(!rd||rd&&PC(Jv,"name").configurable)},Op=So,ca=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Op(e,t,n),e},Qv=T,$v=Ve,b_=fr,id=Nu,Np=Ja,I_=ca,A_=An("iterator"),O_=!1;[].keys&&("next"in(R_=[].keys())?(w_=Np(Np(R_)))!==Object.prototype&&(el=w_):O_=!0);var Zv=!b_(el)||Qv(function(){var e={};return el[A_].call(e)!==e});$v((el=Zv?{}:id(el))[A_])||I_(el,A_,function(){return this});var N_={IteratorPrototype:el,BUGGY_SAFARI_ITERATORS:O_},eS=Jo,tS=Fm?{}.toString:function(){return"[object "+eS(this)+"]"},kC=Fm,Fi=xi.f,bi=So,nS=mr,rS=tS,P_=An("toStringTag"),wo=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(nS(i,P_)||Fi(i,P_,{configurable:!0,value:t}),r&&!kC&&bi(i,"toString",rS))},iS=N_.IteratorPrototype,k_=Nu,sS=at,D_=wo,oS=Ks,aS=function(){return this},Bu=function(e,t,n,r){var i=t+" Iterator";return e.prototype=k_(iS,{next:sS(+!r,n)}),D_(e,i,!1,!0),oS[i]=aS,e},L_=qt,cS=Ge,x_=Ap,Pp=Bu,DC=Ja,lS=wo,kp=ca,M_=Ks,Dp=N_,la=x_.PROPER,Lp=Dp.BUGGY_SAFARI_ITERATORS,xp=An("iterator"),Mp="keys",Wu="values",U_="entries",Gu=function(){return this},ei=function(e,t,n,r,i,s,o){Pp(n,t,r);var c,l,p,m=function(j){if(j===i&&A)return A;if(!Lp&&j&&j in y)return y[j];switch(j){case Mp:case Wu:case U_:return function(){return new n(this,j)}}return function(){return new n(this)}},E=t+" Iterator",v=!1,y=e.prototype,D=y[xp]||y["@@iterator"]||i&&y[i],A=!Lp&&D||m(i),P=t==="Array"&&y.entries||D;if(P&&(c=DC(P.call(new e)))!==Object.prototype&&c.next&&(lS(c,E,!0,!0),M_[E]=Gu),la&&i===Wu&&D&&D.name!==Wu&&(v=!0,A=function(){return cS(D,this)}),i)if(l={values:m(Wu),keys:s?A:m(Mp),entries:m(U_)},o)for(p in l)(Lp||v||!(p in y))&&kp(y,p,l[p]);else L_({target:t,proto:!0,forced:Lp||v},l);return o&&y[xp]!==A&&kp(y,xp,A,{}),M_[t]=A,l},Up=function(e,t){return{value:e,done:t}},LC=ps,Hu=Ks,ti=rc;xi.f;var xC=ei,Et=Up,tl="Array Iterator",V_=ti.set,dS=ti.getterFor(tl);xC(Array,"Array",function(e,t){V_(this,{type:tl,target:LC(e),index:0,kind:t})},function(){var e=dS(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Et(void 0,!0);switch(e.kind){case"keys":return Et(n,!1);case"values":return Et(t[n],!1)}return Et([n,t[n]],!1)},"values"),Hu.Arguments=Hu.Array;var MC=xi,ic=function(e,t,n){return MC.f(e,t,n)},Vp=Or,j_=ic,uS=He,F_=An("species"),hS=Y,B_=TypeError,Ku=function(e,t){if(hS(t,e))return e;throw new B_("Incorrect invocation")},ni=Ve,es=Wh,sc=B(Function.toString);ni(es.inspectSource)||(es.inspectSource=function(e){return sc(e)});var W_=es.inspectSource,pS=B,Xs=T,G_=Ve,Ro=Jo,UC=W_,H_=function(){},K_=Or("Reflect","construct"),jp=/^\s*(?:class|function)\b/,fS=pS(jp.exec),VC=!jp.test(H_),oc=function(e){if(!G_(e))return!1;try{return K_(H_,[],e),!0}catch{return!1}},Fp=function(e){if(!G_(e))return!1;switch(Ro(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return VC||!!fS(jp,UC(e))}catch{return!0}};Fp.sham=!0;var hi,ln,Ur,_r,Nr=!K_||Xs(function(){var e;return oc(oc.call)||!oc(Object)||!oc(function(){e=!0})||e})?Fp:oc,ts=Nr,sd=fn,Vr=TypeError,od=Zr,nl=function(e){if(ts(e))return e;throw new Vr(sd(e)+" is not a constructor")},Bp=or,z_=An("species"),rl=function(e,t){var n,r=od(e).constructor;return r===void 0||Bp(n=od(r)[z_])?t:nl(n)},Tr=B([].slice),Y_=TypeError,gs=function(e,t){if(e<t)throw new Y_("Not enough arguments");return e},bo=/(?:ipad|iphone|ipod).*applewebkit/i.test(Yr),pi=re,q_=le,ac=Ka,zu=Ve,cc=mr,Yu=T,ad=fp,X_=Tr,qu=Yh,Wp=gs,Ii=bo,lc=Hl,ns=pi.setImmediate,fi=pi.clearImmediate,mS=pi.process,Xu=pi.Dispatch,J_=pi.Function,_S=pi.MessageChannel,dc=pi.String,Gp=0,il={},uc="onreadystatechange";Yu(function(){hi=pi.location});var Ju=function(e){if(cc(il,e)){var t=il[e];delete il[e],t()}},da=function(e){return function(){Ju(e)}},Q_=function(e){Ju(e.data)},$_=function(e){pi.postMessage(dc(e),hi.protocol+"//"+hi.host)};ns&&fi||(ns=function(e){Wp(arguments.length,1);var t=zu(e)?e:J_(e),n=X_(arguments,1);return il[++Gp]=function(){q_(t,void 0,n)},ln(Gp),Gp},fi=function(e){delete il[e]},lc?ln=function(e){mS.nextTick(da(e))}:Xu&&Xu.now?ln=function(e){Xu.now(da(e))}:_S&&!Ii?(_r=(Ur=new _S).port2,Ur.port1.onmessage=Q_,ln=ac(_r.postMessage,_r)):pi.addEventListener&&zu(pi.postMessage)&&!pi.importScripts&&hi&&hi.protocol!=="file:"&&!Yu($_)?(ln=$_,pi.addEventListener("message",Q_,!1)):ln=uc in qu("script")?function(e){ad.appendChild(qu("script"))[uc]=function(){ad.removeChild(this),Ju(e)}}:function(e){setTimeout(da(e),0)});var cd={set:ns,clear:fi},Qu=re,jC=He,FC=Object.getOwnPropertyDescriptor,Z_=function(e){if(!jC)return Qu[e];var t=FC(Qu,e);return t&&t.value},eg=function(){this.head=null,this.tail=null};eg.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Es,tg,hc,Hp,cr,gS=eg,ES=/ipad|iphone|ipod/i.test(Yr)&&typeof Pebble<"u",BC=/web0s(?!.*chrome)/i.test(Yr),ld=re,vS=Z_,ng=Ka,rg=cd.set,vs=gS,ig=bo,WC=ES,pc=BC,dd=Hl,fc=ld.MutationObserver||ld.WebKitMutationObserver,$u=ld.document,Kp=ld.process,ud=ld.Promise,sg=vS("queueMicrotask");if(!sg){var hd=new vs,zp=function(){var e,t;for(dd&&(e=Kp.domain)&&e.exit();t=hd.get();)try{t()}catch(n){throw hd.head&&Es(),n}e&&e.enter()};ig||dd||pc||!fc||!$u?!WC&&ud&&ud.resolve?((Hp=ud.resolve(void 0)).constructor=ud,cr=ng(Hp.then,Hp),Es=function(){cr(zp)}):dd?Es=function(){Kp.nextTick(zp)}:(rg=ng(rg,ld),Es=function(){rg(zp)}):(tg=!0,hc=$u.createTextNode(""),new fc(zp).observe(hc,{characterData:!0}),Es=function(){hc.data=tg=!tg}),sg=function(e){hd.head||Es(),hd.add(e)}}var og=sg,sl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Io=re.Promise,Yp=re,pd=Io,ag=Ve,GC=Ll,SS=W_,cg=An,Zu=Su,eh=Ti,th=pd&&pd.prototype,yS=cg("species"),TS=ag(Yp.PromiseRejectionEvent),qp=GC("Promise",function(){var e=SS(pd),t=e!==String(pd);if(!t&&eh===66||!th.catch||!th.finally)return!0;if(!eh||eh<51||!/native code/.test(e)){var n=new pd(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[yS]=r,!(n.then(function(){})instanceof r))return!0}return!(t||Zu!=="BROWSER"&&Zu!=="DENO"||TS)}),nh={CONSTRUCTOR:qp,REJECTION_EVENT:TS},Bi={},CS=Bn,Xp=TypeError,a=function(e){var t,n;this.promise=new e(function(r,i){if(t!==void 0||n!==void 0)throw new Xp("Bad Promise constructor");t=r,n=i}),this.resolve=CS(t),this.reject=CS(n)};Bi.f=function(e){return new a(e)};var d,_,C=qt,I=Hl,L=re,q=Ge,oe=ca,me=wo,Le=function(e){var t=Vp(e);uS&&t&&!t[F_]&&j_(t,F_,{configurable:!0,get:function(){return this}})},Ze=Bn,et=Ve,$e=fr,_t=Ku,Tt=rl,wt=cd.set,lr=og,Ce=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ge=sl,Oe=gS,nt=rc,Rt=Io,kt=nh,Dt=Bi,Vt="Promise",jr=kt.CONSTRUCTOR,Rn=kt.REJECTION_EVENT,Ao=nt.getterFor(Vt),HC=nt.set,DF=Rt&&Rt.prototype,lg=Rt,KC=DF,nO=L.TypeError,zC=L.document,YC=L.process,qC=Dt.f,LF=qC,xF=!!(zC&&zC.createEvent&&L.dispatchEvent),rO="unhandledrejection",iO=function(e){var t;return!(!$e(e)||!et(t=e.then))&&t},sO=function(e,t){var n,r,i,s=t.value,o=t.state===1,c=o?e.ok:e.fail,l=e.resolve,p=e.reject,m=e.domain;try{c?(o||(t.rejection===2&&UF(t),t.rejection=1),c===!0?n=s:(m&&m.enter(),n=c(s),m&&(m.exit(),i=!0)),n===e.promise?p(new nO("Promise-chain cycle")):(r=iO(n))?q(r,n,l,p):l(n)):p(s)}catch(E){m&&!i&&m.exit(),p(E)}},oO=function(e,t){e.notified||(e.notified=!0,lr(function(){for(var n,r=e.reactions;n=r.get();)sO(n,e);e.notified=!1,t&&!e.rejection&&MF(e)}))},aO=function(e,t,n){var r,i;xF?((r=zC.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),L.dispatchEvent(r)):r={promise:t,reason:n},!Rn&&(i=L["on"+e])?i(r):e===rO&&Ce("Unhandled promise rejection",n)},MF=function(e){q(wt,L,function(){var t,n=e.facade,r=e.value;if(cO(e)&&(t=ge(function(){I?YC.emit("unhandledRejection",r,n):aO(rO,n,r)}),e.rejection=I||cO(e)?2:1,t.error))throw t.value})},cO=function(e){return e.rejection!==1&&!e.parent},UF=function(e){q(wt,L,function(){var t=e.facade;I?YC.emit("rejectionHandled",t):aO("rejectionhandled",t,e.value)})},Jp=function(e,t,n){return function(r){e(t,r,n)}},Qp=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,oO(e,!0))},XC=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new nO("Promise can't be resolved itself");var r=iO(t);r?lr(function(){var i={done:!1};try{q(r,t,Jp(XC,i,e),Jp(Qp,i,e))}catch(s){Qp(i,s,e)}}):(e.value=t,e.state=1,oO(e,!1))}catch(i){Qp({done:!1},i,e)}}};jr&&(KC=(lg=function(e){_t(this,KC),Ze(e),q(d,this);var t=Ao(this);try{e(Jp(XC,t),Jp(Qp,t))}catch(n){Qp(t,n)}}).prototype,(d=function(e){HC(this,{type:Vt,done:!1,notified:!1,parent:!1,reactions:new Oe,rejection:!1,state:0,value:null})}).prototype=oe(KC,"then",function(e,t){var n=Ao(this),r=qC(Tt(this,lg));return n.parent=!0,r.ok=!et(e)||e,r.fail=et(t)&&t,r.domain=I?YC.domain:void 0,n.state===0?n.reactions.add(r):lr(function(){sO(r,n)}),r.promise}),_=function(){var e=new d,t=Ao(e);this.promise=e,this.resolve=Jp(XC,t),this.reject=Jp(Qp,t)},Dt.f=qC=function(e){return e===lg||e===void 0?new _(e):LF(e)}),C({global:!0,wrap:!0,forced:jr},{Promise:lg}),me(lg,Vt,!1,!0),Le(Vt);var lO=An("iterator"),dO=!1;try{var VF=0,uO={next:function(){return{done:!!VF++}},return:function(){dO=!0}};uO[lO]=function(){return this},Array.from(uO,function(){throw 2})}catch{}var jF=Io,FF=function(e,t){try{if(!t&&!dO)return!1}catch{return!1}var n=!1;try{var r={};r[lO]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},wS=nh.CONSTRUCTOR||!FF(function(e){jF.all(e).then(void 0,function(){})}),BF=Ge,WF=Bn,GF=Bi,HF=sl,KF=oa;qt({target:"Promise",stat:!0,forced:wS},{all:function(e){var t=this,n=GF.f(t),r=n.resolve,i=n.reject,s=HF(function(){var o=WF(t.resolve),c=[],l=0,p=1;KF(e,function(m){var E=l++,v=!1;p++,BF(o,t,m).then(function(y){v||(v=!0,c[E]=y,--p||r(c))},i)}),--p||r(c)});return s.error&&i(s.value),n.promise}});var zF=qt,YF=nh.CONSTRUCTOR;Io&&Io.prototype,zF({target:"Promise",proto:!0,forced:YF,real:!0},{catch:function(e){return this.then(void 0,e)}});var qF=Ge,XF=Bn,JF=Bi,QF=sl,$F=oa;qt({target:"Promise",stat:!0,forced:wS},{race:function(e){var t=this,n=JF.f(t),r=n.reject,i=QF(function(){var s=XF(t.resolve);$F(e,function(o){qF(s,t,o).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var ZF=Bi;qt({target:"Promise",stat:!0,forced:nh.CONSTRUCTOR},{reject:function(e){var t=ZF.f(this);return(0,t.reject)(e),t.promise}});var e7=Zr,t7=fr,n7=Bi,hO=function(e,t){if(e7(e),t7(t)&&t.constructor===e)return t;var n=n7.f(e);return(0,n.resolve)(t),n.promise},r7=qt,i7=Io,s7=nh.CONSTRUCTOR,o7=hO,a7=Or("Promise"),c7=!s7;r7({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return o7(c7&&this===a7?i7:this,e)}});var l7=Ge,d7=Bn,u7=Bi,h7=sl,p7=oa;qt({target:"Promise",stat:!0,forced:wS},{allSettled:function(e){var t=this,n=u7.f(t),r=n.resolve,i=n.reject,s=h7(function(){var o=d7(t.resolve),c=[],l=0,p=1;p7(e,function(m){var E=l++,v=!1;p++,l7(o,t,m).then(function(y){v||(v=!0,c[E]={status:"fulfilled",value:y},--p||r(c))},function(y){v||(v=!0,c[E]={status:"rejected",reason:y},--p||r(c))})}),--p||r(c)});return s.error&&i(s.value),n.promise}});var f7=Ge,m7=Bn,_7=Or,g7=Bi,E7=sl,v7=oa,pO="No one promise resolved";qt({target:"Promise",stat:!0,forced:wS},{any:function(e){var t=this,n=_7("AggregateError"),r=g7.f(t),i=r.resolve,s=r.reject,o=E7(function(){var c=m7(t.resolve),l=[],p=0,m=1,E=!1;v7(e,function(v){var y=p++,D=!1;m++,f7(c,t,v).then(function(A){D||E||(E=!0,i(A))},function(A){D||E||(D=!0,l[y]=A,--m||s(new n(l,pO)))})}),--m||s(new n(l,pO))});return o.error&&s(o.value),r.promise}});var S7=qt,y7=le,T7=Tr,C7=Bi,w7=Bn,fO=sl,JC=re.Promise,mO=!1;S7({target:"Promise",stat:!0,forced:!JC||!JC.try||fO(function(){JC.try(function(e){mO=e===8},8)}).error||!mO},{try:function(e){var t=arguments.length>1?T7(arguments,1):[],n=C7.f(this),r=fO(function(){return y7(w7(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var R7=Bi;qt({target:"Promise",stat:!0},{withResolvers:function(){var e=R7.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var b7=qt,QC=Io,I7=T,A7=Or,O7=Ve,N7=rl,_O=hO,P7=QC&&QC.prototype;b7({target:"Promise",proto:!0,real:!0,forced:!!QC&&I7(function(){P7.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=N7(this,A7("Promise")),n=O7(e);return this.then(n?function(r){return _O(t,e()).then(function(){return r})}:e,n?function(r){return _O(t,e()).then(function(){throw r})}:e)}});var $C=B,k7=Mm,D7=Mi,L7=zr,x7=$C("".charAt),gO=$C("".charCodeAt),M7=$C("".slice),EO=function(e){return function(t,n){var r,i,s=D7(L7(t)),o=k7(n),c=s.length;return o<0||o>=c?e?"":void 0:(r=gO(s,o))<55296||r>56319||o+1===c||(i=gO(s,o+1))<56320||i>57343?e?x7(s,o):r:e?M7(s,o,o+2):i-56320+(r-55296<<10)+65536}},ZC={codeAt:EO(!1),charAt:EO(!0)},U7=ZC.charAt,V7=Mi,vO=rc,j7=ei,SO=Up,yO="String Iterator",F7=vO.set,B7=vO.getterFor(yO);j7(String,"String",function(e){F7(this,{type:yO,string:V7(e),index:0})},function(){var e,t=B7(this),n=t.string,r=t.index;return r>=n.length?SO(void 0,!0):(e=U7(n,r),t.index+=e.length,SO(e,!1))});var W7=Qr.Promise,G7={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},H7=re,K7=wo,TO=Ks;for(var ew in G7)K7(H7[ew],ew),TO[ew]=TO.Array;var CO=W7,je=S(CO),z7=Qi("Array","values"),Y7=Jo,q7=mr,X7=Y,J7=z7,tw=Array.prototype,Q7={DOMTokenList:!0,NodeList:!0},$7=function(e){var t=e.values;return e===tw||X7(tw,e)&&t===tw.values||q7(Q7,Y7(e))?J7:t},rs=S($7),wO=fn,Z7=TypeError,RO=Tr,e9=Math.floor,nw=function(e,t){var n=e.length;if(n<8)for(var r,i,s=1;s<n;){for(i=s,r=e[s];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==s++&&(e[i]=r)}else for(var o=e9(n/2),c=nw(RO(e,0,o),t),l=nw(RO(e,o),t),p=c.length,m=l.length,E=0,v=0;E<p||v<m;)e[E+v]=E<p&&v<m?t(c[E],l[v])<=0?c[E++]:l[v++]:E<p?c[E++]:l[v++];return e},bO=nw,IO=Yr.match(/firefox\/(\d+)/i),t9=!!IO&&+IO[1],n9=/MSIE|Trident/.test(Yr),AO=Yr.match(/AppleWebKit\/(\d+)\./),r9=!!AO&&+AO[1],i9=qt,OO=B,s9=Bn,o9=Eo,NO=qa,a9=function(e,t){if(!delete e[t])throw new Z7("Cannot delete property "+wO(t)+" of "+wO(e))},PO=Mi,rw=T,c9=bO,l9=vu,kO=t9,d9=n9,DO=Ti,LO=r9,fd=[],xO=OO(fd.sort),u9=OO(fd.push),h9=rw(function(){fd.sort(void 0)}),p9=rw(function(){fd.sort(null)}),f9=l9("sort"),MO=!rw(function(){if(DO)return DO<70;if(!(kO&&kO>3)){if(d9)return!0;if(LO)return LO<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)fd.push({k:t+r,v:n})}for(fd.sort(function(s,o){return o.v-s.v}),r=0;r<fd.length;r++)t=fd[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});i9({target:"Array",proto:!0,forced:h9||!p9||!f9||!MO},{sort:function(e){e!==void 0&&s9(e);var t=o9(this);if(MO)return e===void 0?xO(t):xO(t,e);var n,r,i=[],s=NO(t);for(r=0;r<s;r++)r in t&&u9(i,t[r]);for(c9(i,function(o){return function(c,l){return l===void 0?-1:c===void 0?1:o!==void 0?+o(c,l)||0:PO(c)>PO(l)?1:-1}}(e)),n=NO(i),r=0;r<n;)t[r]=i[r++];for(;r<s;)a9(t,r++);return t}});var m9=Qi("Array","sort"),_9=Y,g9=m9,iw=Array.prototype,E9=function(e){var t=e.sort;return e===iw||_9(iw,e)&&t===iw.sort?g9:t},rh=S(E9),v9=qt,S9=B,y9=Um,T9=RangeError,UO=String.fromCharCode,VO=String.fromCodePoint,C9=S9([].join);v9({target:"String",stat:!0,forced:!!VO&&VO.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],y9(t,1114111)!==t)throw new T9(t+" is not a valid code point");n[i]=t<65536?UO(t):UO(55296+((t-=65536)>>10),t%1024+56320)}return C9(n,"")}});var w9=T,R9=An("iterator"),RS=!w9(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,s){t.delete("b"),r+=s+i}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[R9]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),b9=ca,sw=qt,jO=re,ow=Z_,I9=Or,bS=Ge,ua=B,dg=He,FO=RS,BO=ca,A9=ic,O9=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:b9(e,r,t[r],n);return e},N9=wo,P9=Bu,aw=rc,WO=Ku,cw=Ve,k9=mr,D9=Ka,L9=Jo,x9=Zr,GO=fr,is=Mi,M9=Nu,HO=at,KO=Xc,U9=zs,IS=Up,$p=gs,V9=bO,j9=An("iterator"),Zp="URLSearchParams",zO=Zp+"Iterator",YO=aw.set,Oo=aw.getterFor(Zp),F9=aw.getterFor(zO),qO=ow("fetch"),AS=ow("Request"),ug=ow("Headers"),lw=AS&&AS.prototype,XO=ug&&ug.prototype,B9=jO.TypeError,W9=jO.encodeURIComponent,G9=String.fromCharCode,H9=I9("String","fromCodePoint"),K9=parseInt,OS=ua("".charAt),JO=ua([].join),md=ua([].push),QO=ua("".replace),z9=ua([].shift),$O=ua([].splice),ZO=ua("".split),eN=ua("".slice),Y9=ua(/./.exec),q9=/\+/g,X9=/^[0-9a-f]+$/i,tN=function(e,t){var n=eN(e,t,t+2);return Y9(X9,n)?K9(n,16):NaN},J9=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},Q9=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},nN=function(e){for(var t=(e=QO(e,q9," ")).length,n="",r=0;r<t;){var i=OS(e,r);if(i==="%"){if(OS(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var s=tN(e,r+1);if(s!=s){n+=i,r++;continue}r+=2;var o=J9(s);if(o===0)i=G9(s);else{if(o===1||o>4){n+="",r++;continue}for(var c=[s],l=1;l<o&&!(++r+3>t||OS(e,r)!=="%");){var p=tN(e,r+1);if(p!=p){r+=3;break}if(p>191||p<128)break;md(c,p),r+=2,l++}if(c.length!==o){n+="";continue}var m=Q9(c);m===null?n+="":i=H9(m)}}n+=i,r++}return n},$9=/[!'()~]|%20/g,Z9={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},eB=function(e){return Z9[e]},rN=function(e){return QO(W9(e),$9,eB)},dw=P9(function(e,t){YO(this,{type:zO,target:Oo(e).entries,index:0,kind:t})},Zp,function(){var e=F9(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,IS(void 0,!0);var r=t[n];switch(e.kind){case"keys":return IS(r.key,!1);case"values":return IS(r.value,!1)}return IS([r.key,r.value],!1)},!0),iN=function(e){this.entries=[],this.url=null,e!==void 0&&(GO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?OS(e,0)==="?"?eN(e,1):e:is(e)))};iN.prototype={type:Zp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,o,c,l=this.entries,p=U9(e);if(p)for(n=(t=KO(e,p)).next;!(r=bS(n,t)).done;){if(s=(i=KO(x9(r.value))).next,(o=bS(s,i)).done||(c=bS(s,i)).done||!bS(s,i).done)throw new B9("Expected sequence with length 2");md(l,{key:is(o.value),value:is(c.value)})}else for(var m in e)k9(e,m)&&md(l,{key:m,value:is(e[m])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=ZO(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(n=ZO(t,"="),md(r,{key:nN(z9(n)),value:nN(JO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],md(n,rN(e.key)+"="+rN(e.value));return JO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var NS=function(){WO(this,ef);var e=YO(this,new iN(arguments.length>0?arguments[0]:void 0));dg||(this.size=e.entries.length)},ef=NS.prototype;if(O9(ef,{append:function(e,t){var n=Oo(this);$p(arguments.length,2),md(n.entries,{key:is(e),value:is(t)}),dg||this.length++,n.updateURL()},delete:function(e){for(var t=Oo(this),n=$p(arguments.length,1),r=t.entries,i=is(e),s=n<2?void 0:arguments[1],o=s===void 0?s:is(s),c=0;c<r.length;){var l=r[c];if(l.key!==i||o!==void 0&&l.value!==o)c++;else if($O(r,c,1),o!==void 0)break}dg||(this.size=r.length),t.updateURL()},get:function(e){var t=Oo(this).entries;$p(arguments.length,1);for(var n=is(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Oo(this).entries;$p(arguments.length,1);for(var n=is(e),r=[],i=0;i<t.length;i++)t[i].key===n&&md(r,t[i].value);return r},has:function(e){for(var t=Oo(this).entries,n=$p(arguments.length,1),r=is(e),i=n<2?void 0:arguments[1],s=i===void 0?i:is(i),o=0;o<t.length;){var c=t[o++];if(c.key===r&&(s===void 0||c.value===s))return!0}return!1},set:function(e,t){var n=Oo(this);$p(arguments.length,1);for(var r,i=n.entries,s=!1,o=is(e),c=is(t),l=0;l<i.length;l++)(r=i[l]).key===o&&(s?$O(i,l--,1):(s=!0,r.value=c));s||md(i,{key:o,value:c}),dg||(this.size=i.length),n.updateURL()},sort:function(){var e=Oo(this);V9(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Oo(this).entries,r=D9(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new dw(this,"keys")},values:function(){return new dw(this,"values")},entries:function(){return new dw(this,"entries")}},{enumerable:!0}),BO(ef,j9,ef.entries,{}),BO(ef,"toString",function(){return Oo(this).serialize()},{enumerable:!0}),dg&&A9(ef,"size",{get:function(){return Oo(this).entries.length},configurable:!0,enumerable:!0}),N9(NS,Zp),sw({global:!0,forced:!FO},{URLSearchParams:NS}),!FO&&cw(ug)){var tB=ua(XO.has),nB=ua(XO.set),sN=function(e){if(GO(e)){var t,n=e.body;if(L9(n)===Zp)return t=e.headers?new ug(e.headers):new ug,tB(t,"content-type")||nB(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),M9(e,{body:HO(0,is(n)),headers:HO(0,t)})}return e};if(cw(qO)&&sw({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return qO(e,arguments.length>1?sN(arguments[1]):{})}}),cw(AS)){var uw=function(e){return WO(this,lw),new AS(e,arguments.length>1?sN(arguments[1]):{})};lw.constructor=uw,uw.prototype=lw,sw({global:!0,dontCallGetSet:!0,forced:!0},{Request:uw})}}var No,rB={URLSearchParams:NS,getState:Oo},iB=Qr.URLSearchParams,oN=He,sB=B,oB=Ge,aB=T,hw=Ri,cB=ql,lB=Ie,dB=Eo,uB=vn,tf=Object.assign,aN=Object.defineProperty,hB=sB([].concat),pB=!tf||aB(function(){if(oN&&tf({b:1},tf(aN({},"a",{enumerable:!0,get:function(){aN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(i){t[i]=i}),tf({},e)[n]!==7||hw(tf({},t)).join("")!==r})?function(e,t){for(var n=dB(e),r=arguments.length,i=1,s=cB.f,o=lB.f;r>i;)for(var c,l=uB(arguments[i++]),p=s?hB(hw(l),s(l)):hw(l),m=p.length,E=0;m>E;)c=p[E++],oN&&!oB(o,l,c)||(n[c]=l[c]);return n}:tf,fB=Zr,mB=Jc,_B=He,gB=xi,EB=at,pw=function(e,t,n){_B?gB.f(e,t,EB(0,n)):e[t]=n},vB=Ka,SB=Ge,yB=Eo,TB=function(e,t,n,r){try{return r?t(fB(n)[0],n[1]):t(n)}catch(i){mB(e,"throw",i)}},CB=u_,wB=Nr,RB=qa,cN=pw,bB=Xc,IB=zs,lN=Array,ih=B,fw=2147483647,AB=/[^\0-\u007E]/,dN=/[.\u3002\uFF0E\uFF61]/g,uN="Overflow: input needs wider integers to process",hN=RangeError,OB=ih(dN.exec),nf=Math.floor,mw=String.fromCharCode,pN=ih("".charCodeAt),fN=ih([].join),_d=ih([].push),NB=ih("".replace),PB=ih("".split),kB=ih("".toLowerCase),mN=function(e){return e+22+75*(e<26)},DB=function(e,t,n){var r=0;for(e=n?nf(e/700):e>>1,e+=nf(e/t);e>455;)e=nf(e/35),r+=36;return nf(r+36*e/(e+38))},LB=function(e){var t=[];e=function(j){for(var V=[],G=0,Z=j.length;G<Z;){var Q=pN(j,G++);if(Q>=55296&&Q<=56319&&G<Z){var z=pN(j,G++);(64512&z)==56320?_d(V,((1023&Q)<<10)+(1023&z)+65536):(_d(V,Q),G--)}else _d(V,Q)}return V}(e);var n,r,i=e.length,s=128,o=0,c=72;for(n=0;n<e.length;n++)(r=e[n])<128&&_d(t,mw(r));var l=t.length,p=l;for(l&&_d(t,"-");p<i;){var m=fw;for(n=0;n<e.length;n++)(r=e[n])>=s&&r<m&&(m=r);var E=p+1;if(m-s>nf((fw-o)/E))throw new hN(uN);for(o+=(m-s)*E,s=m,n=0;n<e.length;n++){if((r=e[n])<s&&++o>fw)throw new hN(uN);if(r===s){for(var v=o,y=36;;){var D=y<=c?1:y>=c+26?26:y-c;if(v<D)break;var A=v-D,P=36-D;_d(t,mw(mN(D+A%P))),v=nf(A/P),y+=36}_d(t,mw(mN(v))),c=DB(o,E,p===l),o=0,p++}}o++,s++}return fN(t,"")},xB=qt,_w=He,MB=RS,gw=re,_N=Ka,Po=B,PS=ca,ko=ic,UB=Ku,Ew=mr,vw=pB,rf=function(e){var t=yB(e),n=wB(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=vB(i,r>2?arguments[2]:void 0));var o,c,l,p,m,E,v=IB(t),y=0;if(!v||this===lN&&CB(v))for(o=RB(t),c=n?new this(o):lN(o);o>y;y++)E=s?i(t[y],y):t[y],cN(c,y,E);else for(c=n?new this:[],m=(p=bB(t,v)).next;!(l=SB(m,p)).done;y++)E=s?TB(p,i,[l.value,y],!0):l.value,cN(c,y,E);return c.length=y,c},ha=Tr,VB=ZC.codeAt,jB=function(e){var t,n,r=[],i=PB(NB(kB(e),dN,"."),".");for(t=0;t<i.length;t++)n=i[t],_d(r,OB(AB,n)?"xn--"+LB(n):n);return fN(r,".")},ol=Mi,FB=wo,BB=gs,gN=rB,EN=rc,WB=EN.set,kS=EN.getterFor("URL"),GB=gN.URLSearchParams,HB=gN.getState,hg=gw.URL,Sw=gw.TypeError,DS=gw.parseInt,KB=Math.floor,vN=Math.pow,Do=Po("".charAt),pa=Po(/./.exec),pg=Po([].join),zB=Po(1 .toString),YB=Po([].pop),sf=Po([].push),yw=Po("".replace),qB=Po([].shift),XB=Po("".split),fg=Po("".slice),LS=Po("".toLowerCase),JB=Po([].unshift),Tw="Invalid scheme",sh="Invalid host",SN="Invalid port",yN=/[a-z]/i,QB=/[\d+-.a-z]/i,Cw=/\d/,$B=/^0x/i,ZB=/^[0-7]+$/,e2=/^\d+$/,TN=/^[\da-f]+$/i,t2=/[\0\t\n\r #%/:<>?@[\\\]^|]/,n2=/[\0\t\n\r #/:<>?@[\\\]^|]/,r2=/^[\u0000-\u0020]+/,i2=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,s2=/[\t\n\r]/g,mg=function(e){var t,n,r,i;if(typeof e=="number"){for(t=[],n=0;n<4;n++)JB(t,e%256),e=KB(e/256);return pg(t,".")}if(typeof e=="object"){for(t="",r=function(s){for(var o=null,c=1,l=null,p=0,m=0;m<8;m++)s[m]!==0?(p>c&&(o=l,c=p),l=null,p=0):(l===null&&(l=m),++p);return p>c?l:o}(e),n=0;n<8;n++)i&&e[n]===0||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=zB(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},xS={},CN=vw({},xS,{" ":1,'"':1,"<":1,">":1,"`":1}),wN=vw({},CN,{"#":1,"?":1,"{":1,"}":1}),ww=vw({},wN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),gd=function(e,t){var n=VB(e,0);return n>32&&n<127&&!Ew(t,e)?e:encodeURIComponent(e)},MS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_g=function(e,t){var n;return e.length===2&&pa(yN,Do(e,0))&&((n=Do(e,1))===":"||!t&&n==="|")},RN=function(e){var t;return e.length>1&&_g(fg(e,0,2))&&(e.length===2||(t=Do(e,2))==="/"||t==="\\"||t==="?"||t==="#")},o2=function(e){return e==="."||LS(e)==="%2e"},Rw={},bN={},bw={},IN={},AN={},Iw={},ON={},NN={},US={},VS={},Aw={},Ow={},Nw={},Pw={},PN={},kw={},of={},mc={},kN={},oh={},al={},Dw=function(e,t,n){var r,i,s,o=ol(e);if(t){if(i=this.parse(o))throw new Sw(i);this.searchParams=null}else{if(n!==void 0&&(r=new Dw(n,!0)),i=this.parse(o,null,r))throw new Sw(i);(s=HB(new GB)).bindURL(this),this.searchParams=s}};Dw.prototype={type:"URL",parse:function(e,t,n){var r,i,s,o,c,l=this,p=t||Rw,m=0,E="",v=!1,y=!1,D=!1;for(e=ol(e),t||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=yw(e,r2,""),e=yw(e,i2,"$1")),e=yw(e,s2,""),r=rf(e);m<=r.length;){switch(i=r[m],p){case Rw:if(!i||!pa(yN,i)){if(t)return Tw;p=bw;continue}E+=LS(i),p=bN;break;case bN:if(i&&(pa(QB,i)||i==="+"||i==="-"||i==="."))E+=LS(i);else{if(i!==":"){if(t)return Tw;E="",p=bw,m=0;continue}if(t&&(l.isSpecial()!==Ew(MS,E)||E==="file"&&(l.includesCredentials()||l.port!==null)||l.scheme==="file"&&!l.host))return;if(l.scheme=E,t)return void(l.isSpecial()&&MS[l.scheme]===l.port&&(l.port=null));E="",l.scheme==="file"?p=Pw:l.isSpecial()&&n&&n.scheme===l.scheme?p=IN:l.isSpecial()?p=NN:r[m+1]==="/"?(p=AN,m++):(l.cannotBeABaseURL=!0,sf(l.path,""),p=kN)}break;case bw:if(!n||n.cannotBeABaseURL&&i!=="#")return Tw;if(n.cannotBeABaseURL&&i==="#"){l.scheme=n.scheme,l.path=ha(n.path),l.query=n.query,l.fragment="",l.cannotBeABaseURL=!0,p=al;break}p=n.scheme==="file"?Pw:Iw;continue;case IN:if(i!=="/"||r[m+1]!=="/"){p=Iw;continue}p=US,m++;break;case AN:if(i==="/"){p=VS;break}p=mc;continue;case Iw:if(l.scheme=n.scheme,i===No)l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ha(n.path),l.query=n.query;else if(i==="/"||i==="\\"&&l.isSpecial())p=ON;else if(i==="?")l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ha(n.path),l.query="",p=oh;else{if(i!=="#"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ha(n.path),l.path.length--,p=mc;continue}l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,l.path=ha(n.path),l.query=n.query,l.fragment="",p=al}break;case ON:if(!l.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){l.username=n.username,l.password=n.password,l.host=n.host,l.port=n.port,p=mc;continue}p=VS}else p=US;break;case NN:if(p=US,i!=="/"||Do(E,m+1)!=="/")continue;m++;break;case US:if(i!=="/"&&i!=="\\"){p=VS;continue}break;case VS:if(i==="@"){v&&(E="%40"+E),v=!0,s=rf(E);for(var A=0;A<s.length;A++){var P=s[A];if(P!==":"||D){var j=gd(P,ww);D?l.password+=j:l.username+=j}else D=!0}E=""}else if(i===No||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(v&&E==="")return"Invalid authority";m-=rf(E).length+1,E="",p=Aw}else E+=i;break;case Aw:case Ow:if(t&&l.scheme==="file"){p=kw;continue}if(i!==":"||y){if(i===No||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()){if(l.isSpecial()&&E==="")return sh;if(t&&E===""&&(l.includesCredentials()||l.port!==null))return;if(o=l.parseHost(E))return o;if(E="",p=of,t)return;continue}i==="["?y=!0:i==="]"&&(y=!1),E+=i}else{if(E==="")return sh;if(o=l.parseHost(E))return o;if(E="",p=Nw,t===Ow)return}break;case Nw:if(!pa(Cw,i)){if(i===No||i==="/"||i==="?"||i==="#"||i==="\\"&&l.isSpecial()||t){if(E!==""){var V=DS(E,10);if(V>65535)return SN;l.port=l.isSpecial()&&V===MS[l.scheme]?null:V,E=""}if(t)return;p=of;continue}return SN}E+=i;break;case Pw:if(l.scheme="file",i==="/"||i==="\\")p=PN;else{if(!n||n.scheme!=="file"){p=mc;continue}switch(i){case No:l.host=n.host,l.path=ha(n.path),l.query=n.query;break;case"?":l.host=n.host,l.path=ha(n.path),l.query="",p=oh;break;case"#":l.host=n.host,l.path=ha(n.path),l.query=n.query,l.fragment="",p=al;break;default:RN(pg(ha(r,m),""))||(l.host=n.host,l.path=ha(n.path),l.shortenPath()),p=mc;continue}}break;case PN:if(i==="/"||i==="\\"){p=kw;break}n&&n.scheme==="file"&&!RN(pg(ha(r,m),""))&&(_g(n.path[0],!0)?sf(l.path,n.path[0]):l.host=n.host),p=mc;continue;case kw:if(i===No||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&_g(E))p=mc;else if(E===""){if(l.host="",t)return;p=of}else{if(o=l.parseHost(E))return o;if(l.host==="localhost"&&(l.host=""),t)return;E="",p=of}continue}E+=i;break;case of:if(l.isSpecial()){if(p=mc,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==No&&(p=mc,i!=="/"))continue}else l.fragment="",p=al;else l.query="",p=oh;break;case mc:if(i===No||i==="/"||i==="\\"&&l.isSpecial()||!t&&(i==="?"||i==="#")){if((c=LS(c=E))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(l.shortenPath(),i==="/"||i==="\\"&&l.isSpecial()||sf(l.path,"")):o2(E)?i==="/"||i==="\\"&&l.isSpecial()||sf(l.path,""):(l.scheme==="file"&&!l.path.length&&_g(E)&&(l.host&&(l.host=""),E=Do(E,0)+":"),sf(l.path,E)),E="",l.scheme==="file"&&(i===No||i==="?"||i==="#"))for(;l.path.length>1&&l.path[0]==="";)qB(l.path);i==="?"?(l.query="",p=oh):i==="#"&&(l.fragment="",p=al)}else E+=gd(i,wN);break;case kN:i==="?"?(l.query="",p=oh):i==="#"?(l.fragment="",p=al):i!==No&&(l.path[0]+=gd(i,xS));break;case oh:t||i!=="#"?i!==No&&(i==="'"&&l.isSpecial()?l.query+="%27":l.query+=i==="#"?"%23":gd(i,xS)):(l.fragment="",p=al);break;case al:i!==No&&(l.fragment+=gd(i,CN))}m++}},parseHost:function(e){var t,n,r;if(Do(e,0)==="["){if(Do(e,e.length-1)!=="]"||(t=function(i){var s,o,c,l,p,m,E,v=[0,0,0,0,0,0,0,0],y=0,D=null,A=0,P=function(){return Do(i,A)};if(P()===":"){if(Do(i,1)!==":")return;A+=2,D=++y}for(;P();){if(y===8)return;if(P()!==":"){for(s=o=0;o<4&&pa(TN,P());)s=16*s+DS(P(),16),A++,o++;if(P()==="."){if(o===0||(A-=o,y>6))return;for(c=0;P();){if(l=null,c>0){if(!(P()==="."&&c<4))return;A++}if(!pa(Cw,P()))return;for(;pa(Cw,P());){if(p=DS(P(),10),l===null)l=p;else{if(l===0)return;l=10*l+p}if(l>255)return;A++}v[y]=256*v[y]+l,++c!=2&&c!==4||y++}if(c!==4)return;break}if(P()===":"){if(A++,!P())return}else if(P())return;v[y++]=s}else{if(D!==null)return;A++,D=++y}}if(D!==null)for(m=y-D,y=7;y!==0&&m>0;)E=v[y],v[y--]=v[D+m-1],v[D+--m]=E;else if(y!==8)return;return v}(fg(e,1,-1)),!t))return sh;this.host=t}else if(this.isSpecial()){if(e=jB(e),pa(t2,e)||(t=function(i){var s,o,c,l,p,m,E,v=XB(i,".");if(v.length&&v[v.length-1]===""&&v.length--,(s=v.length)>4)return i;for(o=[],c=0;c<s;c++){if((l=v[c])==="")return i;if(p=10,l.length>1&&Do(l,0)==="0"&&(p=pa($B,l)?16:8,l=fg(l,p===8?1:2)),l==="")m=0;else{if(!pa(p===10?e2:p===8?ZB:TN,l))return i;m=DS(l,p)}sf(o,m)}for(c=0;c<s;c++)if(m=o[c],c===s-1){if(m>=vN(256,5-s))return null}else if(m>255)return null;for(E=YB(o),c=0;c<o.length;c++)E+=o[c]*vN(256,3-c);return E}(e),t===null))return sh;this.host=t}else{if(pa(n2,e))return sh;for(t="",n=rf(e),r=0;r<n.length;r++)t+=gd(n[r],xS);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Ew(MS,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&_g(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,s=e.port,o=e.path,c=e.query,l=e.fragment,p=t+":";return i!==null?(p+="//",e.includesCredentials()&&(p+=n+(r?":"+r:"")+"@"),p+=mg(i),s!==null&&(p+=":"+s)):t==="file"&&(p+="//"),p+=e.cannotBeABaseURL?o[0]:o.length?"/"+pg(o,"/"):"",c!==null&&(p+="?"+c),l!==null&&(p+="#"+l),p},setHref:function(e){var t=this.parse(e);if(t)throw new Sw(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new af(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+mg(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ol(e)+":",Rw)},getUsername:function(){return this.username},setUsername:function(e){var t=rf(ol(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=gd(t[n],ww)}},getPassword:function(){return this.password},setPassword:function(e){var t=rf(ol(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=gd(t[n],ww)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?mg(e):mg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Aw)},getHostname:function(){var e=this.host;return e===null?"":mg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Ow)},getPort:function(){var e=this.port;return e===null?"":ol(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ol(e))===""?this.port=null:this.parse(e,Nw))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+pg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,of))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ol(e))===""?this.query=null:(Do(e,0)==="?"&&(e=fg(e,1)),this.query="",this.parse(e,oh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ol(e))!==""?(Do(e,0)==="#"&&(e=fg(e,1)),this.fragment="",this.parse(e,al)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var af=function(e){var t=UB(this,ss),n=BB(arguments.length,1)>1?arguments[1]:void 0,r=WB(t,new Dw(e,!1,n));_w||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},ss=af.prototype,Lo=function(e,t){return{get:function(){return kS(this)[e]()},set:t&&function(n){return kS(this)[t](n)},configurable:!0,enumerable:!0}};if(_w&&(ko(ss,"href",Lo("serialize","setHref")),ko(ss,"origin",Lo("getOrigin")),ko(ss,"protocol",Lo("getProtocol","setProtocol")),ko(ss,"username",Lo("getUsername","setUsername")),ko(ss,"password",Lo("getPassword","setPassword")),ko(ss,"host",Lo("getHost","setHost")),ko(ss,"hostname",Lo("getHostname","setHostname")),ko(ss,"port",Lo("getPort","setPort")),ko(ss,"pathname",Lo("getPathname","setPathname")),ko(ss,"search",Lo("getSearch","setSearch")),ko(ss,"searchParams",Lo("getSearchParams")),ko(ss,"hash",Lo("getHash","setHash"))),PS(ss,"toJSON",function(){return kS(this).serialize()},{enumerable:!0}),PS(ss,"toString",function(){return kS(this).serialize()},{enumerable:!0}),hg){var DN=hg.createObjectURL,LN=hg.revokeObjectURL;DN&&PS(af,"createObjectURL",_N(DN,hg)),LN&&PS(af,"revokeObjectURL",_N(LN,hg))}FB(af,"URL"),xB({global:!0,forced:!MB,sham:!_w},{URL:af});var a2=qt,xN=T,c2=gs,MN=Mi,l2=RS,Lw=Or("URL"),d2=l2&&xN(function(){Lw.canParse()}),u2=xN(function(){return Lw.canParse.length!==1});a2({target:"URL",stat:!0,forced:!d2||u2},{canParse:function(e){var t=c2(arguments.length,1),n=MN(e),r=t<2||arguments[1]===void 0?void 0:MN(arguments[1]);try{return!!new Lw(n,r)}catch{return!1}}});var h2=qt,p2=gs,UN=Mi,f2=RS,m2=Or("URL");h2({target:"URL",stat:!0,forced:!f2},{parse:function(e){var t=p2(arguments.length,1),n=UN(e),r=t<2||arguments[1]===void 0?void 0:UN(arguments[1]);try{return new m2(n,r)}catch{return null}}});var jS=S(Qr.URL);let VN=!0,jN=!0;function FS(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function ah(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,c){if(o!==t)return i.apply(this,arguments);const l=p=>{const m=n(p);m&&(c.handleEvent?c.handleEvent(m):c(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(c,l),i.apply(this,[o,l])};const s=r.removeEventListener;r.removeEventListener=function(o,c){if(o!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(c))return s.apply(this,arguments);const l=this._eventMap[t].get(c);return this._eventMap[t].delete(c),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function _2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(VN=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function g2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(jN=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function FN(){if(typeof window=="object"){if(VN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function xw(e,t){jN&&console.warn(e+" is deprecated, please use "+t+" instead.")}function BN(e){return Object.prototype.toString.call(e)==="[object Object]"}function WN(e){var t;return BN(e)?Ui(t=Object.keys(e)).call(t,function(n,r){const i=BN(e[r]),s=i?WN(e[r]):e[r],o=i&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[r]:s})},{}):e}function Mw(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?Mw(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(i=>{Mw(e,e.get(i),n)})}))}function GN(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const s=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&s.push(o)}),s.forEach(o=>{e.forEach(c=>{c.type===r&&c.trackId===o.id&&Mw(e,c,i)})}),i}const HN=FN;function KN(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const p=typeof o[l]=="object"?o[l]:{ideal:o[l]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const m=function(E,v){return E?E+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(p.ideal!==void 0){c.optional=c.optional||[];let E={};typeof p.ideal=="number"?(E[m("min",l)]=p.ideal,c.optional.push(E),E={},E[m("max",l)]=p.ideal,c.optional.push(E)):(E[m("",l)]=p.ideal,c.optional.push(E))}p.exact!==void 0&&typeof p.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[m("",l)]=p.exact):["min","max"].forEach(E=>{p[E]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[m(E,l)]=p[E])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(t.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const l=function(p,m,E){m in p&&!(E in p)&&(p[E]=p[m],delete p[m])};l((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),l(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let l=o.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const p=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let m;if(delete o.video.facingMode,l.exact==="environment"||l.ideal==="environment"?m=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(E=>{E=E.filter(y=>y.kind==="videoinput");let v=E.find(y=>m.some(D=>{var A;return Ae(A=y.label.toLowerCase()).call(A,D)}));return!v&&E.length&&Ae(m).call(m,"back")&&(v=E[E.length-1]),v&&(o.video.deviceId=l.exact?{exact:v.deviceId}:{ideal:v.deviceId}),o.video=r(o.video),HN("chrome: "+JSON.stringify(o)),c(o)})}o.video=r(o.video)}return HN("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return t.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,c,l){i(o,p=>{n.webkitGetUserMedia(p,c,m=>{l&&l(s(m))})})}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>o(l).then(p=>{if(l.audio&&!p.getAudioTracks().length||l.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return p},p=>je.reject(s(p))))}}}function zN(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function YN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.track.id):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.id):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ah(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function qN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){let l=i.apply(this,arguments);return l||(l=t(this,o),this._senders.push(l)),l};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(t(this,s))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{const o=this._senders.find(c=>c.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function XN(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const s=function(c){const l={};return c.result().forEach(p=>{const m={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(E=>{m[E]=p.stat(E)}),l[m.id]=m}),l},o=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){r(o(s(l)))};return t.apply(this,[c,n])}return new je((c,l)=>{t.apply(this,[function(p){c(o(s(p)))},l])}).then(r,i)}}function JN(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>GN(s,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),ah(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>GN(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach(o=>{o.track===n&&(r?s=!0:r=o)}),this.getReceivers().forEach(o=>(o.track===n&&(i?s=!0:i=o),o.track===n)),s||r&&i?je.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():je.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function QN(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(l=>{if(this.getSenders().find(m=>m.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>o.indexOf(l)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function $N(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return QN(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=n.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(p=>this._reverseStreams[p.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(p=>{if(this.getSenders().find(E=>E.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const p=new e.MediaStream(l.getTracks());this._streams[l.id]=p,this._reverseStreams[p.id]=l,l=p}r.apply(this,[l])};const i=e.RTCPeerConnection.prototype.removeStream;function s(l,p){let m=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(E=>{const v=l._reverseStreams[E],y=l._streams[v.id];m=m.replace(new RegExp(y.id,"g"),v.id)}),new RTCSessionDescription({type:p.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(y=>y===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[p.id];if(v)v.addTrack(l),je.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new e.MediaStream([l]);this._streams[p.id]=y,this._reverseStreams[y.id]=p,this.addStream(y)}return this.getSenders().find(y=>y.track===l)},["createOffer","createAnswer"].forEach(function(l){const p=e.RTCPeerConnection.prototype[l],m={[l](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[v=>{const y=s(this,v);E[0].apply(null,[y])},v=>{E[1]&&E[1].apply(null,v)},arguments[2]]):p.apply(this,arguments).then(v=>s(this,v))}};e.RTCPeerConnection.prototype[l]=m[l]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(l,p){let m=p.sdp;return Object.keys(l._reverseStreams||[]).forEach(E=>{const v=l._reverseStreams[E],y=l._streams[v.id];m=m.replace(new RegExp(v.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:m})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(l._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(E=>l.track===E)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Uw(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=i[n]})}function ZN(e,t){ah(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var eP=Object.freeze({__proto__:null,fixNegotiationNeeded:ZN,shimAddTrackRemoveTrack:$N,shimAddTrackRemoveTrackWithNative:QN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:qN,shimGetStats:XN,shimGetUserMedia:KN,shimMediaStream:zN,shimOnTrack:YN,shimPeerConnection:Uw,shimSenderReceiverGetStats:JN});function tP(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){xw("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,c,l){c in o&&!(l in o)&&(o[l]=o[c],delete o[c])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const c=o.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function nP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Vw(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return r.apply(this,[i||null]).then(c=>{if(t.version<53&&!s)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((p,m)=>{c.set(m,Object.assign({},p,{type:n[p.type]||p.type}))})}return c}).then(s,o)}}function rP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):je.resolve(new Map)}}function iP(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),ah(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function sP(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){xw("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&Ae(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function oP(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function aP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function cP(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function lP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function dP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?je.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var uP=Object.freeze({__proto__:null,shimAddTransceiver:aP,shimCreateAnswer:dP,shimCreateOffer:lP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,je.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:cP,shimGetUserMedia:tP,shimOnTrack:nP,shimPeerConnection:Vw,shimRTCDataChannel:oP,shimReceiverGetStats:iP,shimRemoveStream:sP,shimSenderGetStats:rP});function hP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Ae(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach(o=>{var c;this._localStreams?Ae(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(i=>{Ae(r).call(r,i.track)&&this.removeTrack(i)})})}}function pP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Ae(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)})}),t.apply(n,arguments)}}}function fP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(l,p){const m=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[m]);return p?(E.then(l,p),je.resolve()):E},t.createAnswer=function(l,p){const m=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[m]);return p?(E.then(l,p),je.resolve()):E};let c=function(l,p,m){const E=i.apply(this,[l]);return m?(E.then(p,m),je.resolve()):E};t.setLocalDescription=c,c=function(l,p,m){const E=s.apply(this,[l]);return m?(E.then(p,m),je.resolve()):E},t.setRemoteDescription=c,c=function(l,p,m){const E=o.apply(this,[l]);return m?(E.then(p,m),je.resolve()):E},t.addIceCandidate=c}function mP(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=i=>r(_P(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,i){t.mediaDevices.getUserMedia(n).then(r,i)}).bind(t))}function _P(e){return e&&e.video!==void 0?Object.assign({},e,{video:WN(e.video)}):e}function gP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(xw("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function EP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function vP(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function SP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var yP=Object.freeze({__proto__:null,shimAudioContext:SP,shimCallbacksAPI:fP,shimConstraints:_P,shimCreateOfferLegacy:vP,shimGetUserMedia:mP,shimLocalStreamsAPI:hP,shimRTCIceServerUrls:gP,shimRemoteStreamsAPI:pP,shimTrackEventTransceiver:EP}),TP=`	
\v\f\r \u2028\u2029\uFEFF`,E2=zr,v2=Mi,jw=TP,CP=B("".replace),S2=RegExp("^["+jw+"]+"),y2=RegExp("(^|[^"+jw+"])["+jw+"]+$"),T2=function(e){return function(t){var n=v2(E2(t));return 1&e&&(n=CP(n,S2,"")),2&e&&(n=CP(n,y2,"$1")),n}},C2={trim:T2(3)},w2=Ap.PROPER,R2=T,wP=TP,b2=C2.trim;qt({target:"String",proto:!0,forced:function(e){return R2(function(){return!!wP[e]()||""[e]()!==""||w2&&wP[e].name!==e})}("trim")},{trim:function(){return b2(this)}});var I2=Qi("String","trim"),A2=Y,O2=I2,Fw=String.prototype,N2=function(e){var t=e.trim;return typeof e=="string"||e===Fw||A2(Fw,e)&&t===Fw.trim?O2:t},ri=S(N2),RP={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const i=t.matchPrefix(n+r,"a=ice-ufrag:")[0],s=t.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const c=i[o],l=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const p=t.parseRtpMap(l),m=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(p.parameters=m.length?t.parseFmtp(m[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(o=>{r.headerExtensions.push(t.parseExtmap(o))});const s=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(o=>{s.forEach(c=>{o.rtcpFeedback.find(l=>l.type===c.type&&l.parameter===c.parameter)||o.rtcpFeedback.push(c)})}),r},t.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=t.writeRtpMap(o),i+=t.writeFmtp(o),i+=t.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=t.writeExtmap(o)}),i},t.parseRtpEncodingParameters=function(n){const r=[],i=t.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=t.matchPrefix(n,"a=ssrc:").map(v=>t.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),l=c.length>0&&c[0].ssrc;let p;const m=t.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(y=>parseInt(y,10)));m.length>0&&m[0].length>1&&m[0][0]===l&&(p=m[0][1]),i.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let y={ssrc:l,codecPayloadType:parseInt(v.parameters.apt,10)};l&&p&&(y.rtx={ssrc:p}),r.push(y),s&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&l&&r.push({ssrc:l});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,r.forEach(v=>{v.maxBitrate=E})),r},t.parseRtcpParameters=function(n){const r={},i=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const i=t.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=t.matchPrefix(n,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),i=t.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const c=t.matchPrefix(n,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},t.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return s=n||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const i=t.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(RP);var bP=RP.exports,cf=S(bP),P2=f({__proto__:null,default:cf},[bP]);function BS(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),i=cf.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,ah(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Bw(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ah(e,"icecandidate",t=>{if(t.candidate){const n=cf.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function WS(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const l=cf.splitSections(c.sdp);return l.shift(),l.some(p=>{const m=cf.parseMLine(p);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1})},r=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const p=parseInt(l[1],10);return p!=p?-1:p},i=function(c){let l=65536;return t.browser==="firefox"&&(l=t.version<57?c===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),l},s=function(c,l){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const m=cf.matchPrefix(c.sdp,"a=max-message-size:");return m.length>0?p=parseInt(m[0].substr(19),10):t.browser==="firefox"&&l!==-1&&(p=2147483637),p},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),p=s(arguments[0],c);let m;m=l===0&&p===0?Number.POSITIVE_INFINITY:l===0||p===0?Math.max(l,p):Math.min(l,p);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>m}),this._sctp=E}return o.apply(this,arguments)}}function GS(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const s=r.send;r.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},ah(e,"datachannel",r=>(t(r.channel,r.target),r))}function Ww(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Gw(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(s=>ri(s).call(s)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function HS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?je.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),je.resolve())})}function KS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var k2=Object.freeze({__proto__:null,removeExtmapAllowMixed:Gw,shimAddIceCandidateNullOrEmpty:HS,shimConnectionState:Ww,shimMaxMessageSize:WS,shimParameterlessSetLocalDescription:KS,shimRTCIceCandidate:BS,shimRTCIceCandidateRelayProtocol:Bw,shimSendThrowTypeError:GS});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=FN,r=function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=FS(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=FS(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=FS(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o}(e),i={browserDetails:r,commonShim:k2,extractVersion:FS,disableLog:_2,disableWarnings:g2,sdp:P2};switch(r.browser){case"chrome":if(!eP||!Uw||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=eP,HS(e,r),KS(e),KN(e,r),zN(e),Uw(e,r),YN(e),$N(e,r),qN(e),XN(e),JN(e),ZN(e,r),BS(e),Bw(e),Ww(e),WS(e,r),GS(e),Gw(e,r);break;case"firefox":if(!uP||!Vw||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=uP,HS(e,r),KS(e),tP(e,r),Vw(e,r),nP(e),sP(e),rP(e),iP(e),oP(e),aP(e),cP(e),lP(e),dP(e),BS(e),Ww(e),WS(e,r),GS(e);break;case"safari":if(!yP||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=yP,HS(e,r),KS(e),gP(e),vP(e),fP(e),hP(e),pP(e),EP(e),mP(e),SP(e),BS(e),Bw(e),WS(e,r),GS(e),Gw(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Hw=re;qt({global:!0,forced:Hw.globalThis!==Hw},{globalThis:Hw});var IP=S(re),Kw={exports:{}};(function(e,t){(function(n,r){var i="function",s="undefined",o="object",c="string",l="major",p="model",m="name",E="type",v="vendor",y="version",D="architecture",A="console",P="mobile",j="tablet",V="smarttv",G="wearable",Z="embedded",Q="Amazon",z="Apple",ie="ASUS",fe="BlackBerry",ve="Browser",we="Chrome",Ct="Firefox",bt="Google",ut="Huawei",Yt="LG",Ht="Microsoft",Kr="Motorola",Ee="Opera",Ne="Samsung",Ke="Sharp",Se="Sony",b="Xiaomi",K="Zebra",J="Facebook",be="Chromium OS",gt="Mac OS",dn=" Browser",tr=function(Jn){for(var nr={},gn=0;gn<Jn.length;gn++)nr[Jn[gn].toUpperCase()]=Jn[gn];return nr},oo=function(Jn,nr){return typeof Jn===c&&qo(nr).indexOf(qo(Jn))!==-1},qo=function(Jn){return Jn.toLowerCase()},SE=function(Jn,nr){if(typeof Jn===c)return Jn=Jn.replace(/^\s\s*/,""),typeof nr===s?Jn:Jn.substring(0,500)},xh=function(Jn,nr){for(var gn,qi,Oa,jn,yl,Ut,Na=0;Na<nr.length&&!yl;){var Mh=nr[Na],kc=nr[Na+1];for(gn=qi=0;gn<Mh.length&&!yl&&Mh[gn];)if(yl=Mh[gn++].exec(Jn))for(Oa=0;Oa<kc.length;Oa++)Ut=yl[++qi],typeof(jn=kc[Oa])===o&&jn.length>0?jn.length===2?typeof jn[1]==i?this[jn[0]]=jn[1].call(this,Ut):this[jn[0]]=jn[1]:jn.length===3?typeof jn[1]!==i||jn[1].exec&&jn[1].test?this[jn[0]]=Ut?Ut.replace(jn[1],jn[2]):r:this[jn[0]]=Ut?jn[1].call(this,Ut,jn[2]):r:jn.length===4&&(this[jn[0]]=Ut?jn[3].call(this,Ut.replace(jn[1],jn[2])):r):this[jn]=Ut||r;Na+=2}},tm=function(Jn,nr){for(var gn in nr)if(typeof nr[gn]===o&&nr[gn].length>0){for(var qi=0;qi<nr[gn].length;qi++)if(oo(nr[gn][qi],Jn))return gn==="?"?r:gn}else if(oo(nr[gn],Jn))return gn==="?"?r:gn;return nr.hasOwnProperty("*")?nr["*"]:Jn},KT={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},zT={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,y],[/opios[\/ ]+([\w\.]+)/i],[y,[m,Ee+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[m,Ee+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[m,Ee]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[m,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[y,[m,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[m,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[m,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[m,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[m,"UC"+ve]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[m,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[m,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[m,"Smart Lenovo "+ve]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+ve],y],[/\bfocus\/([\w\.]+)/i],[y,[m,Ct+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[m,Ee+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[m,Ee+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[m,"MIUI"+dn]],[/fxios\/([\w\.-]+)/i],[y,[m,Ct]],[/\bqihoobrowser\/?([\w\.]*)/i],[y,[m,"360"]],[/\b(qq)\/([\w\.]+)/i],[[m,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1"+dn],y],[/samsungbrowser\/([\w\.]+)/i],[y,[m,Ne+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[y,[m,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[m,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[m,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[m],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[y,m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,J],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[m,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[m,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[m,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[m,we+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,we+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[m,"Android "+ve]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[y,tm,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],y],[/(wolvic|librewolf)\/([\w\.]+)/i],[m,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[m,Ct+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[m,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[m,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,qo]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,"",qo]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,qo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[v,Ne],[E,j]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[p,[v,Ne],[E,P]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[v,z],[E,P]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[v,z],[E,j]],[/(macintosh);/i],[p,[v,z]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[v,Ke],[E,P]],[/(?:honor)([-\w ]+)[;\)]/i],[p,[v,"Honor"],[E,P]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[v,ut],[E,j]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[v,ut],[E,P]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[p,/_/g," "],[v,b],[E,P]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[v,b],[E,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[v,"OPPO"],[E,P]],[/\b(opd2\d{3}a?) bui/i],[p,[v,"OPPO"],[E,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[v,"Vivo"],[E,P]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[p,[v,"Realme"],[E,P]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[v,Kr],[E,P]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[v,Kr],[E,j]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[v,Yt],[E,j]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[v,Yt],[E,P]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[v,"Lenovo"],[E,j]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[v,"Nokia"],[E,P]],[/(pixel c)\b/i],[p,[v,bt],[E,j]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[v,bt],[E,P]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[v,Se],[E,P]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[v,Se],[E,j]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[v,"OnePlus"],[E,P]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[v,Q],[E,j]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[v,Q],[E,P]],[/(playbook);[-\w\),; ]+(rim)/i],[p,v,[E,j]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[v,fe],[E,P]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[v,ie],[E,j]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[v,ie],[E,P]],[/(nexus 9)/i],[p,[v,"HTC"],[E,j]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[p,/_/g," "],[E,P]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[p,[v,"TCL"],[E,j]],[/(itel) ((\w+))/i],[[v,qo],p,[E,tm,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[v,"Acer"],[E,j]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[v,"Meizu"],[E,P]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[p,[v,"Ulefone"],[E,P]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[p,[v,"Energizer"],[E,P]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[p,[v,"Cat"],[E,P]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[p,[v,"Smartfren"],[E,P]],[/droid.+; (a(?:015|06[35]|142p?))/i],[p,[v,"Nothing"],[E,P]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,p,[E,P]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,p,[E,j]],[/(surface duo)/i],[p,[v,Ht],[E,j]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[v,"Fairphone"],[E,P]],[/(u304aa)/i],[p,[v,"AT&T"],[E,P]],[/\bsie-(\w*)/i],[p,[v,"Siemens"],[E,P]],[/\b(rct\w+) b/i],[p,[v,"RCA"],[E,j]],[/\b(venue[\d ]{2,7}) b/i],[p,[v,"Dell"],[E,j]],[/\b(q(?:mv|ta)\w+) b/i],[p,[v,"Verizon"],[E,j]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[v,"Barnes & Noble"],[E,j]],[/\b(tm\d{3}\w+) b/i],[p,[v,"NuVision"],[E,j]],[/\b(k88) b/i],[p,[v,"ZTE"],[E,j]],[/\b(nx\d{3}j) b/i],[p,[v,"ZTE"],[E,P]],[/\b(gen\d{3}) b.+49h/i],[p,[v,"Swiss"],[E,P]],[/\b(zur\d{3}) b/i],[p,[v,"Swiss"],[E,j]],[/\b((zeki)?tb.*\b) b/i],[p,[v,"Zeki"],[E,j]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],p,[E,j]],[/\b(ns-?\w{0,9}) b/i],[p,[v,"Insignia"],[E,j]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[v,"NextBook"],[E,j]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],p,[E,P]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],p,[E,P]],[/\b(ph-1) /i],[p,[v,"Essential"],[E,P]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[v,"Envizen"],[E,j]],[/\b(trio[-\w\. ]+) b/i],[p,[v,"MachSpeed"],[E,j]],[/\btu_(1491) b/i],[p,[v,"Rotor"],[E,j]],[/(shield[\w ]+) b/i],[p,[v,"Nvidia"],[E,j]],[/(sprint) (\w+)/i],[v,p,[E,P]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[v,Ht],[E,P]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[v,K],[E,j]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[v,K],[E,P]],[/smart-tv.+(samsung)/i],[v,[E,V]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[v,Ne],[E,V]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,Yt],[E,V]],[/(apple) ?tv/i],[v,[p,z+" TV"],[E,V]],[/crkey/i],[[p,we+"cast"],[v,bt],[E,V]],[/droid.+aft(\w+)( bui|\))/i],[p,[v,Q],[E,V]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[v,Ke],[E,V]],[/(bravia[\w ]+)( bui|\))/i],[p,[v,Se],[E,V]],[/(mitv-\w{5}) bui/i],[p,[v,b],[E,V]],[/Hbbtv.*(technisat) (.*);/i],[v,p,[E,V]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,SE],[p,SE],[E,V]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,V]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,p,[E,A]],[/droid.+; (shield) bui/i],[p,[v,"Nvidia"],[E,A]],[/(playstation [345portablevi]+)/i],[p,[v,Se],[E,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[v,Ht],[E,A]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[p,[v,Ne],[E,G]],[/((pebble))app/i],[v,p,[E,G]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[v,z],[E,G]],[/droid.+; (glass) \d/i],[p,[v,bt],[E,G]],[/droid.+; (wt63?0{2,3})\)/i],[p,[v,K],[E,G]],[/droid.+; (glass) \d/i],[p,[v,bt],[E,G]],[/(pico) (4|neo3(?: link|pro)?)/i],[v,p,[E,G]],[/; (quest( \d| pro)?)/i],[p,[v,J],[E,G]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[E,Z]],[/(aeobc)\b/i],[p,[v,Q],[E,Z]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[p,[E,P]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[E,j]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,j]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,P]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[m,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[m,y],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[m,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[m,[y,tm,KT]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,tm,KT],[m,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,gt],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,y],[/\(bb(10);/i],[y,[m,fe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[m,Ct+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[m,we+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,be],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,y],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[m,y]]},ao=function(Jn,nr){if(typeof Jn===o&&(nr=Jn,Jn=r),!(this instanceof ao))return new ao(Jn,nr).getResult();var gn=typeof n!==s&&n.navigator?n.navigator:r,qi=Jn||(gn&&gn.userAgent?gn.userAgent:""),Oa=gn&&gn.userAgentData?gn.userAgentData:r,jn=nr?function(Ut,Na){var Mh={};for(var kc in Ut)Na[kc]&&Na[kc].length%2==0?Mh[kc]=Na[kc].concat(Ut[kc]):Mh[kc]=Ut[kc];return Mh}(zT,nr):zT,yl=gn&&gn.userAgent==qi;return this.getBrowser=function(){var Ut={};return Ut[m]=r,Ut[y]=r,xh.call(Ut,qi,jn.browser),Ut[l]=function(Na){return typeof Na===c?Na.replace(/[^\d\.]/g,"").split(".")[0]:r}(Ut[y]),yl&&gn&&gn.brave&&typeof gn.brave.isBrave==i&&(Ut[m]="Brave"),Ut},this.getCPU=function(){var Ut={};return Ut[D]=r,xh.call(Ut,qi,jn.cpu),Ut},this.getDevice=function(){var Ut={};return Ut[v]=r,Ut[p]=r,Ut[E]=r,xh.call(Ut,qi,jn.device),yl&&!Ut[E]&&Oa&&Oa.mobile&&(Ut[E]=P),yl&&Ut[p]=="Macintosh"&&gn&&typeof gn.standalone!==s&&gn.maxTouchPoints&&gn.maxTouchPoints>2&&(Ut[p]="iPad",Ut[E]=j),Ut},this.getEngine=function(){var Ut={};return Ut[m]=r,Ut[y]=r,xh.call(Ut,qi,jn.engine),Ut},this.getOS=function(){var Ut={};return Ut[m]=r,Ut[y]=r,xh.call(Ut,qi,jn.os),yl&&!Ut[m]&&Oa&&Oa.platform&&Oa.platform!="Unknown"&&(Ut[m]=Oa.platform.replace(/chrome os/i,be).replace(/macos/i,gt)),Ut},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return qi},this.setUA=function(Ut){return qi=typeof Ut===c&&Ut.length>500?SE(Ut,500):Ut,this},this.setUA(qi),this};ao.VERSION="0.7.40",ao.BROWSER=tr([m,y,l]),ao.CPU=tr([D]),ao.DEVICE=tr([p,v,E,A,P,V,j,G,Z]),ao.ENGINE=ao.OS=tr([m,y]),e.exports&&(t=e.exports=ao),t.UAParser=ao;var Sl=typeof n!==s&&(n.jQuery||n.Zepto);if(Sl&&!Sl.ua){var YT=new ao;Sl.ua=YT.getResult(),Sl.ua.get=function(){return YT.getUA()},Sl.ua.set=function(Jn){YT.setUA(Jn);var nr=YT.getResult();for(var gn in nr)Sl.ua[gn]=nr[gn]}}})(typeof window=="object"?window:g)})(Kw,Kw.exports);var D2=S(Kw.exports),AP=cd.clear;qt({global:!0,bind:!0,forced:re.clearImmediate!==AP},{clearImmediate:AP});var OP=re,L2=le,x2=Ve,M2=Su,U2=Yr,V2=Tr,j2=gs,F2=OP.Function,B2=/MSIE .\./.test(U2)||M2==="BUN"&&function(){var e=OP.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),W2=qt,NP=re,PP=cd.set,G2=function(e,t){var n=1;return B2?function(r,i){var s=j2(arguments.length,1)>n,o=x2(r)?r:F2(r),c=s?V2(arguments,n):[],l=s?function(){L2(o,this,c)}:o;return e(l)}:e},kP=NP.setImmediate?G2(PP):PP;W2({global:!0,bind:!0,forced:NP.setImmediate!==kP},{setImmediate:kP});var DP=S(Qr.setImmediate),H2=re,K2=og,z2=Bn,Y2=gs,q2=He;qt({global:!0,dontCallGetSet:!0,forced:T(function(){return q2&&Object.getOwnPropertyDescriptor(H2,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Y2(arguments.length,1),K2(z2(e))}});var LP=S(Qr.queueMicrotask);function xP(e,t){return function(){return e.apply(t,arguments)}}const{toString:X2}=Object.prototype,{getPrototypeOf:zw}=Object,{iterator:zS,toStringTag:MP}=Symbol,YS=(Yw=Object.create(null),e=>{const t=X2.call(e);return Yw[t]||(Yw[t]=t.slice(8,-1).toLowerCase())});var Yw;const fa=e=>(e=e.toLowerCase(),t=>YS(t)===e),qS=e=>t=>typeof t===e,{isArray:lf}=Array,gg=qS("undefined"),UP=fa("ArrayBuffer"),J2=qS("string"),Ss=qS("function"),VP=qS("number"),XS=e=>e!==null&&typeof e=="object",JS=e=>{if(YS(e)!=="object")return!1;const t=zw(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||MP in e||zS in e)},Q2=fa("Date"),$2=fa("File"),Z2=fa("Blob"),eW=fa("FileList"),tW=fa("URLSearchParams"),[nW,rW,iW,sW]=["ReadableStream","Request","Response","Headers"].map(fa);function Eg(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),lf(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const s=i?Object.getOwnPropertyNames(e):Object.keys(e),o=s.length;let c;for(n=0;n<o;n++)c=s[n],t.call(null,e[c],c,e)}}function jP(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const ch=IP!==void 0?IP:typeof self<"u"?self:typeof window<"u"?window:globalThis,FP=e=>!gg(e)&&e!==ch,oW=(qw=typeof Uint8Array<"u"&&zw(Uint8Array),e=>qw&&e instanceof qw);var qw;const aW=fa("HTMLFormElement"),BP=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),cW=fa("RegExp"),WP=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Eg(n,(i,s)=>{let o;(o=t(i,s,e))!==!1&&(r[s]=o||i)}),Object.defineProperties(e,r)},lW=fa("AsyncFunction"),GP=(HP=typeof DP=="function",KP=Ss(ch.postMessage),HP?DP:KP?(Xw="axios@".concat(Math.random()),QS=[],ch.addEventListener("message",e=>{let{source:t,data:n}=e;t===ch&&n===Xw&&QS.length&&QS.shift()()},!1),e=>{QS.push(e),ch.postMessage(Xw,"*")}):e=>setTimeout(e));var HP,KP,Xw,QS;const dW=LP!==void 0?LP.bind(ch):typeof process<"u"&&process.nextTick||GP;var Ue={isArray:lf,isArrayBuffer:UP,isBuffer:function(e){return e!==null&&!gg(e)&&e.constructor!==null&&!gg(e.constructor)&&Ss(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ss(e.append)&&((t=YS(e))==="formdata"||t==="object"&&Ss(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&UP(e.buffer),t},isString:J2,isNumber:VP,isBoolean:e=>e===!0||e===!1,isObject:XS,isPlainObject:JS,isReadableStream:nW,isRequest:rW,isResponse:iW,isHeaders:sW,isUndefined:gg,isDate:Q2,isFile:$2,isBlob:Z2,isRegExp:cW,isFunction:Ss,isStream:e=>XS(e)&&Ss(e.pipe),isURLSearchParams:tW,isTypedArray:oW,isFileList:eW,forEach:Eg,merge:function e(){const{caseless:t}=FP(this)&&this||{},n={},r=(i,s)=>{const o=t&&jP(n,s)||s;JS(n[o])&&JS(i)?n[o]=e(n[o],i):JS(i)?n[o]=e({},i):lf(i)?n[o]=i.slice():n[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&Eg(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Eg(t,(i,s)=>{n&&Ss(i)?e[s]=xP(i,n):e[s]=i},{allOwnKeys:r}),e},trim:e=>ri(e)?ri(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,s,o;const c={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)o=i[s],r&&!r(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=n!==!1&&zw(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:YS,kindOfTest:fa,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(lf(e))return e;let t=e.length;if(!VP(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[zS]).call(e);let r;for(;(r=n.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:aW,hasOwnProperty:BP,hasOwnProp:BP,reduceDescriptors:WP,freezeMethods:e=>{WP(e,(t,n)=>{if(Ss(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];Ss(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=i=>{i.forEach(s=>{n[s]=!0})};return lf(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:jP,global:ch,isContextDefined:FP,isSpecCompliantForm:function(e){return!!(e&&Ss(e.append)&&e[MP]==="FormData"&&e[zS])},toJSONObject:e=>{const t=new Array(10),n=(r,i)=>{if(XS(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const s=lf(r)?[]:{};return Eg(r,(o,c)=>{const l=n(o,i+1);!gg(l)&&(s[c]=l)}),t[i]=void 0,s}}return r};return n(e,0)},isAsyncFn:lW,isThenable:e=>e&&(XS(e)||Ss(e))&&Ss(e.then)&&Ss(e.catch),setImmediate:GP,asap:dW,isIterable:e=>e!=null&&Ss(e[zS])};function tn(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Ue.inherits(tn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ue.toJSONObject(this.config),code:this.code,status:this.status}}});const zP=tn.prototype,YP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{YP[e]={value:e}}),Object.defineProperties(tn,YP),Object.defineProperty(zP,"isAxiosError",{value:!0}),tn.from=(e,t,n,r,i,s)=>{const o=Object.create(zP);return Ue.toFlatObject(e,o,function(c){return c!==Error.prototype},c=>c!=="isAxiosError"),tn.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};function Jw(e){return Ue.isPlainObject(e)||Ue.isArray(e)}function qP(e){return Ue.endsWith(e,"[]")?e.slice(0,-2):e}function XP(e,t,n){return e?e.concat(t).map(function(r,i){return r=qP(r),!n&&i?"["+r+"]":r}).join(n?".":""):t}const uW=Ue.toFlatObject(Ue,{},null,function(e){return/^is[A-Z]/.test(e)});function $S(e,t,n){if(!Ue.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Ue.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,y){return!Ue.isUndefined(y[v])})).metaTokens,i=n.visitor||p,s=n.dots,o=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&Ue.isSpecCompliantForm(t);if(!Ue.isFunction(i))throw new TypeError("visitor must be a function");function l(v){if(v===null)return"";if(Ue.isDate(v))return v.toISOString();if(!c&&Ue.isBlob(v))throw new tn("Blob is not supported. Use a Buffer instead.");return Ue.isArrayBuffer(v)||Ue.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function p(v,y,D){let A=v;if(v&&!D&&typeof v=="object"){if(Ue.endsWith(y,"{}"))y=r?y:y.slice(0,-2),v=JSON.stringify(v);else if(Ue.isArray(v)&&function(P){return Ue.isArray(P)&&!P.some(Jw)}(v)||(Ue.isFileList(v)||Ue.endsWith(y,"[]"))&&(A=Ue.toArray(v)))return y=qP(y),A.forEach(function(P,j){!Ue.isUndefined(P)&&P!==null&&t.append(o===!0?XP([y],j,s):o===null?y:y+"[]",l(P))}),!1}return!!Jw(v)||(t.append(XP(D,y,s),l(v)),!1)}const m=[],E=Object.assign(uW,{defaultVisitor:p,convertValue:l,isVisitable:Jw});if(!Ue.isObject(e))throw new TypeError("data must be an object");return function v(y,D){if(!Ue.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+D.join("."));m.push(y),Ue.forEach(y,function(A,P){(!(Ue.isUndefined(A)||A===null)&&i.call(t,A,Ue.isString(P)?ri(P).call(P):P,D,E))===!0&&v(A,D?D.concat(P):[P])}),m.pop()}}(e),t}function JP(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function Qw(e,t){this._pairs=[],e&&$S(e,this,t)}const QP=Qw.prototype;function hW(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $P(e,t,n){if(!t)return e;const r=n&&n.encode||hW;Ue.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(s=i?i(t,n):Ue.isURLSearchParams(t)?t.toString():new Qw(t,n).toString(r),s){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e}QP.append=function(e,t){this._pairs.push([e,t])},QP.toString=function(e){const t=e?function(n){return e.call(this,n,JP)}:JP;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var ZP=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ue.forEach(this.handlers,function(t){t!==null&&e(t)})}},ek={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},tk={exports:{}},pW=qt,fW=He,nk=xi.f;pW({target:"Object",stat:!0,forced:Object.defineProperty!==nk,sham:!fW},{defineProperty:nk});var rk=Qr.Object,mW=tk.exports=function(e,t,n){return rk.defineProperty(e,t,n)};rk.defineProperty.sham&&(mW.sham=!0);var ik=S(tk.exports),_W=TypeError,sk=Qo,gW=Nr,EW=fr,vW=An("species"),ok=Array,SW=function(e){var t;return sk(e)&&(t=e.constructor,(gW(t)&&(t===ok||sk(t.prototype))||EW(t)&&(t=t[vW])===null)&&(t=void 0)),t===void 0?ok:t},ak=function(e,t){return new(SW(e))(t===0?0:t)},yW=T,TW=Ti,CW=An("species"),ck=function(e){return TW>=51||!yW(function(){var t=[];return(t.constructor={})[CW]=function(){return{foo:1}},t[e](Boolean).foo!==1})},wW=qt,RW=T,bW=Qo,IW=fr,AW=Eo,OW=qa,lk=function(e){if(e>9007199254740991)throw _W("Maximum allowed index exceeded");return e},dk=pw,NW=ak,PW=ck,kW=Ti,uk=An("isConcatSpreadable"),DW=kW>=51||!RW(function(){var e=[];return e[uk]=!1,e.concat()[0]!==e}),LW=function(e){if(!IW(e))return!1;var t=e[uk];return t!==void 0?!!t:bW(e)};wW({target:"Array",proto:!0,forced:!DW||!PW("concat")},{concat:function(e){var t,n,r,i,s,o=AW(this),c=NW(o,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(LW(s=t===-1?o:arguments[t]))for(i=OW(s),lk(l+i),n=0;n<i;n++,l++)n in s&&dk(c,l,s[n]);else lk(l+1),dk(c,l++,s);return c.length=l,c}});var hk={},xW=he,MW=ps,pk=Zo.f,UW=Tr,fk=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];hk.f=function(e){return fk&&xW(e)==="Window"?function(t){try{return pk(t)}catch{return UW(fk)}}(e):pk(MW(e))};var df={},VW=An;df.f=VW;var mk=Qr,jW=mr,FW=df,BW=xi.f,Cr=function(e){var t=mk.Symbol||(mk.Symbol={});jW(t,e)||BW(t,e,{value:FW.f(e)})},WW=Ge,GW=Or,HW=An,KW=ca,_k=function(){var e=GW("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=HW("toPrimitive");t&&!t[r]&&KW(t,r,function(i){return WW(n,this)},{})},zW=Ka,YW=vn,qW=Eo,XW=qa,JW=ak,gk=B([].push),QW=function(e){var t=e===1,n=e===2,r=e===3,i=e===4,s=e===6,o=e===7,c=e===5||s;return function(l,p,m,E){for(var v,y,D=qW(l),A=YW(D),P=XW(A),j=zW(p,m),V=0,G=E||JW,Z=t?G(l,P):n||o?G(l,0):void 0;P>V;V++)if((c||V in A)&&(y=j(v=A[V],V,D),e))if(t)Z[V]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return V;case 2:gk(Z,v)}else switch(e){case 4:return!1;case 7:gk(Z,v)}return s?-1:r||i?i:Z}},Ek={forEach:QW(0)},ZS=qt,vg=re,$w=Ge,$W=B,uf=He,hf=_o,ZW=T,mi=mr,eG=Y,Zw=Zr,ey=ps,eR=On,tG=Mi,tR=at,pf=Nu,vk=Ri,nG=Zo,Sk=hk,rG=ql,yk=xe,Tk=xi,iG=tc,Ck=Ie,wk=ca,sG=ic,nR=Bc,Rk=Gs,bk=Nl,oG=An,aG=df,cG=Cr,lG=_k,dG=wo,Ik=rc,ty=Ek.forEach,ys=zl("hidden"),ny="Symbol",Sg="prototype",uG=Ik.set,Ak=Ik.getterFor(ny),ma=Object[Sg],lh=vg.Symbol,ry=lh&&lh[Sg],hG=vg.RangeError,pG=vg.TypeError,rR=vg.QObject,Ok=yk.f,dh=Tk.f,Nk=Sk.f,fG=Ck.f,Pk=$W([].push),cl=nR("symbols"),yg=nR("op-symbols"),mG=nR("wks"),iR=!rR||!rR[Sg]||!rR[Sg].findChild,kk=function(e,t,n){var r=Ok(ma,t);r&&delete ma[t],dh(e,t,n),r&&e!==ma&&dh(ma,t,r)},sR=uf&&ZW(function(){return pf(dh({},"a",{get:function(){return dh(this,"a",{value:7}).a}})).a!==7})?kk:dh,oR=function(e,t){var n=cl[e]=pf(ry);return uG(n,{type:ny,tag:e,description:t}),uf||(n.description=t),n},iy=function(e,t,n){e===ma&&iy(yg,t,n),Zw(e);var r=eR(t);return Zw(n),mi(cl,r)?(n.enumerable?(mi(e,ys)&&e[ys][r]&&(e[ys][r]=!1),n=pf(n,{enumerable:tR(0,!1)})):(mi(e,ys)||dh(e,ys,tR(1,pf(null))),e[ys][r]=!0),sR(e,r,n)):dh(e,r,n)},aR=function(e,t){Zw(e);var n=ey(t),r=vk(n).concat(Mk(n));return ty(r,function(i){uf&&!$w(Dk,n,i)||iy(e,i,n[i])}),e},Dk=function(e){var t=eR(e),n=$w(fG,this,t);return!(this===ma&&mi(cl,t)&&!mi(yg,t))&&(!(n||!mi(this,t)||!mi(cl,t)||mi(this,ys)&&this[ys][t])||n)},Lk=function(e,t){var n=ey(e),r=eR(t);if(n!==ma||!mi(cl,r)||mi(yg,r)){var i=Ok(n,r);return!i||!mi(cl,r)||mi(n,ys)&&n[ys][r]||(i.enumerable=!0),i}},xk=function(e){var t=Nk(ey(e)),n=[];return ty(t,function(r){mi(cl,r)||mi(Rk,r)||Pk(n,r)}),n},Mk=function(e){var t=e===ma,n=Nk(t?yg:ey(e)),r=[];return ty(n,function(i){!mi(cl,i)||t&&!mi(ma,i)||Pk(r,cl[i])}),r};hf||(lh=function(){if(eG(ry,this))throw new pG("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?tG(arguments[0]):void 0,t=bk(e),n=function(r){var i=this===void 0?vg:this;i===ma&&$w(n,yg,r),mi(i,ys)&&mi(i[ys],t)&&(i[ys][t]=!1);var s=tR(1,r);try{sR(i,t,s)}catch(o){if(!(o instanceof hG))throw o;kk(i,t,s)}};return uf&&iR&&sR(ma,t,{configurable:!0,set:n}),oR(t,e)},wk(ry=lh[Sg],"toString",function(){return Ak(this).tag}),wk(lh,"withoutSetter",function(e){return oR(bk(e),e)}),Ck.f=Dk,Tk.f=iy,iG.f=aR,yk.f=Lk,nG.f=Sk.f=xk,rG.f=Mk,aG.f=function(e){return oR(oG(e),e)},uf&&sG(ry,"description",{configurable:!0,get:function(){return Ak(this).description}})),ZS({global:!0,wrap:!0,forced:!hf,sham:!hf},{Symbol:lh}),ty(vk(mG),function(e){cG(e)}),ZS({target:ny,stat:!0,forced:!hf},{useSetter:function(){iR=!0},useSimple:function(){iR=!1}}),ZS({target:"Object",stat:!0,forced:!hf,sham:!uf},{create:function(e,t){return t===void 0?pf(e):aR(pf(e),t)},defineProperty:iy,defineProperties:aR,getOwnPropertyDescriptor:Lk}),ZS({target:"Object",stat:!0,forced:!hf},{getOwnPropertyNames:xk}),lG(),dG(lh,ny),Rk[ys]=!0;var Uk=_o&&!!Symbol.for&&!!Symbol.keyFor,_G=qt,gG=Or,EG=mr,vG=Mi,Vk=Bc,SG=Uk,cR=Vk("string-to-symbol-registry"),yG=Vk("symbol-to-string-registry");_G({target:"Symbol",stat:!0,forced:!SG},{for:function(e){var t=vG(e);if(EG(cR,t))return cR[t];var n=gG("Symbol")(t);return cR[t]=n,yG[n]=t,n}});var TG=qt,CG=mr,wG=Fa,RG=fn,bG=Uk,jk=Bc("symbol-to-string-registry");TG({target:"Symbol",stat:!0,forced:!bG},{keyFor:function(e){if(!wG(e))throw new TypeError(RG(e)+" is not a symbol");if(CG(jk,e))return jk[e]}});var Fk=Qo,IG=Ve,Bk=he,AG=Mi,Wk=B([].push),OG=qt,Gk=Or,Hk=le,NG=Ge,Tg=B,Kk=T,zk=Ve,Yk=Fa,qk=Tr,PG=function(e){if(IG(e))return e;if(Fk(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?Wk(n,i):typeof i!="number"&&Bk(i)!=="Number"&&Bk(i)!=="String"||Wk(n,AG(i))}var s=n.length,o=!0;return function(c,l){if(o)return o=!1,l;if(Fk(this))return l;for(var p=0;p<s;p++)if(n[p]===c)return l}}},kG=_o,DG=String,Ed=Gk("JSON","stringify"),sy=Tg(/./.exec),Xk=Tg("".charAt),LG=Tg("".charCodeAt),xG=Tg("".replace),MG=Tg(1 .toString),UG=/[\uD800-\uDFFF]/g,Jk=/^[\uD800-\uDBFF]$/,Qk=/^[\uDC00-\uDFFF]$/,$k=!kG||Kk(function(){var e=Gk("Symbol")("stringify detection");return Ed([e])!=="[null]"||Ed({a:e})!=="{}"||Ed(Object(e))!=="{}"}),Zk=Kk(function(){return Ed("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ed("\uDEAD")!=='"\\udead"'}),VG=function(e,t){var n=qk(arguments),r=PG(t);if(zk(r)||e!==void 0&&!Yk(e))return n[1]=function(i,s){if(zk(r)&&(s=NG(r,this,DG(i),s)),!Yk(s))return s},Hk(Ed,null,n)},jG=function(e,t,n){var r=Xk(n,t-1),i=Xk(n,t+1);return sy(Jk,e)&&!sy(Qk,i)||sy(Qk,e)&&!sy(Jk,r)?"\\u"+MG(LG(e,0),16):e};Ed&&OG({target:"JSON",stat:!0,forced:$k||Zk},{stringify:function(e,t,n){var r=qk(arguments),i=Hk($k?VG:Ed,null,r);return Zk&&typeof i=="string"?xG(i,UG,jG):i}});var eD=ql,FG=Eo;qt({target:"Object",stat:!0,forced:!_o||T(function(){eD.f(1)})},{getOwnPropertySymbols:function(e){var t=eD.f;return t?t(FG(e)):[]}}),Cr("asyncIterator"),Cr("hasInstance"),Cr("isConcatSpreadable"),Cr("iterator"),Cr("match"),Cr("matchAll"),Cr("replace"),Cr("search"),Cr("species"),Cr("split");var BG=_k;Cr("toPrimitive"),BG();var WG=Or,GG=wo;Cr("toStringTag"),GG(WG("Symbol"),"Symbol"),Cr("unscopables"),wo(re.JSON,"JSON",!0);var HG=Qr.Symbol,KG=An,zG=xi.f,tD=KG("metadata"),nD=Function.prototype;nD[tD]===void 0&&zG(nD,tD,{value:null}),Cr("asyncDispose"),Cr("dispose"),Cr("metadata");var YG=HG,qG=B,lR=Or("Symbol"),XG=lR.keyFor,JG=qG(lR.prototype.valueOf),rD=lR.isRegisteredSymbol||function(e){try{return XG(JG(e))!==void 0}catch{return!1}};qt({target:"Symbol",stat:!0},{isRegisteredSymbol:rD});for(var QG=Bc,iD=Or,$G=B,ZG=Fa,eH=An,oy=iD("Symbol"),sD=oy.isWellKnownSymbol,oD=iD("Object","getOwnPropertyNames"),tH=$G(oy.prototype.valueOf),aD=QG("wks"),dR=0,cD=oD(oy),nH=cD.length;dR<nH;dR++)try{var lD=cD[dR];ZG(oy[lD])&&eH(lD)}catch{}var dD=function(e){if(sD&&sD(e))return!0;try{for(var t=tH(e),n=0,r=oD(aD),i=r.length;n<i;n++)if(aD[r[n]]==t)return!0}catch{}return!1};qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:dD}),Cr("customMatcher"),Cr("observable"),qt({target:"Symbol",stat:!0},{isRegistered:rD}),qt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:dD}),Cr("matcher"),Cr("metadataKey"),Cr("patternMatch"),Cr("replaceAll");var ff=S(YG),uD=S(df.f("iterator"));function Cg(e){return Cg=typeof ff=="function"&&typeof uD=="symbol"?function(t){return typeof t}:function(t){return t&&typeof ff=="function"&&t.constructor===ff&&t!==ff.prototype?"symbol":typeof t},Cg(e)}var rH=S(df.f("toPrimitive"));function iH(e){var t=function(n,r){if(Cg(n)!="object"||!n)return n;var i=n[rH];if(i!==void 0){var s=i.call(n,r);if(Cg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return Cg(t)=="symbol"?t:t+""}function M(e,t,n){return(t=iH(t))in e?ik(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hD=S(iB),sH={isBrowser:!0,classes:{URLSearchParams:hD!==void 0?hD:Qw,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const uR=typeof window<"u"&&typeof document<"u",hR=typeof navigator=="object"&&navigator||void 0,oH=uR&&(!hR||["ReactNative","NativeScript","NS"].indexOf(hR.product)<0),aH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",cH=uR&&window.location.href||"http://localhost";function pD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function fD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pD(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pD(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Wi=fD(fD({},Object.freeze({__proto__:null,hasBrowserEnv:uR,hasStandardBrowserEnv:oH,hasStandardBrowserWebWorkerEnv:aH,navigator:hR,origin:cH})),sH),lH=Zr,dH=Ge,uH=mr,hH=Y,pH=function(){var e=lH(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},mD=RegExp.prototype,_D=function(e){var t=e.flags;return t!==void 0||"flags"in mD||uH(e,"flags")||!hH(mD,e)?t:dH(pH,e)},fH=ZC.charAt,gD=Ge,mH=Zr,_H=Ve,gH=he,EH=/./.exec,vH=TypeError,SH=qt,ED=Ge,vD=Me,yH=Bu,ay=Up,SD=zr,yD=dv,wg=Mi,TH=Zr,CH=fr,wH=he,RH=jm,TD=_D,bH=Xi,IH=T,AH=rl,OH=function(e,t,n){return t+(n?fH(e,t).length:1)},NH=function(e,t){var n=e.exec;if(_H(n)){var r=gD(n,e,t);return r!==null&&mH(r),r}if(gH(e)==="RegExp")return gD(EH,e,t);throw new vH("RegExp#exec called on incompatible receiver")},CD=rc,PH=An("matchAll"),wD="RegExp String",RD=wD+" Iterator",kH=CD.set,DH=CD.getterFor(RD),LH=TypeError,pR=vD("".indexOf),cy=vD("".matchAll),fR=!!cy&&!IH(function(){cy("a",/./)}),xH=yH(function(e,t,n,r){kH(this,{type:RD,regexp:e,string:t,global:n,unicode:r,done:!1})},wD,function(){var e=DH(this);if(e.done)return ay(void 0,!0);var t=e.regexp,n=e.string,r=NH(t,n);return r===null?(e.done=!0,ay(void 0,!0)):e.global?(wg(r[0])===""&&(t.lastIndex=OH(n,yD(t.lastIndex),e.unicode)),ay(r,!1)):(e.done=!0,ay(r,!1))}),bD=function(e){var t,n,r,i=TH(this),s=wg(e),o=AH(i,RegExp),c=wg(TD(i));return t=new o(o===RegExp?i.source:i,c),n=!!~pR(c,"g"),r=!!~pR(c,"u"),t.lastIndex=yD(i.lastIndex),new xH(t,s,n,r)};SH({target:"String",proto:!0,forced:fR},{matchAll:function(e){var t,n,r,i,s=SD(this);if(CH(e)){if(RH(e)&&(t=wg(SD(TD(e))),!~pR(t,"g")))throw new LH("`.matchAll` does not allow non-global regexes");if(fR)return cy(s,e);if((r=bH(e,PH))===void 0&&wH(e)==="RegExp"&&(r=bD),r)return ED(r,e,s)}else if(fR)return cy(s,e);return n=wg(s),i=new RegExp(e,"g"),ED(bD,i,n)}});var MH=Qi("String","matchAll"),UH=Y,VH=MH,mR=String.prototype,jH=function(e){var t=e.matchAll;return typeof e=="string"||e===mR||UH(mR,e)&&t===mR.matchAll?VH:t},FH=S(jH);function ID(e){function t(n,r,i,s){let o=n[s++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),l=s>=n.length;return o=!o&&Ue.isArray(i)?i.length:o,l?(Ue.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!c):(i[o]&&Ue.isObject(i[o])||(i[o]=[]),t(n,r,i[o],s)&&Ue.isArray(i[o])&&(i[o]=function(p){const m={},E=Object.keys(p);let v;const y=E.length;let D;for(v=0;v<y;v++)D=E[v],m[D]=p[D];return m}(i[o])),!c)}if(Ue.isFormData(e)&&Ue.isFunction(e.entries)){const n={};return Ue.forEachEntry(e,(r,i)=>{t(function(s){return FH(Ue).call(Ue,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])}(r),i,n,0)}),n}return null}const _R={transitional:ek,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Ue.isObject(e);if(i&&Ue.isHTMLForm(e)&&(e=new FormData(e)),Ue.isFormData(e))return r?JSON.stringify(ID(e)):e;if(Ue.isArrayBuffer(e)||Ue.isBuffer(e)||Ue.isStream(e)||Ue.isFile(e)||Ue.isBlob(e)||Ue.isReadableStream(e))return e;if(Ue.isArrayBufferView(e))return e.buffer;if(Ue.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(o,c){return $S(o,new Wi.classes.URLSearchParams,Object.assign({visitor:function(l,p,m,E){return Wi.isNode&&Ue.isBuffer(l)?(this.append(p,l.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},c))}(e,this.formSerializer).toString();if((s=Ue.isFileList(e))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return $S(s?{"files[]":e}:e,o&&new o,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(o,c,l){if(Ue.isString(o))try{return(c||JSON.parse)(o),ri(Ue).call(Ue,o)}catch(p){if(p.name!=="SyntaxError")throw p}return(l||JSON.stringify)(o)}(e)):e}],transformResponse:[function(e){const t=this.transitional||_R.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Ue.isResponse(e)||Ue.isReadableStream(e))return e;if(e&&Ue.isString(e)&&(n&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(i)throw s.name==="SyntaxError"?tn.from(s,tn.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wi.classes.FormData,Blob:Wi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ue.forEach(["delete","get","head","post","put","patch"],e=>{_R.headers[e]={}});var gR=_R;const BH=Ue.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),AD=Symbol("internals");function Rg(e){var t;return e&&ri(t=String(e)).call(t).toLowerCase()}function ly(e){return e===!1||e==null?e:Ue.isArray(e)?e.map(ly):String(e)}function ER(e,t,n,r,i){return Ue.isFunction(r)?r.call(this,t,n):(i&&(t=n),Ue.isString(t)?Ue.isString(r)?t.indexOf(r)!==-1:Ue.isRegExp(r)?r.test(t):void 0:void 0)}class dy{constructor(t){t&&this.set(t)}set(t,n,r){const i=this;function s(l,p,m){const E=Rg(p);if(!E)throw new Error("header name must be a non-empty string");const v=Ue.findKey(i,E);(!v||i[v]===void 0||m===!0||m===void 0&&i[v]!==!1)&&(i[v||p]=ly(l))}const o=(l,p)=>Ue.forEach(l,(m,E)=>s(m,E,p));if(Ue.isPlainObject(t)||t instanceof this.constructor)o(t,n);else if(Ue.isString(t)&&(t=ri(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ri(c=t).call(c)))o((l=>{const p={};let m,E,v;return l&&l.split(`
`).forEach(function(y){var D,A;v=y.indexOf(":"),m=ri(D=y.substring(0,v)).call(D).toLowerCase(),E=ri(A=y.substring(v+1)).call(A),!m||p[m]&&BH[m]||(m==="set-cookie"?p[m]?p[m].push(E):p[m]=[E]:p[m]=p[m]?p[m]+", "+E:E)}),p})(t),n);else if(Ue.isObject(t)&&Ue.isIterable(t)){let l,p,m={};for(const E of t){if(!Ue.isArray(E))throw TypeError("Object iterator must return a key-value pair");m[p=E[0]]=(l=m[p])?Ue.isArray(l)?[...l,E[1]]:[l,E[1]]:E[1]}o(m,n)}else t!=null&&s(n,t,r);var c;return this}get(t,n){if(t=Rg(t)){const r=Ue.findKey(this,t);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(s){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=c.exec(s);)o[l[1]]=l[2];return o}(i);if(Ue.isFunction(n))return n.call(this,i,r);if(Ue.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Rg(t)){const r=Ue.findKey(this,t);return!(!r||this[r]===void 0||n&&!ER(0,this[r],r,n))}return!1}delete(t,n){const r=this;let i=!1;function s(o){if(o=Rg(o)){const c=Ue.findKey(r,o);!c||n&&!ER(0,r[c],c,n)||(delete r[c],i=!0)}}return Ue.isArray(t)?t.forEach(s):s(t),i}clear(t){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];t&&!ER(0,this[s],s,t,!0)||(delete this[s],i=!0)}return i}normalize(t){const n=this,r={};return Ue.forEach(this,(i,s)=>{var o;const c=Ue.findKey(r,s);if(c)return n[c]=ly(i),void delete n[s];const l=t?function(p){return ri(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,E,v)=>E.toUpperCase()+v)}(s):ri(o=String(s)).call(o);l!==s&&delete n[s],n[l]=ly(i),r[l]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Ue.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=t&&Ue.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach(o=>n.set(o)),n}static accessor(t){const n=(this[AD]=this[AD]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=Rg(s);n[o]||(function(c,l){const p=Ue.toCamelCase(" "+l);["get","set","has"].forEach(m=>{Object.defineProperty(c,m+p,{value:function(E,v,y){return this[m].call(this,l,E,v,y)},configurable:!0})})}(r,s),n[o]=!0)}return Ue.isArray(t)?t.forEach(i):i(t),this}}dy.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ue.reduceDescriptors(dy.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[r]=i}}}),Ue.freezeMethods(dy);var _a=dy;function vR(e,t){const n=this||gR,r=t||n,i=_a.from(r.headers);let s=r.data;return Ue.forEach(e,function(o){s=o.call(n,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function OD(e){return!(!e||!e.__CANCEL__)}function mf(e,t,n){tn.call(this,e??"canceled",tn.ERR_CANCELED,t,n),this.name="CanceledError"}function ND(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new tn("Request failed with status code "+n.status,[tn.ERR_BAD_REQUEST,tn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Ue.inherits(mf,tn,{__CANCEL__:!0});const uy=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(s,o){s=s||10;const c=new Array(s),l=new Array(s);let p,m=0,E=0;return o=o!==void 0?o:1e3,function(v){const y=Date.now(),D=l[E];p||(p=y),c[m]=v,l[m]=y;let A=E,P=0;for(;A!==m;)P+=c[A++],A%=s;if(m=(m+1)%s,m===E&&(E=(E+1)%s),y-p<o)return;const j=D&&y-D;return j?Math.round(1e3*P/j):void 0}}(50,250);return function(s,o){let c,l,p=0,m=1e3/o;const E=function(v){p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,l&&(clearTimeout(l),l=null),s.apply(null,v)};return[function(){const v=Date.now(),y=v-p;for(var D=arguments.length,A=new Array(D),P=0;P<D;P++)A[P]=arguments[P];y>=m?E(A,v):(c=A,l||(l=setTimeout(()=>{l=null,E(c)},m-y)))},()=>c&&E(c)]}(s=>{const o=s.loaded,c=s.lengthComputable?s.total:void 0,l=o-r,p=i(l);r=o,e({loaded:o,total:c,progress:c?o/c:void 0,bytes:l,rate:p||void 0,estimated:p&&c&&o<=c?(c-o)/p:void 0,event:s,lengthComputable:c!=null,[t?"download":"upload"]:!0})},n)},PD=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},kD=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ue.asap(()=>e(...n))};var WH=Wi.hasStandardBrowserEnv?((e,t)=>n=>(n=new jS(n,Wi.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new jS(Wi.origin),Wi.navigator&&/(msie|trident)/i.test(Wi.navigator.userAgent)):()=>!0,GH=Wi.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const o=[e+"="+encodeURIComponent(t)];Ue.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Ue.isString(r)&&o.push("path="+r),Ue.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function DD(e,t,n){let r=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t);return e&&(r||n==0)?function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i}(e,t):t}function LD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const xD=e=>e instanceof _a?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?LD(Object(r),!0).forEach(function(i){M(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):LD(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e):e;function uh(e,t){t=t||{};const n={};function r(p,m,E,v){return Ue.isPlainObject(p)&&Ue.isPlainObject(m)?Ue.merge.call({caseless:v},p,m):Ue.isPlainObject(m)?Ue.merge({},m):Ue.isArray(m)?m.slice():m}function i(p,m,E,v){return Ue.isUndefined(m)?Ue.isUndefined(p)?void 0:r(void 0,p,0,v):r(p,m,0,v)}function s(p,m){if(!Ue.isUndefined(m))return r(void 0,m)}function o(p,m){return Ue.isUndefined(m)?Ue.isUndefined(p)?void 0:r(void 0,p):r(void 0,m)}function c(p,m,E){return E in t?r(p,m):E in e?r(void 0,p):void 0}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(p,m,E)=>i(xD(p),xD(m),0,!0)};return Ue.forEach(Object.keys(Object.assign({},e,t)),function(p){const m=l[p]||i,E=m(e[p],t[p],p);Ue.isUndefined(E)&&m!==c||(n[p]=E)}),n}var MD=e=>{const t=uh({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:l}=t;if(t.headers=c=_a.from(c),t.url=$P(DD(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&c.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Ue.isFormData(r)){if(Wi.hasStandardBrowserEnv||Wi.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((n=c.getContentType())!==!1){const[p,...m]=n?n.split(";").map(E=>ri(E).call(E)).filter(Boolean):[];c.setContentType([p||"multipart/form-data",...m].join("; "))}}if(Wi.hasStandardBrowserEnv&&(i&&Ue.isFunction(i)&&(i=i(t)),i||i!==!1&&WH(t.url))){const p=s&&o&&GH.read(o);p&&c.set(s,p)}return t},HH=typeof XMLHttpRequest<"u"&&function(e){return new je(function(t,n){const r=MD(e);let i=r.data;const s=_a.from(r.headers).normalize();let o,c,l,p,m,{responseType:E,onUploadProgress:v,onDownloadProgress:y}=r;function D(){p&&p(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let A=new XMLHttpRequest;function P(){if(!A)return;const V=_a.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());ND(function(G){t(G),D()},function(G){n(G),D()},{data:E&&E!=="text"&&E!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:V,config:e,request:A}),A=null}A.open(r.method.toUpperCase(),r.url,!0),A.timeout=r.timeout,"onloadend"in A?A.onloadend=P:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(P)},A.onabort=function(){A&&(n(new tn("Request aborted",tn.ECONNABORTED,e,A)),A=null)},A.onerror=function(){n(new tn("Network Error",tn.ERR_NETWORK,e,A)),A=null},A.ontimeout=function(){let V=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const G=r.transitional||ek;r.timeoutErrorMessage&&(V=r.timeoutErrorMessage),n(new tn(V,G.clarifyTimeoutError?tn.ETIMEDOUT:tn.ECONNABORTED,e,A)),A=null},i===void 0&&s.setContentType(null),"setRequestHeader"in A&&Ue.forEach(s.toJSON(),function(V,G){A.setRequestHeader(G,V)}),Ue.isUndefined(r.withCredentials)||(A.withCredentials=!!r.withCredentials),E&&E!=="json"&&(A.responseType=r.responseType),y&&([l,m]=uy(y,!0),A.addEventListener("progress",l)),v&&A.upload&&([c,p]=uy(v),A.upload.addEventListener("progress",c),A.upload.addEventListener("loadend",p)),(r.cancelToken||r.signal)&&(o=V=>{A&&(n(!V||V.type?new mf(null,e,A):V),A.abort(),A=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const j=function(V){const G=/^([-+\w]{1,25})(:?\/\/|:)/.exec(V);return G&&G[1]||""}(r.url);j&&Wi.protocols.indexOf(j)===-1?n(new tn("Unsupported protocol "+j+":",tn.ERR_BAD_REQUEST,e)):A.send(i||null)})},KH=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,i=new AbortController;const s=function(p){if(!r){r=!0,c();const m=p instanceof Error?p:this.reason;i.abort(m instanceof tn?m:new mf(m instanceof Error?m.message:m))}};let o=t&&setTimeout(()=>{o=null,s(new tn("timeout ".concat(t," of ms exceeded"),tn.ETIMEDOUT))},t);const c=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(p=>{p.unsubscribe?p.unsubscribe(s):p.removeEventListener("abort",s)}),e=null)};e.forEach(p=>p.addEventListener("abort",s));const{signal:l}=i;return l.unsubscribe=()=>Ue.asap(c),l}},SR=S(CO),UD=df.f("asyncIterator"),zH=S(UD);function yR(e,t){this.v=e,this.k=t}function Js(e){return function(){return new bg(e.apply(this,arguments))}}function bg(e){var t,n;function r(s,o){try{var c=e[s](o),l=c.value,p=l instanceof yR;SR.resolve(p?l.v:l).then(function(m){if(p){var E=s==="return"?"return":"next";if(!l.k||m.done)return r(E,m);m=e[E](m).value}i(c.done?"return":"normal",m)},function(m){r("throw",m)})}catch(m){i("throw",m)}}function i(s,o){switch(s){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(s,o){return new SR(function(c,l){var p={key:s,arg:o,resolve:c,reject:l,next:null};n?n=n.next=p:(t=n=p,r(s,o))})},typeof e.return!="function"&&(this.return=void 0)}function jt(e){return new yR(e,0)}function hy(e){var t={},n=!1;function r(i,s){return n=!0,s=new SR(function(o){o(e[i](s))}),{done:!1,value:new yR(s,1)}}return t[ff!==void 0&&uD||"@@iterator"]=function(){return this},t.next=function(i){return n?(n=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return n?(n=!1,i):r("return",i)}),t}bg.prototype[typeof ff=="function"&&zH||"@@asyncIterator"]=function(){return this},bg.prototype.next=function(e){return this._invoke("next",e)},bg.prototype.throw=function(e){return this._invoke("throw",e)},bg.prototype.return=function(e){return this._invoke("return",e)};var TR=S(UD);function CR(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=TR,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new py(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function py(e){function t(n){if(Object(n)!==n)return je.reject(new TypeError(n+" is not an object."));var r=n.done;return je.resolve(n.value).then(function(i){return{value:i,done:r}})}return py=function(n){this.s=n,this.n=n.next},py.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?je.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?je.reject(n):t(r.apply(this.s,arguments))}},new py(e)}const YH=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},qH=function(){var e=Js(function*(t,n){var r,i=!1,s=!1;try{for(var o,c=CR(XH(t));i=!(o=yield jt(c.next())).done;i=!1){const l=o.value;yield*hy(CR(YH(l,n)))}}catch(l){s=!0,r=l}finally{try{i&&c.return!=null&&(yield jt(c.return()))}finally{if(s)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),XH=function(){var e=Js(function*(t){if(t[TR])return void(yield*hy(CR(t)));const n=t.getReader();try{for(;;){const{done:r,value:i}=yield jt(n.read());if(r)break;yield i}}finally{yield jt(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),VD=(e,t,n,r)=>{const i=qH(e,t);let s,o=0,c=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:p,value:m}=await i.next();if(p)return c(),void l.close();let E=m.byteLength;if(n){let v=o+=E;n(v)}l.enqueue(new Uint8Array(m))}catch(p){throw c(p),p}},cancel:l=>(c(l),i.return())},{highWaterMark:2})};function jD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function FD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jD(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jD(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const fy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",BD=fy&&typeof ReadableStream=="function",JH=fy&&(typeof TextEncoder=="function"?(WD=new TextEncoder,e=>WD.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var WD;const GD=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},QH=BD&&GD(()=>{let e=!1;const t=new Request(Wi.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),wR=BD&&GD(()=>Ue.isReadableStream(new Response("").body)),my={stream:wR&&(e=>e.body)};var HD;fy&&(HD=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!my[e]&&(my[e]=Ue.isFunction(HD[e])?t=>t[e]():(t,n)=>{throw new tn("Response type '".concat(e,"' is not supported"),tn.ERR_NOT_SUPPORT,n)})}));const $H=async(e,t)=>{const n=Ue.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:Ue.isBlob(r)?r.size:Ue.isSpecCompliantForm(r)?(await new Request(Wi.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Ue.isArrayBufferView(r)||Ue.isArrayBuffer(r)?r.byteLength:(Ue.isURLSearchParams(r)&&(r+=""),Ue.isString(r)?(await JH(r)).byteLength:void 0))(t)};var ZH=fy&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:l,responseType:p,headers:m,withCredentials:E="same-origin",fetchOptions:v}=MD(e);p=p?(p+"").toLowerCase():"text";let y,D=KH([i,s&&s.toAbortSignal()],o);const A=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let P;try{if(l&&QH&&n!=="get"&&n!=="head"&&(P=await $H(m,r))!==0){let Q,z=new Request(t,{method:"POST",body:r,duplex:"half"});if(Ue.isFormData(r)&&(Q=z.headers.get("content-type"))&&m.setContentType(Q),z.body){const[ie,fe]=PD(P,uy(kD(l)));r=VD(z.body,65536,ie,fe)}}Ue.isString(E)||(E=E?"include":"omit");const j="credentials"in Request.prototype;y=new Request(t,FD(FD({},v),{},{signal:D,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:r,duplex:"half",credentials:j?E:void 0}));let V=await fetch(y);const G=wR&&(p==="stream"||p==="response");if(wR&&(c||G&&A)){const Q={};["status","statusText","headers"].forEach(ve=>{Q[ve]=V[ve]});const z=Ue.toFiniteNumber(V.headers.get("content-length")),[ie,fe]=c&&PD(z,uy(kD(c),!0))||[];V=new Response(VD(V.body,65536,ie,()=>{fe&&fe(),A&&A()}),Q)}p=p||"text";let Z=await my[Ue.findKey(my,p)||"text"](V,e);return!G&&A&&A(),await new je((Q,z)=>{ND(Q,z,{data:Z,headers:_a.from(V.headers),status:V.status,statusText:V.statusText,config:e,request:y})})}catch(j){throw A&&A(),j&&j.name==="TypeError"&&/Load failed|fetch/i.test(j.message)?Object.assign(new tn("Network Error",tn.ERR_NETWORK,e,y),{cause:j.cause||j}):tn.from(j,j&&j.code,e,y)}});const RR={http:null,xhr:HH,fetch:ZH};Ue.forEach(RR,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const KD=e=>"- ".concat(e),eK=e=>Ue.isFunction(e)||e===null||e===!1;var zD={getAdapter:e=>{e=Ue.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let o;if(n=e[s],r=n,!eK(n)&&(r=RR[(o=String(n)).toLowerCase()],r===void 0))throw new tn("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map(o=>{let[c,l]=o;return"adapter ".concat(c," ")+(l===!1?"is not supported by the environment":"is not available in the build")});throw new tn("There is no suitable adapter to dispatch the request "+(t?s.length>1?`since :
`+s.map(KD).join(`
`):" "+KD(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:RR};function bR(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new mf(null,e)}function YD(e){return bR(e),e.headers=_a.from(e.headers),e.data=vR.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),zD.getAdapter(e.adapter||gR.adapter)(e).then(function(t){return bR(e),t.data=vR.call(e,e.transformResponse,t),t.headers=_a.from(t.headers),t},function(t){return OD(t)||(bR(e),t&&t.response&&(t.response.data=vR.call(e,e.transformResponse,t.response),t.response.headers=_a.from(t.response.headers))),je.reject(t)})}const qD="1.9.0",_y={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{_y[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const XD={};_y.transitional=function(e,t,n){function r(i,s){return"[Axios v"+qD+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,o)=>{if(e===!1)throw new tn(r(s," has been removed"+(t?" in "+t:"")),tn.ERR_DEPRECATED);return t&&!XD[s]&&(XD[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,s,o)}},_y.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var gy={assertOptions:function(e,t,n){if(typeof e!="object")throw new tn("options must be an object",tn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],o=t[s];if(o){const c=e[s],l=c===void 0||o(c,s,e);if(l!==!0)throw new tn("option "+s+" must be "+l,tn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new tn("Unknown option "+s,tn.ERR_BAD_OPTION)}},validators:_y};const _c=gy.validators;let Ey=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ZP,response:new ZP}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=uh(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&gy.assertOptions(n,{silentJSONParsing:_c.transitional(_c.boolean),forcedJSONParsing:_c.transitional(_c.boolean),clarifyTimeoutError:_c.transitional(_c.boolean)},!1),r!=null&&(Ue.isFunction(r)?t.paramsSerializer={serialize:r}:gy.assertOptions(r,{encode:_c.function,serialize:_c.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),gy.assertOptions(t,{baseUrl:_c.spelling("baseURL"),withXsrfToken:_c.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&Ue.merge(i.common,i[t.method]);i&&Ue.forEach(["delete","get","head","post","put","patch","common"],y=>{delete i[y]}),t.headers=_a.concat(s,i);const o=[];let c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(c=c&&y.synchronous,o.unshift(y.fulfilled,y.rejected))});const l=[];let p;this.interceptors.response.forEach(function(y){l.push(y.fulfilled,y.rejected)});let m,E=0;if(!c){const y=[YD.bind(this),void 0];for(y.unshift.apply(y,o),y.push.apply(y,l),m=y.length,p=je.resolve(t);E<m;)p=p.then(y[E++],y[E++]);return p}m=o.length;let v=t;for(E=0;E<m;){const y=o[E++],D=o[E++];try{v=y(v)}catch(A){D.call(this,A);break}}try{p=YD.call(this,v)}catch(y){return je.reject(y)}for(E=0,m=l.length;E<m;)p=p.then(l[E++],l[E++]);return p}getUri(e){return $P(DD((e=uh(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ue.forEach(["delete","get","head","options"],function(e){Ey.prototype[e]=function(t,n){return this.request(uh(n||{},{method:e,url:t,data:(n||{}).data}))}}),Ue.forEach(["post","put","patch"],function(e){function t(n){return function(r,i,s){return this.request(uh(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Ey.prototype[e]=t(),Ey.prototype[e+"Form"]=t(!0)});var vy=Ey;class IR{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new je(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new je(c=>{r.subscribe(c),s=c}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},t(function(i,s,o){r.reason||(r.reason=new mf(i,s,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new IR(function(r){t=r}),cancel:t}}}var tK=IR;const AR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(AR).forEach(e=>{let[t,n]=e;AR[n]=t});var nK=AR;const qr=function e(t){const n=new vy(t),r=xP(vy.prototype.request,n);return Ue.extend(r,vy.prototype,n,{allOwnKeys:!0}),Ue.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return e(uh(t,i))},r}(gR);qr.Axios=vy,qr.CanceledError=mf,qr.CancelToken=tK,qr.isCancel=OD,qr.VERSION=qD,qr.toFormData=$S,qr.AxiosError=tn,qr.Cancel=qr.CanceledError,qr.all=function(e){return je.all(e)},qr.spread=function(e){return function(t){return e.apply(null,t)}},qr.isAxiosError=function(e){return Ue.isObject(e)&&e.isAxiosError===!0},qr.mergeConfig=uh,qr.AxiosHeaders=_a,qr.formToJSON=e=>ID(Ue.isHTMLForm(e)?new FormData(e):e),qr.getAdapter=zD.getAdapter,qr.HttpStatusCode=nK,qr.default=qr;var Ai=qr;const rK=()=>{};function Ig(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:rK};return e.promise=new je((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const Sy=new Map,yy=new Map,gc=new Map;let dr=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Wt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const JD=new D2;let ga=JD.getResult(),OR=null;function xt(e){if(!OR){ga=JD.getResult();const t=function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return Wt.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Wt.CHROME;case"Safari":case"Mobile Safari":return Wt.SAFARI;case"Edge":return Wt.EDGE;case"Firefox":return Wt.FIREFOX;case"QQ":case"QQBrowser":return Wt.QQ;case"Opera":return Wt.OPERA;case"WeChat":return Wt.WECHAT;default:return c.browser.name||""}}(ga),n=QD(ga),r=function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""}(ga),i=ga.os.version,s=QD(ga,!1),o=ga.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o};OR={name:t,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o}}return OR}function QD(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function Ty(){return xt().os}function $D(){const e=xt();return"".concat(e.os," ").concat(e.osVersion)}function Cy(){const e=xt();return!!(ga.engine.name==="WebKit"&&e.os===dr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Wt.SAFARI||Xr()&&e.name!==Wt.SAFARI)}function ll(){return xt().name===Wt.CHROME}function Pr(){return xt().name===Wt.SAFARI}function ZD(){const e=xt();if(e.name!==Wt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function eL(){return xt().name===Wt.EDGE}function Nn(){return xt().name===Wt.FIREFOX}function Xr(){return xt().os===dr.IOS}function _f(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)>=e}function tL(e){const t=xt();return!(t.name!==Wt.CHROME||!t.osVersion)&&Number(t.version)<e}function NR(e,t,n){const r=xt();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function PR(e){const t=xt();return!(t.name!==Wt.EDGE||!t.osVersion)&&Number(t.version)>=e}function kR(e){const t=xt();return!(t.name!==Wt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function nL(e){const t=xt();return!(t.name!==Wt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function rL(e,t,n){const r=xt();if(r.os!==dr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function iL(e,t,n){const r=xt();if(r.os!==dr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function DR(e,t,n){const r=xt();if(r.name!==Wt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function LR(e){const t=xt();return!(t.name!==Wt.OPERA||!t.osVersion)&&Number(t.version)>=e}function sL(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function gf(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function xR(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function oL(){const e=xt();if(e.os!==dr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function xo(){return Pr()&&navigator.maxTouchPoints>0}function aL(){return xt().name===Wt.WECHAT}function cL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function MR(){const e=Ty();return function(){const{deviceType:t}=xt();return t==="mobile"||t==="tablet"}()||e===dr.ANDROID||e===dr.IOS||e===dr.HARMONY_OS}function dl(){const e=xt();return e.name!==Wt.EDGE&&e.name!==Wt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function wy(){return Ty()===dr.ANDROID}function Ag(){const e=xt();return wy()&&(e.name===Wt.CHROME||e.name===Wt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function pt(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lL(Object(n),!0).forEach(function(r){pt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let F=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),pe=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),pt(this,"code",void 0),pt(this,"message",void 0),pt(this,"data",void 0),pt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Ea(e,t){if(typeof e!="boolean")throw new pe(F.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ir(e,t,n){if(!Ae(n).call(n,e))throw new pe(F.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function nn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new pe(F.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function UR(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new pe(F.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&nn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&nn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&nn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&nn(e.ideal,"".concat(t,".ideal"),1,1/0)}else nn(e,t,1,1/0)}function wr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new pe(F.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!dL(e,n,r,i))throw new pe(F.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function ul(e,t){if(!Array.isArray(e))throw new pe(F.INVALID_PARAMS,"".concat(t," should be an array"))}function Pn(e){return e==null}function dL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0}(e))}var Og=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Og||{}),VR=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(VR||{});const uL=new class{constructor(){pt(this,"_clientSize",null),pt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),pt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),pt(this,"getStyle",e=>window.getComputedStyle(e,null)),pt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:s,opacity:o,filter:c}=r;return(i==="none"||Ae(t=["hidden","collapse"]).call(t,s)||Number(o)<.1)&&(n=!1),!!n&&(c&&c.split(" ").filter(l=>{var p;const m=l.split("(")[0];return Ae(p=["brightness","blur","opacity"]).call(p,m)}).map(l=>{const[p,m]=l.split(/\(|\)/);return[p,Number(m.match(/^[0-9\.]+/))]}).forEach(l=>{const[p,m]=l;switch(p){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),pt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=o=>t(o);let s=e;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),pt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),pt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:s,bottom:o}=e.getBoundingClientRect(),c=this.getClientWidth(),l=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:s,bottom:o,clientWidth:c,clientHeight:l,clientMin:Math.min(c,l)}}),pt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),pt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),pt(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),pt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,s=t/6,o=[],c=10**6;for(let l=0;l<5;l++)for(let p=0;p<5;p++){const m=(n*c+(l===0?.1:l===4?(i*l*c-1e5)/c:i*l)*c)/c,E=(r*c+(p===0?.1:p===4?(s*p*c-1e5)/c:s*p)*c)/c;o.push({x:m,y:E})}return[...o]}),pt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),pt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),pt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let c,l,p,m;if(e<0)c=0;else{if(!(e<s))return!1;c=e}if(t<0)return!1;if(l=t<s?t:s,n<0)p=0;else{if(!(n<i))return!1;p=n}if(r<0)return!1;m=r<i?r:i;const E=l-c,v=m-p;return this.checkSizeIsVisible(E,v,o)}),pt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),pt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Og.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Og.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Og.SIZE)}}return this.returnHiddenResult(Og.STYLE)}return this.returnHiddenResult(VR.UNMOUNTED)}return this.returnHiddenResult(VR.INVALID_HTML_ELEMENT)}),pt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function jR(e){return new TextEncoder().encode(e)}const hL=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},FR=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",jR(e)),16);class bn{constructor(){pt(this,"_events",{}),pt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],i=this._indexOfListener(r,n);i!==-1&&r.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(o=>o);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];for(let o=0;o<n.length;o+=1){const c=n[o];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(t," error ").concat(o?.toString()))}})}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}let Ng=null;function pL(){if(Ng)return Ng;if(window.electron)return Ng=window.electron;if(!window.require)return null;try{return Ng=window.require("electron"),Ng}catch{return null}}let xn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),Tn=function(e){return e.TRACER="tracer",e}({});function fL(e){return nn(e.timeout,"config.timeout",0,1e5),nn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),nn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),nn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let iK=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Xt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Pg(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function mL(e){return wr(e.turnServerURL,"turnServerURL"),wr(e.username,"username"),wr(e.password,"password"),e.udpport&&nn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Ea(e.forceturn,"forceturn"),e.security&&Ea(e.security,"security"),e.tcpport&&nn(e.tcpport,"tcpport",1,99999,!0),!0}function BR(e){return e.level!==void 0&&ir(e.level,"level",[1,2,3]),e.delay!==void 0&&nn(e.delay,"delay",0,3e3,!0),!0}let Nt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),kr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),os=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Ef=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Dr(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?je.reject(new pe(F.UNEXPECTED_ERROR,"can not emit promise")):new je((s,o)=>{e.emit(t,...r,s,o)})}function sn(e,t){if(e.getListeners(t).length===0)return je.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Dr(e,t,...r)}function Ts(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return kg(e,t,...r)}function kg(e,t){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(e.emit(t,...s,c=>{n=c},c=>{r=c}),r!==null)throw r;if(n===null)throw new pe(F.UNEXPECTED_ERROR,"handler is not sync");return n}const Gn=new class extends bn{set networkState(e){this.emit(Ef.NETWORK_STATE_CHANGE,e,this._networkState),e===os.ONLINE?this.emit(Ef.ONLINE):e===os.OFFLINE&&(this.onlineWaiter=new je(t=>{this.once(Ef.ONLINE,()=>{this.onlineWaiter=void 0,t(os.ONLINE)})}),this.emit(Ef.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===os.ONLINE}constructor(){super(),pt(this,"_moduleName","network-indicator"),pt(this,"_networkState",os.ONLINE),pt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=os.ONLINE}),window.addEventListener("offline",()=>{this.networkState=os.OFFLINE})}};function Ry(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function vf(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function by(e){je!==void 0?je.resolve().then(e):setTimeout(e,0)}function Cn(e){return JSON.parse(JSON.stringify(e))}function hh(e){try{return Cn(e)}catch{return e}}const _L={};function vd(e,t){_L[t]||(_L[t]=!0,e())}function ph(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Sd(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function gL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function EL(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Ui(t).call(t,(o,c)=>o+c.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return t.forEach(o=>{i.set(o,s),s+=o.length}),i}function Ec(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function vL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Ec(n):n.size}),t+138}function sK(e){const t=new pe(F.TIMEOUT,"timeout");return new je((n,r)=>{window.setTimeout(()=>r(t),e)})}function Rr(e){return new je(t=>{window.setTimeout(t,e)})}function on(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+on(e-n.length,"")}function fh(){return on(32,"").toUpperCase()}const Iy=()=>{},SL=new class{constructor(){pt(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(t)){const c=this.fnMap.get(t);if(c.threshold!==n){c.fn(...c.args),clearTimeout(c.timer);const l=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:s,skipFn:r})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(t,Re(Re({},c),{},{fn:e,args:s,skipFn:r}))}else{const c=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:c,args:s,skipFn:r})}}},yL=SL.throttleByKey.bind(SL);function TL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function WR(e,t){if(!TL(e)||!TL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=WR(e[r],t[r]);return n}{const n=Re({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=WR(e[r],t[r]):n[r]=t[r]);return n}}function CL(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function Sf(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function GR(e){return Ui(e).call(e,(t,n)=>t+n,0)}function wL(e){const t="0123456789abcdef";function n(G){let Z,Q="";for(Z=0;Z<=3;Z++)Q+=t.charAt(G>>8*Z+4&15)+t.charAt(G>>8*Z&15);return Q}function r(G,Z){const Q=(65535&G)+(65535&Z);return(G>>16)+(Z>>16)+(Q>>16)<<16|65535&Q}function i(G,Z,Q,z,ie,fe){return r(function(ve,we){return ve<<we|ve>>>32-we}(r(r(Z,G),r(z,fe)),ie),Q)}function s(G,Z,Q,z,ie,fe,ve){return i(Z&Q|~Z&z,G,Z,ie,fe,ve)}function o(G,Z,Q,z,ie,fe,ve){return i(Z&z|Q&~z,G,Z,ie,fe,ve)}function c(G,Z,Q,z,ie,fe,ve){return i(Z^Q^z,G,Z,ie,fe,ve)}function l(G,Z,Q,z,ie,fe,ve){return i(Q^(Z|~z),G,Z,ie,fe,ve)}const p=function(G){let Z;const Q=1+(G.length+8>>6),z=new Array(16*Q);for(Z=0;Z<16*Q;Z++)z[Z]=0;for(Z=0;Z<G.length;Z++)z[Z>>2]|=G.charCodeAt(Z)<<Z%4*8;return z[Z>>2]|=128<<Z%4*8,z[16*Q-2]=8*G.length,z}(e);let m,E,v,y,D,A=1732584193,P=-271733879,j=-1732584194,V=271733878;for(m=0;m<p.length;m+=16)E=A,v=P,y=j,D=V,A=s(A,P,j,V,p[m+0],7,-680876936),V=s(V,A,P,j,p[m+1],12,-389564586),j=s(j,V,A,P,p[m+2],17,606105819),P=s(P,j,V,A,p[m+3],22,-1044525330),A=s(A,P,j,V,p[m+4],7,-176418897),V=s(V,A,P,j,p[m+5],12,1200080426),j=s(j,V,A,P,p[m+6],17,-1473231341),P=s(P,j,V,A,p[m+7],22,-45705983),A=s(A,P,j,V,p[m+8],7,1770035416),V=s(V,A,P,j,p[m+9],12,-1958414417),j=s(j,V,A,P,p[m+10],17,-42063),P=s(P,j,V,A,p[m+11],22,-1990404162),A=s(A,P,j,V,p[m+12],7,1804603682),V=s(V,A,P,j,p[m+13],12,-40341101),j=s(j,V,A,P,p[m+14],17,-1502002290),P=s(P,j,V,A,p[m+15],22,1236535329),A=o(A,P,j,V,p[m+1],5,-165796510),V=o(V,A,P,j,p[m+6],9,-1069501632),j=o(j,V,A,P,p[m+11],14,643717713),P=o(P,j,V,A,p[m+0],20,-373897302),A=o(A,P,j,V,p[m+5],5,-701558691),V=o(V,A,P,j,p[m+10],9,38016083),j=o(j,V,A,P,p[m+15],14,-660478335),P=o(P,j,V,A,p[m+4],20,-405537848),A=o(A,P,j,V,p[m+9],5,568446438),V=o(V,A,P,j,p[m+14],9,-1019803690),j=o(j,V,A,P,p[m+3],14,-187363961),P=o(P,j,V,A,p[m+8],20,1163531501),A=o(A,P,j,V,p[m+13],5,-1444681467),V=o(V,A,P,j,p[m+2],9,-51403784),j=o(j,V,A,P,p[m+7],14,1735328473),P=o(P,j,V,A,p[m+12],20,-1926607734),A=c(A,P,j,V,p[m+5],4,-378558),V=c(V,A,P,j,p[m+8],11,-2022574463),j=c(j,V,A,P,p[m+11],16,1839030562),P=c(P,j,V,A,p[m+14],23,-35309556),A=c(A,P,j,V,p[m+1],4,-1530992060),V=c(V,A,P,j,p[m+4],11,1272893353),j=c(j,V,A,P,p[m+7],16,-155497632),P=c(P,j,V,A,p[m+10],23,-1094730640),A=c(A,P,j,V,p[m+13],4,681279174),V=c(V,A,P,j,p[m+0],11,-358537222),j=c(j,V,A,P,p[m+3],16,-722521979),P=c(P,j,V,A,p[m+6],23,76029189),A=c(A,P,j,V,p[m+9],4,-640364487),V=c(V,A,P,j,p[m+12],11,-421815835),j=c(j,V,A,P,p[m+15],16,530742520),P=c(P,j,V,A,p[m+2],23,-995338651),A=l(A,P,j,V,p[m+0],6,-198630844),V=l(V,A,P,j,p[m+7],10,1126891415),j=l(j,V,A,P,p[m+14],15,-1416354905),P=l(P,j,V,A,p[m+5],21,-57434055),A=l(A,P,j,V,p[m+12],6,1700485571),V=l(V,A,P,j,p[m+3],10,-1894986606),j=l(j,V,A,P,p[m+10],15,-1051523),P=l(P,j,V,A,p[m+1],21,-2054922799),A=l(A,P,j,V,p[m+8],6,1873313359),V=l(V,A,P,j,p[m+15],10,-30611744),j=l(j,V,A,P,p[m+6],15,-1560198380),P=l(P,j,V,A,p[m+13],21,1309151649),A=l(A,P,j,V,p[m+4],6,-145523070),V=l(V,A,P,j,p[m+11],10,-1120210379),j=l(j,V,A,P,p[m+2],15,718787259),P=l(P,j,V,A,p[m+9],21,-343485551),A=r(A,E),P=r(P,v),j=r(j,y),V=r(V,D);return n(A)+n(P)+n(j)+n(V)}let oK=1,RL=console,Fr=class{static setLogger(e){RL=e}constructor(e,t){pt(this,"id",void 0),pt(this,"lockingPromise",je.resolve()),pt(this,"locks",0),pt(this,"name",""),pt(this,"lockId",void 0),this.lockId=oK++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");RL.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new je(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function yf(e,t){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[t];if(!o)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const c=await o.lock("From ".concat(e,".").concat(r));try{for(var l=arguments.length,p=new Array(l),m=0;m<l;m++)p[m]=arguments[m];return await s.apply(this,p)}finally{c()}},i}}const qn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function HR(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function va(e,t,n,r){const i=Object.assign({},qn,r);let s=i.timeout;const o=async()=>{await function(p){return new je(m=>{window.setTimeout(m,p)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let c=!1;const l=new je(async(p,m)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<i.maxRetryCount;E+=1){if(c)return m(new pe(F.OPERATION_ABORTED));try{const v=await e();if(!t(v,E)||E+1===i.maxRetryCount)return p(v);await o()}catch(v){if(!n(v,E)||E+1===i.maxRetryCount)return m(v);await o()}}});return l.cancel=()=>c=!0,l}let Ay,bL=class{constructor(e){pt(this,"input",[]),pt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ui(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},Oy=0,KR=0;function zR(e,t,n,r){return new je((i,s)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Oy+=Ec(t.data)):n&&(t.data.size?Oy+=t.data.size:t.data instanceof FormData?Oy+=vL(t.data):Oy+=Ec(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ai.request(t).then(o=>{typeof o.data=="string"?KR+=Ec(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?KR+=o.data.byteLength:KR+=Ec(JSON.stringify(o.data)),i(o.data)}).catch(o=>{Ai.isCancel(o)?s(new pe(F.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new pe(F.NETWORK_TIMEOUT,o.message)):o.response?s(new pe(F.NETWORK_RESPONSE_ERROR,o.response.status)):s(new pe(F.NETWORK_ERROR,o.message))})})}async function aK(e,t){const n=new Blob([t.data],{type:"buffer"});return await zR(e,Re(Re({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const IL=()=>window.isSecureContext!==void 0;function Mo(e){if(Array.isArray(e))return e.map(n=>n);if(!AL(e))return e;const t={};for(const n in e){const r=e[n];AL(r)||Array.isArray(r)?t[n]=Mo(r):t[n]=r}return t}function AL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let YR=class{constructor(e){pt(this,"input",[]),pt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const vc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Dg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:vc,remoteCandidate:vc},updateInterval:0},OL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},NL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},PL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},kL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let qR=class{constructor(e,t){pt(this,"onFirstVideoReceived",void 0),pt(this,"onFirstVideoDecoded",void 0),pt(this,"onFirstAudioReceived",void 0),pt(this,"onFirstVideoDecodedTimeout",void 0),pt(this,"onFirstAudioDecoded",void 0),pt(this,"onSelectedLocalCandidateChanged",void 0),pt(this,"onSelectedRemoteCandidateChanged",void 0),pt(this,"videoIsReady",!1),pt(this,"videoIsReady2",{}),pt(this,"pc",void 0),pt(this,"options",void 0),pt(this,"intervalTimer",void 0),pt(this,"stats",Mo(Dg)),pt(this,"isFirstVideoReceived",{}),pt(this,"isFirstVideoDecoded",{}),pt(this,"isFirstAudioReceived",{}),pt(this,"isFirstAudioDecoded",{}),pt(this,"isFirstVideoDecodedTimeout",{}),pt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new je(e=>{e({local:Re({},vc),remote:Re({},vc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,s=0,o=0;for(const c of n)e[c].forEach((l,p)=>{if(!this.lossRateWindowStats[t-1][c][p]||!this.lossRateWindowStats[0][c][p])return;const m=this.lossRateWindowStats[t-1][c][p].packets-this.lossRateWindowStats[0][c][p].packets,E=this.lossRateWindowStats[t-1][c][p].packetsLost-this.lossRateWindowStats[0][c][p].packetsLost;c==="videoSend"||c==="audioSend"?(r+=m,s+=E):(i+=m,o+=E),Number.isNaN(m)||Number.isNaN(m)?l.packetLostRate=0:l.packetLostRate=m<=0||E<=0?0:E/(m+E)});e.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},cK=class extends qR{constructor(){super(...arguments),pt(this,"_stats",Dg),pt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Mo(Dg);const n=t.filter(i=>i.type==="ssrc");this.processSSRCStats(n);const r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const r=Ae(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=Mo(NL);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=Mo(OL),s=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){const o=s.stats,c=Date.now()-s.lts;i.framesDecodeFreezeTime=o.framesDecodeFreezeTime,i.framesDecodeInterval=o.framesDecodeInterval,i.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=c,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:Re({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=Mo(kL);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=Mo(PL);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new je((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(i=>{r[i]=n.stat(i)}),t.push(r)}),t}},Lg=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Ny=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),XR=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Cs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Tf=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Tf||{});function xg(e,t,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Tf.kNone;if(!t)return;const s=Number(t[n]);if(typeof s!="number")return;const o=Number(t[r]);if(typeof o!="number")return;if(!e)return o?s/o*i:void 0;const c=Number(e[n]);if(typeof c!="number")return;const l=Number(e[r]);if(typeof l!="number")return;const p=o-l;return p?(s-c)/p*i:void 0}let DL=class extends qR{constructor(){super(...arguments),pt(this,"_stats",Dg),pt(this,"report",void 0),pt(this,"lastDecodeVideoReceiverStats",new Map),pt(this,"lastVideoFramesRecv",new Map),pt(this,"lastVideoFramesSent",new Map),pt(this,"lastVideoFramesDecode",new Map),pt(this,"lastVideoFramesOutput",new Map),pt(this,"lastVideoJBDelay",new Map),pt(this,"lastAudioJBDelay",new Map),pt(this,"mediaBytesSent",new Map),pt(this,"mediaBytesRetransmit",new Map),pt(this,"mediaBytesTargetEncode",new Map),pt(this,"lastDecodeAudioReceiverStats",new Map),pt(this,"lastAudioConcealment",new Map),pt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Mo(Dg),this.report.forEach(e=>{switch(e.type){case Cs.OUTBOUND:case Cs.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Cs.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Cs.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Cs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Cs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Re({},vc),remote:Re({},vc)};return e.forEach(n=>{let r;if(n.type===Cs.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===Cs.CANDIDATE_PAIR&&n.selected&&(r=n),r){const i=(s,o)=>{s.type=o.type,s.id=o.id,o.address&&(s.address=o.address),o.candidateType&&(s.candidateType=o.candidateType),o.port&&(s.port=o.port),o.priority&&(s.priority=o.priority),o.protocol&&(s.protocol=o.protocol),o.relayProtocol&&(s.relayProtocol=o.relayProtocol)};if(r.localCandidateId){const s=e.get(r.localCandidateId);s&&i(t.local,s)}if(r.remoteCandidateId){const s=e.get(r.remoteCandidateId);s&&i(t.remote,s)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Cs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Cs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Cs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Re({},t),Re({},this.stats.selectedCandidatePair.localCandidate)),e.type===Cs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Re({},t),Re({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=Mo(kL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=xg(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Tf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Re({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,s=n.timestamp,o=s-i;if(o<=0)return;const c=e.concealedSamples-t.concealedSamples-0,l=r.nonSilent+c,p=e.totalSamplesReceived-t.totalSamplesReceived;if(p<=0)return;const m=80*p/o,E=200*p/o,v=o/p;let y=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,l>m&&(r.plc80>0?(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*v)):(e.freezeSamples80+=l,e.freezeMs80+=Math.round(l*v)),y=r.plc80+1);let D=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,l>E&&(r.plc200>0?(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*v)):(e.freezeSamples200+=l,e.freezeMs200+=Math.round(l*v)),D=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:c,lts:s,plc80:y,plc200:D})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(o=>o.ssrc===e.ssrc);t||(t=Mo(OL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),s=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const o=t.decodedFrame?t.decodedFrame.width:0,c=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,o,c),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const o=n.stats,c=s-n.lts;t.framesDecodeFreezeTime=o.framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=c,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=xg(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=xg(n?.stats,t,"totalProcessingDelay","framesDecodeCount",Tf.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=xg(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Tf.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=xg(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",Tf.kMillisecondsFromSeconds),r&&s-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:s,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&s-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Re({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Mo(NL),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new YR(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new YR(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new YR(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,s=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*s/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Cs.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Mo(PL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Cs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(rs(n=this.report).call(n)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=c?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof l!="number")return;let p=(i=c?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,m=(s=c?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,E=(o=c?.framesPerSecond)!==null&&o!==void 0?o:e.framesPerSecond;if(typeof p=="number"&&typeof m=="number"||(p=0,m=0),E==null){const v=Date.now(),y=this.lastVideoFramesSent.get(n.ssrc);y&&v-y.lts>=800?(E=Math.round((l-y.count)/((v-y.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:v,rate:E})):y?E=y.rate:this.lastVideoFramesSent.set(n.ssrc,{count:l,lts:v,rate:0})}n.sentFrame={width:p,height:m,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,n){var r,i,s,o,c;const l=t?this.report.get(t):void 0,p=(r=l?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,m=(i=l?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,E=(s=l?.frameHeight)!==null&&s!==void 0?s:e.frameHeight,v=(o=l?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,y=(c=l?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount;if(typeof p=="number"){const D=this.lastVideoFramesRecv.get(n.ssrc),A=Date.now();n.framesReceivedCount=p;let P=0;D&&A-D.lts>=800?(P=Math.round((p-D.count)/((A-D.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:P})):D?P=D.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:0}),n.receivedFrame={width:m||0,height:E||0,frameRate:P||0},n.decodedFrame={width:m||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(v&&y){const D=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=D.jitterBufferMs;const P=y-D.jitterBufferEmittedCount;P>0&&(A=1e3*(v-D.jitterBufferDelay)/P),n.jitterBufferMs=A,n.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,s,o;const c=t?this.report.get(t):void 0,l=(r=(i=c?.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,p=(s=(o=c?.echoReturnLossEnhancement)!==null&&o!==void 0?o:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=l,n.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(e,t,n){var r,i,s,o,c,l,p,m,E;const v=t?this.report.get(t):void 0,y=(r=v?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,D=(i=v?.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,A=(s=v?.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,P=(o=v?.jitterBufferEmittedCount)!==null&&o!==void 0?o:e.jitterBufferEmittedCount,j=(c=v?.audioLevel)!==null&&c!==void 0?c:e?.audioLevel,V=(l=v?.totalSamplesDuration)!==null&&l!==void 0?l:e?.totalSamplesDuration,G=(p=v?.concealedSamples)!==null&&p!==void 0?p:e.concealedSamples,Z=(m=v?.silentConcealedSamples)!==null&&m!==void 0?m:e.silentConcealedSamples,Q=(E=v?.concealmentEvents)!==null&&E!==void 0?E:e.concealmentEvents;if(typeof D=="number"&&(n.totalSamplesReceived=D),typeof Z=="number"&&(n.silentConcealedSamples=Z),typeof Q=="number"&&(n.concealmentEvents=Q),typeof G=="number"&&(n.concealedSamples=G),y&&D&&(n.accelerateRate=y/D),A&&P){const ie=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let fe=ie.jitterBufferMs;const ve=P-ie.jitterBufferEmittedCount;ve>0&&(fe=1e3*(A-ie.jitterBufferDelay)/ve),n.jitterBufferMs=Math.round(fe),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:P,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=j;let z=1920;V&&D&&(z=D/V/50,n.receivedFrames=Math.round(D/z)),G&&(n.droppedFrames=Math.round(G/z))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{n=n===null?i.diffMean():n+i.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},lK=class extends qR{updateStats(){return je.resolve()}};function JR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return s?s<76?new cK(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new DL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(o){if(!window.RTCStatsReport)return!1;const c=o.getStats();return!!(c instanceof je||function(l){return!!l&&(typeof l=="object"||typeof l=="function")&&typeof l.then=="function"}(c))}(e)?new DL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new lK(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const LL="websdk_ng_install_id";function QR(){try{if(W("INSTALL_ID"))return W("INSTALL_ID");let e=window.localStorage.getItem(LL);return e||(e=fh(),window.localStorage.setItem(LL,e)),Zt("INSTALL_ID",e),e}catch{return}}const Qs=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.24.0"),$R=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let mh=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Lr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let c=0;c<6;c++)i.push("1");const s=i.join(""),o={};return o[e]=r,o[t]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Lr;const Py={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},ZR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},eb="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",tb={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Sn=Re(Re(Re(Re({},tb),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:ZR,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Py),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Zt(e,t,n){var r,i,s;Ae(r=Object.keys(Sn)).call(r,e)&&(!n&&Ae(i=Object.keys(Sa)).call(i,e)||(Sn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Sn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(s=!!t,Sn.USE_NEW_NETWORK_CONFIG=s,s&&(Sn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Sn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Sn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Sn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Sn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Sn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Sn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Sn.ENABLE_INSTANT_VIDEO=!0,Sn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Sn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Sn.NEW_TURN_MODE||(Sn.NEW_TURN_MODE=4))))}function W(e){return Sn[e]}$R||(Sn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Sn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Sn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Sn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Sn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Sn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Sn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Sn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Sn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Sn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Sn.AREAS=["NORTH_AMERICA","OVERSEA"]);let xL=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Sa={};var ft=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ft||{});let Mg=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const ML=128,dK=96,UL=1e3,Cf=10;let uK=0;var VL=(()=>{var e={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>ve,Printer:()=>Yt,parse:()=>Ne,print:()=>Ke});const o=`
`,c="".concat("\r").concat(o),l=" ";let p;function m(Se){return Se>="0"&&Se<="9"}function E(Se){return Se>="!"&&Se<="~"}function v(Se){return E(Se)||Se>=""&&Se<=""}function y(Se){return Se==="!"||Se>="#"&&Se<="'"||Se>="*"&&Se<="+"||Se>="-"&&Se<="."||Se>="0"&&Se<="9"||Se>="A"&&Se<="Z"||Se>="^"&&Se<="~"}function D(Se){return Se>="1"&&Se<="9"}function A(Se){return Se>="A"&&Se<="Z"||Se>="a"&&Se<="z"}function P(Se){return Se==="d"||Se==="h"||Se==="m"||Se==="s"}function j(Se){return Se>""&&Se<"	"||Se>"\v"&&Se<"\f"||Se>""&&Se<""}function V(Se){return A(Se)||m(Se)||Se==="+"||Se==="/"}function G(Se){return m(Se)||A(Se)||Se==="+"||Se==="/"||Se==="-"||Se==="_"}function Z(Se){return A(Se)||m(Se)||Se==="+"||Se==="/"}function Q(Se,b){var K=Object.keys(Se);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(Se);b&&(J=J.filter(function(be){return Object.getOwnPropertyDescriptor(Se,be).enumerable})),K.push.apply(K,J)}return K}function z(Se){for(var b=1;b<arguments.length;b++){var K=arguments[b]!=null?arguments[b]:{};b%2?Q(Object(K),!0).forEach(function(J){ie(Se,J,K[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Se,Object.getOwnPropertyDescriptors(K)):Q(Object(K)).forEach(function(J){Object.defineProperty(Se,J,Object.getOwnPropertyDescriptor(K,J))})}return Se}function ie(Se,b,K){return b in Se?Object.defineProperty(Se,b,{value:K,enumerable:!0,configurable:!0,writable:!0}):Se[b]=K,Se}(function(Se){Se.VERSION="v",Se.ORIGIN="o",Se.SESSION_NAME="s",Se.INFORMATION="i",Se.URI="u",Se.EMAIL="e",Se.PHONE="p",Se.CONNECTION="c",Se.BANDWIDTH="b",Se.TIME="t",Se.REPEAT="r",Se.ZONE_ADJUSTMENTS="z",Se.KEY="k",Se.ATTRIBUTE="a",Se.MEDIA="m"})(p||(p={}));class fe{consumeText(b,K){let J=K;for(;J<b.length;){const be=b[J];if(be==="\0"||be==="\r"||be===o)break;J+=1}if(J-K==0)throw new Error("Invalid text, at ".concat(b));return J}consumeUnicastAddress(b,K,J){return this.consumeTill(b,K,l)}consumeOneOrMore(b,K,J){let be=K;for(;J(b[be]);)be++;if(be-K==0)throw new Error("Invalid rule at ".concat(K,"."));return be}consumeSpace(b,K){if(b[K]===l)return K+1;throw new Error("Invalid space at ".concat(K,"."))}consumeIP4Address(b,K){let J=K;for(let be=0;be<4;be++)if(J=this.consumeDecimalUChar(b,J),be!==3){if(b[J]!==".")throw new Error("Invalid IP4 address.");J++}return J}consumeDecimalUChar(b,K){let J=K;for(let gt=0;gt<3&&m(b[J]);gt++,J++);if(J-K==0)throw new Error("Invalid decimal uchar.");const be=parseInt(b.slice(K,J));if(be>=0&&be<=255)return J;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,K){let J=this.consumeHexpart(b,K);return b[J]===":"&&(J+=1,J=this.consumeIP4Address(b,J)),J}consumeHexpart(b,K){let J=K;if(b[J]===":"&&b[J+1]===":"){J+=2;try{J=this.consumeHexseq(b,J)}catch{}return J}if(J=this.consumeHexseq(b,J),b[J]===":"&&b[J+1]===":"){J+=2;try{J=this.consumeHexseq(b,J)}catch{}return J}return J}consumeHexseq(b,K){let J=K;for(;J=this.consumeHex4(b,J),b[J]===":"&&b[J+1]!==":";)J+=1;return J}consumeHex4(b,K){let J=0;for(;J<4;J++)if(!((be=b[K+J])>="0"&&be<="9"||be>="a"&&be<="f"||be>="A"&&be<="F")){if(J===0)throw new Error("Invalid hex 4");break}var be;return K+J}consumeFQDN(b,K){let J=K;for(;m(b[J])||A(b[J])||b[J]==="-"||b[J]===".";)J+=1;if(J-K<4)throw new Error("Invalid FQDN");return J}consumeExtnAddr(b,K){return this.consumeOneOrMore(b,K,v)}consumeMulticastAddress(b,K,J){switch(J){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,K);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,K);default:try{return this.consumeFQDN(b,K)}catch{return this.consumeExtnAddr(b,K)}}}consumeIP6MulticastAddress(b,K){const J=this.consumeHexpart(b,K);return b[J]==="/"?this.consumeInteger(b,J+1):J}consumeIP4MulticastAddress(b,K){let J=K+3;const be=b.slice(K,J),gt=parseInt(be);if(gt<224||gt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dn=0;dn<3;dn++){if(b[J]!==".")throw new Error("Invalid IP4 multicast address.");J+=1,J=this.consumeDecimalUChar(b,J)}return b[J]==="/"&&(J+=1),J=this.consumeTTL(b,J),b[J]==="/"&&(J=this.consumeInteger(b,J)),J}consumeInteger(b,K){if(!D(b[K]))throw new Error("Invalid integer.");for(K+=1;m(b[K]);)K+=1;return K}consumeTTL(b,K){if(b[K]==="0")return K+1;if(!D(b[K]))throw new Error("Invalid TTL.");K+=1;for(let J=0;J<2&&m(b[K]);J++)K+=1;return K}consumeToken(b,K){return this.consumeOneOrMore(b,K,y)}consumeTime(b,K){let J=K;if(b[J]==="0")return J+1;for(D(b[J])&&(J+=1);m(b[J]);)J++;if(J-K<10)throw new Error("Invalid time");return J}consumeAddress(b,K){return this.consumeTill(b,K,l)}consumeTypedTime(b,K){let J=K;return J=this.consumeOneOrMore(b,J,m),P(b[J])?J+1:J}consumeRepeatInterval(b,K){if(!D(b[K]))throw new Error("Invalid repeat interval");for(K+=1;m(b[K]);)K+=1;return P(b[K])&&(K+=1),K}consumePort(b,K){return this.consumeOneOrMore(b,K,m)}consume(b,K,J){for(let be=0;be<J.length;be++){if(K+be>=b.length)throw new Error("consume exceeding value length");if(b[K+be]!==J[be])throw new Error("consume ".concat(J," failed at ").concat(be))}return K+J.length}consumeTill(b,K,J){let be=K;for(;be<b.length&&(typeof J!="string"||b[be]!==J)&&(typeof J!="function"||!J(b[be]));)be++;return be}}class ve extends fe{constructor(){super(),ie(this,"records",[]),ie(this,"currentLine",0)}parse(b){const K=this.probeEOL(b);this.records=b.split(K).filter(Sl=>!!ri(Sl).call(Sl)).map(this.parseLine),this.currentLine=0;const J=this.parseVersion(),be=this.parseOrigin(),gt=this.parseSessionName(),dn=this.parseInformation(),tr=this.parseUri(),oo=this.parseEmail(),qo=this.parsePhone(),SE=this.parseConnection(),xh=this.parseBandWidth(),tm=this.parseTimeFields(),KT=this.parseKey(),zT=this.parseSessionAttribute(),ao=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:J,origin:be,sessionName:gt,information:dn,uri:tr,emails:oo,phones:qo,connection:SE,bandwidths:xh,timeFields:tm,key:KT,attributes:zT,mediaDescriptions:ao}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let K=0;K<b.length;K++)if(b[K]===o)return b[K-1]==="\r"?c:o;throw new Error("Invalid newline character.")}parseLine(b,K){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const J=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:J,value:b.slice(2),line:K,cur:0}}parseSessionAttribute(){const b=new Ct;for(;this.currentLine<this.records.length;){const K=this.getCurrentRecord();if(K.type!==p.ATTRIBUTE)break;const J={attField:this.extractOneOrMore(K,be=>y(be)&&be!==":"),_cur:0};K.value[K.cur]===":"&&(K.cur+=1,J.attValue=this.extractOneOrMore(K,j)),b.parse(J),this.currentLine++}return b.digest()}parseMediaAttributes(b){const K=new bt(b);for(;this.currentLine<this.records.length;){const J=this.getCurrentRecord();if(J.type!==p.ATTRIBUTE)break;const be={attField:this.extractOneOrMore(J,gt=>y(gt)&&gt!==":"),_cur:0};J.value[J.cur]===":"&&(J.cur+=1,be.attValue=this.extractOneOrMore(J,j)),K.parse(be),this.currentLine++}return K.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===p.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===p.ZONE_ADJUSTMENTS){const K=[];for(;;)try{const J=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let be=!1;b.value[b.cur]==="-"&&(be=!0,b.cur+=1);const gt=this.extract(b,this.consumeTypedTime);K.push({time:J,typedTime:gt,back:be})}catch{break}if(K.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,K}return[]}parseRepeat(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==p.REPEAT)break;{const J=this.extract(K,this.consumeRepeatInterval),be=this.parseTypedTime(K);b.push({repeatInterval:J,typedTimes:be}),this.currentLine++}}return b}parseTypedTime(b){const K=[];for(;;)try{this.consumeSpaceForRecord(b),K.push(this.extract(b,this.consumeTypedTime))}catch{break}if(K.length===0)throw new Error("Invalid typed time.");return K}parseTime(){const b=this.getCurrentRecord(),K=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const J=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:K,stopTime:J}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const K=this.getCurrentRecord();if(K.type!==p.BANDWIDTH)break;{const J=this.extractOneOrMore(K,y);if(K.value[K.cur]!==":")throw new Error("Invalid bandwidth field.");K.cur++;const be=this.extractOneOrMore(K,m);b.push({bwtype:J,bandwidth:be}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==p.VERSION)throw new Error("first sdp record must be version");const K=b.value.slice(0,this.consumeOneOrMore(b.value,0,m));if(K.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,K}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==p.ORIGIN)throw new Error("second line of sdp must be origin");const K=this.extractOneOrMore(b,v);this.consumeSpaceForRecord(b);const J=this.extractOneOrMore(b,m);this.consumeSpaceForRecord(b);const be=this.extractOneOrMore(b,m);this.consumeSpaceForRecord(b);const gt=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const dn=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const tr=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:K,sessId:J,sessVersion:be,nettype:gt,addrtype:dn,unicastAddress:tr}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===p.SESSION_NAME){const K=this.extract(b,this.consumeText);return this.currentLine++,K}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==p.INFORMATION)return;const K=this.extract(b,this.consumeText);return this.currentLine++,K}parseUri(){const b=this.getCurrentRecord();if(b.type===p.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==p.EMAIL)break;b.push(K.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const K=this.getCurrentRecord();if(K.type!==p.PHONE)break;b.push(K.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===p.CONNECTION){const K=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const J=this.extractOneOrMore(b,y);this.consumeSpaceForRecord(b);const be=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:K,addrtype:J,address:be}}}parseMedia(){const b=this.getCurrentRecord(),K=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let J=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,J+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const be=[];for(be.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,be.push(this.extract(b,this.consumeToken));if(be.length===0)throw new Error("Invalid proto");const gt=this.parseFmt(b);return this.currentLine++,{mediaType:K,port:J,protos:be,fmts:gt}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===p.TIME;){const K=this.parseTime(),J=this.parseRepeat(),be=this.parseZone();b.push({time:K,repeats:J,zones:be})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.MEDIA;){const K=this.parseMedia(),J=this.parseInformation(),be=this.parseConnections(),gt=this.parseBandWidth(),dn=this.parseKey(),tr=this.parseMediaAttributes(K);b.push({media:K,information:J,connections:be,bandwidths:gt,key:dn,attributes:tr})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const K=[];for(;;)try{this.consumeSpaceForRecord(b),K.push(this.extract(b,this.consumeToken))}catch{break}if(K.length===0)throw new Error("Invalid fmts");return K}extract(b,K){for(var J=arguments.length,be=new Array(J>2?J-2:0),gt=2;gt<J;gt++)be[gt-2]=arguments[gt];const dn=K.call(this,b.value,b.cur,...be),tr=b.value.slice(b.cur,dn);return b.cur=dn,tr}extractOneOrMore(b,K){const J=this.consumeOneOrMore(b.value,b.cur,K),be=b.value.slice(b.cur,J);return b.cur=J,be}consumeSpaceForRecord(b){if(b.value[b.cur]!==l)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class we extends fe{constructor(){super(...arguments),ie(this,"attributes",void 0),ie(this,"digested",!1)}extractOneOrMore(b,K,J){const be=this.consumeOneOrMore(b.attValue,b._cur,K),gt=b.attValue.slice(b._cur,be),[dn,tr]=J||[];if(typeof dn=="number"&&gt.length<dn)throw new Error("error in length, should be more or equal than ".concat(dn," characters."));if(typeof tr=="number"&&gt.length>tr)throw new Error("error in length, should be less or equal than ".concat(tr," characters."));return b._cur=be,gt}consumeAttributeSpace(b){if(b.attValue[b._cur]!==l)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,K){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var J=arguments.length,be=new Array(J>2?J-2:0),gt=2;gt<J;gt++)be[gt-2]=arguments[gt];const dn=K.call(this,b.attValue,b._cur,...be),tr=b.attValue.slice(b._cur,dn);return b._cur=dn,tr}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,K){if(!b.attValue)throw new Error;for(let J=0;J<K.length;J++)if(K[J]!==b.attValue[b._cur+J])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,V,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,V,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const K=[];for(;!this.atEnd(b);){K.push(this.extractOneOrMore(b,V));try{this.consumeAttributeSpace(b)}catch(J){if(this.atEnd(b))break;throw J}}this.attributes.iceOptions=K}parseFingerprint(b){const K=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:K,fingerprint:J})}parseExtmap(b){const K=this.extractOneOrMore(b,m);let J;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),J=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeTill,l),gt=z(z({entry:parseInt(K,10)},J&&{direction:J}),{},{extensionName:be});this.peekChar(b)===l&&(this.consumeAttributeSpace(b),gt.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push(gt)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const K=this.extract(b,this.consumeTill);if(K!=="active"&&K!=="passive"&&K!=="actpass"&&K!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=K}}class Ct extends we{constructor(){super(...arguments),ie(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(K){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),K}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const K=this.extract(b,this.consumeToken),J=[];for(;!this.atEnd(b)&&this.peekChar(b)===l;)this.consumeAttributeSpace(b),J.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:K,identificationTag:J})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,G)}parseIdentity(b){const K=this.extractOneOrMore(b,Z),J=[];for(;!this.atEnd(b)&&this.peekChar(b)===l;){this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const gt=this.extractOneOrMore(b,dn=>dn!==l&&j(dn));J.push({name:be,value:gt})}this.attributes.identities.push({assertionValue:K,extensions:J})}parseMsidSemantic(b){this.peekChar(b)===l&&this.consumeAttributeSpace(b);const K={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),K.applyForAll=!0;break}{const J=this.extract(b,this.consumeTill,l);K.identifierList.push(J)}}this.attributes.msidSemantic=K}}class bt extends we{constructor(b){super(),ie(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(K){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),K}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const K=this.extractOneOrMore(b,V,[1,32]);this.consumeAttributeSpace(b);const J=this.extractOneOrMore(b,m,[1,5]);this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const gt=this.extractOneOrMore(b,m,[1,10]);this.consumeAttributeSpace(b);const dn=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const tr=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const oo={foundation:K,componentId:J,transport:be,priority:gt,connectionAddress:dn,port:tr,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),oo.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),oo.relPort=this.extract(b,this.consumePort));this.peekChar(b)===l;){this.consumeAttributeSpace(b);const qo=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),oo.extension[qo]=this.extractOneOrMore(b,E)}this.attributes.candidates.push(oo)}parseRemoteCandidate(b){const K=[];for(;;){const J=this.extractOneOrMore(b,m,[1,5]);this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const gt=this.extract(b,this.consumePort);K.push({componentId:J,connectionAddress:be,port:gt});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(K)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const K=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const be={encodingName:J,clockRate:this.extractOneOrMore(b,m)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),be.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(K,10));gt?gt.rtpMap=be:this.attributes.payloads.push({payloadType:parseInt(K,10),rtpMap:be,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const K=this.extractOneOrMore(b,m);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill,":");let be;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),be=this.extract(b,this.consumeTill));const gt=this.attributes.ssrcs.find(dn=>dn.ssrcId===parseInt(K,10));gt?gt.attributes[J]=be:this.attributes.ssrcs.push({ssrcId:parseInt(K,10),attributes:{[J]:be}})}parseFmtp(b){const K=this.extract(b,this.consumeTill,l);this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill),be={};J.split(";").forEach(dn=>{let[tr,oo]=dn.split("=");tr=ri(tr).call(tr);const qo=typeof oo=="string"?ri(oo).call(oo):null;typeof tr=="string"&&tr.length>0&&(be[tr]=qo)});const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(K,10));gt?gt.fmtp={parameters:be}:this.attributes.payloads.push({payloadType:parseInt(K,10),rtcpFeedbacks:[],fmtp:{parameters:be}})}parseFmtParameters(b){const K={},J=this.extract(b,this.consumeTill,"=");b._cur++;const be=this.extract(b,this.consumeTill,";");for(K[J]=be;b.attValue[b._cur]===";";){const gt=this.extract(b,this.consumeTill,"=");b._cur++;const dn=this.extract(b,this.consumeTill,";");K[gt]=dn}return K}parseRtcpFb(b){let K="";K=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,l),this.consumeAttributeSpace(b);const J=this.extract(b,this.consumeTill,l);let be;if(J==="trr-int")be={type:J,interval:this.extract(b,this.consumeTill)};else{const gt={type:J};this.peekChar(b)===l&&(this.consumeAttributeSpace(b),gt.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===l&&(gt.additional=this.extract(b,this.consumeTill))),be=gt}if(K==="*")this.attributes.rtcpFeedbackWildcards.push(be);else{const gt=this.attributes.payloads.find(dn=>dn.payloadType===parseInt(K,10));gt?gt.rtcpFeedbacks.push(be):this.attributes.payloads.push({payloadType:parseInt(K,10),rtcpFeedbacks:[be]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const K={port:this.extract(b,this.consumePort)};this.peekChar(b)===l&&(this.consumeAttributeSpace(b),K.netType=this.extractOneOrMore(b,y),this.consumeAttributeSpace(b),K.addressType=this.extractOneOrMore(b,y),this.consumeAttributeSpace(b),K.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=K}parseMsid(b){const K={id:this.extractOneOrMore(b,y,[1,64])};this.peekChar(b)===l&&(this.consumeAttributeSpace(b),K.appdata=this.extractOneOrMore(b,y,[1,64])),this.attributes.msids.push(K)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const K=this.extractOneOrMore(b,be=>A(be)||m(be)||be==="_"||be==="-");this.consumeAttributeSpace(b);const J={id:K,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===l){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const be=[];for(;;){const gt=this.extract(b,this.consumeToken);be.push(gt);try{this.extract(b,this.consume,",")}catch{break}}J.payloads=be,this.peekChar(b)===l&&this.extract(b,this.consume,l)}for(;;){const be=this.extract(b,this.consumeToken);switch(be){case"depend":{const gt={type:be,rids:this.extract(b,this.consume,"=").split(",")};J.params.push(gt);break}default:{const gt={type:be};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),gt.val=this.extract(b,this.consumeTill,";")),J.params.push(gt)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(J)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,m,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const K=this.extract(b,this.consumeToken),J=[];for(;;)try{this.consumeAttributeSpace(b);const be=this.extract(b,this.consumeInteger);J.push(parseInt(be,10))}catch{break}this.attributes.ssrcGroups.push({semantic:K,ssrcIds:J})}}function ut(Se,b,K){return b in Se?Object.defineProperty(Se,b,{value:K,enumerable:!0,configurable:!0,writable:!0}):Se[b]=K,Se}class Yt{constructor(){ut(this,"eol",c)}print(b,K){let J="";return K&&(this.eol=K),J+=this.printVersion(b.version),J+=this.printOrigin(b.origin),J+=this.printSessionName(b.sessionName),J+=this.printInformation(b.information),J+=this.printUri(b.uri),J+=this.printEmail(b.emails),J+=this.printPhone(b.phones),J+=this.printConnection(b.connection),J+=this.printBandwidth(b.bandwidths),J+=this.printTimeFields(b.timeFields),J+=this.printKey(b.key),J+=this.printSessionAttributes(b.attributes),J+=this.printMediaDescription(b.mediaDescriptions),J}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let K="";for(const J of b)K+="e=".concat(J).concat(this.eol);return K}printPhone(b){let K="";for(const J of b)K+="e=".concat(J).concat(this.eol);return K}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let K="";for(const J of b)K+="b=".concat(J.bwtype,":").concat(J.bandwidth).concat(this.eol);return K}printTimeFields(b){let K="";for(const J of b){K+="t=".concat(J.time.startTime," ").concat(J.time.startTime).concat(this.eol);for(const be of J.repeats)K+="r=".concat(be.repeatInterval," ").concat(be.typedTimes.join(" ")).concat(this.eol);J.zoneAdjustments&&(K+="z=",K+="z=".concat(J.zoneAdjustments.map(be=>"".concat(be.time," ").concat(be.back?"-":""," ").concat(be.typedTime)).join(" ")).concat(this.eol),K+=this.eol)}return K}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let K="";for(const J of b)K+="a=".concat(J.attField).concat(J.attValue?":".concat(J.attValue):"").concat(this.eol);return K}printMediaDescription(b){let K="";for(const J of b)K+=this.printMedia(J.media),K+=this.printInformation(J.information),K+=this.printConnections(J.connections),K+=this.printBandwidth(J.bandwidths),K+=this.printKey(J.key),K+=this.printMediaAttributes(J);return K}printConnections(b){let K="";for(const J of b)K+=this.printConnection(J);return K}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new Kr(this.eol).print(b)}printMediaAttributes(b){return new Ee(this.eol).print(b)}}class Ht{constructor(b){ut(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(l)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map(K=>"a=fingerprint:".concat(K.hashFunction).concat(l).concat(K.fingerprint)).join(this.eol)+this.eol:""}printExtmap(b){return b.map(K=>"a=extmap:".concat(K.entry).concat(K.direction?"/".concat(K.direction):"").concat(l).concat(K.extensionName).concat(K.extensionAttributes?"".concat(l).concat(K.extensionAttributes):"").concat(this.eol)).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map(K=>"a=".concat(K.attField).concat(K.attValue?":".concat(K.attValue):"").concat(this.eol)).join("")}}class Kr extends Ht{print(b){let K="";return K+=this.printGroups(b.groups),K+=this.printMsidSemantic(b.msidSemantic),K+=this.printIceLite(b.iceLite),K+=this.printIceUfrag(b.iceUfrag),K+=this.printIcePwd(b.icePwd),K+=this.printIceOptions(b.iceOptions),K+=this.printFingerprints(b.fingerprints),K+=this.printSetup(b.setup),K+=this.printTlsId(b.tlsId),K+=this.printIdentity(b.identities),K+=this.printExtmap(b.extmaps),K+=this.printUnrecognized(b.unrecognized),K}printGroups(b){let K="";return b.length>0&&(K+=b.map(J=>"a=group:".concat(J.semantic).concat(J.identificationTag.map(be=>"".concat(l).concat(be)).join("")).concat(this.eol)).join("")),K}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map(K=>"a=identity:".concat(K.assertionValue).concat(K.extensions.map(J=>"".concat(l).concat(J.name).concat(J.value?"=".concat(J.value):"")))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let K="a=msid-semantic:".concat(b.semantic);return b.applyForAll?K+="".concat(l,"*"):b.identifierList.length>0&&(K+=b.identifierList.map(J=>"".concat(l).concat(J))),K+this.eol}}class Ee extends Ht{print(b){const K=b.attributes;let J="";return J+=this.printRTCP(K.rtcp),J+=this.printIceUfrag(K.iceUfrag),J+=this.printIcePwd(K.icePwd),J+=this.printIceOptions(K.iceOptions),J+=this.printCandidates(K.candidates),J+=this.printRemoteCandidatesList(K.remoteCandidatesList),J+=this.printEndOfCandidates(K.endOfCandidates),J+=this.printFingerprints(K.fingerprints),J+=this.printSetup(K.setup),J+=this.printMid(K.mid),J+=this.printExtmap(K.extmaps),J+=this.printRTPRelated(K),J+=this.printPtime(K.ptime),J+=this.printMaxPtime(K.maxPtime),J+=this.printDirection(K.direction),J+=this.printSSRCGroups(K.ssrcGroups),J+=this.printSSRC(K.ssrcs),J+=this.printRTCPMux(K.rtcpMux),J+=this.printRTCPMuxOnly(K.rtcpMuxOnly),J+=this.printRTCPRsize(K.rtcpRsize),J+=this.printMSId(K.msids),J+=this.printImageattr(K.imageattr),J+=this.printRid(K.rids),J+=this.printSimulcast(K.simulcast),J+=this.printSCTPPort(K.sctpPort),J+=this.printMaxMessageSize(K.maxMessageSize),J+=this.printUnrecognized(K.unrecognized),J}printCandidates(b){return b.map(K=>"a=candidate:".concat(K.foundation).concat(l).concat(K.componentId).concat(l).concat(K.transport).concat(l).concat(K.priority).concat(l).concat(K.connectionAddress).concat(l).concat(K.port).concat(l,"typ").concat(l).concat(K.type).concat(K.relAddr?"".concat(l,"raddr").concat(l).concat(K.relAddr):"").concat(K.relPort?"".concat(l,"rport").concat(l).concat(K.relPort):"").concat(Object.keys(K.extension).map(J=>"".concat(l).concat(J).concat(l).concat(K.extension[J])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(b){return b.map(K=>"a=remote-candidates:".concat(K.join(l)).concat(this.eol)).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const K=b.payloads;let J="";J+=b.rtcpFeedbackWildcards.map(be=>this.printRTCPFeedback("*",be)).join("");for(const be of K)J+=this.printRtpMap(be.payloadType,be.rtpMap),J+=this.printFmtp(be.payloadType,be.fmtp),J+=be.rtcpFeedbacks.map(gt=>this.printRTCPFeedback(be.payloadType,gt)).join("");return J}printFmtp(b,K){if(!K)return"";const J=Object.keys(K.parameters);return J.length===1&&K.parameters[J[0]]===null?"a=fmtp:".concat(b).concat(l).concat(J[0]).concat(this.eol):"a=fmtp:".concat(b).concat(l).concat(Object.keys(K.parameters).map(be=>"".concat(be,"=").concat(K.parameters[be])).join(";")).concat(this.eol)}printRtpMap(b,K){return K?"a=rtpmap:".concat(b).concat(l).concat(K.encodingName,"/").concat(K.clockRate).concat(K.encodingParameters?"/".concat(K.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,K){let J="a=rtcp-fb:".concat(b).concat(l),be=K;return be.type==="trr-int"?J+="ttr-int".concat(l).concat(be.interval):(J+="".concat(be.type),be.parameter&&(J+="".concat(l).concat(be.parameter),be.additional&&(J+="".concat(l).concat(be.additional)))),J+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map(K=>Object.keys(K.attributes).map(J=>"a=ssrc:".concat(K.ssrcId.toString(10)).concat(l).concat(J).concat(K.attributes[J]?":".concat(K.attributes[J]):"").concat(this.eol)).join("")).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let K="a=rtcp:".concat(b.port);return b.netType&&(K+="".concat(l).concat(b.netType)),b.addressType&&(K+="".concat(l).concat(b.addressType)),b.address&&(K+="".concat(l).concat(b.address)),K+this.eol}printMSId(b){return b.map(K=>"a=msid:".concat(K.id).concat(K.appdata?"".concat(l).concat(K.appdata):"").concat(this.eol)).join("")}printImageattr(b){return b.map(K=>"a=imageattr:".concat(K).concat(this.eol)).join("")}printRid(b){return b.map(K=>{let J="a=rid:".concat(K.id).concat(l).concat(K.direction);return K.payloads&&(J+="".concat(l,"pt=").concat(K.payloads.join(","))),K.params.length>0&&(J+="".concat(l).concat(K.params.map(be=>be.type==="depend"?"depend=".concat(be.rids.join(",")):"".concat(be.type,"=").concat(be.val)).join(";"))),J+this.eol}).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map(K=>"a=ssrc-group:".concat(K.semantic).concat(K.ssrcIds.map(J=>"".concat(l).concat(J.toString(10))).join("")).concat(this.eol)).join("")}}function Ne(Se){return new ve().parse(Se)}function Ke(Se,b){return new Yt().print(Se,b)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function Gi(e){return VL.parse(e)}function yd(e,t){return VL.print(e,t)}var hK=Qi("Array","keys"),pK=Jo,fK=mr,mK=Y,_K=hK,nb=Array.prototype,gK={DOMTokenList:!0,NodeList:!0},EK=function(e){var t=e.keys;return e===nb||mK(nb,e)&&t===nb.keys||fK(gK,pK(e))?_K:t},Hi=S(EK);function kn(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jL(Object(n),!0).forEach(function(r){kn(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const FL=new class extends bn{constructor(){super(...arguments),kn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class vK{constructor(t){kn(this,"logger",void 0),kn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function rb(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function BL(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const $s={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},ky=Date.now(),Ug=e=>{for(const t in $s)if(Object.prototype.hasOwnProperty.call($s,t)&&$s[t]===e)return t;return"DEFAULT"},w=new class{constructor(){kn(this,"proxyServerURL",void 0),kn(this,"logLevel",$s.DEBUG),kn(this,"uploadState","collecting"),kn(this,"uploadLogWaitingList",[]),kn(this,"uploadLogUploadingList",[]),kn(this,"uploadErrorCount",0),kn(this,"currentLogID",0),kn(this,"url",void 0),kn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[$s.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[$s.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[$s.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[$s.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[$s.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Zt("UPLOAD_LOG",!0)}disableLogUpload(){Zt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new vK(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-ky<100)return void setTimeout(()=>{this.log(...t)},Date.now()-ky);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=rb()+" Agora-SDK [".concat(Ug(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=rb()+" %cAgora-SDK [".concat(Ug(r),"]:");let s=[];if(!W("USE_NEW_LOG"))switch(r){case $s.DEBUG:s=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,s);break;case $s.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,s);break;case $s.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,s);break;case $s.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-ky<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-ky);const r=Math.max(0,Math.min(4,t[0]));t[0]=rb()+" Agora-SDK [".concat(Ug(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!W("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=BL()+" Agora-SDK [".concat(Ug(e),"]:"):n[0]=BL()+" Agora-SDK [".concat(Ug(e),"]:");let i="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Qs,process_id:W("PROCESS_ID"),payload:JSON.stringify(e)};return va(async()=>{const n=await Ai.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(W("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(W("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),FL.reportLogUploadError(r),!0},{timeout:W("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:W("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,W("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var WL;function SK(e){return wr(e.reportId,"params.reportId",0,100,!1),wr(e.category,"params.category",0,100,!1),wr(e.event,"params.event",0,100,!1),wr(e.label,"params.label",0,100,!1),nn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(WL={}).FREE="free",WL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const yK={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),yn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let TK=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function ot(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const i=r.value;if(typeof i=="function"){const s=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var o,c=arguments.length,l=new Array(c),p=0;p<c;p++)l[p]=arguments[p];let m=l;if(e.argsMap)try{m=e.argsMap(this,...l)}catch(v){w.warning(v),m=[]}try{JSON.stringify(m)}catch{w.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const E=(e.report||Xe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:m,tag:Tn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const v=i.apply(this,l);return v instanceof je?v.then(y=>(E.onSuccess(e.reportResult&&y),y)).catch(y=>{throw E.onError(y),y}):(E.onSuccess(e.reportResult&&v),v)}catch(v){throw E.onError(v),v}}}return r}}const Xe=new class{constructor(){kn(this,"baseInfoMap",new Map),kn(this,"proxyServer",void 0),kn(this,"eventUploadTimer",void 0),kn(this,"setSessionIdTimer",void 0),kn(this,"url",void 0),kn(this,"sids",new Set),kn(this,"backupUrl",void 0),kn(this,"_appId",void 0),kn(this,"_aid",0),kn(this,"keyEventUploadPendingItems",[]),kn(this,"normalEventUploadPendingItems",[]),kn(this,"apiInvokeUploadPendingItems",[]),kn(this,"apiInvokeCount",0),kn(this,"apiInvokeLoggedCount",0),kn(this,"ltsList",[]),kn(this,"lastSendNormalEventTime",Date.now()),kn(this,"customReportCounterTimer",void 0),kn(this,"customReportCount",0),kn(this,"extApiInvoke",async e=>{for(const t of e){const n=St(St({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Tn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),W("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),W("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,s=!!W("SHOW_REPORT_INVOKER_LOG"),o=!!W("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&t.id;c&&(this.apiInvokeLoggedCount+=1);const l=this.apiInvokeLoggedCount;function p(y,D){if(c){let A="[apiInvoke-".concat(l,"]");if(t.id&&(A+="[".concat(t.id,"]")),t.name&&(A+="[".concat(t.name,"]"),t.name===xn.JOIN))return w.info("".concat(A," ").concat(y));w.info("".concat(A," ").concat(y),y==="start"?t.options:D||"")}}const m=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});p("start");let E=!1;Rr(t.timeout).then(()=>{E||(this.sendApiInvoke(St(St({},m()),{},{error:F.API_INVOKE_TIMEOUT,success:!1})),p("timeout"))});const v=new pe(F.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:y=>{const D=()=>{if(E)throw v;return E=!0,this.sendApiInvoke(St(St({},m()),{},{success:!0},t.reportResult&&{result:y})),p("onSuccess"),y};return n?yL(D,t.name+"Success",n,()=>E=!0):D()},onError:y=>{const D=()=>{if(E)throw y;E=!0,this.sendApiInvoke(St(St({},m()),{},{success:!1,error:y})),p("onFailure",y.toString())};return n?yL(D,t.name+"Error",n,()=>E=!0):D()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:W("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:$R?"global":"oversea",areas:W("AREAS")&&W("AREAS").join(",")},t.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:p,clientRole:m}=t,E=Date.now(),v=St(St({},r),{},{eventType:sr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:eb,lts:E,elapse:E-n,extend:JSON.stringify(i),mode:t.mode,process:W("PROCESS_ID"),appType:W("APP_TYPE"),success:!0,version:Qs,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:l,lsid:p,clientType:Ae(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:m,serviceId:W("PROCESS_ID"),extensionID:W("PLUGIN_INFO").join(",")||""});var y;this.send({type:yn.SESSION,data:v},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{role:t.role,eventType:sr.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:yn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:yn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:s,addr:o,isProxy:c}=t,l=i-n.startTime,p=St(St({},r),{},{eventType:sr.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:l,eventElapse:i-t.lts,firstSuccess:s,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:QR(),isABTestSuccess:t.isABTestSuccess?1:0}),m=p.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),s)this.send({type:yn.JOIN_GATEWAY,data:p},!0);else{let E;if(o)if(c){const y=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=o.match(/p=[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:y&&y.length?y[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:c?1:0}}else{const y=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=o.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:y&&y.length?y[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else E={isSuccess:m,gatewayIp:"",port:"",isProxy:c?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const v=Object.assign({},p,E,{eventType:sr.REJOIN_GATEWAY});this.send({type:yn.RE_JOIN_GATEWAY,data:v},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=St(St({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:yn.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:yn.PUBLISH,data:s},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=St(St({},i),{},{eventType:sr.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:yn.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const n=[...Hi(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const s=i.info,o=Date.now(),c=St(St({},s),{},{eventType:sr.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:yn.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),o=St(St({},r),{},{elapse:i-n.startTime,eventType:sr.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>s?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:yn.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:c},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:c},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:sr.AB_TEST,lts:i});this.send({type:yn.AB_TEST,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:sr.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:yn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:sr.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:yn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=St(St(St({},s),r),{},{eventType:t,lts:o});this.send({type:n,data:c},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:yn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{eventType:sr.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(e){this.proxyServer=e,e?w.debug("reportProxyServerurl: ".concat(e)):w.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:yn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(s,o,c){const l=s[o];if(!l||typeof l!="string")return[s];s[o]="";const p=Ec(JSON.stringify(s));let m=0;const E=[];let v=0;for(let y=0;y<l.length;y++)v+=l.charCodeAt(y)<=127?1:3,v<=c-p||(E[E.length]=Re(Re({},s),{},{[o]:l.substring(m,y)}),m=y,v=l.charCodeAt(y)<=127?1:3);return m!==l.length-1&&(E[E.length]=Re(Re({},s),{},{[o]:l.substring(m)})),E})(St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:yn.WORKER_EVENT,data:s},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:yn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:yn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),s=St(St(St({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:yn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>W("CUSTOM_REPORT_LIMIT"))throw new pe(F.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(i=>({type:yn.USER_ANALYTICS,data:St(St({sid:e},i),{},{lts:n})}));try{W("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw w.error("send custom report message failed",i.toString()),new pe(F.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=W("NOT_REPORT_EVENT");if(e.tag&&Ae(t)&&Ae(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:s}=n.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof pe){const{code:l,message:p}=e.error;o=l||p||e.error.toString()}else o=e.error.toString();const c={invokeId:e.invokeId,sid:e.sid,cname:r,cid:s,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:yn.API_INVOKE,data:c},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const s=e.shift();n.length<20?n.push(s):r.push(s)}e.push(...r);for(const s of[...n]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),rh(i=this.ltsList).call(i,(o,c)=>o-c))}return t||(this.lastSendNormalEventTime=Date.now()),W("ENABLE_EVENT_REPORT")&&n.length&&(W("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>o=>{W("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-W("NORMAL_EVENT_QUEUE_CAPACITY")),w.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Gn.networkState===os.OFFLINE&&await je.race([Gn.onlineWaiter,Rr(2*qn.maxRetryTimeout)]);const t=i=>{let s=new Uint8Array;return i.forEach(o=>{const c=jR(JSON.stringify(o.data)),l=new ArrayBuffer(5),p=(E=>{let v=0;return Object.entries(yn).forEach(y=>{let[D,A]=y;A===E.type&&(v=TK[D])}),v})(o),m=new DataView(l);m.setUint16(0,c.byteLength,!0),m.setUint8(2,255&p),m.setUint8(3,p>>>8&255),m.setUint8(4,p>>>16&255),s=hL(s,new Uint8Array(l)),s=hL(s,c)}),s},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await zR(r,{timeout:1e4,data:t(e),headers:St(St({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(c=>{const l=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return l&&l.info.vid&&+l.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(c=>JSON.stringify(c)),vid:n,aid:r};Gn.networkState===os.OFFLINE&&await je.race([Gn.onlineWaiter,Rr(2*qn.maxRetryTimeout)]);const s=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(W("EVENT_REPORT_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(W("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(s)));try{t?await aK(o,{timeout:1e4,data:i}):await zR(o,{timeout:1e4,data:i})}catch(l){if(c===1)throw l;continue}return}}createBaseInfo(e,t){const n=Object.assign({},yK);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Tn.TRACER}).onSuccess()}};FL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Gn.networkState,Xe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Tn.TRACER}).onSuccess("logUploadError")});class ae extends pe{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),kn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,w)}throw(){super.throw(w)}}const br={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ft(){return br}function GL(){return"setSinkId"in HTMLAudioElement.prototype&&(!W("RESTRICTION_SET_PLAYBACK_DEVICE")||(ll()||eL())&&!MR())}function Dy(){return!br.supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dl()}function ib(e){return!(Nn()||tL(87)||Dy()||!W("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}function HL(e){return!!W("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB"))}let Ir=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function wf(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Bt(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Uo(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function sb(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const CK={"90p":Bt(160,90),"90p_1":Bt(160,90),"120p":Bt(160,120,15,30,65),"120p_1":Bt(160,120,15,30,65),"120p_3":Bt(120,120,15,30,50),"120p_4":Bt(212,120),"180p":Bt(320,180,15,30,140),"180p_1":Bt(320,180,15,30,140),"180p_3":Bt(180,180,15,30,100),"180p_4":Bt(240,180,15,30,120),"240p":Bt(320,240,15,40,200),"240p_1":Bt(320,240,15,40,200),"240p_3":Bt(240,240,15,40,140),"240p_4":Bt(424,240,15,40,220),"360p":Bt(640,360,15,80,400),"360p_1":Bt(640,360,15,80,400),"360p_3":Bt(360,360,15,80,260),"360p_4":Bt(640,360,30,80,600),"360p_6":Bt(360,360,30,80,400),"360p_7":Bt(480,360,15,80,320),"360p_8":Bt(480,360,30,80,490),"360p_9":Bt(640,360,15,80,800),"360p_10":Bt(640,360,24,80,800),"360p_11":Bt(640,360,24,80,1e3),"480p":Bt(640,480,15,100,500),"480p_1":Bt(640,480,15,100,500),"480p_2":Bt(640,480,30,100,1e3),"480p_3":Bt(480,480,15,100,400),"480p_4":Bt(640,480,30,100,750),"480p_6":Bt(480,480,30,100,600),"480p_8":Bt(848,480,15,100,610),"480p_9":Bt(848,480,30,100,930),"480p_10":Bt(640,480,10,100,400),"720p":Bt(1280,720,15,120,1130),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Bt(1280,720,15,120,1130),"720p_2":Bt(1280,720,30,120,2e3),"720p_3":Bt(1280,720,30,120,1710),"720p_5":Bt(960,720,15,120,910),"720p_6":Bt(960,720,30,120,1380),"1080p":Bt(1920,1080,15,120,2080),"1080p_1":Bt(1920,1080,15,120,2080),"1080p_2":Bt(1920,1080,30,120,3e3),"1080p_3":Bt(1920,1080,30,120,3150),"1080p_5":Bt(1920,1080,60,120,4780),"1440p":Bt(2560,1440,30,120,4850),"1440p_1":Bt(2560,1440,30,120,4850),"1440p_2":Bt(2560,1440,60,120,7350),"4k":Bt(3840,2160,30,120,8910),"4k_1":Bt(3840,2160,30,120,8910),"4k_3":Bt(3840,2160,60,120,13500)},wK={"480p":Uo(640,480,5),"480p_1":Uo(640,480,5),"480p_2":Uo(640,480,30),"480p_3":Uo(640,480,15),"720p":Uo(1280,720,5),"720p_auto":Bt(1280,720,30,900,3e3),"720p_1":Uo(1280,720,5),"720p_2":Uo(1280,720,30),"720p_3":Uo(1280,720,15),"1080p":Uo(1920,1080,5),"1080p_1":Uo(1920,1080,5),"1080p_2":Uo(1920,1080,30),"1080p_3":Uo(1920,1080,15)},RK={"1SL1TL":sb(1,1),"3SL3TL":sb(3,3),"2SL3TL":sb(2,3)};function Vo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},CK[e]):e}function ob(e){return typeof e=="string"?Object.assign({},wK[e]):e}function Ly(e){return typeof e=="string"?Object.assign({},RK[e]):e}const bK={speech_low_quality:wf(16e3,!1),speech_standard:wf(32e3,!1,18),music_standard:wf(48e3,!1),standard_stereo:wf(48e3,!0,56),high_quality:wf(48e3,!1,128),high_quality_stereo:wf(48e3,!0,192)};function xy(e){return typeof e=="string"?Object.assign({},bK[e]):e}const Rf=[];function KL(e){return ir(e,"mediaSource",["screen","window","application"]),!0}let ze=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),rn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),bf=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),IK=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),AK=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),_h=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),If=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Zs=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Af=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ws=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const ab={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},cb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},zL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},OK={uplinkNetworkQuality:0,downlinkNetworkQuality:0},YL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let _i=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Rs=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Vg=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),gh=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Br=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Sc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const lb={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let My=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Lt(e,t,n,r,i){var s,o,c={};return Object.keys(r).forEach(function(l){c[l]=r[l]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Ui(s=Ru(o=n.slice()).call(o)).call(s,function(l,p){return p(e,t,l)||l},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(e,t,c),null):c}function se(e,t,n){return(t=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var l=c.call(s,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qL(Object(n),!0).forEach(function(r){se(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class XL extends bn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(_h.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),se(this,"trackMediaType",void 0),se(this,"_ID",void 0),se(this,"_rtpTransceiver",void 0),se(this,"_lowRtpTransceiver",void 0),se(this,"_hints",[]),se(this,"_isClosed",!1),se(this,"_originMediaStreamTrack",void 0),se(this,"mediaStreamTrack",void 0),se(this,"_external",{}),this._ID=n||on(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){Ae(Rf).call(Rf,r)||Rf.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||vd(()=>{var n;Xe.reportApiInvoke(null,{name:xn.GET_MEDIA_STREAM_TRACK,options:[],tag:Tn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===bf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Rf.indexOf(t);n!==-1&&Rf.splice(n,1)}(this),this.emit(If.CLOSED),this.removeAllListeners(_h.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===bf.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(_h.TRANSCEIVER_UPDATED,t,n)}}class Of extends XL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),se(this,"_enabled",!0),se(this,"_muted",!1),se(this,"_isExternalTrack",!1),se(this,"_isClosed",!1),se(this,"_enabledMutex",void 0),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Fr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,w.debug("[".concat(this.getTrackId(),"] close")),this.emit(ze.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,ze.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(If.TRACK_ENDED)}stateCheck(t,n){if(w.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Ea(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new pe(F.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",w);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new pe(F.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",w)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():je.resolve([])}}const JL=window.AudioContext||window.webkitAudioContext;let bs=null;const en=new class extends bn{constructor(){super(...arguments),se(this,"prevState",void 0),se(this,"curState",void 0),se(this,"currentTime",void 0),se(this,"currentTimeStuckAt",void 0),se(this,"interruptDetectorTrack",void 0),se(this,"onLocalAudioTrackMute",()=>{w.info("ios15-interruption-start"),this.emit(Ir.IOS_15_16_INTERRUPTION_START)}),se(this,"onLocalAudioTrackUnmute",async()=>{w.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?w.info("ios15-interruption-end-canceled"):(bs&&await bs.suspend(),this.emit(Ir.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){w.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){w.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Nf(){if(!bs){if(function(){if(!JL)return void w.error("your browser is not support web audio");w.info("create audio context");const e=un({},W("WEBAUDIO_INIT_OPTIONS"));w.debug("audio context init option:",JSON.stringify(e)),bs=new JL(e),en.curState=bs.state,bs.onstatechange=()=>{en.prevState=en.curState,en.curState=bs?bs.state:void 0;const{prevState:t,curState:n}=en,r=n==="running",i=n==="interrupted",s=t==="running",o=t==="suspended",c=t==="interrupted",l=xt().osVersion;(Xr()||xo())&&s&&i&&(w.info("ios".concat(l,"-interruption-start")),en.emit(Ir.IOS_INTERRUPTION_START)),(Xr()||xo())&&(o||c)&&r&&(w.info("ios".concat(l,"-interruption-end")),en.emit(Ir.IOS_INTERRUPTION_END)),t!==n&&en.emit(Ir.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=bs)===null||t===void 0?void 0:t.currentTime;en.currentTime!==n?(en.currentTimeStuckAt&&(w.debug("AudioContext current time resume at ".concat(n)),en.currentTimeStuckAt=void 0),en.currentTime=n):(n!==en.currentTimeStuckAt&&(Xe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Tn.TRACER}).onSuccess(),w.warning("AudioContext current time stuck at ".concat(n))),en.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,o=!1;function c(A){t.state==="running"?l(!1):Xr()||xo()?t.state==="suspended"&&(l(!0),A&&t.resume().then(p,p)):t.state!=="closed"&&(l(!0),A&&t.resume().then(p,p))}function l(A){if(i!==A){i=A;for(let P=0,j=n;P<j.length;P+=1){const V=j[P];A?window.addEventListener(V,m,{capture:!0,passive:!0}):window.removeEventListener(V,m,{capture:!0,passive:!0})}}}function p(){c(!1)}function m(){c(!0)}function E(A){if(!o)if(r.paused)if(A){let P;v(!1),o=!0;try{P=r.play(),P?P.then(y,y):(r.addEventListener("playing",y),r.addEventListener("abort",y),r.addEventListener("error",y))}catch{y()}}else v(!0);else v(!1)}function v(A){if(s!==A){s=A;for(let P=0,j=n;P<j.length;P++){const V=j[P];A?window.addEventListener(V,D,{capture:!0,passive:!0}):window.removeEventListener(V,D,{capture:!0,passive:!0})}}}function y(){r.removeEventListener("playing",y),r.removeEventListener("abort",y),r.removeEventListener("error",y),o=!1,E(!1)}function D(){E(!0)}if(Xr()){const A=t.createMediaStreamDestination(),P=document.createElement("div");P.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=P.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=A.stream,E(!0)}en.on(Ir.STATE_CHANGE,function(){c(!0)}),c(!1)}(bs)}(),!bs)throw new pe(F.NOT_SUPPORTED,"can not create audio context");return bs}return bs}function Eh(e){if(function(){if(db!==null)return db;const r=Nf(),i=r.createBufferSource(),s=r.createGain(),o=r.createGain();i.connect(s),i.connect(o),i.disconnect(s);let c=!1;try{i.disconnect(s)}catch{c=!0}return i.disconnect(),db=c,c}())return;const t=e.connect,n=e.disconnect;e.connect=(r,i,s)=>{var o;return e._inputNodes||(e._inputNodes=[]),Ae(o=e._inputNodes).call(o,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,s)):t.call(e,r,i)),e},e.disconnect=(r,i,s)=>{n.call(e),r?Ry(e._inputNodes,r):e._inputNodes=[];for(const o of e._inputNodes)t.call(e,o)}}let db=null;function ub(e,t){let n=!1;const r=1/t;if(W("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=Nf();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(n)return void(s=null);const c=i.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(i.currentTime+r),e(i.currentTime)};o()}return()=>{n=!0}}class QL{constructor(){se(this,"context",void 0),se(this,"analyserNode",void 0),se(this,"sourceNode",void 0),this.context=Nf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Xr()||xo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const n=Ui(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{w.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $L extends bn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),se(this,"outputNode",void 0),se(this,"outputTrack",void 0),se(this,"isPlayed",!1),se(this,"sourceNode",void 0),se(this,"context",void 0),se(this,"audioBufferNode",void 0),se(this,"destNode",void 0),se(this,"audioOutputLevel",0),se(this,"volumeLevelAnalyser",void 0),se(this,"_processedNode",void 0),se(this,"playNode",void 0),se(this,"isDestroyed",!1),se(this,"onNoAudioInput",void 0),se(this,"isNoAudioInput",!1),se(this,"_noAudioInputCount",0),this.context=Nf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Eh(this.outputNode),this.volumeLevelAnalyser=new QL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ws.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ft().webAudioMediaStreamDest)throw new pe(F.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&by(()=>{en.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Xr()||xo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Rr(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ZL extends $L{get isFreeze(){return!1}constructor(t,n,r){var i;if(super(),se(this,"sourceNode",void 0),se(this,"track",void 0),se(this,"clonedTrack",void 0),se(this,"audioElement",void 0),se(this,"isCurrentTrackCloned",!1),se(this,"isRemoteTrack",!1),se(this,"originVolumeLevelAnalyser",void 0),se(this,"rebuildWebAudio",async()=>{if(w.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void w.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>w.info("resume success")),w.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;const l=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(l),Eh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),Eh(this.outputNode),this.emit(ws.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=l,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new pe(F.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),Eh(this.sourceNode),r){const c=r.clone();c.enabled=!0,this.clonedTrack=c,w.debug("create an unmuted track ".concat(c.id," from the original track ").concat(r.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([c]));Eh(l),this.originVolumeLevelAnalyser=new QL,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=xt();n&&o.os===dr.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(en.on(Ir.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Eh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ws.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),en.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),w.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Eh(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function ex(e,t,n){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function NK(e,t){const n=await tx(e.mediaSource),{sourceId:r,audio:i}=await function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new je((c,l)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(j);const V=new Error("NotAllowedError");V.name="NotAllowedError",l(V)};let A=o;const P=document.createElement("div");if(o){const V=document.createElement("input");V.setAttribute("type","checkbox");const G=document.createElement("span");V.setAttribute("style","margin-right: 6px;"),G.innerText="Share audio",V.checked=A,V.onchange=()=>{A=V.checked},P.appendChild(V),P.appendChild(G)}y.appendChild(P),y.appendChild(D),m.appendChild(E),m.appendChild(v),m.appendChild(y);const j=document.createElement("div");j.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),j.appendChild(p),j.appendChild(m),document.body.appendChild(j),s.map(V=>{if(V.id){const G=document.createElement("div");G.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Z=V.thumbnail;try{const{width:Q}=Z.getSize();Q>1920&&(Z=Z.resize({width:1920}))}catch(Q){throw Q&&Q.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Q}G.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Z.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+V.name.replace(/[\u00A0-\u9999<>\&]/g,function(Q){return"&#"+Q.charCodeAt(0)+";"})+"</span>",G.onclick=()=>{document.body.removeChild(j),c({sourceId:V.id,audio:A})},v.appendChild(G)}})})}(n,t);return await ex(r,e,i)}async function tx(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=pL();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new pe(F.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new je((s,o)=>{n.desktopCapturer.getSources({types:t},(c,l)=>{c?o(c):s(l)})}));try{return await r}catch(s){throw new pe(F.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const hb=new Fr("safari");let nx=!1,rx=!1;async function Is(e,t){let n=0,r=null;for(;n<2;)try{r=await PK(e,t,n>0);break}catch(i){if(i instanceof pe)throw w.error("[".concat(t,"] ").concat(i.toString())),i;const s=Uy(i.name||i.code||i,i.message);if(s.code===F.MEDIA_OPTION_INVALID){w.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Rr(500);continue}throw w.error("[".concat(t,"] ").concat(s.toString())),s}if(!r)throw new pe(F.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function PK(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new pe(F.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ft(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return w.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(pL())e.screen.sourceId?Pf(i,await ex(e.screen.sourceId,e.screen,!!e.screenAudio)):Pf(i,await NK(e.screen,!!e.screenAudio));else if(ll()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new pe(F.NOT_SUPPORTED,"This browser does not support screen sharing");w.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const v=await(o=e.screen.extensionId,c=t,new je((y,D)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},A=>{if(!A||!A.streamId)return w.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),A),void D(new pe(F.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(A.streamId)})}catch(A){w.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),A.toString()),D(new pe(F.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=v,Pf(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var s;e.screen.mediaSource&&KL(e.screen.mediaSource);const v={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(s=e.screen.displaySurface)!==null&&s!==void 0?s:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:P}=e.screen,j={selfBrowserSurface:y,surfaceSwitching:D,systemAudio:A,preferCurrentTab:P};!y&&delete j.selfBrowserSurface,!D&&delete j.surfaceSwitching,!A&&delete j.systemAudio,!P&&delete j.preferCurrentTab,w.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:v,audio:e.screenAudio,controls:j})),Pf(i,await navigator.mediaDevices.getDisplayMedia(un({video:v,audio:e.screenAudio},j)))}else{if(!Nn())throw w.error("[".concat(t,"] This browser does not support screenSharing")),new pe(F.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&KL(e.screen.mediaSource);const v={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};w.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(v))),Pf(i,await navigator.mediaDevices.getUserMedia(v))}}var o,c;if(!e.video&&!e.audio)return i;let l={video:e.video,audio:e.audio},p=W("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),l=WR(l,p)}catch{}w.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(l)),xt();let m,E=null;(Pr()||Xr()||Cy())&&(E=await hb.lock());try{m=await navigator.mediaDevices.getUserMedia(l)}catch(v){throw E&&E(),v}return l.audio&&(nx=!0),l.video&&(rx=!0),Pf(i,m),E&&E(),i}function Uy(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new pe(F.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new pe(F.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new pe(F.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new pe(F.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new pe(F.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new pe(F.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return w.error("getUserMedia unexpected error",e),new pe(F.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Pf(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],s=t.getAudioTracks()[0];s&&(r&&e.removeTrack(r),e.addTrack(s)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const As=new class extends bn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(gh.STATE_CHANGE,e),this._state=e)}constructor(){super(),se(this,"_state",Vg.IDLE),se(this,"isAccessMicrophonePermission",!1),se(this,"isAccessCameraPermission",!1),se(this,"lastAccessMicrophonePermission",!1),se(this,"lastAccessCameraPermission",!1),se(this,"checkdeviceMatched",!1),se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(W("ENUMERATE_DEVICES_INTERVAL")||(wy()||Ty()===dr.HARMONY_OS)&&dl())&&this.updateDevicesInfo()},W("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>w.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new pe(F.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(s=!1),i.video&&(o=!1);let c=null,l=null,p=null;if(!n&&(s||o)){if(hb.isLocked&&(w.debug("[device manager] wait GUM lock"),(await hb.lock())(),w.debug("[device manager] GUM unlock")),nx&&(s=!1,this.isAccessMicrophonePermission=!0),rx&&(o=!1,this.isAccessCameraPermission=!0),w.debug("[device manager] check media device permissions",e,t,s,o),s&&o){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const E=Uy(m.name||m.code||m,m.message);if(E.code===F.PERMISSION_DENIED)throw E;w.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){const E=Uy(m.name||m.code||m,m.message);if(E.code===F.PERMISSION_DENIED)throw E;w.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(o){try{l=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){const E=Uy(m.name||m.code||m,m.message);if(E.code===F.PERMISSION_DENIED)throw E;w.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}w.debug("[device manager] mic permission",e,"cam permission",t)}try{const m=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(E=>E.stop()),l&&l.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),c=null,l=null,p=null,m}catch(m){return c&&c.getTracks().forEach(E=>E.stop()),l&&l.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),c=null,l=null,p=null,new pe(F.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new pe(F.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Vg.INITING;try{await this.updateDevicesInfo(),this.state=Vg.INITEND}catch(e){throw w.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Vg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new pe(F.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=e.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");i&&s?s.groupId===i.groupId?w.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):w.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):w.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),n.push(o)}s&&(s.updateAt=t)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",n.push(i))}),this.state!==Vg.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(gh.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(gh.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(gh.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),n=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let pb=!1;const Os=new class extends bn{constructor(){super(...arguments),se(this,"onAutoplayFailed",void 0),se(this,"onAudioAutoplayFailed",void 0)}};function ix(){if(xt(),!pb){const e=t=>{t.preventDefault(),pb=!1,Ag()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};pb=!0,Ag()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),w.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Os.onAutoplayFailed?Os.onAutoplayFailed():Os.onAudioAutoplayFailed?w.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):w.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Os.emit("autoplay-failed")}}function sx(e,t,n,r){if(!e)return;const i=Xe.getBaseInfoBySessionId(e);if(!i)return;const s=i.info,o=Date.now(),c=un(un({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:Os.onAutoplayFailed||Os.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});Xe.send({type:yn.AUTOPLAY_FAILED,data:c},!0)}const kK=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Oi=new class{constructor(){se(this,"onAutoplayFailed",void 0),se(this,"elementMap",new Map),se(this,"elementStateMap",new Map),se(this,"elementsNeedToResume",[]),se(this,"sinkIdMap",new Map),se(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(w.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),o==="live"){if(e)return r.pause(),void r.play();if(en.curState==="running")return gf()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(w.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),en.on(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),en.on(Ir.STATE_CHANGE,()=>{Xr()&&en.prevState==="suspended"&&en.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new pe(F.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Br.INIT),this.setVolume(t,n);const s=this.sinkIdMap.get(t);if(s)try{i.setSinkId(s).catch(c=>{w.warning("[".concat(t,"] set sink id failed"),c.toString())})}catch(c){w.warning("[".concat(t,"] set sink id failed"),c.toString())}const o=i.play();o&&o.then&&o.catch(c=>{r&&sx(r,"audio",c.message,t),w.warning("audio element play warning",c.toString()),this.elementMap.has(t)&&c.name==="NotAllowedError"&&(w.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),by(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ix()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){kK.forEach(n=>{t.addEventListener(n,r=>{const i=this.elementStateMap.get(e),s=r.type==="pause"?"paused":r.type;if(w.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const o=t?.error;o&&w.error("[".concat(e,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(e,s)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{w.debug("Auto resume audio element success")}).catch(n=>{w.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new je(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Ag()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Dn(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new pe(F.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",w);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const c=r.apply(this,s);return c instanceof je?new je((l,p)=>{c.then(l).catch(p)}):c}),n}}class ox extends bn{constructor(t){super(),se(this,"name","VideoProcessorDestination"),se(this,"ID","0"),se(this,"_source",void 0),se(this,"videoContext",void 0),se(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new pe(F.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new pe(F.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(_i.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(_i.ON_TRACK,void 0)}}class ax extends bn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"usageRegistry",[]),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Dr(this,Rs.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return w.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),sn(this,Rs.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return w.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),sn(this,Rs.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){w.error(new pe(F.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof je&&(r=await r),t.push(un(un({},r),{},{direction:this.direction}))}catch(r){w.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class cx extends bn{constructor(t){super(),se(this,"name","AudioProcessorDestination"),se(this,"ID","0"),se(this,"inputTrack",void 0),se(this,"inputNode",void 0),se(this,"audioProcessorContext",void 0),se(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new pe(F.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new pe(F.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(_i.ON_TRACK,void 0),this.emit(_i.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(_i.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(_i.ON_NODE,this.inputNode))}}class lx extends bn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"audioContext",void 0),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"usageRegistry",[]),se(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Dr(this,Rs.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return w.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),sn(this,Rs.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),sn(this,Rs.REQUEST_UPDATE_CONSTRAINTS,Array.from(rs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();t.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){w.error(new pe(F.UNEXPECTED_ERROR,o.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof je&&(r=await r),t.push(un(un({},r),{},{direction:this.direction}))}catch(r){w.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class fb extends bn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),se(this,"context",void 0),se(this,"processSourceNode",void 0),se(this,"outputTrack",void 0),se(this,"processedNode",void 0),se(this,"clonedTrack",void 0),se(this,"outputNode",void 0),this.outputNode=new DK}setVolume(){}createOutputTrack(){throw new pe(F.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class DK{disconnect(){}connect(){}}function dx(e){return new je((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=Xr()?"canplay":"playing";i.addEventListener(s,()=>{const o=i.videoWidth,c=i.videoHeight;!o&&Nn()||(r=!0,i.srcObject=null,i.remove(),t([o,c]))}),i.srcObject=new MediaStream([e]),i.play().catch(Iy),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function Vy(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Vo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!cL()&&n.frameRate&&(t.frameRate=n.frameRate),eL()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Nn()&&(t.frameRate={ideal:30,max:30}),t}function ux(e){const t={};return cL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,ll()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function hx(e){const t=ux(e);if(e.encoderConfig){const n=xy(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),wy()&&(t.sampleRate=void 0),t}const LK=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=r,height:c=i}=t;if(!s||!o||!c)return;o=Sf(o),c=Sf(c),s=Sf(s);const{max:l,min:p}=function(y,D,A){const P=200*Math.pow(A/15,.6)*Math.pow(y*D/640/360,.75);return{min:Math.floor(P),max:Math.floor(4*P)}}(o,c,s),{bitrateMax:m,bitrateMin:E}=t||{};m||w.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(m,", brMin: ").concat(E,"]"));const{maxFramerate:v}=W("ENCODER_CONFIG_LIMIT");return v&&typeof v=="number"&&(s=Math.min(s,v)),{frameRate:s,bitrateMax:m||l,bitrateMin:E||p,scaleResolutionDownBy:1,scale:0}},px=async(e,t,n)=>await(async(r,i,s)=>{const o=function(p){const m=[];for(let E=0;E<p.length;E+=2)m.push(parseInt(p.slice(E,E+2),16));return Uint8Array.from(m)}(wL(""+i+s)).slice(0,16),c=o.slice(0,12),l=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},l,r))})(e.buffer,t,n),mb=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new je((n,r)=>{t.toBlob(async i=>{if(t.remove(),i){const s=await fx(i);n({buffer:s,width:t.width,height:t.height})}else r(new pe(F.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},fx=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var mx,_x,gx,Ex,vx,Sx,yx,Tx,Cx,wx,Rx,bx,Ix,Ax,Ox,Nx,Px,kx,In,Dx,Lx,xx,Mx,Ux,Vx,yc,jx,Fx,Bx,Wx,Gx,Hx,Kx,zx,Yx,qx,Xx,Jx,Qx,xr;let Ln=(mx=ot({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),_x=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),gx=Dn(),Ex=yf("LocalAudioTrack","_enabledMutex"),vx=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),Sx=Dn(),yx=yf("LocalAudioTrack","_enabledMutex"),Tx=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),Cx=Dn(),wx=Dn(),Rx=Dn(),bx=ot({argsMap:e=>[e.getTrackId()]}),Ix=Dn(),Ax=ot({argsMap:e=>[e.getTrackId()]}),Ox=Dn(),Nx=ot({argsMap:e=>[e.getTrackId()]}),Px=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),kx=ot({argsMap:e=>[e.getTrackId()]}),Lt((In=class extends Of{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),se(this,"trackMediaType",Af.AUDIO),se(this,"_encoderConfig",void 0),se(this,"_trackSource",void 0),se(this,"metadata",[]),se(this,"_enabled",!0),se(this,"_volume",100),se(this,"_useAudioElement",!0),se(this,"_bypassWebAudio",!1),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_processorDestination",void 0),se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new fb,W("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),W("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Pr()&&!bs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){nn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Oi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void w.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,sn(this,ze.NEED_REPLACE_TRACK,this).then(()=>{w.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{w.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!GL())throw new pe(F.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await sn(this,ze.NEED_ENABLE_TRACK,this),w.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await sn(this,ze.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await sn(this,ze.NEED_MUTE_TRACK,this):await sn(this,ze.NEED_UNMUTE_TRACK,this))}getStats(){return vd(()=>{w.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ts(this,ze.GET_STATS)||un({},ab)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ws.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ws.ON_AUDIO_BUFFER),this._source.on(ws.ON_AUDIO_BUFFER,n=>e(n))}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,ze.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return je.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new pe(F.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(_i.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await sn(this,ze.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,ze.NEED_REPLACE_TRACK,this))}),e.on(_i.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(_i.ON_TRACK),e.removeAllListeners(_i.ON_NODE)}bindProcessorContextEvents(e){e.on(Rs.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Rs.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof fb&&(this._trackSource=new ZL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new lx(this._source.context,this.getTrackId(),"local"),t=new cx(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ws.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Oi.stop(this.getTrackId()),this._source.play()),sn(this,ze.NEED_REPLACE_MIXING_TRACK,this).then(()=>{w.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{w.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[mx],Object.getOwnPropertyDescriptor(In.prototype,"setVolume"),In.prototype),Lt(In.prototype,"setPlaybackDevice",[_x,gx],Object.getOwnPropertyDescriptor(In.prototype,"setPlaybackDevice"),In.prototype),Lt(In.prototype,"setEnabled",[Ex,vx,Sx],Object.getOwnPropertyDescriptor(In.prototype,"setEnabled"),In.prototype),Lt(In.prototype,"setMuted",[yx,Tx,Cx],Object.getOwnPropertyDescriptor(In.prototype,"setMuted"),In.prototype),Lt(In.prototype,"getStats",[wx],Object.getOwnPropertyDescriptor(In.prototype,"getStats"),In.prototype),Lt(In.prototype,"setAudioFrameCallback",[Rx],Object.getOwnPropertyDescriptor(In.prototype,"setAudioFrameCallback"),In.prototype),Lt(In.prototype,"play",[bx,Ix],Object.getOwnPropertyDescriptor(In.prototype,"play"),In.prototype),Lt(In.prototype,"stop",[Ax,Ox],Object.getOwnPropertyDescriptor(In.prototype,"stop"),In.prototype),Lt(In.prototype,"close",[Nx],Object.getOwnPropertyDescriptor(In.prototype,"close"),In.prototype),Lt(In.prototype,"pipe",[Px],Object.getOwnPropertyDescriptor(In.prototype,"pipe"),In.prototype),Lt(In.prototype,"unpipe",[kx],Object.getOwnPropertyDescriptor(In.prototype,"unpipe"),In.prototype),In),jg=(Dx=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),Lx=Dn(),xx=yf("MicrophoneAudioTrack","_enabledMutex"),Mx=ot({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Ux=Dn(),Vx=ot({argsMap:e=>[e.getTrackId()]}),Lt((yc=class extends Ln{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?xy(t.encoderConfig):{},r,W("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),se(this,"_config",void 0),se(this,"_deviceName","default"),se(this,"_constraints",void 0),se(this,"_originalConstraints",void 0),se(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(gf()||xR())&&en.bindInterruptDetectorTrack(this)}async setDevice(e){if(w.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await As.getDeviceById(e),n={};n.audio=un({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Is(n,this.getTrackId())}catch(i){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Is({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await As.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}w.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return w.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),W("AUTO_RESET_AUDIO_ROUTE")&&(Xr()||xo())){const o=navigator.audioSession;o&&(e||(o.type="playback"),o.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await sn(this,ze.NEED_DISABLE_TRACK,this)}catch(o){throw w.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=un({},this._constraints),s=As.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const o=await Is({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await sn(this,ze.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}w.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(gf()||xR())&&en.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Xr()||xo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const e=async()=>{en.off(Ir.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(Ir.IOS_INTERRUPTION_END,e)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(If.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=As.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Is({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Rs.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Rs.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Dx,Lx],Object.getOwnPropertyDescriptor(yc.prototype,"setDevice"),yc.prototype),Lt(yc.prototype,"setEnabled",[xx,Mx,Ux],Object.getOwnPropertyDescriptor(yc.prototype,"setEnabled"),yc.prototype),Lt(yc.prototype,"close",[Vx],Object.getOwnPropertyDescriptor(yc.prototype,"close"),yc.prototype),yc),xK=(jx=ot({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Fx=Dn(),Bx=ot({argsMap:e=>[e.getTrackId()]}),Wx=Dn(),Gx=ot({argsMap:e=>[e.getTrackId()]}),Hx=Dn(),Kx=ot({argsMap:e=>[e.getTrackId()]}),zx=Dn(),Yx=ot({argsMap:e=>[e.getTrackId()]}),qx=Dn(),Xx=ot({argsMap:e=>[e.getTrackId()]}),Jx=ot({argsMap:e=>[e.getTrackId()]}),Qx=Dn(),Lt((xr=class extends Ln{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),se(this,"source",void 0),se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ws.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(If.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){nn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[jx,Fx],Object.getOwnPropertyDescriptor(xr.prototype,"startProcessAudioBuffer"),xr.prototype),Lt(xr.prototype,"pauseProcessAudioBuffer",[Bx,Wx],Object.getOwnPropertyDescriptor(xr.prototype,"pauseProcessAudioBuffer"),xr.prototype),Lt(xr.prototype,"seekAudioBuffer",[Gx,Hx],Object.getOwnPropertyDescriptor(xr.prototype,"seekAudioBuffer"),xr.prototype),Lt(xr.prototype,"resumeProcessAudioBuffer",[Kx,zx],Object.getOwnPropertyDescriptor(xr.prototype,"resumeProcessAudioBuffer"),xr.prototype),Lt(xr.prototype,"stopProcessAudioBuffer",[Yx,qx],Object.getOwnPropertyDescriptor(xr.prototype,"stopProcessAudioBuffer"),xr.prototype),Lt(xr.prototype,"close",[Xx],Object.getOwnPropertyDescriptor(xr.prototype,"close"),xr.prototype),Lt(xr.prototype,"setAudioBufferPlaybackSpeed",[Jx,Qx],Object.getOwnPropertyDescriptor(xr.prototype,"setAudioBufferPlaybackSpeed"),xr.prototype),xr);class Zn extends Ln{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Nf().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,on(8,"track-mix-")),se(this,"trackList",void 0),se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(w.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):w.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){w.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Ry(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Zn?n.emit(_h.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class MK extends $L{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ws.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),se(this,"audioBuffer",void 0),se(this,"sourceNode",void 0),se(this,"startPlayTime",0),se(this,"startPlayOffset",0),se(this,"pausePlayTime",0),se(this,"options",void 0),se(this,"currentLoopCount",0),se(this,"currentPlaybackSpeed",100),se(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):w.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const $x=new Map;function Zx(e,t){if(e.length===0||t.length===0)return 1/0;const n=GR(e),r=GR(t);return Math.floor(r/n)}class _b{get rendFrameRate(){const t=Math.max(1,Zx(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Br.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(w.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){se(this,"trackId",void 0),se(this,"config",void 0),se(this,"onFirstVideoFrameDecoded",void 0),se(this,"onFirstVideoFrameRender",void 0),se(this,"onVideoStateChanged",void 0),se(this,"freezeTimeCounterList",[]),se(this,"renderFreezeAccTime",0),se(this,"renderFreezeAccTime2",0),se(this,"isKeepLastFrame",!1),se(this,"isDestroyed",!1),se(this,"timeUpdatedCount",0),se(this,"freezeTime",0),se(this,"playbackTime",0),se(this,"lastTimeUpdatedTime",0),se(this,"autoplayFailed",!1),se(this,"videoTrack",void 0),se(this,"videoElement",void 0),se(this,"cacheVideoElement",void 0),se(this,"internal",!1),se(this,"_render_interframe_delays",[]),se(this,"_render_interframe_delays_sizes",[]),se(this,"_videoState",Sc.VideoStateStopped),se(this,"videoElementCheckInterval",void 0),se(this,"videoElementFreezeTimeout",void 0),se(this,"_videoElementStatus",Br.NONE),se(this,"_isInPage",!0),se(this,"isGettingVideoDimensions",!1),se(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return w.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&en.curState==="running"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat($D())),oL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),se(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&w.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Br.PLAYING;break;case"loadeddata":if(this.videoState=Sc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Br.CANPLAY;break;case"stalled":this.videoElementStatus=Br.STALLED;break;case"suspend":this.videoElementStatus=Br.SUSPEND;break;case"pause":this.videoElementStatus=Br.PAUSED,Xr()||xo()||Pr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Br.WAITING;break;case"abort":this.videoElementStatus=Br.ABORT;break;case"ended":this.videoElementStatus=Br.ENDED;break;case"emptied":this.videoElementStatus=Br.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=Br.ERROR,w.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Tc.lastVisibleTime<Tc.lastHiddenTime||s<Tc.lastHiddenTime||s<Tc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>W("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat($D())),oL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),en.on(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.on(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{t&&sx(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(w.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):w.warning("[".concat(this.trackId,"] play warning: "),i)});const r=xt();if((r.name==="Safari"&&Number(r.version)===15||gf())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return w.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new je((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const l=await fx(c);s({buffer:l,width:r.width,height:r.height})}else o(new pe(F.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await mb(t)}destroy(){this.isDestroyed=!0,en.off(Ir.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),en.off(Ir.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Sc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Br.INIT,!this.videoElementCheckInterval&&(eM.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(s){return s!==document.body&&document.body.contains(s)}(this.videoElement)},1e3),W("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,W("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Sc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Sc.VideoStateFrozen:document.addEventListener("visibilitychange",o))},l=(p,m)=>{if(this.videoElementStatus===Br.PLAYING){if(s){const y=m.presentationTime-s.presentationTime,D=m.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(D),this._render_interframe_delays.push(y);const A=GR(this._render_interframe_delays_sizes),P=A-this._render_interframe_delays_sizes[0];if(A>30&&P>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Sc.VideoStateStarting&&(this.videoState=Sc.VideoStateDecoding),this.videoState===Sc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,W("VIDEO_FREEZE_DURATION"))),y<W("VIDEO_FREEZE_DURATION")&&this.videoState===Sc.VideoStateFrozen&&(this.videoState=Sc.VideoStateDecoding),y>W("VIDEO_FREEZE_DURATION")&&Tc.lastVisibleTime>=Tc.lastHiddenTime&&s.timestamp>Tc.lastVisibleTime&&s.timestamp>Tc.lastHiddenTime){const j=Math.min(66,Zx(this._render_interframe_delays_sizes,this._render_interframe_delays)),V=Math.max(0,y-(D-1)*j);this.renderFreezeAccTime2+=V>j?V:0,this.renderFreezeAccTime+=y}}s=un(un({},m),{},{timestamp:p})}else this.isSkipCalcRenderFreezeTime()&&(s=un(un({},m),{},{timestamp:p}));var E,v;W("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(v=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(v,l))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,l)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),wy()&&!W("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=xt();r.name==="Safari"&&Number(r.version)===15||gf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{w.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){eM.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Br.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Br.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{w.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{w.error(r)}),this.autoplayFailed=!1,Ag()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Ag()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),ix()}}const eM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class gb extends _b{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),se(this,"container",void 0),se(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var r;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await mb(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",W("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var tM,nM,rM,iM,sM,oM,aM,cM,lM,dM,uM,hM,pM,fM,mM,_M,gM,EM,vM,SM,yM,TM,CM,wM,RM,bM,IM,AM,It,OM,NM,PM,kM,DM,LM,xM,MM,Ns;let mn=(tM=ot({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),nM=Dn(),rM=ot({argsMap:e=>[e.getTrackId()]}),iM=yf("LocalVideoTrack","_enabledMutex"),sM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),oM=Dn(),aM=yf("LocalVideoTrack","_enabledMutex"),cM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),lM=Dn(),dM=ot({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),uM=Dn(),hM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),pM=Dn(),fM=Dn(),mM=ot({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),_M=Dn(),gM=Dn(),EM=Dn(),vM=ot({argsMap:e=>[e.getTrackId()]}),SM=Dn(),yM=Dn(),TM=Dn(),CM=Dn(),wM=Dn(),RM=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),bM=ot({argsMap:e=>[e.getTrackId()]}),IM=ot({argsMap:e=>[e.getTrackId()]}),AM=ot({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),It=class CF extends Of{get videoHeight(){if(Pr()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Pr()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Br.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,i,s,o){if(super(t,s),se(this,"trackMediaType",Af.VIDEO),se(this,"_player",void 0),se(this,"isUseScaleResolutionDownBy",!1),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"_encoderConfig",void 0),se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),se(this,"_optimizationMode",void 0),se(this,"_saveEncodeBitrateRatio",1),se(this,"_videoHeight",void 0),se(this,"_videoWidth",void 0),se(this,"_forceBitrateLimit",void 0),se(this,"_enabled",!0),se(this,"_processorDestination",void 0),se(this,"_processorContext",void 0),Pr()){const{width:c,height:l}=t.getSettings();this._videoWidth=c,this._videoHeight=l}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],n&&this._hints.indexOf(rn.CUSTOM_TRACK)!==-1?this._encoderConfig=Cn(n):this._encoderConfig=n,this._hints.indexOf(rn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(NR(Wt.CHROME,115)&&Ty().indexOf("Windows")!==-1){const c=function(l,p){if("VideoFrame"in window&&"TransformStream"in window&&Ft().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(l),E=new MediaStreamTrackGenerator({kind:"video"});let v,y,D=Date.now();const A=()=>{P&&(clearInterval(P),P=void 0),v&&(v.close(),v=void 0),l.stop(),y=void 0,E.removeEventListener("ended",A)};let P=window.setInterval(()=>{if(y&&v&&Date.now()-D>1e3)try{E.readyState==="live"?y.enqueue(v.clone()):A()}catch{A()}},1e3);const j=new TransformStream({transform:(V,G)=>{E.readyState==="live"?(y=G,D=Date.now(),v===void 0?(v=V,G.enqueue(V.clone())):(G.enqueue(v),v=V)):V.close()}});return E.addEventListener("ended",A),m.readable.pipeThrough(j).pipeTo(E.writable),E}}(t);c&&(w.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}n&&this._hints.indexOf(rn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new ax(this.getTrackId(),"local"),this._processorDestination=new ox(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=un(un(un({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new _b(r):this._player=new gb(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(If.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await sn(this,ze.NEED_DISABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sn(this,ze.NEED_ENABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await sn(this,ze.NEED_MUTE_TRACK,this):await sn(this,ze.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),w.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await sn(this,ze.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(w)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new pe(F.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Vo(t),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=Vy({encoderConfig:t});(Pr()||Xr()||xo())&&(r.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new pe(F.UNEXPECTED_ERROR,i.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,ze.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(w)}}getStats(){return vd(()=>{w.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ts(this,ze.GET_STATS)||un({},cb)}async setBeautyEffect(t){w.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await mb(t)}async findClosestProfile(){const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:o}=this._encoderConfig||{},c=Sf(this._videoWidth||t||i||0),l=Sf(this._videoHeight||n||s||0),p=function(m,E,v){if(!Array.isArray(W("VIDEO_ENCODER_CONFIG_LIST"))||W("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const y=Math.min(m,E);return!(y>=480)&&un(un({},W("VIDEO_ENCODER_CONFIG_LIST").find(D=>D.height>y)),{},{frameRate:v})}(c,l,Sf(r||o||15));if(p)return w.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(l," => ").concat(JSON.stringify(p))),this.setEncoderConfiguration(p)}async setBitrateLimit(t){w.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void w.error(F.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await sn(this,ze.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,w.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return w.error(F.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,w.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){dx(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Iy)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new pe(F.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");w.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Vo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,ze.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(w)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:c}=function(l,p,m,E,v){const y=W("BITRATE_ADAPTER_TYPE");if(y==="DEFAULT_BITRATE")return{min:E,max:v};if(v===void 0){const D=Math.floor(200*Math.pow(m/15,.6)*Math.pow(l*p/640/360,.75));v=y==="STANDARD_BITRATE"?4*D:2*D,E=E??D}else E=E??Math.floor(v/10);return{min:E,max:v}}(t,n,r,s,i);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,W("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){const[l,p]=function(m,E,v){const y=4*Math.floor(2e5*Math.pow(v/15,.6)*Math.pow(m*E/230400,.75)),D=m*E,A=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),P=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let j=rs(A).call(A).next().value,V=1;if(A.has(D))j=A.get(D);else{var G;const we=rh(G=Array.from(A.entries())).call(G,(bt,ut)=>{let[Yt]=bt,[Ht]=ut;return Yt-Ht}),Ct=we.find(bt=>{let[ut]=bt;return ut>D});if(Ct){const bt=we.indexOf(Ct);if(bt>0){const ut=we[bt-1],Yt=(D-ut[0])/(Ct[0]-ut[0]);j=ut[1]+Yt*(Ct[1]-ut[1])}else j=Ct[1]}else j=we[we.length-1][1]}if(P.has(D))V=P.get(D);else{var Z;const we=rh(Z=Array.from(P.entries())).call(Z,(bt,ut)=>{let[Yt]=bt,[Ht]=ut;return Yt-Ht}),Ct=we.find(bt=>{let[ut]=bt;return ut>D});if(Ct){const bt=we.indexOf(Ct);if(bt>0){const ut=we[bt-1],Yt=(D-ut[0])/(Ct[0]-ut[0]);V=ut[1]+Yt*(Ct[1]-ut[1])}else V=Ct[1]}else V=we[we.length-1][1]}const Q=W("VIDEO_NEW_BITRATE_RATIO");Q&&Q>0&&(j=Q/100);const z=Math.floor(y*j),ie=Math.floor(65e4*Math.pow(m*E/230400,.5)*Math.pow(v/15,.69));let fe=z;const ve=W("VIDEO_STANDARD_BITRATE_VERSION");return ve&&ve>0&&(ve===1?fe=y:ve===2?fe=z:ve===3&&(fe=ie)),[Math.floor(fe/1e3),V]}(t,n,r);this._encoderConfig.bitrateMax=l,this._encoderConfig.bitrateMin=c?Math.min(c,l):l,this._saveEncodeBitrateRatio=p,w.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else w.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r?.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=uL.checkOneElementVisible(s),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const p=Xe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(r){throw new pe(F.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=un(un({},r),Vo(t))),r=hh(r);const i=on(8,"track-video-cloned-"),s=new CF(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,hh(this._scalabilityMode),this._optimizationMode,i,hh(this._hints));return t&&r&&s.setEncoderConfiguration(r),w.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new pe(F.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new pe(F.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(vd(()=>{Xe.reportApiInvoke(null,{name:xn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Tn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!W("ENABLE_VIDEO_SEI")||!W("ENABLE_ENCODED_TRANSFORM"))return void w.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new pe(F.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void w.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):w.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await sn(this,ze.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,ze.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Rs.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Rs.REQUEST_CONSTRAINTS)}},Lt(It.prototype,"play",[tM,nM],Object.getOwnPropertyDescriptor(It.prototype,"play"),It.prototype),Lt(It.prototype,"stop",[rM],Object.getOwnPropertyDescriptor(It.prototype,"stop"),It.prototype),Lt(It.prototype,"setEnabled",[iM,sM,oM],Object.getOwnPropertyDescriptor(It.prototype,"setEnabled"),It.prototype),Lt(It.prototype,"setMuted",[aM,cM,lM],Object.getOwnPropertyDescriptor(It.prototype,"setMuted"),It.prototype),Lt(It.prototype,"setSaveEncodeBitrateRatio",[dM,uM],Object.getOwnPropertyDescriptor(It.prototype,"setSaveEncodeBitrateRatio"),It.prototype),Lt(It.prototype,"setEncoderConfiguration",[hM,pM],Object.getOwnPropertyDescriptor(It.prototype,"setEncoderConfiguration"),It.prototype),Lt(It.prototype,"getStats",[fM],Object.getOwnPropertyDescriptor(It.prototype,"getStats"),It.prototype),Lt(It.prototype,"setBeautyEffect",[mM,_M],Object.getOwnPropertyDescriptor(It.prototype,"setBeautyEffect"),It.prototype),Lt(It.prototype,"getCurrentFrameData",[gM],Object.getOwnPropertyDescriptor(It.prototype,"getCurrentFrameData"),It.prototype),Lt(It.prototype,"getCurrentFrameImage",[EM],Object.getOwnPropertyDescriptor(It.prototype,"getCurrentFrameImage"),It.prototype),Lt(It.prototype,"findClosestProfile",[vM,SM],Object.getOwnPropertyDescriptor(It.prototype,"findClosestProfile"),It.prototype),Lt(It.prototype,"setBitrateLimit",[yM],Object.getOwnPropertyDescriptor(It.prototype,"setBitrateLimit"),It.prototype),Lt(It.prototype,"setOptimizationMode",[TM],Object.getOwnPropertyDescriptor(It.prototype,"setOptimizationMode"),It.prototype),Lt(It.prototype,"setScalabiltyMode",[CM],Object.getOwnPropertyDescriptor(It.prototype,"setScalabiltyMode"),It.prototype),Lt(It.prototype,"updateMediaStreamTrackResolution",[wM],Object.getOwnPropertyDescriptor(It.prototype,"updateMediaStreamTrackResolution"),It.prototype),Lt(It.prototype,"pipe",[RM],Object.getOwnPropertyDescriptor(It.prototype,"pipe"),It.prototype),Lt(It.prototype,"unpipe",[bM],Object.getOwnPropertyDescriptor(It.prototype,"unpipe"),It.prototype),Lt(It.prototype,"close",[IM],Object.getOwnPropertyDescriptor(It.prototype,"close"),It.prototype),Lt(It.prototype,"replaceTrack",[AM],Object.getOwnPropertyDescriptor(It.prototype,"replaceTrack"),It.prototype),It),jy=(OM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),NM=Dn(),PM=yf("CameraVideoTrack","_enabledMutex"),kM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),DM=Dn(),LM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),xM=Dn(),MM=ot({argsMap:e=>[e.getTrackId()]}),Ns=class wF extends mn{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,i,s,o){super(t,Vo(n.encoderConfig),i,s,o),se(this,"_config",void 0),se(this,"_originalConstraints",void 0),se(this,"_constraints",void 0),se(this,"_enabled",!0),se(this,"_deviceName","default"),se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(gf()||xR())&&!function(){const c=xt();if(c.os!==dr.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&aL()&&this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=Vo(this._config.encoderConfig),en.on(Ir.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.on(Ir.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(w.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await As.getDeviceById(t),r={};r.video=un({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Is(r,this.getTrackId())}catch(s){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Is({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await As.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}w.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){w.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:un(un({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Is(n,this.getTrackId())}catch(i){throw w.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Is({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=un({},n.video),w.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Is({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await sn(this,ze.NEED_ENABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await sn(this,ze.NEED_DISABLE_TRACK,this)}catch(r){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new pe(F.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Vo(t),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Cn(this._config);r.encoderConfig=t;const i=Vy(r);(Pr()||Xr()||xo())&&(i.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new pe(F.UNEXPECTED_ERROR,s.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(rn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sn(this,ze.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(w)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Xr()||xo())&&this._enabled&&!this._isClosed&&en.duringInterruption){const t=async()=>{en.off(Ir.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};en.on(Ir.IOS_INTERRUPTION_END,t)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(If.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=As.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await Is({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),en.off(Ir.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),en.off(Ir.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=un(un({},r),Vo(t))),r=hh(r);const i=on(8,"track-cam-cloned-"),s=new wF(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,hh(un(un({},this._config),{},{encoderConfig:r})),hh(this._constraints),hh(this._scalabilityMode),this._optimizationMode,i);return t&&r&&s.setEncoderConfiguration(r),w.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(Rs.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(Rs.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Lt(Ns.prototype,"setDevice",[OM,NM],Object.getOwnPropertyDescriptor(Ns.prototype,"setDevice"),Ns.prototype),Lt(Ns.prototype,"setEnabled",[PM,kM,DM],Object.getOwnPropertyDescriptor(Ns.prototype,"setEnabled"),Ns.prototype),Lt(Ns.prototype,"setEncoderConfiguration",[LM,xM],Object.getOwnPropertyDescriptor(Ns.prototype,"setEncoderConfiguration"),Ns.prototype),Lt(Ns.prototype,"close",[MM],Object.getOwnPropertyDescriptor(Ns.prototype,"close"),Ns.prototype),Ns);function Eb(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=un(un({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?w.debug("[".concat(e,"] set content hint to"),n.optimizationMode):w.debug("[".concat(e,"] set content hint failed")))):w.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var UM,VM,jM,FM,eo,BM,WM,GM,HM,KM,zM,ii;class YM extends XL{getUserId(){return this._userId}constructor(t,n,r,i){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(on(5,""))),se(this,"_userId",void 0),se(this,"_uintId",void 0),se(this,"_isDestroyed",!1),se(this,"store",void 0),se(this,"processor",void 0),se(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,w.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let kf=(UM=ot({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),VM=ot({argsMap:e=>[e.getTrackId()]}),jM=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FM=ot({argsMap:e=>[e.getTrackId()]}),Lt((eo=class extends YM{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Br.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"trackMediaType",Af.VIDEO),se(this,"_videoWidth",void 0),se(this,"_videoHeight",void 0),se(this,"_player",void 0),se(this,"_prePlayer",void 0),se(this,"processorDestination",void 0),se(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new ax(this.getTrackId(),"remote"),this.processorDestination=new ox(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return vd(()=>{w.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ts(this,ze.GET_STATS)||un({},YL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Zs.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=un(un({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new _b(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(n)):this._player=new gb(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Zs.FIRST_FRAME_DECODED),i&&this.safeEmit(Zs.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(Zs.VIDEO_STATE_CHANGED,s)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Zs.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Zs.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){dx(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Iy)}_updatePlayerSource(){w.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=uL.checkOneElementVisible(i),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const l=Xe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(n){throw new pe(F.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(_h.SEI_RECEIVED,e)}}).prototype,"play",[UM],Object.getOwnPropertyDescriptor(eo.prototype,"play"),eo.prototype),Lt(eo.prototype,"stop",[VM],Object.getOwnPropertyDescriptor(eo.prototype,"stop"),eo.prototype),Lt(eo.prototype,"pipe",[jM],Object.getOwnPropertyDescriptor(eo.prototype,"pipe"),eo.prototype),Lt(eo.prototype,"unpipe",[FM],Object.getOwnPropertyDescriptor(eo.prototype,"unpipe"),eo.prototype),eo),Df=(BM=ot({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),WM=ot({argsMap:(e,t)=>[e.getTrackId(),t]}),GM=ot({argsMap:e=>[e.getTrackId()]}),HM=ot({argsMap:e=>[e.getTrackId()]}),KM=ot({argsMap:(e,t)=>[e.getTrackId(),t.name]}),zM=ot({argsMap:e=>[e.getTrackId()]}),Lt((ii=class extends YM{get isPlaying(){return this._useAudioElement?Oi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),se(this,"trackMediaType",Af.AUDIO),se(this,"_source",void 0),se(this,"_useAudioElement",!0),se(this,"_volume",100),se(this,"processorContext",void 0),se(this,"processorDestination",void 0),se(this,"_played",!1),se(this,"_bypassWebAudio",!1),W("DISABLE_WEBAUDIO")?(this._source=new fb,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ZL(e,!0),W("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ws.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Zs.FIRST_FRAME_DECODED)}),this.processorContext=new lx(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new cx(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ws.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ws.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ws.ON_AUDIO_BUFFER),this._source.on(ws.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Oi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!GL())throw new pe(F.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Oi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return vd(()=>{w.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ts(this,ze.GET_STATS)||un({},zL)}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] use audio element to play")),Oi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Oi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Oi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new pe(F.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_i.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(_i.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_i.ON_TRACK),this.processorDestination.removeAllListeners(_i.ON_NODE)}}).prototype,"setVolume",[BM],Object.getOwnPropertyDescriptor(ii.prototype,"setVolume"),ii.prototype),Lt(ii.prototype,"setPlaybackDevice",[WM],Object.getOwnPropertyDescriptor(ii.prototype,"setPlaybackDevice"),ii.prototype),Lt(ii.prototype,"play",[GM],Object.getOwnPropertyDescriptor(ii.prototype,"play"),ii.prototype),Lt(ii.prototype,"stop",[HM],Object.getOwnPropertyDescriptor(ii.prototype,"stop"),ii.prototype),Lt(ii.prototype,"pipe",[KM],Object.getOwnPropertyDescriptor(ii.prototype,"pipe"),ii.prototype),Lt(ii.prototype,"unpipe",[zM],Object.getOwnPropertyDescriptor(ii.prototype,"unpipe"),ii.prototype),ii);const Tc=new class extends bn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),se(this,"_lastHiddenTime",0),se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),w.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class qM extends bn{constructor(t,n){super(),se(this,"trackMediaType",Af.DATA),se(this,"_version",1),se(this,"_type",3),se(this,"_config",void 0),se(this,"_originDataChannel",void 0),se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),se(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),se(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return W("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new je((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;n(new pe(F.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new pe(F.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new pe(F.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[My.OPEN,My.CLOSE,My.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class UK extends qM{constructor(t){super(t),se(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(W("SHOW_DATASTREAM2_LOG")&&w.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(My.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class VK extends qM{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function Fy(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>jS.revokeObjectURL(e),0),new Worker(jS.createObjectURL(e))}const XM=71,vb=1,Sb=2,yb=1,JM=2;var Td=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Td||{});function Tb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==XM)return;const r=e.getUint16(1),i=vb+Sb+r,s=new Uint8Array(e.byteLength-i);s.set(new Uint8Array(e.buffer,i,e.byteLength-i));const o={m:n,tlvLen:r,tlv:[],frame:s};let c=vb+Sb;for(;c<i;){const l=e.getUint8(c),p=e.getUint16(c+yb),m=yb+JM;if(l===Td.AUDIO_LEVEL){let E=e.getUint8(c+m);for(let v=1;v<p;v++)E=E<<8|e.getUint8(c+m+v);o.tlv.push({tag:l,length:p,value:t?127^E>>1:127&E})}else if(l===Td.METADATA||l===Td.AUDIO_64_BIT_PTS){const E=new Uint8Array(p);for(let v=0;v<p;v++)E[v]=e.getUint8(c+m+v);o.tlv.push({tag:l,length:p,value:E})}c+=m+p}return o}const By=new Map,Wy=127,vh=1e-10,Cb=139/13,Gy=new Map;function wb(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;return Gy.has(r)?i=Gy.get(r):(i=Math.log(function(o,c){const l=o-c;c<l&&(c=l);let p=1;for(let m=o,E=1;m>c;m--,E++)p=p*m/E;return p}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,Gy.set(r,i)),i<vh&&(i=vh),i}function QM(e,t,n){const r=t.length,i=e.length/r;let s=!1;for(let o=0,c=0;o<r;o++){let l=0;for(let p=c+i;c<p;c++)e[c]>n&&l++;t[o]!==l&&(t[o]=l,s=!0)}return s}window.cache=Gy;let jK=0;class $M{constructor(t){se(this,"id",void 0),se(this,"immediates",[]),se(this,"lastNonSilence",-1),se(this,"immediateSpeechActivityScore",vh),se(this,"lastLevelChangedTime",Date.now()),se(this,"levels",[]),se(this,"longs",[]),se(this,"longSpeechActivityScore",vh),se(this,"mediums",[]),se(this,"mediumSpeechActivityScore",vh),se(this,"minLevel",0),se(this,"nextMinLevel",0),se(this,"nextMinLevelWindowLength",0),se(this,"energyScore",0),this.id=t||"".concat(jK++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+Cb;let i=!1;for(let s=0;s<t.length;++s){let o=n[s];o<r&&(o=0);const c=Math.floor(o/Cb);t[s]!==c&&(t[s]=c,i=!0)}return i}computeLongs(){return QM(this.mediums,this.longs,4)}computeMediums(){return QM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=wb(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=wb(this.longs[0],10,47),this.longSpeechActivityScore>vh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=wb(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Ru(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>Wy&&(r=Wy),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+Cb?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>Wy&&(n=Wy),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class FK{constructor(t){se(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Rb{constructor(t,n,r){se(this,"isDominant",void 0),se(this,"energyRanking",void 0),se(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class BK extends bn{constructor(t){super(),se(this,"dominantId",null),se(this,"lastDecisionTime",0),se(this,"lastLevelChangedTime",0),se(this,"lastLevelIdleTime",0),se(this,"relativeSpeechActivities",[]),se(this,"speakers",new Map),se(this,"enableSilence",!1),se(this,"timeoutToSilenceInterval",0),se(this,"decisionMaker",null),se(this,"loudest",[]),se(this,"numLoudestToTrack",3),se(this,"energyExpireTimeMs",250),se(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const s=i.levelChanged(n,r);return this.updateLoudestList(i,s,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new $M(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const i=t.id===this.dominantId;if(n<0){let l=0;for(;l<this.loudest.length&&this.loudest[l]!==t;)++l;return new Rb(i,l,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new Rb(i,0,t.energyScore);const s=r-this.energyExpireTimeMs;let o=0;for(;o<this.loudest.length;){const l=this.loudest[o];if(l.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(l.id!==t.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<t.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Rb(i,c,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new FK(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const i=this.speakers.size;let s=null;if(i===0)s=null;else if(i===1){var o;const c=rs(o=this.speakers).call(o).next().value;this.enableSilence&&c&&(s=c.id,c.evaluateSpeechActivityScores(t),t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){const m=this.speakers.entries().next();m.value&&(s=m.value[0],c=m.value[1])}else s=c.id;c?.evaluateSpeechActivityScores(t);const l=this.relativeSpeechActivities;let p=2;for(const m of this.speakers.entries()){const[E,v]=m;if(v===c)continue;v.evaluateSpeechActivityScores(t);for(let P=0;P<l.length;++P){const j=c==null?vh:c.getSpeechActivityScore(P);l[P]=Math.log(v.getSpeechActivityScore(P)/j)}const y=l[0],D=l[1],A=l[2];y>3&&D>2&&A>0&&D>p&&(p=D,s=E)}this.enableSilence&&c!=null&&s===c.id&&t-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const n=[];for(const i of rs(r=this.speakers).call(r)){var r;const s=t-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?n.push(i.id):300<s&&i.levelTimedOut()}n.forEach(i=>this.speakers.delete(i))}}const Lf=new Map;let ya=null,Hy=null;const ZM=3;let Sh=[];const Ta=new Map,Ky=new Map;class WK{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){se(this,"id",void 0),se(this,"track",void 0),se(this,"score",0),se(this,"active",!0),se(this,"muted",!1),se(this,"timer",0),se(this,"actives",0),se(this,"inactives",0),this.id=t,this.track=n,this.setActive(Ta.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=function(){const i=[],s=[];return Array.from(rs(Ta).call(Ta)).forEach(o=>{o.active?i.push(o):s.push(o)}),{actives:i,inactives:s}}();if(n.length>3){let i;n.forEach(s=>{(!i||i.score>s.score)&&(i=s)}),i&&i.setActive(!1)}if(n.length<3&&r.length>0){let i;r.forEach(s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let r;return Array.from(rs(Ta).call(Ta)).forEach(i=>{!i.active||i.id===n||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let r;return Array.from(rs(Ta).call(Ta)).forEach(i=>{i.active||i.id===n||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let zy;function eU(e){const t=Ta.get(e);t&&(Ta.delete(e),t.clearTimer())}const Yy=new Map,GK=new Map,bb="video/h264",Ib="video/h265";function tU(e,t,n){let r=new Uint8Array(e,t,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}function nU(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function rU(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?Ib:(31&r)<=31?bb:""}const qy=new Map,Fg=new Map;(function(){const e=xt();br.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),br.getStreamFromExtension=e.name===Wt.CHROME&&Number(e.version)>34,br.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),br.supportMinBitrate=e.name===Wt.CHROME||e.name===Wt.EDGE,br.supportSetRtpSenderParameters=function(){const t=xt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!dl()||!(!Pr()&&!Cy())||t.name===Wt.FIREFOX&&Number(t.version)>=64)}(),e.name===Wt.SAFARI&&(Number(e.version)>=14?br.supportDualStream=!0:br.supportDualStream=!1),br.webAudioMediaStreamDest=function(){const t=xt();return!(t.name===Wt.SAFARI&&Number(t.version)<12)}(),br.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",br.supportWebGL=typeof WebGLRenderingContext<"u",br.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,dl()||(br.webAudioWithAEC=!0),br.supportShareAudio=function(){const t=xt();return(t.os===dr.WIN_10||t.os===dr.WIN_81||t.os===dr.WIN_7||t.os===dr.LINUX||t.os===dr.MAC_OS||t.os===dr.CHROMIUM_OS)&&t.name===Wt.CHROME&&Number(t.version)>=74}(),br.supportDataChannel=!!(_f(76)||kR(68)||nL(14)),br.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Nn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),br.supportWebRTCEncodedTransform=_f(87)||ZD()||kR(117),br.supportWebRTCInsertableStream=function(){const t=xt();return(t.name===Wt.CHROME||t.name===Wt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),br.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,br.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,by(()=>{br.supportDualStreamEncoding=function(){const t=xt();return!!W("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&W("CHROME_DUAL_STREAM_USE_ENCODING"))}(),w.debug("browser ua: ",navigator.userAgent),w.info("browser info: ",e),w.info("browser compatibility: ",br)})})();const HK=["CHINA","GLOBAL"],iU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],yh=[],xf=[];function Th(e,t){return!!t&&yh.some(n=>n.uid===e&&n.channelName===t)}function Ab(){return xf.length>0}var KK=Ek.forEach,sU=vu("forEach")?[].forEach:function(e){return KK(this,e,arguments.length>1?arguments[1]:void 0)};qt({target:"Array",proto:!0,forced:[].forEach!==sU},{forEach:sU});var zK=Qi("Array","forEach"),YK=Jo,qK=mr,XK=Y,JK=zK,Ob=Array.prototype,QK={DOMTokenList:!0,NodeList:!0},$K=function(e){var t=e.forEach;return e===Ob||XK(Ob,e)&&t===Ob.forEach||qK(QK,YK(e))?JK:t},ZK=S($K),ez=Eo,oU=Ri;qt({target:"Object",stat:!0,forced:T(function(){oU(1)})},{keys:function(e){return oU(ez(e))}});var tz=S(Qr.Object.keys),nz=S(zn),rz=S(wu),iz=qt,aU=Qo,sz=Nr,oz=fr,cU=Um,az=qa,cz=ps,lz=pw,dz=An,uz=Tr,hz=ck("slice"),pz=dz("species"),Nb=Array,fz=Math.max;iz({target:"Array",proto:!0,forced:!hz},{slice:function(e,t){var n,r,i,s=cz(this),o=az(s),c=cU(e,o),l=cU(t===void 0?o:t,o);if(aU(s)&&(n=s.constructor,(sz(n)&&(n===Nb||aU(n.prototype))||oz(n)&&(n=n[pz])===null)&&(n=void 0),n===Nb||n===void 0))return uz(s,c,l);for(r=new(n===void 0?Nb:n)(fz(l-c,0)),i=0;c<l;c++,i++)c in s&&lz(r,i,s[c]);return r.length=i,r}});var mz=Qi("Array","slice"),_z=Y,gz=mz,Pb=Array.prototype,Ez=function(e){var t=e.slice;return e===Pb||_z(Pb,e)&&t===Pb.slice?gz:t},vz=S(Ez);function qe(e,t,n,r,i){var s,o,c,l={};return ZK(s=tz(r)).call(s,function(p){l[p]=r[p]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=nz(o=rz(c=vz(n).call(n)).call(c)).call(o,function(p,m){return m(e,t,p)||p},l),i&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(i):void 0,l.initializer=void 0),l.initializer===void 0?(ik(e,t,l),null):l}let Xy=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),kb=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),jo=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),gi=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),rt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),hn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ht=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),lt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),Bg=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Pt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Ei=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),vt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Jy(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw w.error("Invalid Channel Name ".concat(e)),new ae(F.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Qy(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||dL(e,1,255)))throw new ae(F.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&w.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let hl=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Sz={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Db={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Lb(e,t){wr(e.url,"".concat(t,".url"),1,1e3,!1),Pn(e.x)||nn(e.x,"".concat(t,".x"),0,1e4),Pn(e.y)||nn(e.y,"".concat(t,".y"),0,1e4),Pn(e.width)||nn(e.width,"".concat(t,".width"),0,1e4),Pn(e.height)||nn(e.height,"".concat(t,".height"),0,1e4),Pn(e.zOrder)||nn(e.zOrder,"".concat(t,".zOrder"),0,255),Pn(e.alpha)||nn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const yz={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Cd=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),xb=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),er=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function lU(e){if(!e.channelName)throw new ae(F.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ae(F.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&wr(e.token,"info.token",1,2047),Qy(e.uid),Jy(e.channelName),!0}let vi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),pl=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ki=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Mf=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Qt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),gr=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),$y=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ur=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),zt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const dU=[zt.AFRICA,zt.ASIA,zt.CHINA,zt.EUROPE,zt.GLOBAL,zt.INDIA,zt.JAPAN,zt.NORTH_AMERICA,zt.OCEANIA,zt.OVERSEA,zt.SOUTH_AMERICA];let Wr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const Zy={CHINA:{},ASIA:{CODE:Wr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Wr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Wr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Wr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Wr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Wr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Wr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Wr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Wr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Wr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Wr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Wr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Wr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};$R&&(Zy.CHINA={CODE:Wr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Wg=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function uU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class hU extends bn{constructor(t,n){super(),M(this,"onICEConnectionStateChange",void 0),M(this,"onConnectionStateChange",void 0),M(this,"onDTLSTransportStateChange",void 0),M(this,"onDTLSTransportError",void 0),M(this,"onICETransportStateChange",void 0),M(this,"onFirstAudioReceived",void 0),M(this,"onFirstVideoReceived",void 0),M(this,"onFirstAudioDecoded",void 0),M(this,"onFirstVideoDecoded",void 0),M(this,"onFirstVideoRender",void 0),M(this,"onFirstVideoDecodedTimeout",void 0),M(this,"onSelectedLocalCandidateChanged",void 0),M(this,"onSelectedRemoteCandidateChanged",void 0),M(this,"onICECandidateError",void 0),M(this,"getLocalVideoStats",void 0)}}class pU extends hU{constructor(t,n){super(t,n),M(this,"establishPromise",void 0)}}let We=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Gr=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),fl=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const fU=["disconnected","failed"];let Te=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Jt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),tt=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Fo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Bo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Er=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),mU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Cc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),to=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ca=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Uf=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Vn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Vf=function(e){return e.ABORT="abort",e}({}),wd=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Tz=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Cz={[Xy.ACCESS_POINT]:{[gi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[gi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[gi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[gi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[gi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[gi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[gi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Xy.UNILBS]:{[jo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[jo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[jo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[jo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[jo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[jo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[jo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[jo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[jo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[jo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[jo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[jo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Xy.STRING_UID_ALLOCATOR]:{[kb.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[kb.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[kb.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function jf(e){const t=Cz[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Xy.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const wz={[rt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[rt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[rt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[rt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[rt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[rt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[rt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[rt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[rt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[rt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[rt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[rt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[rt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[rt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[rt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[rt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[rt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[rt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[rt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[rt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[rt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[rt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[rt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[rt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[rt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[rt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[rt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[rt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[rt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[rt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[rt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[rt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[rt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[rt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[rt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[rt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[rt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[rt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[rt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[rt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[rt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[rt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[rt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[rt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[rt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[rt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[rt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[rt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[rt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[rt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[rt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[rt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[rt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[rt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[rt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[rt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[rt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[rt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[rt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[rt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[rt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[rt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[rt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Gg(e){return wz[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function _U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Mb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_U(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_U(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Ub(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:i}=e;if(t){const s=W("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const Rz=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,bz=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Iz=/wss:\/\/(.+):([0-9]+)\/?/,Az=/wss:\/\/(.[^\/]+)\/?/;let Oz=0;class Nz{constructor(t,n){M(this,"id",0),M(this,"store",void 0),M(this,"recordIndex",void 0),M(this,"websockets",[]),M(this,"try443PortDuration",2e3),M(this,"forceCloseWSDuration",5e3),M(this,"try443PortTimeout",null),M(this,"forceCloseTimeout",null),M(this,"isTry443PortFailed",!1),M(this,"isNormalPortFailed",!1),M(this,"useDoubleDomain",!1),M(this,"useProxy",!1),M(this,"startTime",Date.now()),this.id=++Oz,this.try443PortDuration=W("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];w.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const i=W("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=i.find(v=>{var y;return Ae(y=t.host).call(y,v)});c||(this.useDoubleDomain=!1);const l=[];if(this.useDoubleDomain)i.forEach(v=>{l.push(Ub(Mb(Mb({},t),{},{host:t.host.replace(c,v)}),n))});else{const v=Mb({},t);if(n&&c){const y=i.find(D=>D!==c);y&&(v.host=v.host.replace(c,y))}l.push(Ub(v,n))}try{l.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",o.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),o.forEach(y=>y.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new ae(F.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const p=Ig();this.store&&this.store.recordJoinChannelService({urls:o.map(v=>v.url),service:"gateway"},this.recordIndex),o.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,p.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(v.readyState));const D=o.every(A=>A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(D)),D&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(y.reason)),p.reject({code:y.code,reason:$y.A_ROUND_WS_FAILED})):!n&&D&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=D:this.isNormalPortFailed=D},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...o);const m=()=>{this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())},E=()=>{if(p.isResolved)return m();xt().os===dr.MAC_OS&&Nn()&&m(),this.createWebSocket(t,!0,!0).then(v=>{p.resolve(v)}).catch(v=>{this.isNormalPortFailed&&p.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",p.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,n,r,i){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(s){let o,c,l;return[,o,c,l]=s.match(Rz)||[],o||([,c,l]=s.match(bz)||[]),c&&l||([,c,l]=s.match(Iz)||[]),c&&l||([,c]=s.match(Az)||[]),c||w.warning("un-destructible url: ",s),{proxy:o,host:c,port:l||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(w.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function gU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class EU extends bn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Ae(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(vt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(vt.CONNECTED):this._state==="closed"?this.emit(vt.CLOSED):this._state==="failed"&&this.emit(vt.FAILED))}resetReconnectCount(t){w.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),M(this,"_websocketUrl",null),M(this,"connectionID",0),M(this,"currentURLIndex",0),M(this,"urls",[]),M(this,"_reconnectMode","tryNext"),M(this,"reconnectReason",void 0),M(this,"_initMutex",void 0),M(this,"name",void 0),M(this,"_state","closed"),M(this,"reconnectInterrupter",void 0),M(this,"websocket",void 0),M(this,"retryConfig",void 0),M(this,"reconnectCount",0),M(this,"forceCloseTimeout",5e3),M(this,"onlineReconnectListener",void 0),M(this,"useCompress",void 0),M(this,"tryDoubleDomain",!1),M(this,"use443PortOnly",!1),M(this,"wsInflateLength",0),M(this,"wsDeflateLength",0),M(this,"closeEstablishingWs",()=>{}),M(this,"store",void 0),M(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=t,this.retryConfig=function(E){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?gU(Object(y),!0).forEach(function(D){M(E,D,y[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(y)):gU(Object(y)).forEach(function(D){Object.defineProperty(E,D,Object.getOwnPropertyDescriptor(y,D))})}return E}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new Fr("websocket",o?o.clientId:void 0);const{timeout:c,timeoutFactor:l}=n,p=Math.max(300,Math.floor(3*c/5)),m=Math.max(1.2,Math.floor(8*l)/10);os.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m),Gn.on(Ef.NETWORK_STATE_CHANGE,(E,v)=>{E!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(E)),E===os.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var i;const s=Ig(),o=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(c){return!(Dy()||W("USE_NEW_TOKEN")||!W("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(mU.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(vt.CLOSED,()=>{s.reject(new pe(F.WS_DISCONNECT))}),this.once(vt.CONNECTED,s.resolve),await s.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void w.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),w.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new pe(F.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new pe(F.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=Ig();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=m=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),w.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async m=>{var E;if(w.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new pe(F.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const v=Ts(this,vt.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,y=await this.reconnectWithAction(v);if(this.state==="closed")return void w.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return r.reject(new pe(F.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);r.resolve()}},o=m=>{this.emit(vt.ON_MESSAGE,m)},c=m=>{w.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),W("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=W("GATEWAY_WSS_ADDRESS")),w.debug("[".concat(this.name,"] start connect, url:"),t);const l=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;this._websocketUrl=Ub(t);const m=await this.chooseBestWebsocketConnection(t);this.websocket=m,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},l),this.joinGatewayRecordIndex=l}catch(m){const E=this.state==="closed",v=m instanceof pe,y=v&&m.code===F.WS_ABORT,D=v&&m.code===F.WS_ERR,A=v?m.message:m&&(m.reason||m.toString());w.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[m]},l),E||D?(r.reject(E?new pe(F.WS_DISCONNECT,"websocket is closed: ".concat(A)):new pe(F.WS_ERR,"init websocket failed: ".concat(A))),D&&w.error("[".concat(this.name,"] init websocket failed: ").concat(A))):s&&s(m)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;w.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Gn.isOnline||!Gn.onlineWaiter||(this.onlineReconnectListener=Gn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const o=HR(this.reconnectCount,this.retryConfig);w.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(t)),await je.race([Rr(o),this.onlineReconnectListener||new je(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(o,c)=>{this.emit(vt.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);w.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(w.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Dr(this,vt.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(o){var s;w.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&Ae(c).call(c,"dynamic key expired")?(this.emit(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class Vb extends EU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=Ig(),i=function(o,c){return new Nz(o,c)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new pe(F.WS_ABORT,"choose best websocket aborted"))};const s=W("GATEWAY_DOMAINS");return w.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Hg extends EU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new je((r,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),o.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),i(new pe(F.WS_ABORT,"choose best websocket aborted"))};const c=W("GATEWAY_DOMAINS");let l;const p=t.indexOf("?h="),m=c.find(D=>p!==-1?Ae(t).call(t,D,p):Ae(t).call(t,D));w.debug("[choose-best-ws] currentDomain: ",m,", domains: ",c);let E=!this.tryDoubleDomain||!m;if(!E&&m){var v;const D=Date.now();try{c.forEach(A=>{const P=p===-1?t.replace(m,A):t.substr(0,p)+t.substr(p).replace(m,A),j=new WebSocket(P);j.binaryType="arraybuffer",o.push(j),w.debug("[choose-best-ws] ws is connecting:",j.url)})}catch{for(w.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(P=>P.close());o.length;)o.pop();E=!0}(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:o.map(A=>A.url),service:"gateway"},n),o.forEach(A=>{A.onopen=()=>{if(s)return;const P=Date.now()-D;w.debug("[choose-best-ws] ws open cost ".concat(P,"ms")),o.filter(j=>j!==A).forEach(j=>{w.debug("[choose-best-ws]close backup websocket: ".concat(j.url)),j.close()}),s=!0,r(A)},A.onclose=P=>{l=P,!s&&(o.find(j=>!(j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING))||(w.debug("[choose-best-ws] all websocket is closed"),s=!0,i(l)))},A.onmessage=P=>{w.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(P.data))}}),Rr(this.forceCloseTimeout).then(()=>{o.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(E){var y;let D;w.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},n);try{D=new WebSocket(t),o.push(D),D.binaryType="arraybuffer"}catch(A){const P=new pe(F.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return w.error("[".concat(this.name,"]").concat(P)),void i(P)}D.onopen=()=>{r(D)},D.onclose=A=>{i(A)},D.onmessage=A=>{w.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(A.data))},Rr(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class Pz extends bn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===hn.CONNECTED?this.emit(ht.WS_CONNECTED):t===hn.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===hn.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),M(this,"_disconnectedReason",void 0),M(this,"_websocketReconnectReason",void 0),M(this,"_connectionState",hn.CLOSED),M(this,"reconnectToken",void 0),M(this,"websocket",void 0),M(this,"openConnectionTime",void 0),M(this,"clientId",void 0),M(this,"lastMsgTime",Date.now()),M(this,"uploadCache",[]),M(this,"uploadCacheInterval",void 0),M(this,"rttRolling",new bL(5)),M(this,"pingpongTimer",void 0),M(this,"wsInflateDataTimer",void 0),M(this,"pingpongTimeoutCount",0),M(this,"ortc",void 0),M(this,"joinResponse",void 0),M(this,"multiIpOption",void 0),M(this,"initError",void 0),M(this,"spec",void 0),M(this,"store",void 0),M(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Xt.UID_BANNED);break;case 15:this.close(Xt.IP_BANNED);break;case 16:this.close(Xt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case rt.ERR_LICENSE_MISSING:this.close(Xt.LICENSE_MISSING);break;case rt.ERR_LICENSE_EXPIRED:this.close(Xt.LICENSE_EXPIRED);break;case rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xt.LICENSE_MINUTES_EXCEEDED);break;case rt.ERR_LICENSE_PERIOD_INVALID:this.close(Xt.LICENSE_PERIOD_INVALID);break;case rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xt.LICENSE_MULTIPLE_SDK_SERVICE);break;case rt.ERR_LICENSE_ILLEGAL:this.close(Xt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Vb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hn.CONNECTED&&this.reconnect("retry",kr.OFFLINE)})}async request(t,n,r,i){const s=on(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new je((D,A)=>{if(this.connectionState===hn.CONNECTED)return D();const P=()=>{this.off(ht.WS_CLOSED,j),D()},j=()=>{this.off(ht.WS_CONNECTED,P),A(new ae(F.WS_ABORT))};this.once(ht.WS_CONNECTED,P),this.once(ht.WS_CLOSED,j),t!==lt.PUBLISH&&t!==lt.PUBLISH_DATASTREAM&&t!==lt.SUBSCRIBE&&t!==lt.SUBSCRIBE_DATASTREAM&&t!==lt.UNSUBSCRIBE&&t!==lt.UNSUBSCRIBE_DATASTREAM&&t!==lt.UNPUBLISH&&t!==lt.UNPUBLISH_DATASTREAM&&t!==lt.CONTROL&&t!==lt.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{A(new ae(F.DISCONNECT_P2P))}),t!==lt.PUBLISH&&t!==lt.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{A(new ae(F.DISCONNECT_P2P))})});if(this.connectionState!==hn.CONNECTING&&this.connectionState!==hn.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const p=new je((D,A)=>{let P=!1;const j=(G,Z)=>{P=!0,D({isSuccess:G==="success",message:Z||{}}),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.emit(ht.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),j);const V=()=>{A(new ae(F.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.off("res-@".concat(s),j)};this.once(ht.WS_CLOSED,V),this.once(ht.WS_RECONNECTING,V),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||P||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===hn.CLOSED||t===lt.LEAVE)throw new ae(F.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?D.throw():t===lt.JOIN||t===lt.REJOIN?null:(await l(),await this.request(t,n))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=Gg(E),y=new ae(F.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:v.desc});return v.action==="success"?m.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===rt.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",kr.MULTI_IP)):this.reconnect(v.action,kr.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new je(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Bg.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new je((n,r)=>{this.once(ht.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ht.WS_CLOSED,i=>r(this.initError||new ae(F.WS_ABORT,i))),this.connectionState=hn.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Xt.LEAVE,this.connectionState=hn.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Dr(this,ht.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(lt.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(ht.REPORT_JOIN_GATEWAY,$y.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ae(F.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=kg(this,ht.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(lt.REJOIN,t);return!!n&&(this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Pt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Pt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Pt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Pt.MUTE_AUDIO,{uid:r.uid}):this.emit(Pt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Pt.MUTE_VIDEO,{uid:r.uid}):this.emit(Pt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Pt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Pt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Pt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Pt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(lt.DOWNGRADE_CODEC,n)}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Gg(t.code);if(t.code===28&&"detail"in t&&(w.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ht.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xt.UID_BANNED),void this.close()):void this.reconnect(n.action,kr.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",kr.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),W("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Bg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(vt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(vt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(vt.CLOSED,()=>{this.connectionState=hn.CLOSED}),this.websocket.on(vt.FAILED,()=>{this._disconnectedReason=Xt.NETWORK_ERROR,this.connectionState=hn.CLOSED}),this.websocket.on(vt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===hn.CONNECTED?this.connectionState=hn.RECONNECTING:this.connectionState=hn.CONNECTING}),this.websocket.on(vt.WILL_RECONNECT,(t,n,r)=>{const i=kg(this,ht.IS_P2P_DISCONNECTED),s=i||t!=="retry";i&&t==="retry"&&(w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=$y.P2P_DISCONNECTED),s&&(w.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ht.REPORT_JOIN_GATEWAY,n||$y.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ht.DISCONNECT_P2P)),r(t)}),this.websocket.on(vt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",kr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ae){if(t.code===F.UNEXPECTED_RESPONSE&&t.data.code===rt.ERR_NO_AUTHORIZED)return this.initError=new ae(F.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Xt.TOKEN_EXPIRE);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",kr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(vt.REQUEST_NEW_URLS,(t,n)=>{Dr(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(mU.PRE_CONNECT_PC,()=>{this.emit(ht.PRE_CONNECT_PC)})}}let kz=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Hn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function vU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function eT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vU(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Rd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(W("TURN_DOMAIN")):(w.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function tT(e){try{const t=W("GATEWAY_DOMAINS").concat(W("TURN_DOMAIN")).find(n=>Ae(e).call(e,n));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return w.debug("serverUrlToIp error, fallback to url",e),e}}function jb(e,t){e.addresses||(e.addresses=[]);const n=function(c,l){if(W("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map(E=>{let{ip:v,port:y}=E;return{address:"".concat(v,":").concat(y)}});const p=W("GATEWAY_DOMAINS");let m=p[1]&&Ae(l).call(l,p[1])?1:0;return c.map(E=>{let{domain_prefix:v,port:y,ip:D}=E;if(v)return{address:"".concat(v,".").concat(p[m++%p.length],":").concat(y)};const A=/^[\.\:\d]+$/.test(D),P=A?"".concat(D.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(y):"".concat(D,":").concat(y);return A||w.debug("Cannot recognized as ip address: ".concat(D,", use as host3")),{ip:D,port:y,address:P}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const c=r.split(";");for(let l=0;l<c.length;l++){var i;const p=ri(i=c[l]).call(i);n[l]&&p&&(n[l].ip6=p)}}const s=e.detail&&e.detail.candidate;let o;if(s){const[c,l]=s.split(":");c&&l&&(o={port:Number(l),ip:c,address:"".concat(c,":").concat(l)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function as(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function SU(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(as(t.width),"x").concat(as(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function yU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Kg(e,t){let n,r,i;switch(t){case Hn.CHOOSE_SERVER:r=4096,i="choose server";break;case Hn.CLOUD_PROXY:r=1048576,i="proxy";break;case Hn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Hn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new ae(F.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>eT(eT({},o),{},{ticket:s.buffer.cert})),server_ts:e.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:eT(eT({},s.buffer.detail),e.detail),flag:s.buffer.flag,opid:e.opid,cert:s.buffer.cert})}),!n)throw new ae(F.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function TU(e,t){return await je.all(e.addresses.map(async n=>({address:Rd(n.ip),tcpport:n.port,udpport:n.port,username:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Lr.username,password:t&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await FR(t.toString()):Lr.password})))}function Fb(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(as(e.height),as(e.width)),1):(w.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function bd(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:s,protocol:o}=e;const c={candidateType:t,relayProtocol:n,protocol:o};if(r!=="local-candidate"){const l=i.split(".");l.length>=4&&(l[1]="*",l[2]="*"),c.address=l.join("."),c.port=s}return c}function Ch(e){const t=e.split(":"),n=e.split(/[-.]/),r=Ae(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function nT(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W("SVC_MODE");if(W("ENABLE_SVC"))return function(t){return t in Ny}(e)?e:Ny.L1T3}const CU={[We.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[We.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function rT(e,t,n){t.forEach(r=>{var i;const s=CU[e].find(c=>{var l;let{key:p}=c;return Ae(l=r.extensionName).call(l,p)});if(!s)return;const o=n.find(c=>{let{extensionName:l}=c;return Ae(l).call(l,s.key)});o&&Ae(i=o.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=o.extensionName)})}function Ff(e,t){t.forEach(n=>{var r;const i=CU[e].find(s=>{var o;let{key:c}=s;return Ae(o=n.extensionName).call(o,c)});Ae(r=n.extensionName).call(r,"gdpr_forbidden")&&i&&(n.extensionName=i.extensionName)})}function wU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ae(e).call(e,"abs-send-time")}function iT(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ae(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function RU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function bU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RU(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function zg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:l,unsupportedVideoUplinkCodec:p,unsupportedVideoDownlinkCodec:m}=t,{useXR:E}=n;let v=[],y=[],D=[],A=[],P=!1,j=!1;if(Gi(e).mediaDescriptions.forEach(G=>{r&&r!==G.attributes.direction||(G.media.mediaType!=="video"||P||(y=G.attributes.payloads,A=G.attributes.extmaps,P=!0),G.media.mediaType!=="audio"||j||(v=G.attributes.payloads,D=G.attributes.extmaps,j=!0))}),!A||y.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!D||v.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(G=>{var Z;(Z=G.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),E&&G.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(G=>{var Z;(Z=G.rtpMap)!==null&&Z!==void 0&&Z.clockRate&&(G.rtpMap.clockRate=parseInt(G.rtpMap.clockRate)),E&&G.rtcpFeedbacks.push({type:"rrtr"})}),i&&(v=v.filter(G=>{var Z;return((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"}),y=y.filter(G=>{var Z;return((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())!=="rtx"})),s){const G=y.filter(z=>{var ie;return/(red)|(ulpfec)|(flexfec)/i.test(((ie=z.rtpMap)===null||ie===void 0?void 0:ie.encodingName)||"")}),Z=Ad(G,y).map(z=>z.payloadType),Q=[...G.map(z=>z.payloadType),...Z];y=y.filter(z=>!Ae(Q).call(Q,z.payloadType))}if(o&&(v=v.filter(G=>{var Z;return!/(red)|(ulpfec)|(flexfec)/i.test(((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName)||"")})),c&&c?.length>0&&(v=v.filter(G=>{var Z;return Ae(c).call(c,((Z=G.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLowerCase())||"")})),l&&l?.length>0){const G=y.filter(Z=>{var Q;return Ae(l).call(l,((Q=Z.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())||"")});y=G.concat(i?[]:Ad(G,y))}const V=W("UNSUPPORTED_VIDEO_CODEC");if(V&&V.length>0){const G=y.filter(z=>z.rtpMap&&Ae(V).call(V,z.rtpMap.encodingName.toLowerCase())),Z=Ad(G,y),Q=G.concat(Z).map(z=>z.payloadType);y=y.filter(z=>!Ae(Q).call(Q,z.payloadType)),w.debug("unsupportedVideoCodec: ".concat(V,", toBeRemoved: ").concat(Q))}if(p&&p.length>0&&r==="sendonly"){const G=y.filter(z=>z.rtpMap&&Ae(p).call(p,z.rtpMap.encodingName.toLowerCase())),Z=Ad(G,y),Q=G.concat(Z).map(z=>z.payloadType);y=y.filter(z=>!Ae(Q).call(Q,z.payloadType)),w.debug("unsupportedVideoUplinkCodec: ".concat(p,", toBeRemoved: ").concat(Q))}if(m&&m.length>0&&r==="recvonly"){const G=y.filter(z=>z.rtpMap&&Ae(m).call(m,z.rtpMap.encodingName.toLowerCase())),Z=Ad(G,y),Q=G.concat(Z).map(z=>z.payloadType);y=y.filter(z=>!Ae(Q).call(Q,z.payloadType)),w.debug("unsupportedVideoDownlinkCodec: ".concat(m,", toBeRemoved: ").concat(Q))}return{audioCodecs:v,videoCodecs:y,audioExtensions:D,videoExtensions:A}}function Id(e){const t=Gi(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function IU(e,t){const n=[],r=e.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),i=e.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(o=>{var c;const l=(c=r.find(p=>p.ssrcIds[0]===o))===null||c===void 0?void 0:c.ssrcIds[1];n.push({ssrcId:o,rtx:t?l:void 0})});else if(r.length>0){const o=r[0].ssrcIds[0],c=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:t?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function AU(e,t,n){const{cname:r}=e;let i=[];t&&(i=OU(t)),i.length===0&&(i=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),w.debug("Using candidates from gateway."));const s={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}const l=oT(e.rtpCapabilities),p=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{p.push({kind:We.VIDEO,ssrcMsg:[{ssrcId:m.v,rtx:m.v_rtx}],mslabel:"".concat(m.v,"_").concat(m.a)},{kind:We.AUDIO,ssrcMsg:[{ssrcId:m.a}],mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:l,setup:c,cname:r,preSSRCs:p}}function OU(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(Ch(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(Ch(e.ip6),":").concat(e.port)))),t}function Yg(e,t,n){const r=[],i=[];return e.forEach(s=>{let{ssrcId:o,rtx:c}=s;const l=on(8,"track-"),p={ssrcId:o,attributes:bU({label:l,mslabel:n=n||on(10,""),msid:"".concat(n," ").concat(l)},t&&{cname:t})};if(r.push(p),c!==void 0){const m={ssrcId:c,attributes:bU({label:l,mslabel:n,msid:"".concat(n," ").concat(l)},t&&{cname:t})};r.push(m),i.push({semantic:"FID",ssrcIds:[o,c]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:r,ssrcGroups:i}}function Bf(e,t){t instanceof Ln&&e.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),i==="opus"&&typeof W("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=W("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=t._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Nn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof jg&&i==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function Bb(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function Wb(e,t){var n;if(!(t instanceof mn&&t._encoderConfig&&t._hints.indexOf(rn.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ft().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var s,o;Ae(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ft().supportMinBitrate&&!Ae(n=t._hints).call(n,rn.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var s,o;Ae(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(W("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function NU(e){if(e.media.mediaType!=="video")return;const t=xt();if(t.name!==Wt.SAFARI&&t.os!==dr.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function sT(e,t,n){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),t.twcc===!0){const s=r.find(o=>iT(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(l=>iT(l.extensionName))||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(l,p){return p.filter(m=>!!l.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(p=>p.type==="transport-cc")||l.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const s=e.attributes.extmaps.findIndex(o=>iT(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}if(t.remb===!0){const s=r.find(o=>wU(o.extensionName));if(s){const o=s.extensionName;e.attributes.extmaps.find(l=>l.extensionName===o)||e.attributes.extmaps.push({entry:s.entry,extensionName:o}),function(l,p){return p.filter(m=>!!l.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(i,e.attributes.payloads).forEach(l=>{l.rtcpFeedbacks.find(p=>p.type==="goog-remb")||l.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const s=e.attributes.extmaps.findIndex(o=>wU(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1),e.attributes.payloads.forEach(o=>{const c=o.rtcpFeedbacks.findIndex(l=>l.type==="goog-remb");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}}function PU(e,t,n){if(Nn()||e.media.mediaType!=="video"||!(t instanceof mn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!W("SIMULCAST")||n==="vp9"&&W("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],s=e.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===i.ssrcId),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let c=1;c<r;c++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+c,attributes:Cn(i.attributes)}),o.ssrcIds.push(i.ssrcId+c),s&&(e.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:Cn(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+c,s.ssrcIds[1]+c]}));e.attributes.ssrcGroups.unshift(o)}async function kU(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const m=zg(p,c,l,"sendonly"),E=zg(p,c,l,"recvonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Wo(m,E,"videoExtensions",v,y,D),Wo(m,E,"videoCodecs",v,y,D),Wo(m,E,"audioExtensions",v,y,D),Wo(m,E,"audioCodecs",v,y,D),W("RAISE_H264_BASELINE_PRIORITY")){const A=[],P=[];if(D.videoCodecs.forEach((j,V)=>{var G;if(((G=j.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"){var Z,Q;const z=D.videoCodecs[V+1],ie=z&&UU(j,z),fe=(Z=j.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"],ve=(Q=j.fmtp)===null||Q===void 0?void 0:Q.parameters["packetization-mode"];!fe||fe!==W("FIRST_H264_PROFILE_LEVEL_ID")||W("FIRST_PACKETIZATION_MODE")&&ve!==W("FIRST_PACKETIZATION_MODE")?ie?P.push([j,z]):P.push([j]):ie?A.push([j,z]):A.push([j])}}),A.length>0&&P.length>0){w.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((V,G)=>{var Z;if(((Z=V.rtpMap)===null||Z===void 0?void 0:Z.encodingName.toLocaleLowerCase())==="h264"){const Q=UU(V,D.videoCodecs[G+1]),z=A.shift()||P.shift()||[];z.length>0&&(Q?D.videoCodecs.splice(G,2,...z):D.videoCodecs.splice(G,1,...z))}});const j=y.videoCodecs.filter(V=>{var G,Z;return((G=V.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&((Z=V.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID")});if(j.length>0){const V=Ad(j,y.videoCodecs).map(Z=>Z.payloadType),G=[...j.map(Z=>Z.payloadType),...V];y.videoCodecs=y.videoCodecs.filter(Z=>!Ae(G).call(G,Z.payloadType))}W("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(V=>{var G,Z;return!(((G=V.rtpMap)===null||G===void 0?void 0:G.encodingName.toLocaleLowerCase())==="h264"&&((Z=V.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:v,recv:y,sendrecv:D}}return{send:v,recv:y,sendrecv:D}}(e,t,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:o}}function DU(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=zg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Wo(e,t,"videoExtensions",n,r,i),Wo(e,t,"videoCodecs",n,r,i),Wo(e,t,"audioExtensions",n,r,i),Wo(e,t,"audioCodecs",n,r,i),W("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const o=i.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){w.debug("raising H264 baseline profile priority");const c=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,c)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter(c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function Wo(e,t,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return e[n].forEach(c=>{t[n].some((l,p)=>{if(c.entry===l.entry&&c.extensionName===l.extensionName)return o.push(p),!0})?s[n].push(c):r[n].push(c)}),void t[n].forEach((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)})}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return e[n].forEach(c=>{t[n].some((l,p)=>{if(c.payloadType===l.payloadType&&JSON.stringify(c)===JSON.stringify(l))return o.push(p),!0})?s[n].push(c):r[n].push(c)}),void t[n].forEach((c,l)=>{o.indexOf(l)===-1&&i[n].push(c)})}}function oT(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,s;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function Wf(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function qg(e,t,n,r){let i=[];if(e===We.VIDEO){if(W("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(s=>{var o;return Ae(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===W("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const o=[],c=[],l=[];if(n.videoCodecs.forEach(p=>{const m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";Ae(m).call(m,r)?s.push(p):Ae(m).call(m,"vp9")?o.push(p):Ae(m).call(m,"vp8")?c.push(p):Ae(m).call(m,"h264")&&l.push(p)}),s.length===0){let p="";o.length!==0?(s=o,p="vp9"):c.length!==0?(s=c,p="vp8"):l.length!==0&&(s=l,p="h264"),w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}s.length!==0&&(i=t.videoCodecs.filter(p=>s.some(m=>m.payloadType===p.payloadType)))}if(i.length===0&&(w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),W("USE_PUB_RTX")||W("USE_SUB_RTX")){const s=Ad(i,t.videoCodecs);i=[...i,...s]}}else{i=t.audioCodecs.filter(o=>{var c;return Ae(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,r)});const s=t.audioCodecs.filter(o=>{var c;return Ae(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"red")});i.length===0&&(w.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(o=>{var c;return Ae(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")})),W("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function Ad(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Ae(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function Od(e,t,n){const r=t.toString(),i=xU(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const s=await e.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=LU(o,n||{}),i?.(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function LU(e,t,n){const r=Gi(e),{useXR:i}=t;return r.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!Ae(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Wf(s),i&&Ae(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(c=>{c.rtcpFeedbacks.findIndex(l=>l.type==="rrtr")===-1&&c.rtcpFeedbacks.push({type:"rrtr"})})))}),yd(r)}function xU(e,t,n,r){if(W("SDP_LOGGING"))return w.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{xU(i,"answer",n==="local"?"remote":"local",r)}:void 0}function MU(e){const t=W("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Ae(e).call(e,n))}function UU(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function VU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ps(e,t){return typeof W(e)===t?W(e):void 0}function Dz(){try{const e=W("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?VU(Object(r),!0).forEach(function(i){M(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):VU(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e)}catch(e){return w.debug("handle gateway attributes failed: ",e),{}}}const jU={};function Nd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&w.debug("install service ".concat(e.name)),jU[e.name]=e}function ml(e){const t=jU[e];if(!t)throw new pe(F.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function FU(e,t){return ml("DataStream").create(e,t)}function aT(){return ml("InterceptFrame").create()}function BU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Jr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BU(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Gb=new Map;class Lz extends bn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(gr.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(gr.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){w.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,i,s;super(),M(this,"store",void 0),M(this,"joinInfo",void 0),M(this,"key",void 0),M(this,"ntpOffset",0),M(this,"signal",void 0),M(this,"role",void 0),M(this,"isPreallocation",void 0),M(this,"isPreSub",void 0),M(this,"inChannelInfo",{joinAt:null,duration:0}),M(this,"spec",void 0),M(this,"_state","DISCONNECTED"),M(this,"_statsCollector",void 0),M(this,"_disconnectedReason",void 0),M(this,"isSignalRecover",!1),M(this,"hasChangeBGPAddress",!1),M(this,"trafficStatsInterval",void 0),M(this,"networkQualityInterval",void 0),M(this,"_joinGatewayStartTime",0),M(this,"_signalTimeout",!1),M(this,"_clientRoleOptions",void 0),M(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:Jr(Jr({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(i=(s=ml("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,r)):new Pz(Jr(Jr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=Gb.get(t.cname);if(s||(s=new Map,Gb.set(t.cname,s)),this._isProactiveJoin=!0,s.has(t.uid)){const p=new ae(F.UID_CONFLICT);throw Xe.joinGateway(t.sid,{lts:i,succ:!1,ec:p.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),p}s.set(t.uid,!0),this.joinInfo=t,this.key=n;let o=0;this.joinGatewayStartTime=i;const c=t.proxyServer;try{w.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const p=t.gatewayAddrs.map(m=>{let{address:E}=m;const[v,y]=E.split(":"),D={host:v,port:y};return t.proxyServer&&(D.proxy=t.proxyServer),D});o=(await this.signal.init(p)).uid,w.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var l;throw w.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),Xe.joinGateway(t.sid,{lts:i,succ:!1,ec:((l=p.data)===null||l===void 0?void 0:l.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:t.preload}),s.delete(t.uid),this.signal.close(),p}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),w.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{w.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(gr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(gr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(gr.NETWORK_QUALITY,{uplinkNetworkQuality:yU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:yU(this._statsCollector.trafficStats.B_dnq)}):this.emit(gr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Xt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==hn.CONNECTED||await function(r,i){return i===1/0?r:je.race([r,sK(i)])}(this.signal.request(lt.LEAVE,void 0,!0),3e3)}catch(r){w.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Xt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:W("PUB_EXTEND"),twcc:!!W("PUBLISH_TWCC"),rtx:!!W("USE_PUB_RTX")};try{return(await this.signal.request(lt.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===rt.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw s}}async publishDataChannel(t,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(lt.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===rt.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw o}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(lt.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){w.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await je.all(t.map(n=>this.signal.request(lt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){w.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX")||void 0,extend:W("SUB_EXTEND"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(lt.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(t,n,!1);throw s}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX"),extend:W("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return(await this.signal.request(lt.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw s}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(lt.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw s}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!W("USE_SUB_RTX"),twcc:!!W("SUBSCRIBE_TWCC"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(lt.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,o=r.height,c=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(c=!1)),c?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(lt.SET_VIDEO_PROFILE,n);w.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){w.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await je.all(t.map(r=>this.signal.request(lt.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){w.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){w.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(lt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(lt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(lt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),W("CLIENT_ROLE_OPTIONS")&&(w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),W("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS")),w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(lt.SET_CLIENT_ROLE,Jr(Jr({role:t,level:i,delay:r},s),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(lt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(lt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(lt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(lt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(lt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Jr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(lt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=Gb.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Lr.username,password:Lr.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Jr(Jr({},Lr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(lt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&by(()=>{this.emit(gr.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,r;if(!this.joinInfo||!this.key)throw new ae(F.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=W("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var o;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(gr.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,Ae(xf).call(xf,o)||xf.push(o);const c=ib(this.store),l=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),p=HL(this.store),m=Dz(),E=_f(87)||ZD()||kR(117),v=(function(){const D=xt();if(D.name!==Wt.SAFARI||!D.browserVersion)return!1;const A=D.browserVersion.split(".");return Number(A[0])>18||Number(A[0])===18&&Number(A[1])>=4}()||rL(18,4,!1))&&DR(18,6,!0)&&this.spec.codec==="h264"&&W("ENABLE_ABSSENDTIME_AS_SENTTS"),y=Jr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Qs,browser:navigator.userAgent,process_id:W("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:W("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Jr(Jr({enableEncodedTransform:(!!W("ENABLE_AUDIO_METADATA")||!!W("ENABLE_AUDIO_PTS"))&&E||!!W("ENABLE_AUDIO_TOPN")&&NR(Wt.CHROME,87,116)||void 0,enableAudioMetadata:!!W("ENABLE_AUDIO_METADATA")&&E,enableAudioPts:!!W("ENABLE_AUDIO_PTS")&&E,topnSmoothLevel:W("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:W("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:W("TOPN_SWITCH_HOLD_MS"),topnAudioGain:W("TOPN_AUDIO_GAIN"),enablePublishedUserList:W("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:W("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ps("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ps("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ps("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:W("USE_PUB_RTX")===!0||W("USE_SUB_RTX")===!0||void 0,disableFEC:W("DISABLE_FEC"),enableNTPReport:!!W("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:p,enableFulllinkAvSync:!!W("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ps("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!W("FORCE_ENABLE_AUT_CC")||!Dy()&&(!!W("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!W("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ps("USE_XR","boolean"),enableLossbasedBwe:Ps("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!W("FORCE_ENABLE_AUT_CC")||!Dy()&&(!!W("ENABLE_AUT_CC")||void 0),enableCCFallback:Ps("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:c?Ps("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ps("PUBLISH_TWCC","boolean"),enableSubTWCC:Ps("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ps("USE_PUB_RTX","boolean"),enableSubRTX:Ps("USE_SUB_RTX","boolean"),enableSubSVC:W("ENABLE_SVC")?W("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0,enableSvcExtended:W("ENABLE_SVC")&&Array.isArray(W("SVC_EXTENDED"))&&W("SVC_EXTENDED").length!==0?W("SVC_EXTENDED"):void 0},m),{},{audioDuplicate:Ps("ENABLE_AUDIO_RED","boolean")?(r=Ps("AUDIO_DUPLICATE_NUM","number"))!==null&&r!==void 0?r:2:void 0,senttsUsesAbsSendTime:!!v||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,W("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new ae(F.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ht.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ht.WS_RECONNECTING,t=>{this.joinInfo&&Xe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||kr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Xe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ht.WS_CLOSED,t=>{let n;switch(t){case Xt.LEAVE:n=kr.LEAVE;break;case Xt.UID_BANNED:case Xt.IP_BANNED:case Xt.CHANNEL_BANNED:case Xt.SERVER_ERROR:n=kr.SERVER_ERROR;break;case Xt.FALLBACK:n=kr.FALLBACK;break;case Xt.LICENSE_MISSING:case Xt.LICENSE_EXPIRED:case Xt.LICENSE_MINUTES_EXCEEDED:case Xt.LICENSE_PERIOD_INVALID:case Xt.LICENSE_MULTIPLE_SDK_SERVICE:case Xt.LICENSE_ILLEGAL:case Xt.TOKEN_EXPIRE:n=t;break;default:n=kr.NETWORK_ERROR}w.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+kr.NETWORK_ERROR)),this.joinInfo&&Xe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Xt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Xt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ht.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=W("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(w.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Xe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void w.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Zt("EVENT_REPORT_DOMAIN",t[1]),Zt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Zt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Pt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ht.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new ae(F.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Dr(this,gr.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(ht.REQUEST_JOIN_INFO,async(t,n,r)=>{var i,s,o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const c=Cn((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(W("NEW_TURN_MODE")&&c&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var l;let v=c.servers.map(A=>"turnServerURL"in A&&W("USE_TURN_IP")?Jr(Jr({},A),{},{turnServerURL:tT(A.turnServerURL)}):A),y=(l=c.serversFromGateway)===null||l===void 0?void 0:l.map(A=>W("USE_TURN_IP")?Jr(Jr({},A),{},{turnServerURL:tT(A.turnServerURL)}):A);const D=this.signal.currentURLIndex;v.length>0&&(v=[v[D%v.length]],c.servers=v),Array.isArray(y)&&y.length>0&&(y=[y[0]],c.serversFromGateway=y),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(D))}const{iceParameters:p,dtlsParameters:m,rtpCapabilities:E}=await Dr(this,gr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:m,rtpCapabilities:E,version:"2"}}))}catch(v){n(v)}}),this.signal.on(ht.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ht.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,i="";var s;t instanceof ae?(r=((s=t.data)===null||s===void 0?void 0:s.desc)||t.code,i=t.message):r=t,Xe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ht.IS_P2P_DISCONNECTED,t=>{t(kg(this,gr.IS_P2P_DISCONNECTED))}),this.signal.on(ht.DISCONNECT_P2P,()=>{this.emit(gr.DISCONNECT_P2P)}),this.signal.on(ht.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ht.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ht.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(gr.JOIN_RESPONSE,t,n)}),this.signal.on(ht.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress(),s=Cn((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(W("NEW_TURN_MODE")&&s&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var r;let c=s.servers.map(m=>"turnServerURL"in m&&W("USE_TURN_IP")?Jr(Jr({},m),{},{turnServerURL:tT(m.turnServerURL)}):m),l=(r=s.serversFromGateway)===null||r===void 0?void 0:r.map(m=>W("USE_TURN_IP")?Jr(Jr({},m),{},{turnServerURL:tT(m.turnServerURL)}):m);const p=this.signal.currentURLIndex;c.length>0&&(c=[c[p%c.length]],s.servers=c),Array.isArray(l)&&l.length>0&&(l=[l[0]],s.serversFromGateway=l),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(p,",in pre pc"))}const o=W("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&o){const c=OU(i);this.emit(gr.PRE_CONNECT_PC,{candidates:c,fingerprint:o,turnServer:s})}}}),this.signal.on(ht.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof W("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(W("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(lt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(lt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw w.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(lt.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(lt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw w.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(lt.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(i=>i.stream_type===Qt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,n){const r={action:t.find(i=>i.stream_type===Qt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,n){const r={action:t===We.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,n){const r={action:t===We.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(lt.CONTROL,r,!0,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(lt.RESTART_ICE,n,!0)}catch(r){throw w.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||kr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!W("GATEWAY_WSS_ADDRESS"))return W("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(w.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(lt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let cT=0,Hb=0;function wa(e,t,n,r){return new je((i,s)=>{t.timeout=t.timeout||W("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),cT+=Ec(t.data)):n&&(t.data.size?cT+=t.data.size:t.data instanceof FormData?cT+=vL(t.data):cT+=Ec(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ai.request(t).then(o=>{typeof o.data=="string"?Hb+=Ec(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?Hb+=o.data.byteLength:Hb+=Ec(JSON.stringify(o.data)),r&&i({data:o.data,headers:o.headers}),i(o.data)}).catch(o=>{Ai.isCancel(o)?s(new ae(F.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ae(F.NETWORK_TIMEOUT,o.message)):o.response?s(new ae(F.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ae(F.NETWORK_ERROR,o.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Ee){var Ne=0;return function(){return Ne<Ee.length?{done:!1,value:Ee[Ne++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Ee,Ne,Ke){return Ee==Array.prototype||Ee==Object.prototype||(Ee[Ne]=Ke.value),Ee},r,i=function(Ee){Ee=[typeof globalThis=="object"&&globalThis,Ee,typeof window=="object"&&window,typeof self=="object"&&self,typeof g=="object"&&g];for(var Ne=0;Ne<Ee.length;++Ne){var Ke=Ee[Ne];if(Ke&&Ke.Math==Math)return Ke}throw Error("Cannot find global object")}(this);function s(Ee,Ne){if(Ne)e:{var Ke=i;Ee=Ee.split(".");for(var Se=0;Se<Ee.length-1;Se++){var b=Ee[Se];if(!(b in Ke))break e;Ke=Ke[b]}(Ne=Ne(Se=Ke[Ee=Ee[Ee.length-1]]))!=Se&&Ne!=null&&n(Ke,Ee,{configurable:!0,writable:!0,value:Ne})}}function o(Ee){return(Ee={next:Ee})[Symbol.iterator]=function(){return this},Ee}function c(Ee){var Ne=typeof Symbol<"u"&&Symbol.iterator&&Ee[Symbol.iterator];return Ne?Ne.call(Ee):{next:t(Ee)}}if(s("Symbol",function(Ee){function Ne(b,K){this.A=b,n(this,"description",{configurable:!0,writable:!0,value:K})}if(Ee)return Ee;Ne.prototype.toString=function(){return this.A};var Ke="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Se=0;return function b(K){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new Ne(Ke+(K||"")+"_"+Se++,K)}}),s("Symbol.iterator",function(Ee){if(Ee)return Ee;Ee=Symbol("Symbol.iterator");for(var Ne="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ke=0;Ke<Ne.length;Ke++){var Se=i[Ne[Ke]];typeof Se=="function"&&typeof Se.prototype[Ee]!="function"&&n(Se.prototype,Ee,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return Ee}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var l;e:{var p={};try{p.__proto__={a:!0},l=p.a;break e}catch{}l=!1}r=l?function(Ee,Ne){if(Ee.__proto__=Ne,Ee.__proto__!==Ne)throw new TypeError(Ee+" is not extensible");return Ee}:null}var m=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(Ee){if(Ee.m)throw new TypeError("Generator is already running");Ee.m=!0}function y(Ee,Ne){return Ee.h=3,{value:Ne}}function D(Ee){this.g=new E,this.G=Ee}function A(Ee,Ne,Ke,Se){try{var b=Ne.call(Ee.g.j,Ke);if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");if(!b.done)return Ee.g.m=!1,b;var K=b.value}catch(J){return Ee.g.j=null,Ee.g.s(J),P(Ee)}return Ee.g.j=null,Se.call(Ee.g,K),P(Ee)}function P(Ee){for(;Ee.g.h;)try{var Ne=Ee.G(Ee.g);if(Ne)return Ee.g.m=!1,{value:Ne.value,done:!1}}catch(Ke){Ee.g.v=void 0,Ee.g.s(Ke)}if(Ee.g.m=!1,Ee.g.l){if(Ne=Ee.g.l,Ee.g.l=null,Ne.F)throw Ne.D;return{value:Ne.return,done:!0}}return{value:void 0,done:!0}}function j(Ee){this.next=function(Ne){return Ee.o(Ne)},this.throw=function(Ne){return Ee.s(Ne)},this.return=function(Ne){return function(Ke,Se){v(Ke.g);var b=Ke.g.j;return b?A(Ke,"return"in b?b.return:function(K){return{value:K,done:!0}},Se,Ke.g.return):(Ke.g.return(Se),P(Ke))}(Ee,Ne)},this[Symbol.iterator]=function(){return this}}function V(Ee,Ne){return Ne=new j(new D(Ne)),m&&Ee.prototype&&m(Ne,Ee.prototype),Ne}if(E.prototype.o=function(Ee){this.v=Ee},E.prototype.s=function(Ee){this.l={D:Ee,F:!0},this.h=this.C||this.u},E.prototype.return=function(Ee){this.l={return:Ee},this.h=this.u},D.prototype.o=function(Ee){return v(this.g),this.g.j?A(this,this.g.j.next,Ee,this.g.o):(this.g.o(Ee),P(this))},D.prototype.s=function(Ee){return v(this.g),this.g.j?A(this,this.g.j.throw,Ee,this.g.o):(this.g.s(Ee),P(this))},s("Array.prototype.entries",function(Ee){return Ee||function(){return function(Ne,Ke){Ne instanceof String&&(Ne+="");var Se=0,b=!1,K={next:function(){if(!b&&Se<Ne.length){var J=Se++;return{value:Ke(J,Ne[J]),done:!1}}return b=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}(this,function(Ne,Ke){return[Ne,Ke]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var G=function(Ee,Ne){for(var Ke=0;Ke<Ee.length;Ke++)Ne(Ee[Ke])},Z=function(Ee){return Ee.replace(/\r?\n|\r/g,`\r
`)},Q=function(Ee,Ne,Ke){return Ne instanceof Blob?(Ke=Ke!==void 0?Ke+"":typeof Ne.name=="string"?Ne.name:"blob",Ne.name===Ke&&Object.prototype.toString.call(Ne)!=="[object Blob]"||(Ne=new File([Ne],Ke)),[String(Ee),Ne]):[String(Ee),String(Ne)]},z=function(Ee,Ne){if(Ee.length<Ne)throw new TypeError(Ne+" argument required, but only "+Ee.length+" present.")},ie=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,fe=ie.FormData,ve=ie.XMLHttpRequest&&ie.XMLHttpRequest.prototype.send,we=ie.Request&&ie.fetch,Ct=ie.navigator&&ie.navigator.sendBeacon,bt=ie.Element&&ie.Element.prototype,ut=ie.Symbol&&Symbol.toStringTag;ut&&(Blob.prototype[ut]||(Blob.prototype[ut]="Blob"),"File"in ie&&!File.prototype[ut]&&(File.prototype[ut]="File"));try{new File([],"")}catch{ie.File=function(Ne,Ke,Se){return Ne=new Blob(Ne,Se||{}),Object.defineProperties(Ne,{name:{value:Ke},lastModified:{value:+(Se&&Se.lastModified!==void 0?new Date(Se.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ut&&Object.defineProperty(Ne,ut,{value:"File"}),Ne}}var Yt=function(Ee){return Ee.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ht=function(Ee){this.i=[];var Ne=this;Ee&&G(Ee.elements,function(Ke){if(Ke.name&&!Ke.disabled&&Ke.type!=="submit"&&Ke.type!=="button"&&!Ke.matches("form fieldset[disabled] *"))if(Ke.type==="file"){var Se=Ke.files&&Ke.files.length?Ke.files:[new File([],"",{type:"application/octet-stream"})];G(Se,function(b){Ne.append(Ke.name,b)})}else Ke.type==="select-multiple"||Ke.type==="select-one"?G(Ke.options,function(b){!b.disabled&&b.selected&&Ne.append(Ke.name,b.value)}):Ke.type==="checkbox"||Ke.type==="radio"?Ke.checked&&Ne.append(Ke.name,Ke.value):(Se=Ke.type==="textarea"?Z(Ke.value):Ke.value,Ne.append(Ke.name,Se))})};if((e=Ht.prototype).append=function(Ee,Ne,Ke){z(arguments,2),this.i.push(Q(Ee,Ne,Ke))},e.delete=function(Ee){z(arguments,1);var Ne=[];Ee=String(Ee),G(this.i,function(Ke){Ke[0]!==Ee&&Ne.push(Ke)}),this.i=Ne},e.entries=function Ee(){var Ne,Ke=this;return V(Ee,function(Se){if(Se.h==1&&(Ne=0),Se.h!=3)return Ne<Ke.i.length?Se=y(Se,Ke.i[Ne]):(Se.h=0,Se=void 0),Se;Ne++,Se.h=2})},e.forEach=function(Ee,Ne){z(arguments,1);for(var Ke=c(this),Se=Ke.next();!Se.done;Se=Ke.next()){var b=c(Se.value);Se=b.next().value,b=b.next().value,Ee.call(Ne,b,Se,this)}},e.get=function(Ee){z(arguments,1);var Ne=this.i;Ee=String(Ee);for(var Ke=0;Ke<Ne.length;Ke++)if(Ne[Ke][0]===Ee)return Ne[Ke][1];return null},e.getAll=function(Ee){z(arguments,1);var Ne=[];return Ee=String(Ee),G(this.i,function(Ke){Ke[0]===Ee&&Ne.push(Ke[1])}),Ne},e.has=function(Ee){z(arguments,1),Ee=String(Ee);for(var Ne=0;Ne<this.i.length;Ne++)if(this.i[Ne][0]===Ee)return!0;return!1},e.keys=function Ee(){var Ne,Ke,Se,b,K=this;return V(Ee,function(J){if(J.h==1&&(Ne=c(K),Ke=Ne.next()),J.h!=3)return Ke.done?void(J.h=0):(Se=Ke.value,b=c(Se),y(J,b.next().value));Ke=Ne.next(),J.h=2})},e.set=function(Ee,Ne,Ke){z(arguments,2),Ee=String(Ee);var Se=[],b=Q(Ee,Ne,Ke),K=!0;G(this.i,function(J){J[0]===Ee?K&&(K=!Se.push(b)):Se.push(J)}),K&&Se.push(b),this.i=Se},e.values=function Ee(){var Ne,Ke,Se,b,K=this;return V(Ee,function(J){if(J.h==1&&(Ne=c(K),Ke=Ne.next()),J.h!=3)return Ke.done?void(J.h=0):(Se=Ke.value,(b=c(Se)).next(),y(J,b.next().value));Ke=Ne.next(),J.h=2})},Ht.prototype._asNative=function(){for(var Ee=new fe,Ne=c(this),Ke=Ne.next();!Ke.done;Ke=Ne.next()){var Se=c(Ke.value);Ke=Se.next().value,Se=Se.next().value,Ee.append(Ke,Se)}return Ee},Ht.prototype._blob=function(){var Ee="----formdata-polyfill-"+Math.random(),Ne=[],Ke="--"+Ee+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Se,b){return typeof Se=="string"?Ne.push(Ke+Yt(Z(b))+`"\r
\r
`+Z(Se)+`\r
`):Ne.push(Ke+Yt(Z(b))+'"; filename="'+Yt(Se.name)+`"\r
Content-Type: `+(Se.type||"application/octet-stream")+`\r
\r
`,Se,`\r
`)}),Ne.push("--"+Ee+"--"),new Blob(Ne,{type:"multipart/form-data; boundary="+Ee})},Ht.prototype[Symbol.iterator]=function(){return this.entries()},Ht.prototype.toString=function(){return"[object FormData]"},bt&&!bt.matches&&(bt.matches=bt.matchesSelector||bt.mozMatchesSelector||bt.msMatchesSelector||bt.oMatchesSelector||bt.webkitMatchesSelector||function(Ee){for(var Ne=(Ee=(this.document||this.ownerDocument).querySelectorAll(Ee)).length;0<=--Ne&&Ee.item(Ne)!==this;);return-1<Ne}),ut&&(Ht.prototype[ut]="FormData"),ve){var Kr=ie.XMLHttpRequest.prototype.setRequestHeader;ie.XMLHttpRequest.prototype.setRequestHeader=function(Ee,Ne){Kr.call(this,Ee,Ne),Ee.toLowerCase()==="content-type"&&(this.B=!0)},ie.XMLHttpRequest.prototype.send=function(Ee){Ee instanceof Ht?(Ee=Ee._blob(),this.B||this.setRequestHeader("Content-Type",Ee.type),ve.call(this,Ee)):ve.call(this,Ee)}}we&&(ie.fetch=function(Ee,Ne){return Ne&&Ne.body&&Ne.body instanceof Ht&&(Ne.body=Ne.body._blob()),we.call(this,Ee,Ne)}),Ct&&(ie.navigator.sendBeacon=function(Ee,Ne){return Ne instanceof Ht&&(Ne=Ne._asNative()),Ct.call(this,Ee,Ne)}),ie.FormData=Ht}})();const Xg=()=>{const e=W("AREAS");return e.length===0&&e.push(zt.GLOBAL),Ui(e).call(e,(t,n,r)=>{const i=WU(n);return i?r===0?i:"".concat(t,",").concat(i):t},"")},WU=e=>e===zt.OVERSEA?"".concat(Wr.ASIA,",").concat(Wr.EUROPE,",").concat(Wr.AFRICA,",").concat(Wr.NORTH_AMERICA,",").concat(Wr.SOUTH_AMERICA,",").concat(Wr.OCEANIA):Wr[e],xz=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=Zy[n],i=Object.keys(r);i&&i.map(s=>{s!=="CODE"&&(t[s]=t[s].concat(r[s]))})}),t},lT={GLOBAL:{ASIA:[zt.CHINA,zt.JAPAN,zt.INDIA,zt.KOREA,zt.HKMC],EUROPE:[],NORTH_AMERICA:[zt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dT=Object.keys(lT[zt.GLOBAL]),Kb=[zt.CHINA,zt.NORTH_AMERICA,zt.EUROPE,zt.ASIA,zt.JAPAN,zt.INDIA,zt.OCEANIA,zt.SOUTH_AMERICA,zt.AFRICA,zt.KOREA,zt.HKMC,zt.US],Mz=function(e,t){let n=[];if(Ae(e).call(e,zt.GLOBAL)){const s=[zt.GLOBAL,zt.OVERSEA],o=Object.keys(Zy);if(t===zt.GLOBAL)throw new ae(F.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===zt.CHINA)n=[zt.OVERSEA];else if(i=t,Ae(dT).call(dT,i)){const c=(r=t,lT[zt.GLOBAL][r]||[]),l=[...s,t,...c];n=o.filter(p=>!Ae(l).call(l,p))}else if(function(c){let l=!1;return dT.forEach(p=>{var m;Ae(m=lT[zt.GLOBAL][p]).call(m,c)&&(l=!0)}),l}(t)){const c=function(p){let m;return dT.forEach(E=>{var v;Ae(v=lT[zt.GLOBAL][E]).call(v,p)&&(m=E)}),m}(t),l=[...s,c,t];n=o.filter(p=>!Ae(l).call(l,p))}else n=e;n=function(c){const l=[];return Kb.forEach(p=>{Ae(c).call(c,p)&&l.push(p)}),l.concat(c.filter(p=>!Ae(Kb).call(Kb,p)))}(n)}else n=e;var r,i;return n};function GU(e){var t,n;if(!e&&Ae(t=W("AREAS")).call(t,zt.EXTENSIONS))return w.debug("update area from ap : reset"),void zb(HK,!0);if(!Ae(n=W("AREAS")).call(n,zt.GLOBAL)||!e)return;let r=Zy.EXTENSIONS;r&&(r={CODE:WU(zt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},w.debug("update area from ap success: ".concat(e,",config is "),r),Zt("AREAS",[zt.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?Zt(i,r[i][0]):Zt(i,r[i])}))}function zb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Xe.reportApiInvoke(null,{name:xn.SET_AREA,options:e,tag:Tn.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(s=>{if(!Ae(dU).call(dU,s))throw new ae(F.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:s,excludedArea:o}=e;if(!s)throw new ae(F.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),r=o?Mz(c,o):c}if(!t){if(Sa.AREAS){const s=new ae(F.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void w.warning("setArea is prohibited because of config-distribute")}if(Ae(r).call(r,zt.GLOBAL)&&W("AREAS")===zt.EXTENSIONS){const s=new ae(F.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void w.warning("setArea is prohibited because of ap extensions")}}Zt("AREAS",r,t);const i=xz(r);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Zt(s,i[s][0]):Zt(s,i[s])}),w.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function HU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function wc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HU(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Yb=1;function Uz(e,t,n,r,i){Yb+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Yb,requestId:Yb,version:Qs,cname:n.cname},o={service_name:t,json_body:JSON.stringify(s)};let c,l,p=e[0];return va(async()=>{c=Date.now();const m=await wa(p,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(l=Date.now()-c,m.code!==0){const y=new ae(F.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:l});throw w.error(y.toString()),y}const E=JSON.parse(m.json_body);if(E.code!==200){const y=new ae(F.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:l});throw w.error(y.toString()),y}if(!E.servers||E.servers.length===0){const y=new ae(F.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:l});throw w.error(y.toString()),y}const v=function(y,D){return{addressList:y.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:y.workerToken,vid:y.vid}}(E,t);return W("LIVE_STREAMING_ADDRESS")&&(v.addressList=W("LIVE_STREAMING_ADDRESS")instanceof Array?W("LIVE_STREAMING_ADDRESS"):[W("LIVE_STREAMING_ADDRESS")]),wc(wc({},v),{},{responseTime:l})},(m,E)=>(Xe.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:E===0,responseTime:l,serverIp:e[E%e.length]}),!1),(m,E)=>(Xe.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:l,serverIp:e[E%e.length]}),!!(m.code!==F.OPERATION_ABORTED&&m.code!==F.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(p=e[(E+1)%e.length],!0)),i)}let qb=1;function KU(e,t,n,r){let{url:i,areaCode:s}=e;const{clientId:o,sid:c}=t,l=Date.now();let p;const m=t.role,[E,v]=Jb(t,s,[Hn.CHOOSE_SERVER]);let y=Gn.networkState;return va(async()=>{y&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(r&&r.maxRetryTimeout||qn.maxRetryTimeout)]),y=Gn.networkState;const{data:D,headers:A}=await wa(i,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=A.http3==="1"?1:-1,Xe.reportResourceTiming(i,c),YU(D,i,t,l,[Hn.CHOOSE_SERVER],p);const P=Kg(D,Hn.CHOOSE_SERVER);return Xb(P),jb(P,i)},D=>(D&&Xe.joinChooseServer(c,{role:m,lts:l,succ:!0,csAddr:i,opid:v,serverList:D.gatewayAddrs.map(A=>A.address),ec:null,cid:D.cid.toString(),uid:D.uid.toString(),csIp:D.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),isHttp3:p,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.res.detail&&D.res.detail[38]}),!1),D=>D.code!==F.OPERATION_ABORTED&&(D.code===F.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(Xe.joinChooseServer(c,{role:m,lts:l,succ:!1,csAddr:i,serverList:null,opid:v,ec:D.code,csIp:D.data&&D.data.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:y}),isHttp3:p,corssRegionTagReq:t.apRequestDetail}),w.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),D),!0)),r)}function zU(e,t,n,r){let i,{url:s,areaCode:o,serviceIds:c}=e;const l=Date.now(),p=t.role,[m,E]=Jb(t,o,c);let v;return va(async()=>{v&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(r&&r.maxRetryTimeout||qn.maxRetryTimeout)]),v=Gn.networkState;const{data:y,headers:D}=await wa(s,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=D.http3==="1"?1:-1,Xe.reportResourceTiming(s,t.sid),YU(y,s,t,l,c,i);const A=Kg(y,Hn.CHOOSE_SERVER),P=Kg(y,t.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK),j=performance.getEntriesByName(s),V=j[j.length-1];let G;return V&&(G={name:V.name,protocol:"nextHopProtocol"in V?V.nextHopProtocol:"",dnscost:"domainLookupEnd"in V&&"domainLookupStart"in V&&typeof V.domainLookupEnd=="number"&&typeof V.domainLookupStart=="number"?V.domainLookupEnd-V.domainLookupStart:-1,tcpTlsCost:"connectEnd"in V&&"connectStart"in V&&typeof V.connectEnd=="number"&&typeof V.connectStart=="number"?V.connectEnd-V.connectStart:-1,reqCost:"requestStart"in V&&typeof V.requestStart=="number"&&"responseEnd"in V&&typeof V.responseEnd=="number"?V.responseEnd-V.requestStart:-1,handleCost:"leave_ts"in y&&"enter_ts"in y&&typeof y.leave_ts=="number"&&typeof y.enter_ts=="number"?y.leave_ts-y.enter_ts:-1}),Xb(A),{gatewayInfo:jb(A,s),proxyInfo:P,url:s,resourceTimingInfo:G}},y=>(y.gatewayInfo&&Xe.joinChooseServer(t.sid,{role:p,lts:l,succ:!0,csAddr:s,serverList:y.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:E,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:y.gatewayInfo.res.detail&&y.gatewayInfo.res.detail[38],resourceTimingInfo:y.resourceTimingInfo?JSON.stringify(y.resourceTimingInfo):void 0}),y.proxyInfo&&Xe.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:s,turnServerAddrList:y.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),y=>y.code!==F.OPERATION_ABORTED&&(y.code===F.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(Xe.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:v})}),w.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),r)}const YU=(e,t,n,r,i,s)=>{const{sid:o,clientId:c,cloudProxyServer:l}=n,p=[],m=E=>{E.flag===4096?Xe.joinChooseServer(o,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||Xe.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:l,unilbsServerIds:i.toString()})};if(e.response_body.forEach(E=>{const v=E.buffer.code;if(E.uri===23&&v===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const y={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};p.push(y),m(y)}if(v!==0){const y=jf(v),D={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,y.desc,{desc:y.desc,retry:y.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?w.warning(D.error.toString()):p.push(D),m(D)}}),p.length)throw w.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(p.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new ae(F.CAN_NOT_GET_GATEWAY_SERVER,p.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!p.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(p.map(E=>{var v;return E==null||(v=E.error)===null||v===void 0||(v=v.data)===null||v===void 0?void 0:v.desc}).filter(E=>!!E))]})},Xb=e=>{var t,n,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ae(F.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(W("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?GU(e.detail[23].toLowerCase()):GU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const o=e.detail[19],c=o?.split(";");for(let l=0;l<c.length;l++){var s;const p=ri(s=c[l]).call(s);e.addresses[l]&&c&&(e.addresses[l].fingerprint=p)}}if(W("GATEWAY_ADDRESS")&&W("GATEWAY_ADDRESS").length>0){w.debug("assign gateway address to",W("GATEWAY_ADDRESS"));const o=W("GATEWAY_ADDRESS").map(c=>{var l,p;const m=(l=(p=e.addresses.find(E=>E.ip===c.ip&&E.port===c.port))===null||p===void 0?void 0:p.fingerprint)!==null&&l!==void 0?l:"";return{ip:c.ip,port:c.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=o}},Vz=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=jf(n.buffer.code);throw new ae(F.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw w.debug("update ticket request received ap response without response body:",t),new ae(F.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Jb=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:wc(wc(wc({6:e.stringUid,11:t,12:W("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const o=new FormData;return o.append("request",JSON.stringify(s)),[o,r]},jz=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let Gf=0;function Hf(e){return je.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Jg=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=e,o=0;const c=t;let l,p=0;const m=async()=>{const E=(()=>{const v=o*c,y=v+c;return n.slice(v,y).map(r)})();s&&s.push(...E);try{l=await Hf(E)}catch(v){if(p+=c,o++,!(p>=n.length))return void await m();i(v)}E.forEach(v=>v.cancel())};return await m(),l},qU=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let s=0;const o=async()=>{const c=n(t.shift());try{return await c}catch(l){if(s++,s>=i||r!=null&&r(l))throw l;return o()}};return o()};async function Fz(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new je((l,p)=>{let m;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:v=>{v.close(),clearTimeout(m),l(!0)},error:v=>{clearTimeout(m),l(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const E=[t,n,r,i,s,o];for(let v=0;v<E.length;v++){const y=new EncodedVideoChunk({type:v==0?"key":"delta",timestamp:33333*v,duration:33333,data:new Uint8Array(E[v])});try{await e.decode(y)}catch{return void l(!1)}}})(),m=setTimeout(()=>{l(!1)},5e3)})}async function Qb(e,t,n,r){return{gatewayInfo:await async function(s,o,c,l){let p=null;const m=[],E=async()=>{const y=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(P=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:Xg()})),D=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(P=>P.url)}),A=await Jg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:P=>(w.debug("[".concat(s.clientId,"] Connect to choose_server:"),P.url),KU(P,s,o,c)),allFailedhandler:P=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},D),P[0]},promisesCollector:m});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},v=async()=>{if(await Rr(1e3),p!==null)return p;const y=W("WEBCS_DOMAIN_BACKUP_LIST").map(P=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:Xg()})),D=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(P=>P.url)}),A=await Jg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:P=>(w.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),P.url),KU(P,s,o,c)),allFailedhandler:P=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},D),P[0]},promisesCollector:m});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};try{return p=await Hf([E(),v()]),m.length&&m.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),p}catch(y){throw y[0]}}(e,t,n,r)}}async function XU(e,t,n,r,i){const s=e.cloudProxyServer;if(s==="disabled"){if(e.useLocalAccessPoint)return await Qb(e,t,n,i);if(W("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:v,proxyInfo:y}=await $U(e,t,n,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:v};const D=y.map(A=>({turnServerURL:A.address,tcpport:A.tcpport||Lr.tcpport,udpport:A.udpport||Lr.udpport,username:A.username||Lr.username,password:A.password||Lr.password,forceturn:!1,security:!0}));if(i.useP2P){var o;const A=(o=e.uid)!==null&&o!==void 0?o:v.uid,P="glb:".concat(A.toString()),j=await FR(P),V=y.map(G=>({turnServerURL:G.address,tcpport:G.tcpport||Lr.tcpport,udpport:G.udpport||Lr.udpport,username:P,password:j,forceturn:!1,security:!0}));D.push(...V)}return e.turnServer={mode:"manual",servers:D},{gatewayInfo:v}}return await Qb(e,t,n,i)}const{proxyInfo:c,gatewayInfo:l}=await $U(e,t,n,i),p={gatewayInfo:l},m=c.map(v=>({turnServerURL:v.address,tcpport:s==="proxy3"?void 0:v.tcpport?v.tcpport:Lr.tcpport,udpport:s==="proxy4"?void 0:v.udpport?v.udpport:Lr.udpport,username:v.username||Lr.username,password:v.password||Lr.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var E;const v=(E=e.uid)!==null&&E!==void 0?E:l.uid,y="glb:".concat(v.toString()),D=await FR(y),A=c.map(P=>({turnServerURL:P.address,tcpport:s==="proxy3"?void 0:P.tcpport||Lr.tcpport,udpport:s==="proxy4"?void 0:P.udpport||Lr.udpport,username:y,password:D,forceturn:s!=="proxy4",security:s==="proxy5"}));m.push(...A)}return e.turnServer={mode:"manual",servers:m},w.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),p}async function JU(e,t,n,r,i){const s=W("ACCOUNT_REGISTER").slice(0,W("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?s.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):s.map(l=>"https://".concat(l,"/api/v1"));const c=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const l=await async function(p,m,E,v,y){const D=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:m};let P=p[0];const j=await va(()=>wa(P+"".concat(P.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(V,G)=>{if(V.code===0){if(V.uid<=0||V.uid>=Math.pow(2,32))throw w.error("Invalid Uint Uid ".concat(m," => ").concat(V.uid),V),Xe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:P,stringUid:A.string_uid,uid:V.uid,errorCode:F.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new ae(F.INVALID_UINT_UID_FROM_STRING_UID);return Xe.reqUserAccount(A.sid,{lts:D,success:!0,serverAddr:P,stringUid:A.string_uid,uid:V.uid,errorCode:null,extend:A}),!1}const Z=jf(V.code);return Z.retry&&(P=p[(G+1)%p.length]),Xe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:P,stringUid:A.string_uid,uid:V.uid,errorCode:Z.desc,extend:A}),Z.retry},(V,G)=>V.code!==F.OPERATION_ABORTED&&(Xe.reqUserAccount(A.sid,{lts:D,success:!1,serverAddr:P,stringUid:A.string_uid,uid:null,errorCode:V.code,extend:A}),P=p[(G+1)%p.length],!0),y);if(j.code!==0){const V=jf(j.code);throw new ae(F.UNEXPECTED_RESPONSE,V.desc)}return j}(o,e,t,n,r);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},c),l.uid}catch(l){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[l]},c),l}}async function Bz(e,t,n){const r=W("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(s=>"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await qU({referenceList:i,asyncMapHandler:o=>async function(c,l,p,m){const E=Date.now(),v={sid:p.sid,opid:10,appid:p.appId,string_uid:l};try{const y=await wa(c+"".concat(c.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(y.code!==0){const D=jf(y.code);throw new ae(F.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(y.uid<=0||y.uid>=Math.pow(2,32))throw new ae(F.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:c,req:v,uid:y.uid,elapse:Date.now()-E}}catch(y){throw y}}(o,e,t,n),closeFn:o=>o.code===F.OPERATION_ABORTED||o.code===F.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function Wz(e,t,n){const r=W("CDS_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")),i=r.map(l=>function(p,m,E,v){const y=xt(),D={flag:64,cipher_method:0,features:wc(wc(wc(wc(wc({install_id:QR(),device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:Qs,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:kz.WEB_RTC,browser_name:y.name,browser_version:y.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),y.os&&{os_name:y.os}),y.osVersion&&{os_version:y.osVersion}),{},{detail:""})};return va(()=>wa(p,{data:D,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,A=>A.code!==F.OPERATION_ABORTED,v)}(l,e,t,n));let s=null,o=null,c={};try{s=await Hf(i)}catch(l){if(l.code===F.OPERATION_ABORTED)throw l;o=l}if(i.forEach(l=>l.cancel()),Xe.reportApiInvoke(e.sid,{name:xn.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=function(l){if(!l.test_tags)return{};const p=l.test_tags,m=Object.keys(p),E={};return m.forEach(v=>{var y;const D=ri(y=v.slice(4)).call(y),A=JSON.parse(p[v]),P=A[1];E[D]={tag:A[0]||"",value:P}}),E}(s)}catch{}return c}async function QU(e,t){const n=W("WEBCS_DOMAIN").concat(W("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Xg(),serviceIds:[Hn.CHOOSE_SERVER,Hn.CLOUD_PROXY_FALLBACK]}));try{return await qU({referenceList:n,asyncMapHandler:i=>async function(s,o,c){let l,{url:p,areaCode:m,serviceIds:E}=s;const v=Date.now(),[y,D]=Jb(o,m,E);let A=Gn.networkState;try{A&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(qn.maxRetryTimeout)]),A=Gn.networkState;const{data:P,headers:j}=await wa(p,{data:y,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=j.http3==="1"?1:-1,(Q=>{const z=[];if(Q.response_body.forEach(ie=>{const fe=ie.buffer.code;if(ie.uri===23&&fe===0&&!ie.buffer.edges_services)if(ie.buffer.flag===4194310)ie.buffer.edges_services=[];else{const ve={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Q.detail[502]}),flag:ie.buffer.flag};z.push(ve)}if(fe!==0){const ve=jf(fe),we={error:new ae(F.CAN_NOT_GET_GATEWAY_SERVER,ve.desc,{desc:ve.desc,retry:ve.retry,csIp:Q.detail[502]}),flag:ie.buffer.flag};ie.buffer.flag===4194310?w.warning(we.error.toString()):z.push(we)}}),z.length)throw new ae(F.CAN_NOT_GET_GATEWAY_SERVER,z.map(ie=>"flag: ".concat(ie.flag,", message: ").concat(ie.error.message)).join(" | "),{retry:!!z.find(ie=>ie.error.data.retry),csIp:Q.detail[502],desc:[...new Set(z.map(ie=>{var fe;return ie==null||(fe=ie.error)===null||fe===void 0||(fe=fe.data)===null||fe===void 0?void 0:fe.desc}).filter(ie=>!!ie))]})})(P);const G=Kg(P,Hn.CHOOSE_SERVER),Z=Kg(P,Hn.CLOUD_PROXY_FALLBACK);return Xb(G),{gatewayInfo:jb(G,p),proxyInfo:Z,opid:D,requestTime:v,url:p,isHttp3:l,elapse:Date.now()-v}}catch(P){throw P}}(i,e,t),closeFn:i=>i.code===F.OPERATION_ABORTED||i.code===F.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function $U(e,t,n,r){const i=W("PROXY_SERVER_TYPE3"),s=(y,D,A)=>{let P=A||i;return Array.isArray(P)&&(P=D%2==0&&i[1]||i[0]),"https://".concat(P,"/ap/?url=").concat(y)};let o=null;const c=[],l=async()=>{const y=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map((P,j)=>{let V;return V=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(P,"/api/v2/transpond/webrtc?v=2"),j,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):s("".concat(P,"/api/v2/transpond/webrtc?v=2"),j),{url:V,areaCode:Xg(),serviceIds:[Hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK]}}),D=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(P=>P.url)}),A=await Jg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:P=>(w.debug("[".concat(e.clientId,"] Connect to choose_server:"),P.url),zU(P,e,t,n)),allFailedhandler:P=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},D),P[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A},p=async()=>{if(await Rr(1e3),o!==null)return o;const y=W("WEBCS_DOMAIN_BACKUP_LIST").map((P,j)=>{let V;return V=e.cloudProxyServer==="disabled"&&e.proxyServer?s("".concat(P,"/api/v2/transpond/webrtc?v=2"),j,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):s("".concat(P,"/api/v2/transpond/webrtc?v=2"),j),{url:V,areaCode:Xg(),serviceIds:[Hn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Hn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Hn.CLOUD_PROXY:Hn.CLOUD_PROXY_FALLBACK]}}),D=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(P=>P.url)}),A=await Jg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:P=>(w.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),P.url),zU(P,e,t,n)),allFailedhandler:P=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},D),P[0]},promisesCollector:c});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},D),A};let m,E,v;try{({gatewayInfo:m,proxyInfo:E,url:v}=await Hf([l(),p()]))}catch(y){throw y[0]}if(c.length&&c.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!m||!E)throw new ae(F.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=v,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&v){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];Ae(i).call(i,y)&&(e.proxyServer=y,w.setProxyServer(y),Xe.setProxyServer(y))}return o={gatewayInfo:m,proxyInfo:await TU(E,m.uid)},o}async function Gz(e,t,n){const r=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=r.map(s=>function(o,c,l,p){const m={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:Qs,cname:c.cname,uid:c.uid.toString(),requestId:qb,seq:qb};qb+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(m)};return va(async()=>{const v=await wa(o,{data:E,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const D=new ae(F.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw w.error(D.toString()),D}const y=JSON.parse(v.json_body);if(y.code!==200){const D=new ae(F.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw w.error(D.toString()),D}if(!y.servers||y.servers.length===0){const D=new ae(F.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw w.error(D.toString()),D}return{vid:y.vid,workerToken:y.workerToken,addressList:(W("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,v=>!!(v.code!==F.OPERATION_ABORTED&&v.code!==F.UNEXPECTED_RESPONSE||v.data&&v.data.retry),p)}(s,e,t,n));try{const s=await Hf(i);return i.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function Hz(e,t,n){let r=null;const i=[],s=async o=>{const c=W(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return o&&(await Rr(1e3),r!==null)?r:await Jg({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:l=>(w.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),l),function(p,m,E,v){const[y]=jz(m,[Hn.CHOOSE_SERVER]);let D=Gn.networkState;return va(async()=>{D&&Gn.networkState===os.OFFLINE&&Gn.onlineWaiter&&await je.race([Gn.onlineWaiter,Rr(v&&v.maxRetryTimeout||qn.maxRetryTimeout)]),D=Gn.networkState;const A=await wa(p,{data:y,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return Vz(A,p)},()=>!1,A=>A.code!==F.OPERATION_ABORTED&&(A.code===F.UPDATE_TICKET_FAILED?A.data.retry:(w.warning("[".concat(m.clientId,"] update ticket network error, retry"),A),!0)),v)}(l,e,t,n)),allFailedhandler:l=>{throw l[0]},promisesCollector:i})};try{return r=await Hf([s(!1),s(!0)]),i.length&&i.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),r}catch(o){throw o[0]}}function ZU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function $b(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZU(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Kz extends bn{get isSuccess(){return!!this.configs}constructor(t,n){super(),M(this,"configs",void 0),M(this,"store",void 0),M(this,"joinInfo",void 0),M(this,"cancelToken",void 0),M(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),M(this,"interval",void 0),M(this,"mutex",void 0),M(this,"mutableParamsRead",!1),M(this,"configCache",{}),M(this,"limit_bitrate",void 0),this.mutex=new Fr("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),W("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},W("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Xe.reportApiInvoke(null,{options:void 0,name:xn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Tn.TRACER}).onSuccess(JSON.stringify(Sa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void w.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await Wz(this.joinInfo,this.cancelToken,this.retryConfig),w.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(i){var s;const o=rh(s=Object.keys(i).filter(p=>/^webrtc_ng_global_parameter/.test(p))).call(s);for(let p=0;p<o.length;p++)for(let m=o.length-1;m>p;m--){const E=o[m],v=i[E].value;if(typeof v.__priority=="number"){const y=v.__priority,D=o[m-1],A=i[D].value;if(typeof A.__priority=="number"){if(!(y>A.__priority))continue;{const P=E;o[m]=o[m-1],o[m-1]=P}}else{const P=E;o[m]=o[m-1],o[m-1]=P}}}const c=Date.now();let l={};return o.forEach(p=>{const m=i[p].value.__expires;m&&m<=c||(l[p]=i[p])}),l}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new ae(F.NETWORK_RESPONSE_ERROR,r);w.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){uU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Wg.UPDATE_BITRATE_LIMIT,t):this.emit(Wg.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&$b({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),i=[];r.forEach(s=>{const o=t[s].value;n[s]=o;const c=o.__id;if(c&&this.configCache[s]&&this.configCache[s].__id===c)return;const l=o.__type,p=t[s].value,m=t[s].tag;let E=0;l?l===xL.REALTIME&&(E=1):Object.keys(p).some(v=>Object.prototype.hasOwnProperty.call(tb,v)||!Ab()&&Object.prototype.hasOwnProperty.call(Py,v)?(E=1,!0):void 0),i.push({tag:m,isApplied:E,feature:s,params:JSON.stringify(o)})}),i.forEach(s=>{let{tag:o,feature:c,params:l,isApplied:p}=s;this.store.sessionId&&Xe.abTest(this.store.sessionId,{intSucc:1,isApplied:p,tag:o,feature:c,params:l,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){w.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(i){const s={};return Object.keys(i).forEach(o=>{const c=i[o].value,l=c.__expires,p=c.__type;Object.keys(c).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(s,m)||(s[m]=$b($b({value:c[m]},l&&{expires:l}),p&&{type:p}))})}),s}(t);try{var r;const i=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,i&&uU(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(c){try{const l=Date.now();Object.keys(c).forEach(p=>{const{value:m,type:E,expires:v}=c[p];v&&v<=l||((E===xL.REALTIME||Object.prototype.hasOwnProperty.call(tb,p))&&(Sa[p]=m,Sn[p]=m,w.debug("Update realtime parameters from config distribute",p,m)),E||Ab()||!Object.prototype.hasOwnProperty.call(Py,p)||(Sa[p]=m,Sn[p]=m,w.debug("Update gateway parameters from config distribute",p,m)))})}catch(l){w.error("Error update config immediately: ".concat(c),l.message)}}(n);const s=JSON.stringify(n),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),w.debug("Caching global parameters ".concat(s))}catch(i){w.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Sn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;(function(o,c){try{return typeof o=="object"&&typeof c=="object"&&JSON.stringify(o)===JSON.stringify(c)}catch{return!1}})(Sn[r],i)||(Sa[r]=i,Sn[r]=i,this.emit(Wg.UPDATE_CLIENT_ROLE_OPTIONS,i),w.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(n){w.error("Error handling global parameter config:",n.message)}}}class zz extends bn{constructor(){super(...arguments),M(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(W("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const s=t==="VIDEO_ENCODE_FAILED"?W("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var o;const c=Ae(o=i.result).call(o,!0);i.isPrevNormal&&!c&&this.emit("exception",Zb[t],t,n),!i.isPrevNormal&&c&&this.emit("exception",Zb[t]+2e3,t+"_RECOVER",n),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Zn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=as(n._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||Ae(n=W("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Zn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Zb={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Hr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function e5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function wh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Qg{constructor(t){M(this,"store",void 0),M(this,"onStatsException",void 0),M(this,"onUploadPublishDuration",void 0),M(this,"onStatsChanged",void 0),M(this,"onVideoCodecChanged",void 0),M(this,"localStats",new Map),M(this,"remoteStats",new Map),M(this,"updateStatsInterval",void 0),M(this,"trafficStats",void 0),M(this,"trafficStatsPeerList",[]),M(this,"uplinkStats",void 0),M(this,"exceptionMonitor",void 0),M(this,"p2pChannel",void 0),M(this,"scalabilityMode",Ny.L1T1),M(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new zz,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Te.LocalAudioTrack)||wh({},ab)}getLocalVideoTrackStats(){return this.localStats.get(Te.LocalVideoTrack)||wh({},cb)}getRemoteAudioTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:c}]=s;c&&(r[o]=n(o,c))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(n[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:o}]=i;o&&(n[s]=o)});return n}getRemoteVideoTrackStats(t){const n=(s,o)=>{if(!this.trafficStats)return o;const c=this.trafficStats.peer_delay.find(l=>l.peer_uid===s);return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;s&&(r[t]=n(t,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:c}]=s;c&&(r[o]=n(o,c))});return r}getRTCStats(){let t=0,n=0,r=0,i=0;const s=this.localStats.get(Te.LocalAudioTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(Te.LocalVideoTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(Te.LocalVideoLowTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:m,videoStats:E}=p;m&&(r+=m.receiveBytes,i+=m.receiveBitrate),E&&(r+=E.receiveBytes,i+=E.receiveBitrate)});let l=1;return this.trafficStats&&(l+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:l,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?Hr.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?Hr.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&w.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case Te.LocalVideoTrack:case Te.LocalVideoLowTrack:{const c=i,l=wh({},cb),p=t.getStats(),m=t.getLocalMedia(r);if(p){const E=p.videoSend.find(v=>v.ssrc===m?.ssrcs[0].ssrcId);if(E){const v=t.getLocalVideoSize(),y=t.getEncoderConfig(Te.LocalVideoTrack);var s;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(l.codecType=E.codec,c?.codecType!==E.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,E.codec.toLocaleLowerCase()))),l.sendBytes=E.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,E.inputFrame?(l.captureFrameRate=E.inputFrame.frameRate,l.captureResolutionHeight=E.inputFrame.height,l.captureResolutionWidth=E.inputFrame.width):v&&(l.captureResolutionWidth=v.width,l.captureResolutionHeight=v.height),E.sentFrame?(l.sendFrameRate=E.sentFrame.frameRate,l.sendResolutionHeight=E.sentFrame.height,l.sendResolutionWidth=E.sentFrame.width):v&&(l.sendResolutionWidth=v.width,l.sendResolutionHeight=v.height),E.avgEncodeMs&&(l.encodeDelay=E.avgEncodeMs),y&&y.bitrateMax?l.targetSendBitrate=1e3*y.bitrateMax:E.targetBitrate&&(l.targetSendBitrate=E.targetBitrate),l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(l.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(w.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,l),(c?.sendResolutionWidth!==l.sendResolutionWidth||c?.sendResolutionHeight!==l.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,l);break}case Te.LocalAudioTrack:{const c=i,l=wh({},ab),p=t.getStats(),m=t.getLocalMedia(r);if(p){const E=p.audioSend.find(v=>v.ssrc===m?.ssrcs[0].ssrcId);if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(l.codecType=E.codec),E.inputLevel)l.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const v=t.getLocalAudioVolume();v&&(l.sendVolumeLevel=Math.round(32767*v))}l.sendBytes=E.bytes,l.sendPackets=E.packets,l.sendPacketsLost=E.packetsLost,l.sendJitterMs=E.jitterMs,l.sendRttMs=E.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Te.LocalAudioTrack,l),l&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[s,{videoStats:o,audioStats:c,videoPcStats:l}]=n;const p=c,m=o,E=l,v=wh({},zL),y=wh({},YL),D=wh({},OK),{audioTrack:A,videoTrack:P,audioSSRC:j,videoSSRC:V}=t.getRemoteMedia(s);let G;G=this.store.useP2P?t.getStats(!0):t.getStats();const Z=(r=G)===null||r===void 0?void 0:r.audioRecv.find(fe=>fe.ssrc===j),Q=(i=G)===null||i===void 0?void 0:i.videoRecv.find(fe=>fe.ssrc===V),z=this.trafficStats&&this.trafficStats.peer_delay.find(fe=>fe.peer_uid===s);if(Z&&(Z.codec!=="opus"&&Z.codec!=="aac"&&Z.codec!=="PCMU"&&Z.codec!=="PCMA"&&Z.codec!=="G722"||(v.codecType=Z.codec),Z.outputLevel?v.receiveLevel=Math.round(32767*Z.outputLevel):A&&(v.receiveLevel=Math.round(32767*A.getVolumeLevel())),v.receiveBytes=Z.bytes,v.receivePackets=Z.packets,v.receivePacketsLost=Z.packetsLost,v.receivePacketsDiscarded=Z.packetsDiscarded,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.receiveBitrate=p?8*Math.max(0,v.receiveBytes-p.receiveBytes):0,v.totalDuration=p?p.totalDuration+1:1,v.totalFreezeTime=p?p.totalFreezeTime:0,v.freezeRate=v.totalFreezeTime/v.totalDuration,v.receiveDelay=Z.jitterBufferMs,v.totalDuration>10&&Qg.isRemoteAudioFreeze(A)&&(v.totalFreezeTime+=1)),Q){var ie;Q.codec!=="H264"&&Q.codec!=="H265"&&Q.codec!=="VP8"&&Q.codec!=="VP9"&&Q.codec!=="AV1X"&&Q.codec!=="AV1"||(y.codecType=Q.codec),y.receiveBytes=Q.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,y.renderFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,Q.outputFrame&&(y.renderFrameRate=Q.outputFrame.frameRate),Q.receivedFrame?(y.receiveFrameRate=Q.receivedFrame.frameRate,y.receiveResolutionHeight=Q.receivedFrame.height,y.receiveResolutionWidth=Q.receivedFrame.width):P&&(y.receiveResolutionHeight=P._videoHeight||0,y.receiveResolutionWidth=P._videoWidth||0),Q.framesRateFirefox!==void 0&&(y.receiveFrameRate=Math.round(Q.framesRateFirefox)),y.receivePackets=Q.packets,y.receivePacketsLost=Q.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost);const fe=m?m.totalFreezeTime:0,ve=m?m.totalDuration:0;y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=(ie=Q.totalFreezesDuration)!==null&&ie!==void 0?ie:fe||0,y.receiveDelay=Q.jitterBufferMs||0;const we=!!V&&t.getRemoteVideoIsReady(V);Q.totalFreezesDuration===void 0&&P&&we&&Qg.isRemoteVideoFreeze(P,Q,E)&&(y.totalFreezeTime+=1),y.freezeRate=Math.max(0,Math.min((y.totalFreezeTime-fe)/(y.totalDuration-ve),1))}z&&(v.end2EndDelay=z.B_ad,y.end2EndDelay=z.B_vd,v.transportDelay=z.B_ed,y.transportDelay=z.B_ed,v.currentPacketLossRate=z.B_ealr4/100,y.currentPacketLossRate=z.B_evlr4/100,D.uplinkNetworkQuality=z.B_punq?z.B_punq:0,D.downlinkNetworkQuality=z.B_pdnq?z.B_pdnq:0),this.remoteStats.set(s,{audioStats:v,videoStats:y,videoPcStats:Q,networkStats:D}),A&&this.exceptionMonitor.setRemoteAudioStats(A,v),P&&this.exceptionMonitor.setRemoteVideoStats(P,y)})}}class t5{constructor(){M(this,"destChannelMediaInfos",new Map),M(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){lU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){lU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Jy(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function n5(e){if(!(e instanceof t5))return new ae(F.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new ae(F.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new ae(F.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Pd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){M(this,"uid",void 0),M(this,"_uintid",void 0),M(this,"_trust_in_room_",!0),M(this,"_trust_audio_enabled_state_",!0),M(this,"_trust_video_enabled_state_",!0),M(this,"_trust_audio_mute_state_",!0),M(this,"_trust_video_mute_state_",!0),M(this,"_audio_muted_",!1),M(this,"_video_muted_",!1),M(this,"_audio_enabled_",!0),M(this,"_video_enabled_",!0),M(this,"_audio_added_",!1),M(this,"_video_added_",!1),M(this,"_is_pre_created",!1),M(this,"_video_pre_subscribed",!1),M(this,"_audio_pre_subscribed",!1),M(this,"_trust_video_stream_added_state_",!0),M(this,"_trust_audio_stream_added_state_",!0),M(this,"_audioTrack",void 0),M(this,"_videoTrack",void 0),M(this,"_dataChannels",[]),M(this,"_audioSSRC",void 0),M(this,"_videoSSRC",void 0),M(this,"_audioOrtc",void 0),M(this,"_videoOrtc",void 0),M(this,"_cname",void 0),M(this,"_rtxSsrcId",void 0),M(this,"_videoMid",void 0),M(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function r5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function eI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const uT="9",tI=2e4,hT=4e4;function i5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function _l(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?i5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Kf=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Kf||{});const pT=new Map;function s5(e,t,n,r){let{scale:i}=e;if(i===0&&r===Kf.UP||i>=t.length-1&&r===Kf.DOWN)return e;let s=_l(_l({},e),{},{scale:r===Kf.DOWN?++i:--i});switch(n){case"maintain-framerate":s=_l(_l({},s),t[i].motion);break;case"maintain-resolution":s=_l(_l({},s),t[i].detail);break;case"balanced":s=_l(_l({},s),t[i].balanced)}return s}function o5(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:a5(t)};pT.set(e,n)}else pT.delete(e)}function a5(e){const t=_l({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:l,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_DOWN_THRESHOLD:y,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:P,BALANCE_RESOLUTION_FACTOR:j,MOTION_RESOLUTION_FACTOR:V,MOTION_BITRATE_FACTOR:G,DETAIL_FRAMERATE_FACTOR:Z,DETAIL_BITRATE_FACTOR:Q}=ZR,z=Math.min(t.frameRate,c),ie=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(v,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(y,1)*z),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let fe=1;fe<=l;fe++){const ve={bwe_up:Math.round(Math.pow(E,fe)*n),bwe_down:Math.round(Math.pow(v,fe+1)*n),fps_up:Math.round(Math.pow(D,fe)*z),fps_down:Math.round(Math.pow(y,fe+1)*z)},we={scaleResolutionDownBy:i/Math.pow(j,fe),frameRate:Math.max(Math.round(Math.pow(P,fe)*r),o),bitrateMax:Math.max(Math.round(Math.pow(A,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(A,fe)*s),p)},Ct={scaleResolutionDownBy:i/Math.pow(V,fe),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(G,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(G,fe)*s),p)},bt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Z,fe)*r),o),bitrateMax:Math.max(Math.round(Math.pow(Q,fe)*n),m),bitrateMin:Math.max(Math.round(Math.pow(Q,fe)*s),p)};ie.push({scale:fe,threshold:ve,balanced:we,motion:Ct,detail:bt})}return ie}function Yz(e,t,n,r,i,s){const o=pT.get(e)||{overUse:0,underUse:0,adaptationList:a5(i)},{adaptationList:c}=o;pT.set(e,o);const{OVERUSE_TIMES_THRESHOLD:l,UNDERUSE_TIMES_THRESHOLD:p}=ZR,{scale:m}=r;let E,v;return typeof t=="number"&&t>0&&function(y,D,A,P){if(D>=A.length)return!1;let{threshold:{fps_down:j}}=A[D];return W("FORCE_AG_HIGH_FRAMERATE")&&P==="maintain-framerate"&&(j=A[0].threshold.fps_down),y<j}(t,m,c,s)&&(o.overUse++,v=Lg.CPU,o.overUse>l)||typeof n=="number"&&n>0&&function(y,D,A){if(D>=A.length)return!1;const{threshold:{bwe_down:P}}=A[D];return y<P}(n,m,c)&&(o.overUse++,v=Lg.BANDWIDTH,o.overUse>l)?(o.overUse=0,o.underUse=0,E=s5(r,c,s,Kf.DOWN),[E,v]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(y,D,A,P){if(D===0)return;let{threshold:{fps_up:j}}=A[D];return W("FORCE_AG_HIGH_FRAMERATE")&&P==="maintain-framerate"&&(j=A[1].threshold.fps_up),y>j}(t,m,c,s)&&function(y,D,A){if(D===0)return;const{threshold:{bwe_up:P}}=A[D];return y>P}(n,m,c)&&(o.underUse++,o.underUse>p&&(o.overUse=0,o.underUse=0,E=s5(r,c,s,Kf.UP),E.scale===0&&(v=Lg.NONE))),[E,v])}function c5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function nI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?c5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const fT=new Map;function mT(e,t){const n=fT.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),fT.delete(e)}t.qualityLimitationReason=Lg.NONE,o5(e)}function qz(e,t){var n;let r;switch(t){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=e._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return r}function rI(e){const t=Ft();if(e.some(n=>n._bypassWebAudio))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function iI(e,t){rI(e);const n=new Zn;return e.forEach(r=>n.addAudioTrack(r)),n}const Xz=!Ft().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dl();function _T(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return Xz?(n={spec:t,store:e},ml("PlanBConnection").create(n)):new no(t,e)}function sI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function l5(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Pg(e.turnServer.servers))return!1;if(W("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Mt;function d5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let no=(Mt=class Uh extends pU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ae(n=Object.keys(Mg)).call(n,t)}))]}constructor(t,n){super(t,n),M(this,"id",on(5,"connection-")),M(this,"store",void 0),M(this,"peerConnection",void 0),M(this,"forceTurn",!1),M(this,"remoteSDP",void 0),M(this,"initialOffer",void 0),M(this,"transportEventReceiver",void 0),M(this,"statsFilter",void 0),M(this,"extension",{useXR:W("USE_XR")}),M(this,"localCapabilities",void 0),M(this,"remoteCodecs",void 0),M(this,"localCandidateCount",0),M(this,"allCandidatesReceived",!1),M(this,"isPreallocation",!1),M(this,"preMediaMap",new Map),M(this,"dataStreamChannelMap",new Map),M(this,"establishPromise",void 0),M(this,"recoveredDataChannelIds",[]),M(this,"currentDataChannelId",1),M(this,"supportAV1RtpSpec",!1),M(this,"mutex",void 0),M(this,"qualityLimitationReason",Lg.NONE),M(this,"isFirstConnected",!1),this.store=n,this.forceTurn=l5(t),this.mutex=new Fr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Uh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=JR(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Id(r.sdp),s=await kU({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:W("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:W("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=oT(s),this.initialOffer=r,W("ENABLE_SVC")&&this.store.codec=="av1"){const c=await async function(){try{const l=new RTCPeerConnection;l.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Ny.L1T3}]});const p=await l.createOffer();if(!p.sdp)return void l.close();const m=Gi(p.sdp).mediaDescriptions[0];if(!m)return;const E=m.attributes.extmaps.find(v=>v.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return l.close(),E}catch{return}}();var t;c&&(this.supportAV1RtpSpec=!0,(t=s.send)===null||t===void 0||t.videoExtensions.push(c))}let o;return r.sdp&&MU(r.sdp)&&(o=Cn(s),(n=o).send&&(Ff(We.VIDEO,n.send.videoExtensions),Ff(We.AUDIO,n.send.audioExtensions)),n.recv&&(Ff(We.VIDEO,n.recv.videoExtensions),Ff(We.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Ff(We.VIDEO,n.sendrecv.videoExtensions),Ff(We.AUDIO,n.sendrecv.audioExtensions))),Ra(Ra({},i),{},{rtpCapabilities:o||s,offerSDP:r.sdp})}catch(r){throw new pe(F.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&MU(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(rT(We.VIDEO,n.send.videoExtensions,r.send.videoExtensions),rT(We.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(rT(We.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),rT(We.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Cn(this._localCapabilities)}get rtpCapabilities(){return Cn(this._rtpCapabilities)}get candidates(){return Cn(this._candidates)}get iceParameters(){return Cn(this._iceParameters)}get dtlsParameters(){return Cn(this._dtlsParameters)}constructor(l){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1],m=arguments.length>2&&arguments[2]!==void 0&&arguments[2];M(this,"sessionDesc",void 0),M(this,"_localCapabilities",void 0),M(this,"_rtpCapabilities",void 0),M(this,"_candidates",void 0),M(this,"_originCandidates",void 0),M(this,"_iceParameters",void 0),M(this,"_isUseExtmapAllowMixed",void 0),M(this,"_isUseLocalCodecs",void 0),M(this,"_dtlsParameters",void 0),M(this,"setup",void 0),M(this,"currentMidIndex",void 0),M(this,"cname",void 0),M(this,"useLocalCodecsMids",[]),M(this,"preloadSsrcs",[]),M(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,this._isUseLocalCodecs=m,l=Cn(l);const{iceParameters:E,dtlsParameters:v,candidates:y,rtpCapabilities:D,setup:A,localCapabilities:P,cname:j}=l;this._rtpCapabilities=D,this._candidates=y,this._originCandidates=Cn(y),this._iceParameters=E,this._dtlsParameters=v,this._localCapabilities=P,this.setup=A,this.cname=j,[this.sessionDesc]=this.updateRemoteRTPCapabilities(D),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(l){return l.length===this.preloadSsrcs.length&&l.every(p=>{var m;return Ae(m=this.preloadSsrcs).call(m,p)})}preloadRemoteMedia(l){let p=0;const m=[],E=[];for(;l>0;){const v=[eI({ssrcId:hT+p},W("USE_SUB_RTX")?{rtx:hT+p+1}:{})],y="".concat(hT+p,"_").concat(tI+p),{ssrcs:D,ssrcGroups:A}=Yg(v,this.cname,W("SYNC_GROUP")?y:void 0),P=this.preCreateOrRecycleSendMedia("video",D,A,void 0),j=[{ssrcId:tI+p}],V="".concat(hT+p,"_").concat(tI+p),{ssrcs:G,ssrcGroups:Z}=Yg(j,this.cname,W("SYNC_GROUP")?V:void 0),Q=this.preCreateOrRecycleSendMedia("audio",G,Z,void 0);l--,p+=2,m.push(P,Q),E.push(D[0].ssrcId,G[0].ssrcId)}return this.useLocalCodecsMids.push(...m),this.preloadSsrcs=E,{mids:m,preSSRCs:E,isAvailable:!0}}preCreateOrRecycleSendMedia(l,p,m,E){const v=this.rtpCapabilities.send.videoCodecs,y=this._isUseLocalCodecs||v.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;w.debug("create or recycle send media without remote rtp capabilities, ssrcs ",p[0].ssrcId);const D=l===We.VIDEO?y.videoCodecs:y.audioCodecs,A=l===We.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;const P="".concat(this.currentMidIndex);let j={media:{mediaType:l,port:uT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.map(V=>V.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:D,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(P)}};return j=this.mungSendMediaDesc(j,E),this.sessionDesc.mediaDescriptions.push(j),this.updateBundleMids(),P}toString(){return yd(this.sessionDesc)}send(l,p,m,E){const{ssrcs:v,ssrcGroups:y}=Yg(p,this.cname,W("SYNC_GROUP")?m:void 0),D=this.findPreloadMediaDesc(v);if(D){if(Nn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,D.attributes.mid),E&&(E.twcc||E.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(D);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(D,E),{mid:D.attributes.mid,needExchangeSDP:!0}}return{mid:D.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(l,v);let P;return A===-1||A===1&&(Pr()||function(){const j=xt();return!(j.name!==Wt.CHROME||!j.osVersion)&&Number(j.version)<=90}()||W("ENABLE_ENCODED_TRANSFORM")&&ll())||A===0&&!function(j){const V=xt();return!(V.name!==Wt.FIREFOX||!V.osVersion)&&Number(V.version)===j}(138)&&W("USE_SUB_RTX")||sL()?(P=this.createOrRecycleSendMedia(l,v,y,"sendonly",E),this.updateBundleMids()):(P=Cn(this.sessionDesc.mediaDescriptions[A]),P.attributes.direction="sendonly",P.attributes.ssrcs=v,P.attributes.ssrcGroups=y,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(P,E)),Nn()&&this.firefoxSsrcMidMap.set(v[0].ssrcId,P.attributes.mid),{mid:P.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:l,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:l.attributes.mid,needExchangeSDP:p}}batchSend(l){const p=l.map(v=>{let{kind:y,ssrcMsg:D,mslabel:A}=v;return this.send(y,D,A)}),m=[];let E=!1;return p.forEach(v=>{let{mid:y,needExchangeSDP:D}=v;D&&(E=!0),m.push(y)}),{mids:m,needExchangeSDP:E}}stopSending(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&l.indexOf(m.attributes.mid)!==-1);if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(m=>{m.attributes.mid==="0"||Nn()||sL()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(l){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l);if(!p)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(l){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l);if(!p)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>Ae(l).call(l,m.attributes.mid||""));if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>Ae(l).call(l,m.attributes.mid||""));if(p.length!==l.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="recvonly"})}receive(l,p,m,E){l.forEach((v,y)=>{this.createOrRecycleRecvMedia(v,[],"recvonly",p,m,E[y])}),this.updateBundleMids()}stopReceiving(l){const p=this.sessionDesc.mediaDescriptions.filter(m=>l.indexOf(m.attributes.mid)!==-1);if(p.length!==l.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(l){const p=this.sessionDesc||Gi((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=l;let E=!1;const v=this.rtpCapabilities.send,y=this.localCapabilities.send,D=this.localCapabilities.recv,A=D.videoCodecs,P=D.audioCodecs,j=D.videoExtensions,V=D.audioExtensions;for(const z of p.mediaDescriptions){var G;if(z.attributes.direction!=="sendonly"||typeof z.attributes.mid!="string"||!Ae(G=this.useLocalCodecsMids).call(G,z.attributes.mid)){if(E=!0,z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var Z;z.media.fmts=A.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=A,z.attributes.extmaps=j;const ie=z.attributes.mid;typeof ie!="string"||Ae(Z=this.useLocalCodecsMids).call(Z,ie)||this.useLocalCodecsMids.push(ie)}else if(v.videoCodecs.length===0){const ie=y.videoCodecs.filter(fe=>{var ve,we;return(ve=fe.rtpMap)===null||ve===void 0?void 0:Ae(we=ve.encodingName.toLowerCase()).call(we,"vp8")})||[y.videoCodecs[0]];z.media.fmts=ie.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=ie,z.attributes.extmaps=[]}else z.media.fmts=v.videoCodecs.map(ie=>ie.payloadType.toString(10)),z.attributes.payloads=v.videoCodecs,z.attributes.extmaps=v.videoExtensions;if(z.media.mediaType==="audio")if(this._isUseLocalCodecs&&z.attributes.direction==="sendonly"){var Q;z.media.fmts=P.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=P,z.attributes.extmaps=V;const ie=z.attributes.mid;typeof ie!="string"||Ae(Q=this.useLocalCodecsMids).call(Q,ie)||this.useLocalCodecsMids.push(ie)}else if(v.audioCodecs.length===0){const ie=y.audioCodecs.filter(fe=>{var ve,we;return(ve=fe.rtpMap)===null||ve===void 0?void 0:Ae(we=ve.encodingName.toLowerCase()).call(we,"opus")})||[y.audioCodecs[0]];z.media.fmts=ie.map(fe=>fe.payloadType.toString(10)),z.attributes.payloads=ie,z.attributes.extmaps=[]}else z.media.fmts=v.audioCodecs.map(ie=>ie.payloadType.toString(10)),z.attributes.payloads=v.audioCodecs,z.attributes.extmaps=v.audioExtensions,Wf(z)}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,[this.sessionDesc,E]}updateCandidates(l){const p=this._originCandidates.filter(E=>E.transport==="udp"),m=[];if(p.forEach(E=>{m.push(eI(eI({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}),p.length!==0){switch(l){case Gr.TCP_RELAY:this._candidates=m;break;case Gr.UDP_TCP_RELAY:case Gr.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(l){l=Cn(l),this._iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=l.iceUfrag,p.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const p=[];for(let m=0;m<l;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(l,p){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const E=m.media.mediaType===l&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(Nn()){if(E){const v=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(v||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!v||v!==m.attributes.mid)}return!1}return E})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const l="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:uT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(l),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(l,p,m,E,v,y){const D=l._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,P=qg(D,A,this.localCapabilities.send,D===We.VIDEO?E:v),j=D===We.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let G={media:{mediaType:D,port:uT,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.map(Q=>Q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:P,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};G=this.mungRecvMediaDsec(G,l,y);const Z=this.findFirstClosedMedia(D);if(Z){const Q=this.sessionDesc.mediaDescriptions.indexOf(Z);this.sessionDesc.mediaDescriptions[Q]=G}else this.sessionDesc.mediaDescriptions.push(G);return G}updateRemoteDtlsParameters(l){const p=new Set(this._dtlsParameters.fingerprints.map(v=>v.fingerprint)),m=new Set(l.map(v=>v.fingerprint));let E=!1;p.size!==m.size&&(E=!0);for(const v of p)m.has(v)||(E=!0);return E}updateRemoteCodec(l,p,m){const E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(G=>G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||"").filter(G=>{var Z;return Ae(Z=Object.keys(Mg)).call(Z,G)}))],v=new Set(p);if(E.every(G=>v.has(G)))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const y=this._rtpCapabilities.recv.videoCodecs.filter(G=>p.some(Z=>{var Q;return Ae(Q=G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||"").call(Q,Z)}));if(y.length===0)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(p)),!1;const D=[...new Set(y.map(G=>G.rtpMap&&G.rtpMap.encodingName.toLowerCase()||""))];let A;if(w.debug("updateRemoteCodec, from ".concat(E," to ").concat(D)),l.length===0)A=this.sessionDesc.mediaDescriptions.filter(G=>G.media.mediaType==="video"&&G.attributes.direction==="recvonly");else if(A=this.sessionDesc.mediaDescriptions.filter(G=>G.attributes.mid&&G.media.mediaType==="video"&&Ae(l).call(l,G.attributes.mid)&&G.attributes.direction==="recvonly"),A.length!==l.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(l,", codecs: ").concat(p)),!1;if(W("USE_PUB_RTX")||W("USE_SUB_RTX")){const G=Ad(y,this.rtpCapabilities.recv.videoCodecs);y.push(...G)}this._rtpCapabilities.recv.videoCodecs=y;const P=this.localCapabilities.send,j=this.rtpCapabilities.recv,V=qg(We.VIDEO,j,P,m);return A.forEach(G=>{const Z=V.map(Q=>Q.payloadType.toString(10));w.debug("updateRemoteCodec mid: ".concat(G.attributes.mid,", from"),G.attributes.payloads,"to",V),G.attributes.payloads=V,G.media.fmts=Z}),!0}createOrRecycleSendMedia(l,p,m,E,v){const y=this.rtpCapabilities.send.videoCodecs,D=this._isUseLocalCodecs||y.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,A=l===We.VIDEO?D.videoCodecs:D.audioCodecs,P=l===We.VIDEO?D.videoExtensions:D.audioExtensions;this.currentMidIndex+=1;const j="".concat(this.currentMidIndex);let V={media:{mediaType:l,port:uT,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(Z=>Z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:P,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(j)}};V=this.mungSendMediaDesc(V,v);const G=this.findFirstClosedMedia(l);if(G){const Z=this.sessionDesc.mediaDescriptions.indexOf(G);this.sessionDesc.mediaDescriptions[Z]=V}else this.sessionDesc.mediaDescriptions.push(V);return V}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(l=>l.media.port!=="0").map(l=>l.attributes.mid)}mungRecvMediaDsec(l,p,m){const E=Cn(l);return Bb(E),Bf(E,p),Wb(E,p),NU(E),sT(E,m,this.localCapabilities.send),E}mungSendMediaDesc(l,p){const m=Cn(l);return sT(m,p,this.localCapabilities.recv),Wf(m),m}updateRecvMedia(l,p){const m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===l);if(m!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=E}}bumpMid(l){this.currentMidIndex+=l}findFirstClosedMedia(l){return this.sessionDesc.mediaDescriptions.find(p=>Nn()?p.media.port==="0"&&p.media.mediaType===l:p.media.port==="0")}findPreloadMediaDesc(l){return this.sessionDesc.mediaDescriptions.find(p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===l[0].ssrcId})}getSSRC(l){var p;return(p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===l))===null||p===void 0?void 0:p.attributes.ssrcs}}(Ra(Ra({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!W("ENABLE_PRE_SUB_WITH_PRE_PC")||!W("PRE_USE_LOCAL_CODECS"))&&ib(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=LU(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),ib(this.store))if(t.preallocation&&W("ENABLE_PRE_SUB_WITH_PRE_PC")){const l=W("PRE_SUB_NUM"),{mids:p,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(l);await Od(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(p,m)}else{const{preSSRCs:l=[]}=t,p=l.map(E=>E.ssrcMsg[0].ssrcId);if(l.length===0)return;const{mids:m}=this.remoteSDP.batchSend(l.map(E=>Object.assign({},E)));await Od(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(p)),this.presetMedia(m,p)}}catch(i){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var n,r}presetMedia(t,n){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&r===s.mid&&s.receiver.track){const o=s.receiver.track;let c;o.kind==="video"&&W("ENABLE_PRE_RENDER")&&(c=new gb({trackId:"track-".concat(o.kind,"-unknown-").concat(this.store.clientId,"_").concat(on(5,""))},!0),c.updateVideoTrack(o),c.onFirstVideoFrameRender=()=>{var l;const p=this.preMediaMap.get(n[i]);p&&(p.firstVideoRender=Date.now()),(l=this.onFirstVideoRender)===null||l===void 0||l.call(this,n[i])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[i],{mid:r,track:o,player:c,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:r}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const o=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||o}const{preSSRCs:i=[]}=t,s=i.map(o=>o.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const o=[],c=[];if(Array.from(this.preMediaMap.entries()).every(l=>{let[p,{mid:m,player:E,track:v}]=l;return o.push(m),c.push(p),this.preMediaMap.delete(p),E&&E.destroy(),!0}),o.length>0&&(this.remoteSDP.stopSending(o),await Od(this.peerConnection,this.remoteSDP,this.extension),w.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),Xe.reportApiInvoke(this.store.sessionId,{name:xn.PRELOAD_MEDIA_FAILED,options:[i,c],tag:Tn.TRACER}).onSuccess()),i.length>0){const{mids:l}=this.remoteSDP.batchSend(i.map(p=>Object.assign({},p)));await Od(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(l,s)}}n?(await Od(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):w.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return Js(function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=nT();t.forEach(P=>{const j=i.peerConnection.addTransceiver(P._mediaStreamTrack,Ra({direction:"sendonly"},P.trackMediaType==="video"&&i.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));o.push(j),P._updateRtpTransceiver(j)}),Nn()&&W("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=yield jt(i.peerConnection.createOffer()),p=i.remoteSDP.predictReceivingMids(t.length),m=i.mungSendOfferSDP(l.sdp,t,p),E=Gi(m),v=p.map(P=>{const j=E.mediaDescriptions.find(V=>V.attributes.mid===P);if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return IU(j,W("USE_PUB_RTX"))});let y;try{y=yield v}catch(P){y=[],i.remoteSDP.receive(t,n,r,y);const j=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:j})),yield jt(i.stopSending(p,!0)),P}i.remoteSDP.receive(t,n,r,y);const D=i.remoteSDP.toString(),A=i.logSDPExchange(m,"offer","local","send");return yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t)),A?.(D),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:D})),o.map((P,j)=>{const V=p[j];return{localSSRC:v[j],id:V,transceiver:P}})}catch(o){throw o instanceof pe?o:new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")w.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),w.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else w.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof pe?r:new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof pe?n:new pe(F.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(l=>{var p;mT(this.id+l.mid,this),l.direction="inactive",(p=l.stop)===null||p===void 0||p.call(l)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);o&&(await Od(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Od(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(o=>o.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(this.preMediaMap.entries()).some(o=>{let[c,{mid:l,player:p}]=o;if(l===s)return this.preMediaMap.delete(c),p&&p.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(o,c)=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Js(function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration,s=W("FORCE_TURN_TCP")||n.forceTurn;if(t===Gr.RELAY&&!i)return;if(i&&!s){const E=t===Gr.RELAY?"relay":"all",v=n.peerConnection.getConfiguration();v.iceTransportPolicy!==E&&(w.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(E,"]")),v.iceTransportPolicy=E,n.peerConnection.setConfiguration(v))}n.remoteSDP.updateCandidates(t);const o=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Id(o.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const p=n.remoteSDP.toString(),m=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield jt(n.peerConnection.setLocalDescription(o)),m?.(p),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(i){w.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Gr.TCP_RELAY),await Od(this.peerConnection,this.remoteSDP,this.extension)}catch(n){w.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{mT(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:r}=n;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ra(Ra({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new pe(F.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Ra(Ra({},vc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Ra(Ra({},vc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",s=Ch(t.url||"");w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(s||"",", host_candidate:").concat(i)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Pg(t.turnServer.servers)?n.iceServers=t.turnServer.servers:W("NEW_TURN_MODE")&&n.iceServers&&r==="disabled"?(W("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Uh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Uh.newTurnServerConfigToIceServers(t.turnServer.servers)),W("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Uh.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Uh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Rd(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!W("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const i=W("NEW_TURN_MODE");i===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Rd(r.turnServerURL),":443?transport=tcp")}):i===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Rd(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n?.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair()||{};if(i&&s){const o=i.address+":"+i.port,c=s.address+":"+s.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ch(o)),", remote ").concat(JSON.stringify(Ch(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(P=>P.track===t._mediaStreamTrack)),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=function(A,P){return A.getTransceivers().find(j=>j.sender.track===P||j.receiver.track===P)}(this.peerConnection,t._mediaStreamTrack),l=LK(t);if(function(A){var P;return!(!W("ENABLE_AG_ADAPTATION")||!(A instanceof jy||Ae(P=A._hints).call(P,rn.CUSTOM_TRACK))||!W("FORCE_SUPPORT_AG_ADAPTATION")&&!(rL(14,0,!1)&&iL(17,4)||nL(14)&&DR(17,4,!0)))}(t)&&c&&n&&l&&this.getLocalVideoStats&&Ae(r=["vp8","vp9"]).call(r,this.store.codec)){var p;const A=s.degradationPreference||(Ae(p=t._hints).call(p,rn.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(P,j,V,G,Z,Q){if(mT(P,V),Z(j),G!=="balanced"&&G!=="maintain-framerate"&&G!=="maintain-resolution")return;let z=-1;o5(P,j);const ie=window.setInterval(()=>{const ve=fT.get(P);if(!W("ENABLE_AG_ADAPTATION")||!ve)return mT(P,V),void Z(j);const we=Q();if(we.sendPackets>0&&we.OutgoingAvailableBandwidth>0){if(z===-1)return void(z=Date.now());if(Date.now()-z<1e3)return;const Ct=we.sendFrameRate,bt=we.OutgoingAvailableBandwidth,[ut,Yt]=Yz(P,Ct,bt,ve.adaptationConfig,j,G);Yt&&(V.qualityLimitationReason=Yt),ut&&ve.adaptationConfig.scale!==ut.scale&&(w.debug("[".concat(P,"] applyAdaptation: ").concat(V.qualityLimitationReason,`
           sendFps `).concat(Ct,", bwe ").concat(bt,", switch from ").concat(ve.adaptationConfig.scale," to ").concat(ut.scale," ")),ve.adaptationConfig=nI(nI({},ve.adaptationConfig),ut),Z(ut))}},W("CHECK_LOCAL_STATS_INTERVAL")),fe=nI({},j);fT.set(P,{timer:ie,adaptationConfig:fe,originConfig:j,adaptationFunc:Z}),w.debug("[".concat(P,"] start adaptation, originConfig: ").concat(JSON.stringify(j),", degradationPreference: ").concat(G))})(this.id+c.mid,l,this,A,P=>{n&&this.updateAdaptation(n,P)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;const{bitrateMax:A,frameRate:P,scaleResolutionDownBy:j}=t._encoderConfig;A&&(o.maxBitrate=1e3*A),(Ae(m=t._hints).call(m,rn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(P&&(o.maxFramerate=as(P)),j&&j>=1&&(o.scaleResolutionDownBy=j))}const{maxFramerate:E}=W("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,E):E),W("DSCP_TYPE")&&dl()){var v;const A=W("DSCP_TYPE");Ae(v=["very-low","low","medium","high"]).call(v,A)&&(o.networkPriority=A)}const y=n.getParameters(),D=(i=y.encodings)===null||i===void 0?void 0:i[0];Nn()&&!D&&(s.encodings=[o]),D&&Object.assign(D,o),Object.assign(y,s),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await n.setParameters(y),await async function(A,P,j){try{var V;if(!Ft().supportSetRtpSenderParameters||!function(ie){return ie==="vp9"||ie==="av1"}(A)||!W("ENABLE_SVC"))return;const G={},Z={},Q=P.getParameters(),z=(V=Q.encodings)===null||V===void 0?void 0:V[0];Z.scalabilityMode=nT(j),z&&Object.assign(z,Z),Object.assign(Q,G),await P.setParameters(Q),w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Q.encodings)))}catch(G){w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",G)}}(this.store.codec,n,W("SVC_MODE"))}async updateAdaptation(t,n){var r,i;if(!t)return w.debug("[updateAdaptation] no rtpSender found");if(!Ft().supportSetRtpSenderParameters)return w.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:l}=n;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=as(c)),l&&l>=1&&Ae(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=l);const p=t.getParameters(),m=(i=p.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,s),Object.assign(p,{});try{await t.setParameters(p),w.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?w.debug("[updateAdaptation] peerConnection not connected}"):w.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):w.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof mn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Gi(t);return n.forEach((s,o)=>{const c=r[o],l=i.mediaDescriptions.find(p=>p.attributes.mid===c);l&&(Bf(l,s),PU(l,s,this.store.codec))}),yd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const p=t[l],m=n[l];if(m instanceof mn&&!Ae(r=m._hints).call(r,rn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,n){if(!Nn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof mn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof mn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ae(n=t._hints).call(n,rn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(W("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=Uh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},qe(Mt.prototype,"updateRemoteRTPCapabilities",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteRTPCapabilities"),Mt.prototype),qe(Mt.prototype,"connect",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"connect"),Mt.prototype),qe(Mt.prototype,"updateRemoteConnect",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateRemoteConnect"),Mt.prototype),qe(Mt.prototype,"createDataChannels",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"createDataChannels"),Mt.prototype),qe(Mt.prototype,"receive",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"receive"),Mt.prototype),qe(Mt.prototype,"batchReceive",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"batchReceive"),Mt.prototype),qe(Mt.prototype,"stopReceiving",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"stopReceiving"),Mt.prototype),qe(Mt.prototype,"muteRemote",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"muteRemote"),Mt.prototype),qe(Mt.prototype,"unmuteRemote",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteRemote"),Mt.prototype),qe(Mt.prototype,"muteLocal",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"muteLocal"),Mt.prototype),qe(Mt.prototype,"unmuteLocal",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"unmuteLocal"),Mt.prototype),qe(Mt.prototype,"close",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),qe(Mt.prototype,"updateEncoderConfig",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateEncoderConfig"),Mt.prototype),qe(Mt.prototype,"updateSendParameters",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateSendParameters"),Mt.prototype),qe(Mt.prototype,"replaceTrack",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),qe(Mt.prototype,"updateAdaptation",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"updateAdaptation"),Mt.prototype),qe(Mt.prototype,"getRemoteSSRC",[Ni],Object.getOwnPropertyDescriptor(Mt.prototype,"getRemoteSSRC"),Mt.prototype),Mt);function Ni(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function oI(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=as(t.width),r.height=as(t.height);const i=as(t.framerate||15);document.body.append(n),document.body.append(r);let s=e._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=r.getContext("2d");if(!o)throw new ae(F.UNEXPECTED_ERROR,"can not get canvas context");const c=Ft(),l=r.captureStream(c.supportRequestFrame?0:i).getVideoTracks()[0];l.canvas||(l.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,E=n.videoHeight/m,v=r.width*E;Math.abs(v-r.height)>=2&&(w.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(v)),r.height=v)}o.drawImage(n,0,0,r.width,r.height),l.requestFrame&&l.requestFrame(),s!==e._mediaStreamTrack&&(s=e._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=ub(()=>r.startCapture&&r.startCapture(),i);const p=l.stop;return l.stop=()=>{p.call(l),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),w.debug("clean low stream renderer")},l}var u5=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(u5||{}),ba=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(ba||{}),mt=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(mt||{}),Ar=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(Ar||{}),Pi=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Pi||{}),gT=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(gT||{});const Rh=1e3,ET=6,$g=3,Jz=Math.max(ET,$g,60);function it(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function h5(e){const t={[Pi.CONN_TYPE]:0,[Pi.RTT]:e.rtt,[Pi.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Pi.CONN_TYPE]=1),n==="tcp"&&(t[Pi.CONN_TYPE]=3),n==="tls"&&(t[Pi.CONN_TYPE]=4);break}case"srflx":t[Pi.CONN_TYPE]=2;break;case"unknown":t[Pi.CONN_TYPE]=5;break;default:t[Pi.CONN_TYPE]=0}return t}function p5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class f5 extends bn{constructor(t){super(),M(this,"store",void 0),M(this,"uploadWRTCStatsTimer",void 0),M(this,"uploadOutboundDenoiserStatsTimer",void 0),M(this,"uploadExtStatsTimer",void 0),M(this,"uploadExtUsageStatsTimer",void 0),M(this,"uploadInboundExtStatsTimer",void 0),M(this,"requestStats",void 0),M(this,"requestTransportStats",void 0),M(this,"requestLocalMedia",void 0),M(this,"requestRemoteMedia",void 0),M(this,"requestAllTracks",void 0),M(this,"requestVideoIsReady",void 0),M(this,"requestUploadStats",void 0),M(this,"requestUpload",void 0),M(this,"uploadOutboundStarted",!1),M(this,"uploadInboundStarted",!1),M(this,"uploadTransportStarted",!1),M(this,"uploadBaseStatsStarted",!1),M(this,"uploadExtensionUsageStarted",!1),M(this,"lastRecvStats",void 0),M(this,"lastSendStats",void 0),M(this,"lastRefRecvStats",void 0),M(this,"lastRefSendStats",void 0),M(this,"lastNormalRecvStats",void 0),M(this,"lastNormalSendStats",void 0),M(this,"lastExtendStats",{}),M(this,"needUploadStats",{}),M(this,"needUploadRenderFreezeTime",!0),M(this,"lastUploadCompensateTime",-1),M(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%$g==0,r=t%ET==0,i=t%60==0;let s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;const l={};if(this.uploadTransportStarted&&s){const m=this.getTransportStats(s,o,n);m&&(l.misc=[m])}if(this.uploadOutboundStarted&&s){const m=this.getOutboundStats(s,r?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,i);m&&(l.outbound=[m])}if(this.uploadInboundStarted&&o){this.uploadCompensateStats(t);const m=this.getInboundStats(o,r?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);m&&(l.inbound=m)}const p=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;p&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[gT.RTC_PEER_CONNECTION_STATE]=XR[p]):l.misc=[{addition:{[gT.RTC_PEER_CONNECTION_STATE]:XR[p]}}]),this.needUploadStats.sendType&&(Array.isArray(l.outbound)&&l.outbound[0]&&l.outbound[0].high&&(l.outbound[0].high[u5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(l)}this.lastRecvStats=o,this.lastSendStats=s,r&&(this.lastNormalRecvStats=o,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const i=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[gT.RTC_PEER_CONNECTION_STATE]:XR[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Jz+1&&(t=1)},Rh)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%$g==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const s=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const o={};if(this.uploadInboundStarted&&s){const c=this.requestRemoteMedia()||[],l=[];c.forEach(p=>{let[m,E]=p;const v={peer:m.uid};if(m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)&&E.has(We.VIDEO)&&m.videoTrack){const y=function(D,A,P){if(!A.videoRecv.find(V=>V.ssrc===D))return;const j={};if(P&&P._player){const V=P._player,{renderFreezeAccTime2:G,videoElementStatus:Z}=V;if(Tc.visibility==="visible"&&Z===Br.PLAYING&&Ft().supportRequestVideoFrameCallback){const Q=Math.min(6e3,G);V.renderFreezeAccTime2=Math.max(0,G-Q),it(j,ba.Video_Render_Freeze_Time_Render2,Q),W("USE_NEW_RENDER_FREEZE_TIME")&&it(j,ba.Video_Render_Freeze_Time_Render,Q)}}return j}(m._videoSSRC,s,m.videoTrack);y&&(v.video=y)}v.video&&l.push(v)}),l.length>0&&(o.inbound=l,this.requestUploadStats(o))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[Pi.RTT]:t.rtt,[Pi.CONN_TYPE]:void 0,[Pi.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const i=h5(t);if(this.store.useP2P){if(n){const s=h5(n);i[Pi.CONN_TYPE]+=s[Pi.CONN_TYPE]<<3}i[Pi.CONN_TYPE]+=110}else i[Pi.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,n,r,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const o=this.requestLocalMedia();if(!o||o.length===0)return;let c,l,p;return o.forEach(m=>{let[E,{track:v,ssrcs:y}]=m;switch(E){case Te.LocalVideoLowTrack:case Te.LocalVideoTrack:if(E===Te.LocalVideoTrack){var D;const A=function(G,Z,Q,z,ie,fe){const ve=Z.videoSend.find(ut=>ut.ssrc===G);if(!ve)return;const we={},{sentFrame:Ct,inputFrame:bt}=ve;if(z&&(it(we,ba.Video_Send_Qp_Sum,ve.qpSumPerFrame),bt&&Ct)){const ut=bt.frameRate,Yt=Ct.frameRate;we[ba.Video_Send_Freeze]=function(Ht,Kr){let Ee=!0;return Ee=!(Ht<=5)&&(Ht<=10?Kr<3:Ht<=20?Kr<4:Kr<5),Ee}(ut,Yt)?1:0}if(ie){switch(Ct&&(it(we,mt.Video_Send_Height,Ct.height),it(we,mt.Video_Send_Width,Ct.width),it(we,mt.Video_Send_Frame_Rate,Ct.frameRate)),we[mt.Video_Send_Disabled]=Q._originMediaStreamTrack&&!Q._originMediaStreamTrack.enabled||Q._mediaStreamTrack&&!Q._mediaStreamTrack.enabled?1:0,ve.adaptionChangeReason){case"none":we[mt.Video_Send_Adaptation]=0;break;case"cpu":we[mt.Video_Send_Adaptation]=1;break;case"bandwidth":we[mt.Video_Send_Adaptation]=2;break;case"other":we[mt.Video_Send_Adaptation]=3}let ut=0;ve.adaptionChangeReason&&(ut+=p5(ve.adaptionChangeReason)),Z.qualityLimitationReason&&(ut+=p5(Z.qualityLimitationReason)<<3),we[mt.Video_Send_Adaptation]=ut,we[mt.Video_Send_Player_Status]=lb[Q._player?Q._player.videoElementStatus:"uninit"],it(we,mt.Video_Send_Nacks,ve.nacksCount),it(we,mt.Video_Send_Plis,ve.plisCount),it(we,mt.Video_Send_Firs,ve.firsCount),it(we,mt.Video_Send_Avg_Encode,ve.avgEncodeMs),it(we,mt.Video_Send_Huge_Frame_Sent,ve.hugeFramesSent),it(we,mt.Video_Send_Bytes_Retransmit,ve.retransmittedBytesSent),it(we,mt.Video_Send_Packages_Retransmit,ve.retransmittedPacketsSent),it(we,mt.Video_Send_Key_Frames_Encoded,ve.keyFramesEncoded);const Yt=ie.videoSend.find(Ht=>Ht.ssrc===G);if(Yt){let Ht=Rh*$g;Yt.timestamp&&ve.timestamp&&(Ht=ve.timestamp-Yt.timestamp),Yt.packets!=null&&ve.packets!=null&&it(we,mt.Video_Send_Package_Rate,1e3*(ve.packets-Yt.packets)/Ht),ve.packetsLost!=null&&Yt.packetsLost!=null&&it(we,mt.Video_Send_Package_Lost,ve.packetsLost-Yt.packetsLost),Yt.bytes!=null&&ve.bytes!=null&&it(we,mt.Video_Send_Bitrate,8*(ve.bytes-Yt.bytes)/Ht)}}return we}(y[0].ssrcId,t,v,n,r),P=v.__className__==="CameraVideoTrack"?3:Ae(D=v._hints).call(D,rn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==P||s)&&(this.needUploadStats={sendType:P},this.lastExtendStats.sendType=P);const j=v&&function(G,Z,Q,z){const ie=Z.videoSend.find(ve=>ve.ssrc===G);if(!ie)return null;const fe={};if(z){const ve=ie.inputFrame,we=ve&&ve.height||Q.videoHeight||0,Ct=ve&&ve.width||Q.videoWidth||0,bt=ve&&ve.frameRate||0;it(fe,mt.Video_Capture_Height,we),it(fe,mt.Video_Capture_Width,Ct),it(fe,mt.Video_Capture_Frame_Rate,bt)}return fe}(y[0].ssrcId,t,v,!!r),V=function(G,Z){const Q={};return Z&&(it(Q,mt.Video_Send_Retransmit,G.bitrate.retransmit),it(Q,mt.Video_Send_Target_Encoded,G.bitrate.targetEncoded),it(Q,mt.Video_Send_Actual_Encoded,G.bitrate.actualEncoded),it(Q,mt.Video_Send_Transmit,G.bitrate.transmit),it(Q,mt.Video_Send_Bandwidth,G.sendBandwidth)),Q}(t,!!r);l=Object.assign({},A,j,V)}else p=function(A,P,j,V,G){const Z=P.videoSend.find(z=>z.ssrc===A);if(!Z)return;const Q={};if(V){const z=Z.sentFrame;z&&(it(Q,mt.Video_Send_Low_Height,z.height),it(Q,mt.Video_Send_Low_Width,z.width),it(Q,mt.Video_Send_Low_Frame_Rate,z.frameRate));const ie=V.videoSend.find(fe=>fe.ssrc===A);if(ie){let fe=Rh*ET;ie.timestamp&&Z.timestamp&&(fe=Z.timestamp-ie.timestamp),ie.packets!=null&&Z.packets!=null&&it(Q,mt.Video_Send_Low_Package_Rate,1e3*(Z.packets-ie.packets)/fe),Z.packetsLost!=null&&ie.packetsLost!=null&&it(Q,mt.Video_Send_Low_Package_Lost,Z.packetsLost-ie.packetsLost),ie.bytes!=null&&Z.bytes!=null&&it(Q,mt.Video_Send_Low_Bitrate,8*(Z.bytes-ie.bytes)/fe)}}return Q}(y[0].ssrcId,t,0,r);break;case Te.LocalAudioTrack:c=v&&function(A,P,j,V,G,Z){const Q=P.audioSend.find(ie=>ie.ssrc===A);if(!Q)return;const z={};if(G){z[mt.Audio_Send_Disabled]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const ie=100*j._source.getAccurateVolumeLevel(),fe=Q.inputLevel;if(fe!=null){const we=Math.ceil(50*Math.log10(100*fe+1));it(z,mt.Audio_Send_Level,we)}it(z,mt.Audio_Capture_PCM_Level,ie),it(z,mt.Audio_Send_AEC_Return_Loss,Q.aecReturnLoss),it(z,mt.Audio_Send_AEC_Return_Loss_Enhancement,Q.aecReturnLossEnhancement),it(z,mt.Audio_Send_Bytes_Retransmit,Q.retransmittedBytesSent),it(z,mt.Audio_Send_Packages_Retransmit,Q.retransmittedPacketsSent),z[mt.Audio_Send_Freeze]=0;const ve=G.audioSend.find(we=>we.ssrc===A);if(ve){let we=Rh*ET;ve.timestamp&&Q.timestamp&&(we=Q.timestamp-ve.timestamp),ve.bytes!=null&&Q.bytes!=null&&it(z,mt.Audio_Send_Bitrate,8*(Q.bytes-ve.bytes)/we),ve.packets!=null&&Q.packets!=null&&it(z,mt.Audio_Send_Package_Rate,1e3*(Q.packets-ve.packets)/we)}}return z}(y[0].ssrcId,t,v,0,r)}}),{high:l,low:p,audio:c}}getInboundStats(t,n,r,i){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],o=[];return s.forEach(c=>{let[l,p]=c;const m={peer:l.uid};if(p.has(We.VIDEO)&&l.videoTrack){const E=l._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(l._videoSSRC)||!1,v=l.videoTrack?function(y,D,A,P,j,V,G,Z){const Q=D.videoRecv.find(ut=>ut.ssrc===y);if(!Q)return;const z={},{receivedFrame:ie,outputFrame:fe,decodeFrameRate:ve}=Q;it(z,Ar.Video_Render_Frame_Rate_Decode,ve),Q.framesRateFirefox&&it(z,Ar.Video_Recv_Frame_Rate,Q.framesRateFirefox),ie&&it(z,Ar.Video_Recv_Frame_Rate,ie.frameRate),it(z,Ar.Video_Recv_Frame_Dropped,Q.framesDroppedCount),it(z,Ar.Video_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),it(z,Ar.Video_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),it(z,Ar.Video_Recv_Packages_Discarded,Q.packetsDiscarded),it(z,Ar.Video_Recv_Avg_Decode,Q.avgDecodeMs),it(z,Ar.Video_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs),it(z,Ar.Video_Recv_Avg_Assembly_Time,Q.avgFramesAssembledFromMultiplePacketsMs),it(z,Ar.Video_Recv_Avg_Inter_Frame_Delay,Q.avgInterFrameDelayMs),it(z,Ar.Video_Recv_Key_Frames_Decoded,Q.keyFramesDecoded);const we=Z&&Z.videoRecv.find(ut=>ut.ssrc===y);if(we){const ut=D.timestamp-Z.timestamp||Rh;Q.packetsLost!=null&&we.packetsLost!=null&&it(z,Ar.Video_Recv_Package_Lost,Q.packetsLost-we.packetsLost),we.bytes!=null&&Q.bytes!=null&&it(z,Ar.Video_Recv_Bitrate,8*(Q.bytes-we.bytes)/ut),we.packets!=null&&Q.packets!=null&&it(z,Ar.Video_Recv_Package_Rate,1e3*(Q.packets-we.packets)/ut)}const Ct=V&&V.videoRecv.find(ut=>ut.ssrc===y);if(Ct&&(it(z,ba.Video_Recv_Qp_Sum,Q.qpSumPerFrame),z[ba.Video_Recv_Freeze]=P&&Qg.isRemoteVideoFreeze(A,Q,Ct)?1:0),G){var bt;const ut=G.videoRecv.find(Ht=>Ht.ssrc===y);ie?(it(z,mt.Video_Recv_Height,ie.height),it(z,mt.Video_Recv_Width,ie.width)):A&&(it(z,mt.Video_Recv_Height,A._videoHeight||0),it(z,mt.Video_Recv_Width,A._videoWidth||0)),fe&&it(z,mt.Video_Recv_Frame_Rate_Output,fe.frameRate);const Yt=(bt=A._player)===null||bt===void 0?void 0:bt.rendFrameRate.toFixed(0);if(Yt&&it(z,mt.Video_Render_Frame_Rate_Render,+Yt),it(z,mt.Video_Recv_Jitter_Buffer,Q.jitterBufferMs),it(z,mt.Video_Recv_Current_Delay,Q.currentDelayMs),it(z,mt.Video_Recv_Firs,Q.firsCount),it(z,mt.Video_Recv_Nacks,Q.nacksCount),it(z,mt.Video_Recv_Plis,Q.plisCount),A){z[mt.Video_Recv_Disabled]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1;const Ht=A._player;if(Ht){const{freezeTimeCounterList:Kr,renderFreezeAccTime:Ee,renderFreezeAccTime2:Ne,videoElementStatus:Ke}=Ht;if(Kr&&Kr.length>0&&it(z,ba.Video_Render_Freeze_Time,Kr.splice(0,1)[0]),j&&Tc.visibility==="visible"&&Ke===Br.PLAYING&&Ft().supportRequestVideoFrameCallback){const Se=Math.min(6e3,Ne);Ht.renderFreezeAccTime2=Math.max(0,Ne-Se),it(z,ba.Video_Render_Freeze_Time_Render2,Se);const b=Math.min(6e3,Ee);Ht.renderFreezeAccTime=Math.max(0,Ee-b),it(z,ba.Video_Render_Freeze_Time_Render,W("USE_NEW_RENDER_FREEZE_TIME")?Se:b)}if(typeof Q.totalFreezesDuration=="number"){const Se=ut&&ut.totalFreezesDuration?Q.totalFreezesDuration-ut.totalFreezesDuration:Q.totalFreezesDuration;it(z,mt.Video_Render_Freeze_Duration,1e3*Se)}}}if(z[mt.Video_Recv_Player_Status]=lb[A._player?A._player.videoElementStatus:"uninit"],ut&&Q.totalInterFrameDelay!==void 0&&Q.totalSquaredInterFrameDelay!==void 0&&ut.totalInterFrameDelay!==void 0&&ut.totalSquaredInterFrameDelay!==void 0){const Ht=Q.totalInterFrameDelay-ut.totalInterFrameDelay,Kr=Q.totalSquaredInterFrameDelay-ut.totalSquaredInterFrameDelay,Ee=Q.framesDecodeCount-ut.framesDecodeCount,Ne=Ht/Ee*1e3,Ke=Math.round(1e3*Math.sqrt((Kr-Math.pow(Ht,2)/Ee)/Ee));!isNaN(Ke)&&Ne+Ke>Math.max(3*Ne,Ne+150)&&(z[mt.Video_Recv_I_Frame_Delay]=Ke)}}return z}(l._videoSSRC,t,l.videoTrack,E===!0,this.needUploadRenderFreezeTime,n,r,i):void 0;v&&(m.video=v)}if(p.has(We.AUDIO)&&l.audioTrack){const E=l.audioTrack?function(v,y,D,A,P,j){const V=y.audioRecv.find(z=>z.ssrc===v);if(!V)return;const G={};it(G,Ar.Audio_Recv_Jitter,V.jitterMs),it(G,Ar.Audio_Recv_Bytes_Retransmit,V.retransmittedBytesReceived),it(G,Ar.Audio_Recv_Packages_Retransmit,V.retransmittedPacketsReceived),it(G,Ar.Audio_Recv_Packages_Discarded,V.packetsDiscarded),it(G,Ar.Audio_Recv_Avg_Processing_Delay,V.avgProcessingDelayMs);const Z=j&&j.audioRecv.find(z=>z.ssrc===v);if(Z){const z=Rh;V.packets!=null&&Z.packets!=null&&it(G,Ar.Audio_Recv_Package_Rate,1e3*(V.packets-Z.packets)/z),V.packetsLost!=null&&Z.packetsLost!=null&&it(G,Ar.Audio_Recv_Package_Lost,V.packetsLost-Z.packetsLost)}if(A){const{receivedFrames:z,droppedFrames:ie}=V;z!=null&&ie!=null&&(G[ba.Audio_Recv_Freeze]=(Q=z)===0||100*ie/Q>20?1:0)}var Q;if(P){const z=100*D._source.getAccurateVolumeLevel(),ie=V.outputLevel;if(ie!=null){const ve=Math.ceil(50*Math.log10(100*ie+1));it(G,mt.Audio_Render_Level,ve)}it(G,mt.Audio_Recv_PCM_Level,z),D&&(G[mt.Audio_Recv_Disabled]=D._originMediaStreamTrack.enabled&&D._mediaStreamTrack.enabled?0:1),it(G,mt.Audio_Recv_Jitter_Buffer,V.jitterBufferMs),it(G,mt.Audio_Recv_Current_Delay,V.jitterBufferMs),G[mt.Audio_Recv_Player_Status]=lb[Oi.getPlayerState(D.getTrackId())];const fe=P.audioRecv.find(ve=>ve.ssrc===v);if(fe){fe.bytes!=null&&V.bytes!=null&&it(G,mt.Audio_Recv_Bitrate,8*(V.bytes-fe.bytes)/(Rh*$g));const ve=V.concealedSamples-fe.concealedSamples;ve>0&&it(G,mt.Audio_Recv_Concealed_Samples,ve);const we=V.totalSamplesReceived-fe.totalSamplesReceived;we>0&&it(G,mt.Audio_Recv_Total_Samples_Received,we);const Ct=V.freezeSamples80-fe.freezeSamples80;Ct>0&&it(G,mt.Audio_Render_Freeze_Samples_80ms,Ct);const bt=V.freezeSamples200-fe.freezeSamples200;bt>0&&it(G,mt.Audio_Render_Freeze_Samples_200ms,bt);const ut=V.freezeMs80-fe.freezeMs80;it(G,mt.Audio_Render_Freeze_Time_80ms,ut<0?0:ut);const Yt=V.freezeMs200-fe.freezeMs200;it(G,mt.Audio_Render_Freeze_Time_200ms,Yt<0?0:Yt)}}return G}(l._audioSSRC,t,l.audioTrack,n,r,i):void 0;E&&(m.audio=E)}(m.video||m.audio)&&o.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof jg);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Bg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(We.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(We.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of s)!p.muted&&p.enabled&&(i=i.concat(await p.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,m]of o)m.has(We.VIDEO)&&p.videoTrack&&(i=i.concat(await p.videoTrack.getProcessorUsage())),m.has(We.AUDIO)&&p.audioTrack&&(i=i.concat(await p.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(p,m){const E={};for(const{id:A,value:P,level:j,direction:V}of p){var v;const G=(v=m.get(A))!==null&&v!==void 0?v:0,Z=P===2?G+W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:G;var y,D;m.set(A,Z),E[A]?(P===2&&(E[A].value=P),j>E[A].level&&(E[A].level=j),V==="remote"&&(E[A].remoteUidCount+=1),E[A].totalTs=(y=m.get(A))!==null&&y!==void 0?y:0):E[A]={value:P,level:j,remoteUidCount:V==="local"?0:1,totalTs:(D=m.get(A))!==null&&D!==void 0?D:0}}return Object.keys(E).map(A=>{const{level:P,value:j,totalTs:V}=E[A];return{id:A,level:P,value:j,totalTs:V}})}(i,t);const c=Date.now(),l=c>n?c:n+1;this.requestUpload&&this.requestUpload(Bg.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:l})},W("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Qz=W("ICE_RESTART_INTERVAL");let vT=new Map,zf=new Map,kd=[Gr.UDP_TCP_RELAY,Gr.TCP_RELAY,Gr.RELAY],aI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration;function m5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=vT.get(e.id);n&&(window.clearTimeout(n),vT.delete(e.id));const r=zf.get(e.id);t&&r&&r.index===kd.length-1&&(w.debug("[".concat(e.id,"] reset ICE restart policy")),zf.delete(e.id))}function _5(e,t,n){if(vT.size===0&&zf.size===0&&(Array.isArray(W("RESTART_SEQUENCE"))&&W("RESTART_SEQUENCE").length>0&&!function(c,l){if(c.length!==l.length)return!1;for(let p=0;p<c.length;p+=1){const m=c[p];if(c.filter(E=>E===m).length!==l.filter(E=>E===m).length)return!1}return!0}(kd,W("RESTART_SEQUENCE"))&&(kd=W("RESTART_SEQUENCE").filter(c=>{var l;if(Ae(l=Object.values(Gr)).call(l,c))return!0}),w.debug("use reconnection policy from config distribution, queues: ".concat(kd.join(" => ")))),aI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ft().supportPCSetConfiguration),kd.length===0)return void n();let r,{index:i=0,type:s}=zf.get(e.id)||{};if(aI&&s===Gr.RELAY)return void n();let o=s&&i>=kd.length-1;if(aI)s=Gr.RELAY;else{if(o)return void n();s?(i++,s=kd[i]):(s=kd[0],i=0)}w.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),t(s),zf.set(e.id,{index:i,type:s}),r=window.setTimeout(()=>_5(e,t,n),Qz),vT.set(e.id,r)}var At;function g5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Rc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function E5(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=TR,r=Symbol.iterator);i--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new ST(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function ST(e){function t(n){if(Object(n)!==n)return je.reject(new TypeError(n+" is not an object."));var r=n.done;return je.resolve(n.value).then(function(i){return{value:i,done:r}})}return ST=function(n){this.s=n,this.n=n.next},ST.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?je.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?je.reject(n):t(r.apply(this.s,arguments))}},new ST(e)}let Zg=(At=class extends bn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(tt.StateChange,t,this._state)}constructor(e,t){super(),M(this,"isPlanB",void 0),M(this,"store",void 0),M(this,"statsUploader",void 0),M(this,"connection",void 0),M(this,"localTrackMap",new Map),M(this,"remoteUserMap",new Map),M(this,"localDataChannels",[]),M(this,"remoteDataChannelMap",new Map),M(this,"pendingLocalTracks",[]),M(this,"pendingRemoteTracks",[]),M(this,"pendingLocalDataChannels",[]),M(this,"pendingRemoteDataChannels",[]),M(this,"statsCollector",void 0),M(this,"shouldForwardP2PCreation",void 0),M(this,"iceFailedCount",0),M(this,"dtlsFailedCount",0),M(this,"mutex",void 0),M(this,"_state",Jt.Disconnected),M(this,"_pcStatsUploadType",W("NEW_ICE_RESTART")?fl.FIRST_CONNECTION:fl.OLD_FIRST_CONNECTION),M(this,"_isStartRestartIce",!1),M(this,"_restartTimer",void 0),M(this,"_isTryConnecting",!1),M(this,"_iceError",null),M(this,"_forceTurn",!1),M(this,"_isWaitPcToRePub",!1),M(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void r();const c=o.find(p=>p[0]==="videoLowTrack");if(c){const p=c[1];this.store.enableInstantMuteRestore?(p.track._originMediaStreamTrack.enabled=!1,w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):p.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const l=this.createMuteMessage(o);await sn(this,tt.RequestMuteLocal,l),r()}catch(o){i(o)}finally{s()}}),M(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();const c=o.find(p=>p[0]==="videoLowTrack");if(c){const p=c[1];if(this.store.enableInstantMuteRestore)p.track._originMediaStreamTrack.enabled=!0,w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(p.track._originMediaStreamTrack.stop(),!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}else{const m=oI(n,kg(this,tt.RequestLowStreamParameter));p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}await new je((m,E)=>{this.handleReplaceTrack(p.track,m,E,!0)})}}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const l=this.createUnmuteMessage(o);await sn(this,tt.RequestUnmuteLocal,l),r()}catch(o){i(o)}finally{s()}}),M(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let o;s||(o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!l||l.track!==n||this.state!==Jt.Connected)return void r();const{id:p,track:m}=l;await this.connection.updateSendParameters(p,m),await this.connection.updateEncoderConfig(p,m),this.emit(tt.UpdateVideoEncoder,m),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}}),M(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Jt.Connected)return void r();const{id:c,track:l}=o;await this.connection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}}),M(this,"handleReplaceMixingTrack",async(n,r,i,s)=>{if(!this.connection||this.state!==Jt.Connected)return void r();const o=iI([n]);let c;w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),r()}catch(p){i(p)}finally{var l;(l=c)===null||l===void 0||l()}}),M(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;w.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.connection||!p||this.state!==Jt.Connected)return void r();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),this.isPlanB){const m=p[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],m)}if(p[0]===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const m=this.localTrackMap.get(Te.LocalVideoLowTrack);if(m){const E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new je((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}r()}catch(p){i(p)}finally{var l;(l=o)===null||l===void 0||l()}}),M(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),M(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),M(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),M(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),M(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new f5(this.store),this.bindStatsUploaderEvents(),this.mutex=new Fr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ft().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dl(),this.shouldForwardP2PCreation=W("FORWARD_P2P_CREATION")&&Ft().supportPCSetConfiguration&&MR(),this.shouldForwardP2PCreation&&(this.connection=_T(this.store),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Jt.New,this._forceTurn=l5(e),w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=_T(this.store,e),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=W("NEW_ICE_RESTART")?fl.FIRST_CONNECTION:fl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Jt.Connected){if(this.connection instanceof no&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Xe.reportApiInvoke(this.store.sessionId,{name:xn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Tn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(tt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[o]=i;return Ae(s=[Te.LocalVideoLowTrack,Te.LocalVideoTrack]).call(s,o)}),n=t.map(i=>{let[,{id:s}]=i;return s}),r=t.map(i=>{let[s]=i;return s});if(this.connection instanceof no){if(Xe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ae(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>Ae(e).call(e,s));i&&(this.store.codec=i,w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof no&&this.connection.peerConnectionState!=="closed"&&Ae(e=[Jt.New,Jt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Jt.Connected){if(this.state===Jt.Disconnected)throw new pe(F.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;Ae(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var r=this;return Js(function*(){const i=yield jt(r.mutex.lock("From P2PChannel.publish"));try{var s;const o=r.connection&&Ae(s=["disconnected","failed"]).call(s,r.connection.peerConnectionState);if(!r.connection||r.state!==Jt.Connected||o){if(r.state===Jt.Disconnected)throw new pe(F.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const l=e.filter(p=>r.pendingLocalTracks.indexOf(p)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(l),void(o&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Hr.markPublishStart(r.store.clientId,r.store.pubId);const c=r.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));yield*hy(E5(r.doPublish(r.connection,c)))}finally{i()}})()}doPublish(e,t){var n=this;return Js(function*(){t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===Te.LocalAudioTrack?"audio":"video",A)}),n.bindLocalTrackEvents(t);const r=t.map(v=>{let{track:y}=v;return y}),i=yield jt(e.send(r,n.store.codec,n.store.audioCodec)),s=(yield jt(i.next())).value,o=n.createGatewayPublishMessage(t,s);let c;try{c=yield o}catch(v){throw i.throw(v),v?.code===F.WS_ABORT&&t.forEach(y=>{let{track:D}=y;n.pendingLocalTracks.indexOf(D)===-1&&n.pendingLocalTracks.push(D)}),n.unbindLocalTrackEvents(t),v}const l=n.mapPubResToRemoteConfig(o,c,r),p=(yield jt(i.next(l))).value;if(n.state===Jt.Disconnected)throw new pe(F.UNEXPECTED_ERROR,"PeerConnection already disconnected.");W("ENABLE_VIDEO_SEI");const m=W("ENABLE_ENCODED_TRANSFORM"),E=W("ENABLE_AUDIO_METADATA");r.forEach(async v=>{const y=v.getRTCRtpTransceiver();if(!y||!m)return;const{interceptLocalVideoFrame:D,interceptLocalAudioFrame:A}=aT();v.trackMediaType===We.VIDEO?await D(y.sender,v):v.trackMediaType===We.AUDIO&&await A(y.sender,{metadata:E?()=>{const P=v.metadata.shift();return P&&P.value}:void 0})}),t.forEach(v=>{let{type:y}=v;n.statsCollector.addLocalStats(y)}),n.assignLocalTracks(t,p),n.statsUploader.startUploadOutboundStats(),t.forEach(v=>{let{track:y,type:D}=v;const A=Date.now();n.store.publish(y.getTrackId(),D===Te.LocalAudioTrack?"audio":"video",void 0,A)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof mn))return w.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(s,o){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=Fb(s,o)),c.maxFramerate=s.framerate?as(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Te.LocalVideoLowTrack||!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return w.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,c){const l=o.canvas;c.width&&(l.width=as(c.width)),c.height&&(l.height=as(c.height)),c.framerate&&(l.stopCapture&&l.stopCapture(),l.stopCapture=ub(()=>{!l.startCapture&&l.stopCapture&&l.stopCapture(),l.startCapture&&l.startCapture()},as(c.framerate)))})(s,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),w.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return Js(function*(){if(!t.connection||t.state!==Jt.Connected)return;const n=yield jt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(Te.LocalVideoTrack);if(!i)throw new pe(F.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Te.LocalVideoLowTrack))throw new pe(F.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:t.getLowVideoTrack(i.track,e),type:Te.LocalVideoLowTrack}];if(yield*hy(E5(t.doPublish(t.connection,s))),i.track.muted||!i.track.enabled){var r;const o=(r=t.localTrackMap.get(Te.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield jt(t.connection.muteLocal([o])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Dr(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(w.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Dr(this,tt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==We.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==We.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Dr(this,tt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===We.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(tt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Jt.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Jt.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Jt.Connected)return;const e=this.localTrackMap.get(Te.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Te.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:s}]=r;return{type:i,track:s}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Jt.Connected)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:c,id:l}=o;return c.uid===e.uid&&l===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,i){var s;if(!this.connection||this.state!==Jt.Connected)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;let o,c,l,p;const m=this.connection.getPreMedia(n);if(m)w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),l=m.transceiver,o=m.track,c=m.mid,p=m.player,m.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:m.firstVideoRender});else if(i){const y=i.find(A=>{let{stream_type:P}=A;return P===t});if(!y)throw new pe(F.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const D=await this.connection.receive(t,y.ssrcs,String(e._uintid),y.attributes);this.connection instanceof no&&(l=D.transceiver),o=D.track,c=D.id}else{const y=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof no&&(l=y.transceiver),o=y.track,c=y.id}if(t===We.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new Df(o,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new kf(o,e.uid,e._uintid,this.store,p),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Zs.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Zs.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),p?e._videoTrack.once(Zs.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Zs.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack)),l&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:y,interceptRemoteAudioFrame:D}=aT();t==We.VIDEO?await y(l.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(A=>{var P;return(P=e._videoTrack)===null||P===void 0?void 0:P._onSei(A)})}):t==We.AUDIO&&await D(l.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:A=>{this.safeEmit(tt.AudioMetadata,A)},onPts:A=>{this.safeEmit(tt.AudioPts,A)}})}const E=this.remoteUserMap.get(e);E?E.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const v=this.pendingRemoteTracks.findIndex(y=>{let{user:D,kind:A}=y;return D.uid===e.uid&&t===A});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(tt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Jt.Connected)throw new pe(F.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var s;let{user:o,mediaType:c}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))});const t=[],n=new Map;e.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);if(s){const{track:o,mid:c,transceiver:l,player:p}=s;n.set(i.ssrcId,{track:o,id:c,transceiver:l,player:p})}else t.push(i)});const r=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:l}=i;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:l}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{n.set(i.ssrcId,r[s])});for(const{user:i,mediaType:s,ssrcId:o}of e){const c=n.get(o);if(!c)return void w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(o));const{track:l,id:p,transceiver:m,player:E}=c;if(m&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:A}=aT();s==We.VIDEO?await D(m.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(P=>{var j;return(j=i._videoTrack)===null||j===void 0?void 0:j._onSei(P)})}):s==We.AUDIO&&await A(m.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:P=>{this.safeEmit(tt.AudioMetadata,P)},onPts:P=>{this.safeEmit(tt.AudioPts,P)}})}if(s===We.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(l):(i._audioTrack=new Df(l,i.uid,i._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),m&&i._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(l):(i._videoTrack=new kf(l,i.uid,i._uintid,this.store,E),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),m&&i._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(i,i._videoTrack)),W("ENABLE_VIDEO_SEI")&&m){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:A}=aT();s==We.VIDEO?await D(m.receiver,{onSei:P=>{var j;(j=i._videoTrack)===null||j===void 0||j._onSei(P)}}):s==We.AUDIO&&await A(m.receiver)}const v=this.remoteUserMap.get(i);v?v.set(s,p):this.remoteUserMap.set(i,new Map([[s,p]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const y=this.pendingRemoteTracks.findIndex(D=>{let{user:A,kind:P}=D;return A.uid===i.uid&&s===P});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(tt.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:l}=o;return t!==void 0?c.uid===e.uid&&t===l:c.uid===e.uid});if(r.forEach(o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.connection&&this.state===Jt.Connected||n||r.forEach(o=>{let{kind:c}=o;var l;if(c===We.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(c===We.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Jt.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(o=>{let[,{id:c}]=o;return c}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[c,{kind:l}]=o;var p,m;if(l===We.VIDEO&&c._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===We.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((m=c._videoTrack)===null||m===void 0||m._destroy(),c._videoTrack=void 0);else if(l===We.AUDIO){var E;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((E=c._audioTrack)===null||E===void 0||E._destroy(),c._audioTrack=void 0)}}),s}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(o=>o.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:s}of e){const o=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:p}=c;return s!==void 0?l.uid===i.uid&&s===p:l.uid===i.uid});o.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),t=t.concat(o)}if(!this.connection||this.state!==Jt.Connected)return void t.forEach(i=>{let{user:s,kind:o}=i;var c;if(o===We.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===We.VIDEO){var l;(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0}});const n=Ui(e).call(e,(i,s)=>{let{user:o,mediaType:c}=s;const l=this.filterTobeUnSubscribedTracks(o,c);return i.concat(l)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:s}]=i;return s}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[s,{kind:o}]=i;var c,l;if(o===We.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===We.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(l=s._videoTrack)===null||l===void 0||l._destroy(),s._videoTrack=void 0;else if(o===We.AUDIO){var p;this.unbindRemoteTrackEvents(s._audioTrack),(p=s._audioTrack)===null||p===void 0||p._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==Jt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===We.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Te.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t?.track instanceof Zn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Te.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Te.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Te.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Te.LocalAudioTrack),c=r?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);Xe.publish(this.store.sessionId,{eventElapse:Hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(l=>l instanceof Ln),c=r?(s=this.localTrackMap.get(Te.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof mn);Xe.publish(this.store.sessionId,{eventElapse:Hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===We.VIDEO?n._videoSSRC:n._audioSSRC;i&&Xe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===We.VIDEO,audio:r===We.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Hr.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Fr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=_T(this.store),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e?.track instanceof Zn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Jt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof mn||t&&t.track instanceof Ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=rh(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=_T(this.store),this.emit(tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Te.LocalVideoTrack:Ae(t=r._hints).call(t,rn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Te.LocalAudioTrack:r instanceof Zn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Te.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(tt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Js(function*(){if(!t.connection||t.state!==Jt.Connected)return;const n=yield jt(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield jt(t.connection.restartICE(e));const s=yield jt(r.next());if(s.done)return;const o=s.value,c=yield o;switch(sI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Gr.UDP_TCP_RELAY:t._pcStatsUploadType=fl.UDP_TCP_RESTART;break;case Gr.TCP_RELAY:t._pcStatsUploadType=fl.TCP_RESTART;break;case Gr.RELAY:t._pcStatsUploadType=fl.RELAY_RESTART;break;default:t._pcStatsUploadType=fl.OLD_RESTART}t._isTryConnecting=!0,r.next(c)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalAudioTrack),r=e.videoSend.find(y=>y.ssrc===t?.ssrcs[0].ssrcId),i=e.audioSend.find(y=>y.ssrc===n?.ssrcs[0].ssrcId);if(!r||!i)return 1;const s=Ts(this,tt.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,p=(l&&s?(l+s)/2:l||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t?.track;if(v&&v._encoderConfig&&v._hints.indexOf(rn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return iU[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===i),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const l=Ts(this,tt.NeedSignalRTT),p=e.rtt,m=(p&&l?(p+l)/2:p||l)||0,E=o?o.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;E&&(y=.6*v*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new je((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(w.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Jt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return e===o});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===Te.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding){const s=this.localTrackMap.get(Te.LocalVideoLowTrack);if(s){const o=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new je((c,l)=>{this.handleReplaceTrack(s.track,c,l,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=vf(e=e.filter(l=>i.indexOf(l)===-1));let s,o=!1;const c=this.localTrackMap.get(Te.LocalAudioTrack);for(const l of e){if(l instanceof mn&&(this.localTrackMap.has(Te.LocalVideoTrack)||o?new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Te.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(l,n);r.push({track:p,type:Te.LocalVideoLowTrack})}if(l instanceof Ln)if(c){const p=c.track;if(p instanceof Zn)rI([l]),p.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0);else{const m=iI([p,l]);w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(p,m)}}else s instanceof Zn?(rI([l]),s.addAudioTrack(l)):s||!l._useAudioElement&&Ft().webAudioMediaStreamDest&&!l._bypassWebAudio?s=iI(s?[l,s]:[l]):s=l}return s&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:Te.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=vf(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Ln){const i=this.localTrackMap.get(Te.LocalAudioTrack);if(!i)continue;i.track instanceof Zn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,i]),i.track.close())):t.push([Te.LocalAudioTrack,i])}if(r instanceof mn){const i=this.localTrackMap.get(Te.LocalVideoTrack);if(!i)continue;t.push([Te.LocalVideoTrack,i]);const s=this.localTrackMap.get(Te.LocalVideoLowTrack);s&&t.push([Te.LocalVideoLowTrack,s])}}return t}filterTobePublishedDataChannels(e){return e=(e=vf(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=vf(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.addListener(ze.GET_STATS,this.handleGetLocalVideoStats),n.addListener(ze.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ze.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(ze.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Zn?e.trackList.forEach(n=>{n.addListener(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ze.GET_STATS,this.handleGetLocalAudioStats),n.addListener(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ze.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(ze.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.off(ze.GET_STATS,this.handleGetLocalVideoStats),n.off(ze.GET_RTC_STATS,this.handleGetRTCStats),n.off(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ze.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(ze.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Zn?e.trackList.forEach(t=>{t.off(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ze.GET_STATS,this.handleGetLocalAudioStats),t.off(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ze.GET_STATS,this.handleGetLocalAudioStats),e.off(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ze.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof kf&&t.addListener(ze.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Df&&t.addListener(ze.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ze.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(We.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(We.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,o,{track:c,type:l}=n;switch(l){case Te.LocalAudioTrack:s=Qt.Audio,o={dtx:c instanceof jg&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Te.LocalVideoTrack:s=Ae(i=c._hints).call(i,rn.SCREEN_TRACK)?Qt.Screen:Qt.High,o=Rc(Rc({},SU(c)),{},{codec:this.store.codec,svc_mode:nT()});break;case Te.LocalVideoLowTrack:s=Qt.Low,o=Rc(Rc({},SU(c)),{},{codec:this.store.codec,svc_mode:nT()})}return{stream_type:s,attributes:o,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(tt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof no&&!Nn()&&W("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},W("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof no&&m5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=fl.DISCONNECTED_OR_FAILED,Ts(this,tt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));Xe.reportApiInvoke(this.store.sessionId,{name:xn.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:Tn.TRACER}).onSuccess(),this.republish()}if(W("NEW_ICE_RESTART")&&e instanceof no&&!Nn()&&!this._forceTurn){if(Ae(fU).call(fU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=i=>{sI(e)&&(w.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Ts(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE,i))},r=()=>{sI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),w.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{_5(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&W("ICE_RESTART")&&Ts(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Xe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Zs.FIRST_FRAME_DECODED),Xe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Xe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===t);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoRender=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r))},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),Xe.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(tt.ConnectionTypeChange,r),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Rc(Rc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof no&&function(t){zf.delete(t.id),m5(t)}(e),e.close(),this.emit(tt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof Zn)return n.track.isActive||t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===Te.LocalVideoTrack)){const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof Zn)return n.track.isActive&&t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===Te.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case We.VIDEO:return void(r._videoSSRC&&t.push({stream_type:We.VIDEO,ssrcId:r._videoSSRC}));case We.AUDIO:return void(r._audioSSRC&&t.push({stream_type:We.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:i}]=n;if(t.has(r)){let s=t.get(r);i===We.VIDEO?s|=ur.Video:s|=ur.Audio,t.set(r,s)}else i===We.VIDEO?t.set(r,ur.Video):t.set(r,ur.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new je((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new je((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof no&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof no&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map((r,i)=>{var s;let{stream_type:o}=r;const c=(s=t.find(l=>{let{stream_type:p}=l;return o===p}))===null||s===void 0?void 0:s.attributes;if(c&&W("DISABLE_SCREEN_SHARE_REMB")){const l=n[i]._hints;(Ae(l).call(l,rn.SCREEN_TRACK)||Ae(l).call(l,rn.SCREEN_LOW_TRACK))&&(c.remb=!1,w.debug("disable remb for screen share, hints:",l))}return c})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Ln){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(s=>{let[,{id:o}]=s;return o})));const i=this.createUnmuteMessage(r);return void await sn(this,tt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(tt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rr(HR(this.dtlsFailedCount,qn)),this.emit(tt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Dr(this,tt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(tt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof mn).length>1)throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ln).length>1&&(e.some(t=>t instanceof Ln&&t._bypassWebAudio)||!Ft().webAudioMediaStreamDest))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof mn&&this.pendingLocalTracks.some(n=>n instanceof mn))throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ln&&this.pendingLocalTracks.some(n=>n instanceof Ln)&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ln&&n._bypassWebAudio)))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,i=Rc(Rc({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=r?e._mediaStreamTrack.clone():oI(e,i);const o=on(8,"track-low-"),c=new mn(s,Rc(Rc({},r&&{scaleResolutionDownBy:Fb(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(_h.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,bf.LOW_STREAM)}),c._hints.push(rn.LOW_STREAM),Ae(n=e._hints).call(n,rn.SCREEN_TRACK)&&c._hints.push(rn.SCREEN_LOW_TRACK),e.on("sei-to-send",l=>{c.emit("sei-to-send",l)}),e.addListener(ze.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof no){var i,s,o,c;const l=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:m,peerConnectionState:E}=this.connection,{local:v,remote:y}=await this.connection.getSelectedCandidatePair();Xe.pcStats(this.store.sessionId,{startTime:l,eventElapse:e-l||0,iceconnectionsate:p,dtlsstate:m,connectionstate:E,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=v?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=v.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(v.address,":").concat(v.port),selectedRemoteCandidateProtocol:(o=y.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=y.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(m=>m.userId===e.uid);if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:s,firstPreRender:o,peerPublishDuration:c,peerPubStatusMs:l}=n;let{firstRender:p=0}=n;if(s&&(p||o)&&c&&l){n.isInternalUpload=!0;const{playEnd:m}=n;m&&(n.isExternalUpload=!0);const{firstPreRender:E=0}=n;p=E||p;const v=e.videoTrack,y={peer:e._uintid,width:v?._videoWidth||0,height:v?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:l,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:E||0,firstRender:m?Math.max(p,m):Math.max(p,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:HL(this.store)};Xe.firstXLAPeerFirstVideoFrame(this.store.sessionId,y)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(l=>l.userId===s.uid&&l.type==="video");Xe.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Te.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,bf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},qe(At.prototype,"startP2PConnection",[si],Object.getOwnPropertyDescriptor(At.prototype,"startP2PConnection"),At.prototype),qe(At.prototype,"connect",[si],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),qe(At.prototype,"updateRemoteRTPCapabilities",[si],Object.getOwnPropertyDescriptor(At.prototype,"updateRemoteRTPCapabilities"),At.prototype),qe(At.prototype,"publishDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"publishDataChannel"),At.prototype),qe(At.prototype,"unpublish",[si],Object.getOwnPropertyDescriptor(At.prototype,"unpublish"),At.prototype),qe(At.prototype,"unpublishDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"unpublishDataChannel"),At.prototype),qe(At.prototype,"unpublishLowStream",[si],Object.getOwnPropertyDescriptor(At.prototype,"unpublishLowStream"),At.prototype),qe(At.prototype,"subscribeDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"subscribeDataChannel"),At.prototype),qe(At.prototype,"subscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"subscribe"),At.prototype),qe(At.prototype,"massSubscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"massSubscribe"),At.prototype),qe(At.prototype,"unsubscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribe"),At.prototype),qe(At.prototype,"unsubscribeDataChannel",[si],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribeDataChannel"),At.prototype),qe(At.prototype,"massUnsubscribe",[si],Object.getOwnPropertyDescriptor(At.prototype,"massUnsubscribe"),At.prototype),qe(At.prototype,"muteRemote",[si],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),qe(At.prototype,"unmuteRemote",[si],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),qe(At.prototype,"hasRemoteMediaWithLock",[si],Object.getOwnPropertyDescriptor(At.prototype,"hasRemoteMediaWithLock"),At.prototype),qe(At.prototype,"disconnectForReconnect",[si],Object.getOwnPropertyDescriptor(At.prototype,"disconnectForReconnect"),At.prototype),qe(At.prototype,"updateBitrateLimit",[si],Object.getOwnPropertyDescriptor(At.prototype,"updateBitrateLimit"),At.prototype),qe(At.prototype,"remoteMediaSsrcChanged",[si],Object.getOwnPropertyDescriptor(At.prototype,"remoteMediaSsrcChanged"),At.prototype),At);function si(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}function v5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function S5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const $z=Date.now(),Zz=20,cI=new Map,yT=new Map;async function y5(e){const t=cI.get(e),n=Array.isArray(t)&&t[t.length-1],r=yT.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let c=n.mediaDelay+o;c<=0?(t.pop(),T5(n.context,i),c=0):c=Math.min(c,Zz),setTimeout(()=>t.length&&y5(e),c)}function T5(e,t){e.safeEmit(Nt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function eY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return T5(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=cI.get(r)||[],s=i.findIndex(p=>e.sendTs>=p.sendTs),o=S5(S5({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),cI.set(r,i);let c=!1;var l;yT.has(r)?c=!((l=yT.get(r))===null||l===void 0||!l.isSyncing):yT.set(r,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||y5(r)}const tY=xt().name;function C5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function w5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?C5(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C5(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Yf="websdk_ng_cache_parameter",nY=W("MAX_PRELOAD_ASYNC_LENGTH"),rY=1e4,bh=new Map,Ih=[];let lI=null,dI=0,uI=0;const TT=new Map,iY=function(e,t){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<t?i():r--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new je(async(l,p)=>{n.push(async()=>{try{const m=await e(...o);l(m)}catch(m){p(m)}}),r<t&&(r++,i())})}}(R5,nY),hI=Ai.CancelToken.source();async function R5(e,t,n,r,i,s){try{if(!W("ENABLE_PRELOAD"))return;if(!Ft().supportWebCrypto)return void vd(()=>{w.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new pe(F.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&wr(n,"token",1,2047),wr(e,"appid",1,2047),Jy(t),r&&Qy(r);const o=fh();w.debug("preload channel ".concat(t,", uid is ").concat(r));const c={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:o,proxyServer:i};let l,p;typeof r=="string"?(c.stringUid=r,[p,l]=await je.all([Bz(r,{sid:o,appId:e},hI.token),QU(w5(w5({},c),{},{token:n||e,uid:0}),hI.token)]),c.uid=p.uid,l.gatewayInfo.uid=c.uid,l.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),l=await QU(c,hI.token));const m={sid:o,appId:e,cname:t,token:n||e,uid:c.stringUid||r,intUid:c.uid||l.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:p,ap:l};await async function(E){let v;try{E.uid&&I5({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});const y=P5(E),D=await async function(P,j){try{const V=await window.crypto.subtle.importKey("raw",gL(j),"AES-GCM",!1,["encrypt"]),G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},V,ph(window.btoa(JSON.stringify(P))));return Sd(new Uint8Array(G))}catch{return}}(E,E.token||E.appId);if(!D)return;v=N5(Yf);const A=v?JSON.parse(v):[];A.push({[y]:D}),A.length>W("AP_CACHE_NUM")&&A.shift(),CT(Yf,JSON.stringify(A))}catch(y){w.warn("Error caching server parameters:",y.message),CT(Yf,"")}}(m),dI++}catch(o){throw uI++,function(c){lI||(lI=window.setTimeout(()=>{let p="";TT.forEach((m,E)=>{p+="".concat(E,": ").concat(m," ;")}),Xe.reportApiInvoke(null,{name:xn.PRELOAD,options:{success:dI,failed:uI,err:p}}).onError(c),dI=0,uI=0,TT.clear(),lI=null},rY));const l=TT.get(c.code)||0;TT.set(c.code,l+1)}(o),o}}async function b5(e){try{if(W("AP_REQUEST_DETAIL")||W("ENABLE_ROLE_SELECT_EDGE"))return;const t=I5(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",gL(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,ph(r));return JSON.parse(window.atob(Sd(new Uint8Array(o))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<W("AP_CACHE_LIFETIME"))return n}catch(t){w.warn("Error get preloadInfo",t.message)}}function I5(e){let t;try{if(t=N5(Yf),!t)return;const n=JSON.parse(t),r=P5(e),i=function(o,c){for(let l=o.length-1;l>=0;l--)if(c(o[l]))return l;return-1}(n,o=>r in o);if(i===-1)return;const s=n.splice(i,1)[0];return CT(Yf,JSON.stringify(n)),s[r]}catch(n){w.warn("Error delete preload info: ".concat(t),n.message),CT(Yf,"")}}function pI(e){if(e){let t=bh.get(e);t&&(window.clearTimeout(t),t=null,bh.delete(e)),Ae(Ih).call(Ih,e)||e.cloudProxyServer!=="disabled"||Ih.push(e)}if(bh.size<W("AP_CACHE_NUM")&&Ih.length>0){const t=Ih.shift();bh.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:o,proxyServer:c}=t;try{await iY(n,r,i,o,c,s),bh.has(t)&&pI(t)}catch(l){w.warn("update preload failed",l.message),A5(t)}},W("AP_UPDATE_INTERVAL")))}}function A5(e){const t=Ih.indexOf(e);t!==-1&&Ih.splice(t,1);let n=bh.get(e);n&&(window.clearTimeout(n),n=null,bh.delete(e),pI())}function O5(e,t){const n=e.sua,r=e.ap;t&&n&&Xe.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Xe.reportResourceTiming(e.ap.url,e.sid),Xe.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[Hn.CHOOSE_SERVER,Hn.CLOUD_PROXY_FALLBACK].toString()}),Xe.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Hn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function N5(e){return window.atob(window.localStorage.getItem(e)||"")}function CT(e,t){window.localStorage.setItem(e,window.btoa(t))}function P5(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),wL(t)}function sY(e){let t=function(){const n=cY.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(Kn(r,10),Dd(r,i));let s=n.cid;s!==void 0&&(Kn(r,16),Kn(r,s));let o=n.cname;o!==void 0&&(Kn(r,26),Dd(r,o));let c=n.deviceId;c!==void 0&&(Kn(r,34),Dd(r,c));let l=n.elapse;l!==void 0&&(Kn(r,40),Ld(r,l));let p=n.fileSize;p!==void 0&&(Kn(r,48),Ld(r,qf(p)));let m=n.height;m!==void 0&&(Kn(r,56),Ld(r,qf(m)));let E=n.jpg;E!==void 0&&(Kn(r,66),Kn(r,E.length),D5(r,E));let v=n.networkType;v!==void 0&&(Kn(r,72),Ld(r,qf(v)));let y=n.osType;y!==void 0&&(Kn(r,80),Ld(r,qf(y)));let D=n.requestId;D!==void 0&&(Kn(r,90),Dd(r,D));let A=n.sdkVersion;A!==void 0&&(Kn(r,98),Dd(r,A));let P=n.sequence;P!==void 0&&(Kn(r,104),Ld(r,qf(P)));let j=n.sid;j!==void 0&&(Kn(r,114),Dd(r,j));let V=n.timestamp;V!==void 0&&(Kn(r,120),Ld(r,V));let G=n.uid;G!==void 0&&(Kn(r,128),Kn(r,G));let Z=n.vid;Z!==void 0&&(Kn(r,136),Kn(r,Z));let Q=n.width;Q!==void 0&&(Kn(r,144),Ld(r,qf(Q)));let z=n.service;z!==void 0&&(Kn(r,152),Kn(r,z));let ie=n.callbackData;ie!==void 0&&(Kn(r,162),Kn(r,ie.length),D5(r,ie));let fe=n.ticket;fe!==void 0&&(Kn(r,170),Dd(r,fe));let ve=n.vendorConfigs;ve!==void 0&&(Kn(r,178),Dd(r,ve))}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function oY(e){return function(n){let r={};e:for(;!lY(n);){let i=eE(n);switch(i>>>3){case 0:break e;case 1:r.code=eE(n);break;case 2:r.msg=L5(n,eE(n));break;case 3:r.requestId=L5(n,eE(n));break;case 4:r.timestamp=dY(n,!1);break;default:aY(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function aY(e,t){switch(t){case 0:for(;128&Go(e););break;case 2:fI(e,eE(e));break;case 5:fI(e,4);break;case 1:fI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function qf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let cY=[];function fI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function lY(e){return e.offset>=e.limit}function wT(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function k5(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function D5(e,t){let n=wT(e,t.length);e.bytes.set(t,n)}function L5(e,t){let n=k5(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,p,m,E,v=i[c+n];(128&v)==0?o+=r(v):(224&v)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&v)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&v)==224?c+2>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],(49344&(l|p<<8))!=32896?o+=s:(E=(15&v)<<12|(63&l)<<6|63&p,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&v)==240?c+3>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],m=i[c+n+3],(12632256&(l|p<<8|m<<16))!=8421504?o+=s:(E=(7&v)<<18|(63&l)<<12|(63&p)<<6|63&m,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function Dd(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}Kn(e,r);let i=wT(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function Go(e){return e.bytes[k5(e,1)]}function x5(e,t){let n=wT(e,1);e.bytes[n]=t}function eE(e){let t,n=0,r=0;do t=Go(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Kn(e,t){for(t>>>=0;t>=128;)x5(e,127&t|128),t>>>=7;x5(e,t)}function dY(e,t){let n,r=0,i=0,s=0;return n=Go(e),r=127&n,128&n&&(n=Go(e),r|=(127&n)<<7,128&n&&(n=Go(e),r|=(127&n)<<14,128&n&&(n=Go(e),r|=(127&n)<<21,128&n&&(n=Go(e),i=127&n,128&n&&(n=Go(e),i|=(127&n)<<7,128&n&&(n=Go(e),i|=(127&n)<<14,128&n&&(n=Go(e),i|=(127&n)<<21,128&n&&(n=Go(e),s=127&n,128&n&&(n=Go(e),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:t}}function Ld(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=wT(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}const M5={},U5={},RT=4294967296,uY=RT*RT,V5=uY/2;F5(0,!0);const j5=F5(0),hY=tE(0,-2147483648,!1),pY=tE(-1,2147483647,!1);function F5(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=U5[e],r)?r:(n=tE(e,0,!0),i&&(U5[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=M5[e],r)?r:(n=tE(e,e<0?-1:0,!1),i&&(M5[e]=n),n)}function tE(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function B5(e,t){if(isNaN(e))return j5;{if(e<=-V5)return hY;if(e+1>=V5)return pY}return e<0?j5:tE(e%RT|0,e/RT|0,t)}function W5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}class mI extends bn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Ca.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),M(this,"name","AgoraRTCImageModeration"),M(this,"_connectionState",to.CONNECTING),M(this,"_sequence",0),M(this,"_moderationStartTime",void 0),M(this,"_workerConnection",void 0),M(this,"_workerMessageLengthLimit",void 0),M(this,"_qualityRatio",void 0),M(this,"_connectInfo",void 0),M(this,"_cancelTokenSource",Ai.CancelToken.source()),M(this,"_retryConfig",void 0),M(this,"_moderationInterval",void 0),M(this,"_moderationTimer",null),M(this,"_moderationMode",1),M(this,"_quality",1),M(this,"_qualityTimer",null),M(this,"_ticket",void 0),M(this,"_moderationIntervalMinimum",void 0),M(this,"_uploadFailedNum",0),M(this,"_uploadNum",0),M(this,"_uploadTimer",null),M(this,"_extraInfo",void 0),M(this,"_vendor",""),M(this,"_encoder",new TextEncoder),M(this,"_moderationId",void 0),M(this,"inspectImage",()=>{if(this.connectionState!==to.CONNECTED)throw new ae(F.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===to.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=on(5,"image-moderation-"),this._workerMessageLengthLimit=W("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=W("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=W("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Hg("worker-"+this._moderationId,qn),this.on(Ca.STATE_CHANGE,(r,i)=>{w.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Uf[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Ca.STATE_CHANGE,Uf.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new je((i,s)=>{this.on(Ca.CONNECTION_STATE_CHANGE,(o,c)=>{o===to.CONNECTED&&i()}),this.requestAP(t,r,n).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),w.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===to.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const i=W("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,p,m,E){let{appId:v,areaCode:y,cname:D,sid:A,token:P,uid:j}=p;Gf++;const V="moderation_plugin",G={service_name:V,json_body:JSON.stringify({appId:v,areaCode:y,cname:D,command:"allocateEdge",requestId:Gf,seq:Gf,sid:A,appToken:P,ts:Date.now(),uid:j+""})};let Z,Q,z=l[0];return va(async()=>{Z=Date.now();const ie=await wa(z,{data:G,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Q=Date.now()-Z,ie.code!==0){const we=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ie.code,{retry:!0,responseTime:Q});throw w.error(we.toString()),we}const fe=JSON.parse(ie.json_body);if(fe.code!==200){const we=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(fe.code,", reason: ").concat(fe.reason),{code:fe.code,responseTime:Q});throw w.error(we.toString()),we}if(!fe.servers||!Array.isArray(fe.servers)||fe.servers.length===0){const we=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:fe.code,responseTime:Q});throw w.error(we.toString()),we}if(!fe.servers.some(we=>!!we.wss)){const we=new ae(F.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:fe.code,responseTime:Q});throw w.error(we.toString()),we}const ve=W("IMAGE_MODERATION_WORKER_HOST");return{addressList:fe.servers.map(we=>{let{address:Ct,wss:bt}=we;if(Ct&&bt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(ve,":").concat(bt,"/moderation")}).filter(we=>!!we),workerToken:fe.workerToken,vid:fe.vid,ticket:fe.appTicket,responseTime:Q}},(ie,fe)=>(Xe.apworkerEvent(A,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(ie.addressList),firstSuccess:fe===0,responseTime:Q,serverIp:l[fe%l.length]}),!1),(ie,fe)=>(Xe.apworkerEvent(A,{success:!1,sc:ie.data&&ie.data.code||200,serviceName:V,responseTime:Q,serverIp:l[fe%l.length]}),!!(ie.code!==F.OPERATION_ABORTED&&ie.code!==F.UNEXPECTED_RESPONSE||ie.data&&ie.data.retry)&&(z=l[(fe+1)%l.length],!0)),E)}(i,t,n,r);this.emit(Ca.STATE_CHANGE,Uf.AP_CONNECTED);const{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(t){this.emit(Ca.STATE_CHANGE,Uf.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(vt.CONNECTED,async()=>{this.emit(Ca.STATE_CHANGE,Uf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=to.CONNECTED}),this._workerConnection.on(vt.CLOSED,()=>{this.connectionState=to.CLOSED}),this._workerConnection.on(vt.FAILED,()=>{this.connectionState=to.CLOSED}),this._workerConnection.on(vt.RECONNECTING,()=>{this.connectionState=this.connectionState===to.CONNECTED?to.RECONNECTING:to.CONNECTING}),this._workerConnection.on(vt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=oY(new Uint8Array(t.data));W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,w.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Xe.reportApiInvoke(this._connectInfo.sid||null,{name:xn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Tn.TRACER}).onError(new ae(F.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},W("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else w.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ts(this,Ca.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await px(m,r,i),v=this._sequence+"-"+s+"-"+l+"-"+p+"-"+on(12,""),y={appId:r,cid:s,cname:i,deviceId:"",elapse:mI.intToLong(Number(p-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:B5(p),uid:l,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete y.callbackData;const D=sY(y);if(D.byteLength<this._workerMessageLengthLimit){if(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(P){for(var j=1;j<arguments.length;j++){var V=arguments[j]!=null?arguments[j]:{};j%2?W5(Object(V),!0).forEach(function(G){M(P,G,V[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(V)):W5(Object(V)).forEach(function(G){Object.defineProperty(P,G,Object.getOwnPropertyDescriptor(V,G))})}return P}({},y);delete A.jpg,w.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return D}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ai.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=to.CLOSED,this.emit(Ca.STATE_CHANGE,Uf.CLOSED)}}function G5(e){if(nn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ae(F.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ae(F.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const fY={name:"ImageModeration",create:function(e){let{config:t}=e;return G5(t),new mI(t)}};var H5,K5,z5,Y5,q5,X5,J5,Q5,$5,Z5,eV,tV,nV,rV,iV,sV,oV,aV,cV,lV,dV,uV,hV,pV,fV,mV,_V,gV,EV,vV,SV,yV,TV,CV,wV,RV,bV,IV,AV,OV,NV,Be;function PV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Ho(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PV(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}Fr.setLogger(w);let mY=(H5=ot(),K5=ot({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Of))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),z5=ot({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Af.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),Y5=ot({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),q5=ot({argsMap:(e,t,n)=>[t,n]}),X5=ot({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return[r?.uid,i]})}),J5=ot({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),Q5=ot({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:i}=n;return{uid:r?.uid,mediaType:i}})}),$5=ot(),Z5=ot(),eV=ot(),tV=ot(),nV=ot(),rV=ot(),iV=ot(),sV=ot(),oV=ot(),aV=ot(),cV=ot(),lV=ot(),dV=ot(),uV=ot(),hV=ot(),pV=ot({argsMap:(e,t)=>[t]}),fV=ot(),mV=ot(),_V=ot(),gV=ot(),EV=ot(),vV=ot(),SV=ot(),yV=ot(),TV=ot({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),CV=ot(),wV=ot(),RV=ot(),bV=ot(),IV=ot(),AV=ot(),OV=ot({reportResult:!0}),NV=ot(),Be=class extends bn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),M(this,"store",void 0),M(this,"_uid",void 0),M(this,"_channelName",void 0),M(this,"_uintUid",void 0),M(this,"_users",[]),M(this,"_config",void 0),M(this,"_clientId",void 0),M(this,"_appId",void 0),M(this,"_sessionId",null),M(this,"_key",void 0),M(this,"_rtmConfig",{}),M(this,"_joinInfo",void 0),M(this,"_gateway",void 0),M(this,"_statsCollector",void 0),M(this,"_configDistribute",void 0),M(this,"_leaveMutex",void 0),M(this,"_publishMutex",void 0),M(this,"_renewTokenMutex",void 0),M(this,"_subscribeMutex",void 0),M(this,"_encryptionMode","none"),M(this,"_encryptionSecret",null),M(this,"_encryptionSalt",null),M(this,"_encryptDataStream",!1),M(this,"_encryptDataStreamKey",null),M(this,"_encryptDataStreamIv",null),M(this,"_proxyServer",void 0),M(this,"_turnServer",{servers:[],mode:"auto"}),M(this,"_cloudProxyServerMode","disabled"),M(this,"_isDualStreamEnabled",!1),M(this,"_defaultStreamFallbackType",void 0),M(this,"_lowStreamParameter",void 0),M(this,"_streamFallbackTypeCacheMap",new Map),M(this,"_remoteStreamTypeCacheMap",new Map),M(this,"_axiosCancelSource",Ai.CancelToken.source()),M(this,"_audioVolumeIndicationInterval",void 0),M(this,"_networkQualityInterval",void 0),M(this,"_userOfflineTimeout",void 0),M(this,"_streamRemovedTimeout",void 0),M(this,"_liveTranscodeStreamingClient",void 0),M(this,"_liveRawStreamingClient",void 0),M(this,"_channelMediaRelayClient",void 0),M(this,"_networkQualitySensitivity","normal"),M(this,"_p2pChannel",void 0),M(this,"_useLocalAccessPoint",!1),M(this,"_setLocalAPVersion",void 0),M(this,"_joinAndNotLeaveYet",!1),M(this,"_numberOfJoinCount",0),M(this,"_joinResponse",null),M(this,"_remoteDefaultVideoStreamType",void 0),M(this,"_inspect",void 0),M(this,"_moderation",void 0),M(this,"_license",void 0),M(this,"_pendingPublishedUsers",[]),M(this,"ntpAlignErrorCount",0),M(this,"remoteInboundOffset",0),M(this,"_peerConnectionState",void 0),M(this,"_handleLocalTrackEnable",(i,s,o)=>{this.publish(i,!1).then(s).catch(o)}),M(this,"_handleLocalTrackDisable",(i,s,o)=>{this.unpublish(i).then(s).catch(o)}),M(this,"_handleUserOnline",i=>{if(W("BLOCK_LOCAL_CLIENT")&&Th(i.uid,this.channelName))return void w.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&w.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(o=>o.uid===i.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Nt.USER_JOINED,s));else{const o=new Pd(i.uid,i.uint_id||i.uid);this._users.push(o),w.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.safeEmit(Nt.USER_JOINED,o)}}),M(this,"_handleUserOffline",i=>{if(W("BLOCK_LOCAL_CLIENT")&&Th(i.uid,this.channelName))return;const s=this._users.find(o=>o.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:Ry(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),w.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Nt.USER_LEAVED,s,i.reason))}),M(this,"_handleAddAudioOrVideoStream",(i,s,o,c,l,p,m,E)=>{if(W("BLOCK_LOCAL_CLIENT")&&Th(s,this.channelName))return;const v=this._users.find(D=>D.uid===s);if(!v)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(v.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(v.uid,{videoAddNotify:Date.now()});const y=i==="audio"?v.hasAudio:v.hasVideo;if(v._uintid||(v._uintid=p||s),i==="audio"?v._trust_audio_stream_added_state_=!0:v._trust_video_stream_added_state_=!0,i==="audio"?(v._audio_added_=!0,o!==void 0&&(v._audioSSRC=o),c!==void 0&&(v._cname=c),m&&(v._audioOrtc=m)):(v._video_added_=!0,o!==void 0&&(v._videoSSRC=o),c!==void 0&&(v._cname=c),E!==void 0&&(v._rtxSsrcId=E),m&&(v._videoOrtc=m)),(i==="audio"?v.hasAudio:v.hasVideo)&&!y&&(w.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,v,i)),i==="video"?Xe.onGatewayStream(this._sessionId,sr.ON_ADD_VIDEO_STREAM,yn.ON_ADD_VIDEO_STREAM,{peer:p||s,ssrc:v._videoSSRC}):Xe.onGatewayStream(this._sessionId,sr.ON_ADD_AUDIO_STREAM,yn.ON_ADD_AUDIO_STREAM,{peer:p||s,ssrc:v._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(v,i,o).then(D=>{if(D&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Zg))return this._p2pChannel.unsubscribe(v,i,!0).then(()=>this._subscribe(v,i,!0).catch(A=>{w.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(v,i)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(v.uid," after reconnect.")),this._subscribe(v,i,!0).catch(D=>{w.error("[".concat(this._clientId,"] resubscribe error"),D.toString())})),i==="video"&&!Pr()&&!Xr()){const D=this._getEncodingName(l);D?.toLocaleLowerCase()==Mg.av1&&Fz().then(A=>{A||this._gateway.downgradeCodec(D)})}}),M(this,"_handleRemoveStream",i=>{if(W("BLOCK_LOCAL_CLIENT")&&Th(i.uid,this.channelName))return;const s=this._users.find(c=>c.uid===i.uid);if(!s)return void w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));w.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let o=()=>{};s.hasAudio&&s.hasVideo?o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio"),w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(o=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Nt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Zg&&this._p2pChannel.unsubscribe(s).then(c=>{if(c)return this._gateway.unsubscribe(c,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Xe.onGatewayStream(this._sessionId,sr.ON_REMOVE_STREAM,yn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),o()}),M(this,"_handleSetStreamLocalEnable",(i,s,o)=>{if(W("BLOCK_LOCAL_CLIENT")&&Th(s,this.channelName))return;const c=this._users.find(m=>m.uid===s);if(!c)return void w.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));w.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(o?"enabled":"disabled"," with uid ").concat(s));const l=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;const m=c._audio_enabled_;if(c._audio_enabled_=o,c._audio_enabled_===m)return;{const E=c._audio_enabled_?"enable-local-audio":"disable-local-audio";w.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}else{c._trust_video_enabled_state_=!0;const m=c._video_enabled_;if(c._video_enabled_=o,c._video_enabled_===m)return;{const E=c._video_enabled_?"enable-local-video":"disable-local-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,s,E)}}const p=i==="audio"?c.hasAudio:c.hasVideo;return l!==p?!l&&p?(w.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(Nt.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),w.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(Nt.USER_UNPUBLISHED,c,i)):void 0}),M(this,"_handleMuteStream",(i,s,o)=>{if(W("BLOCK_LOCAL_CLIENT")&&Th(i,this.channelName))return;w.debug("[".concat(this._clientId,"] receive mute message"),i,s,o);const c=this._users.find(m=>m.uid===i);if(!c)return void w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const l=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;const m=c._audio_muted_;if(c._audio_muted_=o,c._audio_muted_===m)return;{const E=c._audio_muted_?"mute-audio":"unmute-audio";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}else{c._trust_video_mute_state_=!0;const m=c._video_muted_;if(c._video_muted_=o,c._video_muted_===m)return;{const E=c._video_muted_?"mute-video":"unmute-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(E)),this.safeEmit(Nt.USER_INFO_UPDATED,i,E)}}const p=s==="audio"?c.hasAudio:c.hasVideo;if(l!==p){if(!l&&p)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(w.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(Nt.USER_PUBLISHED,c,s)):void w.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),w.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(Nt.USER_UNPUBLISHED,c,s)}}),M(this,"_handleP2PLost",async i=>{w.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():w.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),M(this,"_handleTokenWillExpire",()=>{w.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),M(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),w.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),M(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Nt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Nt.NETWORK_QUALITY,i)}),M(this,"_handleP2PAddAudioOrVideoStream",(i,s,o,c)=>{const l=this._users.find(m=>m.uid===s);if(!l)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(l.uid,i,void 0,void 0,void 0,Date.now());const p=i==="audio"?l.hasAudio:l.hasVideo;i==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,i==="audio"?(l._audio_added_=!0,o!==void 0&&(l._audioSSRC=o),c!==void 0&&(l._audioMid=c)):(l._video_added_=!0,o!==void 0&&(l._videoSSRC=o),c!==void 0&&(l._videoMid=c)),(i==="audio"?l.hasAudio:l.hasVideo)&&!p&&(w.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(i)),this.safeEmit(Nt.USER_PUBLISHED,l,i)),this._p2pChannel.hasPendingRemoteMedia(l,i)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,i,!0).catch(m=>{w.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=t||on(5,"client-"),this.store=new class{constructor(i,s,o,c){pt(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:o,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:mh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=function(s,o){switch(o.type){case ft.SET_SESSION_ID:return Re(Re({},s),{},{sessionId:o.sessionId});case ft.SET_P2P_ID:return Re(Re({},s),{},{p2pId:o.p2pId});case ft.SET_UID:return Re(Re({},s),{},{uid:o.uid});case ft.SET_INT_UID:return Re(Re({},s),{},{intUid:o.intUid});case ft.SET_PUB_ID:return Re(Re({},s),{},{pubId:o.pubId});case ft.KEY_METRIC_CLIENT_CREATED:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{clientCreated:o.metric})});case ft.KEY_METRIC_JOIN_START:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{joinStart:o.metric})});case ft.KEY_METRIC_PRELOAD_START:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{preloadStart:o.metric})});case ft.KEY_METRIC_PRELOAD_END:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{preloadEnd:o.metric})});case ft.KEY_METRIC_JOIN_END:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{joinEnd:o.metric})});case ft.KEY_METRIC_REQUEST_AP_START:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{requestAPStart:o.metric})});case ft.KEY_METRIC_REQUEST_AP_END:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{requestAPEnd:o.metric})});case ft.KEY_METRIC_REQUEST_SUA_END:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{requestSUAEnd:o.metric})});case ft.KEY_METRIC_BEFORE_CONNECT:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{beforeConnect:o.metric})});case ft.KEY_METRIC_PEER_RECEIVER:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{peerReceiver:o.metric})});case ft.KEY_METRIC_SIGNAL_CONNECTED:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{signalConnected:o.metric})});case ft.KEY_METRIC_JOIN_REQ:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{joinReq:o.metric})});case ft.KEY_METRIC_JOIN_REP:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{joinRep:o.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_START:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{joinGatewayStart:o.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_END:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{joinGatewayEnd:o.metric})});case ft.KEY_METRIC_PEER_CONNECTION_START:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{peerConnectionStart:o.metric})});case ft.KEY_METRIC_PEER_CONNECTION_END:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{peerConnectionEnd:o.metric})});case ft.KEY_METRIC_DESCRIPTION_START:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{descriptionStart:o.metric})});case ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{signalChannelOpen:o.metric})});case ft.KEY_METRIC_ICE_CONNECTION_END:return Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{iceConnectionEnd:o.metric})});case ft.KEY_METRIC_PUBLISH:{const c=s.keyMetrics.publish,l=c.findIndex(p=>p.trackId===o.metric.trackId);return l!==-1?(c[l]=Re(Re({},c[l]),o.metric),Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{publish:[...c]})})):Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,o.metric]})})}case ft.KEY_METRIC_SUBSCRIBE:{const c=s.keyMetrics.subscribe,l=c.findIndex(p=>p.userId===o.metric.userId&&p.type===o.metric.type);return l!==-1?(c[l]=Re(Re({},c[l]),o.metric),Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{subscribe:[...c]})})):Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,o.metric]})})}case ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const c=s.keyMetrics.firstVideoFrameDecoded,l=c.findIndex(p=>p.userId===o.metric.userId);return l!==-1?(c[l]=Re(Re({},c[l]),o.metric),Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):Re(Re({},s),{},{keyMetrics:Re(Re({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,o.metric]})})}case ft.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case ft.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=o.mode,s;case ft.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,o.record]:(s.joinChannelServiceRecords[o.index]=Re(Re({},s.joinChannelServiceRecords[o.index]),o.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case ft.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case ft.SET_USE_P2P:return Re(Re({},s),{},{useP2P:o.val});case ft.SET_TRANSPORT_TYPE:return Re(Re({},s),{},{p2pTransport:o.val});default:return s}}(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:ft.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:ft.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:ft.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:ft.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:ft.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:ft.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:ft.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:ft.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:ft.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ft.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ft.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ft.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ft.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ft.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Re({userId:i},s)})}descriptionStart(){this.dispatch({type:ft.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,o,c){this.dispatch({type:ft.KEY_METRIC_PUBLISH,metric:Re(Re({trackId:i,type:s},o&&{publishStart:o}),c&&{publishEnd:c})})}subscribe(i,s,o,c,l,p,m){this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re(Re(Re({userId:i,type:s},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),l&&{firstFrame:l}),p&&{streamAdded:p}),m&&{firstDecoded:m})})}massSubscribe(i,s,o,c){i.forEach(l=>{this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re({userId:l.userId,type:l.type},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:Re(Re({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ft.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ft.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Fr("client-leave",this._clientId),this._publishMutex=new Fr("client-publish",this._clientId),this._renewTokenMutex=new Fr("client-renewtoken",this._clientId),this._subscribeMutex=new Fr("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),w.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Qs," build: ").concat(eb,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{BR(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){w.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new Qg(this.store),this._statsCollector.onStatsException=(i,s,o)=>{w.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(o)),i===Zb.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(c=>{c instanceof jy&&W("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()}),this.safeEmit(Nt.EXCEPTION,{code:i,msg:s,uid:o})},this._statsCollector.onUploadPublishDuration=(i,s,o,c)=>{const l=this._users.find(p=>p.uid===i);l&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(l._uintid,{peerPublishDuration:o,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(l)),Xe.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:o,peer:l._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(W("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const s=this.localTracks.find(o=>o instanceof mn);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?W("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Lz(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||qn,httpRetryConfig:e.httpRetryConfig||qn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Kz(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},ml("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Zg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Zt("JOIN_GATEWAY_USE_443PORT_ONLY",s),Zt("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const c=this._gateway.signal.websocket;return c instanceof Vb&&(c.use443PortOnly=s,c.tryDoubleDomain=o),async function(l,p,m){Sy.get(l)||Sy.set(l,[]),yy.get(l)||yy.set(l,p),gc.get(l)||gc.set(l,0);const E=Sy.get(l),v=yy.get(l);if(!E||!v)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(gc.get(l)===v){const j=Ig();E.push(j),await j.promise}gc.set(l,gc.get(l)+1);for(var y=arguments.length,D=new Array(y>3?y-3:0),A=3;A<y;A++)D[A-3]=arguments[A];const P=await m(...D);return gc.set(l,gc.get(l)-1),gc.get(l)===v-1&&E.length>0&&(E[0].resolve(),E.shift()),gc.get(l)===0&&(Sy.set(l,[]),yy.set(l,0),gc.set(l,0)),P}("client.join",W("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(Ay||Ay||(Ay=(window.location.protocol.split(":")[0]||"").toUpperCase(),Ay))==="HTTPS",c=IL()?window.isSecureContext:"Browser Not Support";(!IL()&&!o||!window.isSecureContext)&&w.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let l;Xe.setAppId(e);try{if(!n&&n!==null)throw new ae(F.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&wr(n,"token",1,2047),wr(e,"appid",1,2047),Jy(t),r&&Qy(r),i)if(typeof i=="string")wr(i,"optionalInfo",1,256),l=i;else{if(typeof i!="object")throw new ae(F.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:P,enableInstantMuteRestore:j}=i;P&&(Ea(P,"autoSubscribe"),w.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(P)),this.store.autoSubscribe=P),j&&(Ea(j,"enableInstantMuteRestore"),w.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(j)),this.store.enableInstantMuteRestore=j)}}}catch(P){throw Xe.reportApiInvoke(fh(),{name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}).onError(P),P}if(this._leaveMutex.isLocked&&(w.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),w.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const P=new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Xe.reportApiInvoke(fh(),{name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}).onError(P),P}this._gateway.state="CONNECTING",this.store.preloadStart();const p=await b5({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const m=p?.sid||fh();w.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);const E=Xe.reportApiInvoke(m,{id:this._clientId,name:xn.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:c},tag:Tn.TRACER}),v=Ho(Ho(Ho({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!p},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:W("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(v.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(v.stringUid=r,this._uintUid?(v.uid=this._uintUid,this._uintUid=void 0):v.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(v.aesmode=this._encryptionMode,v.aespassword=await(async P=>{const j=function(Q){const z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ie=new Uint8Array(new ArrayBuffer(z.length));for(let fe=0;fe<z.length;fe+=1)ie[fe]=z.charCodeAt(fe);return ie}(),V=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),G=jR(P),Z=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},V,G);return function(Q){let z="";for(let ie=0;ie<Q.length;ie+=1)z+=String.fromCharCode(Q[ie]);return window.btoa(z)}(new Uint8Array(Z))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(v.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const P=new TextEncoder,j=W("USE_PURE_ENCRYPTION_MASTER_KEY")?P.encode(v.appId+this._encryptionSecret+this._encryptionSecret):P.encode(v.appId+v.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(V,G,Z){const Q=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=V==="aes-128-gcm2"?128:256,ie=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:UL,hash:"SHA-256",salt:Z},Q,z+dK);return new Uint8Array(ie).subarray(z/8)}(this._encryptionMode,j,ph(this._encryptionSalt)),this._encryptDataStreamKey=await async function(V,G,Z){const Q=await window.crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveBits","deriveKey"]),z=V==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:UL,hash:"SHA-256",salt:Z},Q,{name:"AES-GCM",length:z},!0,["encrypt","decrypt"])}(this._encryptionMode,j,ph(this._encryptionSalt))}else c?w.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):w.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,w.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:v.stringUid});const y=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&y===this._sessionId&&Xe.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let P;const j=v.cloudProxyServer;if(Ae(D=["proxy3","proxy4","proxy5"]).call(D,j)){const z=W("PROXY_SERVER_TYPE3");Array.isArray(z)?v.proxyServer=z[0]:v.proxyServer=z}if(Xe.setProxyServer(v.proxyServer),w.setProxyServer(v.proxyServer),this.store.requestAPStart(),p){if(w.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(v.stringUid?", ".concat(v.stringUid," => ").concat(p.intUid):""," ")),v.stringUid&&!v.uid&&(v.uid=p.intUid),P={gatewayInfo:p.ap.gatewayInfo},W("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&v.turnServer.mode==="auto")if(p.ap.proxyInfo.addresses.length===0)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const z=(await TU(p.ap.proxyInfo,p.ap.gatewayInfo.uid)).map(ie=>({turnServerURL:ie.address,tcpport:ie.tcpport||Lr.tcpport,udpport:ie.udpport||Lr.udpport,username:ie.username||Lr.username,password:ie.password||Lr.password,forceturn:!1,security:!0}));v.turnServer={mode:"manual",servers:z}}O5(p,v.stringUid)}else{if(v.stringUid&&!v.uid){let z;[z,P]=await je.all([JU(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store).finally(()=>{this.store.requestSUAEnd()}),XU(v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),w.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(v.stringUid," => ").concat(z)),v.uid=z,P.gatewayInfo.uid=z,P.gatewayInfo.res.uid=z}else P=await XU(v,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(v,this._axiosCancelSource.token),this._configDistribute.on(Wg.UPDATE_BITRATE_LIMIT,z=>{this._p2pChannel.updateBitrateLimit(z)}),this._configDistribute.on(Wg.UPDATE_CLIENT_ROLE_OPTIONS,z=>{this._setClientRoleOptions(z)})},0),this._key=n||e;const V=P.gatewayInfo,G=v.uid?v.uid:V.uid;this._joinInfo=Ho(Ho({},v),{},{cid:V.cid,uid:G,vid:V.vid,apResponse:V.res,apGatewayAddress:V.apGatewayAddress,uni_lbs_ip:V.uni_lbs_ip,gatewayAddrs:V.gatewayAddrs}),this.store.intUid=G,this.store.cid=V.cid;const Z=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(Z),this._appId=e,this._channelName=v.cname,this._uid=Z,this.store.uid=Z,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Pr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Q=v.stringUid?"string uid: ".concat(v.stringUid,",uid: ").concat(v.uid):"uid: ".concat(this._uid);return w.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Q)),setTimeout(()=>{w.startUpload()},5e3),this.store.joinEnd(),A=this,Ae(yh).call(yh,A)||yh.push(A),this._cloudProxyServerMode==="disabled"&&Ft().supportWebCrypto&&W("ENABLE_PRELOAD")&&pI(this._joinInfo),Z}catch(P){const j=Array.isArray(P)?P[0]:P;throw j&&j.code===F.OPERATION_ABORTED?w.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),j):w.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),j),j.code!==F.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(j),j}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new ae(F.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!W("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){w.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Pr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=yh.indexOf(t);n!==-1&&yh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return w.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Xt.LEAVE),w.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Of))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ae(F.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new ae(F.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof Of))throw new ae(F.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new ae(F.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}w.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof mn&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),w.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw w.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new ae(F.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));nn(e.id,"id",0,65535,!0),Ea(e.ordered,"ordered"),wr(e.metadata,"metadata",0,512),w.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new ae(F.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ae(F.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return FU(i,!1)}(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ae(F.CREATE_DATACHANNEL_ERROR);try{await je.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==F.DISCONNECT_P2P)throw i}}return w.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw w.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Of))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);w.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Vn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),w.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw w.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),w.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),w.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw w.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Pd)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new ae(F.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(ir(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ae(F.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===We.AUDIO,r=t===We.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:c,cname:l,uint_id:p}=await this._gateway.presubscribe(e,t,!0);if(s==null)throw new ae(F.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(v=>v.uid===e);m||(m=new Pd(e,p||e),m._is_pre_created=!0,this._users.push(m)),l&&(m._cname=l),m._uintid||(m._uintid=p||e),n&&(m._audioSSRC=s,m._audio_pre_subscribed=!0,o&&(m._audioOrtc=o)),r&&(m._videoSSRC=s,m._video_pre_subscribed=!0,o&&(m._videoOrtc=o),c!=null&&(m._rtxSsrcId=c)),w.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(m,t,s,c,o);const E=n?m._audioTrack:m._videoTrack;if(!E)throw new ae(F.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),r&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),E}catch(s){throw w.error("[".concat(this._clientId,"] presub user ").concat(e," error"),s),s}finally{i()}}async _subscribeDataChannel(e,t){var n;if(nn(t,"channelId",0,65535,!0),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e))throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ae(F.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ae(F.INVALID_REMOTE_USER,"user is not published");const i=(n=e._dataChannels)===null||n===void 0?void 0:n.find(c=>c.id===t);if(!i)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=await this._p2pChannel.subscribeDataChannel(e,[i]);if(c&&Ae(c).call(c,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ae(F.CREATE_DATACHANNEL_ERROR);const l={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,l,!0),await i._waitTillOpen()}catch(l){if(l?.code!==F.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),l;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(e,t,n){if(ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===e)){const s=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new ae(F.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const s=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const i=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,o,c)}catch(o){throw o}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});const s=t==="audio"?e._audioTrack:e._videoTrack;if(!s)throw new ae(F.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new ae(F.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?We.AUDIO:We.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const l=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==i&&(i=m,s=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?We.AUDIO:We.VIDEO,ssrcId:i}),Hr.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,c,!0)}catch(E){if(E?.code!==F.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),E;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m?.code,e,t),m}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new ae(F.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),p}catch(p){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{l()}}async massSubscribe(e){if(ul(e,"subscribeList"),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(c=>{let{user:l,mediaType:p}=c;return"user: ".concat(l?.uid,", mediaType: ").concat(p)}).join("; ")));const i=(e=[...e]).map(c=>{let{user:l,mediaType:p}=c;return{user:l,mediaType:p}}),s=await this._p2pChannel.globalLock();try{var o;for(let l=e.length-1;l>=0;l--){const p=e[l],{user:m,mediaType:E}=p;if(ir(E,"mediaType",["audio","video"]),!m){const A=new ae(F.INVALID_PARAMS,"user property does not exist in subscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===m)){const A=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");w.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),i[l].error=A,e.splice(l,1);continue}if(E==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||E==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const A=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);w.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(E,", remote user is not published")),i[l].error=A,e.splice(l,1);continue}const y=ur.Video|ur.LwoVideo,D=n.get(m);if(D){if(E==="video"?D&y:D&ur.Audio){e.splice(l,1),w.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(E," twice"));continue}n.set(m,D|(E==="video"?y:ur.Audio))}else n.set(m,E==="video"?y:ur.Audio)}for(let l=e.length-1;l>=0;l--){const p=e[l],{user:m,mediaType:E}=p,v=ur.Video|ur.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,E)){await this._p2pChannel.unmuteRemoteNoLock(m,E);const y=n.get(m);n.set(m,E==="video"?y^v:y^ur.Audio),e.splice(l,1)}}this.store.massSubscribe(e.map(l=>({userId:l.user.uid,type:l.mediaType})),t);let c=Ui(o=Array.from(n.entries())).call(o,(l,p)=>{let[m,E]=p;if(E===0)return l;const v={stream_id:m.uid,stream_type:E};return E&ur.Audio&&(v.audio_ssrc=m._audioSSRC),E&ur.Video&&(v.video_ssrc=m._videoSSRC),l.push(v),l},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(p=>{let{user:m,mediaType:E}=p;return{user:m,mediaType:E,ssrcId:E===We.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:E===We.VIDEO?m._rtxSsrcId:void 0}}));const l=new Map;if(c=c.filter(p=>p.video_ssrc&&!this._p2pChannel.isPreSubScribe(p.video_ssrc)||p.audio_ssrc&&!this._p2pChannel.isPreSubScribe(p.audio_ssrc)||!p.video_ssrc&&!p.audio_ssrc),c.length>0){const p=await this._gateway.subscribeAll(c,!0);(p?.users||[]).forEach(m=>{let{stream_id:E,video_error_code:v,audio_error_code:y,error_code:D}=m;(v||y||D)&&l.set(E,{video_error_code:v,audio_error_code:y,error_code:D})})}if(Array.from(l.entries()).length>0){const p=[];Array.from(l.entries()).forEach(m=>{let[E,v]=m;const y=this.remoteUsers.find(D=>D.uid===E);if(y){let D;v.error_code||v.video_error_code&&v.audio_error_code?D=void 0:v.video_error_code?D=We.VIDEO:v.audio_error_code&&(D=We.AUDIO),p.push({user:y,mediaType:D})}}),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of i){const m=l.get(p.user.uid);if(m){const E=m.error_code||p.mediaType==="audio"&&m.audio_error_code||p.mediaType==="video"&&m.video_error_code;if(E){const v=Gg(E);w.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(v.desc)),p.error=new ae(F.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(v.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(i.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),i.forEach(p=>{var m;Xe.subscribe(this.store.sessionId,{succ:!!p.error,ec:((m=p.error)===null||m===void 0?void 0:m.code)||null,video:p.mediaType===We.VIDEO,audio:p.mediaType===We.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===We.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(p.user._videoSSRC)},!0)}),w.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(p=>{let{user:m,mediaType:E}=p;return"user: ".concat(m?.uid,", mediaType: ").concat(E)}).join("; "))),i}catch(l){throw await this._p2pChannel.massUnsubscribeNoLock(e),l}}finally{s(),r()}}async unsubscribe(e,t,n){if(!(e instanceof Pd)){const s=this.remoteUsers.find(o=>o.uid===e);if(!s)throw new ae(F.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&ir(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===e)){const s=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const s=await this._p2pChannel.unsubscribe(e,t);s&&await this._gateway.unsubscribe(s,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Ry(this._users,e),w.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===F.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&nn(t,"id",0,65535,!0),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new ae(F.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(s=>s.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new ae(F.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),w.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===F.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(ul(e,"unsubscribeList"),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");w.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const c=new ae(F.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(ir(i,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===r)){w.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=ur.Video|ur.LwoVideo;if(t.has(r)){const c=t.get(r);let l;switch(i){case"video":l=c&o;break;case"audio":l=c&ur.Audio;break;default:l=c&(ur.Audio|o)}if(l){w.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?i==="audio"?t.set(r,c|ur.Audio):i==="video"&&t.set(r,c|o):t.set(r,c|ur.Audio|o)}else i?i==="audio"?t.set(r,ur.Audio):i==="video"&&t.set(r,o):t.set(r,ur.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),w.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i?.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===F.DISCONNECT_P2P)return void w.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw w.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new pe(F.INVALID_PARAMS);Pn(n.width)||UR(n.width,"streamParameter.width"),Pn(n.height)||UR(n.height,"streamParameter.height"),Pn(n.framerate)||UR(n.framerate,"streamParameter.framerate"),Pn(n.bitrate)||nn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&w.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),w.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Te.LocalVideoLowTrack)}async enableDualStream(){if(!Ft().supportDualStream)throw Xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ae(F.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ae(F.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),w.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Te.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),w.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){ir(r,"role",["audience","host"])}(e),t&&BR(t),this.mode==="rtc"||this.mode==="p2p")throw w.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ae(F.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ae(F.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ae(F.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&W("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",kr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),w.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&BR(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{w.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(wr(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ae(F.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Xe.setProxyServer(this._proxyServer),w.setProxyServer(this._proxyServer),w.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ae(F.INVALID_OPERATION,"You have already set the proxy")}if(Pg(e))return this._turnServer={servers:e,mode:"original-manual"},void w.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>mL(n)),this._turnServer={servers:e,mode:"manual"},w.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"you should set license before join channel");if(wr(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ae(F.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,w.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ae(F.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ae(F.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ae(F.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ae(F.INVALID_OPERATION,"Stop proxy server after leave channel");Xe.setProxyServer(),w.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ae(F.INVALID_PARAMS,"accessPoints is required.");ul(e.accessPoints.serverList,"accessPoints.serverList"),wr(e.accessPoints.domain,"accessPoints.domain");const t=(v,y)=>{nn(v,y,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ae(F.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");W("CLOSE_AFB_FOR_LOCAL_AP")&&(Zt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Zt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,s=e.accessPoints.serverList.map(v=>r.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(i):v),o=s.map(v=>"".concat(v,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Zt("WEBCS_DOMAIN",o),Zt("WEBCS_DOMAIN_BACKUP_LIST",o),Zt("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ul(e.report.hostname,"report.hostname"),Zt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Zt("EVENT_REPORT_DOMAIN",s[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),c=e.report.port),Zt("STATS_COLLECTOR_PORT",c),e.report?Zt("ENABLE_EVENT_REPORT",!0):Zt("ENABLE_EVENT_REPORT",!1);let l="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ul(e.log.hostname,"log.hostname"),l=e.log.hostname[0]):l=s[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),Zt("LOG_UPLOAD_SERVER","".concat(l,":").concat(p));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ul(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=s;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),Zt("CDS_AP",m.map(v=>"".concat(v,":").concat(E))),e.cds?Zt("ENABLE_CONFIG_DISTRIBUTE",!0):Zt("ENABLE_CONFIG_DISTRIBUTE",!1),w.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ul(e,"serverList"),wr(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ae(F.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Zt("WEBCS_DOMAIN",e),Zt("WEBCS_DOMAIN_BACKUP_LIST",e),Zt("GATEWAY_DOMAINS",[t]),Zt("EVENT_REPORT_DOMAIN",e[0]),Zt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Zt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),w.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(ir(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw w.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else w.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){ir(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw w.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}w.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){ir(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw w.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}w.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(s){ir(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),wr(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Ae(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new ae(F.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ae(F.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Ea(r,"encryptDataStream"),!Ae(i).call(i,e))throw new ae(F.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||w.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Sd(n))}async renewToken(e){if(wr(e,"token",1,2047),!this._key||!this._joinInfo)throw new ae(F.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(W("USE_NEW_TOKEN")){w.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await Hz(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn);w.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else w.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});w.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,w.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?w.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Nt.VOLUME_INDICATOR,e)},W("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ae(F.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ae(F.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ae(F.LIVE_STREAMING_TASK_CONFLICT);const n=t?hl.TRANSCODE:hl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(hl.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new ae(F.INVALID_PARAMS,"can not find live streaming url to stop");await je.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){n5(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){n5(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Zg&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ae(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,s,o){var c;const l=Ui(c=Array.from(o)).call(c,(A,P)=>A+P,0),p={serverTs:0,seq:uK++,length:o.length,checkSum:l},m=new Uint8Array(CL(l,2)),E=new ArrayBuffer(Cf),v=new DataView(E);v.setUint32(0,p.serverTs),v.setUint16(4,p.seq),v.setUint16(6,p.length),v.setUint16(8,p.checkSum);const y=16-o.length%16;o=EL(o,new Uint8Array(y));const D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:ML,additionalData:m},s,o);return EL(new Uint8Array(E),new Uint8Array(D))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ae(F.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(lt.DATA_STREAM,{payload:Sd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-$z},!n)}sendMetadata(e){if(!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ae(F.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(lt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Sd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(SK),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not send custom report, not joined");await Xe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(W("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{Ae(t).call(t,n)||delete e[n]})}return e}async pickSVCLayer(e,t){ir(t.spatialLayer,"spatialLayer",[0,1,2,3]),ir(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw w.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Ea(t,"apRTM"),nn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,w.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(w.debug("[".concat(this._clientId,"] reset client")),function(e){const t=xf.indexOf(e);t!==-1&&xf.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ai.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&A5(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Xe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Fr("client-publish",this._clientId),this._subscribeMutex=new Fr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||fh();e?w.debug("[".concat(this._clientId,"] new Session ").concat(r)):w.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,Xe.addSid(r);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};Xe.sessionInit(this._sessionId,Ho({cname:t.channel,appid:t.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ae(F.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");w.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Vn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==F.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof mn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(s=>{w.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===F.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ae(F.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ae(F.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));w.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==F.DISCONNECT_P2P)throw n.throw(s),s}n.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===F.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ae(F.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ml("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{Xe.reportApiInvoke(this._sessionId,{name:xn.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Tn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{Xe.reportApiInvoke(this._sessionId,{name:xn.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Tn.TRACER}).onSuccess(),this.safeEmit(Nt.LIVE_STREAMING_WARNING,i,s)},n.on(xb.REQUEST_WORKER_MANAGER_LIST,(i,s,o)=>{if(!this._joinInfo)return o(new ae(F.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,l,p,m){const E=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(v=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(v+"/api/v1?action=uap"):"https://".concat(v,"/api/v1?action=uap"));return await Uz(E,c,l,p,m)})(i,this._joinInfo,this._axiosCancelSource.token,qn).then(s).catch(o)}),n};return e===hl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ae(F.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},ml("ChannelMediaRelay").create(e));r.on("state",i=>{i===Ki.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Nt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const s=[];this._users.forEach(o=>{o._dataChannels.forEach(c=>{n.every(l=>l.uid!==o._uintid||l.stream_id!==c.id)&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:o,stream_id:c,ordered:l,max_retrans_times:p,metadata:m}=s,E=this._users.find(v=>v._uintid===o);if(!E)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(w.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Ae(i).call(i,E)||i.push(E),E._uintid||(E._uintid=o),E._dataChannels.findIndex(v=>v.id===s.stream_id)===-1){const v={id:c,ordered:!!l,maxRetransmits:p,metadata:m},y=function(D){return FU(D,!0)}(v);E._dataChannels.push(y),w.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(Nt.USER_PUBLISHED,E,"datachannel",v)}this._p2pChannel.hasPendingRemoteDataChannel(E,s.stream_id)&&(w.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,s.stream_id).catch(v=>{w.error("[".concat(this._clientId,"] resubscribe datachannel error"),v.toString())}))}),t&&(this.safeEmit(Nt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:o,stream_id:c}=s,l=this._users.find(m=>m._uintid===o);if(!l)return void w.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=l._dataChannels.find(m=>m.id===s.stream_id);p&&(w.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(l,[p]).then(m=>{if(l._dataChannels=l._dataChannels.filter(E=>E!==p),m)return this._gateway.unsubscribeDataChannel(m,l.uid)}),w.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(p.id)),this.safeEmit(Nt.USER_UNPUBLISHED,l,"datachannel",p._config))})}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return i==null||(r=i.rtpMap)===null||r===void 0?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){w.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Nt.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(gr.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{const{value:i,type:s,expires:o}=t[r];o&&o<=n||s||Ab()||!Object.prototype.hasOwnProperty.call(Py,r)||(Sa[r]=i,Sn[r]=i,w.debug("Update gateway parameters from config distribute",r,i))})}catch(t){w.error("Error update config from local cache",t.message)}})()}),this._gateway.on(gr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(gr.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Xt.FALLBACK)return;const i=()=>{this.safeEmit(Nt.CONNECTION_STATE_CHANGE,e,t,n)};if(Xe.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:xn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Tn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),w.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch(l=>{w.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),l)})}),this._remoteStreamTypeCacheMap.forEach((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch(l=>{w.warning("[".concat(this._clientId,"] auto set remote stream type failed"),l)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{w.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{w.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{w.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,We.AUDIO,!1)),o._trust_video_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,We.VIDEO,!1)),o._trust_audio_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(w.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}i()}),this._gateway.on(gr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ae(F.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await b5(Ho(Ho({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,O5(r),this._joinInfo.preload=!0):(n=await Qb(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s;const[c,l]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:c,port:l}):i.push({host:c,port:l})}),e(i)}catch(n){t(n)}}),this._gateway.on(gr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Nt.NETWORK_QUALITY,e)}),this._gateway.on(gr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Nt.STREAM_TYPE_CHANGED,e,t),Xe.reportApiInvoke(this._sessionId,{name:xn.STREAM_TYPE_CHANGE,options:[e,t],tag:Tn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(gr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(gr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}}),this._gateway.on(gr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:w.debug("no attributes in joinResponse");const r=AU(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(gr.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:o}=this._joinInfo.apResponse,c="".concat(o,"_").concat(s);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=W("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(l){l.code&&l.code===F.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Pt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(Pt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Pt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Pt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Pt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,We.AUDIO,!0)),this._gateway.signal.on(Pt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,We.AUDIO,!1)),this._gateway.signal.on(Pt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,We.VIDEO,!0)),this._gateway.signal.on(Pt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,We.VIDEO,!1)),this._gateway.signal.on(Pt.RECEIVE_METADATA,e=>{const t=ph(e.metadata);this.safeEmit(Nt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Pt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=ph(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ae(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Cf)throw new ae(F.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Cf));n=await async function(s,o,c){const l=c.subarray(0,Cf),p=l.slice(8,Cf),m=(p[0]<<8)+p[1],E=(l[6]<<8)+l[7],v=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:ML,additionalData:new Uint8Array(CL(m,2))},o,c.subarray(Cf));return new Uint8Array(v).subarray(0,E)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(c=>c.uid===e.uid),o=i?.audioRecv.find(c=>c.ssrc===s?._audioSSRC);r=o?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),eY(Ho(Ho({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Pt.ON_CRYPT_ERROR,()=>{vd(()=>{w.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Nt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{w.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xt.TOKEN_EXPIRE),this.safeEmit(Nt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pt.ON_STREAM_FALLBACK_UPDATE,e=>{w.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Nt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),w.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Pt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Pt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ht.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case lt.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var n,r;const s=i.some(l=>{let{stream_type:p}=l;return p===Qt.Audio}),o=i.some(l=>{let{stream_type:p}=l;return p!==Qt.Audio}),c=i.some(l=>{let{stream_type:p}=l;return p===Qt.Screen||p===Qt.ScreenLow});t.state==="offer"&&Xe.publish(this._joinInfo.sid,{eventElapse:Hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:F.TIMEOUT,audio:s,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(n=i.find(l=>{let{stream_type:p}=l;return p===Qt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(r=i.find(l=>{let{stream_type:p}=l;return p!==Qt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case lt.SUBSCRIBE:t&&Xe.subscribe(this._joinInfo.sid,{succ:!1,ec:F.TIMEOUT,audio:t.stream_type===We.AUDIO,video:t.stream_type===We.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Hr.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Pt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Pt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;W("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Th(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let i=this._users.find(m=>m._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Pd(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(w.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Nt.USER_JOINED,i)));const s=ur.Audio&r.stream_type,o=(ur.Video|ur.LwoVideo)&r.stream_type,c=(65280&r.stream_type)!=0,l=s&&i.hasAudio,p=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!l&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Nt.USER_PUBLISHED,i,"audio")),o&&!p&&this.getListeners(Nt.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Nt.USER_PUBLISHED,i,"video")),(s&&!l||o&&!p||c)&&t.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(w.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{w.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Nt.PUBLISHED_USER_LIST).length>0?W("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(w.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Nt.PUBLISHED_USER_LIST,t)):w.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Pt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Zg&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return Ae(r=Object.keys(Mg)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Pt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Vn.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(i=>{const{kind:s,ssrcs:o,mid:c,isMuted:l}=i;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,c);const p=this._users.find(m=>m.uid===r);return p&&this.store.useP2P?this._p2pChannel.mockSubscribe(p,s,o[0].ssrcId,c).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,s,!!l)})}),this._gateway.signal.on(Vn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){n(i)}}),this._gateway.signal.on(ht.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Vn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,s=this._users.find(o=>o.uid===i);if(!s)return w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async o=>{let{stream_type:c}=o;const l=c===Qt.Audio?We.AUDIO:We.VIDEO;await this._p2pChannel.unsubscribe(s,l),this._handleMuteStream(i,l,!0)}),t()}catch(o){n(o)}}}),this._gateway.signal.on(Vn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case wd.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,We.VIDEO,!0);break;case wd.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,We.AUDIO,!0);break;case wd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,We.VIDEO,!1);break;case wd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,We.AUDIO,!1)}}),this._gateway.signal.on(Vn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==Ei.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Vn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(tt.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Vn.RESTART_ICE,e,r===Ei.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(tt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Vn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(tt.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Vn.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(tt.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(tt.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(tt.StateChange,(e,t)=>{t===Jt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(tt.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Nt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(tt.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(tt.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===F.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(tt.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(tt.RequestRePublishDataChannel,(e,t,n)=>{je.all(e.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==F.DISCONNECT_P2P)throw s}})).then(t).catch(n)}),this._p2pChannel.on(tt.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:i}of e)i===We.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(tt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(tt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(tt.MediaReconnectStart,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(tt.MediaReconnectEnd,e=>{this.safeEmit(Nt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(tt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(tt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(o){return void t.throw(o)}const{iceParameters:s}=function(o){const c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}}(i);await t.next({remoteIceParameters:s})}),this._p2pChannel.on(tt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(tt.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),o=AU(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(tt.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(tt.P2PLost,()=>{this.safeEmit(Nt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(tt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(tt.ConnectionTypeChange,e=>{this.safeEmit(Nt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(tt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(tt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(tt.AudioMetadata,e=>{this.safeEmit(Nt.AUDIO_METADATA,e)}),this._p2pChannel.on(tt.AudioPts,e=>{this.safeEmit(Nt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},ml("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:o,uid:c,cid:l,vid:p}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:o,uid:c,cid:l,vid:p?Number(p):0},qn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(Er.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Fo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Nt.CONTENT_INSPECT_ERROR,new ae(F.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Er.INSPECT_RESULT,(t,n)=>{var r;if(n?.code===F.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return w.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Nt.CONTENT_INSPECT_RESULT,t,n)}),e.on(Er.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Ea(e,"enabled"),e){if(!t)throw new ae(F.INVALID_PARAMS,"config is required");if(G5(t),!this._joinInfo)throw new ae(F.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},ml("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:o,token:c,uid:l,cid:p,vid:m}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:l,cid:p,vid:m?Number(m):0},qn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new ae(F.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Ca.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Nt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===to.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ae(F.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ca.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){ir(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ae(F.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,w.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return w.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Ea(e,"enabled"),Zt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},qe(Be.prototype,"leave",[H5],Object.getOwnPropertyDescriptor(Be.prototype,"leave"),Be.prototype),qe(Be.prototype,"publish",[K5],Object.getOwnPropertyDescriptor(Be.prototype,"publish"),Be.prototype),qe(Be.prototype,"unpublish",[z5],Object.getOwnPropertyDescriptor(Be.prototype,"unpublish"),Be.prototype),qe(Be.prototype,"subscribe",[Y5],Object.getOwnPropertyDescriptor(Be.prototype,"subscribe"),Be.prototype),qe(Be.prototype,"presubscribe",[q5],Object.getOwnPropertyDescriptor(Be.prototype,"presubscribe"),Be.prototype),qe(Be.prototype,"massSubscribe",[X5],Object.getOwnPropertyDescriptor(Be.prototype,"massSubscribe"),Be.prototype),qe(Be.prototype,"unsubscribe",[J5],Object.getOwnPropertyDescriptor(Be.prototype,"unsubscribe"),Be.prototype),qe(Be.prototype,"massUnsubscribe",[Q5],Object.getOwnPropertyDescriptor(Be.prototype,"massUnsubscribe"),Be.prototype),qe(Be.prototype,"setLowStreamParameter",[$5],Object.getOwnPropertyDescriptor(Be.prototype,"setLowStreamParameter"),Be.prototype),qe(Be.prototype,"enableDualStream",[Z5],Object.getOwnPropertyDescriptor(Be.prototype,"enableDualStream"),Be.prototype),qe(Be.prototype,"disableDualStream",[eV],Object.getOwnPropertyDescriptor(Be.prototype,"disableDualStream"),Be.prototype),qe(Be.prototype,"setClientRole",[tV],Object.getOwnPropertyDescriptor(Be.prototype,"setClientRole"),Be.prototype),qe(Be.prototype,"_setClientRoleOptions",[nV],Object.getOwnPropertyDescriptor(Be.prototype,"_setClientRoleOptions"),Be.prototype),qe(Be.prototype,"setProxyServer",[rV],Object.getOwnPropertyDescriptor(Be.prototype,"setProxyServer"),Be.prototype),qe(Be.prototype,"setTurnServer",[iV],Object.getOwnPropertyDescriptor(Be.prototype,"setTurnServer"),Be.prototype),qe(Be.prototype,"setLicense",[sV],Object.getOwnPropertyDescriptor(Be.prototype,"setLicense"),Be.prototype),qe(Be.prototype,"startProxyServer",[oV],Object.getOwnPropertyDescriptor(Be.prototype,"startProxyServer"),Be.prototype),qe(Be.prototype,"stopProxyServer",[aV],Object.getOwnPropertyDescriptor(Be.prototype,"stopProxyServer"),Be.prototype),qe(Be.prototype,"setLocalAccessPointsV2",[cV],Object.getOwnPropertyDescriptor(Be.prototype,"setLocalAccessPointsV2"),Be.prototype),qe(Be.prototype,"setLocalAccessPoints",[lV],Object.getOwnPropertyDescriptor(Be.prototype,"setLocalAccessPoints"),Be.prototype),qe(Be.prototype,"setRemoteDefaultVideoStreamType",[dV],Object.getOwnPropertyDescriptor(Be.prototype,"setRemoteDefaultVideoStreamType"),Be.prototype),qe(Be.prototype,"setRemoteVideoStreamType",[uV],Object.getOwnPropertyDescriptor(Be.prototype,"setRemoteVideoStreamType"),Be.prototype),qe(Be.prototype,"setStreamFallbackOption",[hV],Object.getOwnPropertyDescriptor(Be.prototype,"setStreamFallbackOption"),Be.prototype),qe(Be.prototype,"setEncryptionConfig",[pV],Object.getOwnPropertyDescriptor(Be.prototype,"setEncryptionConfig"),Be.prototype),qe(Be.prototype,"renewToken",[fV],Object.getOwnPropertyDescriptor(Be.prototype,"renewToken"),Be.prototype),qe(Be.prototype,"enableAudioVolumeIndicator",[mV],Object.getOwnPropertyDescriptor(Be.prototype,"enableAudioVolumeIndicator"),Be.prototype),qe(Be.prototype,"startLiveStreaming",[_V],Object.getOwnPropertyDescriptor(Be.prototype,"startLiveStreaming"),Be.prototype),qe(Be.prototype,"setLiveTranscoding",[gV],Object.getOwnPropertyDescriptor(Be.prototype,"setLiveTranscoding"),Be.prototype),qe(Be.prototype,"stopLiveStreaming",[EV],Object.getOwnPropertyDescriptor(Be.prototype,"stopLiveStreaming"),Be.prototype),qe(Be.prototype,"startChannelMediaRelay",[vV],Object.getOwnPropertyDescriptor(Be.prototype,"startChannelMediaRelay"),Be.prototype),qe(Be.prototype,"updateChannelMediaRelay",[SV],Object.getOwnPropertyDescriptor(Be.prototype,"updateChannelMediaRelay"),Be.prototype),qe(Be.prototype,"stopChannelMediaRelay",[yV],Object.getOwnPropertyDescriptor(Be.prototype,"stopChannelMediaRelay"),Be.prototype),qe(Be.prototype,"sendCustomReportMessage",[TV],Object.getOwnPropertyDescriptor(Be.prototype,"sendCustomReportMessage"),Be.prototype),qe(Be.prototype,"pickSVCLayer",[CV],Object.getOwnPropertyDescriptor(Be.prototype,"pickSVCLayer"),Be.prototype),qe(Be.prototype,"setRTMConfig",[wV],Object.getOwnPropertyDescriptor(Be.prototype,"setRTMConfig"),Be.prototype),qe(Be.prototype,"enableContentInspect",[RV],Object.getOwnPropertyDescriptor(Be.prototype,"enableContentInspect"),Be.prototype),qe(Be.prototype,"disableContentInspect",[bV],Object.getOwnPropertyDescriptor(Be.prototype,"disableContentInspect"),Be.prototype),qe(Be.prototype,"setImageModeration",[IV],Object.getOwnPropertyDescriptor(Be.prototype,"setImageModeration"),Be.prototype),qe(Be.prototype,"setP2PTransport",[AV],Object.getOwnPropertyDescriptor(Be.prototype,"setP2PTransport"),Be.prototype),qe(Be.prototype,"getJoinChannelServiceRecords",[OV],Object.getOwnPropertyDescriptor(Be.prototype,"getJoinChannelServiceRecords"),Be.prototype),qe(Be.prototype,"setPublishAudioFilterEnabled",[NV],Object.getOwnPropertyDescriptor(Be.prototype,"setPublishAudioFilterEnabled"),Be.prototype),Be);class nE{constructor(t,n){M(this,"id",0),M(this,"element",void 0),M(this,"peerPair",void 0),M(this,"context",void 0),M(this,"audioPlayerElement",void 0),M(this,"audioTrack",void 0),nE.count+=1,this.id=nE.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new je(o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new ae(F.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(i){throw new ae(F.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new ae(F.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){w.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var kV,bT;M(nE,"count",0);const _Y=window.AudioContext||window.webkitAudioContext,gY=new(kV=ot({report:Xe}),qe((bT=class{constructor(){M(this,"units",[]),M(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return w.debug("the system does not need to process local aec"),-1;this.context||(this.context=new _Y);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new nE(e,this.context),this.units.push(t)),t.startEchoCancellation(),w.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return xt().name!==Wt.SAFARI}}).prototype,"processExternalMediaAEC",[kV],Object.getOwnPropertyDescriptor(bT.prototype,"processExternalMediaAEC"),bT.prototype),bT);function DV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function LV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DV(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const _I=window||document;function xV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!_I)return;const n=Xn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=i=>{if(!(i&&i.blockedURI&&(Xn.onSecurityPolicyViolation||Xn.getListeners(Cc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;W("CSP_DETECTED_HOSTNAME_LIST").some(o=>Ae(s).call(s,o))&&(Xn.onSecurityPolicyViolation&&typeof Xn.onSecurityPolicyViolation=="function"&&Xn.onSecurityPolicyViolation(i),Xn.getListeners(Cc.SECURITY_POLICY_VIOLATION).length>0&&Xn.safeEmit(Cc.SECURITY_POLICY_VIOLATION,i))};n&&_I.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Xn.getListeners(Cc.SECURITY_POLICY_VIOLATION).length>0)&&_I.addEventListener("securitypolicyviolation",r),Xn._cspEventHandlerPointer=r}var EY=Y,vY=_D,MV=RegExp.prototype,SY=function(e){return e===MV||EY(MV,e)?vY(e):e.flags},oi=S(SY);function Xf(e){let t=e.length;for(;--t>=0;)e[t]=0}const gI=256,UV=286,rE=30,iE=15,EI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),IT=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),yY=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),VV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gl=new Array(576);Xf(gl);const sE=new Array(60);Xf(sE);const oE=new Array(512);Xf(oE);const aE=new Array(256);Xf(aE);const vI=new Array(29);Xf(vI);const AT=new Array(rE);function SI(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let jV,FV,BV;function yI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Xf(AT);const WV=e=>e<256?oE[e]:oE[256+(e>>>7)],cE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ks=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,cE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},bc=(e,t,n)=>{ks(e,n[2*t],n[2*t+1])},GV=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},HV=(e,t,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=iE;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=t;s++){let c=e[2*s+1];c!==0&&(e[2*s]=GV(r[c]++,c))}},KV=e=>{let t;for(t=0;t<UV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<rE;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},zV=e=>{e.bi_valid>8?cE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},YV=(e,t,n,r)=>{const i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},TI=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&YV(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!YV(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},qV=(e,t,n)=>{let r,i,s,o,c=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+c++],r+=(255&e.pending_buf[e.sym_buf+c++])<<8,i=e.pending_buf[e.sym_buf+c++],r===0?bc(e,i,t):(s=aE[i],bc(e,s+gI+1,t),o=EI[s],o!==0&&(i-=vI[s],ks(e,i,o)),r--,s=WV(r),bc(e,s,n),o=IT[s],o!==0&&(r-=AT[s],ks(e,r,o)));while(c<e.sym_next);bc(e,256,t)},CI=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,c,l,p=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(e.heap[++e.heap_len]=p=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=p<2?++p:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[2*l+1]);for(t.max_code=p,o=e.heap_len>>1;o>=1;o--)TI(e,n,o);l=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],TI(e,n,1),c=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=c,n[2*l]=n[2*o]+n[2*c],e.depth[l]=(e.depth[o]>=e.depth[c]?e.depth[o]:e.depth[c])+1,n[2*o+1]=n[2*c+1]=l,e.heap[1]=l++,TI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,E)=>{const v=E.dyn_tree,y=E.max_code,D=E.stat_desc.static_tree,A=E.stat_desc.has_stree,P=E.stat_desc.extra_bits,j=E.stat_desc.extra_base,V=E.stat_desc.max_length;let G,Z,Q,z,ie,fe,ve=0;for(z=0;z<=iE;z++)m.bl_count[z]=0;for(v[2*m.heap[m.heap_max]+1]=0,G=m.heap_max+1;G<573;G++)Z=m.heap[G],z=v[2*v[2*Z+1]+1]+1,z>V&&(z=V,ve++),v[2*Z+1]=z,Z>y||(m.bl_count[z]++,ie=0,Z>=j&&(ie=P[Z-j]),fe=v[2*Z],m.opt_len+=fe*(z+ie),A&&(m.static_len+=fe*(D[2*Z+1]+ie)));if(ve!==0){do{for(z=V-1;m.bl_count[z]===0;)z--;m.bl_count[z]--,m.bl_count[z+1]+=2,m.bl_count[V]--,ve-=2}while(ve>0);for(z=V;z!==0;z--)for(Z=m.bl_count[z];Z!==0;)Q=m.heap[--G],Q>y||(v[2*Q+1]!==z&&(m.opt_len+=(z-v[2*Q+1])*v[2*Q],v[2*Q+1]=z),Z--)}})(e,t),HV(n,p,e.bl_count)},XV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,p=4;for(o===0&&(l=138,p=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++c<l&&i===o||(c<p?e.bl_tree[2*i]+=c:i!==0?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,s=i,o===0?(l=138,p=3):i===o?(l=6,p=3):(l=7,p=4))},JV=(e,t,n)=>{let r,i,s=-1,o=t[1],c=0,l=7,p=4;for(o===0&&(l=138,p=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++c<l&&i===o)){if(c<p)do bc(e,i,e.bl_tree);while(--c!=0);else i!==0?(i!==s&&(bc(e,i,e.bl_tree),c--),bc(e,16,e.bl_tree),ks(e,c-3,2)):c<=10?(bc(e,17,e.bl_tree),ks(e,c-3,3)):(bc(e,18,e.bl_tree),ks(e,c-11,7));c=0,s=i,o===0?(l=138,p=3):i===o?(l=6,p=3):(l=7,p=4)}};let QV=!1;const $V=(e,t,n,r)=>{ks(e,0+(r?1:0),3),zV(e),cE(e,n),cE(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var TY=e=>{QV||((()=>{let t,n,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(vI[i]=r,t=0;t<1<<EI[i];t++)aE[r++]=i;for(aE[r-1]=i,s=0,i=0;i<16;i++)for(AT[i]=s,t=0;t<1<<IT[i];t++)oE[s++]=i;for(s>>=7;i<rE;i++)for(AT[i]=s<<7,t=0;t<1<<IT[i]-7;t++)oE[256+s++]=i;for(n=0;n<=iE;n++)o[n]=0;for(t=0;t<=143;)gl[2*t+1]=8,t++,o[8]++;for(;t<=255;)gl[2*t+1]=9,t++,o[9]++;for(;t<=279;)gl[2*t+1]=7,t++,o[7]++;for(;t<=287;)gl[2*t+1]=8,t++,o[8]++;for(HV(gl,287,o),t=0;t<rE;t++)sE[2*t+1]=5,sE[2*t]=GV(t,5);jV=new SI(gl,EI,257,UV,iE),FV=new SI(sE,IT,0,rE,iE),BV=new SI(new Array(0),yY,0,19,7)})(),QV=!0),e.l_desc=new yI(e.dyn_ltree,jV),e.d_desc=new yI(e.dyn_dtree,FV),e.bl_desc=new yI(e.bl_tree,BV),e.bi_buf=0,e.bi_valid=0,KV(e)},CY=(e,t,n,r)=>{let i,s,o=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(c=>{let l,p=4093624447;for(l=0;l<=31;l++,p>>>=1)if(1&p&&c.dyn_ltree[2*l]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(l=32;l<gI;l++)if(c.dyn_ltree[2*l]!==0)return 1;return 0})(e)),CI(e,e.l_desc),CI(e,e.d_desc),o=(c=>{let l;for(XV(c,c.dyn_ltree,c.l_desc.max_code),XV(c,c.dyn_dtree,c.d_desc.max_code),CI(c,c.bl_desc),l=18;l>=3&&c.bl_tree[2*VV[l]+1]===0;l--);return c.opt_len+=3*(l+1)+5+5+4,l})(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&t!==-1?$V(e,t,n,r):e.strategy===4||s===i?(ks(e,2+(r?1:0),3),qV(e,gl,sE)):(ks(e,4+(r?1:0),3),((c,l,p,m)=>{let E;for(ks(c,l-257,5),ks(c,p-1,5),ks(c,m-4,4),E=0;E<m;E++)ks(c,c.bl_tree[2*VV[E]+1],3);JV(c,c.dyn_ltree,l-1),JV(c,c.dyn_dtree,p-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),qV(e,e.dyn_ltree,e.dyn_dtree)),KV(e),r&&zV(e)},wY=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(aE[n]+gI+1)]++,e.dyn_dtree[2*WV(t)]++),e.sym_next===e.sym_end),RY=e=>{ks(e,2,3),bc(e,256,gl),(t=>{t.bi_valid===16?(cE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},bY={_tr_init:TY,_tr_stored_block:$V,_tr_flush_block:CY,_tr_tally:wY,_tr_align:RY},lE=(e,t,n,r)=>{let i=65535&e|0,s=e>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const IY=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Si=(e,t,n,r)=>{const i=IY,s=r+n;e^=-1;for(let o=r;o<s;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Ah={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},OT={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:AY,_tr_stored_block:wI,_tr_flush_block:OY,_tr_tally:xd,_tr_align:NY}=bY,{Z_NO_FLUSH:Md,Z_PARTIAL_FLUSH:PY,Z_FULL_FLUSH:kY,Z_FINISH:Ko,Z_BLOCK:ZV,Z_OK:ki,Z_STREAM_END:e6,Z_STREAM_ERROR:Ic,Z_DATA_ERROR:DY,Z_BUF_ERROR:RI,Z_DEFAULT_COMPRESSION:LY,Z_FILTERED:xY,Z_HUFFMAN_ONLY:NT,Z_RLE:MY,Z_FIXED:UY,Z_DEFAULT_STRATEGY:VY,Z_UNKNOWN:jY,Z_DEFLATED:PT}=OT,bI=286,FY=30,BY=19,WY=2*bI+1,GY=15,Oh=258,Ac=262,Jf=42,Nh=113,dE=666,Ph=(e,t)=>(e.msg=Ah[t],t),t6=e=>2*e-(e>4?9:0),Ud=e=>{let t=e.length;for(;--t>=0;)e[t]=0},HY=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)};let Vd=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ro=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},io=(e,t)=>{OY(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ro(e.strm)},Mn=(e,t)=>{e.pending_buf[e.pending++]=t},uE=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},II=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=lE(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Si(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},n6=(e,t)=>{let n,r,i=e.max_chain_length,s=e.strstart,o=e.prev_length,c=e.nice_match;const l=e.strstart>e.w_size-Ac?e.strstart-(e.w_size-Ac):0,p=e.window,m=e.w_mask,E=e.prev,v=e.strstart+Oh;let y=p[s+o-1],D=p[s+o];e.prev_length>=e.good_match&&(i>>=2),c>e.lookahead&&(c=e.lookahead);do if(n=t,p[n+o]===D&&p[n+o-1]===y&&p[n]===p[s]&&p[++n]===p[s+1]){s+=2,n++;do;while(p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&p[++s]===p[++n]&&s<v);if(r=Oh-(v-s),s=v-Oh,r>o){if(e.match_start=t,o=r,r>=c)break;y=p[s+o-1],D=p[s+o]}}while((t=E[t&m])>l&&--i!=0);return o<=e.lookahead?o:e.lookahead},Qf=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ac)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),HY(e),r+=t),e.strm.avail_in===0)break;if(n=II(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Vd(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Vd(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ac&&e.strm.avail_in!==0)},r6=(e,t)=>{let n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,c=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&t!==Ko||t===Md||n!==r+e.strm.avail_in)))break;o=t===Ko&&n===r+e.strm.avail_in?1:0,wI(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ro(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(II(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(o===0);return c-=e.strm.avail_in,c&&(c>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=c&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-c,e.strm.next_in),e.strstart),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Md&&t!==Ko&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(II(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,s=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=s||(r||t===Ko)&&t!==Md&&e.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,o=t===Ko&&e.strm.avail_in===0&&n===r?1:0,wI(e,e.block_start,n,o),e.block_start+=n,ro(e.strm)),o?3:1)},AI=(e,t)=>{let n,r;for(;;){if(e.lookahead<Ac){if(Qf(e),e.lookahead<Ac&&t===Md)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Ac&&(e.match_length=n6(e,n)),e.match_length>=3)if(r=xd(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+1]);else r=xd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(io(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ko?(io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(io(e,!1),e.strm.avail_out===0)?1:2},$f=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Ac){if(Qf(e),e.lookahead<Ac&&t===Md)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ac&&(e.match_length=n6(e,n),e.match_length<=5&&(e.strategy===xY||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=xd(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Vd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(io(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=xd(e,0,e.window[e.strstart-1]),r&&io(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=xd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ko?(io(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(io(e,!1),e.strm.avail_out===0)?1:2};function Oc(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const hE=[new Oc(0,0,0,0,r6),new Oc(4,4,8,4,AI),new Oc(4,5,16,8,AI),new Oc(4,6,32,32,AI),new Oc(4,4,16,16,$f),new Oc(8,16,32,32,$f),new Oc(8,16,128,128,$f),new Oc(8,32,128,256,$f),new Oc(32,128,258,1024,$f),new Oc(32,258,258,4096,$f)];function KY(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=PT,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*WY),this.dyn_dtree=new Uint16Array(2*(2*FY+1)),this.bl_tree=new Uint16Array(2*(2*BY+1)),Ud(this.dyn_ltree),Ud(this.dyn_dtree),Ud(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(GY+1),this.heap=new Uint16Array(2*bI+1),Ud(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*bI+1),Ud(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const pE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Jf&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Nh&&t.status!==dE?1:0},i6=e=>{if(pE(e))return Ph(e,Ic);e.total_in=e.total_out=0,e.data_type=jY;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Jf:Nh,e.adler=t.wrap===2?0:1,t.last_flush=-2,AY(t),ki},s6=e=>{const t=i6(e);return t===ki&&(n=>{n.window_size=2*n.w_size,Ud(n.head),n.max_lazy_match=hE[n.level].max_lazy,n.good_match=hE[n.level].good_length,n.nice_match=hE[n.level].nice_length,n.max_chain_length=hE[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},o6=(e,t,n,r,i,s)=>{if(!e)return Ic;let o=1;if(t===LY&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==PT||r<8||r>15||t<0||t>9||s<0||s>UY||r===8&&o!==1)return Ph(e,Ic);r===8&&(r=9);const c=new KY;return e.state=c,c.strm=e,c.status=Jf,c.wrap=o,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=t,c.strategy=s,c.method=n,s6(e)};var zY=(e,t)=>{if(pE(e)||t>ZV||t<0)return e?Ph(e,Ic):Ic;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===dE&&t!==Ko)return Ph(e,e.avail_out===0?RI:Ic);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ro(e),e.avail_out===0)return n.last_flush=-1,ki}else if(e.avail_in===0&&t6(t)<=t6(r)&&t!==Ko)return Ph(e,RI);if(n.status===dE&&e.avail_in!==0)return Ph(e,RI);if(n.status===Jf&&n.wrap===0&&(n.status=Nh),n.status===Jf){let i=PT+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=NT||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,uE(n,i),n.strstart!==0&&(uE(n,e.adler>>>16),uE(n,65535&e.adler)),e.adler=1,n.status=Nh,ro(e),n.pending!==0)return n.last_flush=-1,ki}if(n.status===57){if(e.adler=0,Mn(n,31),Mn(n,139),Mn(n,8),n.gzhead)Mn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Mn(n,255&n.gzhead.time),Mn(n,n.gzhead.time>>8&255),Mn(n,n.gzhead.time>>16&255),Mn(n,n.gzhead.time>>24&255),Mn(n,n.level===9?2:n.strategy>=NT||n.level<2?4:0),Mn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Mn(n,255&n.gzhead.extra.length),Mn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Si(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,0),Mn(n,n.level===9?2:n.strategy>=NT||n.level<2?4:0),Mn(n,3),n.status=Nh,ro(e),n.pending!==0)return n.last_flush=-1,ki}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let c=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=Si(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=c,ro(e),n.pending!==0)return n.last_flush=-1,ki;i=0,s-=c}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(e.adler=Si(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s)),ro(e),n.pending!==0)return n.last_flush=-1,ki;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Mn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s)),ro(e),n.pending!==0)return n.last_flush=-1,ki;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Mn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(e.adler=Si(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ro(e),n.pending!==0))return n.last_flush=-1,ki;Mn(n,255&e.adler),Mn(n,e.adler>>8&255),e.adler=0}if(n.status=Nh,ro(e),n.pending!==0)return n.last_flush=-1,ki}if(e.avail_in!==0||n.lookahead!==0||t!==Md&&n.status!==dE){let i=n.level===0?r6(n,t):n.strategy===NT?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(Qf(s),s.lookahead===0)){if(o===Md)return 1;break}if(s.match_length=0,c=xd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Ko?(io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(io(s,!1),s.strm.avail_out===0)?1:2})(n,t):n.strategy===MY?((s,o)=>{let c,l,p,m;const E=s.window;for(;;){if(s.lookahead<=Oh){if(Qf(s),s.lookahead<=Oh&&o===Md)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(p=s.strstart-1,l=E[p],l===E[++p]&&l===E[++p]&&l===E[++p])){m=s.strstart+Oh;do;while(l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&l===E[++p]&&p<m);s.match_length=Oh-(m-p),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=xd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=xd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(io(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Ko?(io(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(io(s,!1),s.strm.avail_out===0)?1:2})(n,t):hE[n.level].func(n,t);if(i!==3&&i!==4||(n.status=dE),i===1||i===3)return e.avail_out===0&&(n.last_flush=-1),ki;if(i===2&&(t===PY?NY(n):t!==ZV&&(wI(n,0,0,!1),t===kY&&(Ud(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ro(e),e.avail_out===0))return n.last_flush=-1,ki}return t!==Ko?ki:n.wrap<=0?e6:(n.wrap===2?(Mn(n,255&e.adler),Mn(n,e.adler>>8&255),Mn(n,e.adler>>16&255),Mn(n,e.adler>>24&255),Mn(n,255&e.total_in),Mn(n,e.total_in>>8&255),Mn(n,e.total_in>>16&255),Mn(n,e.total_in>>24&255)):(uE(n,e.adler>>>16),uE(n,65535&e.adler)),ro(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?ki:e6)},YY=(e,t)=>{let n=t.length;if(pE(e))return Ic;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==Jf||r.lookahead)return Ic;if(i===1&&(e.adler=lE(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Ud(r.head),r.strstart=0,r.block_start=0,r.insert=0);let l=new Uint8Array(r.w_size);l.set(t.subarray(n-r.w_size,n),0),t=l,n=r.w_size}const s=e.avail_in,o=e.next_in,c=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Qf(r);r.lookahead>=3;){let l=r.strstart,p=r.lookahead-2;do r.ins_h=Vd(r,r.ins_h,r.window[l+3-1]),r.prev[l&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=l,l++;while(--p);r.strstart=l,r.lookahead=2,Qf(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=c,e.avail_in=s,r.wrap=i,ki},fE={deflateInit:(e,t)=>o6(e,t,PT,15,8,VY),deflateInit2:o6,deflateReset:s6,deflateResetKeep:i6,deflateSetHeader:(e,t)=>pE(e)||e.state.wrap!==2?Ic:(e.state.gzhead=t,ki),deflate:zY,deflateEnd:e=>{if(pE(e))return Ic;const t=e.state.status;return e.state=null,t===Nh?Ph(e,DY):ki},deflateSetDictionary:YY,deflateInfo:"pako deflate (from Nodeca project)"};const qY=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var kT={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)qY(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,s=e.length;r<s;r++){let o=e[r];n.set(o,i),i+=o.length}return n}};let a6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a6=!1}const mE=new Uint8Array(256);for(let e=0;e<256;e++)mE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;mE[254]=mE[254]=1;var _E={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,s,o=e.length,c=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),c+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(c),s=0,i=0;s<c;i++)n=e.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let o=e[r++];if(o<128){s[i++]=o;continue}let c=mE[o];if(c>4)s[i++]=65533,r+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&r<n;)o=o<<6|63&e[r++],c--;c>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&a6)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let l="";for(let p=0;p<c;p++)l+=String.fromCharCode(o[p]);return l})(s,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+mE[e[n]]>t?n:t}},c6=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const l6=Object.prototype.toString,{Z_NO_FLUSH:XY,Z_SYNC_FLUSH:JY,Z_FULL_FLUSH:QY,Z_FINISH:$Y,Z_OK:DT,Z_STREAM_END:ZY,Z_DEFAULT_COMPRESSION:eq,Z_DEFAULT_STRATEGY:tq,Z_DEFLATED:nq}=OT;function LT(e){this.options=kT.assign({level:eq,method:nq,chunkSize:16384,windowBits:15,memLevel:8,strategy:tq},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c6,this.strm.avail_out=0;let n=fE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==DT)throw new Error(Ah[n]);if(t.header&&fE.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?_E.string2buf(t.dictionary):l6.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=fE.deflateSetDictionary(this.strm,r),n!==DT)throw new Error(Ah[n]);this._dict_set=!0}}function rq(e,t){const n=new LT(t);if(n.push(e,!0),n.err)throw n.msg||Ah[n.err];return n.result}LT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?$Y:XY,typeof e=="string"?n.input=_E.string2buf(e):l6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===JY||s===QY)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=fE.deflate(n,s),i===ZY)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=fE.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===DT;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},LT.prototype.onData=function(e){this.chunks.push(e)},LT.prototype.onEnd=function(e){e===DT&&(this.result=kT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var iq={deflate:rq};const xT=16209;var sq=function(e,t){let n,r,i,s,o,c,l,p,m,E,v,y,D,A,P,j,V,G,Z,Q,z,ie,fe,ve;const we=e.state;n=e.next_in,fe=e.input,r=n+(e.avail_in-5),i=e.next_out,ve=e.output,s=i-(t-e.avail_out),o=i+(e.avail_out-257),c=we.dmax,l=we.wsize,p=we.whave,m=we.wnext,E=we.window,v=we.hold,y=we.bits,D=we.lencode,A=we.distcode,P=(1<<we.lenbits)-1,j=(1<<we.distbits)-1;e:do{y<15&&(v+=fe[n++]<<y,y+=8,v+=fe[n++]<<y,y+=8),V=D[v&P];t:for(;;){if(G=V>>>24,v>>>=G,y-=G,G=V>>>16&255,G===0)ve[i++]=65535&V;else{if(!(16&G)){if((64&G)==0){V=D[(65535&V)+(v&(1<<G)-1)];continue t}if(32&G){we.mode=16191;break e}e.msg="invalid literal/length code",we.mode=xT;break e}Z=65535&V,G&=15,G&&(y<G&&(v+=fe[n++]<<y,y+=8),Z+=v&(1<<G)-1,v>>>=G,y-=G),y<15&&(v+=fe[n++]<<y,y+=8,v+=fe[n++]<<y,y+=8),V=A[v&j];n:for(;;){if(G=V>>>24,v>>>=G,y-=G,G=V>>>16&255,!(16&G)){if((64&G)==0){V=A[(65535&V)+(v&(1<<G)-1)];continue n}e.msg="invalid distance code",we.mode=xT;break e}if(Q=65535&V,G&=15,y<G&&(v+=fe[n++]<<y,y+=8,y<G&&(v+=fe[n++]<<y,y+=8)),Q+=v&(1<<G)-1,Q>c){e.msg="invalid distance too far back",we.mode=xT;break e}if(v>>>=G,y-=G,G=i-s,Q>G){if(G=Q-G,G>p&&we.sane){e.msg="invalid distance too far back",we.mode=xT;break e}if(z=0,ie=E,m===0){if(z+=l-G,G<Z){Z-=G;do ve[i++]=E[z++];while(--G);z=i-Q,ie=ve}}else if(m<G){if(z+=l+m-G,G-=m,G<Z){Z-=G;do ve[i++]=E[z++];while(--G);if(z=0,m<Z){G=m,Z-=G;do ve[i++]=E[z++];while(--G);z=i-Q,ie=ve}}}else if(z+=m-G,G<Z){Z-=G;do ve[i++]=E[z++];while(--G);z=i-Q,ie=ve}for(;Z>2;)ve[i++]=ie[z++],ve[i++]=ie[z++],ve[i++]=ie[z++],Z-=3;Z&&(ve[i++]=ie[z++],Z>1&&(ve[i++]=ie[z++]))}else{z=i-Q;do ve[i++]=ve[z++],ve[i++]=ve[z++],ve[i++]=ve[z++],Z-=3;while(Z>2);Z&&(ve[i++]=ve[z++],Z>1&&(ve[i++]=ve[z++]))}break}}break}}while(n<r&&i<o);Z=y>>3,n-=Z,y-=Z<<3,v&=(1<<y)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),we.hold=v,we.bits=y};const MT=15,oq=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),aq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),cq=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),lq=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var gE=(e,t,n,r,i,s,o,c)=>{const l=c.bits;let p,m,E,v,y,D,A=0,P=0,j=0,V=0,G=0,Z=0,Q=0,z=0,ie=0,fe=0,ve=null;const we=new Uint16Array(16),Ct=new Uint16Array(16);let bt,ut,Yt,Ht=null;for(A=0;A<=MT;A++)we[A]=0;for(P=0;P<r;P++)we[t[n+P]]++;for(G=l,V=MT;V>=1&&we[V]===0;V--);if(G>V&&(G=V),V===0)return i[s++]=20971520,i[s++]=20971520,c.bits=1,0;for(j=1;j<V&&we[j]===0;j++);for(G<j&&(G=j),z=1,A=1;A<=MT;A++)if(z<<=1,z-=we[A],z<0)return-1;if(z>0&&(e===0||V!==1))return-1;for(Ct[1]=0,A=1;A<MT;A++)Ct[A+1]=Ct[A]+we[A];for(P=0;P<r;P++)t[n+P]!==0&&(o[Ct[t[n+P]]++]=P);if(e===0?(ve=Ht=o,D=20):e===1?(ve=oq,Ht=aq,D=257):(ve=cq,Ht=lq,D=0),fe=0,P=0,A=j,y=s,Z=G,Q=0,E=-1,ie=1<<G,v=ie-1,e===1&&ie>852||e===2&&ie>592)return 1;for(;;){bt=A-Q,o[P]+1<D?(ut=0,Yt=o[P]):o[P]>=D?(ut=Ht[o[P]-D],Yt=ve[o[P]-D]):(ut=96,Yt=0),p=1<<A-Q,m=1<<Z,j=m;do m-=p,i[y+(fe>>Q)+m]=bt<<24|ut<<16|Yt|0;while(m!==0);for(p=1<<A-1;fe&p;)p>>=1;if(p!==0?(fe&=p-1,fe+=p):fe=0,P++,--we[A]==0){if(A===V)break;A=t[n+o[P]]}if(A>G&&(fe&v)!==E){for(Q===0&&(Q=G),y+=j,Z=A-Q,z=1<<Z;Z+Q<V&&(z-=we[Z+Q],!(z<=0));)Z++,z<<=1;if(ie+=1<<Z,e===1&&ie>852||e===2&&ie>592)return 1;E=fe&v,i[E]=G<<24|Z<<16|y-s|0}}return fe!==0&&(i[y+fe]=A-Q<<24|64<<16|0),c.bits=G,0};const{Z_FINISH:d6,Z_BLOCK:dq,Z_TREES:UT,Z_OK:kh,Z_STREAM_END:uq,Z_NEED_DICT:hq,Z_STREAM_ERROR:zo,Z_DATA_ERROR:u6,Z_MEM_ERROR:h6,Z_BUF_ERROR:pq,Z_DEFLATED:p6}=OT,VT=16180,jT=16190,El=16191,OI=16192,NI=16194,FT=16199,BT=16200,PI=16206,vr=16209,f6=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function fq(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Dh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<VT||t.mode>16211?1:0},m6=e=>{if(Dh(e))return zo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=VT,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,kh},_6=e=>{if(Dh(e))return zo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,m6(e)},g6=(e,t)=>{let n;if(Dh(e))return zo;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?zo:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,_6(e))},E6=(e,t)=>{if(!e)return zo;const n=new fq;e.state=n,n.strm=e,n.window=null,n.mode=VT;const r=g6(e,t);return r!==kh&&(e.state=null),r};let kI,DI,v6=!0;const mq=e=>{if(v6){kI=new Int32Array(512),DI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(gE(1,e.lens,0,288,kI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;gE(2,e.lens,0,32,DI,0,e.work,{bits:5}),v6=!1}e.lencode=kI,e.lenbits=9,e.distcode=DI,e.distbits=5},S6=(e,t,n,r)=>{let i;const s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var _q=(e,t)=>{let n,r,i,s,o,c,l,p,m,E,v,y,D,A,P,j,V,G,Z,Q,z,ie,fe=0;const ve=new Uint8Array(4);let we,Ct;const bt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Dh(e)||!e.output||!e.input&&e.avail_in!==0)return zo;n=e.state,n.mode===El&&(n.mode=OI),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,p=n.hold,m=n.bits,E=c,v=l,ie=kh;e:for(;;)switch(n.mode){case VT:if(n.wrap===0){n.mode=OI;break}for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0),p=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){e.msg="incorrect header check",n.mode=vr;break}if((15&p)!==p6){e.msg="unknown compression method",n.mode=vr;break}if(p>>>=4,m-=4,z=8+(15&p),n.wbits===0&&(n.wbits=z),z>15||z>n.wbits){e.msg="invalid window size",n.mode=vr;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&p?16189:El,p=0,m=0;break;case 16181:for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(n.flags=p,(255&oi(n))!==p6){e.msg="unknown compression method",n.mode=vr;break}if(57344&oi(n)){e.msg="unknown header flags set",n.mode=vr;break}n.head&&(n.head.text=p>>8&1),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0)),p=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.head&&(n.head.time=p),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,ve[2]=p>>>16&255,ve[3]=p>>>24&255,n.check=Si(n.check,ve,4,0)),p=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0)),p=0,m=0,n.mode=16184;case 16184:if(1024&oi(n)){for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.length=p,n.head&&(n.head.extra_len=p),512&oi(n)&&4&n.wrap&&(ve[0]=255&p,ve[1]=p>>>8&255,n.check=Si(n.check,ve,2,0)),p=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&oi(n)&&(y=n.length,y>c&&(y=c),y&&(n.head&&(z=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+y),z)),512&oi(n)&&4&n.wrap&&(n.check=Si(n.check,r,y,s)),c-=y,s+=y,n.length-=y),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&oi(n)){if(c===0)break e;y=0;do z=r[s+y++],n.head&&z&&n.length<65536&&(n.head.name+=String.fromCharCode(z));while(z&&y<c);if(512&oi(n)&&4&n.wrap&&(n.check=Si(n.check,r,y,s)),c-=y,s+=y,z)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&oi(n)){if(c===0)break e;y=0;do z=r[s+y++],n.head&&z&&n.length<65536&&(n.head.comment+=String.fromCharCode(z));while(z&&y<c);if(512&oi(n)&&4&n.wrap&&(n.check=Si(n.check,r,y,s)),c-=y,s+=y,z)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&oi(n)){for(;m<16;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(4&n.wrap&&p!==(65535&n.check)){e.msg="header crc mismatch",n.mode=vr;break}p=0,m=0}n.head&&(n.head.hcrc=oi(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=El;break;case 16189:for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}e.adler=n.check=f6(p),p=0,m=0,n.mode=jT;case jT:if(n.havedict===0)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,hq;e.adler=n.check=1,n.mode=El;case El:if(t===dq||t===UT)break e;case OI:if(n.last){p>>>=7&m,m-=7&m,n.mode=PI;break}for(;m<3;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}switch(n.last=1&p,p>>>=1,m-=1,3&p){case 0:n.mode=16193;break;case 1:if(mq(n),n.mode=FT,t===UT){p>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=vr}p>>>=2,m-=2;break;case 16193:for(p>>>=7&m,m-=7&m;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if((65535&p)!=(p>>>16^65535)){e.msg="invalid stored block lengths",n.mode=vr;break}if(n.length=65535&p,p=0,m=0,n.mode=NI,t===UT)break e;case NI:n.mode=16195;case 16195:if(y=n.length,y){if(y>c&&(y=c),y>l&&(y=l),y===0)break e;i.set(r.subarray(s,s+y),o),c-=y,s+=y,l-=y,o+=y,n.length-=y;break}n.mode=El;break;case 16196:for(;m<14;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(n.nlen=257+(31&p),p>>>=5,m-=5,n.ndist=1+(31&p),p>>>=5,m-=5,n.ncode=4+(15&p),p>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=vr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.lens[bt[n.have++]]=7&p,p>>>=3,m-=3}for(;n.have<19;)n.lens[bt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,we={bits:n.lenbits},ie=gE(0,n.lens,0,19,n.lencode,0,n.work,we),n.lenbits=we.bits,ie){e.msg="invalid code lengths set",n.mode=vr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;fe=n.lencode[p&(1<<n.lenbits)-1],P=fe>>>24,j=fe>>>16&255,V=65535&fe,!(P<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(V<16)p>>>=P,m-=P,n.lens[n.have++]=V;else{if(V===16){for(Ct=P+2;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(p>>>=P,m-=P,n.have===0){e.msg="invalid bit length repeat",n.mode=vr;break}z=n.lens[n.have-1],y=3+(3&p),p>>>=2,m-=2}else if(V===17){for(Ct=P+3;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=P,m-=P,z=0,y=3+(7&p),p>>>=3,m-=3}else{for(Ct=P+7;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=P,m-=P,z=0,y=11+(127&p),p>>>=7,m-=7}if(n.have+y>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=vr;break}for(;y--;)n.lens[n.have++]=z}}if(n.mode===vr)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=vr;break}if(n.lenbits=9,we={bits:n.lenbits},ie=gE(1,n.lens,0,n.nlen,n.lencode,0,n.work,we),n.lenbits=we.bits,ie){e.msg="invalid literal/lengths set",n.mode=vr;break}if(n.distbits=6,n.distcode=n.distdyn,we={bits:n.distbits},ie=gE(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,we),n.distbits=we.bits,ie){e.msg="invalid distances set",n.mode=vr;break}if(n.mode=FT,t===UT)break e;case FT:n.mode=BT;case BT:if(c>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,sq(e,v),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,r=e.input,c=e.avail_in,p=n.hold,m=n.bits,n.mode===El&&(n.back=-1);break}for(n.back=0;fe=n.lencode[p&(1<<n.lenbits)-1],P=fe>>>24,j=fe>>>16&255,V=65535&fe,!(P<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(j&&(240&j)==0){for(G=P,Z=j,Q=V;fe=n.lencode[Q+((p&(1<<G+Z)-1)>>G)],P=fe>>>24,j=fe>>>16&255,V=65535&fe,!(G+P<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=P,m-=P,n.back+=P,n.length=V,j===0){n.mode=16205;break}if(32&j){n.back=-1,n.mode=El;break}if(64&j){e.msg="invalid literal/length code",n.mode=vr;break}n.extra=15&j,n.mode=16201;case 16201:if(n.extra){for(Ct=n.extra;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;fe=n.distcode[p&(1<<n.distbits)-1],P=fe>>>24,j=fe>>>16&255,V=65535&fe,!(P<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if((240&j)==0){for(G=P,Z=j,Q=V;fe=n.distcode[Q+((p&(1<<G+Z)-1)>>G)],P=fe>>>24,j=fe>>>16&255,V=65535&fe,!(G+P<=m);){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}p>>>=G,m-=G,n.back+=G}if(p>>>=P,m-=P,n.back+=P,64&j){e.msg="invalid distance code",n.mode=vr;break}n.offset=V,n.extra=15&j,n.mode=16203;case 16203:if(n.extra){for(Ct=n.extra;m<Ct;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=vr;break}n.mode=16204;case 16204:if(l===0)break e;if(y=v-l,n.offset>y){if(y=n.offset-y,y>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=vr;break}y>n.wnext?(y-=n.wnext,D=n.wsize-y):D=n.wnext-y,y>n.length&&(y=n.length),A=n.window}else A=i,D=o-n.offset,y=n.length;y>l&&(y=l),l-=y,n.length-=y;do i[o++]=A[D++];while(--y);n.length===0&&(n.mode=BT);break;case 16205:if(l===0)break e;i[o++]=n.length,l--,n.mode=BT;break;case PI:if(n.wrap){for(;m<32;){if(c===0)break e;c--,p|=r[s++]<<m,m+=8}if(v-=l,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=oi(n)?Si(n.check,i,v,o-v):lE(n.check,i,v,o-v)),v=l,4&n.wrap&&(oi(n)?p:f6(p))!==n.check){e.msg="incorrect data check",n.mode=vr;break}p=0,m=0}n.mode=16207;case 16207:if(n.wrap&&oi(n)){for(;m<32;){if(c===0)break e;c--,p+=r[s++]<<m,m+=8}if(4&n.wrap&&p!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=vr;break}p=0,m=0}n.mode=16208;case 16208:ie=uq;break e;case vr:ie=u6;break e;case 16210:return h6;default:return zo}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=c,n.hold=p,n.bits=m,(n.wsize||v!==e.avail_out&&n.mode<vr&&(n.mode<PI||t!==d6))&&S6(e,e.output,e.next_out,v-e.avail_out),E-=e.avail_in,v-=e.avail_out,e.total_in+=E,e.total_out+=v,n.total+=v,4&n.wrap&&v&&(e.adler=n.check=oi(n)?Si(n.check,i,v,e.next_out-v):lE(n.check,i,v,e.next_out-v)),e.data_type=n.bits+(n.last?64:0)+(n.mode===El?128:0)+(n.mode===FT||n.mode===NI?256:0),(E===0&&v===0||t===d6)&&ie===kh&&(ie=pq),ie},vl={inflateReset:_6,inflateReset2:g6,inflateResetKeep:m6,inflateInit:e=>E6(e,15),inflateInit2:E6,inflate:_q,inflateEnd:e=>{if(Dh(e))return zo;let t=e.state;return t.window&&(t.window=null),e.state=null,kh},inflateGetHeader:(e,t)=>{if(Dh(e))return zo;const n=e.state;return(2&n.wrap)==0?zo:(n.head=t,t.done=!1,kh)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,s;return Dh(e)?zo:(r=e.state,r.wrap!==0&&r.mode!==jT?zo:r.mode===jT&&(i=1,i=lE(i,t,n,0),i!==r.check)?u6:(s=S6(e,t,n,n),s?(r.mode=16210,h6):(r.havedict=1,kh)))},inflateInfo:"pako inflate (from Nodeca project)"},gq=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const y6=Object.prototype.toString,{Z_NO_FLUSH:Eq,Z_FINISH:vq,Z_OK:EE,Z_STREAM_END:LI,Z_NEED_DICT:xI,Z_STREAM_ERROR:Sq,Z_DATA_ERROR:T6,Z_MEM_ERROR:yq}=OT;function WT(e){this.options=kT.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c6,this.strm.avail_out=0;let n=vl.inflateInit2(this.strm,t.windowBits);if(n!==EE)throw new Error(Ah[n]);if(this.header=new gq,vl.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=_E.string2buf(t.dictionary):y6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=vl.inflateSetDictionary(this.strm,t.dictionary),n!==EE)))throw new Error(Ah[n])}function Tq(e,t){const n=new WT(t);if(n.push(e),n.err)throw n.msg||Ah[n.err];return n.result}WT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,c;if(this.ended)return!1;for(o=t===~~t?t:t===!0?vq:Eq,y6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=vl.inflate(n,o),s===xI&&i&&(s=vl.inflateSetDictionary(n,i),s===EE?s=vl.inflate(n,o):s===T6&&(s=xI));n.avail_in>0&&s===LI&&n.state.wrap>0&&e[n.next_in]!==0;)vl.inflateReset(n),s=vl.inflate(n,o);switch(s){case Sq:case T6:case xI:case yq:return this.onEnd(s),this.ended=!0,!1}if(c=n.avail_out,n.next_out&&(n.avail_out===0||s===LI))if(this.options.to==="string"){let l=_E.utf8border(n.output,n.next_out),p=n.next_out-l,m=_E.buf2string(n.output,l);n.next_out=p,n.avail_out=r-p,p&&n.output.set(n.output.subarray(l,l+p),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==EE||c!==0){if(s===LI)return s=vl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},WT.prototype.onData=function(e){this.chunks.push(e)},WT.prototype.onEnd=function(e){e===EE&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=kT.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Cq={inflate:Tq};const{deflate:wq}=iq,{inflate:Rq}=Cq;var bq=wq,Iq=Rq,C6=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(C6||{});class Aq{constructor(){M(this,"_sequence",0),M(this,"_startTime",Date.now()),M(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const c=new Uint8Array(4);c.set([1,0,0,0]);const l={id:0,length:4,data:c.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[l]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;W("SHOW_DATASTREAM2_LOG")&&w.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const c=this.serializeExtension(n.extension);i.set(new Uint8Array(c),o),o+=c.byteLength}if(i.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let o,c;if(r+=4,W("SHOW_DATASTREAM2_LOG")&&w.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){c=this.deserializeExtension(t.slice(r)),r+=2+c.length,o=t.slice(r);let l=!1;if(c.datas.length>0){const p=c.datas.find(m=>m.id===0);p&&(l=(1&new DataView(p.data).getUint32(0,!0))==1)}o=l?this.decompress(o):o}else o=t.slice(8);return o}serializeExtension(t){const{profile:n,length:r,datas:i}=t,s=new ArrayBuffer(r+2),o=new Uint8Array(s),c=new DataView(s);let l=0;if(c.setUint8(l++,n),c.setUint8(l++,r),i.forEach(p=>{n?(c.setUint8(l++,p.id),c.setUint8(l++,p.length),o.set(new Uint8Array(p.data),l),l+=p.data.byteLength):(c.setUint8(l++,p.id|p.length<<4),o.set(new Uint8Array(p.data),l),l+=p.data.byteLength)}),l!==r+2)throw Error("serialize extension error, is ".concat(l,"!==").concat(r+2));return s}deserializeExtension(t){const n=new DataView(t);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const o=i===C6.TWO_BYTE,c=[],l=new DataView(t,2);let p=0;for(;p<s;){let m=0,E=0,v=new ArrayBuffer(0);o?(m=l.getUint8(p),p++,E=l.getUint8(p),p++):(m=15&l.getUint8(p),E=l.getUint8(p)>>4,p++),E>0&&(v=l.buffer.slice(p+2,p+2+E),p+=v.byteLength),c.push({id:m,length:E,data:v})}if(p!==s)throw Error("parse error");return{profile:i,length:s,datas:c}}decompress(t){return Iq(new Uint8Array(t))}compress(t){return bq(new Uint8Array(t))}}const Oq={name:"DataStream",create:(e,t)=>{const n=t?new UK(e):new VK(e);return n.useDataStream(new Aq),n}};class Nq extends bn{constructor(t,n,r){super(),M(this,"ws",void 0),M(this,"requestId",1),M(this,"heartBeatTimer",void 0),M(this,"joinInfo",void 0),M(this,"clientId",void 0),M(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),M(this,"onClose",i=>{this.emit("close"),this.dispose()}),M(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=t,this.clientId=n,this.ws=new Hg("cross-channel-".concat(this.clientId),r),this.ws.on(vt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(vt.CONNECTED,this.onOpen),this.ws.on(vt.ON_MESSAGE,this.onMessage),this.ws.on(vt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new je((n,r)=>{const i=window.setTimeout(()=>{r(new ae(F.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new ae(F.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new ae(F.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ae(F.WS_DISCONNECT);const n=()=>new je((o,c)=>{this.ws.once(vt.CLOSED,()=>c(new ae(F.WS_ABORT))),this.ws.once(vt.CONNECTED,o)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),i=new je((o,c)=>{const l=()=>{c(new ae(F.WS_ABORT))};this.ws.once(vt.RECONNECTING,l),this.ws.once(vt.CLOSED,l),this.once("req_".concat(r),o),Rr(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(vt.RECONNECTING,l),this.ws.off(vt.CLOSED,l),c(new ae(F.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new ae(F.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(t){this.ws.removeAllListeners(vt.REQUEST_NEW_URLS),this.ws.on(vt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Pq extends bn{set state(t){t!==this._state&&(t!==Ki.RELAY_STATE_FAILURE&&(this.errorCode=Mf.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,i,s){super(),M(this,"joinInfo",void 0),M(this,"sid",void 0),M(this,"clientId",void 0),M(this,"cancelToken",Ai.CancelToken.source()),M(this,"workerToken",void 0),M(this,"requestId",0),M(this,"signal",void 0),M(this,"prevChannelMediaConfig",void 0),M(this,"httpRetryConfig",void 0),M(this,"_resolution",void 0),M(this,"_state",Ki.RELAY_STATE_IDLE),M(this,"errorCode",Mf.RELAY_OK),M(this,"onStatus",o=>{w.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",pl.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",pl.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Mf.SRC_TOKEN_EXPIRED,this.state=Ki.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Mf.DEST_TOKEN_EXPIRED,this.state=Ki.RELAY_STATE_FAILURE))}),M(this,"onReconnect",async()=>{w.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",pl.NETWORK_DISCONNECTED),this.state=Ki.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==Ki.RELAY_STATE_IDLE&&(w.error("auto restart channel media relay failed",o.toString()),this.errorCode=Mf.SERVER_CONNECTION_LOST,this.state=Ki.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=fh(),this.signal=new Nq(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(t){if(this.state!==Ki.RELAY_STATE_IDLE)throw new ae(F.INVALID_OPERATION);this.state=Ki.RELAY_STATE_CONNECTING,await this.connect(),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new ae(F.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new ae(F.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new ae(F.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ki.RELAY_STATE_RUNNING)throw new ae(F.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ki.RELAY_STATE_RUNNING)throw new ae(F.INVALID_OPERATION);const n=this.genMessage(vi.SetVideoProfile);await this.signal.request(n),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),w.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ki.RELAY_STATE_IDLE,this.dispose()}dispose(){w.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ai.CancelToken.source(),this.state=Ki.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Gz(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",pl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(vi.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(vi.SetSdkProfile,t);await this.signal.request(r),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(vi.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",pl.PACKET_JOINED_SRC_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(vi.SetSourceUserId,t);await this.signal.request(s),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(vi.SetDestChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",pl.PACKET_JOINED_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=this.genMessage(vi.StartPacketTransfer,t);await this.signal.request(c),this.emit("event",pl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ki.RELAY_STATE_RUNNING,w.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(vi.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",pl.PACKET_UPDATE_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(vi.StopPacketTransfer);await this.signal.request(t),w.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Qs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.24.0"&&(o.sdkVersion="0.0.1");let c=null,l=null;switch(t){case vi.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case vi.SetSourceChannel:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new ae(F.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:l.channelName,token:l.token||this.joinInfo.appId},o;case vi.SetSourceUserId:if(l=n&&n.getSrcChannelMediaInfo(),!l)throw new ae(F.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:l.uid+""},o;case vi.SetDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new ae(F.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},o;case vi.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case vi.Reconnect:return o.clientRequest={command:"Reconnect"},o;case vi.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case vi.UpdateDestChannel:if(c=n&&n.getDestChannelMediaInfo(),!c)throw new ae(F.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(p=>{r.push(p.channelName),i.push(p.uid+""),s.push(p.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},o;case vi.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const kq={name:"ChannelMediaRelay",create:function(e){return new Pq(e.joinInfo,e.clientId,e.websocketRetryConfig||qn,e.httpRetryConfig||qn,e.resolution)}};function w6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function vE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w6(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Dq extends bn{constructor(t,n,r,i){super(),M(this,"spec",void 0),M(this,"token",void 0),M(this,"websocket",void 0),M(this,"pingpongTimer",void 0),M(this,"reconnectMode","retry"),M(this,"serviceMode",void 0),M(this,"reqId",0),M(this,"commandReqId",0),M(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),M(this,"handleWebSocketMessage",s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(Xe.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===hl.TRANSCODE?1:2}),this.emit(Cd.PUBLISH_STREAM_STATUS,o))}),this.spec=n,this.token=t,this.serviceMode=i,this.websocket=new Hg("live-streaming",r),this.websocket.on(vt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(vt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(vt.REQUEST_NEW_URLS,(s,o)=>{Dr(this,Cd.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on(vt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new ae(F.UNEXPECTED_ERROR);const c=vE({command:t,sdkVersion:Qs==="4.24.0"?"0.0.1":Qs,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new ae(F.WS_DISCONNECT);const l=()=>new je((v,y)=>{this.websocket.once(vt.CLOSED,()=>y(new ae(F.WS_ABORT))),this.websocket.once(vt.CONNECTED,v)});this.websocket.state!=="connected"&&await l(),c.clientRequest&&(c.clientRequest.workerToken=this.token);const p=new je((v,y)=>{const D=()=>{y(new ae(F.WS_ABORT))};this.websocket.once(vt.RECONNECTING,D),this.websocket.once(vt.CLOSED,D),this.once("@".concat(o,"-").concat(this.spec.sid),A=>{v(A)})});i&&Xe.workerEvent(this.spec.sid,vE(vE({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(c);let E=null;try{E=await p}catch(v){if(this.websocket.state==="closed")throw v;return await l(),await this.request(t,n,r)}return i&&Xe.workerEvent(this.spec.sid,vE(vE({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-m})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Qs==="4.24.0"?"0.0.1":Qs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case er.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void w.warning("live stream response already exists stream");case er.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case er.LIVE_STREAM_RESPONSE_BAD_STREAM:case er.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ae(F.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case er.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ae(F.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new ae(F.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new ae(F.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case er.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ae(F.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new ae(F.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Cd.WARNING,n,t.serverResponse.url)}case er.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case er.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case er.LIVE_STREAM_RESPONSE_WORKER_LOST:case er.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case er.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ae(F.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Iy)},6e3)}}function R6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function zi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R6(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Lq extends bn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qn;super(),M(this,"onLiveStreamWarning",void 0),M(this,"onLiveStreamError",void 0),M(this,"spec",void 0),M(this,"retryTimeout",1e4),M(this,"connection",void 0),M(this,"httpRetryConfig",void 0),M(this,"wsRetryConfig",void 0),M(this,"streamingTasks",new Map),M(this,"isStartingStreamingTask",!1),M(this,"taskMutex",new Fr("live-streaming")),M(this,"cancelToken",Ai.CancelToken.source()),M(this,"transcodingConfig",void 0),M(this,"uapResponse",void 0),M(this,"lastTaskId",1),M(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=zi(zi({},yz),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(w.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(o=>zi(zi(zi({},Sz),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){Pn(o.width)||nn(o.width,"config.width",0,1e4),Pn(o.height)||nn(o.height,"config.height",0,1e4),Pn(o.videoBitrate)||nn(o.videoBitrate,"config.videoBitrate",1,1e6),Pn(o.videoFrameRate)||nn(o.videoFrameRate,"config.videoFrameRate"),Pn(o.lowLatency)||Ea(o.lowLatency,"config.lowLatency"),Pn(o.audioSampleRate)||ir(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Pn(o.audioBitrate)||nn(o.audioBitrate,"config.audioBitrate",1,128),Pn(o.audioChannels)||ir(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Pn(o.videoGop)||nn(o.videoGop,"config.videoGop"),Pn(o.videoCodecProfile)||ir(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Pn(o.userCount)||nn(o.userCount,"config.userCount",0,17),Pn(o.backgroundColor)||nn(o.backgroundColor,"config.backgroundColor",0,16777215),Pn(o.userConfigExtraInfo)||wr(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Pn(o.transcodingUsers)&&(ul(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((c,l)=>{Qy(c.uid),Pn(c.x)||nn(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),Pn(c.y)||nn(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),Pn(c.width)||nn(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),Pn(c.height)||nn(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),Pn(c.zOrder)||nn(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),Pn(c.alpha)||nn(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),Pn(o.watermark)||Lb(o.watermark,"watermark"),Pn(o.backgroundImage)||Lb(o.backgroundImage,"backgroundImage"),o.images&&!Pn(o.images)&&(ul(o.images,"config.images"),o.images.forEach((c,l)=>{Lb(c,"images[".concat(l,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(o=>zi(zi(zi({},Db),o),{},{zOrder:255}))),n.backgroundImage&&(r.push(zi(zi(zi({},Db),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(zi(zi(zi({},Db),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(o=>zi({},o)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(o=>typeof o.uid=="number"?je.resolve(o.uid):JU(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await je.all(i)).forEach((o,c)=>{n.userConfigs&&n.userConfigs[c]&&(n.userConfigs[c].uid=o)}),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(rs(s=this.streamingTasks).call(s)).map(c=>c.taskId).join("#")});w.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{w.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then(()=>{w.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(l=>{w.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)})})}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===hl.TRANSCODE)throw new ae(F.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};w.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(t)&&!r)return s(),new ae(F.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(c){throw s(),c}switch(n){case hl.TRANSCODE:i.transcodingConfig=zi({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const c=new je((p,m)=>{Rr(this.retryTimeout).then(()=>{if(r)return m(r);const E=this.statusError.get(t);return E?(this.statusError.delete(t),m(E)):void 0})}),l=await je.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:n===hl.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,w.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(l.code)),this.streamingTasks.set(t,{clientRequest:i,mode:n,url:t,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||r)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,c)):await this.startLiveStreamingTask(t,n,c)}}stopLiveStreamingTask(t){return new je((n,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new ae(F.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:s===hl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;const n=Array.from(rs(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ai.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ae(F.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Dr(this,xb.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new Dq(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Cd.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Cd.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Cd.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new ae(F.UNEXPECTED_ERROR,"can not get new live streaming address list"));Dr(this,xb.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=t.reason;switch(t.code){case er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new ae(F.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return w.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new ae(F.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case er.LIVE_STREAM_RESPONSE_WORKER_LOST:case er.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(rs(s=this.streamingTasks).call(s));for(const c of o)c.abortTask?c.abortTask():(w.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new ae(F.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{w.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(l=>{w.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,l)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const xq={name:"LiveStreaming",create:function(e){return new Lq(e.joinInfo,e.websocketRetryConfig||qn,e.httpRetryConfig||qn)}};function Mq(e){let t=A6();return function(n,r){let i=n.appId;i!==void 0&&($t(r,10),Nc(r,i));let s=n.cid;s!==void 0&&($t(r,16),$t(r,s));let o=n.cname;o!==void 0&&($t(r,26),Nc(r,o));let c=n.deviceId;c!==void 0&&($t(r,34),Nc(r,c));let l=n.elapse;l!==void 0&&($t(r,40),jd(r,l));let p=n.fileSize;p!==void 0&&($t(r,48),jd(r,Zf(p)));let m=n.height;m!==void 0&&($t(r,56),jd(r,Zf(m)));let E=n.jpg;E!==void 0&&($t(r,66),$t(r,E.length),function(Kr,Ee){let Ne=em(Kr,Ee.length);Kr.bytes.set(Ee,Ne)}(r,E));let v=n.networkType;v!==void 0&&($t(r,72),jd(r,Zf(v)));let y=n.osType;y!==void 0&&($t(r,80),jd(r,Zf(y)));let D=n.requestId;D!==void 0&&($t(r,90),Nc(r,D));let A=n.sdkVersion;A!==void 0&&($t(r,98),Nc(r,A));let P=n.sequence;P!==void 0&&($t(r,104),jd(r,Zf(P)));let j=n.sid;j!==void 0&&($t(r,114),Nc(r,j));let V=n.timestamp;V!==void 0&&($t(r,120),jd(r,V));let G=n.uid;G!==void 0&&($t(r,128),$t(r,G));let Z=n.vid;Z!==void 0&&($t(r,136),$t(r,Z));let Q=n.width;Q!==void 0&&($t(r,144),jd(r,Zf(Q)));let z=n.service;z!==void 0&&($t(r,152),$t(r,z));let ie=n.callbackData;ie!==void 0&&($t(r,162),Nc(r,ie));let fe=n.jpgEncryption;fe!==void 0&&($t(r,168),$t(r,fe));let ve=n.requestType;ve!==void 0&&($t(r,176),$t(r,ve));let we=n.scorePorn;we!==void 0&&($t(r,185),FI(r,we));let Ct=n.scoreSexy;Ct!==void 0&&($t(r,193),FI(r,Ct));let bt=n.scoreNeutral;bt!==void 0&&($t(r,201),FI(r,bt));let ut=n.scene;ut!==void 0&&($t(r,208),$t(r,ut));let Yt=n.ossFilePrefix;Yt!==void 0&&($t(r,218),Nc(r,Yt));let Ht=n.serviceVendor;if(Ht!==void 0)for(let Kr of Ht){$t(r,226);let Ee=A6();jq(Kr,Ee),$t(r,Ee.limit),Gq(r,Ee),Wq(Ee)}}(e,t),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(t)}function Uq(e){return function(n){let r={};e:for(;!O6(n);){let i=Pc(n);switch(i>>>3){case 0:break e;case 1:r.code=Pc(n);break;case 2:r.msg=N6(n,Pc(n));break;case 3:{let s=Fq(n);r.data=Vq(n),n.limit=s;break}default:b6(n,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function Vq(e){let t={};e:for(;!O6(e);){let n=Pc(e);switch(n>>>3){case 0:break e;case 1:t.requestId=N6(e,Pc(e));break;case 2:t.requestType=Pc(e)>>>0;break;case 3:t.scorePorn=jI(e);break;case 4:t.scoreSexy=jI(e);break;case 5:t.scoreNeutral=jI(e);break;case 6:t.requestScene=Pc(e)>>>0;break;case 7:t.scene=Pc(e)>>>0;break;default:b6(e,7&n)}}return t}function jq(e,t){let n=e.service;n!==void 0&&($t(t,8),$t(t,n));let r=e.vendor;r!==void 0&&($t(t,16),$t(t,r));let i=e.token;i!==void 0&&($t(t,26),Nc(t,i));let s=e.callbackUrl;s!==void 0&&($t(t,34),Nc(t,s))}function Fq(e){let t=Pc(e),n=e.limit;return e.limit=e.offset+t,n}function b6(e,t){switch(t){case 0:for(;128&P6(e););break;case 2:UI(e,Pc(e));break;case 5:UI(e,4);break;case 1:UI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Bq=new Float32Array(1);new Uint8Array(Bq.buffer);let MI=new Float64Array(1),Yi=new Uint8Array(MI.buffer);function Zf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let I6=[];function A6(){const e=I6.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Wq(e){I6.push(e)}function UI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function O6(e){return e.offset>=e.limit}function em(e,t){let n=e.bytes,r=e.offset,i=e.limit,s=r+t;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),e.bytes=o}return e.offset=s,s>i&&(e.limit=s),r}function VI(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function N6(e,t){let n=VI(e,t),r=String.fromCharCode,i=e.bytes,s="",o="";for(let c=0;c<t;c++){let l,p,m,E,v=i[c+n];(128&v)==0?o+=r(v):(224&v)==192?c+1>=t?o+=s:(l=i[c+n+1],(192&l)!=128?o+=s:(E=(31&v)<<6|63&l,E<128?o+=s:(o+=r(E),c++))):(240&v)==224?c+2>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],(49344&(l|p<<8))!=32896?o+=s:(E=(15&v)<<12|(63&l)<<6|63&p,E<2048||E>=55296&&E<=57343?o+=s:(o+=r(E),c+=2))):(248&v)==240?c+3>=t?o+=s:(l=i[c+n+1],p=i[c+n+2],m=i[c+n+3],(12632256&(l|p<<8|m<<16))!=8421504?o+=s:(E=(7&v)<<18|(63&l)<<12|(63&p)<<6|63&m,E<65536||E>1114111?o+=s:(E-=65536,o+=r(55296+(E>>10),56320+(1023&E)),c+=3))):o+=s}return o}function Nc(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),r+=c<128?1:c<2048?2:c<65536?3:4}$t(e,r);let i=em(e,r),s=e.bytes;for(let o=0;o<n;o++){let c=t.charCodeAt(o);c>=55296&&c<=56319&&o+1<n&&(c=(c<<10)+t.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function Gq(e,t){let n=em(e,t.limit),r=e.bytes,i=t.bytes;for(let s=0,o=t.limit;s<o;s++)r[s+n]=i[s]}function P6(e){return e.bytes[VI(e,1)]}function k6(e,t){let n=em(e,1);e.bytes[n]=t}function jI(e){let t=VI(e,8),n=e.bytes;return Yi[0]=n[t++],Yi[1]=n[t++],Yi[2]=n[t++],Yi[3]=n[t++],Yi[4]=n[t++],Yi[5]=n[t++],Yi[6]=n[t++],Yi[7]=n[t++],MI[0]}function FI(e,t){let n=em(e,8),r=e.bytes;MI[0]=t,r[n++]=Yi[0],r[n++]=Yi[1],r[n++]=Yi[2],r[n++]=Yi[3],r[n++]=Yi[4],r[n++]=Yi[5],r[n++]=Yi[6],r[n++]=Yi[7]}function Pc(e){let t,n=0,r=0;do t=P6(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function $t(e,t){for(t>>>=0;t>=128;)k6(e,127&t|128),t>>>=7;k6(e,t)}function jd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=em(e,s),c=e.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:c[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:c[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:c[o+4]=s!==5?128|r:127&r;case 4:c[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:c[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:c[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:c[o]=s!==1?128|n:127&n}}function D6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}const Hq=new Map([["moderation",1],["supervise",2]]);class Kq extends bn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Er.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Ui(n=t.map(r=>Hq.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),M(this,"name","AgoraRTCVideoContentInspect"),M(this,"_connectionState",Fo.CONNECTING),M(this,"_innerConnectionState",void 0),M(this,"sequence",0),M(this,"inspectStartTime",void 0),M(this,"workerManagerConnection",void 0),M(this,"workerConnection",void 0),M(this,"workerMessageLengthLimit",void 0),M(this,"inspectIntervalMinimum",void 0),M(this,"qualityRatio",void 0),M(this,"_connectInfo",void 0),M(this,"_cancelTokenSource",Ai.CancelToken.source()),M(this,"_retryConfig",void 0),M(this,"wmSequence",0),M(this,"inspectInterval",void 0),M(this,"inspectTimer",null),M(this,"ossFilePrefix",void 0),M(this,"extraInfo",void 0),M(this,"_inspectType",void 0),M(this,"_inspectMode",void 0),M(this,"_quality",1),M(this,"qualityTimer",null),M(this,"_inspectId",void 0),M(this,"_needWorkUrlOnly",!1),M(this,"inspectImage",()=>{if(this.connectionState!==Fo.CONNECTED)throw new ae(F.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Fo.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=on(5,"inspect-"),this.workerMessageLengthLimit=W("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=W("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=W("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Hg("worker-manager-"+this._inspectId,qn),this.on(Er.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,w.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Bo[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Hg("worker-"+this._inspectId,qn),this.handleWorkerEvents()}async init(t,n){this.emit(Er.STATE_CHANGE,Bo.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new je((i,s)=>{this.on(Er.CONNECTION_STATE_CHANGE,(o,c)=>{c===Fo.CONNECTED&&i()}),this.requestAP(t,r,n).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(t,n,r){const i=W("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),s=await function(c,l,p,m){let{appId:E,areaCode:v,cname:y,sid:D,token:A,uid:P}=l;Gf++;const j="image_moderation_api",V={service_name:j,json_body:JSON.stringify({appId:E,areaCode:v,cname:y,command:"allocateEdge",requestId:Gf,seq:Gf,sid:D,token:A,ts:Date.now(),uid:P+""})};let G,Z,Q=c[0];return va(async()=>{G=Date.now();const z=await wa(Q,{data:V,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-G,z.code!==0){const we=new ae(F.UNEXPECTED_RESPONSE,"image inspect ap error, code"+z.code,{retry:!0,responseTime:Z});throw w.error(we.toString()),we}const ie=JSON.parse(z.json_body);if(ie.code!==200){const we=new ae(F.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ie.code,", reason: ").concat(ie.reason),{code:ie.code,responseTime:Z});throw w.error(we.toString()),we}if(!ie.servers||!Array.isArray(ie.servers)||ie.servers.length===0){const we=new ae(F.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ie.code,responseTime:Z});throw w.error(we.toString()),we}const fe=W("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ve=W("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ie.servers.map(we=>{let{address:Ct,wss:bt}=we;if(Ct&&bt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(fe,":").concat(ve||bt)}).filter(we=>!!we),workerToken:ie.workerToken,vid:ie.vid,responseTime:Z}},(z,ie)=>(Xe.apworkerEvent(D,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify(z.addressList),firstSuccess:ie===0,responseTime:Z,serverIp:c[ie%c.length]}),!1),(z,ie)=>(Xe.apworkerEvent(D,{success:!1,sc:z.data&&z.data.code||200,serviceName:j,responseTime:Z,serverIp:c[ie%c.length]}),!!(z.code!==F.OPERATION_ABORTED&&z.code!==F.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(Q=c[(ie+1)%c.length],!0)),m)}(i,t,n,r);this.emit(Er.STATE_CHANGE,Bo.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Er.STATE_CHANGE,Bo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(vt.CONNECTED,async()=>{this.emit(Er.STATE_CHANGE,Bo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(vt.CLOSED,()=>{this._innerConnectionState<Bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(vt.FAILED,()=>{this._innerConnectionState<Bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(vt.RECONNECTING,()=>{this._innerConnectionState<Bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(vt.ON_MESSAGE,async t=>{this.emit(Er.STATE_CHANGE,Bo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw w.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new ae(F.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw w.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new ae(F.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=W("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Er.STATE_CHANGE,Bo.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(Er.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(vt.CONNECTED,async()=>{this.emit(Er.STATE_CHANGE,Bo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Fo.CONNECTED}),this.workerConnection.on(vt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=Uq(new Uint8Array(t.data));if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&w.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Er.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Ui(n=Object.keys(i)).call(n,(c,l)=>i[c]>i[l]?c:l,"porn"),o=Object.keys(i).find(c=>c===s);this.emit(Er.INSPECT_RESULT,o)}else this.emit(Er.INSPECT_RESULT,void 0,new ae(F.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Er.INSPECT_RESULT,void 0,new ae(F.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else w.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Er.INSPECT_RESULT,void 0,new ae(F.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(vt.CLOSED,()=>{this.connectionState=Fo.CLOSED}),this.workerConnection.on(vt.FAILED,()=>{this.connectionState=Fo.CLOSED}),this.workerConnection.on(vt.RECONNECTING,()=>{this.connectionState=this.connectionState===Fo.CONNECTED?Fo.RECONNECTING:Fo.CONNECTING}),this.workerConnection.on(vt.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(vt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Er.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const t=Ts(this,Er.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Er.INSPECT_RESULT,void 0,new ae(F.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Er.INSPECT_RESULT,void 0,new ae(F.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await px(m,r,i),v=this.sequence+"-"+s+"-"+l+"-"+p+"-"+on(12,""),y={appId:r,cid:s,cname:i,deviceId:"",elapse:(D=Number(p-this.inspectStartTime),{low:D|=0,high:D>>31,unsigned:D>=0}),fileSize:E.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:v,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:B5(p),uid:l,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var D;this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const A=Mq(y);if(A.byteLength<this.workerMessageLengthLimit){if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const P=function(j){for(var V=1;V<arguments.length;V++){var G=arguments[V]!=null?arguments[V]:{};V%2?D6(Object(G),!0).forEach(function(Z){M(j,Z,G[Z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(G)):D6(Object(G)).forEach(function(Z){Object.defineProperty(j,Z,Object.getOwnPropertyDescriptor(G,Z))})}return j}({},y);delete P.jpg,w.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(P))}return A}{const P=this.quality*this.qualityRatio;return this.quality=P,await this.generateRequestData(t,{appId:r,cname:i,cid:s,vid:o,sid:c,uid:l})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ai.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Fo.CLOSED,this.emit(Er.STATE_CHANGE,Bo.CLOSED)}}const zq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new ae(F.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new ae(F.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var s;if(!Ae(s=["supervise","moderation"]).call(s,i))throw new ae(F.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new ae(F.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Kq(t)}};var L6=S(Qr.Object.getOwnPropertySymbols),Yq=qt,qq=Zh.indexOf,Xq=vu,BI=Me([].indexOf),x6=!!BI&&1/BI([1],1,-0)<0;Yq({target:"Array",proto:!0,forced:x6||!Xq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return x6?BI(this,e,t)||0:qq(this,e,t)}});var Jq=Qi("Array","indexOf"),Qq=Y,$q=Jq,WI=Array.prototype,Zq=function(e){var t=e.indexOf;return e===WI||Qq(WI,e)&&t===WI.indexOf?$q:t},M6=S(Zq);function eX(e,t){if(e==null)return{};var n,r,i=function(o,c){if(o==null)return{};var l={};for(var p in o)if({}.hasOwnProperty.call(o,p)){if(M6(c).call(c,p)!==-1)continue;l[p]=o[p]}return l}(e,t);if(L6){var s=L6(e);for(r=0;r<s.length;r++)n=s[r],M6(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let U6=class{get localCapabilities(){return Cn(this._localCapabilities)}get rtpCapabilities(){return Cn(this._rtpCapabilities)}get candidates(){return Cn(this._candidates)}get iceParameters(){return Cn(this._iceParameters)}get dtlsParameters(){return Cn(this._dtlsParameters)}constructor(e){M(this,"sessionDesc",void 0),M(this,"_localCapabilities",void 0),M(this,"_rtpCapabilities",void 0),M(this,"_candidates",void 0),M(this,"_iceParameters",void 0),M(this,"_dtlsParameters",void 0),M(this,"setup",void 0),M(this,"currentMidIndex",void 0),M(this,"cname","o/i14u9pJrxRKAsu"),M(this,"firefoxSsrcMidMap",new Map),e=Cn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:c,videoCodec:l,audioCodec:p}=e;let m;this.setup=c,m=o===Ei.RECEIVE_ONLY?Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s;const E=o===Ei.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,v=o===Ei.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,y=o===Ei.RECEIVE_ONLY?i.send.videoCodecs:qg(We.VIDEO,E,v,l),D=o===Ei.RECEIVE_ONLY?i.send.audioCodecs:qg(We.AUDIO,E,v,p);for(const A of m.mediaDescriptions)A.attributes.iceUfrag=t.iceUfrag,A.attributes.icePwd=t.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=r,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=y.map(P=>P.payloadType.toString(10)),A.attributes.payloads=y,A.attributes.extmaps=E.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=D.map(P=>P.payloadType.toString(10)),A.attributes.payloads=D,A.attributes.extmaps=E.audioExtensions,Wf(A));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return yd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=Yg(t,this.cname,W("SYNC_GROUP")?n:void 0),c=this.findPreloadMediaDesc(s);if(c){if(Nn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){const l=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{const l=this.findAvailableMediaIndex(e,s,r);let p;return l===-1?(p=this.createOrRecycleSendMedia(e,s,o,"sendonly",r,i),this.updateBundleMids()):(p=Cn(this.sessionDesc.mediaDescriptions[l]),p.attributes.direction="sendonly",p.attributes.ssrcs=s,p.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(p,i)),Nn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let c,l=!1;o===-1?(l=!0,c=this.createOrRecycleRecvMedia(i,[],"recvonly",t,n),this.updateBundleMids()):(c=Cn(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),r.push({mid:c.attributes.mid,needCreateTransceiver:l})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:s,relatedAddress:o,relatedPort:c,priority:l}=new RTCIceCandidate(e),p={foundation:t??"",componentId:"1",transport:n??"",priority:l?l+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some(m=>m.priority===p.priority&&m.connectionAddress===p.connectionAddress&&m.port===p.port)||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const s=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=qg(s,o,this.localCapabilities.send,s===We.AUDIO?i:r),l=s===We.VIDEO?o.videoExtensions:o.audioExtensions,p="".concat(++this.currentMidIndex);let m={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungRecvMediaDsec(m,e);const E=this.findFirstClosedMedia(s);if(E){const v=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ae(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ae(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Nn()){if(i){const s=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Cn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,s){const o=this.rtpCapabilities.send,c=e===We.VIDEO?o.videoCodecs:o.audioCodecs,l=e===We.VIDEO?o.videoExtensions:o.audioExtensions;Nn()&&(i="".concat(++this.currentMidIndex));let p={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};p=this.mungSendMediaDesc(p,s);const m=this.findFirstClosedMedia(e);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(e,t,n){const r=Cn(e);return Bb(r),Bf(r,t),Wb(r,t),NU(r),sT(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Cn(e);return sT(n,t,this.localCapabilities.recv),Wf(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Nn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const tX=["sdp"];var _n;function V6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?V6(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let j6=(_n=class rm extends hU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),M(this,"direction",void 0),M(this,"name",void 0),M(this,"store",void 0),M(this,"spec",void 0),M(this,"peerConnection",void 0),M(this,"initialOffer",void 0),M(this,"transport",void 0),M(this,"statsFilter",void 0),M(this,"localCandidateCount",0),M(this,"_isInRestartIce",!1),M(this,"mutex",void 0),M(this,"onLocalCandidate",void 0),M(this,"remoteSDP",void 0),M(this,"pendingCandidates",[]),M(this,"localCapabilities",void 0),M(this,"isReady",!1),M(this,"restartCnt",0),M(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Fr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(rm.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Ei.SEND_ONLY,this.name=this.direction===Ei.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=JR(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await kU();if(this.localCapabilities=oT(n),t){const{sdp:r}=t,i=eX(t,tX),s=function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=zg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Wo(E,m,"videoExtensions",v,y,D),Wo(E,m,"videoCodecs",v,y,D),Wo(E,m,"audioExtensions",v,y,D),Wo(E,m,"audioCodecs",v,y,D),W("RAISE_H264_BASELINE_PRIORITY")){const A=D.videoCodecs.findIndex(P=>P.rtpMap&&P.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&P.fmtp&&P.fmtp.parameters["profile-level-id"]==="42001f");if(A!==-1){const P=D.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(P<A){w.debug("raising H264 baseline profile priority");const j=D.videoCodecs[A];D.videoCodecs.splice(A,1),D.videoCodecs.splice(P,0,j)}P!==-1&&W("FILTER_SEND_H264_BASELINE")&&(v.videoCodecs=v.videoCodecs.filter(j=>!(j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:v,recv:y,sendrecv:D}}({},{},r);this.remoteSDP=new U6({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=Id(o.sdp);await this.peerConnection.setLocalDescription(o);const l=await DU({},{},o.sdp);this.localCapabilities=oT(l);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),Fd(Fd({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Id(r.sdp);return this.initialOffer=r,Fd(Fd({},i),{},{sdp:r.sdp})}}catch(n){throw new pe(F.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=t,s=await DU({},{},n);this.remoteSDP=new U6({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new pe(F.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var i=this;return Js(function*(){const s=yield jt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],c=i.remoteSDP.receive(t,n,r);t.forEach((P,j)=>{if(c[j].needCreateTransceiver){const V=i.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});o.push(V),P._updateRtpTransceiver(V)}else{const V=i.peerConnection.getTransceivers().find(G=>G.mid===c[j].mid);if(!V)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[j].mid));o.push(V),P._updateRtpTransceiver(V)}}),Nn()&&W("SIMULCAST")===!0&&(yield jt(i.applySimulcastForFirefox(o,t)));const l=c.map(P=>P.mid),p=yield jt(i.peerConnection.createOffer()),m=i.mungSendOfferSDP(p.sdp,t,l),E=Gi(m),v=l.map(P=>{const j=E.mediaDescriptions.find(V=>V.attributes.mid===P);if(!j)throw new Error("Cannot extract ssrc from mediaDescription.");return IU(j,W("USE_PUB_RTX"))}),y=o.map((P,j)=>{const V=l[j];return{localSSRC:v[j],id:V}});yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield y}catch(P){const j=i.remoteSDP.toString();throw yield jt(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(i.peerConnection.setRemoteDescription({type:"answer",sdp:j})),yield jt(i.stopSending(l,!0)),P}yield jt(i.applySimulcastEncodings(o,t)),yield jt(i.applySendEncodings(o,t));const D=i.remoteSDP.toString(),A=i.logSDPExchange(m,"offer","local","send");return A?.(D),yield jt(i.setRemoteDescription({type:"answer",sdp:D})),o.map((P,j)=>{const V=l[j];return{localSSRC:v[j],id:V}})}catch(o){throw o instanceof pe?o:new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(l=>t.indexOf(l.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(l=>{var p;l.direction="inactive",(p=l.stop)===null||p===void 0||p.call(l)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();o?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const m=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,s,t);p?.(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=this.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(t,n,r,i);if(o){const c=this.remoteSDP.toString(),l=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,t);l?.(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===mh.Auto&&(this.store.p2pTransport=mh.SdRtn,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(rm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(rm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Id(n.sdp);return this.store.descriptionStart(),this.direction===Ei.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ei.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Id(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new pe(F.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Nn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Fd(Fd({},vc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Fd(Fd({},vc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Ae(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Pg(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...rm.turnServerConfigToIceServers(t.turnServer.servers,n,r)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...rm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Ae(s=[mh.Relay,mh.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Ft().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),w.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=t.filter(c=>c.tcpport);w.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(n){case mh.SdRtn:const c=t.filter(p=>{var m;return Ae(m=p.username).call(m,"glb:")&&p.turnServerURL==p.turnServerURL}),l=c.length>r?c[r]:c[0];l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(Rd(l.turnServerURL),":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Rd(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;case mh.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rd(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t?.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair()||{};if(r&&i){const s=r.address+":"+r.port,o=i.address+":"+i.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ch(s)),", remote ").concat(JSON.stringify(Ch(o))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ft().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var o;const{bitrateMax:m,frameRate:E,scaleResolutionDownBy:v}=t._encoderConfig;m&&(s.maxBitrate=1e3*m),Ae(o=t._hints).call(o,rn.LOW_STREAM)&&(E&&(s.maxFramerate=as(E)),v&&v>=1&&(s.scaleResolutionDownBy=v))}if(W("DSCP_TYPE")&&dl()){var c;const m=W("DSCP_TYPE");Ae(c=["very-low","low","medium","high"]).call(c,m)&&(s.networkPriority=m)}const l=n.getParameters(),p=(r=l.encodings)===null||r===void 0?void 0:r[0];Nn()&&!p&&(i.encodings=[s]),p&&Object.assign(p,s),Object.assign(l,i),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];s instanceof mn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const i=Gi(t);return n.forEach((s,o)=>{const c=r[o],l=i.mediaDescriptions.find(p=>p.attributes.mid===c);l&&(Bf(l,s),PU(l,s,this.store.codec))}),yd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,i,s,o,c;const p=t[l],m=n[l];if(m instanceof mn&&!Ae(r=m._hints).call(r,rn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=m._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=m._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,E))}}}async applySimulcastEncodings(t,n){if(!Nn()&&t.length===n.length)for(let r=0;r<t.length;r++){const i=n[r];if(i instanceof mn&&this.isVP8Simulcast(i)){const s=t[r],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();await s.sender.setParameters(Object.assign(l,o))}}}isVP8Simulcast(t){var n,r,i,s,o;return!!(t instanceof mn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ae(n=t._hints).call(n,rn.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=t._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(t,n,r,i){if(W("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),t),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&t.indexOf(o.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async o=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r;if(n=n??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const s=(i=Gi(n).mediaDescriptions.find(o=>o.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return s?.[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Ae(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const i=Gi(t),s=i.mediaDescriptions.find(o=>o.attributes.mid===n);return s&&r===We.AUDIO&&s.media.mediaType==="audio"&&Wf(s),yd(i)}},qe(_n.prototype,"establish",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"establish"),_n.prototype),qe(_n.prototype,"connect",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"connect"),_n.prototype),qe(_n.prototype,"receive",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"receive"),_n.prototype),qe(_n.prototype,"mockReceive",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"mockReceive"),_n.prototype),qe(_n.prototype,"stopReceiving",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"stopReceiving"),_n.prototype),qe(_n.prototype,"restartICE",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"restartICE"),_n.prototype),qe(_n.prototype,"close",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"close"),_n.prototype),qe(_n.prototype,"updateEncoderConfig",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"updateEncoderConfig"),_n.prototype),qe(_n.prototype,"updateSendParameters",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"updateSendParameters"),_n.prototype),qe(_n.prototype,"replaceTrack",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"replaceTrack"),_n.prototype),qe(_n.prototype,"muteLocal",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"muteLocal"),_n.prototype),qe(_n.prototype,"unmuteLocal",[Yo],Object.getOwnPropertyDescriptor(_n.prototype,"unmuteLocal"),_n.prototype),_n);function Yo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}let Ia=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var F6,B6,W6,G6,H6,K6,z6,Y6,q6,X6,J6,wn;function Q6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function GT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Q6(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let nX=(F6=Aa(Ia.SEND_ONLY),B6=Aa(Ia.SEND_ONLY),W6=Aa(),G6=Aa(Ia.RECEIVE_ONLY),H6=Aa(Ia.RECEIVE_ONLY),K6=Aa(Ia.RECEIVE_ONLY),z6=Aa(Ia.RECEIVE_ONLY),Y6=Aa(Ia.RECEIVE_ONLY),q6=Aa(Ia.RECEIVE_ONLY),X6=Aa(),J6=Aa(Ia.RECEIVE_ONLY),wn=class extends bn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(tt.StateChange,t,this._state)}constructor(e,t){super(),M(this,"isPlanB",!1),M(this,"store",void 0),M(this,"statsUploader",void 0),M(this,"sendConnection",void 0),M(this,"recvConnection",void 0),M(this,"localTrackMap",new Map),M(this,"remoteUserMap",new Map),M(this,"localDataChannels",[]),M(this,"pendingLocalTracks",[]),M(this,"pendingRemoteTracks",[]),M(this,"statsCollector",void 0),M(this,"dtlsFailedCount",0),M(this,"sendMutex",void 0),M(this,"recvMutex",void 0),M(this,"_state",Jt.Disconnected),M(this,"_restartStates",["disconnected","failed"]),M(this,"reconnectInterval",void 0),M(this,"uploadUnplinkStarted",!1),M(this,"uploadDownlinkStarted",!1),M(this,"uplinkStateUploadInterval",void 0),M(this,"downlinkStatsUploadInterval",void 0),M(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const l=this.filterTobeMutedTracks(n);if(l.length===0)return void r();const p=l.find(y=>y[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(l.map(y=>{let[,{id:D}]=y;return D}));let m=!1;var o,c;n.trackMediaType==="video"?m=!((o=this.localTrackMap.get(Te.LocalAudioTrack))===null||o===void 0||!o.track._muted):m=((c=this.localTrackMap.get(Te.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;const E=this.createMuteMessage(l);await sn(this,tt.RequestMuteLocal,E);const v=n.trackMediaType==="video"?wd.MUTE_LOCAL_VIDEO:wd.MUTE_LOCAL_AUDIO;await sn(this,tt.RequestP2PMuteLocal,{action:v,message:E,isMuteAll:m}),r()}catch(l){i(l)}finally{s()}}),M(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void i(new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map(p=>{let[,{id:m}]=p;return m}));const c=this.createUnmuteMessage(o),l=n.trackMediaType==="video"?wd.UNMUTE_LOCAL_VIDEO:wd.UNMUTE_LOCAL_AUDIO;await sn(this,tt.RequestP2PMuteLocal,{action:l,message:c}),r()}catch(o){i(o)}finally{s()}}),M(this,"handleUpdateVideoEncoder",async(n,r,i,s)=>{let o;typeof s=="boolean"&&s||(o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const l=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==n||this.state!==Jt.Connected)return void r();const{id:p,track:m}=l;p&&(await this.sendConnection.updateSendParameters(p,m),await this.sendConnection.updateEncoderConfig(p,m),this.emit(tt.UpdateVideoEncoder,m)),r()}catch(l){i(l)}finally{var c;(c=o)===null||c===void 0||c()}}),M(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Jt.Connected)return void r();const{id:c,track:l}=o;c&&await this.sendConnection.updateSendParameters(c,l),r()}catch(o){i(o)}finally{s()}}),M(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;w.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;const p=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.sendConnection||!p||p[1].id===void 0||this.state!==Jt.Connected)return void r();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(n,p[1].id)),p[0]===Te.LocalVideoTrack&&Ft().supportDualStreamEncoding){const m=this.localTrackMap.get(Te.LocalVideoLowTrack);if(m){const E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,await new je((v,y)=>{this.handleReplaceTrack(m.track,v,y,!0)})}}r()}catch(p){i(p)}finally{var l;(l=o)===null||l===void 0||l()}}),M(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),M(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),M(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),M(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new f5(e),this.bindStatsUploaderEvents(),this.sendMutex=new Fr("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Fr("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},W("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new j6(e,this.store,Ei.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Jt.New,this.sendConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new j6(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected}async addRemoteCandidate(e,t){if(t===Ei.RECEIVE_ONLY){if(!this.sendConnection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new pe(F.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return Js(function*(){const i=yield jt(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Jt.Connected){r.throwIfTrackTypeNotMatch(e);const p=e.filter(m=>r.pendingLocalTracks.indexOf(m)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(p))}r.store.pubId=r.store.pubId+1,Hr.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(e,t,n);if(s.length===0)return void(yield jt(r.tryToUnmuteAudio(e)));s.forEach(p=>{let{track:m,type:E}=p;const v=Date.now();r.store.publish(m.getTrackId(),E===Te.LocalAudioTrack?"audio":"video",v)}),r.bindLocalTrackEvents(s);const o=yield jt(r.sendConnection.send(s.map(p=>{let{track:m}=p;return m}),r.store.codec,r.store.audioCodec)),c=(yield jt(o.next())).value,l=r.createGatewayPublishMessage(s,c);try{yield l}catch(p){throw o.throw(p),p?.code===F.WS_ABORT&&s.forEach(m=>{let{track:E}=m;r.pendingLocalTracks.indexOf(E)===-1&&r.pendingLocalTracks.push(E)}),r.unbindLocalTrackEvents(s),p}yield jt(o.next()),s.forEach(p=>{let{type:m}=p;r.statsCollector.addLocalStats(m)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,c),s.forEach(p=>{let{track:m,type:E}=p;const v=Date.now();r.store.publish(m.getTrackId(),E===Te.LocalAudioTrack?"audio":"video",void 0,v)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Jt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Ae(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Jt.Connected)return n&&n[1].track.close(),r;e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s,ssrcs:o}]=r;const c={stream_type:qz(s,i),ssrcs:o};s._muted||!s._enabled?t.push(c):n.push(c)}),t.length>0&&t.forEach(r=>{sn(this,tt.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{sn(this,tt.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Js(function*(){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Dr(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===We.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Df(s,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new kf(s,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const l=this.remoteUserMap.get(e);l?l.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:v}=m;return E.uid===e.uid&&t===v});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(tt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new pe(F.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:c}=s;return t!==void 0?o.uid===e.uid&&t===c:o.uid===e.uid});if(r.forEach(s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||n||r.forEach(s=>{let{kind:o}=s;var c;if(o===We.AUDIO)(c=e._audioTrack)===null||c===void 0||c._destroy(),e._audioTrack=void 0;else if(o===We.VIDEO){var l;(l=e._videoTrack)===null||l===void 0||l._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[o,{kind:c}]=s;var l,p;if(c===We.VIDEO&&o._videoSSRC&&((l=this.recvConnection)===null||l===void 0||l.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===We.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((p=o._videoTrack)===null||p===void 0||p._destroy(),o._videoTrack=void 0);else if(c===We.AUDIO){var m;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((m=o._audioTrack)===null||m===void 0||m._destroy(),o._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:o}]=s;sn(this,tt.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[We.VIDEO,We.AUDIO].forEach(r=>{n.has(r)?sn(this,tt.RequestP2PUnmuteRemote,r):sn(this,tt.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new pe(F.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===We.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Te.LocalAudioTrack);if(t?.track instanceof Zn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Te.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===Te.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===Te.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,i){if(e){const o=this.localTrackMap.get(Te.LocalAudioTrack),c=r?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);Xe.publish(this.store.sessionId,{eventElapse:Hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(l=>l instanceof Ln),c=r?(s=this.localTrackMap.get(Te.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(l=>l instanceof mn);Xe.publish(this.store.sessionId,{eventElapse:Hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rn.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===We.VIDEO?n._videoSSRC:n._audioSSRC;i&&Xe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===We.VIDEO,audio:r===We.AUDIO,peerid:n.uid,subscribeRequestid:r===We.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Hr.measureFromSubscribeStart(this.store.clientId,i)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Fr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Fr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e?.track instanceof Zn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Jt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof mn||t&&t.track instanceof Ln?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hi(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=rh(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case Te.LocalVideoTrack:Ae(t=r._hints).call(t,rn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Te.LocalAudioTrack:r instanceof Zn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Te.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hi(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(tt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof Pd?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Ei.SEND_ONLY){if(!this.sendConnection)throw new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new pe(F.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await Dr(this,tt.RequestP2PRestartICE,{direction:Ei.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalAudioTrack),r=e.videoSend.find(y=>{var D;return y.ssrc===(t==null||(D=t.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),i=e.audioSend.find(y=>{var D;return y.ssrc===(n==null||(D=n.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!r||!i)return 1;const s=Ts(this,tt.NeedSignalRTT),o=r?r.rttMs:void 0,c=i?i.rttMs:void 0,l=o&&c?(o+c)/2:o||c,p=(l&&s?(l+s)/2:l||s)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,v=t?.track;if(v&&v._encoderConfig&&v._hints.indexOf(rn.SCREEN_TRACK)===-1){const y=v._encoderConfig.bitrateMax,D=e.bitrate.actualEncoded;if(y&&D){const A=(1e3*y-D)/(1e3*y);return iU[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=e.audioRecv.find(D=>D.ssrc===i),c=e.videoRecv.find(D=>D.ssrc===s);if(!o&&!c)return void(t+=1);const l=Ts(this,tt.NeedSignalRTT),p=e.rtt,m=(p&&l?(p+l)/2:p||l)||0,E=o?o.jitterMs:void 0,v=e.recvPacketLossRate;let y=.7*v*100/50+.3*m/1500;E&&(y=.6*v*100/50+.2*m/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new je((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=Ft(),s=this.getAllTracks();e=vf(e=e.filter(l=>s.indexOf(l)===-1));let o=!1,c=!1;for(const l of e){if(l instanceof mn&&(this.localTrackMap.has(Te.LocalVideoTrack)||o?new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:l,type:Te.LocalVideoTrack}),o=!0),t)){const p=this.getLowVideoTrack(l,n);r.push({track:p,type:Te.LocalVideoLowTrack})}if(l instanceof Ln){const p=this.localTrackMap.get(Te.LocalAudioTrack);if(p){if(!(p.track instanceof Zn))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(l),this.bindLocalAudioTrackEvents(l,!0)}else if(c){const m=r.find(E=>{let{type:v}=E;return v===Te.LocalAudioTrack});if(!(m.track instanceof Zn))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(l._bypassWebAudio)throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(l)}else{if(!i.webAudioMediaStreamDest||l instanceof Zn||l._bypassWebAudio)r.push({track:l,type:Te.LocalAudioTrack});else{const m=new Zn;m.addAudioTrack(l),r.push({track:m,type:Te.LocalAudioTrack})}c=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=vf(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Ln){const i=this.localTrackMap.get(Te.LocalAudioTrack);if(!i)continue;i.track instanceof Zn?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,i]),i.track.close())):t.push([Te.LocalAudioTrack,i])}if(r instanceof mn){const i=this.localTrackMap.get(Te.LocalVideoTrack);if(!i)continue;t.push([Te.LocalVideoTrack,i]);const s=this.localTrackMap.get(Te.LocalVideoLowTrack);s&&t.push([Te.LocalVideoLowTrack,s])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.addListener(ze.GET_STATS,this.handleGetLocalVideoStats),n.addListener(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ze.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(ze.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Zn?e.trackList.forEach(n=>{n.addListener(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ze.GET_STATS,this.handleGetLocalAudioStats),n.addListener(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ze.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case Te.LocalVideoTrack:n.off(ze.GET_STATS,this.handleGetLocalVideoStats),n.off(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ze.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(ze.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Zn?e.trackList.forEach(t=>{t.off(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ze.GET_STATS,this.handleGetLocalAudioStats),t.off(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ze.GET_STATS,this.handleGetLocalAudioStats),e.off(ze.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ze.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ze.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ze.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ze.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof kf&&t.addListener(ze.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Df&&t.addListener(ze.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ze.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(We.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(We.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var i;let s,{track:o,type:c}=n;switch(c){case Te.LocalAudioTrack:s=Qt.Audio;break;case Te.LocalVideoTrack:s=Ae(i=o._hints).call(i,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:s=Qt.Low}return{kind:c===Te.LocalAudioTrack?We.AUDIO:We.VIDEO,stream_type:s,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(tt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ae(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Rr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Xe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(Zs.FIRST_FRAME_DECODED),Xe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,yn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===t);r&&Xe.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,yn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Hi(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===t);r&&Xe.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,yn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(tt.ConnectionTypeChange,r),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(bd(n))," -> ").concat(JSON.stringify(bd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(tt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Ei.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,w.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ei.SEND_ONLY?this.restartICE(e):Dr(this,tt.RequestP2PRestartICE,{direction:Ei.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof Zn)return n.track.isActive||t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r&&(t.push(r),r[0]===Te.LocalVideoTrack)){const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Ln&&n?.track instanceof Zn)return n.track.isActive&&t.push([Te.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return e===s});if(r)if(r[0]===Te.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(Te.LocalVideoLowTrack);i&&t.push([Te.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[i,{track:s,ssrcs:o,id:c}]=t;switch(i){case Te.LocalAudioTrack:r=Qt.Audio;break;case Te.LocalVideoTrack:r=Ae(n=s._hints).call(n,rn.SCREEN_TRACK)?Qt.Screen:Qt.High;break;case Te.LocalVideoLowTrack:r=Qt.Low}return{stream_type:r,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([e,{kind:s,id:o}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case We.VIDEO:return void(r._videoSSRC&&t.push({stream_type:We.VIDEO,ssrcId:r._videoSSRC}));case We.AUDIO:return void(r._audioSSRC&&t.push({stream_type:We.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Te.LocalVideoTrack),n=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new je((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new je((r,i)=>{this.handleUpdateVideoEncoder(n.track,r,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Ln){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await sn(this,tt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(tt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rr(HR(this.dtlsFailedCount,qn)),this.emit(tt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof mn).length>1)throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ln).length>1&&(e.some(t=>t instanceof Ln&&t._bypassWebAudio)||!Ft().webAudioMediaStreamDest))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof mn&&this.pendingLocalTracks.some(n=>n instanceof mn))throw new pe(F.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ln&&this.pendingLocalTracks.some(n=>n instanceof Ln)&&(!Ft().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ln&&n._bypassWebAudio)))throw new pe(F.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ft().supportDualStreamEncoding,r=GT(GT({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():oI(e,r);const s=on(8,"track-low-"),o=new mn(i,GT(GT({},n&&{scaleResolutionDownBy:Fb(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(_h.TRANSCEIVER_UPDATED,c=>{e._updateRtpTransceiver(c,bf.LOW_STREAM)}),o._hints.push(rn.LOW_STREAM),e.addListener(ze.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const s=Array.from(Hi(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,c=o.subscribe.find(l=>l.userId===s.uid&&l.type==="video");Xe.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,yn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:t,videoheight:n,subscribeElapse:Hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new pe(F.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new pe(F.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new pe(F.NOT_SUPPORTED)}async preConnect(e){throw new pe(F.NOT_SUPPORTED)}getEstablishParams(){throw new pe(F.NOT_SUPPORTED)}async reSubscribe(e){throw new pe(F.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new pe(F.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Te.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,bf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},qe(wn.prototype,"p2pConnect",[F6],Object.getOwnPropertyDescriptor(wn.prototype,"p2pConnect"),wn.prototype),qe(wn.prototype,"unpublish",[B6],Object.getOwnPropertyDescriptor(wn.prototype,"unpublish"),wn.prototype),qe(wn.prototype,"unpublishLowStream",[W6],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishLowStream"),wn.prototype),qe(wn.prototype,"subscribe",[G6],Object.getOwnPropertyDescriptor(wn.prototype,"subscribe"),wn.prototype),qe(wn.prototype,"mockSubscribe",[H6],Object.getOwnPropertyDescriptor(wn.prototype,"mockSubscribe"),wn.prototype),qe(wn.prototype,"unsubscribe",[K6],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribe"),wn.prototype),qe(wn.prototype,"muteRemote",[z6],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),qe(wn.prototype,"unmuteRemote",[Y6],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),qe(wn.prototype,"hasRemoteMediaWithLock",[q6],Object.getOwnPropertyDescriptor(wn.prototype,"hasRemoteMediaWithLock"),wn.prototype),qe(wn.prototype,"disconnectForReconnect",[X6],Object.getOwnPropertyDescriptor(wn.prototype,"disconnectForReconnect"),wn.prototype),qe(wn.prototype,"remoteMediaSsrcChanged",[J6],Object.getOwnPropertyDescriptor(wn.prototype,"remoteMediaSsrcChanged"),wn.prototype),wn);function Aa(e){return function(t,n,r){const i=t[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(e){case Ia.SEND_ONLY:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}case Ia.RECEIVE_ONLY:{const l=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l()}}default:{const l=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{l(),p()}}}},r}}class Lh extends bn{constructor(t,n){super(),M(this,"signal",void 0),M(this,"token",void 0),M(this,"tokenTimeout",void 0),M(this,"tokenInterval",void 0),M(this,"_sequence",0),M(this,"userMap",new Map),M(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===hn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*W("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,i,s){var o;if(this.userMap.size===0)return;const c=Array.from(rs(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=i??on(6,""),s=s??this._sequence++;const l={_id:i,_type:t,_seq:s,_message:n,token:"".concat(this.token,"_").concat(c)};W("SHOW_P2P_LOG")&&w.debug("send message",l,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(l)).forEach(m=>{this.signal.request(lt.DATA_STREAM,{payload:Sd(this.encoder.encode(m))})});const p=new je((m,E)=>{const v=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),A),this.off(Vf.ABORT,D),w.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?E(new pe(F.INVALID_REMOTE_USER)):E(new pe(F.TIMEOUT))},W("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{v&&window.clearTimeout(v),this.off(Vf.ABORT,D),r&&m()},D=()=>{v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),A),E(new pe(F.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Vf.ABORT,D),this.once("res-@".concat(i,"_ack"),y);const A=(j,V)=>{P=!0,v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off(Vf.ABORT,D),j==="success"?m(V):E(new pe(F.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let P=!1;r||(this.once("res-@".concat(i),A),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{P||w.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(l))}))});try{return await p}catch(m){if(m.code===F.TIMEOUT)return await this.send(t,n,r,i,s);throw m}}onMessage(t){var n;const{_uid:r}=t;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Vn.CHECK)return;const{token:p}=t;i=new Map,s={uid:r,isStart:!0,token:p,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(Pt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var o;const{id:p,total:m}=t,E=(o=i.get(p))!==null&&o!==void 0?o:[];if(E.push(t),i.has(p)||i.set(p,E),E.length!==m)return;{const v=rh(E).call(E,(y,D)=>y.index-D.index).map(y=>y.payload).join("");i.delete(p),(t=JSON.parse(v))._uid=r}}const{_type:c,token:l}=t;if(Ae(n=[Vn.ACK,Vn.CHECK]).call(n,c))return c===Vn.CHECK&&this.handleCheckToken(s,l),void this.receiveMessage(t);l==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(t):w.debug('Receive unexpected message", '.concat(l,", cur_token: ").concat(s.token,"_").concat(this.token),t)}check(){const t={_id:on(6,""),token:this.token,_type:Vn.CHECK};W("SHOW_P2P_LOG")&&w.debug("send message",t),this.signal.request(lt.DATA_STREAM,{payload:Sd(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Vn.ACK,token:this.token};W("SHOW_P2P_LOG")&&w.debug("send message",n),this.signal.request(lt.DATA_STREAM,{payload:Sd(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Vn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(p=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:E}=p;for(;m.has(E);){const v=m.get(E);m.delete(E),this.receiveMessage(v),p.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:i}=t,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:l}=s;if(i<l)return this.ack(t._id),void w.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));o.set(i,t),c&&i===l&&(this.receiveMessage(t),o.delete(l),s.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:i,_uid:s}=t;if(W("SHOW_P2P_LOG")&&w.debug("receive message",t),n){let o;switch(t._type!==Vn.ACK&&(i&&(o=JSON.parse(i)),this.ack(t._id)),t._type){case Vn.CANDIDATE:case Vn.CONTROL:this.signal.emit(r,o,s);break;case Vn.PUBLISH:case Vn.UNPUBLISH:case Vn.RESTART_ICE:case Vn.CALL:o.uid=s,Dr(this.signal,r,o).then(c=>{this.response(t._id,c)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Vn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Vn.RESPONSE:{const{success:c,message:l}=o;this.emit("res-@".concat(n),c?"success":"failed",l);break}}}}splitMessage(t){if(t.length<Lh.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),i=on(6,"");let s=0,o=800;const c=Math.ceil(t.length/o);for(;t.length>0;){s++;const l={id:i,index:s,total:c,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(l).length>Lh.MAX_MESSAGE_SIZE?o-=50:(n.push(l),t=t.slice(o))}return n.map(l=>JSON.stringify(l))}handleCheckToken(t,n){return t.token!==n?(w.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{w.debug("token timeout, ".concat(n)),this.reset(t.uid)},W("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Dr(this.signal,Vn.CALL,void 0),n=await this.send(Vn.CALL,t);this.signal.emit(ht.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(Vf.ABORT),this.signal.emit(Pt.ON_USER_OFFLINE,{uid:r.uid,reason:Tz.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(w.debug("change local token from ".concat(n," to ").concat(n)),this.token=on(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Vf.ABORT)}}M(Lh,"MAX_SIZE",1),M(Lh,"MAX_MESSAGE_SIZE",1024);class rX extends bn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===hn.CONNECTED?this.emit(ht.WS_CONNECTED):t===hn.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===hn.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),M(this,"_disconnectedReason",void 0),M(this,"_websocketReconnectReason",void 0),M(this,"_connectionState",hn.CLOSED),M(this,"reconnectToken",void 0),M(this,"p2pToken",void 0),M(this,"websocket",void 0),M(this,"openConnectionTime",void 0),M(this,"clientId",void 0),M(this,"lastMsgTime",Date.now()),M(this,"uploadCache",[]),M(this,"uploadCacheInterval",void 0),M(this,"rttRolling",new bL(5)),M(this,"pingpongTimer",void 0),M(this,"pingpongTimeoutCount",0),M(this,"joinResponse",void 0),M(this,"multiIpOption",void 0),M(this,"initError",void 0),M(this,"spec",void 0),M(this,"store",void 0),M(this,"_external_signal",void 0),M(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Pt.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Pt.MUTE_AUDIO:case Pt.MUTE_VIDEO:case Pt.ON_P2P_LOST:case Pt.ON_USER_ONLINE:return;case Pt.ON_USER_OFFLINE:const{uid:s}=i._message;return w.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===Pt.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Pt.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Xt.UID_BANNED);break;case 15:this.close(Xt.IP_BANNED);break;case 16:this.close(Xt.CHANNEL_BANNED)}if(i._type===Pt.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case rt.ERR_LICENSE_MISSING:this.close(Xt.LICENSE_MISSING);break;case rt.ERR_LICENSE_EXPIRED:this.close(Xt.LICENSE_EXPIRED);break;case rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xt.LICENSE_MINUTES_EXCEEDED);break;case rt.ERR_LICENSE_PERIOD_INVALID:this.close(Xt.LICENSE_PERIOD_INVALID);break;case rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xt.LICENSE_MULTIPLE_SDK_SERVICE);break;case rt.ERR_LICENSE_ILLEGAL:this.close(Xt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Vb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hn.CONNECTED&&this.reconnect("retry",kr.OFFLINE)}),this.p2pToken=on(6,""),this._external_signal=new Lh(this,this.p2pToken)}async request(t,n,r,i){const s=on(6,""),o={_id:s,_type:t,_message:n},c=this.websocket.connectionID,l=()=>new je((D,A)=>{if(this.connectionState===hn.CONNECTED)return D();const P=()=>{this.off(ht.WS_CLOSED,j),D()},j=()=>{this.off(ht.WS_CONNECTED,P),A(new pe(F.WS_ABORT))};this.once(ht.WS_CONNECTED,P),this.once(ht.WS_CLOSED,j)});if(this.connectionState!==hn.CONNECTING&&this.connectionState!==hn.RECONNECTING||t===lt.JOIN||t===lt.REJOIN||await l(),this.websocket.sendMessage(o,!0),i)return;const p=new je((D,A)=>{let P=!1;const j=(G,Z)=>{P=!0,D({isSuccess:G==="success",message:Z||{}}),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.emit(ht.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(s),j);const V=()=>{A(new pe(F.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,V),this.off(ht.WS_RECONNECTING,V),this.off("res-@".concat(s),j)};this.once(ht.WS_CLOSED,V),this.once(ht.WS_RECONNECTING,V),Rr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||P||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,n))})});let m=null;try{m=await p}catch(D){if(this.connectionState===hn.CLOSED||t===lt.LEAVE)throw new pe(F.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?D.throw():t===lt.JOIN||t===lt.REJOIN?null:(await l(),await this.request(t,n))}if(m.isSuccess)return m.message;const E=Number(m.message.error_code||m.message.code),v=Gg(E),y=new pe(F.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:v.desc});return v.action==="success"?m.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(v.desc,", action: ").concat(v.action)),E===rt.ERR_TOO_MANY_BROADCASTERS?((t===lt.JOIN||t===lt.REJOIN)&&(this.initError=y,this.close()),y.throw()):v.action==="failed"?y.throw():v.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",kr.MULTI_IP)):this.reconnect(v.action,kr.SERVER_ERROR),t===lt.JOIN||t===lt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new je(r=>{const i=s=>{(!n||n(s))&&(this.off(t,i),r(s))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Bg.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const s=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new je((n,r)=>{this.once(ht.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ht.WS_CLOSED,()=>r(this.initError||new pe(F.WS_ABORT))),this.connectionState=hn.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Xt.LEAVE,this.connectionState=hn.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=on(6,""),this._external_signal.clear(),this._external_signal=new Lh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await Dr(this,ht.REQUEST_JOIN_INFO),n=await this.request(lt.JOIN,t);if(!n)return this.emit(ht.REPORT_JOIN_GATEWAY,F.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const r=ph(t.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||Ae(n=Object.values(Vn)).call(n,s._type)?(s._uid=t.uid,this._external_signal.onMessage(s)):this.emit(Pt.ON_DATA_STREAM,t)}catch{this.emit(Pt.ON_DATA_STREAM,t)}}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Gg(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xt.UID_BANNED),void this.close()):void this.reconnect(n.action,kr.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=W("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",kr.TIMEOUT):this.request(lt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),W("REPORT_STATS")&&this.send(lt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(vt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(vt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(vt.CLOSED,()=>{this.connectionState=hn.CLOSED}),this.websocket.on(vt.FAILED,()=>{this._disconnectedReason=Xt.NETWORK_ERROR,this.connectionState=hn.CLOSED}),this.websocket.on(vt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===hn.CONNECTED?this.connectionState=hn.RECONNECTING:this.connectionState=hn.CONNECTING}),this.websocket.on(vt.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(w.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):w.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(vt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof pe&&t.code===F.UNEXPECTED_RESPONSE&&t.data.code===rt.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",kr.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",kr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(vt.REQUEST_NEW_URLS,(t,n)=>{Dr(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const iX={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new nX(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new rX(n,t)}};function $6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Z6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$6(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$6(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class sX{constructor(t){M(this,"sessionDesc",void 0),M(this,"localCapabilities",void 0),M(this,"rtpCapabilities",void 0),M(this,"candidates",void 0),M(this,"_originCandidates",void 0),M(this,"iceParameters",void 0),M(this,"dtlsParameters",void 0),M(this,"setup",void 0),M(this,"currentMidIndex",void 0),M(this,"cname",void 0),t=Cn(t);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:c,sdkCodec:l,cname:p}=t,m=Gi(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=Cn(i),this.iceParameters=n,this.dtlsParameters=r,this.setup=o,this.localCapabilities=c,this.cname=p;for(let E=0;E<m.mediaDescriptions.length;E++){const v=m.mediaDescriptions[E];if(v.attributes.iceUfrag=n.iceUfrag,v.attributes.icePwd=n.icePwd,v.attributes.fingerprints=r.fingerprints,v.attributes.candidates=i,v.attributes.setup=o,v.media.mediaType==="video"){v.media.fmts=s.videoCodecs.map(A=>A.payloadType.toString(10));const y=s.videoCodecs.filter(A=>{var P,j;return(P=A.rtpMap)===null||P===void 0?void 0:Ae(j=P.encodingName.toLowerCase()).call(j,l)}),D=s.videoCodecs.filter(A=>!Ae(y).call(y,A));v.attributes.payloads=[...y,...D],v.attributes.extmaps=s.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=s.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=s.audioCodecs,v.attributes.extmaps=s.audioExtensions),m.mediaDescriptions[E]=this.mungMediaDesc(v)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return yd(this.sessionDesc)}send(t,n,r){const{ssrcs:i,ssrcGroups:s}=Yg(n,this.cname),o=this.sessionDesc.mediaDescriptions.find(p=>t===We.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio"),c=i[0].attributes.label,l=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(s),{id:c,mslabel:l}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:i}=n;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],i=[],s=[];n.attributes.ssrcs.forEach(o=>{Ae(t).call(t,o.attributes.label||"")?s.push(o):r.push(o)}),n.attributes.ssrcGroups.forEach(o=>{var c;Ae(c=s.map(l=>l.ssrcId)).call(c,o.ssrcIds[0])||i.push(o)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=i})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((i,s)=>{const o=i._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===o.kind),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],i);this.sessionDesc.mediaDescriptions[c]=l})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(n.forEach(i=>{r.push(Z6(Z6({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),n.length!==0){switch(t){case Gr.TCP_RELAY:this.candidates=r;break;case Gr.UDP_TCP_RELAY:case Gr.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Cn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Cn(t);return Bf(r,n),Wb(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const i=this.sessionDesc.mediaDescriptions.find(o=>t===We.VIDEO?o.attributes.mid==="video":o.attributes.mid==="audio");if(i){const o=i.attributes.ssrcs.find(c=>c.attributes.label===n);var s;o&&(o.attributes.label=r,(s=o.attributes.msid)===null||s===void 0||s.replace(n,r))}}mungMediaDesc(t){const n=Cn(t);return Bb(n),function(r){const i=r.attributes.extmaps.find(s=>iT(s.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(s=>{const o=s.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");o!==-1&&s.rtcpFeedbacks.splice(o,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var an;function e4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function HT(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e4(Object(n),!0).forEach(function(r){M(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let oX=(an=class IE extends pU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ae(n=Object.keys(Mg)).call(n,t)}))]}constructor(t,n){super(t,n),M(this,"store",void 0),M(this,"peerConnection",void 0),M(this,"remoteSDP",void 0),M(this,"initialOffer",void 0),M(this,"statsFilter",void 0),M(this,"useRTX",!1),M(this,"localCapabilities",void 0),M(this,"localCandidateCount",0),M(this,"allCandidatesReceived",!1),M(this,"establishPromise",void 0),M(this,"mutex",void 0),this.store=n,this.mutex=new Fr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(IE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=JR(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,Nn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Id(t.sdp),r=zg(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,HT(HT({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new pe(F.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new sX(HT(HT({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new pe(F.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return Js(function*(){const i=yield jt(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=t.map(v=>r.peerConnection.addTrack(v._mediaStreamTrack)),o=yield jt(r.peerConnection.createOffer()),c=Gi(o.sdp),l=t.map(v=>{const y=v._mediaStreamTrack,D=c.mediaDescriptions.find(A=>A.attributes.mid===y.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,P,j){const V=A.attributes.ssrcs.filter(Z=>Z.attributes.label===P),G=A.attributes.ssrcGroups;if(V.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(G&&V.length>1){const Z=G.find(Q=>Q.ssrcIds.indexOf(V[0].ssrcId)!==-1);return Z?[{ssrcId:Z.ssrcIds[0],rtx:j?Z.ssrcIds[1]:void 0}]:[{ssrcId:V[0].ssrcId}]}return[{ssrcId:V[0].ssrcId}]}(D,y.id,r.useRTX)});let p;try{p=yield l}catch(v){throw s.forEach(y=>{Pr()&&y.replaceTrack(null),r.peerConnection.removeTrack(y)}),v}const m=r.mungSendOfferSDP(o.sdp,t);r.remoteSDP.receive(t,n,p);const E=r.remoteSDP.toString();return yield jt(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield jt(r.applySendEncodings(s,t)),yield jt(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((v,y)=>{const D=v._mediaStreamTrack.id;return{localSSRC:l[y],id:D}})}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{Pr()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(t,n,i),c=new je((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(s)))},1e4),y=D=>{const A=xt();if((A.name==="Safari"&&Number(A.version)===11||Xr())&&D.track.id!==s&&D.streams[0].id===o){var P;const j=D.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(t,s,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(j)}if(D.track.id===s)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m(D.track)};this.peerConnection.addEventListener("track",y)}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await c,id:s}}catch(s){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Pr()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(s=>s.active=!1),r.setParameters(i)}})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(Pr()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach(c=>c.active=!0),await s.setParameters(o)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return Js(function*(){const r=yield jt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ft().supportPCSetConfiguration;if(t===Gr.RELAY&&!i)return;if(i){const p=n.peerConnection.getConfiguration(),m=t===Gr.RELAY?"relay":"all";p.iceTransportPolicy!==m&&(w.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(m,"]")),p.iceTransportPolicy=m,n.peerConnection.setConfiguration(p))}t!==Gr.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield jt(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Id(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString();yield jt(n.peerConnection.setLocalDescription(s)),yield jt(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(i){w.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new pe(F.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new pe(F.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new pe(F.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Pg(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...IE.turnServerConfigToIceServers(t.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...IE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(p=>{var m;return((m=p.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ft().supportSetRtpSenderParameters)return w.warn("Browser not support set rtp-sender parameters");const i={},s={};if(t instanceof mn)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(W("DSCP_TYPE")&&dl()){var o;const p=W("DSCP_TYPE");Ae(o=["very-low","low","medium","high"]).call(o,p)&&(s.networkPriority=p)}const c=n.getParameters(),l=(r=c.encodings)===null||r===void 0?void 0:r[0];l&&Object.assign(l,s),Object.assign(c,i),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await n.setParameters(c)}async applySendEncodings(t,n){try{if(!Ft().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const i=t[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=Gi(t);return n.forEach((i,s)=>{const o=i._mediaStreamTrack,c=r.mediaDescriptions.find(l=>l.attributes.mid===o.kind);c&&Bf(c,i)}),yd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((s,o)=>{let{id:c,mslabel:l}=s;const{kind:p}=t[o];return new je((m,E)=>{const v=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),y=D=>{const A=xt();if(A.name==="Safari"&&Number(A.version)===11&&D.track.id!==c&&D.streams[0].id===l){var P;const j=D.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(p,c,D.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:j,id:c})}if(D.track.id===c)return this.peerConnection.removeEventListener("track",y),clearTimeout(v),void m({track:D.track,id:c})};this.peerConnection.addEventListener("track",y)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await je.all(n)}catch(n){throw new pe(F.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId}setConfiguration(t){if(Ft().supportPCSetConfiguration){const n=IE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},qe(an.prototype,"connect",[so],Object.getOwnPropertyDescriptor(an.prototype,"connect"),an.prototype),qe(an.prototype,"stopSending",[so],Object.getOwnPropertyDescriptor(an.prototype,"stopSending"),an.prototype),qe(an.prototype,"receive",[so],Object.getOwnPropertyDescriptor(an.prototype,"receive"),an.prototype),qe(an.prototype,"stopReceiving",[so],Object.getOwnPropertyDescriptor(an.prototype,"stopReceiving"),an.prototype),qe(an.prototype,"muteRemote",[so],Object.getOwnPropertyDescriptor(an.prototype,"muteRemote"),an.prototype),qe(an.prototype,"unmuteRemote",[so],Object.getOwnPropertyDescriptor(an.prototype,"unmuteRemote"),an.prototype),qe(an.prototype,"muteLocal",[so],Object.getOwnPropertyDescriptor(an.prototype,"muteLocal"),an.prototype),qe(an.prototype,"unmuteLocal",[so],Object.getOwnPropertyDescriptor(an.prototype,"unmuteLocal"),an.prototype),qe(an.prototype,"close",[so],Object.getOwnPropertyDescriptor(an.prototype,"close"),an.prototype),qe(an.prototype,"updateEncoderConfig",[so],Object.getOwnPropertyDescriptor(an.prototype,"updateEncoderConfig"),an.prototype),qe(an.prototype,"updateSendParameters",[so],Object.getOwnPropertyDescriptor(an.prototype,"updateSendParameters"),an.prototype),qe(an.prototype,"replaceTrack",[so],Object.getOwnPropertyDescriptor(an.prototype,"replaceTrack"),an.prototype),qe(an.prototype,"getRemoteSSRC",[so],Object.getOwnPropertyDescriptor(an.prototype,"getRemoteSSRC"),an.prototype),an);function so(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(t));try{for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return await r.apply(this,c)}finally{s()}},n}const aX={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new oX(n,t)}},cX={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(By.has(e)||!e.track)return;const n={track:e.track};if(ll()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void w.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=t.metadata&&t.metadata();l?function(p,m){const{chunk:E,controller:v}=m,y=Td.METADATA;E.data=function(D,A,P){const j=P.byteLength,V=j+yb+JM,G=vb+Sb+V,Z=new ArrayBuffer(D.byteLength+G),Q=new DataView(Z);Q.setUint8(0,XM),Q.setUint16(1,V),Q.setUint8(3,A),Q.setUint16(4,j);for(let ie=0;ie<j;ie++)Q.setUint8(6+ie,P[ie]);const z=new Uint8Array(Q.buffer);return z.set(new Uint8Array(D),G),z.buffer}(E.data,y,p),v.enqueue(E)}(l,{chunk:o,controller:c}):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Pr()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=Fy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;if(c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id)w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(c.data.getMetadata){const p=t.metadata&&t.metadata();p&&s.port1.postMessage({metadata:p})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=By.get(e);if(i){By.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){w.warning(c&&c.message)}}}By.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(Yy.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ll()&&!Xr()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");NR(Wt.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(o){return void w.error("create audio-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(l,p,m){var E;const v=Tb(new DataView(p.data));if(!v)return m.enqueue(p);const y=l.track.id;GK.set(y,l.track);const D=(E=v.tlv.find(Z=>Z.tag===Td.AUDIO_LEVEL))===null||E===void 0?void 0:E.value;let A=0;typeof D=="number"&&(A=127-D);const P=Math.round(Math.pow(10,A/60)-1),{selected:j,speaker:V}=function(Z,Q){let z=Lf.get(Z);if(z||(z=function(ie){const fe=new $M;return Lf.set(ie,fe),ya||(ya=new BK(W("TOPN_SILENCE_THRESHOLD")||500),ya.on("ActiveSpeakerChanged",ve=>{ve!=null&&(Hy=ve)})),ya.addSpeakers([fe]),fe}(Z)),Lf.size<=ZM)return{selected:!0,speaker:z};if(!ya)throw new Error("no active speaker detector");return ya.levelChanged(z.id,Q),Sh=ya.loudest.map(ie=>ie.id),Hy&&!Ae(Sh).call(Sh,Hy)&&Sh.length>=ZM&&Sh.pop(),{selected:Ae(Sh).call(Sh,z.id)||z.id===Hy,speaker:z}}(l,P),G=function(Z,Q,z){const ie=Ta.get(Z)||new WK(Z,Q);return ie.score=z,Ta.set(Z,ie),function(fe){if(Ky.set(fe,!0),!zy)return void(zy=Date.now());const ve=Date.now();ve-zy>1e3&&(Ky.get(fe)?Ky.set(fe,!1):(eU(fe),Ky.delete(fe)),zy=ve)}(Z),ie}(y,l.track,V.energyScore);G.addSample(j),G.active&&(p.data=v.frame.buffer,m.enqueue(p))}(e,o,c):t.enableMetadata||t.enablePts?function(l,p,m,E){const v=new DataView(l.data),y=v.getUint8(0);let D;if((128&y)!=0&&y!==71){const j=function(V){if(V.byteLength<=0)return[];const G=[];let Z=0;for(;Z<V.byteLength;){const z=(128&V.getUint8(Z))>>7,ie=127&V.getUint8(Z);if(!(z&&Z+4<=V.byteLength)){Z++;break}{const fe=V.getUint32(Z,!1),ve=(16776192&fe)>>10,we=1023&fe;G.push({pt:ie,ts_offset:ve,length:we,data:new Uint8Array}),Z+=4}}let Q=V.byteLength-Z;for(const z of G){if(z.length>Q)return console.warn("Broken red payload"),[];z.length>0&&(z.data=new Uint8Array(V.buffer,V.byteOffset+Z,z.length),Z+=z.length,Q-=z.length)}if(Q>0){const z={pt:G.length>0?G[G.length-1].pt:0,ts_offset:0,length:Q,data:new Uint8Array(V.buffer,V.byteOffset+Z,Q)};G.push(z)}return G}(v);if(j.length>0){const V=function(G){let Z=0;for(let ie=0;ie<G.length;ie++)Z+=ie<G.length-1?4:1,Z+=G[ie].length;const Q=new Uint8Array(Z);let z=0;for(let ie=0;ie<G.length;ie++)if(ie<G.length-1){const fe=(2147483648|(127&G[ie].pt)<<24|(262143&G[ie].ts_offset)<<10|1023&G[ie].length)>>>0;Q[z++]=fe>>24&255,Q[z++]=fe>>16&255,Q[z++]=fe>>8&255,Q[z++]=255&fe}else Q[z++]=127&G[ie].pt;for(const ie of G)Q.set(ie.data,z),z+=ie.length;return Q}(j.map(G=>{const Z=new Uint8Array(G.length);Z.set(G.data);const Q=Tb(new DataView(Z.buffer));return Q!=null&&Q.frame&&(G.data=Q?.frame),D=Q,G}));l.data=V.buffer}}else D=Tb(v),D&&(l.data=D.frame.buffer);if(p.enqueue(l),!D)return;const A=D.tlv.find(j=>j.tag===Td.METADATA);A&&m&&A.value instanceof Uint8Array&&m(A.value);const P=D.tlv.find(j=>j.tag===Td.AUDIO_64_BIT_PTS);P&&E&&P.value instanceof Uint8Array&&P.value.length==8&&E(new DataView(P.value.buffer).getBigUint64(0,!0))}(o,c,t.onMetadata,t.onPts):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=Fy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.metadata&&n.onMetadata?n.onMetadata(c.data.metadata):c.data.pts&&n.onPts&&n.onPts(c.data.pts)},n.worker=i}function r(){e.track.removeEventListener("ended",r),function(i){const s=Yy.get(i);if(s){(function(l){const p=Lf.get(l);p&&(Lf.delete(l),ya&&(ya.removeSpeakers([p]),Lf.size===0&&(ya.destroy(),ya=null)))})(i),eU(i.track.id),Yy.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){w.warning(l&&l.message)}}}(e)}Yy.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ft().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(qy.has(e)||!e.track)return;const n={track:e.track};if(ll()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(c){return void w.error("create video-encoded-streams error",c&&c.message)}const s=[];t.on("sei-to-send",c=>{s.push(c)});const o=new TransformStream({transform(c,l){n.controller||(n.controller=l),e.track&&e.track.id!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const p=rU(new Uint8Array(c.data)),m=s.shift();if(m){const E=function(v,y,D){switch(D){case bb:return function(A,P){const j=nU(P),V=j.length,G=Math.floor(V/255),Z=V%255,Q=new Uint8Array(6+G+1+V+A.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=6,Q[5]=101;let z=0;for(;z<G;)Q[6+z]=255,z++;return Q[6+z]=Z,z++,Q.set(j,6+z),Q.set(new Uint8Array(A),6+z+V),Q.buffer}(v,y);case Ib:return function(A,P){const j=nU(P),V=j.length,G=Math.floor(V/255),Z=V%255,Q=new Uint8Array(7+G+1+V+1+A.byteLength);Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q[4]=78,Q[5]=1,Q[6]=101;let z=0;for(;z<G;)Q[7+z]=255,z++;return Q[7+z]=Z,z++,Q.set(j,7+z),z+=V,Q[7+z]=128,z++,Q.set(new Uint8Array(A),7+z),Q.buffer}(v,y);default:return null}}(c.data,m,p);E&&(c.data=E)}l.enqueue(c)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!Pr())return;{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=Fy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),t.on("sei-to-send",c=>{s.port1.postMessage({sei:c})}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=qy.get(e);if(i){qy.delete(e);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){w.warning(c&&c.message)}}}qy.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ft().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(!e.track)return;if(Fg.has(e)){const i=Fg.get(e);return void(i&&(i.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ll()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(o){return void w.error("create video-encoded-streams error",o&&o.message)}const s=new TransformStream({transform(o,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const l=function(p,m){switch(m){case bb:return function(E){const v=new DataView(E.data);let y=0;for(;y+4<E.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===6){let D=y+6,A=0,P=0;for(;(P=v.getUint8(D++))===255;)A+=255;A+=P;const j=tU(E.data,D,A);return new Uint8Array(j)}y++}return null}(p);case Ib:return function(E){const v=new DataView(E.data);let y=0;for(;y+5<E.data.byteLength;){if(v.getUint8(y+0)===0&&v.getUint8(y+1)===0&&v.getUint8(y+2)===0&&v.getUint8(y+3)===1&&v.getUint8(y+4)===78&&v.getUint8(y+5)===1&&v.getUint8(y+6)===101){let D=y+7,A=0,P=0;for(;(P=v.getUint8(D++))===255;)A+=255;A+=P;const j=tU(E.data,D,A);return new Uint8Array(j)}y++}return null}(p);default:return null}}(o,rU(new Uint8Array(o.data)));l&&n.onSei&&n.onSei(l),c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(Pr()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const i=Fy(),s=new MessageChannel;await new je(c=>i.onmessage=l=>{l.data==="registered"&&c(void 0)});const o=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);e.transform=o,await new je(c=>i.onmessage=l=>{l.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var l;c.data.transformed&&e.track&&((l=e.track)===null||l===void 0?void 0:l.id)!==n.track.id?(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):c.data.sei&&n.onSei&&n.onSei(c.data.sei)},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const s=Fg.get(i);if(s){Fg.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(l){w.warning(l&&l.message)}}})(e)}Fg.set(e,n),e.track.addEventListener("ended",r)}},lX={name:"InterceptFrame",create:()=>cX};QR(),Zt("PROCESS_ID","process-".concat(on(8,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();w.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Sn,r)){const{value:i,expires:s}=t[r];if(s&&s<=n)return;Sa[r]=i,Sn[r]=i}})}catch(t){w.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Sa.AREAS)&&Sa.AREAS.length>0&&zb(Sa.AREAS,!0);const t4=(e,t,n)=>{w.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Zt(e,t,n)};Nd(kq,!1),Nd(xq,!1),Nd(fY,!1),Nd(zq,!1),Nd(Oq,!1),Nd(iX,!1),Nd(aX,!1),Nd(lX,!1);const Xn=function(e){const t=new bn,n=e,r={getListeners:t.getListeners.bind(t),on:(i,s)=>(function(o,c){o===Cc.SECURITY_POLICY_VIOLATION&&xV(c,!0)}(i,s),t.on.bind(t)(i,s)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return LV(LV({},n),r)}({__TRACK_LIST__:Rf,VERSION:Qs,BUILD:eb,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:t4,getParameter:W,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let i;return Ft().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!n)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(t){throw new ae(F.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=Xe.reportApiInvoke(null,{name:xn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Tn.TRACER});let t=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;t=!!(s&&o&&c),t&&MR()&&tL(75)&&new s().close()}catch(s){return w.error("check system requirement failed: ",s),!1}let n=!1;const r=xt();r.name===Wt.CHROME&&Number(r.version)>=58&&(ga.engine.name!=="WebKit"||function(){const s=xt();if(Cy()){if(s.os===dr.MAC_OS)return!0;if(s.os===dr.IOS){const o=ga.os.version&&ga.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Wt.FIREFOX&&Number(r.version)>=56||r.name===Wt.OPERA&&Number(r.version)>=45||r.name===Wt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Xr()||xo())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||aL()||xt().name===Wt.QQ)&&(n=!0),w.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return As.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return As.getRecordingDevices(e)},getCameras:function(e){return As.getCamerasDevices(e)},getElectronScreenSources:tx,getPlaybackDevices:function(e){return As.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=on(5,"client-"),r=Xe.reportApiInvoke(null,{id:n,name:xn.CREATE_CLIENT,options:[t],tag:Tn.TRACER});try{(function(i){ir(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ir(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&ir(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&wr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&mL(i.turnServer),i.httpRetryConfig!==void 0&&fL(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&fL(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(iL(16,0)||DR(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",w.debug("browser not support vp9, force use vp8")),Zt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new mY(Ho(Ho({forceWaitGatewayResponse:!0},t),{},{role:Ae(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=W("CAMERA_CAPTURE_CONFIG"),n=on(8,"track-cam-"),r=Xe.reportApiInvoke(null,{id:n,tag:Tn.TRACER,name:xn.CREATE_CAM_VIDEO_TRACK,options:[un({},e),t]});t&&(e.encoderConfig=t);const i=Vy(e);let s=null;w.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{s=(await Is({video:i},n)).getVideoTracks()[0]||null}catch(c){throw r.onError(c),c}if(!s){const c=new pe(F.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(c),c.throw(w)}if(e.optimizationMode&&Eb(n,s,e,Vo(e.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const c=Vo(e.encoderConfig);e.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}const o=new jy(s,e,i,e.scalabiltyMode?Ly(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(o.getTrackId()),w.info("create camera video success, trackId:",n),o},createCustomVideoTrack:function(e){const t=on(8,"track-cus-"),n=Xe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});W("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new mn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Ly(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[rn.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),w.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(v){return ux(v)}(t):void 0;n&&(t="auto");const r=on(8,"track-scr-v-"),i=Xe.reportApiInvoke(null,{id:r,tag:Tn.TRACER,name:xn.CREATE_SCREEN_VIDEO_TRACK,options:[un({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const s=function(v){const y={};v.screenSourceType&&(y.mediaSource=v.screenSourceType),v.extensionId&&ll()&&(y.extensionId=v.extensionId);const{displaySurface:D,selfBrowserSurface:A,surfaceSwitching:P,systemAudio:j,preferCurrentTab:V}=v;(_f(107)||PR(107)||LR(93))&&(D&&(ir(D,"displaySurface",["browser","window","monitor"]),y.displaySurface=D),A?(ir(A,"selfBrowserSurface",["exclude","include"]),y.selfBrowserSurface=A):y.selfBrowserSurface="include",P&&(ir(P,"surfaceSwitching",["exclude","include"]),y.surfaceSwitching=P)),(_f(105)||PR(105)||LR(91))&&j&&(ir(j,"systemAudio",["exclude","include"]),y.systemAudio=j),(_f(94)||PR(94)||LR(80))&&V&&(y.preferCurrentTab=!0),v.electronScreenSourceId&&(y.sourceId=v.electronScreenSourceId);const G=v.encoderConfig?ob(v.encoderConfig):null;return y.mandatory={chromeMediaSource:"desktop",maxWidth:G?G.width:void 0,maxHeight:G?G.height:void 0},G&&(G.frameRate&&(typeof G.frameRate=="number"?(y.mandatory.maxFrameRate=G.frameRate,y.mandatory.minFrameRate=G.frameRate):(y.mandatory.maxFrameRate=G.frameRate.max||G.frameRate.ideal||G.frameRate.exact||void 0,y.mandatory.minFrameRate=G.frameRate.min||G.frameRate.ideal||G.frameRate.exact||void 0),y.frameRate=G.frameRate),G.width&&(y.width=G.width),G.height&&(y.height=G.height)),y}(e);let o=null,c=null;const l=Ft();if(!l.supportShareAudio&&t==="enable"){const v=new pe(F.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(v),v.throw(w)}w.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const p=l.supportShareAudio&&t!=="disable";try{const v=await Is({screen:s,screenAudio:p?n||!0:void 0},r);o=v.getVideoTracks()[0]||null,c=v.getAudioTracks()[0]||null}catch(v){throw i.onError(v),v}if(!o){const v=new pe(F.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(v),v.throw(w)}if(!c&&t==="enable"){o&&o.stop();const v=new pe(F.SHARE_AUDIO_NOT_ALLOWED);return i.onError(v),v.throw(w)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Eb(r,o,e,e.encoderConfig&&ob(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const m=new mn(o,e.encoderConfig?ob(e.encoderConfig):{},e.scalabiltyMode?Ly(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[rn.SCREEN_TRACK]);if(!c)return i.onSuccess(m.getTrackId()),w.info("create screen video track success","video:",m.getTrackId()),m;const E=new Ln(c,void 0,on(8,"track-scr-a-"),!1);return i.onSuccess([m.getTrackId(),E.getTrackId()]),w.info("create screen video track success","video:",m.getTrackId(),"audio:",E.getTrackId()),[m,E]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=W("CAMERA_CAPTURE_CONFIG"),r=on(8,"track-mic-"),i=on(8,"track-cam-"),s=Xe.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:Tn.TRACER,name:xn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const o=Vy(t),c=hx(e);let l=null,p=null;w.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const v=await Is({audio:c,video:o},"".concat(r,"-").concat(i));l=v.getAudioTracks()[0],p=v.getVideoTracks()[0]}catch(v){throw s.onError(v),v}if(!l||!p){const v=new pe(F.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(v),v.throw(w)}if(t.optimizationMode&&Eb(i,p,t,Vo(t.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const v=Vo(t.encoderConfig);t.encoderConfig=v,delete v.bitrateMax,delete v.bitrateMin}const m=new jg(l,e,c,r),E=new jy(p,t,o,t.scalabiltyMode?Ly(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess([m.getTrackId(),E.getTrackId()]),w.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[m,E]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=on(8,"track-mic-"),n=Xe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=hx(e);let i=null;w.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Is({audio:r},t)).getAudioTracks()[0]||null}catch(o){throw n.onError(o),o}if(!i){const o=new pe(F.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(o),o.throw(w)}const s=new jg(i,e,r,t);return n.onSuccess(s.getTrackId()),w.info("create microphone audio track success, trackId:",t),s},createCustomAudioTrack:function(e){const t=on(8,"track-cus-"),n=Xe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:xn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Ln(e.mediaStreamTrack,e.encoderConfig?xy(e.encoderConfig):{},t,!1);return w.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:n,encoderConfig:r},o=on(8,"track-buf-"),c=Xe.reportApiInvoke(null,{id:o,tag:Tn.TRACER,name:xn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(W("DISABLE_WEBAUDIO"))throw new pe(F.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");w.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);const l=i;if(!(i instanceof AudioBuffer))try{i=await async function(E,v){let y=null;if(typeof E=="string"){const A=$x.get(E);if(A)return w.debug("use cached audio resource: ",E),A;try{y=(await va(()=>Ai.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(P){throw new pe(F.FETCH_AUDIO_FILE_FAILED,P.toString())}}else y=await new je((P,j)=>{const V=new FileReader;V.onload=G=>{G.target?P(G.target.result):j(new pe(F.READ_LOCAL_AUDIO_FILE_ERROR))},V.onerror=()=>{j(new pe(F.READ_LOCAL_AUDIO_FILE_ERROR))},V.readAsArrayBuffer(E)});const D=await function(A){const P=Nf();return new je((j,V)=>{P.decodeAudioData(A,G=>{j(G)},G=>{V(new pe(F.DECODE_AUDIO_FILE_FAILED,G.toString()))})})}(y);return typeof E=="string"&&v&&$x.set(E,D),D}(i,n)}catch(E){return c.onError(E),E.throw(w)}const p=new MK(i),m=new xK(l,p,r?xy(r):{},o);return w.info("create buffer source audio track success, trackId:",o),c.onSuccess(m.getTrackId()),m},setAppType:function(e){if(w.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw w.debug("Invalid appType"),new ae(F.INVALID_PARAMS,"invalid app type",e);Zt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){w.setLogLevel(e)},enableLogUpload:function(){W("USE_NEW_LOG")?Zt("UPLOAD_LOG",!0):w.enableLogUpload()},disableLogUpload:function(){W("USE_NEW_LOG")?Zt("UPLOAD_LOG",!1):w.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new t5},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Xe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ln||e instanceof Df)){const l=new ae(F.INVALID_TRACK,"the parameter is not a audio track");return n.onError(l),l.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Ln?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let s=i,o=i;const c=Date.now();return new je(l=>{const p=setInterval(()=>{const m=e.getVolumeLevel();s=m>s?m:s,o=m<o?m:o;const E=s-o>1e-4,v=Date.now()-c;if(E||v>t){clearInterval(p);const y=E,D={duration:v,deviceLabel:r,maxVolumeLevel:s,result:y};w.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),n.onSuccess(D),l(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Xe.reportApiInvoke(null,{tag:Tn.TRACER,name:xn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof mn||e instanceof kf)){const E=new ae(F.INVALID_TRACK,"the parameter is not a video track");return n.onError(E),E.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof mn?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Pr()||Cy())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let c=0,l=0;try{const E=Date.now();c=await function(v,y,D,A){let P,j=0,V=null;return new je((G,Z)=>{function Q(){j>A&&P&&(P(),G(j));const z=D.getContext("2d");if(!z){const ve=new ae(F.UNEXPECTED_ERROR,"can not get canvas 2d context.");return w.error(ve.toString()),void Z(ve)}z.drawImage(v,0,0,160,120);const ie=z.getImageData(0,0,D.width,D.height),fe=Math.floor(ie.data.length/3);if(V){for(let ve=0;ve<fe;ve+=3)if(ie.data[ve]!==V[ve])return j+=1,void(V=ie.data);V=ie.data}else V=ie.data}setTimeout(()=>{P&&(P(),G(j))},y),P=ub(()=>{Q()},30)})}(s,t,o,4),l=Date.now()-E}catch(E){throw n.onError(E),E}tY===Wt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const p=c>4,m={duration:l,changedPicNum:c,deviceLabel:r,result:p};return w.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),p},setArea:zb,audioElementPlayCenter:Oi,resumeAudioContext:function(){Oi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){gY.processExternalMediaAEC(e)},registerExtensions:function(e){const t=W("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Ae(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=w.extLog,r.reporter.hookApiInvoke=Xe.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=W(i)})}),t4("PLUGIN_INFO",t)},ChannelMediaRelayError:Mf,ChannelMediaRelayEvent:pl,ChannelMediaRelayState:Ki,RemoteStreamFallbackType:AK,RemoteStreamType:IK,ConnectionDisconnectedReason:Xt,AudienceLatencyLevelType:iK,AREAS:zt,preload:async function(e,t,n,r){return R5(e,t,n,r)}});return Object.defineProperties(Xn,{onAudioAutoplayFailed:{get:()=>Os.onAudioAutoplayFailed,set:e=>{Os.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Os.onAutoplayFailed,set:e=>{Os.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Xn._onSecurityPolicyViolation,set(e){Xn._onSecurityPolicyViolation=e,xV(e)}},__CLIENT_LIST__:{get:()=>W("SHOW_GLOBAL_CLIENT_LIST")?yh:[]}}),As.on(gh.CAMERA_DEVICE_CHANGED,e=>{w.info("camera device changed",JSON.stringify(e)),Xn.onCameraChanged&&Xn.onCameraChanged(e),Xn.safeEmit(Cc.CAMERA_CHANGED,e)}),As.on(gh.RECORDING_DEVICE_CHANGED,e=>{w.info("microphone device changed",JSON.stringify(e)),Xn.onMicrophoneChanged&&Xn.onMicrophoneChanged(e),Xn.safeEmit(Cc.MICROPHONE_CHANGED,e)}),As.on(gh.PLAYOUT_DEVICE_CHANGED,e=>{w.debug("playout device changed",JSON.stringify(e)),Xn.onPlaybackDeviceChanged&&Xn.onPlaybackDeviceChanged(e),Xn.safeEmit(Cc.PLAYBACK_DEVICE_CHANGED,e)}),Oi.onAutoplayFailed=()=>{w.info("detect audio element autoplay failed"),Os.onAudioAutoplayFailed&&Os.onAudioAutoplayFailed()},en.on("autoplay-failed",()=>{w.info("detect webaudio autoplay failed"),Os.onAudioAutoplayFailed&&Os.onAudioAutoplayFailed(),Xn.safeEmit(Cc.AUTOPLAY_FAILED)}),en.on(Ir.STATE_CHANGE,(e,t)=>{w.info("audio context state changed: ".concat(t," => ").concat(e)),Xn.onAudioContextStateChanged&&Xn.onAudioContextStateChanged(e,t),Xn.safeEmit(Cc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Gn.on(Ef.NETWORK_STATE_CHANGE,(e,t)=>{w.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Xn),Xn})}(h0)),h0.exports}var mne=fne();const RE=S0(mne);class _ne{client=null;callState={isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}};callbacks={};currentChannelInfo=null;isJoining=!1;inactivityTimer=null;lastActivityTime=Date.now();INACTIVITY_TIMEOUT=300*1e3;isRenewingToken=!1;microphoneRetryCount=0;MAX_MICROPHONE_RETRY=2;reconnectAttempts=0;MAX_RECONNECT_ATTEMPTS=3;isReconnecting=!1;constructor(){RE.setLogLevel(4);try{RE.enableLogUpload(!1)}catch{}try{RE.setLogLevel(2)}catch{}}setCallbacks(h){this.callbacks={...this.callbacks,...h}}getCallState(){return{...this.callState}}async joinChannel(h){if(!this.isJoining)try{this.isJoining=!0,(this.callState.isConnecting||this.callState.isConnected||this.client)&&(await this.forceLeaveChannel(),await new Promise(f=>setTimeout(f,200))),this.callState.isConnecting=!0,this.currentChannelInfo=h,this.client&&(this.client=null),this.client=RE.createClient({mode:"rtc",codec:"vp8"});try{this.client.enableDualStream}catch{}this.setupEventListeners(),await this.createLocalAudioTrack(),await this.client.join(h.appId,h.channelName,h.token,h.uid),this.callState.localAudioTrack?await this.client.publish([this.callState.localAudioTrack]):console.error("       "),this.callState.isConnected=!0,this.callState.isConnecting=!1,this.callbacks.onCallStarted?.(),this.startInactivityTimer(),this.isJoining=!1}catch(f){throw console.error(" Agora   :",f),this.callState.isConnecting=!1,this.isJoining=!1,this.callbacks.onError?.(f),f}}async forceLeaveChannel(){try{if(this.callState.localAudioTrack){try{this.client&&await this.client.unpublish([this.callState.localAudioTrack])}catch{}try{this.callState.localAudioTrack.stop(),this.callState.localAudioTrack.close()}catch{}this.callState.localAudioTrack=null}if(this.client){try{try{typeof this.client.enableLogUpload=="function"&&this.client.enableLogUpload(!1)}catch{}const h=this.client.leave(),f=new Promise((g,S)=>setTimeout(()=>S(new Error("Leave timeout")),3e3));await Promise.race([h,f])}catch{}this.client=null}this.stopInactivityTimer(),this.callState.isConnected=!1,this.callState.isConnecting=!1,this.callState.connectionState="DISCONNECTED",this.callState.remoteAudioTrack=null,this.currentChannelInfo=null,this.isJoining=!1,await new Promise(h=>setTimeout(h,100))}catch(h){console.error("    :",h),this.stopInactivityTimer(),this.callState.isConnected=!1,this.callState.isConnecting=!1,this.callState.connectionState="DISCONNECTED",this.callState.localAudioTrack=null,this.callState.remoteAudioTrack=null,this.currentChannelInfo=null,this.client=null,this.isJoining=!1}}startInactivityTimer(){this.stopInactivityTimer(),this.lastActivityTime=Date.now(),this.inactivityTimer=setInterval(()=>{Date.now()-this.lastActivityTime>=this.INACTIVITY_TIMEOUT&&(console.warn(" 5      ( )"),this.handleInactivityTimeout())},3e4)}stopInactivityTimer(){this.inactivityTimer&&(clearInterval(this.inactivityTimer),this.inactivityTimer=null)}updateActivity(){this.lastActivityTime=Date.now()}async handleInactivityTimeout(){try{console.warn("   -   "),this.callbacks.onError?.(new Error("     .")),await this.leaveChannel()}catch(h){console.error("   :",h)}}async leaveChannel(){try{if(this.stopInactivityTimer(),this.callState.localAudioTrack&&this.client){try{await this.client.unpublish([this.callState.localAudioTrack])}catch(h){console.error("      :",h)}this.callState.localAudioTrack.stop(),this.callState.localAudioTrack.close(),this.callState.localAudioTrack=null}if(this.callState.remoteAudioTrack&&(this.callState.remoteAudioTrack.stop(),this.callState.remoteAudioTrack=null),this.client){try{try{typeof this.client.enableLogUpload=="function"&&this.client.enableLogUpload(!1)}catch{}await this.client.leave()}catch(h){console.error("   :",h)}this.client=null}this.callState={isConnected:!1,isConnecting:!1,isMuted:!1,isSpeakerOn:!0,localAudioTrack:null,remoteAudioTrack:null,volume:100,connectionState:"DISCONNECTED",networkQuality:{uplinkNetworkQuality:0,downlinkNetworkQuality:0}},this.isJoining=!1,this.currentChannelInfo=null,this.callbacks.onCallEnded?.()}catch(h){throw console.error("Agora   :",h),this.callbacks.onError?.(h),h}}async toggleMute(){try{if(!this.callState.localAudioTrack)throw new Error("   .");const h=!this.callState.isMuted;return await this.callState.localAudioTrack.setMuted(h),this.callState.isMuted=h,h}catch(h){throw console.error("  :",h),this.callbacks.onError?.(h),h}}async setMuted(h){try{if(!this.callState.localAudioTrack)throw new Error("   .");await this.callState.localAudioTrack.setMuted(h),this.callState.isMuted=h}catch(f){throw console.error("   :",f),this.callbacks.onError?.(f),f}}async toggleSpeaker(){try{const h=!this.callState.isSpeakerOn;return this.callState.remoteAudioTrack&&await this.callState.remoteAudioTrack.setVolume(h?100:0),this.callState.isSpeakerOn=h,h}catch(h){throw console.error("  :",h),this.callbacks.onError?.(h),h}}async setVolume(h){try{if(h<0||h>100)throw new Error(" 0-100   .");this.callState.volume=h,this.callState.remoteAudioTrack&&await this.callState.remoteAudioTrack.setVolume(h)}catch(f){throw console.error("  :",f),this.callbacks.onError?.(f),f}}async createLocalAudioTrack(){try{this.callState.localAudioTrack=await RE.createMicrophoneAudioTrack({encoderConfig:"music_standard",AEC:!0,ANS:!0,AGC:!0}),this.microphoneRetryCount=0}catch(h){if(console.error("    :",h),h instanceof Error&&(h.message.includes("Permission denied")||h.message.includes("NotAllowedError")||h.message.includes("PERMISSION_DENIED"))&&(console.error("   "),this.callbacks.onMicrophonePermissionDenied?.(),this.microphoneRetryCount<this.MAX_MICROPHONE_RETRY))return this.microphoneRetryCount++,console.warn(`    ... (${this.microphoneRetryCount}/${this.MAX_MICROPHONE_RETRY})`),await new Promise(f=>setTimeout(f,3e3)),this.createLocalAudioTrack();throw h}}setupEventListeners(){this.client&&(this.client.on("connection-state-change",(h,f,g)=>{this.callState.connectionState=h,this.callbacks.onConnectionStateChange?.(h),h==="DISCONNECTED"&&(this.callState.isConnected=!1,g==="LEAVE"?(this.reconnectAttempts=0,this.isReconnecting=!1):(console.error("    :",g),this.handleUnexpectedDisconnection(g)))}),this.client.on("user-joined",h=>{this.callbacks.onUserJoined?.(h.uid.toString())}),this.client.on("user-left",(h,f)=>{this.callbacks.onUserLeft?.(h.uid.toString())}),this.client.on("user-published",async(h,f)=>{if(f==="audio"){await this.client.subscribe(h,f);const g=h.audioTrack;g&&(g.play(),this.updateActivity())}}),this.client.on("user-unpublished",(h,f)=>{f==="audio"&&this.callbacks.onAudioTrackUnsubscribed?.(h.uid.toString())}),this.client.on("user-audio-track-subscribed",(h,f)=>{this.callState.remoteAudioTrack=f,this.callbacks.onAudioTrackSubscribed?.(h.uid.toString(),f),this.updateActivity()}),this.client.on("token-privilege-will-expire",()=>{console.warn(" Agora RTC  30   -  "),!this.isRenewingToken&&(this.isRenewingToken=!0,this.callbacks.onTokenPrivilegeWillExpire?.())}),this.client.on("token-privilege-did-expire",()=>{console.error(" Agora RTC   -   "),this.callbacks.onTokenPrivilegeDidExpire?.()}),this.client.on("network-quality",h=>{const f={uplinkNetworkQuality:h.uplinkNetworkQuality,downlinkNetworkQuality:h.downlinkNetworkQuality};this.callState.networkQuality=f,this.callbacks.onNetworkQualityChange?.(f)}),this.client.on("exception",h=>{console.error(" Agora SDK  :",h);const f=String(h.code||"");f==="FRAMERATE_INPUT_TOO_LOW"||f==="FRAMERATE_SENT_TOO_LOW"||f==="SEND_VIDEO_BITRATE_TOO_LOW"||f==="RECV_VIDEO_DECODE_FAILED"||this.callbacks.onException?.({code:f,msg:String(h.msg||""),uid:String(h.uid||"unknown")})}))}getNetworkQualityLabel(h){return{0:"",1:"",2:"",3:"",4:"",5:"",6:""}[h]}async handleUnexpectedDisconnection(h){if(!this.isReconnecting){if(this.reconnectAttempts>=this.MAX_RECONNECT_ATTEMPTS){console.error(`    (${this.MAX_RECONNECT_ATTEMPTS}) `),this.callbacks.onError?.(new Error("    .  ."));return}this.isReconnecting=!0,this.reconnectAttempts++,console.warn(`   ... (${this.reconnectAttempts}/${this.MAX_RECONNECT_ATTEMPTS})`);try{await new Promise(f=>setTimeout(f,2e3)),this.currentChannelInfo&&this.client&&(await this.client.join(this.currentChannelInfo.appId,this.currentChannelInfo.channelName,this.currentChannelInfo.token,this.currentChannelInfo.uid),this.callState.localAudioTrack&&await this.client.publish([this.callState.localAudioTrack]),this.callState.isConnected=!0,this.isReconnecting=!1,console.log("  "))}catch(f){console.error("  :",f),this.isReconnecting=!1,this.reconnectAttempts<this.MAX_RECONNECT_ATTEMPTS?(console.warn(" 3   ..."),setTimeout(()=>{this.handleUnexpectedDisconnection(h)},3e3)):this.callbacks.onError?.(new Error("  .    ."))}}}async getCallStatistics(){try{if(!this.client)return console.warn(" Agora     "),null;const h=await this.client.getRTCStats();let f=null;if(this.callState.localAudioTrack)try{f=this.callState.localAudioTrack.getStats()}catch{}let g=null;if(this.callState.remoteAudioTrack)try{g=this.callState.remoteAudioTrack.getStats()}catch{}return{duration:h.Duration||0,sendBytes:h.SendBytes,receiveBytes:h.RecvBytes,sendBitrate:h.SendBitrate,receiveBitrate:h.RecvBitrate,audioSendBytes:f?.sendBytes,audioReceiveBytes:g?.receiveBytes,audioSendBitrate:f?.sendBitrate,audioReceiveBitrate:g?.receiveBitrate,sendPacketsLost:f?.sendPacketsLost,receivePacketsLost:g?.receivePacketsLost,userCount:h.UserCount,lastNetworkQuality:{...this.callState.networkQuality}}}catch(h){return console.error("    :",h),null}}async renewToken(h){try{if(!this.client)throw new Error("Agora   .");await this.client.renewToken(h),this.currentChannelInfo&&(this.currentChannelInfo.token=h),this.isRenewingToken=!1}catch(f){throw this.isRenewingToken=!1,console.error(" Agora RTC   :",f),f}}getCurrentChannelInfo(){return this.currentChannelInfo?{...this.currentChannelInfo}:null}async destroy(){try{await this.leaveChannel(),this.callbacks={}}catch(h){console.error("Agora   :",h)}}}let oA=null;const gne=()=>(oA||(oA=new _ne),oA),tO=()=>{const{callId:u,matchingId:h,partner:f,agoraChannelInfo:g,isInCall:S,isConnecting:T,callStartTime:R,agoraState:N,error:k,startCall:x,endCall:U,updateConnectingState:B,updateAgoraState:Y,setError:H,clearPartner:re}=uj(),X=ee.useRef(new Set),te=3600*1e3,ce=ee.useRef(null);ee.useEffect(()=>{},[f]);const $=gne(),le=V0(),ne=FE(),ue=ee.useCallback(async()=>{try{if(!u){console.error(" callId    ");return}const{getStoredToken:Qe}=await Yd(async()=>{const{getStoredToken:ke}=await Promise.resolve().then(()=>t0);return{getStoredToken:ke}},void 0),Ge=Qe();Ge&&ne.setToken(Ge);const Ie=await ne.renewRtcToken(u);await $.renewToken(Ie.rtcToken)}catch(Qe){console.error(" RTC   :",Qe),H("   .      .")}},[u,ne,$,H]),Pe=ee.useCallback(async()=>{console.error(" RTC   -   "),H("    .");try{await $.leaveChannel(),U()}catch(Qe){console.error("     :",Qe)}},[H,$,U]),he=ee.useCallback(()=>{ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{console.warn("   (60)  -   ( )"),H("  (60)    ."),Me()},te)},[H]),de=ee.useCallback(()=>{ce.current&&(clearTimeout(ce.current),ce.current=null)},[]),ye=ee.useCallback(async Qe=>{try{if(Qe.callId&&X.current.has(Qe.callId)||S||T)return;Qe.callId&&X.current.add(Qe.callId),x(Qe),B(!0);const Ge={onConnectionStateChange:ke=>{Y($.getCallState())},onUserJoined:ke=>{},onTokenPrivilegeWillExpire:()=>{ue()},onTokenPrivilegeDidExpire:()=>{console.error(" RTC   -  "),Pe()},onNetworkQualityChange:ke=>{Y($.getCallState()),ke.uplinkNetworkQuality>=5||ke.downlinkNetworkQuality>=5},onException:ke=>{console.error(" Agora SDK :",ke),(ke.code==="DEVICE_NOT_FOUND"||ke.code==="UNEXPECTED_ERROR")&&H(`   : ${ke.msg}`)},onMicrophonePermissionDenied:()=>{console.error("   "),H("  .     .")},onUserLeft:ke=>{const Ye=uj.getState();if(Ye.partner?.id&&String(ke)===String(Ye.partner.id)){if(Ye.callId&&Ye.partner.id)try{le.sendCallEndNotification(Ye.callId,Ye.partner.id)}catch(_e){console.error("   WebSocket   :",_e)}$.leaveChannel().catch(_e=>{console.error("Agora   :",_e)}),U()}},onAudioTrackSubscribed:(ke,Ye)=>{Y($.getCallState())},onAudioTrackUnsubscribed:ke=>{Y($.getCallState())},onCallStarted:()=>{B(!1),Y($.getCallState()),he()},onCallEnded:()=>{U()},onError:ke=>{console.error("Agora :",ke),H(ke.message)}};$.setCallbacks(Ge);const Ie={appId:"27a8d306ea82463f81a2fbc033c7570c",channelName:Qe.channelName,token:Qe.rtcToken,uid:String(Qe.agoraUid)};try{await $.joinChannel(Ie)}catch(ke){throw console.error(" Agora   :",ke),ke}}catch(Ge){console.error("  :",Ge),H(Ge instanceof Error?Ge.message:"  ."),B(!1)}},[$,x,B,Y,U,H,S,T,he,ue,Pe]),Me=ee.useCallback(async()=>{try{if(!u)return;const Qe=f;let Ge=null;try{Ge=await $.getCallStatistics()}catch(Ie){console.error("     ():",Ie)}if(await $.leaveChannel(),Ge)try{const{getStoredToken:Ie}=await Yd(async()=>{const{getStoredToken:yt}=await Promise.resolve().then(()=>t0);return{getStoredToken:yt}},void 0),ke=Ie();ke&&ne.setToken(ke);const Ye=Ge.lastNetworkQuality?.uplinkNetworkQuality||0,_e=Ge.lastNetworkQuality?.downlinkNetworkQuality||0,De=yt=>yt===0?"":yt<=2?"":yt===3?"":yt===4?"":"",ct=`: ${De(Ye)}, : ${De(_e)}`,at=(Ge.sendBytes||0)+(Ge.receiveBytes||0),Ot=Number((at/(1024*1024)).toFixed(2)),Gt=Number(((Ye+_e)/2).toFixed(1));await ne.sendCallStatistics(u,{duration:Ge.duration||0,sendBytes:Ge.sendBytes||0,receiveBytes:Ge.receiveBytes||0,sendBitrate:Ge.sendBitrate||0,receiveBitrate:Ge.receiveBitrate||0,audioSendBytes:Ge.audioSendBytes||0,audioReceiveBytes:Ge.audioReceiveBytes||0,uplinkNetworkQuality:Ye,downlinkNetworkQuality:_e,networkQualityDescription:ct,totalDataUsageMB:Ot,averageNetworkQuality:Gt})}catch{}try{const{getStoredToken:Ie}=await Yd(async()=>{const{getStoredToken:Ye}=await Promise.resolve().then(()=>t0);return{getStoredToken:Ye}},void 0),ke=Ie();ke&&ne.setToken(ke),await ne.leaveChannel(u)}catch(Ie){console.error(" 4.   API  :",Ie)}try{const{getStoredToken:Ie}=await Yd(async()=>{const{getStoredToken:Ye}=await Promise.resolve().then(()=>t0);return{getStoredToken:Ye}},void 0),ke=Ie();ke&&ne.setToken(ke),await ne.endCall(u)}catch(Ie){Ie instanceof Error&&Ie.message.includes("  ")||console.error(" 5.   API  :",Ie)}if(Qe?.id)if(!le.getConnectionState().isConnected)console.error(" WebSocket   -   ");else try{le.sendCallEndNotification(u,Qe.id)}catch(ke){console.error("   WebSocket   :",ke)}de(),$.setCallbacks({}),U(),await new Promise(Ie=>setTimeout(Ie,100))}catch(Qe){console.error("  :",Qe),H(Qe instanceof Error?Qe.message:"  .")}},[$,U,H,u,ne,f,le,de]),Je=ee.useCallback(async()=>{try{await $.toggleMute(),Y($.getCallState())}catch(Qe){console.error("  :",Qe),H(Qe instanceof Error?Qe.message:"  .")}},[$,Y,H]),Ve=ee.useCallback(async()=>{try{await $.toggleSpeaker(),Y($.getCallState())}catch(Qe){console.error("  :",Qe),H(Qe instanceof Error?Qe.message:"  .")}},[$,Y,H]),xe=ee.useCallback(async Qe=>{try{await $.setVolume(Qe),Y($.getCallState())}catch(Ge){console.error("  :",Ge),H(Ge instanceof Error?Ge.message:"  .")}},[$,Y,H]),He=ee.useCallback(()=>R?Math.floor((Date.now()-R.getTime())/1e3):0,[R]),dt=ee.useCallback(Qe=>{Qe.type==="call_end"&&Qe.callId===u&&(de(),$.leaveChannel().catch(Ge=>{}),U())},[u,$,U,de]);return ee.useEffect(()=>(le.onCallEndNotificationCallback(dt),()=>{}),[le,dt]),ee.useEffect(()=>()=>{de()},[de]),{callId:u,matchingId:h,partner:f,agoraChannelInfo:g,isInCall:S,isConnecting:T,agoraState:N,error:k,callDuration:He(),handleCallStart:ye,handleEndCall:Me,toggleMute:Je,toggleSpeaker:Ve,setVolume:xe,setError:H,clearPartner:re}};function RF({selectedCategory:u,onCancel:h,onConnected:f}){const[g,S]=ee.useState(""),{queuePosition:T}=eO(),{isInCall:R,isConnecting:N,error:k,handleCallStart:x}=tO(),U=V0(),B=ee.useRef(new Set),Y=30*1e3,H=ee.useRef(null);ee.useEffect(()=>{const te=setInterval(()=>{S(ce=>ce==="..."?"":ce+".")},500);return()=>clearInterval(te)},[]),ee.useEffect(()=>{R&&!N&&f()},[R,N,f]);const re=ee.useCallback(te=>{te.callId&&B.current.has(te.callId)||R||N||(te.callId&&B.current.add(te.callId),x(te))},[x,R,N]),X=ee.useCallback(te=>{},[]);return ee.useEffect(()=>(U.onCallStartNotificationCallback(re),U.onMatchingNotificationCallback(X),()=>{}),[U,re,X]),ee.useEffect(()=>(N&&!R?H.current=setTimeout(()=>{console.warn("   (30) -   ( )"),alert("   .  ."),h()},Y):H.current&&(clearTimeout(H.current),H.current=null),()=>{H.current&&(clearTimeout(H.current),H.current=null)}),[N,R,h]),ee.useEffect(()=>{k&&console.error("  :",k)},[k]),O.jsxs("div",{className:"min-h-screen flex flex-col relative safe-area-page pt-6 font-noto",style:{background:`linear-gradient(0deg, rgba(120, 90, 0, 0.20) 0%, rgba(120, 90, 0, 0.20) 100%), 
                    radial-gradient(138.99% 139.71% at 10.56% -25.76%, rgba(235, 161, 0, 0.80) 0%, rgba(245, 69, 53, 0.80) 100%)`},children:[O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"bg-white px-4 py-2 rounded",children:O.jsxs("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:[" : ",TF(u)]})})}),O.jsx("div",{className:"flex justify-center mt-16",children:O.jsx("h1",{className:"text-white font-pretendard text-4xl font-medium",children:"  "})}),O.jsx("div",{className:"flex justify-center mt-20",children:O.jsx("div",{className:"relative",children:O.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 65 65",fill:"none",className:"animate-spin",style:{transform:"rotate(-90deg)"},children:[O.jsx("mask",{id:"path-1-inside-1_6652_403",fill:"white",children:O.jsx("path",{d:"M32.0187 0.000213623C49.7021 0.000213623 64.0374 14.3355 64.0374 32.0189C64.0374 49.7023 49.7021 64.0376 32.0187 64.0376C14.3353 64.0376 0 49.7023 0 32.0189C0 14.3355 14.3353 0.000213623 32.0187 0.000213623Z"})}),O.jsx("path",{d:"M32.0187 0.000213623L32.0187 9.339C44.5445 9.339 54.6986 19.4931 54.6986 32.0189L64.0374 32.0189H73.3762C73.3762 9.1778 54.8598 -9.33857 32.0187 -9.33857V0.000213623ZM64.0374 32.0189L54.6986 32.0189C54.6986 44.5447 44.5445 54.6988 32.0187 54.6988V64.0376V73.3764C54.8598 73.3764 73.3762 54.86 73.3762 32.0189H64.0374ZM32.0187 64.0376V54.6988C19.4929 54.6988 9.33879 44.5447 9.33879 32.0189H0H-9.33879C-9.33879 54.86 9.17759 73.3764 32.0187 73.3764V64.0376ZM0 32.0189H9.33879C9.33879 19.4931 19.4929 9.339 32.0187 9.339L32.0187 0.000213623V-9.33857C9.17759 -9.33857 -9.33879 9.1778 -9.33879 32.0189H0Z",fill:"url(#gradient)",mask:"url(#path-1-inside-1_6652_403)"}),O.jsx("defs",{children:O.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[O.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0)"}),O.jsx("stop",{offset:"100%",stopColor:"rgba(255,255,255,1)"})]})})]})})}),O.jsx("div",{className:"flex-1 flex items-center justify-center px-5",children:O.jsx("div",{className:"text-center",children:O.jsxs("p",{className:"text-white font-crimson text-2xl md:text-3xl font-bold leading-9",children:["   ",O.jsx("br",{})," ",g]})})}),O.jsx("div",{className:"px-5 pb-8 md:pb-12",children:O.jsx("div",{className:"h-20 md:h-24 relative",children:O.jsx("button",{onClick:h,className:"w-full h-14 md:h-16 bg-white rounded-lg font-crimson text-xl md:text-2xl font-bold text-orange-500 hover:bg-gray-50 transition-colors",children:""})})})]})}function bF({selectedCategory:u,onEndCall:h}){const[f,g]=ee.useState(0),{partner:S,agoraState:T,callDuration:R,isInCall:N,handleEndCall:k,toggleSpeaker:x,setError:U,error:B}=tO();ee.useEffect(()=>{},[S]),ee.useEffect(()=>{!N&&S&&setTimeout(()=>{h()},100)},[N,S,h]),ee.useEffect(()=>{const te=$=>{if(N)return $.preventDefault(),$.returnValue="  .   ?",$.returnValue},ce=()=>{N&&k().catch($=>{console.error("     :",$)})};return window.addEventListener("beforeunload",te),window.addEventListener("unload",ce),()=>{window.removeEventListener("beforeunload",te),window.removeEventListener("unload",ce)}},[N,k]);const Y=te=>{const ce=Math.floor(te/60),$=te%60;return`${ce.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`},H=async()=>{try{await k(),h()}catch(te){console.error("  :",te),te instanceof Error&&te.message.includes("  ")?h():U("  .")}};ee.useEffect(()=>{const te=setInterval(()=>{g(ce=>(ce+1)%5)},200);return()=>clearInterval(te)},[]);const X=(te=>te===0?{color:"text-gray-400",bars:0,label:""}:te===1||te===2?{color:"text-green-400",bars:3,label:""}:te===3?{color:"text-yellow-400",bars:2,label:""}:te===4?{color:"text-orange-400",bars:1,label:""}:{color:"text-red-400",bars:1,label:""})(T.networkQuality?.downlinkNetworkQuality||0);return O.jsxs("div",{className:"min-h-screen flex flex-col relative safe-area-page pt-6 font-noto",style:{background:`linear-gradient(0deg, rgba(120, 90, 0, 0.20) 0%, rgba(120, 90, 0, 0.20) 100%), 
                    radial-gradient(138.99% 139.71% at 10.56% -25.76%, rgba(235, 161, 0, 0.80) 0%, rgba(245, 69, 53, 0.80) 100%)`},children:[O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"bg-white px-4 py-2 rounded",children:O.jsxs("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:[" : ",TF(u)]})})}),O.jsx("div",{className:"absolute top-20 right-8",children:O.jsxs("div",{className:"flex items-center gap-2 bg-black bg-opacity-30 px-3 py-2 rounded-full",children:[O.jsxs("div",{className:"flex items-end gap-0.5 h-4",children:[O.jsx("div",{className:`w-1 h-2 rounded-sm ${X.bars>=1?X.color:"bg-gray-600"}`}),O.jsx("div",{className:`w-1 h-3 rounded-sm ${X.bars>=2?X.color:"bg-gray-600"}`}),O.jsx("div",{className:`w-1 h-4 rounded-sm ${X.bars>=3?X.color:"bg-gray-600"}`})]}),(T.networkQuality?.downlinkNetworkQuality||0)>=4&&O.jsx("span",{className:`text-xs font-pretendard ${X.color}`,children:X.label})]})}),O.jsxs("div",{className:"flex flex-col items-center justify-center mt-8 gap-1",children:[O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("span",{className:"text-white font-crimson text-3xl font-bold",children:S?.nickname||""}),O.jsx("span",{className:"text-white font-pretendard text-3xl font-normal",children:""})]}),O.jsx("span",{className:"text-white font-pretendard text-4xl font-normal",children:""})]}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"w-32 h-32 rounded-3xl bg-orange-100 flex items-center justify-center",children:O.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 80 80",fill:"none",children:[O.jsx("path",{d:"M40.294 41.162C46.589 41.162 51.696 36.055 51.696 29.76C51.696 23.465 46.589 18.358 40.294 18.358C34 18.358 28.893 23.465 28.893 29.76C28.893 36.055 34 41.162 40.294 41.162Z",fill:"#EE9049"}),O.jsx("path",{d:"M40.2927 44.504C25.6233 44.504 19.9185 54.507 19.9185 59.1582C19.9185 63.8094 32.0641 65.0489 40.2927 65.0489C48.5213 65.0489 60.6669 63.8094 60.6669 59.1582C60.6669 54.507 54.9621 44.504 40.2927 44.504Z",fill:"#EE9049"})]})})}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("span",{className:"text-white font-crimson text-2xl font-normal",children:Y(R)})}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("div",{className:"flex items-center justify-center gap-2",children:[0,1,2,3,4].map(te=>O.jsx("div",{className:`w-2 h-2 bg-white rounded-full transition-opacity duration-200 ${f===te?"opacity-100":"opacity-40"}`},te))})}),B&&O.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50",children:O.jsx("div",{className:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg max-w-md",children:O.jsx("p",{className:"text-center font-pretendard",children:B})})}),O.jsx("div",{className:"flex-1 flex items-end justify-center pb-16",children:O.jsxs("div",{className:"flex items-center justify-between w-80",children:[O.jsxs("div",{className:"flex flex-col items-center gap-4",children:[O.jsx("button",{onClick:x,className:`w-20 h-20 rounded-full flex items-center justify-center transition-colors ${T.isSpeakerOn?"bg-white bg-opacity-20":"bg-red-500 bg-opacity-50"}`,children:O.jsx("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",children:O.jsx("path",{d:"M23.1549 16.3334C22.4369 16.3334 21.8549 15.7513 21.8549 15.0334C21.8549 14.3154 22.4369 13.7334 23.1549 13.7334H26.7C27.418 13.7334 28 14.3154 28 15.0334C28 15.7513 27.418 16.3334 26.7 16.3334H23.1549ZM24.5798 26.9517C24.1486 27.5287 23.3292 27.6426 22.757 27.205L19.8968 25.0174C19.3336 24.5866 19.2219 23.7829 19.6464 23.2149C20.0776 22.638 20.8968 22.5242 21.4689 22.9617L24.3293 25.1491C24.8925 25.5798 25.0042 26.3836 24.5798 26.9517ZM21.4037 7.03847C20.8315 7.47612 20.0121 7.36225 19.5809 6.78516C19.1564 6.21715 19.2681 5.41337 19.8313 4.9826L22.6915 2.79506C23.2637 2.35741 24.0832 2.47128 24.5144 3.04838C24.9388 3.61639 24.8271 4.42017 24.2639 4.85093L21.4037 7.03847ZM3 19.3667C1.89543 19.3667 1 18.4713 1 17.3667V12.7C1 11.5955 1.89543 10.7 3 10.7H7.3087L12.8842 5.01477C13.5113 4.37534 14.5982 4.81934 14.5982 5.71495V24.3518C14.5982 25.2474 13.5113 25.6914 12.8842 25.052L7.3087 19.3667H3Z",fill:"white"})})}),O.jsx("span",{className:"text-white font-crimson text-lg font-bold",children:""})]}),O.jsxs("div",{className:"flex flex-col items-center gap-4",children:[O.jsx("button",{onClick:H,className:"w-20 h-20 rounded-full bg-red-500 flex items-center justify-center",children:O.jsx("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",children:O.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.8823 14.9998L24.2533 7.62879C24.7727 7.10936 24.7727 6.26593 24.2533 5.7465C23.7339 5.22708 22.8904 5.22708 22.371 5.7465L15 13.1175L7.629 5.7465C7.10958 5.22708 6.26615 5.22708 5.74672 5.7465C5.22729 6.26593 5.22729 7.10936 5.74672 7.62879L13.1177 14.9998L5.74672 22.3708C5.22729 22.8902 5.22729 23.7336 5.74672 24.2531C6.26615 24.7725 7.10958 24.7725 7.629 24.2531L15 16.8821L22.371 24.2531C22.8904 24.7725 23.7339 24.7725 24.2533 24.2531C24.7727 23.7336 24.7727 22.8902 24.2533 22.3708L16.8823 14.9998Z",fill:"white"})})}),O.jsx("span",{className:"text-white font-crimson text-lg font-bold",children:" "})]})]})})]})}function IF({selectedCategory:u,onCallAgain:h,onSelectInterests:f,onGoHome:g}){const[S,T]=ee.useState(null),[R,N]=ee.useState(!1),[k,x]=ee.useState(!1),{partner:U,clearPartner:B,callId:Y}=tO(),H=FE();ee.useEffect(()=>{},[U,Y]);const re=async()=>{if(!S||!Y){console.error("   callId .");return}N(!0);try{const X={call_id:parseInt(Y),feedback_type:S==="good"?"POSITIVE":"NEGATIVE",negative:S==="bad",positive:S==="good"},te=uo();if(te)H.setToken(te);else throw new Error("  .  .");await H.submitEvaluation(X),x(!0),B(),setTimeout(()=>{x(!1),g()},2e3)}catch(X){console.error("   :",X),alert("  .  .")}finally{N(!1)}};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col relative safe-area-page font-noto",children:[k&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:O.jsxs("div",{className:"bg-white rounded-2xl p-8 mx-4 max-w-sm w-full text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",className:"text-green-600",children:O.jsx("path",{d:"M26.6667 8L11.3333 23.3333L5.33334 17.3333",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:" !"}),O.jsxs("p",{className:"text-gray-600",children:[S==="good"?"":""," ."]})]})}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("h1",{className:"text-orange-500 font-crimson text-2xl font-bold",children:" "})}),O.jsxs("div",{className:"flex flex-col items-center justify-center mt-8 gap-3",children:[O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("span",{className:"text-gray-900 font-crimson text-4xl font-bold",children:U?.nickname||""}),O.jsx("span",{className:"text-gray-900 font-pretendard text-4xl font-normal",children:""})]}),O.jsx("span",{className:"text-gray-900 font-pretendard text-4xl font-normal",children:" ?"})]}),O.jsxs("div",{className:"flex gap-4 px-5 mt-12",children:[O.jsxs("button",{onClick:()=>T("bad"),className:`flex-1 h-36 rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all ${S==="bad"?"border-orange-400 bg-orange-50":"border-gray-300 bg-gray-100"}`,children:[O.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",fill:"none",children:[O.jsx("path",{d:"M7.5 40C6.16667 40 5 39.5 4 38.5C3 37.5 2.5 36.3333 2.5 35V30C2.5 29.7083 2.53125 29.3958 2.59375 29.0625C2.65625 28.7292 2.75 28.4167 2.875 28.125L10.375 10.5C10.75 9.66667 11.375 8.95833 12.25 8.375C13.125 7.79167 14.0417 7.5 15 7.5H35C36.375 7.5 37.5521 7.98958 38.5312 8.96875C39.5104 9.94792 40 11.125 40 12.5V37.9375C40 38.6042 39.8646 39.2396 39.5938 39.8438C39.3229 40.4479 38.9583 40.9792 38.5 41.4375L24.9375 54.9375C24.3125 55.5208 23.5729 55.875 22.7188 56C21.8646 56.125 21.0417 55.9792 20.25 55.5625C19.4583 55.1458 18.8854 54.5625 18.5312 53.8125C18.1771 53.0625 18.1042 52.2917 18.3125 51.5L21.125 40H7.5ZM50 7.5C51.375 7.5 52.5521 7.98958 53.5312 8.96875C54.5104 9.94792 55 11.125 55 12.5V35C55 36.375 54.5104 37.5521 53.5312 38.5313C52.5521 39.5104 51.375 40 50 40C48.625 40 47.4479 39.5104 46.4688 38.5313C45.4896 37.5521 45 36.375 45 35V12.5C45 11.125 45.4896 9.94792 46.4688 8.96875C47.4479 7.98958 48.625 7.5 50 7.5Z",fill:"url(#paint0_radial_bad)"}),O.jsx("defs",{children:O.jsxs("radialGradient",{id:"paint0_radial_bad",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(36 -44 104.92 102.906 15.5 59.5)",gradientUnits:"userSpaceOnUse",children:[O.jsx("stop",{stopColor:"#5D5D5D"}),O.jsx("stop",{offset:"1",stopColor:"#9E9B9B"})]})})]}),O.jsx("span",{className:"text-gray-900 font-crimson text-2xl font-bold",children:""})]}),O.jsxs("button",{onClick:()=>T("good"),className:`flex-1 h-36 rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all ${S==="good"?"border-orange-400 bg-orange-50":"border-gray-300 bg-gray-100"}`,children:[O.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",fill:"none",children:[O.jsx("path",{d:"M27.3539 51.2033C28.9615 52.2656 31.037 52.2656 32.6446 51.2033C37.7481 47.8307 48.8704 39.7751 53.6589 30.7582C59.9748 18.8635 52.558 7 42.7566 7C37.1687 7 33.8065 9.91945 31.9478 12.4288C30.9687 13.7511 29.0328 13.7511 28.0522 12.4288C26.1935 9.91945 22.8313 7 17.2434 7C7.44202 7 0.0252047 18.8635 6.34108 30.7582C11.1281 39.7736 22.2504 47.8307 27.3539 51.2033Z",fill:"url(#paint0_radial_good)"}),O.jsx("defs",{children:O.jsxs("radialGradient",{id:"paint0_radial_good",cx:"0",cy:"0",r:"1",gradientTransform:"matrix(-18.5 26.5 -68.601 -50.7338 45.5 16.5)",gradientUnits:"userSpaceOnUse",children:[O.jsx("stop",{stopColor:"#E35241"}),O.jsx("stop",{offset:"1",stopColor:"#FF8B76"})]})})]}),O.jsx("span",{className:"text-gray-900 font-crimson text-2xl font-bold",children:""})]})]}),O.jsx("div",{className:"flex justify-center mt-8",children:O.jsx("p",{className:"text-gray-500 font-crimson text-xl",children:"   "})}),O.jsx("div",{className:"flex justify-center mt-6 px-5",children:O.jsx("button",{onClick:re,disabled:!S||R,className:`w-full max-w-sm h-14 rounded-lg font-crimson text-xl font-bold transition-all ${S&&!R?"bg-gradient-to-r from-yellow-300 to-red-gradient text-white hover:opacity-90":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:R?" ...":" "})}),O.jsx("div",{className:"flex-1 flex items-end pb-8",children:O.jsx("div",{className:"w-full px-5",children:O.jsxs("div",{className:"flex gap-2",children:[O.jsx("button",{onClick:()=>{B(),h()},className:"flex-1 h-14 border border-orange-500 rounded-lg flex items-center justify-center bg-white",children:O.jsx("span",{className:"text-orange-500 font-crimson text-xl font-bold",children:" "})}),O.jsx("button",{onClick:()=>{B(),f()},className:"flex-1 h-14 bg-orange-500 rounded-lg flex items-center justify-center",children:O.jsx("span",{className:"text-white font-crimson text-xl font-bold",children:" "})})]})})})]})}function AF({onBack:u,onNavigateToActivity:h,onNavigateToProfileEdit:f,onNavigateToComingSoon:g,onNavigateToSupport:S,onLogout:T}){const R=[{id:"subscription",title:" ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 13.9L13.5 15.05C13.6833 15.2 13.8833 15.2042 14.1 15.0625C14.3167 14.9208 14.3833 14.7333 14.3 14.5L13.7 12.6L15.375 11.3C15.5583 11.15 15.6083 10.9625 15.525 10.7375C15.4417 10.5125 15.2833 10.4 15.05 10.4H13.1L12.475 8.475C12.3917 8.24167 12.2333 8.125 12 8.125C11.7667 8.125 11.6083 8.24167 11.525 8.475L10.9 10.4H8.925C8.69167 10.4 8.5375 10.5125 8.4625 10.7375C8.3875 10.9625 8.44167 11.15 8.625 11.3L10.25 12.6L9.65 14.525C9.56667 14.7583 9.625 14.9458 9.825 15.0875C10.025 15.2292 10.225 15.225 10.425 15.075L12 13.9ZM4 20C3.45 20 2.97917 19.8042 2.5875 19.4125C2.19583 19.0208 2 18.55 2 18V14.625C2 14.4417 2.05833 14.2833 2.175 14.15C2.29167 14.0167 2.44167 13.9333 2.625 13.9C3.025 13.7667 3.35417 13.525 3.6125 13.175C3.87083 12.825 4 12.4333 4 12C4 11.5667 3.87083 11.175 3.6125 10.825C3.35417 10.475 3.025 10.2333 2.625 10.1C2.44167 10.0667 2.29167 9.98333 2.175 9.85C2.05833 9.71667 2 9.55833 2 9.375V6C2 5.45 2.19583 4.97917 2.5875 4.5875C2.97917 4.19583 3.45 4 4 4H20C20.55 4 21.0208 4.19583 21.4125 4.5875C21.8042 4.97917 22 5.45 22 6V9.375C22 9.55833 21.9417 9.71667 21.825 9.85C21.7083 9.98333 21.5583 10.0667 21.375 10.1C20.975 10.2333 20.6458 10.475 20.3875 10.825C20.1292 11.175 20 11.5667 20 12C20 12.4333 20.1292 12.825 20.3875 13.175C20.6458 13.525 20.975 13.7667 21.375 13.9C21.5583 13.9333 21.7083 14.0167 21.825 14.15C21.9417 14.2833 22 14.4417 22 14.625V18C22 18.55 21.8042 19.0208 21.4125 19.4125C21.0208 19.8042 20.55 20 20 20H4Z",fill:"#EA8C4B"})})},{id:"activity",title:"  ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M6 22C5.16667 22 4.45833 21.7083 3.875 21.125C3.29167 20.5417 3 19.8333 3 19V18C3 17.45 3.19583 16.9792 3.5875 16.5875C3.97917 16.1958 4.45 16 5 16H6V4C6 3.45 6.19583 2.97917 6.5875 2.5875C6.97917 2.19583 7.45 2 8 2H19C19.55 2 20.0208 2.19583 20.4125 2.5875C20.8042 2.97917 21 3.45 21 4V19C21 19.8333 20.7083 20.5417 20.125 21.125C19.5417 21.7083 18.8333 22 18 22H6ZM18 20C18.2833 20 18.5208 19.9042 18.7125 19.7125C18.9042 19.5208 19 19.2833 19 19V4H8V16H15C15.55 16 16.0208 16.1958 16.4125 16.5875C16.8042 16.9792 17 17.45 17 18V19C17 19.2833 17.0958 19.5208 17.2875 19.7125C17.4792 19.9042 17.7167 20 18 20ZM10 9C9.71667 9 9.47917 8.90417 9.2875 8.7125C9.09583 8.52083 9 8.28333 9 8C9 7.71667 9.09583 7.47917 9.2875 7.2875C9.47917 7.09583 9.71667 7 10 7H17C17.2833 7 17.5208 7.09583 17.7125 7.2875C17.9042 7.47917 18 7.71667 18 8C18 8.28333 17.9042 8.52083 17.7125 8.7125C17.5208 8.90417 17.2833 9 17 9H10ZM10 12C9.71667 12 9.47917 11.9042 9.2875 11.7125C9.09583 11.5208 9 11.2833 9 11C9 10.7167 9.09583 10.4792 9.2875 10.2875C9.47917 10.0958 9.71667 10 10 10H17C17.2833 10 17.5208 10.0958 17.7125 10.2875C17.9042 10.4792 18 10.7167 18 11C18 11.2833 17.9042 11.5208 17.7125 11.7125C17.5208 11.9042 17.2833 12 17 12H10Z",fill:"#EA8C4B"})})},{id:"notifications",title:" ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M13 12.5999V8.9999C13 8.71657 12.9042 8.47907 12.7125 8.2874C12.5209 8.09574 12.2834 7.9999 12 7.9999C11.7167 7.9999 11.4792 8.09574 11.2875 8.2874C11.0959 8.47907 11 8.71657 11 8.9999V12.9749C11 13.1082 11.025 13.2374 11.075 13.3624C11.125 13.4874 11.2 13.5999 11.3 13.6999L14.1 16.4999C14.2834 16.6832 14.5167 16.7749 14.8 16.7749C15.0834 16.7749 15.3167 16.6832 15.5 16.4999C15.6834 16.3166 15.775 16.0832 15.775 15.7999C15.775 15.5166 15.6834 15.2832 15.5 15.0999L13 12.5999ZM12 21.9999C10.75 21.9999 9.57919 21.7624 8.48752 21.2874C7.39586 20.8124 6.44586 20.1707 5.63752 19.3624C4.82919 18.5541 4.18752 17.6041 3.71252 16.5124C3.23752 15.4207 3.00002 14.2499 3.00002 12.9999C3.00002 11.7499 3.23752 10.5791 3.71252 9.4874C4.18752 8.39574 4.82919 7.44574 5.63752 6.6374C6.44586 5.82907 7.39586 5.1874 8.48752 4.7124C9.57919 4.2374 10.75 3.9999 12 3.9999C13.25 3.9999 14.4209 4.2374 15.5125 4.7124C16.6042 5.1874 17.5542 5.82907 18.3625 6.6374C19.1709 7.44574 19.8125 8.39574 20.2875 9.4874C20.7625 10.5791 21 11.7499 21 12.9999C21 14.2499 20.7625 15.4207 20.2875 16.5124C19.8125 17.6041 19.1709 18.5541 18.3625 19.3624C17.5542 20.1707 16.6042 20.8124 15.5125 21.2874C14.4209 21.7624 13.25 21.9999 12 21.9999ZM2.05002 7.2999C1.86669 7.11657 1.77502 6.88324 1.77502 6.5999C1.77502 6.31657 1.86669 6.08324 2.05002 5.8999L4.90002 3.0499C5.08336 2.86657 5.31669 2.7749 5.60002 2.7749C5.88336 2.7749 6.11669 2.86657 6.30002 3.0499C6.48336 3.23324 6.57502 3.46657 6.57502 3.7499C6.57502 4.03324 6.48336 4.26657 6.30002 4.4499L3.45002 7.2999C3.26669 7.48324 3.03336 7.5749 2.75002 7.5749C2.46669 7.5749 2.23336 7.48324 2.05002 7.2999ZM21.95 7.2999C21.7667 7.48324 21.5334 7.5749 21.25 7.5749C20.9667 7.5749 20.7334 7.48324 20.55 7.2999L17.7 4.4499C17.5167 4.26657 17.425 4.03324 17.425 3.7499C17.425 3.46657 17.5167 3.23324 17.7 3.0499C17.8834 2.86657 18.1167 2.7749 18.4 2.7749C18.6834 2.7749 18.9167 2.86657 19.1 3.0499L21.95 5.8999C22.1334 6.08324 22.225 6.31657 22.225 6.5999C22.225 6.88324 22.1334 7.11657 21.95 7.2999Z",fill:"#EA8C4B"})})},{id:"support",title:"",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M11.75 19H11.5C9.13333 19 7.125 18.175 5.475 16.525C3.825 14.875 3 12.8667 3 10.5C3 8.13333 3.825 6.125 5.475 4.475C7.125 2.825 9.13333 2 11.5 2C12.6833 2 13.7875 2.22083 14.8125 2.6625C15.8375 3.10417 16.7375 3.7125 17.5125 4.4875C18.2875 5.2625 18.8958 6.1625 19.3375 7.1875C19.7792 8.2125 20 9.31667 20 10.5C20 12.7333 19.3708 14.8083 18.1125 16.725C16.8542 18.6417 15.2667 20.1417 13.35 21.225C13.1833 21.3083 13.0167 21.3542 12.85 21.3625C12.6833 21.3708 12.5333 21.3333 12.4 21.25C12.2667 21.1667 12.15 21.0583 12.05 20.925C11.95 20.7917 11.8917 20.6333 11.875 20.45L11.75 19ZM11.475 15.975C11.7583 15.975 12 15.875 12.2 15.675C12.4 15.475 12.5 15.2333 12.5 14.95C12.5 14.6667 12.4 14.425 12.2 14.225C12 14.025 11.7583 13.925 11.475 13.925C11.1917 13.925 10.95 14.025 10.75 14.225C10.55 14.425 10.45 14.6667 10.45 14.95C10.45 15.2333 10.55 15.475 10.75 15.675C10.95 15.875 11.1917 15.975 11.475 15.975ZM9.3 8.375C9.48333 8.45833 9.66667 8.4625 9.85 8.3875C10.0333 8.3125 10.1833 8.19167 10.3 8.025C10.45 7.825 10.625 7.67083 10.825 7.5625C11.025 7.45417 11.25 7.4 11.5 7.4C11.9 7.4 12.225 7.5125 12.475 7.7375C12.725 7.9625 12.85 8.25 12.85 8.6C12.85 8.81667 12.7875 9.03333 12.6625 9.25C12.5375 9.46667 12.3167 9.73333 12 10.05C11.5833 10.4167 11.275 10.7625 11.075 11.0875C10.875 11.4125 10.775 11.7417 10.775 12.075C10.775 12.275 10.8458 12.4458 10.9875 12.5875C11.1292 12.7292 11.3 12.8 11.5 12.8C11.7 12.8 11.8667 12.725 12 12.575C12.1333 12.425 12.2333 12.25 12.3 12.05C12.3833 11.7667 12.5333 11.5083 12.75 11.275C12.9667 11.0417 13.1667 10.8333 13.35 10.65C13.7 10.3 13.9625 9.95 14.1375 9.6C14.3125 9.25 14.4 8.9 14.4 8.55C14.4 7.78333 14.1375 7.16667 13.6125 6.7C13.0875 6.23333 12.3833 6 11.5 6C10.9667 6 10.475 6.12917 10.025 6.3875C9.575 6.64583 9.20833 7 8.925 7.45C8.825 7.63333 8.8125 7.8125 8.8875 7.9875C8.9625 8.1625 9.1 8.29167 9.3 8.375Z",fill:"#EA8C4B"})})},{id:"profile-edit",title:" ",icon:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"#EA8C4B"})})}],N=k=>{k==="activity"?h():k==="profile-edit"?f():k==="subscription"?g(" "):k==="notifications"?g(" "):k==="support"&&S()};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page font-noto",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5",children:[O.jsx("div",{className:"flex flex-col gap-4",children:R.map(k=>O.jsxs("button",{onClick:()=>N(k.id),className:"flex items-center justify-between p-6 border border-gray-200 rounded-2xl bg-white hover:bg-gray-50 transition-colors",children:[O.jsxs("div",{className:"flex flex-col items-start gap-2",children:[k.icon,O.jsx("span",{className:"text-gray-800 font-crimson text-2xl font-semibold",children:k.title})]}),O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M8 5L15 12L8 19",stroke:"#BFC2C0",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]},k.id))}),O.jsx("div",{className:"mt-8",children:O.jsxs("button",{onClick:T,className:"w-full flex items-center justify-center gap-2 p-4 border border-red-200 rounded-2xl bg-red-50 hover:bg-red-100 transition-colors",children:[O.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[O.jsx("path",{d:"M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),O.jsx("path",{d:"M16 17L21 12L16 7",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),O.jsx("path",{d:"M21 12H9",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),O.jsx("span",{className:"text-red-600 font-crimson text-lg font-semibold",children:""})]})})]})]})}function OF({onBack:u}){const[h,f]=ee.useState(null),[g,S]=ee.useState(!0),[T,R]=ee.useState(null);ee.useEffect(()=>{(async()=>{try{S(!0),R(null);const B=FE(),Y=uo();if(!Y)throw new Error(" .");B.setToken(Y);const H=await B.getActivityStats();f(H)}catch(B){console.error("   :",B),R(B instanceof Error?B.message:"    .")}finally{S(!1)}})()},[]);const N=U=>{if(U===0)return"1 ";const B=Math.floor(U/60),Y=U%60;return B===0?`${Y}`:Y===0?`${B}`:`${B} ${Y}`},x=(()=>{if(!h)return{level:"NEW",displayName:""};const{callCount:U,totalDurationMinutes:B}=h.weeklyStats;return U>=3||B>=90?{level:"EXCELLENT",displayName:""}:U>=1?{level:"GOOD",displayName:""}:{level:"NEW",displayName:""}})();return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page font-noto",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:"  "}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5",children:[g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 font-pretendard",children:"   ..."})]})}),T&&!g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-red-500 font-pretendard mb-4",children:T}),O.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-orange-500 text-white rounded-lg font-pretendard",children:" "})]})}),!g&&!T&&h&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"text-center mb-8",children:O.jsx("h2",{className:"text-gray-800 font-pretendard text-3xl font-medium",children:" ?"})}),O.jsx("div",{className:"flex justify-center mb-16",children:O.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 px-10 py-3 rounded-xl border-2 border-white/50",style:{background:x.level==="EXCELLENT"?"linear-gradient(93deg, #F4BC41 0.31%, #E26155 100.05%)":x.level==="GOOD"?"linear-gradient(93deg, #4B9FE1 0.31%, #6CC4A1 100.05%)":"linear-gradient(93deg, #FCD34D 0.31%, #F59E0B 100.05%)"},children:[O.jsx("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",children:O.jsx("path",{d:"M9.33333 14.4V9.33333H6.66667V10.6667C6.66667 11.5111 6.91111 12.2722 7.4 12.95C7.88889 13.6278 8.53333 14.1111 9.33333 14.4ZM22.6667 14.4C23.4667 14.1111 24.1111 13.6278 24.6 12.95C25.0889 12.2722 25.3333 11.5111 25.3333 10.6667V9.33333H22.6667V14.4ZM14.6667 25.3333V21.2C13.5778 20.9556 12.6056 20.4944 11.75 19.8167C10.8944 19.1389 10.2667 18.2889 9.86667 17.2667C8.2 17.0667 6.80556 16.3389 5.68333 15.0833C4.56111 13.8278 4 12.3556 4 10.6667V9.33333C4 8.6 4.26111 7.97222 4.78333 7.45C5.30556 6.92778 5.93333 6.66667 6.66667 6.66667H9.33333C9.33333 5.93333 9.59444 5.30556 10.1167 4.78333C10.6389 4.26111 11.2667 4 12 4H20C20.7333 4 21.3611 4.26111 21.8833 4.78333C22.4056 5.30556 22.6667 5.93333 22.6667 6.66667H25.3333C26.0667 6.66667 26.6944 6.92778 27.2167 7.45C27.7389 7.97222 28 8.6 28 9.33333V10.6667C28 12.3556 27.4389 13.8278 26.3167 15.0833C25.1944 16.3389 23.8 17.0667 22.1333 17.2667C21.7333 18.2889 21.1056 19.1389 20.25 19.8167C19.3944 20.4944 18.4222 20.9556 17.3333 21.2V25.3333H21.3333C21.7111 25.3333 22.0278 25.4611 22.2833 25.7167C22.5389 25.9722 22.6667 26.2889 22.6667 26.6667C22.6667 27.0444 22.5389 27.3611 22.2833 27.6167C22.0278 27.8722 21.7111 28 21.3333 28H10.6667C10.2889 28 9.97222 27.8722 9.71667 27.6167C9.46111 27.3611 9.33333 27.0444 9.33333 26.6667C9.33333 26.2889 9.46111 25.9722 9.71667 25.7167C9.97222 25.4611 10.2889 25.3333 10.6667 25.3333H14.6667Z",fill:"white"})}),O.jsx("span",{className:"text-white font-crimson text-xl font-bold",children:x.displayName})]})}),O.jsxs("div",{className:"mb-8",children:[O.jsx("h3",{className:"text-orange-500 font-crimson text-2xl font-bold mb-4",children:"  "}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M19.95 21C17.8667 21 15.8083 20.5458 13.775 19.6375C11.7417 18.7292 9.89167 17.4417 8.225 15.775C6.55833 14.1083 5.27083 12.2583 4.3625 10.225C3.45417 8.19167 3 6.13333 3 4.05C3 3.75 3.1 3.5 3.3 3.3C3.5 3.1 3.75 3 4.05 3H8.1C8.33333 3 8.54167 3.07917 8.725 3.2375C8.90833 3.39583 9.01667 3.58333 9.05 3.8L9.7 7.3C9.73333 7.56667 9.725 7.79167 9.675 7.975C9.625 8.15833 9.53333 8.31667 9.4 8.45L6.975 10.9C7.30833 11.5167 7.70417 12.1125 8.1625 12.6875C8.62083 13.2625 9.125 13.8167 9.675 14.35C10.1917 14.8667 10.7333 15.3458 11.3 15.7875C11.8667 16.2292 12.4667 16.6333 13.1 17L15.45 14.65C15.6 14.5 15.7958 14.3875 16.0375 14.3125C16.2792 14.2375 16.5167 14.2167 16.75 14.25L20.2 14.95C20.4333 15.0167 20.625 15.1375 20.775 15.3125C20.925 15.4875 21 15.6833 21 15.9V19.95C21 20.25 20.9 20.5 20.7 20.7C20.5 20.9 20.25 21 19.95 21Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsxs("span",{className:"text-gray-800 font-crimson text-xl",children:[h.weeklyStats.callCount,""]})]}),O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M13 11.6V8C13 7.71667 12.9042 7.47917 12.7125 7.2875C12.5208 7.09583 12.2833 7 12 7C11.7167 7 11.4792 7.09583 11.2875 7.2875C11.0958 7.47917 11 7.71667 11 8V11.975C11 12.1083 11.025 12.2375 11.075 12.3625C11.125 12.4875 11.2 12.6 11.3 12.7L14.6 16C14.7833 16.1833 15.0167 16.275 15.3 16.275C15.5833 16.275 15.8167 16.1833 16 16C16.1833 15.8167 16.275 15.5833 16.275 15.3C16.275 15.0167 16.1833 14.7833 16 14.6L13 11.6ZM12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C13.3833 2 14.6833 2.2625 15.9 2.7875C17.1167 3.3125 18.175 4.025 19.075 4.925C19.975 5.825 20.6875 6.88333 21.2125 8.1C21.7375 9.31667 22 10.6167 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl",children:N(h.weeklyStats.totalDurationMinutes)})]})]})]}),O.jsxs("div",{children:[O.jsx("h3",{className:"text-orange-500 font-crimson text-2xl font-bold mb-4",children:"  "}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M19.95 21C17.8667 21 15.8083 20.5458 13.775 19.6375C11.7417 18.7292 9.89167 17.4417 8.225 15.775C6.55833 14.1083 5.27083 12.2583 4.3625 10.225C3.45417 8.19167 3 6.13333 3 4.05C3 3.75 3.1 3.5 3.3 3.3C3.5 3.1 3.75 3 4.05 3H8.1C8.33333 3 8.54167 3.07917 8.725 3.2375C8.90833 3.39583 9.01667 3.58333 9.05 3.8L9.7 7.3C9.73333 7.56667 9.725 7.79167 9.675 7.975C9.625 8.15833 9.53333 8.31667 9.4 8.45L6.975 10.9C7.30833 11.5167 7.70417 12.1125 8.1625 12.6875C8.62083 13.2625 9.125 13.8167 9.675 14.35C10.1917 14.8667 10.7333 15.3458 11.3 15.7875C11.8667 16.2292 12.4667 16.6333 13.1 17L15.45 14.65C15.6 14.5 15.7958 14.3875 16.0375 14.3125C16.2792 14.2375 16.5167 14.2167 16.75 14.25L20.2 14.95C20.4333 15.0167 20.625 15.1375 20.775 15.3125C20.925 15.4875 21 15.6833 21 15.9V19.95C21 20.25 20.9 20.5 20.7 20.7C20.5 20.9 20.25 21 19.95 21Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsxs("span",{className:"text-gray-800 font-crimson text-xl",children:[h.quarterlyStats.callCount,""]})]}),O.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-100 rounded-lg",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M13 11.6V8C13 7.71667 12.9042 7.47917 12.7125 7.2875C12.5208 7.09583 12.2833 7 12 7C11.7167 7 11.4792 7.09583 11.2875 7.2875C11.0958 7.47917 11 7.71667 11 8V11.975C11 12.1083 11.025 12.2375 11.075 12.3625C11.125 12.4875 11.2 12.6 11.3 12.7L14.6 16C14.7833 16.1833 15.0167 16.275 15.3 16.275C15.5833 16.275 15.8167 16.1833 16 16C16.1833 15.8167 16.275 15.5833 16.275 15.3C16.275 15.0167 16.1833 14.7833 16 14.6L13 11.6ZM12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C13.3833 2 14.6833 2.2625 15.9 2.7875C17.1167 3.3125 18.175 4.025 19.075 4.925C19.975 5.825 20.6875 6.88333 21.2125 8.1C21.7375 9.31667 22 10.6167 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22Z",fill:"#3C3F3D"})}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl font-semibold",children:" "})]}),O.jsx("span",{className:"text-gray-800 font-crimson text-xl",children:N(h.quarterlyStats.totalDurationMinutes)})]})]})]}),O.jsx("div",{className:"mt-8 flex justify-center",children:O.jsx("button",{onClick:u,className:"w-full max-w-sm h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:""})})]})]})]})}function NF({onBack:u}){const[h,f]=ee.useState([]),[g,S]=ee.useState(!0),[T,R]=ee.useState(null),[N,k]=ee.useState(1),[x,U]=ee.useState(1),[B,Y]=ee.useState(!1),H=async(ce=1)=>{try{S(!0),R(null);const $=FE(),le=uo();if(!le)throw new Error(" .");$.setToken(le);const ne=await $.getCallHistory({page:ce,limit:20,period:"all"});f(ne.calls),k(ne.pagination.currentPage),U(ne.pagination.totalPages),Y(ne.pagination.hasNext)}catch($){console.error("   :",$),R($ instanceof Error?$.message:"    .")}finally{S(!1)}};ee.useEffect(()=>{H(1)},[]);const re=ce=>{const $=new Date(ce),le=$.getMonth()+1,ne=$.getDate(),ue=$.getHours().toString().padStart(2,"0"),Pe=$.getMinutes().toString().padStart(2,"0");return`${le}/${ne} ${ue}:${Pe}`},X=ce=>{if(ce===0)return"1 ";const $=Math.floor(ce/60),le=ce%60;return $===0?`${le}`:le===0?`${$}`:`${$} ${le}`},te=ce=>{ce<1||ce>x||(H(ce),window.scrollTo({top:0,behavior:"smooth"}))};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page font-noto",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:" "}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5",children:[g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 font-pretendard",children:"   ..."})]})}),T&&!g&&O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-red-500 font-pretendard mb-4",children:T}),O.jsx("button",{onClick:()=>H(N),className:"px-4 py-2 bg-orange-500 text-white rounded-lg font-pretendard",children:" "})]})}),!g&&!T&&O.jsx(O.Fragment,{children:h.length===0?O.jsx("div",{className:"flex items-center justify-center h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-gray-500 font-pretendard text-lg",children:"   "}),O.jsx("p",{className:"text-gray-400 font-pretendard text-sm mt-2",children:"  !"})]})}):O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"space-y-3",children:h.map(ce=>O.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-100 hover:bg-gray-100 transition-colors",children:[O.jsxs("div",{className:"flex items-center justify-between mb-2",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center",children:O.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z",fill:"#EE9049"})})}),O.jsxs("div",{className:"ml-1",children:[O.jsx("p",{className:"text-gray-800 font-crimson text-lg font-semibold",children:ce.partnerNickname}),O.jsx("p",{className:"text-gray-500 font-pretendard text-xs",children:re(ce.startedAt)})]})]}),O.jsx("div",{className:"text-right",children:O.jsx("p",{className:"text-orange-500 font-crimson text-base font-semibold",children:X(ce.durationMinutes)})})]}),O.jsx("div",{className:"flex items-center gap-2 ml-[52px]",children:O.jsx("div",{className:"px-3 py-1 bg-white rounded-full border border-orange-200",children:O.jsx("span",{className:"text-orange-500 font-pretendard text-sm",children:ce.categoryName})})})]},ce.callId))}),x>1&&O.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8",children:[O.jsx("button",{onClick:()=>te(N-1),disabled:N===1,className:`px-4 py-2 rounded-lg font-pretendard ${N===1?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-orange-500 text-white hover:bg-orange-600"}`,children:""}),O.jsxs("span",{className:"text-gray-700 font-pretendard",children:[N," / ",x]}),O.jsx("button",{onClick:()=>te(N+1),disabled:!B,className:`px-4 py-2 rounded-lg font-pretendard ${B?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:""})]})]})})]})]})}function PF({featureName:u,onBack:h}){const f=$d(),g=x0(),T=new URLSearchParams(g.search).get("feature"),R=u||T||" ",N=()=>{h?h():f(-1)};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page font-noto",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:N,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:R}),O.jsx("div",{className:"w-6"})]}),O.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"mb-8",children:O.jsx("div",{className:"w-32 h-32 mx-auto bg-orange-100 rounded-full flex items-center justify-center",children:O.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z",fill:"#EA8C4B"})})})}),O.jsx("h2",{className:"text-gray-900 font-crimson text-3xl font-bold mb-4",children:" "}),O.jsxs("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-2",children:[R,"()   ."]}),O.jsx("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-8",children:"    ."}),O.jsx("div",{className:"bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-8",children:O.jsxs("p",{className:"text-orange-600 font-pretendard text-base leading-relaxed",children:["    ",O.jsx("br",{}),"  . "]})}),O.jsx("button",{onClick:N,className:"w-full max-w-sm h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:""})]})})]})}function kF({onBack:u}){const h="chingoohaja@gmail.com",f=()=>{navigator.clipboard.writeText(h),alert("  !")},g=()=>{window.location.href=`mailto:${h}`};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page font-noto",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),O.jsx("div",{className:"w-6"})]}),O.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-8",children:O.jsxs("div",{className:"text-center w-full max-w-md",children:[O.jsx("div",{className:"mb-8",children:O.jsx("div",{className:"w-32 h-32 mx-auto bg-orange-100 rounded-full flex items-center justify-center",children:O.jsx("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z",fill:"#EA8C4B"})})})}),O.jsx("h2",{className:"text-gray-900 font-crimson text-3xl font-bold mb-4",children:""}),O.jsxs("p",{className:"text-gray-600 font-pretendard text-lg leading-relaxed mb-8",children:["    ?",O.jsx("br",{}),"  ."]}),O.jsxs("div",{className:"bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-6",children:[O.jsx("p",{className:"text-gray-700 font-pretendard text-sm mb-3",children:" "}),O.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[O.jsx("p",{className:"text-orange-600 font-crimson text-xl font-bold",children:h}),O.jsx("button",{onClick:f,className:"p-2 hover:bg-orange-100 rounded-lg transition-colors",title:"",children:O.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#EA8C4B",strokeWidth:"2",children:[O.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),O.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})})]}),O.jsx("p",{className:"text-gray-500 font-pretendard text-sm",children:"  . "})]}),O.jsxs("div",{className:"space-y-3",children:[O.jsx("button",{onClick:g,className:"w-full h-14 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl font-semibold rounded-lg hover:opacity-90 transition-opacity",children:" "}),O.jsx("button",{onClick:u,className:"w-full h-14 bg-white border-2 border-gray-200 text-gray-700 font-crimson text-xl font-semibold rounded-lg hover:bg-gray-50 transition-colors",children:""})]}),O.jsx("div",{className:"mt-8",children:O.jsxs("p",{className:"text-gray-500 font-pretendard text-sm leading-relaxed",children:["   :  09:00 - 18:00",O.jsx("br",{}),"(   )"]})})]})})]})}function Ene(){const[u,h]=ee.useState(!1),[f,g]=ee.useState(!0),[S,T]=ee.useState("home"),[R,N]=ee.useState(null),[k,x]=ee.useState(!1),[U,B]=ee.useState(!1),[Y,H]=ee.useState(!1),[re,X]=ee.useState(!1),[te,ce]=ee.useState(!1),[$,le]=ee.useState(""),ne=$d();ee.useEffect(()=>{(()=>{try{const Ot=XA(),Gt=xE();if(h(Ot),Ot&&Gt)if(Gt.is_new_user||!Gt.is_profile_complete){ne("/profile-setup",{replace:!0});return}else return}catch(Ot){console.error("Error checking auth status:",Ot),h(!1)}finally{g(!1)}})()},[ne]),ee.useEffect(()=>{!f&&!u&&ne("/login",{replace:!0})},[f,u,ne]);const ue=async()=>{try{await aF(),h(!1),T("home"),N(null),x(!1),B(!1),ne("/login",{replace:!0})}catch(at){console.error("   :",at),h(!1),T("home"),N(null),x(!1),B(!1),ne("/login",{replace:!0})}},Pe=at=>{N(at),T("connecting")},he=()=>{T("home"),N(null)},de=()=>{T("inCall")},ye=()=>{T("evaluation")},Me=()=>{T("connecting")},Je=()=>{T("home"),N(null)},Ve=()=>{T("home"),N(null)},xe=()=>{x(!0)},He=()=>{x(!1)},dt=()=>{B(!0)},Qe=()=>{H(!0)},Ge=()=>{x(!1),ne("/profile-setup")},Ie=()=>{B(!1)},ke=()=>{H(!1)},Ye=at=>{le(at),X(!0),x(!1)},_e=()=>{X(!1),x(!0)},De=()=>{ce(!0),x(!1)},ct=()=>{ce(!1),x(!0)};return f?O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx("div",{className:"min-h-screen bg-grey-50 flex items-center justify-center safe-area-page",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-orange-accent border-t-transparent rounded-full mx-auto mb-4"}),O.jsx("p",{className:"text-grey-900 font-crimson text-lg",children:" ..."})]})})}):O.jsx("div",{className:"max-w-md mx-auto",children:u?te?O.jsx(kF,{onBack:ct}):re?O.jsx(PF,{featureName:$,onBack:_e}):Y?O.jsx(NF,{onBack:ke}):U?O.jsx(OF,{onBack:Ie}):k?O.jsx(AF,{onBack:He,onNavigateToActivity:dt,onNavigateToProfileEdit:Ge,onNavigateToComingSoon:Ye,onNavigateToSupport:De,onLogout:ue}):S==="connecting"?O.jsx(RF,{selectedCategory:R,onCancel:he,onConnected:de}):S==="inCall"?O.jsx(bF,{selectedCategory:R,onEndCall:ye}):S==="evaluation"?O.jsx(IF,{selectedCategory:R,onCallAgain:Me,onSelectInterests:Je,onGoHome:Ve}):O.jsx(hne,{onStartCall:Pe,onOpenSettings:xe,onOpenCallHistory:Qe}):null})}const vne=()=>{const u=x0();return ee.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",u.pathname)},[u.pathname]),O.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 safe-area-page font-noto",children:O.jsxs("div",{className:"text-center",children:[O.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),O.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),O.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};function Sne({onLogin:u,onSignUp:h}){const[f,g]=ee.useState(""),[S,T]=ee.useState(""),[R,N]=ee.useState(!1),[k,x]=ee.useState(!1),U=async()=>{if(!f.trim()){alert(" .");return}if(!S.trim()){alert(" .");return}N(!0);try{const Y={email:f.trim(),password:S};await eF(Y),u()}catch(Y){console.error(" :",Y);const H=Y instanceof Error?Y.message:"   .  .";alert(H)}finally{N(!1)}},B=async Y=>{try{await nF(Y)}catch(H){Fe.error("   :",H),alert("  .  .")}};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center safe-area-page",children:[O.jsx("div",{className:"mt-4 md:mt-16 mb-8 md:mb-12",children:O.jsxs("svg",{width:"103",height:"32",viewBox:"0 0 103 32",fill:"none",children:[O.jsx("path",{d:"M77.7015 8.50968V5.22002H91.1165V8.50968H86.4656V10.9904C86.4656 12.1229 86.358 13.1206 86.143 14.0374C87.3527 15.6822 90.1218 18.2439 92.1111 19.2955L90.5519 22.666C88.7776 21.7492 86.3043 19.5921 84.7719 17.4619C84.4493 18.0012 84.0998 18.5135 83.7234 19.0528C82.7019 20.5089 80.4168 22.666 78.8844 23.448L76.6799 20.3471C77.5671 19.8887 79.0995 18.6753 80.1748 17.4619C81.8954 15.5474 82.5406 13.7408 82.5406 11.1252V8.50968H77.7015ZM93.6435 4.06055H97.5416V12.3386H101.117V16.0328H97.5416V27.223H93.6435V4.06055Z",fill:"black"}),O.jsx("path",{d:"M59.194 12.0688C63.0115 12.0688 65.7805 14.4956 65.7805 18.1358C65.7805 21.776 63.0115 24.1759 59.194 24.1759C55.3496 24.1759 52.6344 21.803 52.6344 18.1358C52.6344 14.4956 55.3496 12.0688 59.194 12.0688ZM68.3613 27.2229V4.06039H72.2595V12.5542H75.835V16.2483H72.2595V27.2229H68.3613ZM51.5859 7.40398H57.3659L56.9627 3.97949H61.6135L61.2103 7.40398H66.7752V10.6667H51.5859V7.40398ZM59.194 15.0889C57.4197 15.0889 56.2099 16.2214 56.2099 18.1358C56.2099 20.0773 57.4197 21.1559 59.194 21.1559C60.9683 21.1559 62.1781 20.0503 62.1781 18.1358C62.1781 16.2214 60.9683 15.0889 59.194 15.0889Z",fill:"black"}),O.jsx("path",{d:"M26.5189 16.491H41.1436C41.4393 15.2776 41.7351 13.3631 41.9233 11.4486C42.0308 10.3431 42.0846 8.99485 42.1114 7.75448H29.2611V4.41089H46.1709C46.1978 6.97251 46.1171 9.02181 45.902 11.152C45.6601 13.1474 45.1762 15.2506 44.7729 16.491H49.2894V19.8346H39.9339V28.2205H35.7669V19.8346H26.5189V16.491Z",fill:"black"}),O.jsx("path",{d:"M7.0167 3.35938H11.56L11.2643 6.13672H15.8614V9.39942H11.2374V10.0196C11.2374 10.6667 11.1299 11.2869 10.9417 11.8801C12.5816 13.0935 15.0011 14.253 16.3991 14.6575L15.4582 18.028C13.7107 17.6236 11.103 16.1405 9.38246 14.6036C9.05985 15.008 8.68348 15.3855 8.30711 15.763C6.88228 17.1382 4.78535 18.3786 3.0648 18.8639L1.80127 15.4664C2.82285 15.0889 4.3821 14.3609 5.43056 13.498C6.77474 12.3925 7.3393 11.3678 7.3393 10.0196V9.39942H2.47336V6.13672H7.28553L7.0167 3.35938ZM9.62441 19.565V24.5534H22.7974V27.9779H5.67251V19.565H9.62441ZM18.5767 4.06045H22.4748V20.8593H18.5767V4.06045Z",fill:"black"})]})}),O.jsxs("div",{className:"w-full max-w-sm md:max-w-md lg:max-w-lg xl:max-w-xl px-5 space-y-4 md:space-y-6",children:[O.jsx("div",{className:"relative",children:O.jsx("input",{type:"email",value:f,onChange:Y=>g(Y.target.value),placeholder:" .",className:"w-full h-12 md:h-14 px-4 border border-border-gray rounded-lg font-noto text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent",disabled:R})}),O.jsxs("div",{className:"relative",children:[O.jsx("input",{type:k?"text":"password",value:S,onChange:Y=>T(Y.target.value),placeholder:" .",className:"w-full h-12 md:h-14 px-4 pr-12 border border-border-gray rounded-lg font-noto text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent",disabled:R,onKeyPress:Y=>{Y.key==="Enter"&&!R&&U()}}),O.jsx("button",{type:"button",onClick:()=>x(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none",disabled:R,children:k?O.jsx(Kj,{className:"w-5 h-5 md:w-6 md:h-6"}):O.jsx(zj,{className:"w-5 h-5 md:w-6 md:h-6"})})]}),O.jsx("div",{className:"pt-4",children:O.jsx("button",{onClick:U,disabled:R,className:`w-full h-14 md:h-16 bg-login-button text-white font-noto text-xl md:text-2xl font-bold rounded-lg hover:bg-opacity-90 transition-colors ${R?"opacity-50 cursor-not-allowed":""}`,children:R?" ...":""})}),O.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4",children:[O.jsx("button",{onClick:h,className:"text-text-gray font-pretendard text-lg md:text-xl underline hover:text-gray-600",children:""}),O.jsx("div",{className:"w-px h-4 bg-divider"}),O.jsx("button",{className:"text-text-gray font-pretendard text-lg md:text-xl underline hover:text-gray-600",children:" "})]}),O.jsxs("div",{className:"flex items-center justify-center pt-8 pb-4",children:[O.jsx("div",{className:"flex-1 h-px bg-border-gray"}),O.jsx("span",{className:"px-4 text-text-gray font-noto text-base md:text-lg",children:" "}),O.jsx("div",{className:"flex-1 h-px bg-border-gray"})]}),O.jsxs("div",{className:"space-y-3",children:[O.jsxs("button",{onClick:()=>B("kakao"),className:"w-full h-12 md:h-14 bg-kakao border border-border-gray rounded-lg flex items-center justify-center gap-2 hover:bg-opacity-90 transition-colors",children:[O.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4c65144d6cea6e4262f91c38a6a5875303193496?width=48",alt:"Kakao",className:"w-6 h-6"}),O.jsx("span",{className:"text-gray-800 font-noto text-base md:text-lg font-bold",children:" "})]}),O.jsxs("button",{onClick:()=>B("google"),className:"w-full h-12 md:h-14 bg-white border border-border-gray rounded-lg flex items-center justify-center gap-2 hover:bg-gray-50 transition-colors",children:[O.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[O.jsx("path",{d:"M11.9977 10.3621V13.8467H16.8402C16.6276 14.9674 15.9895 15.9163 15.0324 16.5543L17.9527 18.8202C19.6541 17.2497 20.6357 14.9429 20.6357 12.2026C20.6357 11.5646 20.5785 10.9511 20.4721 10.3622L11.9977 10.3621Z",fill:"#4285F4"}),O.jsx("path",{d:"M6.95517 13.7107L6.29655 14.2149L3.96521 16.0308C5.44578 18.9674 8.48034 20.9961 11.9977 20.9961C14.4271 20.9961 16.4639 20.1944 17.9527 18.8202L15.0324 16.5543C14.2308 17.0942 13.2083 17.4214 11.9977 17.4214C9.65824 17.4214 7.67056 15.8427 6.95885 13.7159L6.95517 13.7107Z",fill:"#34A853"}),O.jsx("path",{d:"M3.96517 7.96533C3.3517 9.17592 3 10.542 3 11.998C3 13.454 3.3517 14.8201 3.96517 16.0307C3.96517 16.0388 6.9591 13.7076 6.9591 13.7076C6.77914 13.1677 6.67277 12.5951 6.67277 11.9979C6.67277 11.4007 6.77914 10.8281 6.9591 10.2883L3.96517 7.96533Z",fill:"#FBBC05"}),O.jsx("path",{d:"M11.9979 6.58283C13.3231 6.58283 14.501 7.0409 15.4417 7.92435L18.0183 5.34769C16.4559 3.89167 14.4274 3 11.9979 3C8.48052 3 5.44578 5.02045 3.96521 7.96526L6.95905 10.2884C7.67066 8.16156 9.65842 6.58283 11.9979 6.58283Z",fill:"#EA4335"})]}),O.jsx("span",{className:"text-gray-800 font-noto text-base md:text-lg font-bold",children:" "})]})]})]})]})}function yne({onBack:u}){const h=$d(),[f,g]=ee.useState(""),[S,T]=ee.useState(""),[R,N]=ee.useState(""),[k,x]=ee.useState(!1),[U,B]=ee.useState({}),[Y,H]=ee.useState(""),[re,X]=ee.useState(!1),[te,ce]=ee.useState({hasMinLength:!1,hasMaxLength:!1,hasLetter:!1,hasNumber:!1,hasSpecialChar:!1}),$=he=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(he),le=he=>{if(he.length<8||he.length>20)return!1;const de=/[a-zA-Z]/.test(he),ye=/[0-9]/.test(he),Me=/[^a-zA-Z0-9]/.test(he);return de&&ye&&Me},ne=he=>{ce({hasMinLength:he.length>=8,hasMaxLength:he.length<=20,hasLetter:/[a-zA-Z]/.test(he),hasNumber:/[0-9]/.test(he),hasSpecialChar:/[^a-zA-Z0-9]/.test(he)})},ue=()=>{const he={};return f.trim()?$(f)||(he.email="   ."):he.email=" .",S?le(S)||(he.password=" 8-20, //  ."):he.password=" .",R.trim()||(he.realName="  ."),B(he),Object.keys(he).length===0},Pe=async()=>{if(ue()){x(!0),B({}),H("");try{const he={email:f.trim(),password:S,real_name:R.trim()};await Z8(he),h("/profile-setup",{replace:!0})}catch(he){console.error(" :",he);const de=he instanceof Error?he.message:"   .  .";H(de)}finally{x(!1)}}};return O.jsxs("div",{className:"min-h-screen bg-white flex flex-col safe-area-page font-noto",children:[O.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100",children:[O.jsx("button",{onClick:u,className:"p-1",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"black",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-gray-800 font-crimson text-lg font-bold",children:""}),O.jsx("div",{className:"w-6"})]}),O.jsxs("div",{className:"flex-1 px-5 py-5 overflow-y-auto",children:[O.jsx("div",{className:"mb-8",children:O.jsxs("h2",{className:"text-black font-crimson text-2xl font-bold leading-8",children:["  ",O.jsx("br",{})," "]})}),O.jsxs("div",{className:"space-y-6",children:[O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:""}),O.jsx("div",{className:"relative",children:O.jsx("input",{type:"email",value:f,onChange:he=>{g(he.target.value),U.email&&B({...U,email:""})},placeholder:" ",className:`w-full h-14 px-4 border rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent ${U.email?"border-red-500":"border-gray-200"}`,disabled:k})}),U.email&&O.jsx("p",{className:"text-red-500 text-sm font-pretendard",children:U.email})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:""}),O.jsxs("div",{className:"relative",children:[O.jsx("input",{type:re?"text":"password",value:S,onChange:he=>{const de=he.target.value;T(de),ne(de),U.password&&B({...U,password:""})},onBlur:()=>{S&&!le(S)&&B({...U,password:" 8-20, //  ."})},placeholder:"  ",className:`w-full h-14 px-4 pr-12 border rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent ${U.password?"border-red-500":"border-gray-200"}`,disabled:k}),O.jsx("button",{type:"button",onClick:()=>X(!re),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none",disabled:k,children:re?O.jsx(Kj,{className:"w-5 h-5"}):O.jsx(zj,{className:"w-5 h-5"})})]}),U.password&&O.jsx("p",{className:"text-red-500 text-sm font-pretendard",children:U.password}),S&&O.jsxs("div",{className:"space-y-1 mt-2",children:[O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasMinLength?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasMinLength?"":""}),O.jsx("span",{children:"8 "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasMaxLength?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasMaxLength?"":""}),O.jsx("span",{children:"20 "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasLetter?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasLetter?"":""}),O.jsx("span",{children:" "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasNumber?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasNumber?"":""}),O.jsx("span",{children:" "})]}),O.jsxs("div",{className:`flex items-center gap-2 text-sm font-pretendard ${te.hasSpecialChar?"text-green-600":"text-gray-500"}`,children:[O.jsx("span",{children:te.hasSpecialChar?"":""}),O.jsx("span",{children:" "})]})]}),!S&&O.jsx("p",{className:"text-gray-500 text-sm font-pretendard",children:"8-20, // "})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"text-gray-700 font-pretendard text-xl",children:" "}),O.jsx("div",{className:"relative",children:O.jsx("input",{type:"text",value:R,onChange:he=>{N(he.target.value),U.realName&&B({...U,realName:""})},placeholder:"  ",className:`w-full h-14 px-4 border rounded-lg font-crimson text-xl placeholder:text-gray-400 text-gray-900 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent ${U.realName?"border-red-500":"border-gray-200"}`,disabled:k})}),U.realName&&O.jsx("p",{className:"text-red-500 text-sm font-pretendard",children:U.realName})]})]})]}),Y&&O.jsx("div",{className:"px-5 pb-4",children:O.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:O.jsx("p",{className:"text-red-600 text-sm font-pretendard",children:Y})})}),O.jsx("div",{className:"px-5 pb-8",children:O.jsx("button",{onClick:Pe,disabled:k,className:`w-full h-14 bg-orange-500 text-white font-crimson text-xl font-bold rounded-lg transition-colors ${k?"opacity-50 cursor-not-allowed":"hover:bg-orange-600"}`,children:k?" ...":""})})]})}function Tne(){const[u,h]=ee.useState("loading"),[f,g]=ee.useState(""),[S,T]=ee.useState(null),R=$d(),N=ee.useRef(!1);return ee.useEffect(()=>{if(N.current){console.log(" OAuth    .   .");return}return N.current=!0,console.log(" OAuth   "),(async()=>{try{const x=await rF();x?(console.log(" OAuth   "),h("success"),T(x.data.user_info),x.data.user_info.is_new_user||!x.data.user_info.is_profile_complete?setTimeout(()=>{R("/profile-setup")},2e3):setTimeout(()=>{R("/")},2e3)):(console.log(" OAuth   ,  "),R("/"))}catch(x){console.error(" OAuth   :",x),h("error"),g(x instanceof Error?x.message:"    ."),setTimeout(()=>{R("/login")},3e3)}})(),()=>{console.log(" OAuth   cleanup")}},[]),u==="loading"?O.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page font-noto",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button mx-auto mb-4"}),O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:"  ..."}),O.jsx("p",{className:"text-gray-600",children:" ."})]})}):u==="success"?O.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page font-noto",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:" !"}),O.jsx("p",{className:"text-gray-600 mb-4",children:"!  ."}),O.jsx("p",{className:"text-sm text-gray-500",children:S?.is_new_user||!S?.is_profile_complete?"   ...":"  ..."})]})}):u==="error"?O.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center safe-area-page font-noto",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:" "}),O.jsx("p",{className:"text-gray-600 mb-4",children:f}),O.jsx("p",{className:"text-sm text-gray-500",children:"  ..."})]})}):null}function Cne(){const[u,h]=ee.useState(null),[f,g]=ee.useState(""),[S,T]=ee.useState(""),[R,N]=ee.useState(""),[k,x]=ee.useState(""),[U,B]=ee.useState(""),[Y,H]=ee.useState(!1),[re,X]=ee.useState(!1),[te,ce]=ee.useState(!1),[$,le]=ee.useState(!1),ne=$d(),ue=()=>{X(!0),setTimeout(()=>{ne("/",{replace:!0})},2e3)},Pe=()=>{if(!u)return;const ye={id:u.id,is_profile_complete:!0,is_new_user:!1};localStorage.setItem("user_info",JSON.stringify(ye))};ee.useEffect(()=>{(async()=>{try{const Me=xE(),Ve=(await JA()).data;h(Ve),g(Ve.nickname||"");const xe=Ve.is_new_user??Me?.is_new_user??!1;if(!xe&&(Ve.gender&&T(Ve.gender),Ve.birth)){const[He,dt,Qe]=Ve.birth.split("-");N(He),x(dt),B(Qe)}xe&&ce(!0)}catch(Me){if(console.error("   :",Me),Me instanceof Error&&Me.message.includes(" ")){alert(" .  ."),ne("/login");return}const Je=xE();if(!Je){ne("/login");return}const Ve={id:Je.id,email:"",nickname:"",is_new_user:Je.is_new_user,is_profile_complete:Je.is_profile_complete};h(Ve),g(""),Ve.is_new_user&&ce(!0)}})()},[ne]);const he=()=>{le(!0),ce(!1)},de=async()=>{if(!f.trim()){alert(" .");return}if(!S){alert(" .");return}if(!R||!k||!U){alert("  .");return}const ye=parseInt(R),Me=parseInt(k),Je=parseInt(U),Ve=new Date().getFullYear();if(ye<1900||ye>Ve){alert("  .");return}if(Me<1||Me>12){alert("  .");return}if(Je<1||Je>31){alert("  .");return}const xe=`${R}-${k.padStart(2,"0")}-${U.padStart(2,"0")}`,He=u&&f!==u.nickname,dt=u&&S!==u.gender,Qe=u&&xe!==u.birth,Ge={};if(He&&(Ge.nickname=f),dt&&(Ge.gender=S),Qe&&(Ge.birth=xe),Object.keys(Ge).length===0){Pe(),ue();return}H(!0);try{await cF(Ge),Pe(),ue()}catch(Ie){if(console.error("  :",Ie),Ie instanceof Error&&Ie.message.includes(" ")){alert(" .  ."),ne("/login");return}alert("  .  .")}finally{H(!1)}};return u?O.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center relative safe-area-page font-noto","aria-busy":re,children:[te&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4",role:"dialog","aria-modal":"true","aria-labelledby":"consent-title",children:O.jsxs("div",{className:"bg-white rounded-2xl p-6 md:p-8 max-w-md w-full max-h-[80vh] overflow-y-auto",children:[O.jsx("h2",{id:"consent-title",className:"text-xl md:text-2xl font-crimson font-bold text-gray-900 mb-4",children:"    "}),O.jsxs("div",{className:"space-y-4 mb-6 text-gray-700",children:[O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"1.   "}),O.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[O.jsx("li",{children:" : , , , "}),O.jsx("li",{children:" :   ,  "})]})]}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"2.     "}),O.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[O.jsx("li",{children:"    "}),O.jsx("li",{children:"    "}),O.jsx("li",{children:"   "}),O.jsx("li",{children:"  "})]})]}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"3.     "}),O.jsx("p",{className:"text-sm",children:"   ,    . ,          ."})]})]}),O.jsx("div",{className:"pt-2",children:O.jsx("button",{onClick:he,className:"w-full h-14 bg-login-button text-white font-crimson text-lg font-bold rounded-lg hover:bg-opacity-90 transition-colors",children:""})})]})}),re&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"profile-save-title","aria-describedby":"profile-save-desc",children:O.jsxs("div",{className:"bg-white rounded-lg p-6 mx-4 text-center",children:[O.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:O.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),O.jsx("h3",{id:"profile-save-title",className:"text-lg font-semibold text-gray-900 mb-2",children:" !"}),O.jsx("p",{id:"profile-save-desc",className:"text-gray-600",children:"    ..."})]})}),O.jsx("div",{className:"w-full max-w-sm md:max-w-md px-5 pt-4 pb-6",children:O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsx("button",{onClick:()=>{u.is_new_user?ne("/"):ne("/settings")},className:"p-2 -ml-2",children:O.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:O.jsx("path",{d:"M15 18L9 12L15 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),O.jsx("h1",{className:"text-lg font-crimson font-bold text-gray-900",children:" "}),O.jsx("div",{className:"w-10"})]})}),O.jsxs("div",{className:"w-full max-w-sm md:max-w-md px-5 space-y-6",children:[O.jsxs("div",{className:"text-center py-4",children:[O.jsx("h2",{className:"text-xl font-crimson text-gray-900 mb-2",children:u.is_new_user?"!":" "}),O.jsx("p",{className:"text-gray-600",children:u.is_new_user?"    .":"  ."})]}),O.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:""}),O.jsx("p",{className:"text-gray-900",children:u.email})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),O.jsx("input",{type:"text",value:f,onChange:ye=>g(ye.target.value),placeholder:" ",disabled:u?.is_new_user&&!$,className:"w-full h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),O.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[O.jsx("button",{type:"button",onClick:()=>T("MALE"),disabled:u?.is_new_user&&!$,className:`h-12 md:h-14 px-4 border rounded-lg font-crimson text-lg md:text-xl transition-all ${S==="MALE"?"border-login-button bg-login-button/10 text-login-button":"border-border-gray text-gray-700 hover:border-login-button/50"} disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50`,children:""}),O.jsx("button",{type:"button",onClick:()=>T("FEMALE"),disabled:u?.is_new_user&&!$,className:`h-12 md:h-14 px-4 border rounded-lg font-crimson text-lg md:text-xl transition-all ${S==="FEMALE"?"border-login-button bg-login-button/10 text-login-button":"border-border-gray text-gray-700 hover:border-login-button/50"} disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50`,children:""})]})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" *"}),O.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[O.jsx("input",{type:"number",value:R,onChange:ye=>N(ye.target.value),placeholder:"(4)",min:"1900",max:new Date().getFullYear(),disabled:u?.is_new_user&&!$,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"}),O.jsx("input",{type:"number",value:k,onChange:ye=>x(ye.target.value),placeholder:"",min:"1",max:"12",disabled:u?.is_new_user&&!$,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"}),O.jsx("input",{type:"number",value:U,onChange:ye=>B(ye.target.value),placeholder:"",min:"1",max:"31",disabled:u?.is_new_user&&!$,className:"h-12 md:h-14 px-4 border border-border-gray rounded-lg font-crimson text-lg md:text-xl placeholder:text-text-placeholder text-gray-900 focus:outline-none focus:ring-2 focus:ring-login-button focus:border-transparent text-center disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]}),O.jsx("div",{className:"pt-4",children:O.jsx("button",{onClick:de,disabled:Y||!f.trim()||!S||!R||!k||!U||re,className:"w-full h-14 md:h-16 bg-gradient-to-r from-yellow-300 to-red-gradient text-white font-crimson text-xl md:text-2xl font-bold rounded-lg hover:opacity-90 transition-opacity disabled:bg-gray-300 disabled:bg-none disabled:cursor-not-allowed",children:Y?" ...":" "})})]})]}):O.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center safe-area-page",children:O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button"})})}function Cl({children:u,requireProfileComplete:h=!1}){const[f,g]=ee.useState(!0),[S,T]=ee.useState(null),R=$d();return ee.useEffect(()=>{(()=>{try{const k=XA(),x=xE();if(!k||!x){R("/login");return}if(T(x),h&&(!x.is_profile_complete||x.is_new_user)){R("/profile-setup");return}g(!1)}catch(k){console.error("  :",k),R("/login")}})()},[R,h]),f?O.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-login-button mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600",children:"  ..."})]})}):O.jsx(O.Fragment,{children:u})}const wne=new XZ,Rne=()=>{const u=$d(),{categoryId:h,cancelMatching:f,resetMatching:g,status:S,matchingId:T}=eO(),R=ee.useRef(null),[N,k]=ee.useState(!1);ee.useEffect(()=>{(async()=>{await lF(),k(!0)})()},[]),ee.useEffect(()=>{const de=Me=>{const{userInfo:Je}=Me.detail;Je.is_new_user||!Je.is_profile_complete?u("/profile-setup",{replace:!0}):u("/",{replace:!0})},ye=Me=>{const{error:Je}=Me.detail;u("/login",{replace:!0})};return window.addEventListener("oauth-login-success",de),window.addEventListener("oauth-login-error",ye),()=>{window.removeEventListener("oauth-login-success",de),window.removeEventListener("oauth-login-error",ye)}},[u]),ee.useEffect(()=>{const de=R.current;de!==null&&de!==S&&(S==="matched"&&T?u("/call-connected"):(S==="cancelled"||S==="timeout")&&u("/")),R.current=S},[S,T,u]);const x=de=>{if(!de)return null;const ye=Object.values(v0).find(Me=>Me.id===de);return ye?ye.name:null},U=async()=>{try{await f()}catch(de){console.error("  :",de)}finally{u("/")}},B=()=>{u("/call-connected")},Y=()=>{u("/call-evaluation")},H=()=>{u("/")},re=()=>{u("/")},X=()=>{u("/")},te=()=>{u("/my-activity")},ce=()=>{u("/signup")},$=()=>{u("/login")},le=()=>{u("/profile-setup")},ne=de=>{u(`/coming-soon?feature=${encodeURIComponent(de)}`)},ue=()=>{u("/support")},Pe=async()=>{u("/login")},he=()=>{u("/")};return N?O.jsx("div",{className:"w-full min-h-screen max-w-md mx-auto bg-white relative overflow-x-hidden",children:O.jsxs(Gee,{children:[O.jsx(cs,{path:"/",element:O.jsx(Ene,{})}),O.jsx(cs,{path:"/login",element:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(Sne,{onLogin:he,onSignUp:ce})})}),O.jsx(cs,{path:"/signup",element:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(yne,{onBack:$})})}),O.jsx(cs,{path:"/oauth/callback",element:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(Tne,{})})}),O.jsx(cs,{path:"/profile-setup",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(Cne,{})})})}),O.jsx(cs,{path:"/connecting-call",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(RF,{selectedCategory:x(h),onCancel:U,onConnected:B})})})}),O.jsx(cs,{path:"/call-connected",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(bF,{selectedCategory:x(h),onEndCall:Y})})})}),O.jsx(cs,{path:"/call-evaluation",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(IF,{selectedCategory:x(h),onCallAgain:H,onSelectInterests:re,onGoHome:he})})})}),O.jsx(cs,{path:"/my-activity",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(OF,{onBack:X})})})}),O.jsx(cs,{path:"/call-history",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(NF,{onBack:X})})})}),O.jsx(cs,{path:"/settings",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(AF,{onBack:X,onNavigateToActivity:te,onNavigateToProfileEdit:le,onNavigateToComingSoon:ne,onNavigateToSupport:ue,onLogout:Pe})})})}),O.jsx(cs,{path:"/coming-soon",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(PF,{})})})}),O.jsx(cs,{path:"/support",element:O.jsx(Cl,{children:O.jsx("div",{className:"max-w-md mx-auto",children:O.jsx(kF,{onBack:X})})})}),O.jsx(cs,{path:"*",element:O.jsx(vne,{})})]})}):O.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600",children:" ..."})]})})},bne=()=>O.jsx(QZ,{client:wne,children:O.jsxs(RZ,{children:[O.jsx(oQ,{}),O.jsx(FQ,{}),O.jsx(zee,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:O.jsx(Rne,{})})]})});cQ.createRoot(document.getElementById("root")).render(O.jsx(bne,{}));export{Q8 as W};
