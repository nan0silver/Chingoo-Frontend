# 백엔드 이슈 전달: 매칭 상태 조회 API 응답 형식

**대상 API:** `GET /api/v1/calls/match/status`  
**증상:** 원래 잘 되다가, 통화 중/복원 시점에 "매칭 상태 조회 오류: Error: 매칭 상태 조회 성공" 이 발생합니다.

---

## 1. 요약 (한 줄)

**매칭 상태 조회 API가 HTTP 200으로 응답할 때, `success: false` 이거나 `data`가 없는데 `message`에 "매칭 상태 조회 성공"이 들어와서, 프론트에서 실패로 처리하고 있습니다.**

---

## 2. 프론트엔드 기준 기대 응답

- **성공 시:**  
  `{ "success": true, "data": { ...MatchingStatus } }`  
  (필수: `success === true` 이고 `data`에 매칭 상태 객체가 있어야 함)

- **실패 시:**  
  `{ "success": false, "message": "에러 메시지" }`  
  또는 HTTP 4xx/5xx + 에러 본문

---

## 3. 현재 추정되는 문제

- **HTTP 200**으로 내려오는 응답 본문에 아래 둘 중 하나(또는 둘 다)인 경우가 있는 것으로 보입니다.
  - `success`가 `false` 이거나
  - `data`가 없음(null/undefined/빈 객체 등)
- 그런데 **`message`에는 "매칭 상태 조회 성공"**이 들어와서, 프론트에서는 “실패 응답인데 메시지는 성공”으로 처리되고, 사용자/로그에는 **"Error: 매칭 상태 조회 성공"**으로 보입니다.

즉, **어떤 조건(예: 통화 중, 매칭 대기 만료 직후, 특정 유저 상태 등)에서 성공/실패 분기나 메시지 설정이 잘못되어 있을 가능성**이 있습니다.

---

## 4. 백엔드에서 확인해 주시면 좋은 것

1. **`GET /api/v1/calls/match/status`** 구현에서  
   - 성공 시 반드시 `success: true` + `data: MatchingStatus` 형태로만 내려가는지  
   - 실패/예외 시에만 `success: false`(또는 해당 필드 없음) + `message`에 **에러용 문구**만 넣는지  
   한 번만 점검해 주세요.

2. **특히 아래 상황에서**  
   - “매칭 대기 중”, “통화 중”, “매칭 없음/만료” 등 상태별 분기  
   - `message`에 "매칭 상태 조회 성공"을 넣는 코드가 **실패 분기나 `data`를 비우는 분기**에 같이 들어가 있지 않은지  
   확인해 주시면 좋습니다.

3. **최근 배포/수정**  
   - 이 API나 매칭/통화 관련 로직이 최근에 수정되었다면, 그 변경에서 `success`/`data`/`message` 설정이 바뀌었는지 확인해 주세요.

---

## 5. 프론트엔드 처리 (참고)

- 현재는 `!result.success || !result.data` 이면  
  `throw new Error(result.message || "매칭 상태 조회에 실패했습니다.")` 로 처리하고 있어서,  
  백엔드에서 **성공이면 반드시 `success: true` + `data`** 를 주셔야 정상 동작합니다.
- 백엔드 수정 후에는 "매칭 상태 조회 성공"이 에러 메시지로 나오는 현상은 사라질 것입니다.

---

## 6. 전달 시 붙이면 좋은 문구 (복사용)

```
[매칭 상태 조회 API] GET /api/v1/calls/match/status

증상: 원래 잘 되다가, 통화 중/앱 복원 시점에 프론트에서
"매칭 상태 조회 오류: Error: 매칭 상태 조회 성공" 이 찍히고 있습니다.

원인 추정: 200 OK 인데 success=false 이거나 data가 없는데,
message에 "매칭 상태 조회 성공"이 들어오는 응답이 가끔 나오는 것 같습니다.

요청: 성공 시에는 반드시 { success: true, data: { ... } } 형태로만 주시고,
"매칭 상태 조회 성공" 메시지는 실패 분기/에러 분기에는 넣지 않도록 한 번만 확인 부탁드립니다.
```
